<?xml version="1.0" encoding="iso-8859-1"?>
<!--
     The FreeBSD Documentation Project
     The FreeBSD German Documentation Project

     $FreeBSD$
     $FreeBSDde$
     basiert auf: r44287
-->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="kernelconfig">
  <info><title>Konfiguration des &os;-Kernels</title>
    <!--
    <authorgroup>
      <author><personname><firstname>Jim</firstname><surname>Mock</surname></personname><contrib>Erweitert und neu strukturiert von </contrib></author>
    </authorgroup>
    <authorgroup>
      <author><personname><firstname>Jake</firstname><surname>Hamby</surname></personname><contrib>Ursprünglich veröffentlicht von </contrib></author>
    </authorgroup>
    <authorgroup>
      <author><personname><firstname>Robert</firstname><surname>Altschaffel</surname></personname><contrib>Übersetzt von </contrib></author>
    </authorgroup>
    -->
  </info>

  

  <sect1 xml:id="kernelconfig-synopsis">
    <title>Übersicht</title>

    <indexterm>
      <primary>Kernel</primary>
      <secondary>Erstellen eines angepassten Kernels</secondary>
    </indexterm>

    <para>Der Kernel ist das Herz des &os;-Betriebssystems.  Er ist
      verantwortlich für die Speicherverwaltung, das Durchsetzen
      von Sicherheitsdirektiven, Netzwerkfähigkeit, Festplattenzugriffen
      und vieles mehr.  Obwohl &os; es ermöglicht, dynamisch
      konfiguriert zu werden, ist es ab und an notwendig, einen
      angepassten Kernel zu konfigurieren und zu kompilieren.</para>

    <para>Nachdem Sie dieses Kapitel gelesen haben, werden Sie Folgendes
      wissen:</para>

    <itemizedlist>
      <listitem>
        <para>Wann Sie einen angepassten Kernel kompilieren
	  sollten.</para>
      </listitem>

      <listitem>
	<para>Wie Sie eine Hardware-Inventur durchführen.</para>
      </listitem>

      <listitem>
        <para>Wie Sie eine Kernelkonfigurationsdatei verändern.</para>
      </listitem>

      <listitem>
        <para>Wie Sie mit der Konfigurationsdatei einen neuen Kernel
	  kompilieren.</para>
      </listitem>

      <listitem>
        <para>Wie Sie den neuen Kernel installieren.</para>
      </listitem>

      <listitem>
        <para>Was zu tun ist, falls etwas schiefgeht.</para>
      </listitem>
    </itemizedlist>

    <para>Alle Kommandos, aus den Beispielen dieses Kapitels,
      müssen mit <systemitem class="username">root</systemitem>-Rechten
      ausgeführt werden.</para>
  </sect1>

  <sect1 xml:id="kernelconfig-custom-kernel">
    <title>Wieso einen eigenen Kernel bauen?</title>

    <para>Traditionell besaß &os; einen monolithischen
      Kernel.  Der Kernel war ein einziges großes Programm, das eine
      bestimmte Auswahl an Hardware unterstützte.  Um das
      Kernelverhalten zu ändern, musste man einen neuen Kernel
      kompilieren und dann den neuen Kernel booten.</para>

    <para>Heutzutage befinden sich die meisten Funktionen des
      &os;-Kernels in Modulen, die je nach Bedarf dynamisch geladen
      und entladen werden können.  Dies erlaubt es, einen laufenden
      Kernel anzupassen, um sofort neue Hardware oder neue Funktionen
      zu unterstützen.  Dies ist als modularer Kernel bekannt.</para>

    <para>Gelegentlich ist es noch notwendig, eine statische
      Kernelkonfigurationen durchzuführen.  In einigen Fällen
      ist die Funktion zu systemnah, um durch ein Modul realisiert zu
      werden.  Andere Umgebungen verhindern vielleicht das Laden und
      Entladen von Kernelmodulen und erfordern, dass nur die benötigte
      Funktionalität statisch in den Kernel kompiliert wird.</para>

    <para>Das Erstellen eines angepassten Kernels ist eines der
      Rituale für erfahrene BSD-Benutzer.  Obwohl dieser
      Prozess recht viel Zeit in Anspruch nimmt, kann
      er doch viele Vorteile für das &os;-System bringen.  Im
      Gegensatz zum <filename>GENERIC</filename>-Kernel, der eine
      Vielzahl von Hardware unterstützen muss, kann ein angepasster
      Kernel so eingeschränkt werden, dass er nur noch die Hardware
      des Rechners unterstützt.  Dies hat einige Vorteile:</para>

    <itemizedlist>
      <listitem>
        <para>Schnellerer Bootvorgang.  Da der Kernel nur
	  nach der Hardware des Systems sucht, kann sich
	  die Zeit für einen Systemstart verkürzen.</para>
      </listitem>

      <listitem>
        <para>Geringerer Speicherbedarf.  Ein eigener Kernel
	  benötigt in der Regel weniger Speicher als ein
	  <filename>GENERIC</filename>-Kernel durch das Entfernen von
	  Funktionen und Gerätetreibern. Das ist vorteilhaft, denn der
	  Kernel verweilt immer im RAM und verhindert dadurch, dass dieser
	  Speicher von Anwendungen genutzt wird.  Deshalb ist ein
	  angepasster Kernel auf einem System mit wenig RAM
	  sinnvoll.</para>
      </listitem>

      <listitem>
        <para>Zusätzliche Hardwareunterstützung.  Ein
	  angepasster Kernel kann Unterstützung für
	  Geräte bieten, die im
	  <filename>GENERIC</filename>-Kernel nicht enthalten
	  sind.</para>
      </listitem>
    </itemizedlist>

    <para>Bevor Sie einen angepassten Kernel erstellen, überlegen Sie
      sich bitte, warum Sie dies tun wollen.  Wenn Sie lediglich eine
      bestimmte Hardwareunterstützung benötigen, existiert diese
      vielleicht schon als Kernelmodul.</para>

    <para>Kernelmodule existieren in <filename>/boot/kernel</filename>
      und können mit &man.kldload.8; dynamisch in den laufenden Kernel
      geladen werden.  Die meisten Kerneltreiber verfügen über ein
      ladbares Modul und eine Manualpage.  Der drahtlose
      Ethernet-Treiber &man.ath.4; hat die folgenden Informationen in
      seiner Manualpage:</para>

    <screen>Alternatively, to load the driver as a module at boot time, place the
following line in &man.loader.conf.5;:

    if_ath_load="YES"</screen>

    <para>Durch das Hinzufügen von
      <literal>if_ath_load="YES"</literal> in
      <filename>/boot/loader.conf</filename> wird das Modul dynamisch
      beim Systemstart geladen.</para>

    <para>In manchen Fällen gibt es kein entsprechendes Modul in
      <filename>/boot/kernel</filename>.  Dies gilt insbesondere für
      bestimmte Subsysteme.</para>
  </sect1>

 <sect1 xml:id="kernelconfig-devices">
    <info><title>Informationen über die vorhandene Hardware
      beschaffen</title>
      <!--
      <authorgroup>
	<author><personname><firstname>Tom</firstname><surname>Rhodes</surname></personname><contrib>Geschrieben von </contrib></author>
      </authorgroup>
      -->
    </info>

    

    <para>Bevor die Kernelkonfigurationsdatei bearbeitet wird, ist es
      empfehlenswert eine Bestandsaufnahme der Hardware des Systems
      durchzuführen.  Auf einem Dual-Boot-System können diese
      Informationen aus dem anderen Betriebssystem ermittelt werden.
      &microsoft;s <application>Gerätemanager</application> enthält
      beispielsweise Informationen über die installierte
      Hardware.</para>

    <note>
      <para>Einige Versionen von &microsoft.windows; verfügen
	über ein <application>System</application>-Icon auf
	dem Desktop, über das Sie den
	<application>Gerätemanager</application> direkt aufrufen
	können.</para>
    </note>

    <para>Wenn &os; das einzige installierte Betriebssystem ist, dann
      listet &man.dmesg.8; die Hardware auf, die während des
      Systemstarts gefunden wurde.  Die meisten &os;-Gerätetreiber
      haben eine eigene Manualpage, die Informationen über die
      unterstützte Hardware enthält.  Die folgenden Zeilen zeigen
      beispielsweise an, dass der &man.psm.4;-Treiber eine
      angeschlossene Maus gefunden hat:</para>

    <screen>psm0: &lt;PS/2 Mouse&gt; irq 12 on atkbdc0
psm0: [GIANT-LOCKED]
psm0: [ITHREAD]
psm0: model Generic PS/2 mouse, device ID 0</screen>

    <para>Da diese Hardware vorhanden ist, sollte dieser Treiber
      nicht aus einer angepassten Kernelkonfigurationsdatei entfernt
      werden.</para>

    <para>Wenn <command>dmesg</command> keine Informationen zur
      gefundenen Hardware anzeigt, können diese Informationen auch
      aus <filename>/var/run/dmesg.boot</filename> entnommen
      werden.</para>

    <para>Ein weiteres Werkzeug für die Suche nach Hardware ist
      &man.pciconf.8;, das ausführliche Informationen bereitstellt.
      Ein Beispiel:</para>

    <screen>&prompt.user; <userinput>pciconf -lv</userinput>
ath0@pci0:3:0:0:        class=0x020000 card=0x058a1014 chip=0x1014168c rev=0x01 hdr=0x00
    vendor     = 'Atheros Communications Inc.'
    device     = 'AR5212 Atheros AR5212 802.11abg wireless'
    class      = network
    subclass   = ethernet</screen>

    <para>Die Ausgabe zeigt, dass der Treiber <filename>ath</filename>
      eine drahtlose Ethernetkarte gefunden hat.</para>

    <para>Die Option <option>-k</option> von &man.man.1; kann
      verwendet werden, um nützliche Informationen zu erhalten.  Um
      beispielsweise eine Liste von Manualpages zu erhalten, welche
      ein spezifisches Wort enthalten:</para>

    <screen>&prompt.root; <userinput>man -k <replaceable>Atheros</replaceable></userinput></screen>

    <programlisting>ath(4)                   - Atheros IEEE 802.11 wireless network driver
ath_hal(4)               - Atheros Hardware Access Layer (HAL)</programlisting>

    <para>Mit einer Inventarliste der Hardware können Sie dann
      sicherstellen, dass Sie die Treiber der installierten Hardware
      nicht versehentlich entfernen, wenn Sie die
      Kernelkonfigurationsdatei bearbeiten.</para>
  </sect1>

  <sect1 xml:id="kernelconfig-config">
    <!--
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Joel</firstname>
	  <surname>Dahl</surname>
	  <contrib>Aktualisiert von </contrib>
	</author>
      </authorgroup>
    </sect1info>
    -->
    <title>Die Kernelkonfigurationsdatei</title>

    <para>Bevor eine angepasste Kernelkonfigurationsdatei erstellt
      werden kann, muss zuerst der vollständige &os; Quellcodebaum
      installiert werden.</para>

    <para>Falls <filename>/usr/src/</filename> nicht existiert oder
      leer ist, sind die Kernelquellen nicht installiert.  Die Quellen
      können mit <application>Subversion</application> und der
      Anleitung im <xref
	linkend="svn"/> installiert werden.</para>

    <para>Sobald die Quellen installiert sind, können Sie sich einen
      Überblick über <filename>/usr/src/sys</filename> verschaffen.
      Dieses Verzeichnis enthält eine Reihe von Unterverzeichnissen,
      einschließlich Verzeichnisse für die unterstützten Architekturen
      <filename>amd64</filename>, <filename>i386</filename>,
      <filename>ia64</filename>, <filename>pc98</filename>,
      <filename>powerpc</filename> und <filename>sparc64</filename>.
      Alles in diesen Verzeichnissen ist nur für die jeweilige
      Architektur relevant.  Der Rest des Codes ist machinenunabhängig
      und für alle Architekturen gleich.  Jede unterstützte
      Architektur hat ein Unterverzeichnis <filename>conf</filename>,
      das die <filename>GENERIC</filename> Kernelkonfigurationsdatei
      für diese Architektur enthält.</para>

    <para>Bearbeiten Sie <filename>GENERIC</filename> nicht direkt.
      Kopieren Sie stattdessen die Datei unter einem anderen Namen und
      machen dann die Änderungen an dieser Kopie.  Traditionell
      besteht der Name des Kernels immer aus Großbuchstaben.  Wenn Sie
      mehrere &os;-Maschinen mit unterschiedlicher Hardware betreuen,
      ist es eine gute Idee, die Konfigurationsdatei nach den
      Hostnamen der Maschinen zu benennen.  In diesem Beispiel wird
      eine Kopie der
      <filename>GENERIC</filename> Kernelkonfigurationsdatei, namens
      <filename>MYKERNEL</filename>, für die
      <filename>amd64</filename>-Architektur erstellt:</para>

    <screen>&prompt.root; <userinput>cd /usr/src/sys/<replaceable>amd64</replaceable>/conf</userinput>
&prompt.root; <userinput>cp GENERIC <replaceable>MYKERNEL</replaceable></userinput></screen>

    <para>Editieren Sie
      <filename><replaceable>MYKERNEL</replaceable></filename> mit
      einem Texteditor.  Der Standard-Editor ist
      <application>vi</application>, jedoch steht mit
      <application>ee</application> ein weiterer, einfach zu
      bedienender Editor bereit.</para>

    <indexterm>
      <primary>Kernel</primary>
      <secondary>NOTES</secondary>
    </indexterm>

    <indexterm>
      <primary>NOTES</primary>
    </indexterm>

    <indexterm>
      <primary>Kernel</primary>
      <secondary>Konfigurationsdatei</secondary>
    </indexterm>

    <para>Das Format der Konfigurationsdatei ist einfach.  Jede Zeile
      enthält ein Schlüsselwort, das ein Gerät oder ein Subsystem
      repräsentiert, ein Argument und eine kurze Beschreibung.
      Jeder Text, der hinter einem <literal>#</literal> steht, gilt
      als Kommentar und wird ignoriert.  Um die Kernel-Unterstützung
      für ein Gerät oder Subsystem zu entfernen, muss ein
      <literal>#</literal> an den Anfang der Zeile, die dieses Gerät
      oder Subsystem repräsentiert, gesetzt werden.  Verändern Sie
      keine Zeilen, die Sie nicht genau verstehen.</para>

    <para>Neben den Kurzbeschreibungen in dieser Datei, finden Sie
      zusätzliche Erklärungen in <filename>NOTES</filename>,
      die sich in demselben Verzeichnis wie
      <filename>GENERIC</filename> für die jeweilige Architektur
      befindet.  Von der Architektur unabhängige Optionen sind in
      <filename>/usr/src/sys/conf/NOTES</filename> aufgeführt.</para>

    <tip>
      <para>Wenn Sie die Kernelkonfigurationsdatei fertig bearbeitet
        haben, sollten Sie eine Sicherungskopie außerhalb von
	<filename>/usr/src</filename> speichern</para>

      <para>Alternativ kann die Kernelkonfigurationsdatei an anderer
      Stelle gespeichert, und ein symbolischer Link auf die Datei
      erstellt werden:</para>

      <screen>&prompt.root; <userinput>cd /usr/src/sys/amd64/conf</userinput>
&prompt.root; <userinput>mkdir /root/kernels</userinput>
&prompt.root; <userinput>cp GENERIC /root/kernels/MYKERNEL</userinput>
&prompt.root; <userinput>ln -s /root/kernels/MYKERNEL</userinput></screen>
    </tip>

    <para>Es ist möglich, eine <literal>include</literal>-Anweisung
      in die Kernelkonfigurationsdatei aufzunehmen.
      Diese erlaubt das lokale Einfügen von anderen Konfigurationsdateien
      in die aktuelle, was es einfacher macht, kleinere Änderungen an
      einer existierenden Datei zu vollziehen.  Wenn Sie einen
      <filename>GENERIC</filename>-Kernel mit nur einer kleinen Anzahl von
      zusätzlichen Optionen und Treibern benötigen, brauchen Sie
      mit den folgenden Zeilen nur ein kleines Delta im Vergleich zu GENERIC
      anpassen, wie in diesem Beispiel zu sehen:</para>

    <programlisting>include GENERIC
ident MYKERNEL

options         IPFIREWALL
options         DUMMYNET
options         IPFIREWALL_DEFAULT_TO_ACCEPT
options         IPDIVERT
</programlisting>

    <para>Diese Methode zeigt die Unterschiede der lokalen
      Konfigurationsdatei zu einem <filename>GENERIC</filename>-Kernel
      an.  Sobald Aktualisierungen durchgeführt werden, können neue
      Eigenschaften, die zu <filename>GENERIC</filename> hinzugefügt
      werden, auch dem lokalen Kernel angehängt werden, es sei denn,
      es wird durch <literal>nooptions</literal> oder
      <literal>nodevice</literal> unterbunden.  Eine umfassende Liste
      von Konfigurationseinstellungen und deren Beschreibungen finden
      Sie in &man.config.5;.</para>

    <note>
      <para>Um einen Kernel mit allen möglichen Optionen zu bauen,
	führen Sie als <systemitem class="username">root</systemitem>
	die folgenden Befehle aus:</para>

      <screen>&prompt.root; <userinput>cd /usr/src/sys/<replaceable>arch</replaceable>/conf &amp;&amp; make LINT</userinput></screen>
    </note>

    <!--
    <indexterm>
      <primary>Kerneloptionen</primary>
      <secondary>ident</secondary>
    </indexterm>

    This is outdated and specific to one architecture.

    <programlisting>ident          GENERIC</programlisting>

    <para>Dies ist der Name des Kernels.  Setzen Sie hier den Namen
      des neuen Kernels ein, beispielsweise
      <literal>MYKERNEL</literal>.  Der Wert von
      <literal>ident</literal> wird beim Booten des neuen Kernels
      ausgegeben.</para>

    <programlisting>makeoptions     DEBUG=-g          # Build kernel with gdb(1) debug symbols</programlisting>

    <para>Diese Option aktiviert Debugging-Informationen.</para>

    <programlisting>options          SCHED_ULE        # ULE scheduler</programlisting>

    <para>Der voreingestellte Scheduler von &os;.  Ändern Sie
      diesen Wert nicht!</para>

    <programlisting>options          INET              # InterNETworking</programlisting>

    <para>Netzwerkunterstützung.  Diese Option ist zwingend notwendig,
      da die meisten Programme mindestens auf die
      Loopback-Unterstützung angewiesen sind.</para>

    <programlisting>options          INET6             # IPv6 communications protocols</programlisting>

    <para>Aktiviert die Unterstützung für das IPv6
      Protokoll.</para>

    <programlisting>options          FFS               # Berkeley Fast Filesystem</programlisting>

    <para>Das Dateisystem für Festplatten.  Wenn das System von einer
      Festplatte bootet, lassen Sie diese Option aktiviert.</para>

    <programlisting>options          SOFTUPDATES       # Enable FFS Soft Updates support</programlisting>

    <para>Mit dieser Option wird die Unterstützung für Soft
      Updates, die Schreibzugriffe beschleunigen, in den Kernel
      eingebunden.  Auch wenn die Funktion im Kernel ist, muss
      sie für einzelne Dateisysteme explizit aktiviert werden.
      Überprüfen Sie mit &man.mount.8;, ob die Dateisysteme
      Soft Updates benutzen.  Wenn die Option
      <literal>soft-updates</literal> nicht in der Ausgabe erscheint,
      kann die Option nachträglich mit &man.tunefs.8; aktiviert
      werden.  Für neue Dateisysteme kann die Option beim Anlegen mit
      &man.newfs.8; aktiviert werden.</para>

    <programlisting>options          UFS_ACL           # Support for access control lists</programlisting>

    <para>Diese Option aktiviert die Unterstützung für
      Zugriffskontrolllisten (<acronym>ACL</acronym>).  Die
      <acronym>ACL</acronym>s hängen von erweiterten Attributen und
      <acronym>UFS2</acronym> ab, eine genaue Beschreibung finden Sie
      in <xref linkend="fs-acl"/>.  Die <acronym>ACL</acronym>s
      sind in der Voreinstellung aktiviert und sollten auch nicht
      deaktiviert werden, wenn sie schon einmal auf einem Dateisystem
      verwendet wurden, da dies die Zugriffsrechte auf Dateien in
      unvorhersehbarer Art und Weise ändern kann.</para>

    <programlisting>options          UFS_DIRHASH       # Improve performance on big directories</programlisting>

    <para>Diese Option steigert die Geschwindigkeit von Plattenzugriffen
      auf großen Verzeichnissen.  Dadurch verbraucht das System etwas
      mehr Speicher.  Für stark beschäftigte Server
      oder Arbeitsplatzrechner sollte diese Option aktiviert bleiben.
      Auf kleineren Systemen, bei denen Speicher eine kostbare Ressource
      darstellt oder Systemen, auf denen die Geschwindigkeit der
      Plattenzugriffe nicht wichtig ist, wie Firewalls, kann
      diese Option deaktiviert werden.</para>

    <programlisting>options          MD_ROOT           # MD is a potential root device</programlisting>

    <para>Diese Option aktiviert die Unterstützung für
      ein Root-Dateisystem auf einem speicherbasierten Laufwerk
      (RAM-Disk).</para>

    <indexterm>
      <primary>Kerneloptionen</primary>
      <secondary>NFS</secondary>
    </indexterm>

    <indexterm>
      <primary>Kerneloptionen</primary>
      <secondary>NFS_ROOT</secondary>
    </indexterm>

    <programlisting>options          NFSCLIENT         # Network Filesystem Client
options          NFSSERVER         # Network Filesystem Server
options          NFS_ROOT          # NFS usable as /, requires NFSCLIENT</programlisting>

    <para>Das Network File System (<acronym>NFS</acronym>).  Diese
      Zeilen können auskommentiert werden, wenn keine DOS-Partition
      beim Booten eingehängt werden soll.  Das nötige Modul wird
      ansonsten automatisch geladen, wenn das erste Mal eine
      DOS-Partition eingehängt wird.  Das Paket
      <package>emulators/mtools</package> erlaubt es, auf DOS-Floppies
      zuzugreifen, ohne diese an- und abhängen zu müssen.
      <literal>MSDOSFS</literal> wird in diesem Fall nicht
      benötigt.</para>

    <programlisting>options          CD9660            # ISO 9660 Filesystem</programlisting>

    <para>Das ISO 9660 Dateisystem für CD-ROMs.  Sie können diese
      Zeile auskommentieren, wenn das System kein CD-ROM-Laufwerk
      besitzt oder nur ab und an CDs eingehängt werden.  Das Modul wird automatisch
      geladen, sobald Sie das erste Mal eine CD einhängen.  Für
      Audio-CDs benötigen Sie dieses Dateisystem nicht.</para>

    <programlisting>options          PROCFS            # Process filesystem (requires PSEUDOFS)</programlisting>

    <para>Das Prozessdateisystem.  Dies ist ein Pseudo-Dateisystem,
      das auf <filename>/proc</filename> eingehangen wird und es
      einigen Programmen erlaubt, mehr Informationen über laufende Prozesse
      auszugeben.  <literal>PROCFS</literal> wird in den meisten
      Fällen nicht mehr benötigt werden, da die meisten Debug- und
      Überwachungs-Werkzeuge nicht mehr darauf angewiesen sind.
      Die Basisinstallation wird dieses Dateisystem standardmäßig
      nicht automatisch einhängen.</para>

    <programlisting>options          PSEUDOFS          # Pseudo-filesystem framework</programlisting>

    <para>Kernel, die <literal>PROCFS</literal> verwenden, müssen
      auch die Option <literal>PSEUDOFS</literal> verwenden.</para>

    <programlisting>options          GEOM_PART_GPT          # GUID Partition Tables.</programlisting>

    <para>Fügt Unterstützung für <link
	xlink:href="http://en.wikipedia.org/wiki/GUID_Partition_Table">GUID
	Partition Tables</link> (<acronym>GPT</acronym>) hinzu.  GPT
      bietet die Möglichkeit, eine große Anzahl von Partitionen pro
      Platte, 128 in der Standardkonfiguration, zu haben.</para>

<programlisting>options          COMPAT_43         # Compatible with BSD 4.3 [KEEP THIS!]</programlisting>

    <para>Stellt die Kompatibilität zu 4.3BSD sicher.  Belassen Sie
      diese Option, da sich manche Programme recht sonderbar verhalten
      werden, wenn Sie diese auskommentieren.</para>

    <programlisting>options          COMPAT_FREEBSD4   # Compatible with FreeBSD4</programlisting>

    <para>Diese Option stellt sicher, dass Anwendungen, die auf
      älteren Versionen von &os; übersetzt wurden und alte
      Systemaufrufe verwenden, noch lauffähig sind.  Es wird
      empfohlen, diese Option auf allen &i386;-Systemen zu verwenden,
      auf denen vielleicht noch ältere Anwendungen laufen sollen.
      Auf Plattformen, die erst ab &os;&nbsp;4.X unterstützt werden,
      wie beispielsweise ia64 und &sparc;, wird diese Option nicht
      benötigt.</para>

    <programlisting>options          COMPAT_FREEBSD5   # Compatible with &os;5</programlisting>

    <para>Diese Option wird benötigt, um Programme, die unter
      &os;&nbsp;5.X-Versionen mit &os;&nbsp;5.X-Systemaufrufen
      kompiliert wurden, auszuführen.</para>

    <programlisting>options          COMPAT_FREEBSD6   # Compatible with &os;6</programlisting>

    <para>Diese Option wird benötigt, um Programme, die unter
      &os;&nbsp;6.X-Versionen mit &os;&nbsp;6.X-Systemaufrufen
      kompiliert wurden, auszuführen.</para>

    <programlisting>options          COMPAT_FREEBSD7   # Compatible with &os;7</programlisting>

    <para>Diese Option benötigt, um Programme, die unter
      &os;&nbsp;7.X-Versionen mit &os;&nbsp;7.X-Systemaufrufen
      kompiliert wurden, auszuführen.</para>

    <programlisting>options          SCSI_DELAY=5000  # Delay (in ms) before probing SCSI</programlisting>

    <para>Dies weist den Kernel an, 5&nbsp;Sekunden zu warten, bevor
      nach <acronym>SCSI</acronym>-Geräten auf dem System gesucht
      wird.  Wenn die <acronym>SCSI</acronym>-Geräte nicht gefunden
      werden, sollte der Wert erhöht werden.  Falls das System keine
      <acronym>SCSI</acronym>-Geräte enthält, kann dieser Wert
      ignoriert oder gesenkt werden, um den Startvorgang zu
      beschleunigen.</para>

    <programlisting>options          KTRACE            # ktrace(1) support</programlisting>

    <para>Dies schaltet die Kernel-Prozessverfolgung
      (engl. <foreignphrase>kernel process tracing</foreignphrase>) ein,
      die sehr nützlich bei der Fehlersuche ist.</para>

    <programlisting>options          SYSVSHM           # SYSV-style shared memory</programlisting>

    <para>Diese Option aktiviert die Unterstützung für
      System&nbsp;V Shared-Memory.  Die XSHM-Erweiterung von X
      benötigt diese Option und viele Graphik-Programme
      werden die Erweiterung automatisch benutzen und schneller
      laufen.  Wenn <application>Xorg</application> installiert ist,
      sollte diese Option aktiviert werden.</para>

    <programlisting>options          SYSVMSG           # SYSV-style message queues</programlisting>

    <para>Unterstützung für System&nbsp;V Messages.
      Diese Option vergrößert den Kernel nur um
      einige hundert Bytes.</para>

    <programlisting>options          SYSVSEM           # SYSV-style semaphores</programlisting>

    <para>Unterstützung für System&nbsp;V Semaphoren.
      Dies wird selten gebraucht, vergrößert aber den
      Kernel nur um einige hundert Bytes.</para>

    <note>
      <para>Die Nutzung von <option>-p</option> mit
	&man.ipcs.1; zeigt Programme an, die diese System&nbsp;V
	Erweiterungen benutzen.</para>
    </note>

    <programlisting>options 	     _KPOSIX_PRIORITY_SCHEDULING # POSIX P1003_1B real-time extensions</programlisting>

    <para>Echtzeit-Erweiterungen, die 1993 zu &posix;
      hinzugefügt wurden.  Bestimmte Programme benutzen
      diese Erweiterungen.</para>

    <programlisting>options          KBD_INSTALL_CDEV  # install a CDEV entry in /dev</programlisting>

    <para>Diese Option erstellt für die Tastatur einen
      Eintrag in <filename>/dev</filename>.</para>

    <indexterm>
      <primary>Kerneloptionen</primary>
      <secondary>SMP</secondary>
    </indexterm>

    <programlisting>device          apic               # I/O APIC</programlisting>

    <para>Dieses Gerät ermöglicht die Benutzung des I/O APIC für die
      Interrupt-Auslieferung.  Es kann mit Kerneln für
      Einprozessorsysteme und Mehrprozessorsysteme benutzt
      werden.  Kernel für Mehrprozessorsysteme benötigen
      diese Option zwingend.  Die Unterstützung für
      Mehrprozessorsysteme wird mit <literal>options SMP</literal>
      aktiviert.</para>

    <note>
      <para>Dieses Gerät existiert nur unter der &i386;-Architektur.
        Die Konfigurationszeile sollte daher nicht für andere
	Architekturen aufgenommen werden.</para>
    </note>

    <programlisting>device          eisa</programlisting>

    <para>Fügen Sie diese Zeile ein, wenn das System ein
      EISA-Motherboard besitzt.  Dies aktiviert die Erkennung und
      Konfiguration von allen Geräten auf dem EISA-Bus.</para>

    <programlisting>device          pci</programlisting>

    <para>Wenn das System ein PCI-Motherboard besitzen, fügen Sie
      diese Zeile ein.  Dies aktiviert die Erkennung von PCI-Karten
      und die PCI-ISA bridge.</para>

    <programlisting># Floppy drives
device          fdc</programlisting>

    <para>Der Floppy-Controller.</para>

    <programlisting># ATA and ATAPI devices
device          ata</programlisting>

    <para>Dieser Treiber unterstützt alle ATA- und ATAPI-Geräte.
      Eine <literal>device ata</literal> Zeile reicht aus, und der
      Kernel wird auf modernen Maschinen alle PCI ATA/ATAPI Geräte
      entdecken.</para>

    <programlisting>device          atadisk                 # ATA disk drives</programlisting>

    <para>Für ATA-Plattenlaufwerke brauchen Sie diese Zeile zusammen
      mit <literal>device ata</literal>.</para>

    <programlisting>device          ataraid                 # ATA RAID drives</programlisting>

    <para>Für ATA-RAID brauchen Sie diese Zeile zusammen
      mit <literal>device ata</literal>.</para>

    <programlisting><anchor xml:id="kernelconfig-atapi"/>
device          atapicd                 # ATAPI CDROM drives</programlisting>

    <para>Zusammen mit <literal>device ata</literal> wird dies für
      ATAPI CD-ROM Laufwerke benötigt.</para>

    <programlisting>device          atapifd                 # ATAPI floppy drives</programlisting>

    <para>Zusammen mit <literal>device ata</literal> wird dies für
      ATAPI Floppy Laufwerke benötigt.</para>

    <programlisting>device          atapist                 # ATAPI tape drives</programlisting>

    <para>Zusammen mit <literal>device ata</literal> wird dies für
      ATAPI Bandlaufwerke benötigt.</para>

    <programlisting>options         ATA_STATIC_ID           # Static device numbering</programlisting>

    <para>Erzwingt eine statische Gerätenummer für
      den Controller.  Ohne diese Option werden die Nummern
      dynamisch zugeteilt.</para>

    <programlisting># SCSI Controllers
device          ahb        # EISA AHA1742 family
device          ahc        # AHA2940 and onboard AIC7xxx devices
options         AHC_REG_PRETTY_PRINT     # Print register bitfields in debug
                                         # output.  Adds ~128k to driver.
device          ahd        # AHA39320/29320 and onboard AIC79xx devices
options         AHD_REG_PRETTY_PRINT     # Print register bitfields in debug
                                         # output.  Adds ~215k to driver.
device          amd        # AMD 53C974 (Teckram DC-390(T))
device          isp        # Qlogic family
#device         ispfw      # Firmware for QLogic HBAs- normally a module
device          mpt        # LSI-Logic MPT-Fusion
#device         ncr        # NCR/Symbios Logic
device          sym        # NCR/Symbios Logic (newer chipsets + those of `ncr'))
device          trm        # Tekram DC395U/UW/F DC315U adapters

device          adv        # Advansys SCSI adapters
device          adw        # Advansys wide SCSI adapters
device          aha        # Adaptec 154x SCSI adapters
device          aic        # Adaptec 15[012]x SCSI adapters, AIC-6[23]60.
device          bt         # Buslogic/Mylex MultiMaster SCSI adapters

device          ncv        # NCR 53C500
device          nsp        # Workbit Ninja SCSI-3
device          stg        # TMC 18C30/18C50</programlisting>

    <para>Kommentieren Sie in diesem Abschnitt alle Controller aus,
      die sich nicht im System befinden.  Für IDE-Systeme können alle
      Einträge entfernt werden.  Die Zeilen mit den
      <literal>*_REG_PRETTY_PRINT</literal>-Einträgen aktivieren
      Debugging-Optionen für die jeweiligen Treiber.</para>

    <programlisting># SCSI peripherals
device          scbus      # SCSI bus (required for SCSI)
device          ch         # SCSI media changers
device          da         # Direct Access (disks)
device          sa         # Sequential Access (tape etc)
device          cd         # CD
device          pass       # Passthrough device (direct SCSI access)
device          ses        # SCSI Environmental Services (and SAF-TE)</programlisting>

    <para>Kommentieren Sie alle Geräte aus, die sich nicht im System
      befinden.  Wenn das System nur IDE-Hardware enthält, können alle
      Einträge entfernt werden.</para>

    <note>
      <para>Der USB-&man.umass.4;-Treiber und einige andere
	Treiber benutzen das SCSI-Subsystem obwohl sie keine
	SCSI-Geräte sind.  Belassen Sie die SCSI-Unterstützung
	im Kernel, wenn Sie solche Treiber verwenden.</para>
    </note>

    <programlisting># RAID controllers interfaced to the SCSI subsystem
device          amr        # AMI MegaRAID
device          arcmsr     # Areca SATA II RAID
device          asr        # DPT SmartRAID V, VI and Adaptec SCSI RAID
device          ciss       # Compaq Smart RAID 5*
device          dpt        # DPT Smartcache III, IV - See NOTES for options
device          hptmv      # Highpoint RocketRAID 182x
device          hptrr      # Highpoint RocketRAID 17xx, 22xx, 23xx, 25xx
device          iir        # Intel Integrated RAID
device          ips        # IBM (Adaptec) ServeRAID
device          mly        # Mylex AcceleRAID/eXtremeRAID
device          twa        # 3ware 9000 series PATA/SATA RAID

# RAID controllers
device          aac        # Adaptec FSA RAID
device          aacp       # SCSI passthrough for aac (requires CAM)
device          ida        # Compaq Smart RAID
device          mfi        # LSI MegaRAID SAS
device          mlx        # Mylex DAC960 family
device          pst        # Promise Supertrak SX6000
device          twe        # 3ware ATA RAID</programlisting>

    <para>Unterstützte RAID Controller.  Wenn das System keinen der
      aufgeführten Controller besitzt, können die Einträge entfernt
      oder auskommentiert werden.</para>

    <programlisting># atkbdc0 controls both the keyboard and the PS/2 mouse
device          atkbdc     # AT keyboard controller</programlisting>

    <para>Der <literal>atkbdc</literal> Tastatur-Controller ist für
      die Ein- und Ausgabe von AT-Tastaturen und PS/2 Zeigegeräten
      verantwortlich.  Dieser Controller wird von &man.atkbd.4; und
      &man.psm.4; benötigt.</para>

    <programlisting>device          atkbd      # AT keyboard</programlisting>

    <para>Zusammen mit dem &man.atkbdc.4; Controller bietet der
      &man.atkbd.4; Treiber Zugriff auf AT-Tastaturen.</para>

    <programlisting>device          psm        # PS/2 mouse</programlisting>

    <para>Benutzen Sie dieses Gerät, wenn die Maus einen
      PS/2-Anschluss besitzt.</para>

    <programlisting>device          kbdmux        # keyboard multiplexer</programlisting>

    <para>Basisunterstützung für Tastaturmultiplexer.
      Wenn das System nur über eine Tastatur verfügt, kann diese Zeile
      aus der Kernelkonfigurationsdatei entfernt werden.</para>

    <programlisting>device          vga        # VGA video card driver</programlisting>

    <para>Der Grafikkartentreiber.</para>

    <programlisting>device          splash     # Splash screen and screen saver support</programlisting>

    <para>Diese Zeile wird für den <quote>Splash Screen</quote> beim
      Booten und von Bildschirmschonern benötigt.</para>

    <programlisting># syscons is the default console driver, resembling an SCO console
device          sc</programlisting>

    <para>&man.sc.4; ist in der Voreinstellung der Treiber
      für die Konsole, die der SCO-Konsole ähnelt.  Da die
      meisten bildschirmorientierten Programme auf die Konsole mit Hilfe
      einer Datenbank wie <filename>termcap</filename> zugreifen, sollte es
      keine Rolle spielen, ob dieser Treiber oder
      <literal>vt</literal>, der <literal>VT220</literal> kompatible
      Konsolentreiber eingesetzt wird.  Sollten Probleme mit
      bildschirmorientierten Anwendungen unter dieser Konsole
      auftreten, kann bei der Benutzeranmeldung die Variable
      <envar>TERM</envar> auf den Wert <literal>VT220</literal>
      gesetzt werden.</para>

    <programlisting># Enable this for the pcvt (VT220 compatible) console driver
#device          vt
#options         XSERVER          # support for X server on a vt console
#options         FAT_CURSOR       # start with block cursor</programlisting>

    <para>Der VT220 kompatible Konsolentreiber ist kompatibel zu VT100/102.
      Auf einigen Laptops, die aufgrund der Hardware inkompatibel zum
      <literal>sc</literal> Treiber sind, funktioniert dieser Treiber gut.
      Anwender sollten die Variable <envar>TERM</envar> auf den
      Wert <literal>vt100</literal> setzen.  Dieser Treiber ist
      sinnvoll, wenn eine Verbindung zu einer großen Anzahl von
      verschiedenen Maschinen über das Netzwerk besteht und dort die
      Einträge in <literal>termcap</literal> oder
      <literal>terminfo</literal> für das <literal>sc</literal>-Gerät
      fehlen.  <literal>vt100</literal> sollte dagegen auf jeder
      Plattform unterstützt werden.</para>

    <programlisting>device          agp</programlisting>

    <para>Fügen Sie diese Zeile ein, wenn das System eine AGP-Karte
      besitzt.  Damit wird die Unterstützung für Motherboards mit AGP
      und AGP GART aktiviert.</para>

    <programlisting># Add suspend/resume support for the i8254.
device           pmtimer</programlisting>

    <para>Zeitgeber für Ereignisse der Energieverwaltung
      (APM und ACPI).</para>

    <programlisting># PCCARD (PCMCIA) support
# PCMCIA and cardbus bridge support
device          cbb               # cardbus (yenta) bridge
device          pccard            # PC Card (16-bit) bus
device          cardbus           # CardBus (32-bit) bus</programlisting>

    <para>PCMCIA Unterstützung. Behalten Sie diese Zeilen auf
      Laptop-Systemen.</para>

    <programlisting># Serial (COM) ports
device          sio               # 8250, 16[45]50 based serial ports</programlisting>

    <para>Die seriellen Schnittstellen, die unter &windows;
      <filename>COM</filename> genannt werden.</para>

    <note>
      <para>Wenn das System ein internes Modem auf
	<filename>COM4</filename> benutzt, und eine serielle
	Schnittstelle auf <filename>COM2</filename>, muss der
	der IRQ des Modems auf 2 gesetzt werden.  Für eine
	serielle Multiport-Karte, entnehmen Sie bitte
	die Werte, die in <filename>/boot/device.hints</filename>
	eingefügt werden müssen, aus der Manualpage &man.sio.4;.
	Einige Graphikkarten, besonders die auf S3-Chips basierten,
	benutzen IO-Adressen der Form <literal>0x*2e8</literal> und
	manche billige serielle Karten dekodieren den 16-Bit
	IO-Adressraum nicht sauber.  Dies führt zu Konflikten und
	blockiert dann die
	<filename>COM4</filename>-Schnittstelle.</para>

      <para>Jeder seriellen Schnittstelle muss ein eigener IRQ
	zugewiesen werden,  wobei in der Voreinstellung
	<filename>COM3</filename> und <filename>COM4</filename> nicht
	verwendet werden können.  Die Ausnahme sind Multiport-Karten,
	welche gemeinsam genutzte Interrupts unterstützen.</para>
    </note>

    <programlisting># Parallel port
device          ppc</programlisting>

    <para>Dies ist die parallele Schnittstelle auf dem ISA Bus.</para>

    <programlisting>device          ppbus      # Parallel port bus (required)</programlisting>

    <para>Bietet Unterstützung für den Bus auf der parallelen
      Schnittstelle.</para>

    <programlisting>device          lpt        # Printer</programlisting>

    <para>Bietet Unterstützung für Drucker über die parallele
      Schnittstelle.</para>

    <note>
      <para>Sie brauchen jede der drei Zeilen, um die Unterstützung
        für einen Drucker an der parallelen Schnittstelle zu
	aktivieren.</para>
    </note>

    <programlisting>device          ppi        # Parallel port interface device</programlisting>

    <para>Allgemeine I/O (<quote>geek port</quote>) und IEEE1284 I/O
      Unterstützung.</para>

    <programlisting>#device         vpo        # Requires scbus and da</programlisting>

    <indexterm><primary>Zip Laufwerk</primary></indexterm>

    <para>Dies aktiviert den Treiber für ein Iomega Zip Laufwerk.
      Zusätzlich benötigen Sie noch die Unterstützung
      für <literal>scbus</literal> und <literal>da</literal>.  Die
      beste Performance erzielen Sie, wenn Sie die Schnittstelle im EPP 1.9
      Modus betreiben.</para>

    <programlisting>#device         puc</programlisting>

    <para>Aktivieren Sie diesen Treiber, wenn das System eine serielle
      oder parallele PCI-Karte besitzt, die vom Treiber
      &man.puc.4; unterstützt wird.</para>

    <programlisting># PCI Ethernet NICs.
device          de         # DEC/Intel DC21x4x (<quote>Tulip</quote>)
device          em         # Intel PRO/1000 adapter Gigabit Ethernet Card
device          ixgb       # Intel PRO/10GbE Ethernet Card
device          txp        # 3Com 3cR990 (<quote>Typhoon</quote>)
device          vx         # 3Com 3c590, 3c595 (<quote>Vortex</quote>)</programlisting>

    <para>Verschiedene Treiber für PCI-Netzwerkkarten.  Geräte,
      die sich nicht im System befinden, können entfernt oder
      auskommentiert werden.</para>

    <programlisting># PCI Ethernet NICs that use the common MII bus controller code.
# NOTE: Be sure to keep the 'device miibus' line in order to use these NICs!
device          miibus     # MII bus support</programlisting>

    <para>Einige PCI 10/100 Ethernet Netzwerkkarten, besonders die, die
      MII-fähige Transceiver verwenden oder Transceiver-Steuerungen
      implementieren, die ähnlich wie MII funktionieren,
      benötigen die Unterstützung für den MII-Bus.  Die
      Zeile <literal>device miibus</literal> fügt dem Kernel die
      Unterstützung für das allgemeine miibus API und allen
      PHY-Treibern hinzu.</para>

    <programlisting>device          bce        # Broadcom BCM5706/BCM5708 Gigabit Ethernet
device          bfe        # Broadcom BCM440x 10/100 Ethernet
device          bge        # Broadcom BCM570xx Gigabit Ethernet
device          dc         # DEC/Intel 21143 and various workalikes
device          fxp        # Intel EtherExpress PRO/100B (82557, 82558)
device          lge        # Level 1 LXT1001 gigabit ethernet
device          msk        # Marvell/SysKonnect Yukon II Gigabit Ethernet
device          nge        # NatSemi DP83820 gigabit ethernet
device          nve        # nVidia nForce MCP on-board Ethernet Networking
device          pcn        # AMD Am79C97x PCI 10/100 (precedence over 'lnc')
device          re         # RealTek 8139C+/8169/8169S/8110S
device          rl         # RealTek 8129/8139
device          sf         # Adaptec AIC-6915 (<quote>Starfire</quote>)
device          sis        # Silicon Integrated Systems SiS 900/SiS 7016
device          sk         # SysKonnect SK-984x &amp; SK-982x gigabit Ethernet
device          ste        # Sundance ST201 (D-Link DFE-550TX)
device          stge       # Sundance/Tamarack TC9021 gigabit Ethernet
device          ti         # Alteon Networks Tigon I/II gigabit Ethernet
device          tl         # Texas Instruments ThunderLAN
device          tx         # SMC EtherPower II (83c170 <quote>EPIC</quote>)
device          vge        # VIA VT612x gigabit ethernet
device          vr         # VIA Rhine, Rhine II
device          wb         # Winbond W89C840F
device          xl         # 3Com 3c90x (<quote>Boomerang</quote>, <quote>Cyclone</quote>)</programlisting>

    <para>Treiber, die den MII Bus Controller Code benutzen.</para>

    <programlisting># ISA Ethernet NICs.  pccard NICs included.
device          cs         # Crystal Semiconductor CS89x0 NIC
# 'device ed' requires 'device miibus'
device          ed         # NE[12]000, SMC Ultra, 3c503, DS8390 cards
device          ex         # Intel EtherExpress Pro/10 and Pro/10+
device          ep         # Etherlink III based cards
device          fe         # Fujitsu MB8696x based cards
device          ie         # EtherExpress 8/16, 3C507, StarLAN 10 etc.
device          lnc        # NE2100, NE32-VL Lance Ethernet cards
device          sn         # SMC's 9000 series of Ethernet chips
device          xe         # Xircom pccard Ethernet

# ISA devices that use the old ISA shims
#device         le</programlisting>

    <para>Treiber für ISA Ethernet Karten.  Schauen Sie in
      <filename>/usr/src/sys/<replaceable>arch</replaceable>/conf/NOTES</filename>
      nach, um zu sehen, welche Karte von welchem Treiber
      unterstützt wird.</para>

    <programlisting># Wireless NIC cards
device          wlan       # 802.11 support</programlisting>

    <para>Generische 802.11-Unterstützung.  Diese Zeile wird
      unbedingt benötigt, wenn Sie WLAN nutzen wollen.</para>

    <programlisting>device          wlan_wep        # 802.11 WEP support
device          wlan_ccmp       # 802.11 CCMP support
device          wlan_tkip       # 802.11 TKIP support</programlisting>

    <para>Krypto-Unterstützung für 802.11-Geräte. Diese Zeilen werden
      auf Systemen benötigt, die Verschlüsselung und die
      802.11-Sicherheitsprotokolle einsetzen.</para>

    <programlisting>device          an              # Aironet 4500/4800 802.11 wireless NICs
device          ath             # Atheros pci/cardbus NIC's
device          ath_hal         # Atheros HAL (Hardware Access Layer)
device          ath_rate_sample # SampleRate tx rate control for ath
device          awi        # BayStack 660 and others
device          ral        # Ralink Technology RT2500 wireless NICs.
device          wi         # WaveLAN/Intersil/Symbol 802.11 wireless NICs.
#device         wl         # Older non 802.11 Wavelan wireless NIC.</programlisting>

    <para>Treiber für drahtlose Netzwerkkarten (WLAN).</para>

    <programlisting># Pseudo devices
device   loop          # Network loopback</programlisting>

    <para>Das TCP/IP Loopback Device.  Diese Angabe
      ist <emphasis>verpflichtend</emphasis>.</para>

    <programlisting>device   random        # Entropy device</programlisting>

    <para>Kryptographisch sicherer Zufallszahlengenerator.</para>

    <programlisting>device   ether         # Ethernet support</programlisting>

    <para><literal>ether</literal> wird nur benötigt, wenn das System
      eine Ethernetkarte besitzt.  Der Treiber unterstützt das
      Ethernet-Protokoll.</para>

    <programlisting>device   sl            # Kernel SLIP</programlisting>

    <para><literal>sl</literal> aktiviert die SLIP-Unterstützung.
      SLIP ist fast vollständig von PPP verdrängt
      worden, da letzteres leichter zu konfigurieren, besser
      geeignet für Modem zu Modem Kommunikation und
      mächtiger ist.</para>

    <programlisting>device   ppp           # Kernel PPP</programlisting>

    <para>Dies ist Kernel Unterstützung für
      PPP-Wählverbindungen.  Es existiert auch eine
      PPP-Version im Userland, die den <literal>tun</literal>
      Treiber benutzt.  Die Userland-Version ist flexibler
      und bietet mehr Option wie die Wahl auf Anforderung.</para>

    <programlisting>device   tun           # Packet tunnel.</programlisting>

    <para>Dies wird vom der Userland PPP benutzt.  Die
      <replaceable>Zahl</replaceable> hinter <literal>tun</literal> gibt
      die Anzahl der unterstützten gleichzeitigen Verbindungen an.
      Weitere Informationen finden Sie im Abschnitt
      <link linkend="userppp">PPP</link>
      dieses Handbuchs.</para>

    <programlisting><anchor xml:id="kernelconfig-ptys"/>
device   pty           # Pseudo-ttys (telnet etc)</programlisting>

    <para>Dies ist ein <quote>Pseudo-Terminal</quote> oder simulierter
      Login-Terminal.  Er wird von einkommenden <command>telnet</command>
      und <command>rlogin</command> Verbindungen,
      <application>xterm</application> und anderen Anwendungen wie
      <application>Emacs</application> benutzt.</para>

    <programlisting>device   md            # Memory <quote>disks</quote></programlisting>

    <para>Pseudo-Gerät für Speicher-Laufwerke.</para>

    <programlisting>device   gif           # IPv6 and IPv4 tunneling</programlisting>

    <para>Dieses Gerät tunnelt IPv6 über IPv4, IPv4 über
      IPv6, IPv4 über IPv4 oder IPv6 über IPv6.
      Das Gerät <literal>gif</literal> kann die Anzahl der
      benötigten Geräte automatisch bestimmen
      (<quote>auto-cloning</quote>).</para>

    <programlisting>device   faith         # IPv6-to-IPv4 relaying (translation)</programlisting>

    <para>Dieses Pseudo-Gerät fängt zu ihm gesendete Pakete ab
      und leitet Sie zu einem D&aelig;mon weiter, der Verkehr zwischen IPv4
      und IPv6 vermittelt.</para>

    <programlisting># The `bpf' device enables the Berkeley Packet Filter.
# Be aware of the administrative consequences of enabling this!
# Note that 'bpf' is required for DHCP.
device   bpf           # Berkeley packet filter</programlisting>

    <para>Der Berkeley Paketfilter.  Dieses Pseudo-Gerät kann
      Netzwerkkarten in den <quote>promiscuous</quote> Modus setzen und
      erlaubt es damit, Pakete auf einem Broadcast Netzwerk, wie
      beispielsweise Ethernet, einzufangen.  Diese Pakete können auf der Festplatte
      gespeichert und mit &man.tcpdump.1; untersucht werden.</para>

    <note>
      <para>Das &man.bpf.4;-Gerät wird auch von &man.dhclient.8;
	genutzt.  Wenn DHCP benutzt wird, lassen Sie diese Option
	bitte aktiviert.</para>
    </note>

    <programlisting># USB support
device          uhci          # UHCI PCI-&gt;USB interface
device          ohci          # OHCI PCI-&gt;USB interface
device          ehci          # EHCI PCI-&gt;USB interface (USB 2.0)
device          usb           # USB Bus (required)
#device         udbp          # USB Double Bulk Pipe devices
device          ugen          # Generic
device          uhid          # <quote>Human Interface Devices</quote>
device          ukbd          # Keyboard
device          ulpt          # Printer
device          umass         # Disks/Mass storage - Requires scbus and da
device          ums           # Mouse
device          ural          # Ralink Technology RT2500USB wireless NICs
device          urio          # Diamond Rio 500 MP3 player
device          uscanner      # Scanners
# USB Ethernet, requires mii
device          aue           # ADMtek USB Ethernet
device          axe           # ASIX Electronics USB Ethernet
device          cdce          # Generic USB over Ethernet
device          cue           # CATC USB Ethernet
device          kue           # Kawasaki LSI USB Ethernet
device          rue           # RealTek RTL8150 USB Ethernet</programlisting>

    <para>Unterstützung für verschiedene USB Geräte.</para>

    <programlisting># FireWire support
device          firewire      # FireWire bus code
device          sbp           # SCSI over FireWire (Requires scbus and da)
device          fwe           # Ethernet over FireWire (non-standard!)</programlisting>

    <para>Verschiedene Firewire-Geräte.</para>

    <para>Mehr Informationen und weitere von &os; unterstützte
      Geräte entnehmen Sie bitte
      <filename>/usr/src/sys/<replaceable>arch</replaceable>/conf/NOTES</filename>.</para>
      -->


    <!--
    This section refers to ancient hardware.
    <sect2>
      <title>Hohe Speicheranforderungen
	(<acronym>PAE</acronym>)</title>

      <indexterm>
	<primary>Physical Address Extensions (<acronym>PAE</acronym>)</primary>
	<secondary>hohe Speicheranforderungen</secondary>
      </indexterm>

      <para>Systeme mit hohen Speicheranforderungen benötigen
	mehr Speicher als den auf 4&nbsp;Gigabyte beschränkten
	User- und Kernel-Adressraum (<acronym>KVA</acronym>).
	Mit dem &pentium;&nbsp;Pro und neueren CPUs hat
	Intel den Adressraum auf 36-Bit erweitert.</para>

      <para>Die Physical-Address-Extension (<acronym>PAE</acronym>)
	von &intel;s &pentium;&nbsp;Pro und neueren Prozessoren
	unterstützt bis zu 64&nbsp;Gigabyte Speicher.
	&os; kann diesen Speicher mit der Option <option>PAE</option>
	in der Kernelkonfiguration nutzen.  Die Option gibt es
	in allen aktuellen &os;-Versionen.  Wegen Beschränkungen der
	Intel-Speicherarchitektur wird keine Unterscheidung
	zwischen Speicher oberhalb oder unterhalb von 4&nbsp;Gigabyte
	getroffen.  Speicher über 4&nbsp;Gigabyte wird
	einfach in den Pool des zur Verfügung stehenden Speichers
	aufgenommen.</para>

      <para>Um die <acronym>PAE</acronym> Kernel-Unterstützung zu
	aktivieren, fügen Sie folgende Zeile zur Kernelkonfiguration
	hinzu:</para>

      <programlisting>options		    PAE</programlisting>

      <note>
	<para>&os; unterstützt <acronym>PAE</acronym> nur
	  auf IA-32 Prozessoren.  Die
	  <acronym>PAE</acronym>-Unterstützung wurde
	  zudem noch nicht hinreichend getestet und befindet
	  sich im Vergleich zu anderen Komponenten von &os; noch
	  im Beta-Stadium.</para>
      </note>

      <para>Die <acronym>PAE</acronym>-Unterstützung in &os;
	  ist mit den nachstehenden Einschränkungen verbunden:</para>

      <itemizedlist>
	<listitem>
	  <para>Ein Prozess kann nicht mehr als 4&nbsp;Gigabyte
	    virtuellen Speicher benutzen.</para>
	</listitem>

	<listitem>
	  <para>Gerätetreiber, die nicht die
	    &man.bus.dma.9;-Schnittstelle benutzen, führen
	    zusammen mit einem <acronym>PAE</acronym>-Kernel zu
	    Datenverlusten.  Diese Treiber sollen nicht mit
	    einem <acronym>PAE</acronym>-Kernel verwendet werden.
	    Daher gibt es unter &os; eine zusätzliche
	    <acronym>PAE</acronym>-Kernelkonfigurationsdatei,
	    die alle Treiber enthält, die mit einem
	    <acronym>PAE</acronym>-Kernel funktionieren.</para>
	</listitem>

	<listitem>
	  <para>Einige Systemvariablen werden abhängig von
	    der Speichergröße eingestellt.  In einem
	    <acronym>PAE</acronym>-System mit viel Speicher
	    können die Werte daher zu hoch eingestellt sein.
	    Ein Beispiel ist die sysctl-Variable
	    <option>kern.maxvnodes</option>, die die maximale
	    Anzahl von vnodes im Kernel bestimmt.  Solche
	    Variablen sollten auf einen angemessenen Wert
	    eingestellt werden.</para>
	</listitem>

	<listitem>
	  <para>Es kann erforderlich sein, den virtuellen Adressraum
	    des Kernels (<acronym>KVA</acronym>) zu vergrößern
	    oder, den Wert einer häufig
	    gebrauchten Kernelvariablen zu verringern.  Dies
	    verhindert einen Überlauf des <acronym>KVA</acronym>s.
	    Der Adressraum des Kernels kann mit der Kerneloption
	    <option>KVA_PAGES</option> vergrößert
	    werden.</para>
	</listitem>
      </itemizedlist>

      <para>Hinweise zur Leistungssteigerung und Stabilität
	entnehmen Sie &man.tuning.7;. &man.pae.4; enthält aktuelle
	Informationen über die <acronym>PAE</acronym>-Unterstützung
	von &os;.</para>
    </sect2>
    -->
  </sect1>

  <sect1 xml:id="kernelconfig-building">
    <title>Einen angepassten Kernel bauen und installieren</title>

    <para>Nachdem die Änderungen an der angepassten
      Kernelkonfigurationsdatei gespeichert sind, kann der Quellcode
      für den Kernel mit den folgenden Schritten übersetzt
      werden:</para>

    <procedure>
      <title>Einen Kernel bauen</title>

      <indexterm>
	<primary>Kernel</primary>
	<secondary>bauen / installieren</secondary>
      </indexterm>

      <step>
	<para>Wechseln Sie das Verzeichnis:</para>

	<screen>&prompt.root; <userinput>cd /usr/src</userinput></screen>
      </step>

      <step>
	<para>Bauen Sie den Kernel, indem Sie den Namen der
	  Kernelkonfigurationsdatei angeben:</para>

	<screen>&prompt.root; <userinput>make buildkernel KERNCONF=<replaceable>MYKERNEL</replaceable></userinput></screen>
      </step>

      <step>
	<para>Installieren Sie den neuen Kernel.  Dieser Befehl wird
	  den neuen Kernel nach
	  <filename>/boot/kernel/kernel</filename> kopieren, und den
	  alten Kernel nach
	  <filename>/boot/kernel.old/kernel</filename>
	  speichern:</para>

	<screen>&prompt.root; <userinput>make installkernel KERNCONF=<replaceable>MYKERNEL</replaceable></userinput></screen>
      </step>

      <step>
	<para>Fahren Sie das System herunter und starten Sie den neuen
	  Kernel.  Wenn etwas nicht funktioniert, lesen Sie <xref
	    linkend="kernelconfig-noboot"/>.</para>
      </step>
    </procedure>

    <para>In der Voreinstellung werden beim Bau eines angepassten
      Kernels stets alle Kernelmodule neu gebaut.  Um einen Kernel
      schneller zu bauen, oder um nur bestimmte Module zu bauen,
      bearbeiten Sie <filename>/etc/make.conf</filename>, bevor Sie
      den Kernel neu bauen.</para>

    <para>In diesem Beispiel werden über eine Variable nur die
      Kernelmodule definiert, die auch tatsächlich gebaut werden
      sollen.  In der Voreinstellung werden alle Module gebaut:</para>

    <programlisting>MODULES_OVERRIDE = linux acpi</programlisting>

    <para>Alternativ kann auch eine Variable verwendet werden, die
      bestimmte Kernelmodule vom Bauprozess ausschließt:</para>

    <programlisting>WITHOUT_MODULES = linux acpi sound</programlisting>

    <para>Weitere Variablen und deren Beschreibung finden Sie in
      &man.make.conf.5;.</para>

    <indexterm>
      <primary><filename>/boot/kernel.old</filename></primary>
    </indexterm>
  </sect1>

  <sect1 xml:id="kernelconfig-trouble">
    <title>Wenn etwas schiefgeht</title>

    <para>Es gibt vier Hauptfehlerquellen beim Erstellen eines
      angepassten Kernels:</para>

    <variablelist>
      <varlistentry>
        <term><command>config</command> verursacht Fehler:</term>

        <listitem>
          <para>Wenn &man.config.8; fehlschlägt, liegt vermutlich ein
	    einfacher Fehler vor.  Glücklicherweise gibt
	    &man.config.8; die Zeilennummer der Fehlerstelle an.
	    Beispielsweise könnten
	    Sie folgende Fehlermeldung sehen:</para>

          <screen>config: line 17: syntax error</screen>

	  <para>Vergleichen Sie die angegebene Zeile mit
	    <filename>GENERIC</filename> und stellen Sie sicher,
	    dass das Schlüsselwort in Zeile 17 richtig geschrieben
	    ist.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><command>make</command> verursacht Fehler:</term>

        <listitem>
	  <para>Wenn <command>make</command> misslingt, liegen
	    meistens Fehler in der Konfigurationsdatei vor,
	    die aber nicht schwerwiegend genug für
	    &man.config.8; waren.  Überprüfen Sie
	    die Konfiguration und wenn Sie keinen
	    Fehler entdecken können, schicken Sie eine
	    E-Mail mit der Kernelkonfiguration an die Mailingliste
	    &a.de.questions;.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>Der Kernel bootet nicht:<anchor xml:id="kernelconfig-noboot"/></term>

        <listitem>
          <para>Wenn der neue Kernel nicht bootet oder die Geräte
	    nicht erkannt werden, ist das noch kein Grund zur Panik.
	    Glücklicherweise besitzt &os; einen exzellenten
	    Mechanismus zur Wiederherstellung nach dem Einsatz
	    inkompatibler Kernel.  Wählen Sie einfach den zu
	    bootenden Kernel im &os; Bootloader aus.  Dazu wählen Sie
	    im Bootmenü die Option
	    <quote>Escape to a loader prompt</quote>.  Danach
	    geben Sie am Prompt
	    <command>boot kernel.old</command> oder
	    den Namen eines anderen Kernels ein, der sauber bootet.
	    Bei der Rekonfiguration eines Kernels empfiehlt es sich
	    immer einen Kernel bereit zu halten, der garantiert
	    bootet.</para>

          <para>Nun kann die Konfiguration noch einmal überprüft und
	    der Kernel neu kompiliert werden.  Dazu
	    ist <filename>/var/log/messages</filename> sehr nützlich,
	    da hier sämtliche Kernelmeldungen von jedem erfolgreichen
	    Bootvorgang gespeichert werden.  &man.dmesg.8; gibt die
	    Kernelmeldungen vom letzten Bootvorgang aus.</para>

          <note>
	    <para>Wenn Sie Probleme beim
	      Kernelbau bekommen, heben Sie sich immer einen
	      <filename>GENERIC</filename> oder einen anderen
	      Kernel, der garantiert bootet, auf.  Der Name
	      dieses Kernels sollte so gewählt sein, dass
	      er beim nächsten Bau nicht überschrieben
	      wird.  Verlassen Sie sich nicht auf
	      <filename>kernel.old</filename>, da
	      dieser Kernel durch den zuletzt installierten
	      Kernel, der vielleicht schon kaputt war, während
	      der Installation ersetzt wird.  Kopieren Sie den
	      funktionierenden Kernel so schnell wie möglich
	      nach <filename>/boot/kernel</filename>.
	      Ansonsten funktionieren Kommandos wie &man.ps.1;
	      nicht.  Benennen Sie dazu einfach das Verzeichnis
	      des funktionierenden Kernels um:</para>

	    <screen>&prompt.root; <userinput>mv /boot/kernel /boot/kernel.bad</userinput>
&prompt.root; <userinput>mv /boot/kernel.good /boot/kernel</userinput></screen>

	  </note>
        </listitem>
      </varlistentry>

      <varlistentry>
	<term>Der Kernel ist in Ordnung, aber <command>ps</command> geht
	  nicht mehr:</term>

        <listitem>
	  <para>Wenn Sie eine andere Version des Kernels installiert
	    haben als die, mit der Ihre Systemwerkzeuge gebaut
	    wurden (beispielsweise einen -CURRENT-Kernel auf einem
	    -RELEASE-System), werden Programme wie &man.ps.1; und
	    &man.vmstat.8; nicht mehr funktionieren.  Um dies zu
	    beheben, sollten Sie das <link linkend="makeworld">komplette
	      System neu bauen und installieren</link>.  Achten
	    Sie darauf, dass die Quellen, aus denen das
	    System gebaut wird, zum installierten Kernel passt.
	    Das ist ein Grund, warum man nie einen
	    Kernel, der nicht zur Systemversion passt, benutzen
	    sollte.</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect1>
</chapter>

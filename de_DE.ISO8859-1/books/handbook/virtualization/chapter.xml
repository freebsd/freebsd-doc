<?xml version="1.0" encoding="iso-8859-1"?>
<!--
     The FreeBSD Documentation Project
     The FreeBSD German Documentation Project

     $FreeBSD$
     $FreeBSDde: de-docproj/books/handbook/virtualization/chapter.xml,v 1.14 2010/07/03 14:29:30 jkois Exp $
     basiert auf: r49599
-->
<chapter xmlns="http://docbook.org/ns/docbook"
  xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
  xml:id="virtualization">

  <info>
    <title>Virtualisierung</title>

    <authorgroup>
      <author>
	<personname>
	  <firstname>Murray</firstname>
	  <surname>Stokely</surname>
	</personname>
	<contrib>Beigetragen von </contrib>
      </author>
    </authorgroup>
    <authorgroup>
      <author>
	<personname>
	  <firstname>Allan</firstname>
	  <surname>Jude</surname>
	</personname>
	<contrib>bhyve Abschnitt beigetragen von </contrib>
      </author>
    </authorgroup>
    <authorgroup>
      <author>
	<personname>
	  <firstname>Oliver</firstname>
	  <surname>Peter</surname>
	</personname>
	<contrib>Übersetzt von </contrib>
      </author>
    </authorgroup>
  </info>

  <sect1 xml:id="virtualization-synopsis">
    <title>Übersicht</title>

    <para>Virtualisierungssoftware erlaubt es, mehrere Betriebssysteme
      gleichzeitig auf dem selben Computer laufen zu lassen.
      Derartige Softwaresysteme für <acronym>PC</acronym>s setzen in
      der Regel ein Host-Betriebssystem voraus, auf dem die
      Virtualisierungssoftware läuft und unterstützen eine nahezu
      beliebige Anzahl von Gast-Betriebssystemen.</para>

    <para>Nachdem Sie dieses Kapitel gelesen haben,</para>

    <itemizedlist>
      <listitem>
	<para>Kennen Sie den Unterscheid zwischen einem
	  Host-Betriebssystem und einem Gast-Betriebssystem.</para>
      </listitem>

      <listitem>
	<para>Können Sie &os; auf einem &intel;-basierenden
	  &apple; &mac; installieren.</para>
      </listitem>

      <listitem>
	<para>Können Sie &os; unter &microsoft.windows; und
	<application>Virtual PC</application> installieren.</para>
      </listitem>

      <listitem>
	<para>Wissen Sie, wie man ein virtualisiertes &os;-System
	  für optimale Leistung konfiguriert.</para>
      </listitem>
    </itemizedlist>

    <para>Bevor Sie dieses Kapitel lesen, sollten Sie</para>

    <itemizedlist>
      <listitem>
	<para>Die <link linkend="basics">Grundlagen von &unix; und
	    &os;</link> verstehen.</para>
      </listitem>

      <listitem>
	<para>Wissen, wie Sie <link linkend="bsdinstall">&os;
	    installieren</link> können.</para>
      </listitem>

      <listitem>
	<para>Wissen, wie Sie eine <link
	    linkend="advanced-networking">Netzwerkverbindung
	    konfigurieren</link>.</para>
      </listitem>

      <listitem>
	<para>Wissen, wie Sie <link linkend="ports">zusätzliche
	    Software installieren</link> können.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="virtualization-guest-parallels">
    <title>&os; als Gast-Betriebssystem unter
      <application>Parallels</application> für &macos; X</title>

    <para><application>Parallels Desktop</application> für &mac;
      ist ein kommerzielles Softwareprodukt, welches für
      &intel;-basierende &apple; &mac;-Computer mit
      &macos;&nbsp;X&nbsp;10.4.6 oder höher verfügbar ist.  &os; wird
      von diesem Softwarepaket als Gast-Betriebssystem vollständig
      unterstützt.  Nach der Installation von
      <application>Parallels</application> auf &macos;&nbsp;X
      konfigurieren Sie als erstes eine virtuelle Maschine, in der Sie
      danach das gewünschte Gast-Betriebssystem (in diesem Fall &os;)
      installieren.</para>

    <sect2 xml:id="virtualization-guest-parallels-install">
      <title>Installation von &os; unter
	Parallels/&macos;&nbsp;X</title>

      <para>Der erste Schritt bei der Installation von &os; unter
	<application>Parallels</application> ist es, eine virtuelle
	Maschine zu konfigurieren, in der Sie &os; installieren
	können.  Dazu wählen Sie bei der Frage nach dem
	<guimenu>Guest OS Type</guimenu>
	<guimenuitem>&os;</guimenuitem> aus:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd1"/>
	</imageobject>
      </mediaobject>

      <para>Legen Sie geeignete Größen für Festplatten- und
	Arbeitsspeicher für die zu erstellende &os;-Instanz fest.
	4&nbsp;GB Plattenplatz sowie 512&nbsp;MB RAM sind in der Regel
	für die Arbeit unter <application>Parallels</application>
	ausreichend:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd2"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd3"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd4"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd5"/>
	</imageobject>
      </mediaobject>

      <para>Wählen Sie den gewünschten Netzwerktyp aus und
	konfigurieren Sie die Netzwerkverbindung:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd6"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd7"/>
	</imageobject>
      </mediaobject>

      <para>Speichern Sie Ihre Eingaben, um die Konfiguration
	abzuschließen:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd8"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd9"/>
	</imageobject>
      </mediaobject>

      <para>Nachdem Sie die virtuelle Maschine erstellt haben,
	installieren Sie im nächsten Schritt &os; in dieser virtuellen
	Maschine.  Dazu verwenden Sie am besten eine offizielle
	&os;-<acronym>CD</acronym>/<acronym>DVD</acronym> oder Sie
	laden von einem offiziellen <acronym>FTP</acronym>-Server ein
	<acronym>ISO</acronym>-Abbild auf Ihren &mac; herunter.
	Danach klicken Sie auf das Laufwerksymbol in der rechten
	unteren Ecke des
	<application>Parallels</application>-Fensters, um das
	virtuelles Laufwerk mit dem <acronym>ISO</acronym>-Abbild oder
	mit dem physikalischen <acronym>CD-ROM</acronym>-Laufwerk des
	Computers zu verknüpfen.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd11"/>
	</imageobject>
      </mediaobject>

      <para>Nachdem Sie diese Verknüpfung hergestellt haben,
	starten sie die virtuelle &os;-Maschine neu, indem Sie
	auf das Symbol <quote>Neustarten</quote> klicken.
	<application>Parallels</application> startet nun ein
	Spezial-<acronym>BIOS</acronym>, das zuerst prüft, ob eine
	<acronym>CD-ROM</acronym> eingelegt wurde.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd10"/>
	</imageobject>
      </mediaobject>

      <para>In diesem Fall findet das <acronym>BIOS</acronym> ein
	&os;-Installationsmedium und beginnt eine normale
	Installation.  Versuchen Sie jetzt noch nicht
	<application>&xorg;</application> zu konfigurieren.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd12"/>
	</imageobject>
      </mediaobject>

      <para>Nachdem die Installation abgeschlossen ist, können Sie die
	virtuelle &os;-Maschine starten.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/parallels-freebsd13"/>
	</imageobject>
      </mediaobject>
    </sect2>

    <sect2 xml:id="virtualization-guest-parallels-configure">
      <title>&os; für den Einsatz unter
	<application>Parallels</application> konfigurieren</title>

      <para>Nachdem &os; erfolgreich unter &macos;&nbsp;X mit
	<application>Parallels</application> installiert wurde,
	sollten Sie das virtuelle &os;-System für virtualisierte
	Operationen optimieren:</para>

      <procedure>
	<step>
	  <title>Setzen der Bootloader-Variablen</title>

	  <para>Die wichtigste Änderung ist es, die Variable
	    <option>kern.hz</option> zu verkleinern, um so die
	    CPU-Auslastung in der
	    <application>Parallels</application>-Umgebung zu
	    verringern.</para>

	  <programlisting>kern.hz=100</programlisting>

	  <para>Ohne diese Einstellung kann ein unbeschäftigtes &os;
	    unter <application>Parallels</application> trotzdem rund
	    15 Prozent der CPU-Leistung eines Single Prozessor
	    &imac;'s verbrauchen.  Nach dieser Änderung reduziert
	    sich dieser Wert auf etwa 5 Prozent.</para>
	</step>

	<step>
	  <title>Erstellen einer neuen
	    Kernelkonfigurationsdatei</title>

	  <para>Sie können alle SCSI-, FireWire- und
	    USB-Laufwerks-Treiber entfernen.
	    <application>Parallels</application> stellt einen
	    virtuellen Netzwerkadapter bereit, der den
	    &man.ed.4;-Treiber verwendet.  Daher können alle
	    Netzwerkgeräte bis auf &man.ed.4; und &man.miibus.4; aus
	    dem Kernel entfernt werden.</para>
	</step>

	<step>
	  <title>Netzwerkbetrieb einrichten</title>

	  <para>Die einfachste Netzwerkkonfiguration ist der Einsatz
	    von DHCP, um die virtuelle Maschine mit dem gleichen
	    lokalen Netzwerk, in dem sich der Host-&mac; befindet, zu
	    verbinden.  Dazu fügen Sie die Zeile
	    <literal>ifconfig_ed0="DHCP"</literal> in
	    <filename>/etc/rc.conf</filename> ein.  Weitere
	    Informationen zur Konfiguration des Netzwerks unter &os;
	    finden Sie im
	    <xref linkend="advanced-networking"/>.</para>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 xml:id="virtualization-guest-virtualpc">
    <info>
      <title>&os; als Gast-Betriebssystem unter
	<application>Virtual PC</application> für &windows;</title>

      <authorgroup>
	<author>
	  <personname>
	    <firstname>Johann</firstname>
	    <surname>Kois</surname>
	  </personname>
	  <contrib>Übersetzt von </contrib>
	</author>
      </authorgroup>
    </info>

    <para><application>Virtual PC</application> für &windows; wird von
      &microsoft; kostenlos zum Download angeboten.  Die
      Systemanforderungen für dieses Programm finden Sie <link
	xlink:href="http://www.microsoft.com/windows/downloads/virtualpc/sysreq.mspx">
	hier</link>.  Nachdem <application>Virtual PC</application>
      unter &microsoft.windows; installiert wurde, muss eine virtuelle
      Maschine konfiguriert und das gewünschte Betriebssystem
      installiert werden.</para>

    <sect2 xml:id="virtualization-guest-virtualpc-install">
      <title>&os; in <application>Virtual PC</application>
	installieren</title>

      <para>Der erste Schritt zur Installation von &os; in
	<application>Virtual PC</application> ist es, eine neue
	virtuelle Maschine zu erstellen, in die Sie &os; installieren
	können.  Dazu wählen Sie die Option
	<guimenuitem>Create a virtual machine</guimenuitem>, wenn Sie
	danach gefragt werden:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd1"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd2"/>
	</imageobject>
      </mediaobject>

      <para>Bei der Frage nach dem
	<guimenuitem>Operating system</guimenuitem> wählen Sie
	<guimenuitem>Other</guimenuitem>:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd3"/>
	</imageobject>
      </mediaobject>

      <para>Danach müssen Sie den gewünschten Plattenplatz sowie die
	Größe des Hauptspeichers angeben.  4&nbsp;GB Plattenplatz
	sowie 512&nbsp;MB RAM sollten für die Installation von &os; in
	<application>Virtual PC</application> ausreichend sein:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd4"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd5"/>
	</imageobject>
      </mediaobject>

      <para>Speichern Sie die Eingaben und beenden Sie die
	Konfiguration:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd6"/>
	</imageobject>
      </mediaobject>

      <para>Wählen Sie nun die für &os; erstellte virtuelle Maschine
	aus und klicken Sie auf <guimenu>Settings</guimenu>, um das
	Netzwerk zu konfigurieren:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd7"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd8"/>
	</imageobject>
      </mediaobject>

      <para>Nachdem die virtuelle Maschine erstellt wurde, können Sie
	&os; installieren.  Dazu verwenden Sie am besten eine
	offizielle &os;-<acronym>CD</acronym>/<acronym>DVD</acronym>
	oder ein <acronym>ISO</acronym>-Image, das Sie von einem
	offiziellen &os;-<acronym>FTP</acronym>-Server heruntergeladen
	haben.  Wenn Sie ein <acronym>ISO</acronym>-Image auf der
	Festplatte gespeichert haben, oder
	eine &os;-<acronym>CD</acronym>/<acronym>DVD</acronym> in das
	Laufwerk eingelegt haben, doppelklicken Sie auf die virtuelle
	Maschine, die Sie für &os; angelegt haben.  Danach klicken Sie
	auf <guimenu>CD</guimenu> und wählen die Option
	<guimenu>Capture ISO Image...</guimenu> im
	<application>Virtual PC</application>-Fenster.  Danach können
	Sie im folgenden Fenster das <acronym>CD</acronym>-Laufwerk
	mit dem physikalischen <acronym>CD</acronym>-Laufwerk oder mit
	dem <acronym>ISO</acronym>-Image verknüpfen.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd9"/>
	</imageobject>
      </mediaobject>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd10"/>
	</imageobject>
      </mediaobject>

      <para>Danach starten Sie die virtuelle Maschine neu, indem Sie
	zuerst auf <guimenu>Action</guimenu> und danach auf
	<guimenu>Reset</guimenu> klicken.
	<application>Virtual PC</application> startet die virtuelle
	Maschine nun neu und prüft zuerst, ob die virtuelle Maschine
	über ein <acronym>CD</acronym>-Laufwerk verfügt.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd11"/>
	</imageobject>
      </mediaobject>

      <para>Da dies hier der Fall ist, beginnt nun eine normale
	&os;-Installation.  Sie können &os; nun installieren, aber
	verzichten Sie an dieser Stelle unbedingt auf die
	<application>&xorg;</application>-Konfiguration.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd12"/>
	</imageobject>
      </mediaobject>

      <para>Nachdem die Installation abgeschlossen ist, entfernen Sie
	die <acronym>CD</acronym>/<acronym>DVD</acronym> aus dem
	Laufwerk (oder lösen die Verknüpfung zum
	<acronym>ISO</acronym>-Image).  Danach starten Sie die
	virtuelle Maschine neu, um &os; zu starten.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/virtualpc-freebsd13"/>
	</imageobject>
      </mediaobject>
    </sect2>

    <sect2 xml:id="virtualization-guest-virtualpc-configure">
      <title>&os; in <application>Virtual PC</application>
	konfigurieren</title>

      <para>Nachdem &os; auf &microsoft.windows; mit
	<application>Virtual PC</application> erfolgreich installiert
	wurde, sollten Sie das virtuelle &os; noch anpassen, um eine
	optimale Funktion zu gewährleisten.</para>

      <procedure>
	<step>
	  <title>Setzen der Bootloader-Variablen</title>

	  <para>Die wichtigste Änderung ist es, die Variable
	    <option>kern.hz</option> zu verkleinern, um so die
	    CPU-Auslastung in der
	    <application>Virtual PC</application>-Umgebung zu
	    verringern.  Dazu fügen Sie die folgende Zeile in
	    <filename>/boot/loader.conf</filename> ein:</para>

	  <programlisting>kern.hz=100</programlisting>

	  <para>Ohne diese Einstellung kann ein unbeschäftigtes
	    &os; unter <application>Virutal PC</application>
	    trotzdem rund 40 Prozent der CPU-Leistung eines
	    Ein-Prozessor-Systems verbrauchen.  Nach dieser
	    Änderung reduziert sich dieser Wert auf etwa
	    3 Prozent.</para>
	</step>

	<step>
	  <title>Erstellen einer neuen
	    Kernelkonfigurationsdatei</title>

	  <para>Alle SCSI-, FireWire- und USB-Laufwerks-Treiber
	    können aus der Kernelkonfigurationsdatei entfernt
	    werden.  <application>Virtual PC</application> stellt
	    einen virtuellen Netzwerkadapter bereit, der den
	    &man.de.4;-Treiber verwendet.  Daher können alle
	    Netzwerkgeräte bis auf &man.de.4; und
	    &man.miibus.4; aus dem Kernel entfernt werden.</para>
	</step>

	<step>
	  <title>Das Netzwerk einrichten</title>

	  <para>Die einfachste Netzwerkkonfiguration nutzt von DHCP,
	    um die virtuelle Maschine mit dem gleichen lokalen
	    Netzwerk, in dem sich der Host-&microsoft.windows;
	    befindet, zu verbinden.  Dazu fügen Sie die Zeile
	    <literal>ifconfig_de0="DHCP"</literal> in
	    <filename>/etc/rc.conf</filename> ein.  Weitere
	    Informationen zur Konfiguration des Netzwerks unter &os;
	    finden Sie in  <xref
	      linkend="advanced-networking"/>.</para>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 xml:id="virtualization-guest-vmware">
    <info>
      <title>&os; als Gast-Betriebssystem unter
	<application>VMware Fusion</application> für &macos;</title>

      <authorgroup>
	<author>
	  <personname>
	    <firstname>Johann</firstname>
	    <surname>Kois</surname>
	  </personname>
	  <contrib>Übersetzt von </contrib>
	</author>
      </authorgroup>
    </info>

    <para><application>VMware Fusion</application> für &mac; ist ein
      kommerzielles Programm, das für &intel; basierte &apple;
      &mac;-Computer mit &macos; 10.4.9 oder neuer erhältlich ist.
      &os; wird von diesem Produkt vollständig als Gast-Betriebssystem
      unterstützt.  Nachdem Sie
      <application>VMware Fusion</application> unter &macos; X
      installiert haben, können Sie eine virtuelle Maschine
      konfigurieren und das gewünschte Gastbetriebssystem
      installieren.</para>

    <sect2 xml:id="virtualization-guest-vmware-install">
      <title>&os; in <application>VMware Fusion</application>
	installieren</title>

      <para>Zuerst müssen Sie <application>VMware Fusion</application>
	starten, um eine virtuelle Maschine zu erstellen.  Dazu wählen
	Sie die Option <guimenuitem>New</guimenuitem>:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd01"/>
	</imageobject>
      </mediaobject>

      <para>Dadurch wird ein Assistent gestartet, der bei der
	Erzeugung einer neuen virtuellen Maschine behilflich ist.
	Klicken Sie auf <guimenuitem>Continue</guimenuitem>, um den
	Prozess zu starten:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd02"/>
	</imageobject>
      </mediaobject>

      <para>Wählen Sie <guimenuitem>Other</guimenuitem> als das
	<guimenuitem>Operating System</guimenuitem>, danach
	<guimenuitem>&os;</guimenuitem> oder
	<guimenuitem>&os; 64-bit</guimenuitem>, je nach dem, welche
	Version Sie installieren wollen, wenn Sie nach der zu
	installierenden <guimenu>Version</guimenu> gefragt
	werden:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd03"/>
	</imageobject>
      </mediaobject>

      <para>Vergeben Sie einen Namen für die virtuelle Maschine und
	legen Sie den Speicherort fest:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd04"/>
	</imageobject>
      </mediaobject>

      <para>Legen Sie die Größe der virtuellen Festplatte für die
	virtuelle Maschine fest:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd05"/>
	</imageobject>
      </mediaobject>

      <para>Wählen Sie die Installationsmethode für die virtuelle
	Maschine.  Entweder von einem <acronym>ISO</acronym>-Abbild
	oder von einer
	<acronym>CD</acronym>/<acronym>DVD</acronym>:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd06"/>
	</imageobject>
      </mediaobject>

      <para>Nachdem Sie auf <guimenuitem>Finish</guimenuitem> geklickt
	haben, wird die virtuelle Maschine gestartet:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd07"/>
	</imageobject>
      </mediaobject>

      <para>Nun können Sie &os; wie gewohnt installieren:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd08"/>
	</imageobject>
      </mediaobject>

      <para>Nachdem die Installation abgeschlossen ist, können noch
	verschiedene Parameter der virtuellen Maschine, wie etwa der
	Speicherverbrauch, konfiguriert werden:</para>

      <note>
	<para>Die Hardware der virtuellen Maschine kann nicht
	  geändert werden, solange die virtuelle Maschine
	  läuft.</para>
      </note>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd09"/>
	</imageobject>
      </mediaobject>

      <para>Die Anzahl der CPUs der virtuellen Maschine:</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd10"/>
	</imageobject>
      </mediaobject>

      <para>Den Status des <acronym>CD</acronym>-Laufwerks.  Sie
	können die
	<acronym>CD</acronym>/<acronym>DVD</acronym>/<acronym>ISO</acronym>
	von der virtuellen Maschine lösen, wenn Sie es nicht
	benötigen.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd11"/>
	</imageobject>
      </mediaobject>

      <para>Zuletzt sollten Sie noch festlegen, wie sich die virtuelle
	Maschine mit dem Netzwerk verbinden soll.  Sollen neben dem
	Gastsystem auch andere Rechner auf die virtuelle Maschine
	zugreifen können, muss die Option
	<guimenuitem>Connect directly to the physical network (Bridged)</guimenuitem>
	gewählt werden.  Ist dies nicht der Fall, sollte die Option
	<guimenuitem>Share the host's internet connection (NAT)</guimenuitem>
	gewählt werden.  In dieser Einstellung kann die virtuelle
	Maschine zwar auf das Internet zugreifen, andere Rechner
	dürfen aber nicht auf die virtuelle Maschine zugreifen.</para>

      <mediaobject>
	<imageobject>
	  <imagedata fileref="virtualization/vmware-freebsd12"/>
	</imageobject>
      </mediaobject>

      <para>Nachdem die Konfiguration abgeschlossen ist, kann &os;
	gestartet werden.</para>
    </sect2>

    <sect2 xml:id="virtualization-guest-vmware-configure">
      <title>&os; unter <application>VMware Fusion</application>
	konfigurieren</title>

      <para>Nachdem Sie &os; erfolgreich unter
	<application>VMware Fusion</application> installiert haben,
	sollten Sie das virtuelle &os; noch anpassen, um eine
	optimale Funktion zu gewährleisten.</para>

      <procedure>
	<step>
	  <para>Die wichtigste Änderung ist es, die Variable
	    <option>kern.hz</option> zu verkleinern, um so die
	    CPU-Auslastung in der
	    <application>VMware Fusion</application>-Umgebung zu
	    verringern.</para>

	  <programlisting>kern.hz=100</programlisting>

	  <para>Ohne diese Einstellung kann ein unbeschäftigtes &os;
	    unter <application>VMware Fusion</application> trotzdem
	    rund 15 Prozent der CPU-Leistung eines Single Prozessor
	    &imac;'s verbrauchen.  Nach dieser Änderung reduziert
	    sich dieser Wert auf etwa 5 Prozent.</para>
	</step>

	<step>
	  <title>Erstellen einer neuen
	    Kernelkonfigurationsdatei</title>

	  <para>Alle FireWire- und USB-Laufwerks-Treiber können aus
	    der Kernelkonfigurationsdatei entfernt werden.
	    <application>VMware Fusion</application> stellt einen
	    virtuellen Netzwerkadapter bereit, der den
	    &man.em.4;-Treiber verwendet.  Daher können alle
	    Netzwerkgeräte bis auf &man.em.4; und
	    &man.miibus.4; aus dem Kernel entfernt werden.</para>
	</step>

	<step>
	  <title>Netzwerkbetrieb einrichten</title>

	  <para>Die einfachste Netzwerkkonfiguration verwendet DHCP,
	    um die virtuelle Maschine mit dem gleichen lokalen
	    Netzwerk, in dem sich der Host-&mac; befindet, zu
	    verbinden.  Dazu fügen Sie die Zeile
	    <literal>ifconfig_em0="DHCP"</literal> in
	    <filename>/etc/rc.conf</filename> ein.  Weitere
	    Informationen zur Konfiguration des Netzwerks unter
	    &os; finden Sie im  <xref
	      linkend="advanced-networking"/>.</para>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 xml:id="virtualization-guest-virtualbox-guest-additions">
    <title>&virtualbox; Gasterweiterungen auf einem &os; Gast</title>

    <para>&os; funktioniert einwandfrei als Gast-Betriebssystem unter
      &virtualbox;.  Die Virtualisierungs-Software steht für die
      meisten Betriebssysteme zur Verfügung, einschließlich
      &os;.</para>

    <para>Die &virtualbox; Gasterweiterungen bieten Unterstützung
      für:</para>

    <itemizedlist>
      <listitem>
	<para>Gemeinsame Zwischenablage.</para>
      </listitem>

      <listitem>
	<para>Mauszeiger-Integration.</para>
      </listitem>

      <listitem>
	<para>Zeitsynchronisation mit dem Host.</para>
      </listitem>

      <listitem>
	<para>Skalierung von Fenstern.</para>
      </listitem>

      <listitem>
	<para>Nahtloser Modus.</para>
      </listitem>
    </itemizedlist>

    <note>
      <para>Diese Kommandos werden im &os; Gastsystem
	ausgeführt.</para>
    </note>

    <para>Installieren Sie das Paket oder den Port
      <package>emulators/virtualbox-ose-additions</package> in das
      &os; Gastsystem.  Dieses Beispiel installiert den Port:</para>

    <screen>&prompt.root; <userinput>cd /usr/ports/emulators/virtualbox-ose-additions</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

    <para>Fügen Sie folgende Einträge in
      <filename>/etc/rc.conf</filename> hinzu:</para>

    <programlisting>vboxguest_enable="YES"
vboxservice_enable="YES"</programlisting>

    <para>Wenn &man.ntpd.8; oder &man.ntpdate.8; verwendet wird um
      die Uhrzeit zu synchronisieren, dann deaktivieren Sie die
      Synchronisierung mit dem Host:</para>

    <programlisting>vboxservice_flags"--disable-timesync"</programlisting>

    <para><application>Xorg</application> wird den
      <literal>vboxvideo</literal>-Treiber automatisch erkennen.
      Alternativ kann auch manuell ein entsprechender Eintrag in
      <filename>/etc/X11/xorg.conf</filename> hinzugefügt
      werden:</para>

    <programlisting>Section "Device"
	Identifier "Card0"
	Driver "vboxvideo"
	VendorName "InnoTek Systemberatung GmbH"
	BoardName "VirtualBox Graphics Adapter"
EndSection</programlisting>

    <para>Um den <literal>vboxmouse_drv</literal>-Treiber zu
      verwenden, muss <filename>/etc/X11/xorg.conf</filename>
      ebenfalls angepasst werden:</para>

    <programlisting>Section "InputDevice"
	Identifier "Mouse0"
	Driver "vboxmouse"
EndSection</programlisting>

    <para>Benutzer von <acronym>HAL</acronym> sollten die Datei
      <filename>/usr/local/etc/hal/fdi/policy/90-vboxguest.fdi</filename>
      erstellen oder sie aus
      <filename>/usr/local/share/hal/fdi/policy/10osvendor/90-vboxguest.fdi</filename>
      kopieren:</para>

    <programlisting>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!--
# Sun VirtualBox
# Hal driver description for the vboxmouse driver
# $Id: chapter.xml,v 1.33 2012-03-17 04:53:52 eadler Exp $

	Copyright (C) 2008-2009 Sun Microsystems, Inc.

	This file is part of VirtualBox Open Source Edition (OSE, as
	available from http://www.virtualbox.org. This file is free software;
	you can redistribute it and/or modify it under the terms of the GNU
	General Public License (GPL) as published by the Free Software
	Foundation, in version 2 as it comes in the "COPYING" file of the
	VirtualBox OSE distribution. VirtualBox OSE is distributed in the
	hope that it will be useful, but WITHOUT ANY WARRANTY of any kind.

	Please contact Sun Microsystems, Inc., 4150 Network Circle, Santa
	Clara, CA 95054 USA or visit http://www.sun.com if you need
	additional information or have any questions.
--&gt;
&lt;deviceinfo version="0.2"&gt;
  &lt;device&gt;
    &lt;match key="info.subsystem" string="pci"&gt;
      &lt;match key="info.product" string="VirtualBox guest Service"&gt;
	&lt;append key="info.capabilities" type="strlist"&gt;input&lt;/append&gt;
	&lt;append key="info.capabilities" type="strlist"&gt;input.mouse&lt;/append&gt;
	&lt;merge key="input.x11_driver" type="string"&gt;vboxmouse&lt;/merge&gt;
	&lt;merge key="input.device" type="string"&gt;/dev/vboxguest&lt;/merge&gt;
      &lt;/match&gt;
    &lt;/match&gt;
  &lt;/device&gt;
&lt;/deviceinfo&gt;</programlisting>
  </sect1>

  <sect1 xml:id="virtualization-host-virtualbox">
    <info>
      <title>&os; als Host mit
	<application>Virtualbox</application></title>

      <authorgroup>
	<author>
	  <personname>
	    <firstname>Benedict</firstname>
	    <surname>Reuschling</surname>
	  </personname>
	  <contrib>Übersetzt von </contrib>
	</author>
	<author>
	  <personname>
	    <firstname>Christoph</firstname>
	    <surname>Sold</surname>
	  </personname>
	</author>
      </authorgroup>
    </info>

    <para><application>&virtualbox;</application> ist ein
      vollständigesVirtualisierungspaket, das aktiv weiterentwickelt
      wird und für die meisten Betriebssysteme einschließlich
      &windows;, &macos;, &linux; und &os; zur Verfügung steht.  Es
      kann sowohl &windows; als auch &unix;-ähnliche Gastsysteme
      betreiben.  Es wird als Open Source Software veröffentlicht,
      jedoch mit Closed-Source-Komponenten in einem separaten
      Erweiterungspaket.  Zu diesen Komponenten gehört Unterstützung
      für <acronym>USB</acronym>&nbsp;2.0-Geräte.  Weitere
      Informationen finden Sie auf der <link
	xlink:href="http://www.virtualbox.org/wiki/Downloads">
	<quote>Downloads</quote>-Seite im
	<application>&virtualbox;</application> Wiki</link>.  Derzeit
      sind diese Erweiterungen für &os; nicht verfügbar.</para>

    <sect2 xml:id="virtualization-virtualbox-install">
      <title>&virtualbox; installieren</title>

      <para><application>&virtualbox;</application> steht als
	Paket oder Port in <package>emulators/virtualbox-ose</package>
	bereit.  Der Port kann mit folgendem Kommando installiert
	werden:</para>

      <screen>&prompt.root; <userinput>cd /usr/ports/emulators/virtualbox-ose</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

      <para>Eine nützliche Option im Konfigurationsdialog ist die
	<literal>GuestAdditions</literal>-Programmsammlung.  Diese
	stellen eine Reihe von nützlichen Eigenschaften in den
	Gastbetriebssystemen zur Verfügung, wie beispielsweise
	Mauszeigerintegration (was es ermöglicht, die Maus zwischen
	dem Host und dem Gast zu teilen ohne eine spezielle
	Tastenkombination für diesen Wechsel zu drücken), sowie
	schnelleres Rendern von Videos, besonders in &windows; Gästen.
	Diese Gastzusätze sind im <guimenu>Devices</guimenu>-Menü zu
	finden, nachdem die Installation des Gastbetriebssystem
	abgeschlossen ist.</para>

      <para>Ein paar Konfigurationsänderungen sind notwendig, bevor
	<application>&virtualbox;</application> das erste Mal
	gestartet wird.  Der Port installiert ein Kernelmodul in
	<filename>/boot/modules</filename>, das in den laufenden
	Kernel geladen werden muss:</para>

      <screen>&prompt.root; <userinput>kldload vboxdrv</userinput></screen>

      <para>Um sicherzustellen, dass das Modul immer nach einem
	Neustart geladen wird, fügen Sie die folgende Zeile in
	<filename>/boot/loader.conf</filename> ein:</para>

      <programlisting>vboxdrv_load="YES"</programlisting>

      <para>Um die Kernelmodule für die Unterstützung von
	Netzwerkbrücken oder
	<foreignphrase>Host-Only</foreignphrase>
	Netzwerken zu laden, fügen Sie folgendes in
	<filename>/etc/rc.conf</filename> ein und starten Sie den
	Computer neu:</para>

      <programlisting>vboxnet_enable="YES"</programlisting>

      <para>Die Gruppe <systemitem
	  class="groupname">vboxusers</systemitem> wird während der
	Installation von <application>&virtualbox;</application>
	angelegt.  Alle Benutzer, die Zugriff auf
	<application>&virtualbox;</application> haben sollen, müssen
	in diese Gruppe aufgenommen werden.  <command>pw</command>
	kann benutzt werden, um neue Mitglieder hinzuzufügen:</para>

      <screen>&prompt.root; <userinput>pw groupmod vboxusers -m <replaceable>yourusername</replaceable></userinput></screen>

      <para>Damit Netzwerkbrücken funktionieren, müssen die in der
	Voreinstellung eingeschränkten Berechtigungen für
	<filename>/dev/vboxnetctl</filename> angepasst werden:</para>

      <screen>&prompt.root; <userinput>chown root:vboxusers /dev/vboxnetctl</userinput>
&prompt.root; <userinput>chmod 0600 /dev/vboxnetctl</userinput></screen>

      <para>Um diese Berechtigungen dauerhaft zu speichern, fügen Sie
	folgende Einträge in <filename>/etc/devfs.conf</filename>
	hinzu:</para>

      <programlisting>own     vboxnetctl root:vboxusers
perm    vboxnetctl 0600</programlisting>

      <para>Um <application>&virtualbox;</application> zu starten,
	geben Sie folgenden Befehl in der
	<application>&xorg;</application>-Sitzung ein:</para>

      <screen>&prompt.user; <userinput>VirtualBox</userinput></screen>

      <para>Besuchen Sie die offizielle Webseite von
	<application>&virtualbox;</application> unter <uri
	  xlink:href="http://www.virtualbox.org">
	  http://www.virtualbox.org</uri>, um weitere Informationen
	zur Konfiguration und Verwendung zu erhalten.
	&os;-spezifische Informationen und Anleitungen zur
	Fehlerbehebung finden Sie auf der entsprechenden Seite im
	&os;-Wiki unter <uri
	  xlink:href="http://wiki.FreeBSD.org/VirtualBox">
	  http://wiki.FreeBSD.org/VirtualBox</uri>.</para>
    </sect2>

    <sect2 xml:id="virtualization-virtualbox-usb-support">
      <title>USB Unterstützung für &virtualbox;</title>

      <para>Das <application>&virtualbox;</application>
	Erweiterungspaket ist für &os;-Hosts nicht verfügbar.  Ohne
	dieses Erweiterungspaket kann der &os;-Host keine
	<acronym>USB</acronym>-Ports an das Gastsystem
	durchreichen.</para>
    </sect2>

    <sect2 xml:id="virtualbox-virtualization-host-dvd-cd-access">
      <title>Host <acronym>CD</acronym>/<acronym>DVD</acronym>-Zugriff
	in &virtualbox;</title>

      <para>Ein Gastsystem kann auf die
	<acronym>DVD</acronym>/<acronym>CD</acronym>-Laufwerke des
	Hosts zugreifen.  Der Zugriff für die virtuellen Maschinen
	wird in den Einstellungen von &virtualbox; konfiguriert.
	Falls erforderlich, erstellen Sie zunächst ein leeres
	<acronym>IDE</acronym>
	<acronym>DVD</acronym>/<acronym>CD</acronym>-Gerät und wählen
	Sie dann ein entsprechendes Medium für dieses Laufwerk aus.
	Das Kontrollkästchen <literal>Passthrough</literal> besagt,
	dass die virtuelle Maschine die Hardware direkt verwenden
	kann.  Audio-<acronym>CD</acronym>s und Brenner funktionieren
	nur, wenn diese Option ausgewählt ist.</para>

      <para>Damit die
	<acronym>CD</acronym>/<acronym>DVD</acronym>-Funktionen von
	&virtualbox; funktionieren, muss <acronym>HAL</acronym> in
	<filename>/etc/rc.conf</filename> aktiviert und anschließend
	gestartet werden:</para>

      <programlisting>hald_enable="YES"</programlisting>

      <screen>&prompt.root; <userinput>service hald start</userinput></screen>

      <para>Damit die
	<acronym>CD</acronym>/<acronym>DVD</acronym>-Funktionen von
	Benutzern verwendet werden können, benötigen diese Zugriff auf
	<filename>/dev/xpt0</filename>,
	<filename>/dev/cd<replaceable>N</replaceable></filename> und
	<filename>/dev/pass<replaceable>N</replaceable></filename>.
	Dies wird in der Regel dadurch erreicht, den Benutzer zum
	Mitglied der Gruppe <systemitem
	  class="groupname">operator</systemitem> zu machen.  Die
	Berechtigungen für diese Geräte werden mit folgenden Zeilen
	in <filename>/etc/devfs.conf</filename> konfiguriert:</para>

      <programlisting>perm cd* 0660
perm xpt0 0660
perm pass* 0660</programlisting>

      <screen>&prompt.root; <userinput>service devfs restart</userinput></screen>
    </sect2>
  </sect1>

  <sect1 xml:id="virtualization-host-bhyve">
    <info>
      <title>&os; als Host mit
	<application>bhyve</application></title>

      <authorgroup>
	<author>
	  <personname>
	    <firstname>Björn</firstname>
	    <surname>Heidotting</surname>
	  </personname>
	  <contrib>Übersetzt von </contrib>
	</author>
      </authorgroup>
    </info>

    <para>Beginnend mit &os; 10.0-RELEASE ist
      <application>bhyve</application>, ein
      <acronym>BSD</acronym>-lizensierter Hypervisor, Teil des
      Basissystems.  Dieser Hypervisor unterstützt eine Reihe von
      Gastbetriebssystemen, darunter &os;, OpenBSD und viele &linux;
      Distributionen.  Derzeit unterstützt
      <application>bhyve</application> nur eine serielle Konsole und
      kann keine graphische Konsole emulieren.
      <application>bhyve</application> verwendet Offload-Funktionen
      von neueren <acronym>CPU</acronym>s, um manuelle
      Speicherzuordnungen und Anweisungen zu vermeiden.</para>

    <para>Das Design von <application>bhyve</application> erfordert
      einen Prozessor, der &intel; Extended Page Tables
      (<acronym>EPT</acronym>), &amd; Rapid Vitualization
      Indexing (<acronym>RVI</acronym>) oder Nested Page Tables
      (<acronym>NPT</acronym>) unterstützt.  &os;- oder
      &linux;-Gastsysteme mit mehr als einer <acronym>vCPU</acronym>
      benötigen <acronym>VMX</acronym> unrestricted mode support
      (<acronym>UG</acronym>).  Die meisten neueren Prozessoren,
      speziell &intel;&nbsp;&core; i3/i5/i7 und &intel;&nbsp;&xeon;
      E3/E5/E7, unterstützen diese Funktionen.  Unterstützung für
      <acronym>UG</acronym> wurde mit Intel's Westmere
      Mikroarchitektur eingeführt.  Eine vollständige Liste der
      &intel;-Prozessoren mit <acronym>EPT</acronym>-Unterstützung
      finden Sie unter <link
	xlink:href="http://ark.intel.com/search/advanced?s=t&amp;ExtendedPageTables=true"/>.
      <acronym>RVI</acronym> wird seit der dritten Generation der
      &amd.opteron;-Prozessoren (Barcelona) unterstützt.  Um zu sehen
      ob der Prozessor <application>bhyve</application> unterstützt,
      prüfen Sie die Ausgabe von <command>dmesg</command> oder
      <filename>/var/run/dmesg.boot</filename>.  Für &amd;-Prozessoren
      suchen Sie in der Zeile <literal>Features2</literal> nach
      <literal>POPCNT</literal>.  Für &intel;-Prozessoren suchen Sie
      in der Zeile <literal>VT-x</literal> nach <literal>EPT</literal>
      und <literal>UG</literal>.</para>

    <sect2 xml:id="virtualization-bhyve-prep">
      <title>Vorbereitung des Hosts</title>

      <para>Der erste Schritt bei der Erstellung einer virtuellen
	Maschine in <application>bhyve</application> ist die
	Konfiguration des Host-Systems.  Laden Sie zunächst das
	<application>bhyve</application> Kernelmodul:</para>

      <screen>&prompt.root; <userinput>kldload vmm</userinput></screen>

      <para>Erstellen Sie ein <filename>tap</filename>-Gerät, um
	dieses mit der Netzwerk-Schnittstelle der virtuellen Maschine
	zu verbinden.  Damit sich die Schnittstelle mit dem
	Netzwerk verbinden kann, müssen Sie zusätzlich eine
	Bridge-Schnittstelle erzeugen, bestehend aus dem
	<filename>tap</filename>-Gerät und der physikalischen
	Schnittstelle.  In diesem Beispiel wird die physikalische
	Schnittstelle <filename>igb0</filename> verwendet:</para>

      <screen>&prompt.root; <userinput>ifconfig <replaceable>tap0</replaceable> create</userinput>
&prompt.root; <userinput>sysctl net.link.tap.up_on_open=1</userinput>
net.link.tap.up_on_open: 0 -> 1
&prompt.root; <userinput>ifconfig <replaceable>bridge0</replaceable> create</userinput>
&prompt.root; <userinput>ifconfig <replaceable>bridge0</replaceable> addm <replaceable>igb0</replaceable> addm <replaceable>tap0</replaceable></userinput>
&prompt.root; <userinput>ifconfig <replaceable>bridge0</replaceable> up</userinput></screen>
    </sect2>

    <sect2 xml:id="virtualization-bhyve-freebsd">
      <title>Ein &os;-Gastsystem erstellen</title>

      <para>Erzeugen Sie eine Datei, die als virtuelle Festplatte
	für das Gastsystem verwendet wird.  Geben Sie die Größe und
	den Namen der virtuellen Festplatte an:</para>

      <screen>&prompt.root; <userinput>truncate -s <replaceable>16G</replaceable> <replaceable>guest.img</replaceable></userinput></screen>

      <para>Laden Sie ein Installationsabbild von &os;:</para>

      <screen>&prompt.root; <userinput>fetch <replaceable>ftp://ftp.freebsd.org/pub/FreeBSD/releases/ISO-IMAGES/10.3/FreeBSD-10.3-RELEASE-amd64-bootonly.iso</replaceable></userinput>
FreeBSD-10.3-RELEASE-amd64-bootonly.iso       100% of  230 MB  570 kBps 06m17s</screen>

      <para>&os; enthält ein Beispielskript um eine virtuelle Maschine
	in <application>bhyve</application> auszuführen.  Das Skript
	wird die virtuelle Maschine starten und sie in einer Schleife
	ausführen.  Sollte die virtuelle Maschine abstürzen, wird sie
	vom Skript automatisch neu gestartet.  Das Skript akzeptiert
	einige Optionen, um die Konfiguration der virtuellen Maschine
	zu kontrollieren: <option>-c</option> bestimmt die Anzahl der
	virtuellen <acronym>CPU</acronym>s, <option>-m</option>
	begrenzt den verfügbaren Speicher des Gastsystems,
	<option>-t</option> bestimmt das verwendete
	<filename>tap</filename>-Gerät, <option>-d</option> gibt das
	zu benutzende Festplattenabbild an, <option>-i</option> sagt
	<application>bhyve</application> dass es von
	<acronym>CD</acronym> booten soll und <option>-I</option>
	bestimmt das <acronym>CD</acronym>-Abbild.  Der letzte
	Parameter ist der Name der virtuellen Maschine.  Dieses
	Beispiel startet die virtuelle Maschine im
	Installationsmodus:</para>

      <screen>&prompt.root; <userinput>sh /usr/share/examples/bhyve/vmrun.sh -c <replaceable>4</replaceable> -m <replaceable>1024M</replaceable> -t <replaceable>tap0</replaceable> -d <replaceable>guest.img</replaceable> -i -I <replaceable>FreeBSD-10.3-RELEASE-amd64-bootonly.iso</replaceable> <replaceable>guestname</replaceable></userinput></screen>

      <para>Die virtuelle Maschine wird starten und das
	Installationsprogramm ausführen.  Nachdem das System in der
	virtuellen Maschine installiert ist, werden Sie gefragt, ob
	eine Shell gestartet werden soll.  Wählen Sie
	<guibutton>Yes</guibutton>.  Es muss noch eine kleine Änderung
	vorgenommen werden, damit das System mit einer seriellen
	Konsole startet.  Bearbeiten Sie
	<filename>/etc/ttys</filename> und ersetzen Sie die vorhandene
	<literal>ttyu0</literal>-Zeile durch:</para>

      <programlisting>ttyu0   "/usr/libexec/getty 3wire"   xterm  on secure</programlisting>

      <note>
	<para>Beginnend mit &os;&nbsp;9.3-RELEASE und 10.1-RELEASE
	  wird die Konsole automatisch konfiguriert.</para>
      </note>

      <para>Starten Sie die virtuelle Maschine neu.  Ein Neustart der
	virtuellen Maschine wird <application>bhyve</application>
	beenden, aber da das <filename>vmrun.sh</filename>-Skript in
	einer Schleife läuft, wird <application>bhyve</application>
	automatisch neu gestartet.  Wenn dies passiert, wählen Sie die
	Option <literal>Reboot</literal> im Bootloader-Menü, um die
	Schleife zu unterbrechen.  Anschließend kann das Gastsystem
	von der virtuellen Festplatte gestartet werden:</para>

      <screen>&prompt.root; <userinput>sh /usr/share/examples/bhyve/vmrun.sh -c <replaceable>4</replaceable> -m <replaceable>1024M</replaceable> -t <replaceable>tap0</replaceable> -d <replaceable>guest.img</replaceable> <replaceable>guestname</replaceable></userinput></screen>
    </sect2>

    <sect2 xml:id="virtualization-bhyve-linux">
      <title>Ein &linux;-Gastsystem erstellen</title>

      <para>Um andere Betriebssysteme als &os; zu booten, muss
	zunächst der Port <package>sysutils/grub2-bhyve</package>
	installiert werden.</para>

      <para>Als nächstes erzeugen Sie eine Datei, die das Gastsystem
	als virtuelle Festplatte verwenden kann:</para>

      <screen>&prompt.root; <userinput>truncate -s <replaceable>16G</replaceable> <replaceable>linux.img</replaceable></userinput></screen>

      <para>Der Start einer virtuellen Maschine mit
	<application>bhyve</application> ist ein zweistufiger Prozess.
	Zuerst muss ein Kernel geladen werden, dann kann das
	Gastsystem gestartet werden.  Der &linux;-Kernel wird mit
	<package>sysutils/grub2-bhyve</package> geladen.  Erstellen
	Sie eine <filename>device.map</filename>, damit
	<application>grub</application> die virtuellen Geräte den
	Dateien auf dem Hostsystem zuordnen kann:</para>

      <programlisting>(hd0) ./linux.img
(cd0) ./somelinux.iso</programlisting>

      <para>Benutzen Sie <package>sysutils/grub2-bhyve</package> um
	den &linux;-Kernel vom <acronym>ISO</acronym>-Abbild zu
	laden:</para>

      <screen>&prompt.root; <userinput>grub-bhyve -m device.map -r cd0 -M <replaceable>1024M</replaceable> <replaceable>linuxguest</replaceable></userinput></screen>

      <para>Damit wird <application>grub</application> gestartet.
	Wenn die Installations-<acronym>CD</acronym> eine Datei namens
	<filename>grub.cfg</filename> enthält, wird ein Menü
	angezeigt.  Wenn nicht, müssen die Dateien
	<filename>vmlinuz</filename> und <filename>initrd</filename>
	manuell geladen werden:</para>

      <screen>grub> <userinput>ls</userinput>
(hd0) (cd0) (cd0,msdos1) (host)
grub> <userinput>ls (cd0)/isolinux</userinput>
boot.cat boot.msg grub.conf initrd.img isolinux.bin isolinux.cfg memtest
splash.jpg TRANS.TBL vesamenu.c32 vmlinuz
grub> <userinput>linux (cd0)/isolinux/vmlinuz</userinput>
grub> <userinput>initrd (cd0)/isolinux/initrd.img</userinput>
grub> <userinput>boot</userinput></screen>

      <para>Nun, da der &linux;-Kernel geladen ist, kann das
	Gastsystem gestartet werden:</para>

      <screen>&prompt.root; <userinput>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<replaceable>tap1</replaceable> -s 3:0,virtio-blk,<replaceable>./linux.img</replaceable> \
    -s 4:0,ahci-cd,<replaceable>./somelinux.iso</replaceable> -l com1,stdio -c <replaceable>4</replaceable> -m <replaceable>1024M</replaceable> <replaceable>linuxguest</replaceable></userinput></screen>

      <para>Das System wird booten und das Installtionsprogramm
	starten.  Starten Sie die virtuelle Maschine nach der
	Installation des Betriebssystems neu.  Dies führt auch dazu,
	dass <application>bhyve</application> beendet wird.  Die
	Instanz der virtuellen Maschine muss zerstört werden, bevor
	sie erneut in Betrieb genommen werden kann:</para>

      <screen>&prompt.root; <userinput>bhyvectl --destroy --vm=<replaceable>linuxguest</replaceable></userinput></screen>

      <para>Nun kann das Gastsystem direkt von der virtuellen
	Festplatte gestartet werden.  Laden Sie den Kernel:</para>

      <screen>&prompt.root; <userinput>grub-bhyve -m device.map -r hd0,msdos1 -M <replaceable>1024M</replaceable> <replaceable>linuxguest</replaceable></userinput>
grub> <userinput>ls</userinput>
(hd0) (hd0,msdos2) (hd0,msdos1) (cd0) (cd0,msdos1) (host)
(lvm/VolGroup-lv_swap) (lvm/VolGroup-lv_root)
grub> <userinput>ls (hd0,msdos1)/</userinput>
lost+found/ grub/ efi/ System.map-2.6.32-431.el6.x86_64 config-2.6.32-431.el6.x
86_64 symvers-2.6.32-431.el6.x86_64.gz vmlinuz-2.6.32-431.el6.x86_64
initramfs-2.6.32-431.el6.x86_64.img
grub> <userinput>linux (hd0,msdos1)/vmlinuz-2.6.32-431.el6.x86_64 root=/dev/mapper/VolGroup-lv_root</userinput>
grub> <userinput>initrd (hd0,msdos1)/initramfs-2.6.32-431.el6.x86_64.img</userinput>
grub> <userinput>boot</userinput></screen>

      <para>Starten Sie die virtuelle Maschine:</para>

      <screen>&prompt.root; <userinput>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<replaceable>tap1</replaceable> \$    -s 3:0,virtio-blk,<replaceable>./linux.img</replaceable> -l com1,stdio -c <replaceable>4</replaceable> -m <replaceable>1024M</replaceable> <replaceable>linuxguest</replaceable></userinput></screen>

      <para>&linux; wird jetzt in der virtuellen Maschine gestartet
	und präsentiert Ihnen vielleicht einen Anmeldeprompt.  Sie
	können sich anmelden und die virtuelle Maschine benutzen.
	Wenn Sie fertig sind, starten Sie die virtuelle Maschine neu,
	um <application>bhyve</application> zu verlassen.
	Anschließend zerstören Sie die Instanz der virtuellen
	Maschine:</para>

      <screen>&prompt.root; <userinput>bhyvectl --destroy --vm=<replaceable>linuxguest</replaceable></userinput></screen>
    </sect2>

    <sect2 xml:id="virtualization-bhyve-zfs">
      <title>Verwendung von <acronym>ZFS</acronym> mit
	<application>bhyve</application>-Gastsystemen</title>

      <para>Wenn auf dem Host-Rechner <acronym>ZFS</acronym>
	eingerichtet ist, können Sie <acronym>ZFS</acronym>-Volumes
	anstelle eines Festplattenabbilds verwenden.  Dies kann
	erhebliche Leistungsvorteile für das Gastsystem mit sich
	bringen.  Ein <acronym>ZFS</acronym>-Volume kann wie folgt
	erstellt werden:</para>

      <screen>&prompt.root; <userinput>zfs create -V<replaceable>16G</replaceable> -o volmode=dev <replaceable>zroot/linuxdisk0</replaceable></userinput></screen>

      <para>Geben Sie das <acronym>ZFS</acronym>-Volume beim Start
	der virtuellen Maschine an:</para>

      <screen>&prompt.root; <userinput>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<replaceable>tap1</replaceable> -s3:0,virtio-blk,<replaceable>/dev/zvol/zroot/linuxdisk0</replaceable> \
    -l com1,<replaceable>stdio</replaceable> -c <replaceable>4</replaceable> -m <replaceable>1024M</replaceable> <replaceable>linuxguest</replaceable></userinput></screen>
    </sect2>

    <sect2 xml:id="virtualization-bhyve-nmdm">
      <title>Konsolen in der virtuellen Maschine</title>

      <para>Es ist vorteilhaft, die
	<application>bhyve</application>-Konsole mit einem Werkzeug
	wie <package>sysutils/tmux</package> oder
	<package>sysutils/screen</package> zu bedienen.  Damit ist es
	leicht, die Konsole zu verbinden oder zu trennen.  Es ist auch
	möglich, die Konsole als Nullmodem-Gerät zu nutzen, auf das
	Sie mit <command>cu</command> zugreifen können.  Laden Sie
	dazu das <filename>nmdm</filename> Kernelmodul und ersetzen
	Sie <option>-l com1,stdio</option> mit <option>-l
	com1,/dev/nmdm0A</option>.  Die
	<filename>/dev/nmdm</filename>-Geräte werden bei Bedarf
	automatisch erstellt, jeweils paarweise, entsprechend den
	beiden Enden eines Nullmodemkabels
	(<filename>/dev/nmdm0A</filename> und
	<filename>/dev/nmdm0B</filename>).  Weitere Informationen
	finden Sie in &man.nmdm.4;.</para>

      <screen>&prompt.root; <userinput>kldload nmdm</userinput>
&prompt.root; <userinput>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<replaceable>tap1</replaceable> -s 3:0,virtio-blk,<replaceable>./linux.img</replaceable> \
    -l com1,<replaceable>/dev/nmdm0A</replaceable> -c <replaceable>4</replaceable> -m <replaceable>1024M</replaceable> <replaceable>linuxguest</replaceable></userinput>
&prompt.root; <userinput>cu -l <replaceable>/dev/nmdm0B</replaceable></userinput>
Connected

Ubuntu 13.10 handbook ttyS0

handbook login:</screen>
    </sect2>

    <sect2 xml:id="virtualization-bhyve-managing">
      <title>Virtuelle Maschinen verwalten</title>

      <para>Für jede virtuelle Maschine wird unterhalb von
	<filename>/dev/vmm</filename> ein Gerätename erzeugt.
	Dadurch kann der Administrator einfach feststellen, welche
	virtuellen Maschinen zur Zeit ausgeführt werden:</para>

      <screen>&prompt.root; <userinput>ls -al /dev/vmm</userinput>
total 1
dr-xr-xr-x   2 root  wheel    512 Mar 17 12:19 ./
dr-xr-xr-x  14 root  wheel    512 Mar 17 06:38 ../
crw-------   1 root  wheel  0x1a2 Mar 17 12:20 guestname
crw-------   1 root  wheel  0x19f Mar 17 12:19 linuxguest
crw-------   1 root  wheel  0x1a1 Mar 17 12:19 otherguest</screen>

      <para>Mit Hilfe von <command>bhyvectl</command> kann eine
	virtuelle Maschine zerstört werden:</para>

      <screen>&prompt.root; bhyvectl --destroy --vm=<replaceable>guestname</replaceable></screen>
    </sect2>

    <sect2 xml:id="virtualization-bhyve-onboot">
      <title>Persistente Konfiguration</title>

      <para>Um das System so zu konfigurieren, dass
	<application>bhyve</application>-Gastsysteme beim Booten
	gestartet werden, müssen die folgenden Konfigurationen in den
	jeweiligen Dateien vorgenommen werden:</para>

      <procedure>
	<step>
	  <title><filename>/etc/sysctl.conf</filename></title>

	  <programlisting>net.link.tap.up_on_open=1</programlisting>
	</step>

	<step>
	  <title><filename>/boot/loader.conf</filename></title>

	  <programlisting>vmm_load="YES"
nmdm_load="YES"
if_bridge_load="YES"
if_tap_load="YES"</programlisting>
	</step>

	<step>
	  <title><filename>/etc/rc.conf</filename></title>

	  <programlisting>cloned_interfaces="<replaceable>bridge0</replaceable> <replaceable>tap0</replaceable>"
ifconfig_bridge0="addm <replaceable>igb0</replaceable> addm <replaceable>tap0</replaceable>"</programlisting>
	</step>
      </procedure>
    </sect2>

<!--
    Note:  There is no working/end-user ready Xen support for FreeBSD as of 07-2010.
           Hide all information regarding Xen under FreeBSD.

    <sect2 id="virtualization-other">
      <title>Andere Virtualisierungsmöglichkeiten</title>

      <para>Zusätzlich wird
      daran gearbeitet, <application>&xen;</application> als
      funktionierende Host-Umgebung (dom0) für &os;
      verfügbar zu machen.</para>
    </sect2>
-->
  </sect1>
</chapter>

<!--
     The FreeBSD Documentation Project
     The FreeBSD German Documentation Project
     $FreeBSD$
     $FreeBSDde: de-docproj/books/handbook/printing/chapter.sgml,v 1.55 2010/12/18 13:12:46 jkois Exp $
     basiert auf: 1.123
-->

<chapter id="printing">
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Sean</firstname>
	<surname>Kelly</surname>
	<contrib>Beigetragen von </contrib>
      </author>
      <!-- 30 Sept 1995 -->
    </authorgroup>
    <authorgroup>
      <author>
	<firstname>Jim</firstname>
	<surname>Mock</surname>
	<contrib>Restrukturiert und aktualisiert durch </contrib>
	<!-- Mar 2000 -->
      </author>
    </authorgroup>
    <authorgroup>
      <author>
	<firstname>Stefan</firstname>
	<surname>Bethke</surname>
	<contrib>&Uuml;bersetzt von </contrib>
	<!-- Jan 2003 -->
      </author>
    </authorgroup>
  </chapterinfo>

  <title>Drucken</title>

  <sect1 id="printing-synopsis">
    <title>&Uuml;bersicht</title>

    <indexterm>
      <primary>LPD spooling system</primary>
    </indexterm>

    <indexterm>
      <primary>drucken</primary>
    </indexterm>

    <para>Mit &os; k&ouml;nnen Sie viele unterschiedliche Drucker
      benutzen, von den &auml;ltesten Nadeldruckern bis zu den
      neuesten Laserdruckern, und allen m&ouml;glichen Ger&auml;ten
      dazwischen.  Auf diese Weise k&ouml;nnen Sie hochwertige
      Ausdrucke mit Ihren Programmen erzeugen.</para>

    <para>Sie k&ouml;nnen &os; auch so konfigurieren, dass es
      Druckauftr&auml;ge von anderen Computern &uuml;ber Ihr lokales
      Netzwerk entgegennimmt, seien es &windows;-, &macos;- oder andere
      &os;-Computer.  &os; stellt sicher, dass die Druckauftr&auml;ge in der
      richtigen Reihenfolge bearbeitet werden und kann optional ein Deckblatt
      mit dem Namen des Auftraggebers eines Druckauftrags aufgeben.
      &os; kann auch Statistiken &uuml;ber die Computer und Benutzer
      f&uuml;hren, die Ausdrucke in Auftrag geben.</para>

    <para>In diesem Kapitel erfahren Sie, wie Sie:</para>

    <itemizedlist>
      <listitem>
	<para>&os;-Druckerwarteschlangen einrichten.</para>
      </listitem>

      <listitem>
	<para>Druckfilter installieren, die Druckauftr&auml;ge je nach
	  Bedarf besonders behandeln und z.B. Dokumente automatisch
	  in eine Form umwandeln, die Ihr Drucker versteht.</para>
      </listitem>

      <listitem>
	<para>Druckauftr&auml;ge mit einem Deckblatt versehen
	  k&ouml;nnen.</para>
      </listitem>

      <listitem>
	<para>Mit einem Drucker drucken k&ouml;nnen, der an einen
	  anderen Computer angeschlossen ist.</para>
      </listitem>

      <listitem>
	<para>Mit einem Drucker drucken k&ouml;nnen, der direkt an das
	  Netzwerk angeschlossen ist.</para>
      </listitem>

      <listitem>
	<para>die Gr&ouml;&szlig;e von Druckauftr&auml;gen
	  beschr&auml;nken k&ouml;nnen, oder bestimmte Benutzer von
	  den Benutzung des Drucksystems ausschlie&szlig;en
	  k&ouml;nnen.</para>
      </listitem>

      <listitem>
	<para>Statistiken aufzeichnen und die Benutzung des
	  Drucksystems nach Benutzern und Computern aufschl&uuml;sseln
	  k&ouml;nnen.</para>
      </listitem>

      <listitem>
	<para>Probleme beim Drucken diagnostizieren und beheben
	  k&ouml;nnen.</para>
      </listitem>
    </itemizedlist>

    <para>Bevor Sie dieses Kapitel lesen:</para>

    <itemizedlist>
      <listitem>
	<para>Machen Sie sich mit der Konfiguration und Installation
	  eines neuen Kernels vertraut (<xref
	  linkend="kernelconfig">).</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 id="printing-intro-spooler">
    <title>Einf&uuml;hrung</title>

    <para>Um einen Drucker mit &os; zu benutzen, k&ouml;nnen Sie
      das Berkeley Line Printer Spooling System, das auch als
      <application>LPD</application>-Drucksystem oder nur als
      <application>LPD</application> bekannt ist, verwenden.
      Dieses System zur Verwaltung von Druckauftr&auml;gen ist das
      Standardsystem in &os;.  Dieses Kapitel f&uuml;hrt Sie in
      <application>LPD</application> und dessen Konfiguration ein.</para>

    <para>Wenn Sie bereits mit <application>LPD</application> oder
      einem anderen Drucksystem vertraut sind, k&ouml;nnen Sie direkt
      im Abschnitt <link linkend="printing-intro-setup">Einfache
      Drucker-Konfiguration</link> weiterlesen.</para>

    <para><application>LPD</application> steuert alle Aspekte rund um
      die Drucker, die an den Computer angeschlossen sind.  Es ist
      verantwortlich f&uuml;r:</para>

    <itemizedlist>
      <listitem>
	<para>Die Zugriffskontrolle f&uuml;r direkt und &uuml;ber das
	  Netzwerk angeschlossene Drucker.</para>
      </listitem>

      <indexterm>
	<primary>Druckauftr&auml;ge</primary>
      </indexterm>

      <listitem>
	<para>Die Entgegennahme von Dateien, die gedruckt werden
	  sollen; eine so an das Drucksystem &uuml;bergebene Datei
	  wird als <emphasis>Druckauftrag</emphasis>
	  bezeichnet.</para>
      </listitem>

      <listitem>
	<para>Den gleichzeitigen Zugriff von mehreren Benutzern auf
	  einen Drucker.  Alle Druckauftr&auml;ge werden in einer
	  <emphasis>Druckerwarteschlange</emphasis> gesammelt, und
	  nacheinander abgearbeitet.</para>
      </listitem>

      <listitem>
	<para>Den Druck von <emphasis>Deckbl&auml;ttern</emphasis> (auch als
	  <emphasis>Banner-</emphasis> oder <emphasis>Burst-</emphasis>Seiten
	  bezeichnet), damit Benutzer ihre Druckauftr&auml;ge schnell innerhalb
	  eines Stapels von ausgedruckten Dokumenten finden k&ouml;nnen.</para>
      </listitem>

      <listitem>
	<para>Das Einstellen der korrekten Kommunikations-Parameter
	  f&uuml;r Drucker, die seriell angeschlossen sind.</para>
      </listitem>

      <listitem>
	<para>Das Senden von Druckauftr&auml;gen an ein
	  <application>LPD</application>-System auf einem anderen
	  Computer.</para>
      </listitem>

      <listitem>
	<para>Das Ausf&uuml;hren von speziellen Filtern, um
	  Druckauftr&auml;ge in die unterschiedlichen
	  Seitenbeschreibungssprachen umzusetzen oder an die
	  F&auml;higkeiten eines Druckers anzupassen.</para>
      </listitem>

      <listitem>
	<para>Das Erfassen von Verrechnungsdaten f&uuml;r
	  Druckauftr&auml;ge.</para>
      </listitem>
    </itemizedlist>

    <para>Sie k&ouml;nnen <application>LPD</application> alle diese
      Funktionen, oder auch nur einen Teil davon, ausf&uuml;hren
      lassen, indem Sie die Konfigurationsdatei
      (<filename>/etc/printcap</filename>) anpassen, und indem Sie
      spezielle Filterprogramme bereitstellen.</para>

    <sect2 id="printing-intro-why">
      <title>Vorteile des Drucksystems</title>

      <para>Wenn Sie der einzige Benutzer sind, der mit Ihrem Computer
	arbeitet, fragen Sie sich vielleicht, warum Sie die
	Konfigurationsarbeit f&uuml;r das Drucksystem auf sich nehmen
	sollten, wenn Sie Deckbl&auml;tter, Abrechnungsdaten oder
	Zugriffskontrolle nicht ben&ouml;tigen.  Obwohl Sie direkt auf den
	Drucker zugreifen k&ouml;nnen, bietet <application>LPD</application>
	eine Reihe von Vorteilen:
	</para>

      <itemizedlist>
	<listitem>
	  <para><application>LPD</application> druckt im Hintergrund;
	    Sie m&uuml;ssen nicht erst darauf warten, dass Ihr
	    Druckauftrag an den Drucker &uuml;bermittelt worden
	    ist.</para>
	</listitem>

	<indexterm>
	  <primary>&tex;</primary>
	</indexterm>

	<listitem>
	  <para><application>LPD</application> kann Druckauftr&auml;ge
	    mit Kopf- oder Fu&szlig;zeilen versehen, oder ein spezielles
	    Dateiformat, wie DVI von &tex;, automatisch in ein f&uuml;r
	    den Drucker verst&auml;ndliches Format umwandeln;
	    Sie m&uuml;ssen diese Schritte nicht manuell
	    ausf&uuml;hren.</para>
	</listitem>

	<listitem>
	  <para>Viele freie und kommerzielle Programme, mit denen Sie
	    drucken k&ouml;nnen, erwarten, mithilfe des
	    <application>LPD</application>-Drucksystems zu drucken.
	    Wenn Sie das Drucksystem konfiguriert haben, k&ouml;nnen
	    Sie einfacher mit neuer oder auch vorhandener Software
	    drucken.</para>
	</listitem>
      </itemizedlist>
    </sect2>
  </sect1>

  <sect1 id="printing-intro-setup">
    <title>Grund-Konfiguration</title>

    <warning>
      <para>Mit &os;&nbsp;8.0 wurden die Ger&auml;tedateien f&uuml;r
	serielle Ports von
	<filename>/dev/ttyd<replaceable>N</replaceable></filename> in
	<filename>/dev/ttyu<replaceable>N</replaceable></filename>
	umbenannt.  Setzen Sie noch &os;&nbsp;7.X ein, m&uuml;ssen
	Sie die Befehle in den folgenden Abschnitten entsprechend
	anpassen.</para>
    </warning>

    <para>Um einen Drucker mit dem
      <application>LPD</application>-Drucksystem benutzen zu
      k&ouml;nnen, m&uuml;ssen Sie sowohl Ihren Drucker und die
      Drucker-Schnittstelle als auch das
      <application>LPD</application>-Drucksystem konfigurieren.
      Dieser Abschnitt beschreibt zwei Konfigurationen:</para>

    <itemizedlist>
      <listitem>
	<para>Abschnitt <link linkend="printing-simple">Einfache
	  Drucker-Konfiguration</link> beschreibt, wie Sie einen
	  Drucker an Ihren Computer anschlie&szlig;en und
	  <application>LPD</application> so konfigurieren, dass
	  Sie Textdateien zum Drucker senden k&ouml;nnen.</para>
      </listitem>

      <listitem>
	<para>Abschnitt <link linkend="printing-advanced">Erweiterte
	  Drucker-Konfiguration</link> beschreibt, wie Sie mit
	  speziellen Dateiformaten umgehen k&ouml;nnen, wie Sie
	  Deckbl&auml;tter drucken k&ouml;nnen, wie Sie den Zugriff auf
	  Drucker einschr&auml;nken k&ouml;nnen, und wie Sie
	  Verrechnungsdaten aufzeichnen k&ouml;nnen.</para>
      </listitem>
    </itemizedlist>

    <sect2 id="printing-simple">
      <title>Einfache Drucker-Konfiguration</title>

      <para>Dieser Abschnitt beschreibt, wie Sie die
	<application>LPD</application>-Software konfigurieren, um
	Ihren Drucker zu benutzen.  Diese Grundlagen werden
	erkl&auml;rt:</para>

      <itemizedlist>
	<listitem>
	  <para>Abschnitt <link
	    linkend="printing-hardware">Hardware-Konfiguration</link>
	    erl&auml;utert, wie Sie Ihren Drucker an Ihren Computer
	    anschlie&szlig;en k&ouml;nnen.</para>
	</listitem>

	<listitem>
	  <para>Abschnitt <link
	    linkend="printing-software">Software-Konfiguration</link>
	    erkl&auml;rt, wie Sie die
	    <application>LPD</application>-Konfigurationsdatei
	    (<filename>/etc/printcap</filename>) anpassen.</para>
	</listitem>
      </itemizedlist>

      <para>Wenn Sie einen Drucker einrichten m&ouml;chten, der
	&uuml;ber das Netzwerk angeschlossen ist (anstatt &uuml;ber
	die serielle oder parallele Schnittstelle), lesen Sie bitte
	Abschnitt <link
	linkend="printing-advanced-network-net-if">Drucker mit
	direkter TCP-Schnittstelle</link>.</para>

      <para>Obwohl dieser Abschnitt <quote>Grund-Konfiguration</quote>
	hei&szlig;t, ist die Konfiguration relativ komplex.  Es ist
	vergleichsweise schwierig, einen Drucker mit Ihrem Computer
	und dem <application>LPD</application>-Drucksystem zu
	verbinden.  Die weiteren Optionen, wie Kopfzeilen oder
	Deckbl&auml;tter, sind einfach zu konfigurieren, sobald die
	Grund-Konfiguration erfolgreich abgeschlossen ist.</para>

      <sect3 id="printing-hardware">
	<title>Hardware-Konfiguration</title>

	<para>Dieser Abschnitt beschreibt, &uuml;ber welche
	  Schnittstellen Sie einen Drucker mit Ihrem Computer
	  verbinden k&ouml;nnen.  Er behandelt sowohl die
	  Schnittstellen und Kabel, als auch die Kerneloptionen, die
	  Sie ben&ouml;tigen, um &os; mit Ihrem Drucker
	  kommunizieren zu lassen.</para>

	<para>Wenn Sie Ihren Drucker bereits erfolgreich mit einem
	  anderen Betriebssystem auf Ihrem PC eingesetzt haben,
	  k&ouml;nnen Sie wahrscheinlich mit dem Abschnitt <link
	  linkend="printing-software">Software-Konfiguration</link>
	  fortfahren.</para>

	<sect4 id="printing-ports">
	  <title>Schnittstellen und Kabel</title>

	  <para>Praktisch alle Drucker unterst&uuml;tzen mindestens
	    eine dieser Schnittstellen:</para>

	  <itemizedlist>
	    <indexterm>
	      <primary>Drucker</primary>
	      <secondary>serielle</secondary>
	    </indexterm>

	    <listitem>
	      <para><emphasis>Seriell</emphasis> angeschlossene
		Drucker werden &uuml;ber eine serielle Schnittstelle
		(auch RS-232 oder COM-Schnittstelle genannt)
		mit Ihrem Computer verbunden.  Diese Schnittstelle wird
		von vielen unterschiedlichen Systemen verwendet.
		Serielle Kabel sind leicht erh&auml;ltlich und
		k&ouml;nnen auch einfach selbst hergestellt werden.
		Einige Drucker erfordern m&ouml;glicherweise ein
		spezielles Kabel oder besondere
		Kommunikationseinstellungen.  Die meisten seriellen
		Schnittstellen von PCs besitzen eine maximale
		Daten&uuml;bertragungsrate von 115200&nbsp;bps;
		zum Ausdruck gro&szlig;er Grafiken sind serielle
		Drucker daher ungeeignet.</para>
	    </listitem>

	    <indexterm>
	      <primary>Drucker</primary>
	      <secondary>parallele</secondary>
	    </indexterm>

	    <listitem>
	      <para><emphasis>Parallel</emphasis> angeschlossene
		Drucker werden &uuml;ber eine parallele Schnittstelle
		mit Ihrem Computer verbunden.  Diese Schnittstelle wird
		haupts&auml;chlich von PCs und Workstations benutzt.
		Die Schnittstelle bietet eine h&ouml;here
		Daten&uuml;bertragungsrate als serielle Schnittstellen.
		Kabel sind leicht erh&auml;ltlich, sind aber
		vergleichsweise schwer selbst herzustellen.
		&Uuml;blicherweise brauchen keine Kommunikationsparameter
		festgelegt zu werden; dies macht die Einrichtung sehr
		einfach.</para>

	      <indexterm>
		<primary>Centronics</primary>
		<see>Drucker, parallele</see>
	      </indexterm>

	      <para>Die parallele Schnittstelle wird auch als
		<quote>Centronics</quote>-Schnittstelle bezeichnet,
		nach dem Namen des Steckverbinders, der hier
		h&auml;ufig zum Einsatz kommt.</para>
	    </listitem>

	    <indexterm>
	      <primary>Drucker</primary>
	      <secondary>USB</secondary>
	    </indexterm>

	    <listitem>
	      <para>USB-Schnittstelle (Universal Serial Bus) bieten noch
	        h&ouml;here Geschwindigkeiten als parallele Schnittstellen
	        oder serielle RS-232-Schnittstellen. USB-Kabel sind einfach
	        und billig.  Zum Drucken ist die USB-Schnittstelle besser
	        geeignet als serielle oder parallele Schnittstellen, auf
		vielen &unix; Systemen werden USB-Schnittstellen jedoch nur
		unzureichend unterst&uuml;tzt.  Um Probleme zu vermeiden,
		sollten Sie sich einen Drucker anschaffen, der sowohl eine
		USB-Schnittstelle als auch eine parallele Schnittstelle besitzt
		(viele Drucker besitzen heute beide Schnittstellen).</para>
	    </listitem>
	  </itemizedlist>

	  <para>Im Allgemeinen versenden parallele Schnittstellen Daten nur in
	    eine Richtung (vom Computer zum Drucker), serielle Schnittstellen
	    und USB-Schnittstellen versenden Daten in beide Richtungen.
	    Moderne parallele Schnittstellen (EPP and ECP) &uuml;bertragen
	    Daten bi-direktional nach dem Standard IEEE&nbsp;1284.</para>

	  <indexterm>
	    <primary>PostScript</primary>
	  </indexterm>

	  <para>Ein Drucker kann auf zwei Arten bi-direktional
	    angesprochen werden.  Die erste Methode benutzt einen
	    Druckertreiber, der die herstellerspezifische Sprache
	    des Druckers beherrscht.  Diese Methode wird oft mit
	    Tintenstrahl-Druckern eingesetzt und dazu benutzt,
	    den F&uuml;llstand der Tintenpatronen und andere
	    Status-Informationen auszugeben.  Die zweite Methode
	    wird benutzt, wenn der Drucker &postscript; beherrscht.</para>

	  <para>Da ein &postscript;-Druckauftrag ein komplettes Programm
	    ist, kann es auch Daten an den Computer zur&uuml;ckliefern, ohne
	    &uuml;berhaupt eine Seite Papier zu bedrucken.  Auf diesem Wege
	    werden auch Probleme wie z.B. ein Papierstau vom Drucker an den
	    Computer &uuml;bermittelt.  Dar&uuml;berhinaus ist dies
	    die effektivste Methode, um die tats&auml;chlich gedruckte
	    Anzahl an Seiten vom Drucker abzufragen:  ein &postscript;-Programm
	    ermittelt jeweils vor und direkt nach einem Druckauftrag den
	    Seitenz&auml;hler des Druckers, und vergleicht die beiden
	    Z&auml;hlerwerte.</para>
	</sect4>

	<sect4 id="printing-parallel">
	  <title>Parallele Schnittstellen</title>

	  <para>Um einen Drucker mit paralleler Schnittstelle an Ihren
	    Computer anzuschlie&szlig;en, verbinden Sie den Drucker
	    mit einer parallelen Schnittstelle Ihres Computers.  Die
	    Dokumentation zu Ihrem Drucker oder Computer sollte Ihnen
	    hier weiterhelfen.</para>

	  <para>Notieren Sie sich, mit welcher parallelen Schnittstelle des
	    Computers Sie den Drucker verbunden haben.  Die meisten Computer
	    haben lediglich eine parallele Schnittstelle.
	    Der &os;-Ger&auml;tename der ersten Schnittstelle lautet <filename
	    class="devicefile">ppc0</filename>, der der zweiten <filename
	    class="devicefile">ppc1</filename>, und so weiter.  Der
	    Ger&auml;tename f&uuml;r den Drucker an der ersten parallelen
	    Schnittstelle folgt dem selben Schema und lautet <filename
	    class="devicefile">/dev/lpt0</filename>, usw.</para>
	</sect4>

	<sect4 id="printing-serial">
	  <title>Serielle Schnittstellen</title>

	  <para>Um einen Drucker mit serieller Schnittstelle an Ihren
	    Computer anzuschlie&szlig;en, verbinden Sie den Drucker
	    mit einer seriellen Schnittstelle Ihres Computers.  Die
	    Dokumentation zu Ihrem Drucker oder Computer sollte Ihnen
	    hier weiterhelfen.</para>

	  <para>Sollten Sie sich nicht sicher sein, welches das
	    <quote>richtige Kabel</quote> ist, k&ouml;nnen Sie eine
	    dieser Alternativen ausprobieren:</para>

	  <itemizedlist>
	    <listitem>
	      <para>Ein <emphasis>Modemkabel</emphasis> verbindet alle
		Anschl&uuml;sse an einem Ende des Kabels eins-zu-eins
		mit den Anschl&uuml;ssen am anderen Ende des Kabels.
		Ein solches Kabel wird auch als (engl.)
		<quote>DTE-to-DCE-</quote> oder
		<quote>DEE-zu-D&Uuml;E-</quote>Kabel
		bezeichnet.</para>
	    </listitem>

	    <indexterm>
	      <primary>Nullmodemkabel</primary>
	    </indexterm>

	    <listitem>
	      <para>Ein <emphasis>Nullmodemkabel</emphasis> verbindet
		einige Signale eins-zu-eins, andere &uuml;ber Kreuz
		(z.B. Sende- und Empfangsleitung), und verbindet
		einige weitere direkt im Stecker miteinander.  Ein
		solches Kabel wird auch als (engl.)
		<quote>DTE-to-DTE-</quote> oder
		<quote>DEE-zu-DEE-</quote>Kabel bezeichnet.</para>
	    </listitem>

	    <listitem>
	      <para>Ein <emphasis>Serielles Druckerkabel</emphasis>
		schlie&szlig;lich, das f&uuml;r einige spezielle
		Drucker ben&ouml;tigt wird, verbindet zus&auml;tzliche
		Signale miteinander, anstatt sie im Stecker
		zur&uuml;ckzuf&uuml;hren.</para>
	    </listitem>
	  </itemizedlist>

	  <indexterm>
	    <primary>Baudrate</primary>
	  </indexterm>
	  <indexterm>
	    <primary>Parit&auml;t</primary>
	  </indexterm>
	  <indexterm>
	    <primary>Flusssteuerung</primary>
	  </indexterm>

	  <para>Sie sollten auch die Kommunikationsparameter am
	    Drucker einstellen; &uuml;blicherweise gibt es dazu
	    DIP-Schalter, oder eine Option in der Men&uuml;f&uuml;hrung am
	    Drucker.  W&auml;hlen Sie die h&ouml;chste
	    <emphasis>Bitrate</emphasis> (auch als <literal>bps</literal>
	    Bits pro Sekunde oder <emphasis>Baudrate</emphasis> bezeichnet),
	    die sowohl Ihr Drucker als auch Ihr Computer unterst&uuml;tzen.
	    W&auml;hlen Sie 7 oder 8 Bits, gerade, ungerade oder keine
	    Parit&auml;t, und ein oder zwei Stoppbits.  W&auml;hlen
	    Sie die Art der Flusssteuerung: keine, XON/XOFF (auch
	    als <quote>in-band-</quote> oder
	    <quote>Software</quote>-Flusssteuerung bezeichnet),
	    oder Hardware.  Notieren Sie sich diese Einstellungen, damit Sie
	    sie sp&auml;ter bei der Software-Konfiguration zur Verf&uuml;gung
	    haben.</para>
	</sect4>
      </sect3>

      <sect3 id="printing-software">
	<title>Software-Konfiguration</title>

	<para>Dieser Abschnitt beschreibt die notwendigen
	  Konfigurationsschritte, damit Sie mit dem
	  &os;-<application>LPD</application>-System drucken
	  k&ouml;nnen.</para>

	<para>Diese Schritte m&uuml;ssen Sie ausf&uuml;hren:</para>

	<procedure>
	  <step>
	    <para>Konfigurieren Sie Ihren Kernel, soweit notwendig, um
	      die Schnittstelle benutzen zu k&ouml;nnen, an die Ihr
	      Drucker angeschlossen ist.  Abschnitt <link
	      linkend="printing-kernel">Kernel-Konfiguration</link>
	      erkl&auml;rt, welche Optionen Sie
	      ben&ouml;tigen.</para>
	  </step>

	  <step>
	    <para>Konfigurieren Sie die Kommunikationseinstellungen
	      f&uuml;r die parallele Schnittstelle, sofern Sie sie
	      benutzen.  Abschnitt <link
	      linkend="printing-parallel-port-mode">Kommunikationseinstellungen
	      f&uuml;r die parallele Schnittstelle</link> enth&auml;lt
	      die Details.</para>
	  </step>

	  <step>
	    <para>Pr&uuml;fen Sie, ob Sie Daten an den Drucker senden
	      k&ouml;nnen.  Abschnitt <link
	      linkend="printing-testing">Pr&uuml;fen der
	      Drucker-Kommunikation</link> f&uuml;hrt eine Reihe von
	      M&ouml;glichkeiten auf.</para>
	  </step>

	  <step>
	    <para>Konfigurieren Sie <application>LPD</application>
	      f&uuml;r Ihren Drucker, indem Sie die Konfigurationsdatei
	      <filename>/etc/printcap</filename> anpassen.  Details dazu finden
	      Sie im Abschnitt <link
	      linkend="printing-printcap"><application>LPD</application>
	      aktivieren: die
	      <filename>/etc/printcap</filename>-Datei</link>.</para>
	  </step>
	</procedure>

	<sect4 id="printing-kernel">
	  <title>Kernel-Konfiguration</title>

	  <para>Der Betriebssystem-Kernel ist f&uuml;r eine bestimmte
	    Kombination aus Ger&auml;ten kompiliert.  Dies schlie&szlig;t
	    Ihre seriellen oder parallelen Schnittstellen mit ein.
	    Dementsprechend kann es notwendig sein, die Kernelkonfiguration um
	    weitere Schnittstellen zu erweitern.</para>

	  <para>So k&ouml;nnen Sie pr&uuml;fen, ob Ihr Kernel die
	    serielle Schnittstelle unterst&uuml;tzt, an die Sie den
	    Drucker angeschlossen haben:</para>

	  <screen>&prompt.root; <userinput><command>grep sio<replaceable>N</replaceable> <filename>/var/run/dmesg.boot</filename></command></userinput></screen>

	  <para>Ersetzen Sie <replaceable>N</replaceable> durch die
	    Nummer der seriellen Schnittstelle, beginnend bei Null.
	    Wenn Sie eine Ausgabe &auml;hnlich der folgenden erhalten,
	    unterst&uuml;tzt ihr Kernel diese Schnittstelle:</para>

	  <screen>sio2 at port 0x3e8-0x3ef irq 5 on isa
sio2: type 16550A</screen>

	  <para> Erhalten Sie keine Ausgabe, oder eine Fehlermeldung,
	    wird die Schnittstelle nicht korrekt unterst&uuml;tzt.</para>

	  <para>So k&ouml;nnen Sie pr&uuml;fen, ob Ihr Kernel die
	    parallele Schnittstelle unterst&uuml;tzt, an die Sie den
	    Drucker angeschlossen haben:</para>

	  <screen>&prompt.root; <userinput>grep ppc<replaceable>N</replaceable> /var/run/dmesg.boot</userinput></screen>

	  <para>Ersetzen Sie <replaceable>N</replaceable> durch die
	    Nummer der parallelen Schnittstelle, beginnend bei Null.
	    Wenn Sie eine Ausgabe &auml;hnlich der folgenden erhalten,
	    unterst&uuml;tzt ihr Kernel diese Schnittstelle:</para>

	  <screen>ppc0: &lt;Parallel port&gt; at port 0x378-0x37f irq 7 on isa0
ppc0: SMC-like chipset (ECP/EPP/PS2/NIBBLE) in COMPATIBLE mode
ppc0: FIFO with 16/16/8 bytes threshold</screen>

	  <para> Erhalten Sie keine Ausgabe, oder eine Fehlermeldung,
	    wird die Schnittstelle nicht korrekt unterst&uuml;tzt.</para>

	  <para>Gegebenenfalls m&uuml;ssen Sie Ihren Kernel
	    umkonfigurieren und neu kompilieren, damit die von Ihnen
	    gew&auml;hlte Schnittstelle unterst&uuml;tzt wird.</para>

	  <para>Um Unterst&uuml;tzung f&uuml;r eine serielle Schnittstelle
	    hinzuzuf&uuml;gen, lesen Sie bitte Kapitel <link
	    linkend="kernelconfig">Konfiguration des &os; Kernels</link>.
	    Um eine parallele Schnittstelle hinzuzuf&uuml;gen, lesen Sie bitte
	    ebenfalls jenes Kapitel als auch den folgenden Abschnitt <link
	    linkend="printing-parallel-port-mode">Kommunikationseinstellungen
	    f&uuml;r die parallele Schnittstelle</link>.</para>
	</sect4>
      </sect3>

      <sect3 id="printing-parallel-port-mode">
	  <title>Kommunikationseinstellungen f&uuml;r die parallele
	    Schnittstelle</title>

	  <para>Wenn Sie die parallele Schnittstelle zur Kommunikation
	    mit Ihrem Drucker benutzen, haben Sie die Wahl zwischen
	    Interrupt-gesteuerter oder Polling-Daten&uuml;bertragung.
	    Der generische Druckerger&auml;tetreiber &man.lpt.4; in
	    &os; benutzt das &man.ppbus.4;-System, das die parallele
	    Schnittstelle mithilfe des &man.ppc.4;-Treibers steuert.</para>

	  <itemizedlist>
	    <listitem>
	      <para>Die <emphasis>Interrupt-gesteuerte</emphasis>
		Daten&uuml;bertragung ist die Voreinstellung im
		GENERIC-Kernel.  Der Treiber benutzt eine IRQ-Leitung,
		um zu erfahren, wann der Drucker weitere Daten
		empfangen kann.</para>
	    </listitem>

	    <listitem>
	      <para>Bei der <emphasis>Polling-Methode</emphasis>
	        pr&uuml;ft der Treiber in regelm&auml;&szlig;igen
		Abst&auml;nden, ob weitere Daten &uuml;bertragen
		werden k&ouml;nnen.</para>
	    </listitem>
	  </itemizedlist>

	  <para>Die Interrupt-gesteuerte Methode ist
	    &uuml;berlicherweise schneller und verbraucht weniger
	    Rechenzeit als die Polling-Methode, es wird jedoch eine
	    eigene IRQ-Leitung f&uuml;r die Schnittstelle
	    ben&ouml;tigt.  Dar&uuml;berhinaus kann es mit einigen
	    Druckermodellen zu Problemen kommen, wenn die
	    Interrupt-gesteuerte &Uuml;bertragung zum Einsatz
	    kommt.</para>

	  <para>Die k&ouml;nnen die Kommunikationseinstellung entweder
	    in der Kernel-Konfiguration w&auml;hlen, oder mittels des
	    &man.lptcontrol.8;-Programms zur Laufzeit
	    einstellen.</para>

	  <para><emphasis>So legen Sie die Kommunikationseinstellung
	    in der Kernel-Konfiguration fest:</emphasis></para>

	  <procedure>
	    <step>
	      <para>&Auml;ndern Sie Ihre Kernel-Konfigurationsdatei.
		Finden Sie die Zeile, die mit <literal>device
		ppc0</literal> beginnt.  Wenn Sie die zweite parallele
		Schnittstelle konfigurieren m&ouml;chten, suchen Sie
		nach <literal>device ppc1</literal>, f&uuml;r die
		dritte Schnittstelle <literal>ppc2</literal>,
		usw.</para>

	      <itemizedlist>
		<listitem>
		  <para>Um die Interrupt-Steuerung zu aktivieren,
		    passen Sie die folgende Zeile an:</para>

		  <programlisting>hint.ppc.0.irq="<replaceable>N</replaceable>"</programlisting>

		  <para>Ersetzen Sie <replaceable>N</replaceable>
		    durch die Nummer der IRQ-Leitung, die dieser
		    parallelen Schnittstelle zugewiesen ist.  Stellen
		    Sie sicher, dass Ihre Kernel-Konfigurationsdatei den
		    &man.ppc.4;-Treiber enth&auml;lt:</para>

		  <screen>device ppc</screen>
		</listitem>

		<listitem>
		  <para>Wenn Sie den Polling-Modus verwenden
		    m&ouml;chten, entfernen Sie die folgende Zeile
		    aus <filename>/boot/device.hints</filename>:</para>

		  <programlisting>hint.ppc.0.irq="<replaceable>N</replaceable>"</programlisting>

		  <para>Sollte der Treiber die Schnittstelle dennoch
		    im Interrupt-Modus betreiben, k&ouml;nnte dies an
		    der Aktivierung durch das &man.acpi.4;-System in
		    &os; liegen.  Bitte pr&uuml;fen Sie die
		    ACPI- und die BIOS-Konfiguration.</para>
		</listitem>
	      </itemizedlist>
	    </step>

	    <step>
	      <para>Wenn Sie Ihre Kernel-Konfigurationsdatei angepasst
		haben, kompilieren und installieren Sie nun einen
		neuen Kernel.  Das Kapitel <link
		linkend="kernelconfig">Konfiguration des
		&os;-Kernels</link> enth&auml;lt weitere Details dazu.</para>
	    </step>
	  </procedure>

	  <para><emphasis>So k&ouml;nnen Sie die Kommunikationseinstellung
	    mit</emphasis>&man.lptcontrol.8;
	    <emphasis>&auml;ndern:</emphasis></para>

	  <procedure>
	    <step>
	      <para>Um die Interrupt-Steuerung f&uuml;r die
		Schnittstelle <replaceable>N</replaceable> zu
		aktivieren, geben Sie ein:</para>

	      <screen>&prompt.root; <userinput><command>lptcontrol <option>-i</option> <option>-d</option> <filename class="devicefile">/dev/lpt<replaceable>N</replaceable></filename></command></userinput></screen>
	    </step>

	    <step>
	      <para>Um den Polling-Modus f&uuml;r die Schnittstelle
		<replaceable>N</replaceable> zu aktivieren, geben Sie
		ein:</para>

	      <screen>&prompt.root; <userinput><command>lptcontrol <option>-p</option> <option>-d</option> <filename class="devicefile">/dev/lpt<replaceable>N</replaceable></filename></command></userinput></screen>
	    </step>
	  </procedure>

	  <para>Sie k&ouml;nnen diesen Befehl in
	    <filename>/etc/rc.local</filename> aufnehmen, damit er bei
	    jedem Systemstart automatisch ausgef&uuml;hrt wird.
	    &man.lptcontrol.8; enth&auml;lt weitere Informationen.</para>
     </sect3>

     <sect3 id="printing-testing">
	  <title>Kommunikation mit den Drucker pr&uuml;fen</title>

	  <para>Bevor Sie mit der Konfiguration des
	    <application>LPD</application>-Drucksystems fortfahren,
	    sollten Sie sicherstellen, das Sie erfolgreich Daten an
	    Ihren Drucker senden k&ouml;nnen.  Es ist deutlich
	    einfacher, Kommunikations- und Konfigurationsprobleme
	    unabh&auml;ngig voneinander zu l&ouml;sen.</para>

	  <para>Der Drucker kann mit einem Probeausdruck getestet werden.
	    F&uuml;r alle Drucker, die normalen Text unmittelbar drucken
	    k&ouml;nnen, bietet sich das Programm &man.lptest.1; an: es
	    produziert alle 96 druckbaren ASCII-Zeichen auf 96 Zeilen.</para>

	  <indexterm>
	    <primary>PostScript</primary>
	  </indexterm>

	  <para>F&uuml;r einen &postscript;-Drucker (oder andere
	    Drucker, die eine Seitenbeschreibungssprache verwenden)
	    muss ein passendes Programm an den Drucker gesendet
	    werden, z.B. dieses:</para>

	  <programlisting>%!PS
100 100 moveto 300 300 lineto stroke
310 310 moveto /Helvetica findfont 12 scalefont setfont
(Funktioniert dieser Drucker?) show
showpage</programlisting>

	  <para>Sie k&ouml;nnen dieses ProstScript-Programm in einer
	    Datei speichern, und mit den Beispielen in den folgenden
	    Abschnitt verwenden.</para>

	  <indexterm>
	    <primary>PCL</primary>
	  </indexterm>

	  <note>
	    <para>Nicht alle Drucker, die eine Seitenbeschreibungssprache
	      verwenden, ben&ouml;tigen ein Test-Programm: z.B. HPs PCL
	      (das auch in vielen kompatiblen Druckern zum Einsatz zu kommt),
	      versteht normalen Text.  Besondere Escape-Sequenzen werden
	      benutzt, um die erweiterten M&ouml;glichkeiten aufzurufen.
	      &postscript;-Drucker k&ouml;nnen in der Regel keinen normalen
	      Text direkt verarbeiten, weil sie ein &postscript;-Programm
	      erwarten, das eine Seite produziert.</para>
	  </note>

	<sect4 id="printing-checking-parallel">
	    <title>Einen Paralleldrucker pr&uuml;fen</title>

	    <indexterm>
	      <primary>Drucker</primary>
	      <secondary>parallele</secondary>
	    </indexterm>

	    <para>Dieser Abschnitt f&uuml;hrt vor, wie Sie die
	      Kommunikation mit Ihrem Drucker &uuml;ber die parallele
	      Schnittstelle pr&uuml;fen k&ouml;nnen.</para>

	    <para><emphasis>So testen Sie einen Drucker an einer
	      parallelen Schnittstelle:</emphasis></para>

	    <procedure>
	      <step>
		<para>Werden Sie <username>root</username> mithilfe
		  des &man.su.1;-Befehls.</para>
	      </step>

	      <step>
		<para>Senden Sie Testdaten an den Drucker.</para>

		<itemizedlist>
		  <listitem>
		    <para>Wenn Ihr Drucker reinen Text direkt drucken
		      kann, verwenden Sie &man.lptest.1;:</para>

		    <screen>&prompt.root; <userinput>lptest &gt; /dev/lpt<replaceable>N</replaceable></userinput></screen>

		    <para>Ersetzen Sie <replaceable>N</replaceable>
		      durch die Nummer der parallelen Schnittstelle,
		      an die der Drucker angeschlossen ist (angefangen
		      bei Null).</para>
		  </listitem>

		  <listitem>
		    <para>Wenn Ihr Drucker &postscript; (oder eine
		      andere Seitenbeschreibungssprache) versteht,
		      senden Sie ein passendes Testprogramm an den
		      Drucker.  Geben Sie folgenden Befehl ein:</para>

		    <screen>&prompt.root; <userinput><command>cat <filename><replaceable>file</replaceable></filename> &gt; <filename class="devicefile">/dev/lpt<replaceable>N</replaceable></filename></command></userinput></screen>

		    <para>Ersetzen Sie <replaceable>N</replaceable>
		      durch die Nummer der parallelen Schnittstelle,
		      an die der Drucker angeschlossen ist (angefangen
		      bei Null).  Geben Sie nun das Testprogramm ein,
		      Zeile f&uuml;r Zeile.  Kontrollieren Sie jede
		      Zeile, bevor Sie die Eingabetaste dr&uuml;cken:
		      Sie k&ouml;nnen die Zeile sp&auml;ter nicht mehr
		      &auml;ndern.  Zum Schluss tippen Sie
		      <keycombo action="simul">
			<keycap>Ctrl</keycap>
			<keycap>D</keycap>
		      </keycombo>.
		      Wenn Sie ein anderes Zeichen nutzen, um das Ende
		      der Datei anzuzeigen, m&uuml;ssen Sie
		      nat&uuml;rlich die entsprechende
		      Tastenkombination f&uuml;r dieses Zeichen
		      bet&auml;tigen.</para>

		    <para>Sie k&ouml;nnen das Testprogramm auch in
		      einer Datei speichern, und dann diesen Befehl
		      aufrufen:</para>

		    <screen>&prompt.root; <userinput>cat <replaceable>Testprogramm</replaceable> &gt; /dev/lpt<replaceable>N</replaceable></userinput></screen>

		    <para>Ersetzen Sie <replaceable>Testprogramm</replaceable>
		      durch den Dateinamen, unter dem Sie das Testprogramm
		      gespeichert haben.</para>
		  </listitem>
		</itemizedlist>
	      </step>
	    </procedure>

	    <para>Der Drucker sollte einige Zeilen oder eine Seite
	      drucken.  Machen Sie sich keine Sorgen &uuml;ber falsche
	      Formatierungen: die Software-Konfiguration enth&auml;lt
	      Informationen zum Umformatieren von Druckauftr&auml;gen.</para>
	</sect4>

	<sect4 id="printing-checking-serial">
	    <title>Einen seriellen Drucker pr&uuml;fen</title>

	    <indexterm>
	      <primary>Drucker</primary>
	      <secondary>serielle</secondary>
	    </indexterm>

	    <para>Dieser Abschnitt f&uuml;hrt vor, wie Sie die Kommunikation
	      mit Ihrem Drucker &uuml;ber die parallele Schnittstelle
	      pr&uuml;fen k&ouml;nnen.</para>

	    <para><emphasis>So testen Sie einen Drucker an einer
	      seriellen Schnittstelle:</emphasis></para>

	    <procedure>
	      <step>
		<para>Werden Sie <username>root</username> mithilfe
		  des &man.su.1;-Befehls.</para>
	      </step>

	      <step>
		<para>&Auml;ndern Sie die Datei
		  <filename>/etc/remote</filename>.  F&uuml;gen Sie
		  den folgenden Eintrag hinzu:</para>

		<programlisting>printer:dv=<filename class="devicefile">/dev/<replaceable>port</replaceable></filename>:br#<replaceable>bps-rate</replaceable>:pa=<replaceable>parity</replaceable></programlisting>

		<indexterm>
		  <primary>Baudrate</primary>
		</indexterm>
		<indexterm>
		  <primary>serieller Anschluss</primary>
		</indexterm>
		<indexterm>
		  <primary>Parit&auml;t</primary>
		</indexterm>

		<para>Ersetzen Sie
		  <replaceable>Ger&auml;t</replaceable> durch den
		  Ger&auml;tenamen der seriellen Schnittstelle
		  (<literal>ttyu0</literal> f&uuml;r die erste,
		  <literal>ttyu1</literal> f&uuml;r die zweite, usw.),
		  <replaceable>Baudrate</replaceable> ist die
		  Geschwindigkeit und
		  <replaceable>Parit&auml;t</replaceable> die
		  Parit&auml;t (<literal>even</literal> f&uuml;r
		  gerade, <literal>odd</literal> f&uuml;r ungerade
		  oder <literal>none</literal> f&uuml;r keine), die
		  Sie am Drucker eingestellt haben.</para>

		<para>Hier ein Beispieleintrag f&uuml;r einen Drucker,
		  der &uuml;ber die dritte serielle Schnittstelle
		  angeschlossen ist, mit 19.200&nbsp;Baud kommuniziert und
		  keine Parit&auml;t verwendet:</para>

		<programlisting>printer:dv=<filename class="devicefile">/dev/ttyu2</filename>:br#19200:pa=none</programlisting>
	      </step>

	      <step>
		<para>Verbinden Sie sich mit dem Drucker &uuml;ber den
		  Befehl &man.tip.1;:</para>

		<screen>&prompt.root; <userinput><command>tip</command> printer</userinput></screen>

		<para>Kommt es hierbei zu einer Fehlermeldung,
		  &auml;ndern Sie den Eintrag in
		  <filename class="devicefile">/dev/cuaa<replaceable>N</replaceable></filename> und verwenden Sie <filename
		  class="devicefile">/dev/cuaa<replaceable>N</replaceable></filename>
		  statt <filename
		  class="devicefile">/dev/ttyu<replaceable>N</replaceable></filename>.</para>
	      </step>

	      <step>
		<para>Senden Sie Testdaten an den Drucker.</para>

		<itemizedlist>
		  <listitem>
		    <para>Wenn Ihr Drucker reinen Text direkt drucken
		      kann, verwenden Sie &man.lptest.1;:</para>

		    <screen>&prompt.user; <userinput>$lptest</userinput></screen>
		  </listitem>

		  <listitem>
		    <para>Wenn Ihr Drucker &postscript; (oder eine andere
		      Seitenbeschreibungssprache) versteht, senden Sie ein
		      passendes Testprogramm an den Drucker.  Geben Sie das
		      Testprogramm ein, Zeile f&uuml;r Zeile.  Kontrollieren
		      Sie jede Zeile, bevor Sie die Eingabetaste dr&uuml;cken:
		      Sie k&ouml;nnen die Zeile sp&auml;ter nicht mehr
		      &auml;ndern.  Zum Schluss tippen Sie
		      <literal>Control-D</literal>.</para>

		    <para>Sie k&ouml;nnen das Testprogramm auch in einer Datei
		      speichern, und dann diesen Befehl aufrufen:</para>

		    <screen>&prompt.user; <userinput>&gt;<replaceable>Testprogramm</replaceable></userinput></screen>

		    <para>Ersetzen Sie <replaceable>Testprogramm</replaceable>
		      durch den Dateinamen, unter dem Sie das Testprogramm
		      gespeichert haben.  Nachdem &man.tip.1; die Datei
		      gesendet hat, tippen Sie
		      <literal>Control-D</literal>.</para>
		  </listitem>
		</itemizedlist>
	      </step>
	    </procedure>

	    <para>Der Drucker sollte einige Zeilen oder eine Seite
	      drucken.  Machen Sie sich keine Sorgen &uuml;ber falsche
	      Formatierungen: die Software-Konfiguration enth&auml;lt
	      Informationen zum Umformatieren von
	      Druckauftr&auml;gen.</para>
	</sect4>
      </sect3>

      <sect3 id="printing-printcap">
	<title><application>LPD</application> aktivieren: die
	  <filename>/etc/printcap</filename>-Datei</title>

	<para>Nachdem Sie Ihren Drucker angeschlossen haben, Ihren
	  Kernel richtig konfiguriert haben und erfolgreich einen
	  Testausdruck produziert haben, k&ouml;nnen Sie nun das
	  <application>LPD</application>-System konfigurieren.</para>

	<para>Sie konfigurieren <application>LPD</application>, indem
	  Sie die Datei <filename>/etc/printcap</filename> anpassen.
	  Da <application>LPD</application> die Datei jedes Mal liest,
	  wenn eine Aktion durchgef&uuml;hrt wird, werden
	  &Auml;nderungen an der Konfiguration sofort aktiv.</para>

	<indexterm>
	  <primary>Drucker</primary>
	  <secondary>Eigenschaften</secondary>
	</indexterm>

	<para>Die &man.printcap.5;-Datei ist einfach aufgebaut.  Sie
	  k&ouml;nnen <filename>/etc/printcap</filename> mit Ihrem
	  bevorzugten Texteditor bearbeiten.  Sie verwendet dasselbe
	  Format wie auch <filename>/usr/share/misc/termcap</filename>
	  oder <filename>/etc/remote</filename>.  Informationen zum
	  Format finden Sie in &man.cgetent.3;.</para>

	<para>Die Grund-Konfiguration des
	  <application>LPD</application>-Systems beinhaltet diese
	  Schritte:</para>

	<procedure>
	  <step>
	    <para>W&auml;hlen Sie einen Namen (und einige praktische
	      Abk&uuml;rzungen) f&uuml;r die Druckerwarteschlage, und
	      tragen Sie ihn in die <filename>/etc/printcap</filename>-Datei
	      ein.  Abschnitt <link linkend="printing-naming">Einen Namen
	      w&auml;hlen</link> enth&auml;lt weitere Informationen.</para>
	  </step>

	  <indexterm>
	    <primary>Deckbl&auml;tter</primary>
	  </indexterm>

	  <step>
	    <para>Schalten Sie den Druck von Deckbl&auml;ttern aus (dies
	      ist standardm&auml;&szlig;ig eingeschaltet), indem Sie das
	      Attribut <literal>sh</literal> setzen.  Abschnitt <link
	      linkend="printing-no-header-pages">Den Druck von
	      Deckbl&auml;ttern ausschalten</link> erkl&auml;rt, wie Sie
	      dies tun k&ouml;nnen.</para>
	  </step>

	  <step>
	    <para>Legen Sie ein Pufferverzeichnis f&uuml;r die
	      Warteschlange an, und geben Sie den Pfad mittels des
	      <literal>sd</literal>-Attributs an: siehe Abschnitt <link
	      linkend="printing-spooldir">Das Pufferverzeichnis
	      anlegen</link>.</para>
	  </step>

	  <step>
	    <para>Geben Sie den Ger&auml;tenamen f&uuml;r Ihren
	      Drucker mittels des <literal>lp</literal>-Attributs an:
	      siehe Abschnitt <link
	      linkend="printing-device">Festlegen der
	      Drucker-Ger&auml;tedatei</link>.  Ist Ihr Drucker
	      &uuml;ber eine serielle Schnittstelle angeschlossen,
	      benutzen Sie das Attribut <literal>ms#</literal>,
	      wie dies in Abschnitt <link
	      linkend="printing-commparam">Festlegen der
	      Kommunikationsparameter</link> beschrieben ist.</para>
	  </step>

	  <step>
	    <para>Installieren Sie einen Filter f&uuml;r reinen Text:
	      siehe Abschnitt <link linkend="printing-textfilter">Den
	      Textfilter installieren</link>.</para>
	  </step>

	  <step>
	    <para>Testen Sie die Konfiguration, indem Sie etwas mit
	      dem &man.lpr.1;-Befehl drucken.  Die Abschnitte <link
	      linkend="printing-trying">Die Konfiguration testen</link> und
	      <link linkend="printing-troubleshooting">Fehlersuche und
	      Problembehebung</link> enthalten weitere Informationen.</para>
	  </step>
	</procedure>

	<note>
	  <para>Drucker, die eine Seitenbeschreibungssprache wie
	    &postscript; verwenden, k&ouml;nnen keinen reinen Text
	    drucken.  Es wird deshalb angenommen, dass Sie nur
	    solche Dateien drucken, die Ihr Drucker verarbeiten
	    kann.</para>
	</note>

	<para>Viele Anwender erwarten, dass sie normalen Text auf
	  allen Druckern drucken k&ouml;nnen.  Viele Programme, die mit
	  <application>LPD</application> zusammenarbeiten, gehen ebenfalls von
	  dieser Annahme aus.  Wenn Sie einen &postscript;-Drucker
	  installieren, und Sie sowohl &postscript;- als auch Textdateien
	  drucken m&ouml;chten, sollten Sie einen weiteren
	  Konfigurationsschritt ausf&uuml;hren und einen
	  Text-zu-&postscript;-Filter installieren.  Der Abschnitt <link
	  linkend="printing-advanced-if-conversion">Drucken von reinen
	  Textdateien auf einem &postscript;-Drucker</link>
	  erkl&auml;rt, wie Sie dies tun k&ouml;nnen.</para>

	<sect4 id="printing-naming">
	  <title>Einen Namen w&auml;hlen</title>

	  <para>Der erste einfache Schritt ist, einen Namen f&uuml;r
	    Ihren Drucker zu w&auml;hlen.  Sie k&ouml;nnen diesen Namen
	    frei w&auml;hlen, Sie sollten allerdings keine Sonderzeichen oder
	    Umlaute verwenden.  Sie k&ouml;nnen mehrere Alias-Namen
	    vergeben.</para>

	  <para>Ein Drucker in <filename>/etc/printcap</filename>
	    sollte den Alias <literal>lp</literal> haben.  Dieser Name
	    wird standardm&auml;&szlig;ig von allen Druckbefehlen
	    verwendet, wenn auf der Befehlszeile oder in der
	    <envar>PRINTER</envar>-Umgebungsvariablen kein anderer
	    Drucker angegeben ist.</para>

	  <para>Ebenso ist es &uuml;blich, eine ausf&uuml;hrliche
	    Beschreibung des Druckermodells als letzten Alias-Namen zu
	    verwenden.</para>

	  <para>Sobald Sie einen Namen und einige einfache Alias-Namen
	    ausgew&auml;hlt haben, tragen Sie sie in die Datei
	    <filename>/etc/printcap</filename> ein.  Beginnen Sie die
	    Zeile mit dem Namen des Druckers und f&uuml;gen Sie alle
	    Alias-Namen an.  Trennen Sie die Namen durch den
	    senkrechten Strich <literal>|</literal>.  F&uuml;gen Sie an
	    das Ende der Zeile einen Doppelpunkt <literal>:</literal>
	    an.</para>

	  <para>Das folgende Beispiel definiert zwei Drucker, einen
	    Diablo 630 Zeilendrucker, und einen Panasonic KX-P4455
	    &postscript;-Laserdrucker:</para>

	  <programlisting>#
#  /etc/printcap for host rose
#
rattan|line|diablo|lp|Diablo 630 Line Printer:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:</programlisting>

	  <para>Der erste Drucker hat den Namen
	    <literal>rattan</literal>, und hat die Alias-Namen
	    <literal>line</literal>, <literal>diablo</literal>,
	    <literal>lp</literal> und <literal>Diablo 630 Line
	    Printer</literal>.  Da er den Alias-Namen
	    <literal>lp</literal> tr&auml;gt, wird er
	    standardm&auml;&szlig;ig von den Druckprogrammen
	    verwendet.  Der zweite Drucker hei&szlig;t
	    <literal>bamboo</literal>, und hat die Alias-Namen
	    <literal>ps</literal>, <literal>PS</literal>,
	    <literal>S</literal>, <literal>panasonic</literal> und
	    <literal>Panasonic KX-P4455 PostScript
	    v51.4</literal>.</para>
	</sect4>

	<sect4 id="printing-no-header-pages">
	  <title>Keine Deckbl&auml;tter drucken</title>

	  <indexterm>
	    <primary>drucken</primary>
	    <secondary>Deckblatt</secondary>
	  </indexterm>

	  <para>Standardm&auml;&szlig;ig druckt das
	    <application>LPD</application>-System ein
	    <emphasis>Deckblatt</emphasis> vor jedem Druckauftrag,
	    die den Namen des Druckauftrags, den Benutzer und den
	    Computer angibt.  W&auml;hrend der Einrichtung des Systems
	    und beim Testen st&ouml;rt das Deckblatt allerdings,
	    weshalb Sie sie zun&auml;chst deaktivieren sollten.</para>

	  <para>Um den Druck von Deckbl&auml;ttern zu deaktivieren,
	    f&uuml;gen Sie das Attribut <literal>sh</literal> zur
	    Druckerdefinition in <filename>/etc/printcap</filename>
	    hinzu.  Hier ein Beispiel:</para>

	  <programlisting>#
#  /etc/printcap for host rose - no header pages anywhere
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:</programlisting>

	  <para>Beachten Sie die korrekte Formatierung: die beiden
	    Definitionen beginnen auf einer Zeile; weitere Zeilen der
	    Definition sind mit einem <literal>Tab</literal>-Zeichen
	    einger&uuml;ckt, und alle Zeilen einer Definition, bis auf
	    die letzte, enden mit dem Backslash <literal>\</literal>.</para>
	</sect4>

	<sect4 id="printing-spooldir">
	  <title>Das Pufferverzeichnis anlegen</title>

	  <indexterm>
	    <primary>Pufferverzeichnis</primary>
	  </indexterm>
	  <indexterm>
	    <primary>Druckauftr&auml;ge</primary>
	  </indexterm>

	  <para>Der n&auml;chste Schritt ist, das
	    <emphasis>Pufferverzeichnis</emphasis> anzulegen.  In
	    diesem Verzeichnis werden Druckauftr&auml;ge zwischengespeichert,
	    w&auml;hrend sie gedruckt werden.  Gleichzeitig werden hier auch
	    einige Verwaltungsdateien des Systems abgelegt.</para>

	  <para>Da sich die Dateien in diesem Verzeichnis h&auml;ufig
	    &auml;ndern, ist es &uuml;blich, das Verzeichnis unter
	    <filename class="directory">/var/spool</filename> anzulegen.
	    Es ist nicht notwendig, Sicherungskopien der Dateien
	    herzustellen; das Verzeichnis kann n&ouml;tigenfalls
	    leicht mit &man.mkdir.1; wieder angelegt werden.</para>

	  <para>Es ist auch &uuml;blich, dem Verzeichnis denselben
	    Namen wie dem Drucker zu geben:</para>

	  <screen>&prompt.root; <userinput><command>mkdir <filename class="directory">/var/spool/<replaceable>printer-name</replaceable></filename></command></userinput></screen>

	  <para>Wenn Sie viele Drucker verwenden, ist es am besten,
	    wenn Sie f&uuml;r die Pufferverzeichnisse ein eigenes
	    Unterverzeichnis in <filename>/var/spool</filename>
	    anlegen, wie dies hier f&uuml;r die beiden Beispieldrucker
	    <literal>rattan</literal> und <literal>bamboo</literal>
	    gezeigt wird:</para>

	  <screen>&prompt.root; <userinput><command>mkdir <filename class="directory">/var/spool/lpd</filename></command></userinput>
&prompt.root; <userinput><command>mkdir <filename class="directory">/var/spool/lpd/rattan</filename></command></userinput>
&prompt.root; <userinput><command>mkdir <filename class="directory">/var/spool/lpd/bamboo</filename></command></userinput></screen>

	  <note>
	    <para>Um zu verhindern, dass alle Benutzer den Inhalt
	      aller Druckauftr&auml;ge einsehen k&ouml;nnen, sollten
	      Sie die Rechte auf den Pufferverzeichnissen einschr&auml;nken.
	      Die Verzeichnisse sollten dem
	      Benutzer <username>daemon</username> und der Gruppe
	      <groupname>daemon</groupname> geh&ouml;ren, und auch nur
	      vom Benutzer und der Gruppe les-, schreib- und
	      durchsuchbar sein.  F&uuml;r unsere
	      Beispieldrucker:</para>

	    <screen>&prompt.root; <userinput><command>chown daemon:daemon <filename class="directory">/var/spool/lpd/rattan</filename></command></userinput>
&prompt.root; <userinput><command>chown daemon:daemon <filename class="directory">/var/spool/lpd/bamboo</filename></command></userinput>
&prompt.root; <userinput><command>chmod 770 <filename class="directory">/var/spool/lpd/rattan</filename></command></userinput>
&prompt.root; <userinput><command>chmod 770 <filename class="directory">/var/spool/lpd/bamboo</filename></command></userinput></screen>
	  </note>

	  <para>Schlie&szlig;lich m&uuml;ssen Sie dem
	    <application>LPD</application>-System noch mitteilen, wo
	    Sie die Pufferverzeichnisse angelegt haben.  Dazu geben Sie
	    in der Definition das Attribut <literal>sd</literal> an:</para>

	  <programlisting>#
#  /etc/printcap for host rose - added spooling directories
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=<filename class="directory">/var/spool/lpd/rattan</filename>:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<filename class="directory">/var/spool/lpd/bamboo</filename>:</programlisting>

	  <para>Beachten Sie, dass der Druckername in der ersten
	    Spalte beginnt, und dass alle Folgezeilen mit einem
	    <literal>Tab</literal> einger&uuml;ckt sind.</para>

	  <para>Wenn Sie das <literal>sd</literal>-Attribut nicht
	    angeben, verwendet das System <filename
	    class="directory">/var/spool/lpd</filename> als Verzeichnis.</para>
	</sect4>

	<sect4 id="printing-device">
	  <title>Festlegen der Drucker-Ger&auml;tedatei</title>

	  <para>Nachdem Sie die korrekte Ger&auml;tedatei f&uuml;r die
	    Schnittstelle im Abschnitt <link
	    linkend="printing-hardware">Hardware-Konfiguration</link>
	    identifiziert und angelegt haben, m&uuml;ssen Sie dem
	    <application>LPD</application>-System mitteilen, welche
	    Ger&auml;tedatei im Verzeichnis <filename
	    role="directory">/dev</filename> es f&uuml;r die
	    Daten&uuml;bertragung zum Drucker verwenden soll.</para>

	  <para>Geben Sie die Ger&auml;tedatei durch das Attribut
	    <literal>lp</literal> in
	    <filename>/etc/printcap</filename> an.</para>

	  <para>Wenn <literal>rattan</literal> an die erste parallele
	    Schnittstelle angeschlossen ist, und <literal>bamboo</literal> an
	    die sechste serielle, dann sieht <filename>/etc/printcap</filename>
	    so aus:</para>

	  <programlisting>#
#  /etc/printcap for host rose - identified what devices to use
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=<filename class="directory">/var/spool/lpd/rattan</filename>:\
        :lp=<filename class="devicefile">/dev/lpt0</filename>:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        sh:sd=<filename class="directory">/var/spool/lpd/bamboo</filename>:\
        :lp=<filename class="devicefile">/dev/ttyu5</filename>:</programlisting>

	  <para>Wenn Sie <literal>lp</literal> nicht angeben, versucht
	    <application>LPD</application> die Ger&auml;tedatei <filename
	    class="devicefile">/dev/lp</filename> zu verwenden.  <filename
	    class="devicefile">/dev/lp</filename> ist zurzeit in &os;
	    nicht definiert.</para>

	  <para>Wenn Ihr Drucker &uuml;ber eine parallele Schnittstelle
	    angeschlossen ist, k&ouml;nnen Sie mit dem Abschnitt <link
	    linkend="printing-textfilter">Den Textfilter installieren</link>
	    fortfahren.  Verwenden Sie eine serielle Schnittstelle, beachten
	    Sie bitte den folgenden Abschnitt.</para>
	</sect4>

	<sect4 id="printing-commparam">
	  <title>Kommunikationsparameter festlegen</title>

	  <indexterm>
	    <primary>Drucker</primary>
	    <secondary>serielle</secondary>
	  </indexterm>

	  <para>F&uuml;r seriell angeschlossene Drucker kann
	    <application>LPD</application> die Geschwindigkeit,
	    Parit&auml;t und weitere Kommunikationsparameter
	    einstellen.  Dies hat folgende Vorteile:</para>

	  <itemizedlist>
	    <listitem>
	      <para>Sie k&ouml;nnen die Parameter einfach in
		<filename>/etc/printcap</filename> &auml;ndern, ohne
		das Ausgabe-Filterprogramm anpassen zu
		m&uuml;ssen.</para>
	    </listitem>

	    <listitem>
	      <para>Dasselbe Ausgabe-Filterprogramm kann f&uuml;r
		unterschiedliche Drucker verwendet werden, auch wenn
		diese unterschiedliche Kommunikationseinstellungen
		ben&ouml;tigen.</para>
	    </listitem>
	  </itemizedlist>

	  <para>Die folgenden Attribute legen die seriellen
	    Kommunikationsparameter fest:</para>

	  <variablelist>
	    <varlistentry>
	      <term><literal>br#<replaceable>Baudrate</replaceable></literal></term>

	      <listitem>
		<para>Setzt die &Uuml;bertragungsgeschwindigkeit auf
		  <replaceable>Baudrate</replaceable>.
		  <replaceable>Baudrate</replaceable> kann
		  &uuml;blicherweise 50, 75, 110, 134.5, 150, 300,
		  600, 1200, 1800, 2400, 4800, 9600, 19200, 38400,
		  57600, oder 115200 Bit pro Sekunde betragen.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term><literal>ms#<replaceable>stty-Modi</replaceable></literal></term>

	      <listitem>
		<para>Setzt die Eigenschaften f&uuml;r das Ger&auml;t,
		  nachdem es ge&ouml;ffnet wurde.  Die verf&uuml;gbaren
		  Eigenschaften sind in &man.stty.1; aufgef&uuml;hrt.</para>
	      </listitem>
	    </varlistentry>
	  </variablelist>

	  <para>Wenn <application>LPD</application> das mit
	    <literal>lp</literal> angegebene Ger&auml;t &ouml;ffnet,
	    setzt es die mit <literal>ms#</literal> angegebenen
	    Eigenschaften.  Von besonderem Interesse sind hier die Modi
	    <literal>parenb</literal>, <literal>parodd</literal>,
	    <literal>cs5</literal>, <literal>cs6</literal>,
	    <literal>cs7</literal>, <literal>cs8</literal>,
	    <literal>cstopb</literal>, <literal>crtscts</literal> und
	    <literal>ixon</literal>, die in der
	    &man.stty.1;-Handbuchseite erl&auml;utert werden.</para>

	  <para>F&uuml;r den &uuml;ber die sechste serielle
	    Schnittstelle angeschlossenen Laserdrucker betr&auml;gt
	    die Geschwindigkeit 38.400&nbsp;Baud, und es werden diese
	    Kommunikationseinstellungen verwendet: keine Parit&auml;t
	    (<literal>-parenb</literal>), 8-Bit-Zeichen
	    (<literal>cs8</literal>), keine Modemsteuerung
	    (<literal>clocal</literal>) und Hardware-Flusssteuerung
	    (<literal>crtscts</literal>):</para>

	  <programlisting>bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<filename class="directory">/var/spool/lpd/bamboo</filename>:\
        :lp=<filename class="devicefile">/dev/ttyd5</filename>:ms#-parenb cs8 clocal crtscts:</programlisting>
	</sect4>

	<sect4 id="printing-textfilter">
	  <title>Den Textfilter installieren</title>

	  <indexterm>
	    <primary>Druckfilter</primary>
	  </indexterm>

	  <para>Ein <emphasis>Textfilter</emphasis>, auch als
	    <emphasis>Eingangsfilter</emphasis> bezeichnet, ist ein
	    Programm, das von <application>LPD</application>
	    aufgerufen wird, wenn ein Druckauftrag verarbeitet wird.
	    Dabei wird die Standardeingabe des Programms mit der zu
	    druckenden Datei verbunden, und die Standardausgabe mit
	    dem im <literal>lp</literal>-Attribut angegebenen
	    Ger&auml;t.  Das Programm sollte nun die Datei einlesen,
	    alle &Uuml;bersetzungen durchf&uuml;hren, die f&uuml;r den
	    Drucker notwendig sind, und das Ergebnis &uuml;ber die
	    Standardausgabe an den Drucker senden.  Textfilter werden
	    im Abschnitt <link
	    linkend="printing-advanced-filters">Filter</link> genauer
	    erl&auml;utert.</para>

	  <para>Um einen einfachen Test durchzuf&uuml;hren, reicht ein
	    kleines Filterprogramm, dass schlicht <command>/bin/cat</command>
	    aufruft, um die Daten unver&auml;ndert und den Drucker zu schicken.
            &os; verf&uuml;gt &uuml;ber das Programm <filename>lpf</filename>,
            das Unterstreichung und Fettdruck f&uuml;r solche Drucker
            erm&ouml;glicht, die ansonsten dazu nicht in der Lage w&auml;ren.
            Dar&uuml;berhinaus gibt es viele andere Filter, die Sie einsetzen
            k&ouml;nnen.  <command>lpf</command> wird im Abschnitt <link
	    linkend="printing-advanced-lpf">lpf: ein Textfilter</link>
	    ausf&uuml;hrlich beschrieben.</para>

	  <para>Legen Sie zun&auml;chst das folgende Shell-Skript als
	    <filename>/usr/local/libexec/if-simple</filename> mit
	    Ihrem bevorzugten Texteditor an:</para>

	  <programlisting>#!/bin/sh
#
# if-simple - Simple text input filter for lpd
# Installed in /usr/local/libexec/if-simple
#
# Simply copies stdin to stdout.  Ignores all filter arguments.

/bin/cat &amp;&amp; exit 0
exit 2</programlisting>

	  <para>Machen Sie die Datei ausf&uuml;hrbar:</para>

	  <screen>&prompt.root; <userinput><command>chmod 555 <filename>/usr/local/libexec/if-simple</filename></command></userinput></screen>

	  <para>Konfigurieren Sie nun den Textfilter f&uuml;r Ihren
	    Drucker in <filename>/etc/printcap</filename>, indem Sie
	    das <literal>if</literal>-Attribut hinzuf&uuml;gen.  Hier
	    die Konfiguration unserer beiden Beispieldrucker:</para>

	  <programlisting>#
#  /etc/printcap for host rose - added text filter
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=<filename class="directory">/var/spool/lpd/rattan</filename>:\ :lp=<filename class="devicefile">/dev/lpt0</filename>:\
        :if=<filename>/usr/local/libexec/if-simple</filename>:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<filename class="directory">/var/spool/lpd/bamboo</filename>:\
        :lp=<filename class="devicefile">/dev/ttyu5</filename>:ms#-parenb cs8 clocal crtscts:\
        :if=<filename>/usr/local/libexec/if-simple</filename>:</programlisting>

	  <note>
	    <para>Das Shell-Skript <filename>if-simple</filename>
	      steht im Verzeichnis <filename
	      class="directory">/usr/share/examples/printing</filename>.</para>
	  </note>
	</sect4>

	<sect4>
	  <title><application>LPD</application> aktivieren</title>

	  <para>&man.lpd.8; wird von <filename>/etc/rc</filename>
	    gestartet, wenn die &man.rc.conf.5;-Variable
	    <literal>lpd_enable</literal> auf <literal>YES</literal>
	    gesetzt ist.  F&uuml;gen Sie dazu diese Zeile in
	    <filename>/etc/rc.conf</filename> hinzu:</para>

	  <programlisting>lpd_enable="YES"</programlisting>

	  <para>Starten Sie Ihren Computer neu, oder starten Sie
	    &man.lpd.8; von Hand:</para>

	  <screen>&prompt.root; <userinput><command>lpd</command></userinput></screen>
	</sect4>

	<sect4 id="printing-trying">
	  <title>Die Konfiguration testen</title>

	  <para>Damit ist die einfache Konfiguration abgeschlossen.
	    Noch muss die Konfiguration aber getestet werden und etwaige
	    Probleme m&uuml;ssen behoben werden.  Um die Konfiguration zu
	    testen, sollten Sie einen Probeausdruck mithilfe des Programms
	    &man.lpr.1; produzieren.  &man.lpr.1; &uuml;bergibt
	    Druckauftr&auml;ge an das
	    <application>LPD</application>-System.</para>

	  <para>Sie k&ouml;nnen &man.lpr.1; mit &man.lptest.1;
	    kombinieren, um Testdaten zu drucken.  &man.lptest.1; wurde
	    im Abschnitt <link
	    linkend="printing-testing">Kommunikation mit den Drucker
	    pr&uuml;fen</link> vorgestellt.</para>

	  <para><emphasis>So testen Sie die einfache
	    <application>LPD</application>-Konfiguration:</emphasis></para>

	  <screen>&prompt.root; <userinput><command>lptest 20 5 | lpr <option>-P</option><replaceable>Druckername</replaceable></command></userinput></screen>

	  <para>Ersetzen Sie <replaceable>Druckername</replaceable>
	    durch den Namen des Druckers, den Sie testen m&ouml;chten.
	    Wenn Sie den Standard-Drucker testen m&ouml;chten, rufen
	    Sie &man.lpr.1;  ohne die Option <option>-P</option> auf.
	    Wenn Sie einen Drucker testen m&ouml;chten, der nur
	    &postscript; versteht, m&uuml;ssen Sie ein
	    &postscript;-Testprogramm an &man.lpr.1; &uuml;bergeben.
	    Ein Testprogramm, das Sie in einer Datei gespeichert haben,
	    k&ouml;nnen Sie mit dem Befehl
	    <command>lpr <replaceable>Dateiname</replaceable></command>
	    an das <application>LPD</application>-System &uuml;bergeben.</para>

	  <para>Bei einem &postscript;-Drucker h&auml;ngt das Ergebnis
	    naturgem&auml;&szlig; vom Testprogramm ab.  Wenn Sie
	    &man.lptest.1; verwenden, sollte das Ergebnis
	    ungef&auml;hr so aussehen:</para>

	  <screen>!"#$%&amp;'()*+,-./01234
"#$%&amp;'()*+,-./012345
#$%&amp;'()*+,-./0123456
$%&amp;'()*+,-./01234567
%&amp;'()*+,-./012345678</screen>

	  <para>Um sicherzustellen, dass alles richtig
	    funktioniert, sollten Sie jetzt ein gr&ouml;&szlig;eres
	    &postscript;-Programm senden.  Mit &man.lptest.1; k&ouml;nnen
	    Sie gr&ouml;&szlig;ere Datenmengen z.B. mit dem Befehl
	    <command>lptest 80 60</command> erzeugen: &man.lptest.1;
	    produziert 60 Zeilen mit je 80 Zeichen.</para>

	  <para>Wenn Sie nicht erfolgreich drucken k&ouml;nnen, finden
	    Sie im Abschnitt <link
	    linkend="printing-troubleshooting">Fehlersuche und
	    Problembehebung</link> weitere Informationen.</para>
	</sect4>
      </sect3>
    </sect2>
  </sect1>

  <sect1 id="printing-advanced">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Johann</firstname>
	  <surname>Kois</surname>
	  <contrib>&Uuml;bersetzt von </contrib>
	</author>
      </authorgroup>
    </sect1info>

    <title>Erweiterte Drucker-Konfiguration</title>

    <warning>
      <para>Mit &os;&nbsp;8.0 wurden die Ger&auml;tedateien f&uuml;r
	serielle Ports von
	<filename>/dev/ttyd<replaceable>N</replaceable></filename> in
	<filename>/dev/ttyu<replaceable>N</replaceable></filename>
	umbenannt.  Setzen Sie noch &os;&nbsp;7.X ein, m&uuml;ssen
	Sie die Befehle in den folgenden Abschnitten entsprechend
	anpassen.</para>
    </warning>

    <para>Dieser Abschnitt beschreibt den Einsatz von Filtern f&uuml;r
      das Drucken speziell formatierter Seiten oder von
      Deckbl&auml;ttern, das Drucken &uuml;ber ein Netzwerk sowie die
      Beschr&auml;nkung und Verrechnung der Druckernutzung.</para>

    <sect2 id="printing-advanced-filter-intro">
      <title>Filter</title>
      <indexterm>
	<primary>Drucken</primary>
	<secondary>Filter</secondary>
      </indexterm>

      <para>Obwohl <application>LPD</application> Netzwerkprotokolle,
	Warteschlangen, Zugriffskontrollen und andere f&uuml;r das
	Drucken wichtige Aspekte prinzipiell unterst&uuml;tzt, passiert
	ein Gro&szlig;teil der <emphasis>wirklichen</emphasis> Arbeit
	in den sogenannten <emphasis>Filtern</emphasis>.  Dabei handelt
	es sich um Programme, die direkt mit einem Drucker kommunizieren
	und deren Ger&auml;tespezifika und spezielle Anforderungen
	erf&uuml;llen.  Im einfachsten Fall installiert man nur einen reinen
	Textfilter, der mit beinahe allen Druckern funktionieren sollte.
	(Lesen Sie dazu auch den Abschnitt <link
	linkend="printing-textfilter">Den Text-Filter
	installieren</link>.)</para>

      <para>Um die erweiterten F&auml;higkeiten von Druckern auch
	einsetzen zu k&ouml;nnen, sollten Sie verstehen, wie Filter
	arbeiten, da diese f&uuml;r die Bereitstellung dieser Funktionen
	zust&auml;ndig sind.  Die schlechte Nachricht ist, dass
	<emphasis>Sie</emphasis> diese Filter bereitstellen m&uuml;ssen.
	Die gute Nachricht ist allerdings, dass diese in der Regel
	bereits vorhanden sind.  Ist dies nicht der Fall, k&ouml;nnen
	Sie einen Filter meist relativ einfach selbst erstellen.</para>

      <para>Der Filter <filename>/usr/libexec/lpr/lpf</filename> wird
	bereits mit &os; geliefert.  Er k&uuml;mmert sich um die
	korrekte Behandlung von gel&ouml;schten Zeichen (das sogenannte
	<foreignphrase>Backspacing</foreignphrase>), um im Text
	enthaltene Tabulatoren, sowie um die Verrechnung von
	Druckauftr&auml;gen.  Das ist aber auch alles, was dieser
	Filter kann.  Zus&auml;tzliche Filter und f&uuml;r die Funktion
	von Filtern n&ouml;tige Komponenten finden sich aber in der
	&os; Ports-Sammlung.</para>

      <para>Dieser Abschnitt behandelt folgende Themen:</para>

      <itemizedlist>
	<listitem>
	  <para>Der Abschnitt <link linkend="printing-advanced-filters">
	    Die Funktionsweise von Filtern</link> versucht, einen
	    &Uuml;berblick &uuml;ber die Rolle von Filtern innerhalb des
	    Druckprozesses zu geben.  Sie sollten diesen Abschnitt lesen,
	    damit Sie verstehen, was <quote>unter der Haube</quote>
	    passiert, wenn <application>LPD</application> einen Filter
	    verwendet.  Dieses Wissen wird Ihnen dabei helfen, Probleme,
	    die bei Installation von Filtern f&uuml;r verschiedene Drucker
	    entstehen k&ouml;nnen, vorauszusehen und zu beheben.</para>
	</listitem>

	<listitem>
	  <para><application>LPD</application> geht davon aus, dass
	    jeder Drucker in der Lage ist, normalen Text zu drucken.
	    F&uuml;r &postscript;- (oder andere sprachbasierte) Drucker
	    stellt dies allerdings ein Problem dar, da diese nicht in
	    der Lage sind, normalen Text direkt zu drucken.  Der
	    Abschnitt <link
	    linkend="printing-advanced-if-conversion">Normalen Text auf
	    &postscript;-Druckern drucken</link> beschreibt, wie Sie
	    dieses Problem l&ouml;sen k&ouml;nnen.  Besitzen Sie einen
	    &postscript;-Drucker, sollten Sie diesen Abschnitt lesen.</para>
        </listitem>

        <listitem>
	  <para>&postscript; ist ein popul&auml;res Ausgabeformat, das
	    von vielen Programmen unterst&uuml;tzt wird.  Es ist sogar
	    m&ouml;glich, &postscript;-Code direkt zu schreiben.  Leider
	    sind &postscript;-Drucker in der Regel relativ teuer.  Der
	    Abschnitt <link linkend="printing-advanced-ps">&postscript;
	    auf Nicht-&postscript;-Druckern emulieren</link> beschreibt,
	    wie Sie einen Textfilter anpassen m&uuml;ssen, um
	    &postscript;-Daten auf einem
	    <emphasis>nicht-&postscript;-f&auml;higen Drucker</emphasis>
	    auszugeben.  Haben Sie keinen &postscript;-Drucker, sollten
	    Sie insbesondere diesen Abschnitt lesen.</para>
	</listitem>

	<listitem>
	  <para>Der Abschnitt
	    <link linkend="printing-advanced-convfilters">
	    Konvertierungsfilter</link> beschreibt eine M&ouml;glichkeit
	    zur automatischen Konvertierung verschiedener Dateiformate
	    in ein von Ihrem Drucker unterst&uuml;tztes Format.  Nachdem
	    Sie diesen Abschnitt gelesen haben, werden Sie in der Lage
	    sein, Ihren Drucker so zu konfigurieren, dass Sie durch die
	    Eingabe von <command>lpr <option>-t</option></command> troff-Daten,
	    von <command>lpr <option>-d</option></command> &tex;-DVI-Daten,
	    oder von <command>lpr <option>-v</option></command> Rasterbilddaten
	    drucken k&ouml;nnen.
	    Daher sollten Sie diesen Abschnitt auf jeden Fall lesen.</para>
	</listitem>

	<listitem>
	  <para>Im Abschnitt <link linkend="printing-advanced-of">
	    Ausgabefilter</link> wird eine nur selten genutzte
	    Eigenschaft von <application>LPD</application>, die
	    sogenannten Ausgabefilter, beschrieben.  Wenn Sie keine
	    <link linkend="printing-advanced-header-pages">
	    Deckbl&auml;tter</link> drucken m&uuml;ssen, k&ouml;nnen
	    Sie diesen Abschnitt &uuml;berspringen.</para>
	</listitem>

	<listitem>
	  <para>Der Abschnitt <link linkend="printing-advanced-lpf">lpf:
	    Ein Textfilter</link> beschreibt <command>lpf</command>,
	    einen kompletten, wenn auch einfachen Textfilter f&uuml;r
	    Zeilendrucker (oder auch Laserdrucker, die sich analog
	    verhalten), der bereits mit &os; geliefert wird.  Wenn
	    Sie nur am Ausdruck von reinem Text interessiert sind, oder
	    wenn Ihr Drucker nur <quote>Schrott</quote> produziert, wenn
	    er auf Backspace-Zeichen trifft, sollten Sie sich
	    <command>lpf</command> n&auml;her ansehen.</para>
	</listitem>
      </itemizedlist>

      <note>
	<para>Eine Kopie der verschiedenen Skripte finden Sie im
	  Verzeichnis <filename
	  class="directory">/usr/share/examples/printing</filename>.</para>
      </note>

      <sect3 id="printing-advanced-filters">
	<title>Die Funktionsweise von Filtern</title>

	<para>Bei einem Filter handelt es sich um ein ausf&uuml;hrbares
	  Programm, das von <application>LPD</application> gestartet
	  wird, um den ger&auml;teabh&auml;ngigen Teil der Kommunikation
	  mit einem Drucker zu &uuml;bernehmen.</para>

	<para>Wenn <application>LPD</application> eine Datei &uuml;ber
	  einen Druckauftrag drucken will, startet es ein Filterprogramm.
	  Danach setzt es die Standardeingabe des Filters auf die zu
	  druckende Datei, die Standardausgabe auf den Drucker und die
	  Standardfehlerausgabe auf <filename
	  class="devicefile">/dev/console</filename> (Voreinstellung) oder auf
	  die &uuml;ber die Option <literal>lf</literal> in
	  <filename>/etc/printcap</filename> festgelegte Datei.</para>

	<indexterm>
	  <primary><command>troff</command></primary>
	</indexterm>

	<para>Welcher Filter von <application>LPD</application> mit
	  welchen Argumenten geladen wird, wird in der Datei
	  <filename>/etc/printcap</filename> oder durch die Argumente,
	  die der Anwender &man.lpr.1; auf der Kommandozeile
	  &uuml;bergibt, festgelegt.  Gibt der Anwender beispielsweise
	  <command>lpr <option>-t</option></command> ein, startet
	  <application>LPD</application> &uuml;ber die
	  <literal>tf</literal>-F&auml;higkeit den troff-Filter f&uuml;r
	  den gew&uuml;nschten Drucker.  Wollen Sie hingegen normalen
	  Text drucken, wird der <literal>if</literal>-Filter gestartet.
	  (F&uuml;r Ausnahmen von diesem Vorgehen lesen Sie bitte den
	  Abschnitt <link linkend="printing-advanced-of">
	  Ausgabefilter</link>.)</para>

	<para>Es gibt drei Arten von Filtern, die Sie in
	  <filename>/etc/printcap</filename> angeben k&ouml;nnen:</para>

	<itemizedlist>
	  <listitem>
	    <para><emphasis>Textfilter</emphasis> (die in der
	      <application>LPD</application>-Dokumentation als
	      <emphasis>input filter</emphasis> bezeichnet werden) sind
	      f&uuml;r den Druck von normalem Text zust&auml;ndig.
	      Es handelt sich dabei um eine Art Standardfilter, da
	      <application>LPD</application> von jedem Drucker erwartet,
	      dass er normalen Text drucken kann.  Aufgabe des
	      Textfilters ist es, sicherzustellen, dass gel&ouml;schte
	      Zeichen (<foreignphrase>Backspaces</foreignphrase>),
	      Tabulatoren und andere Sonderzeichen Ihren Drucker nicht
	      verwirren.  Falls Sie f&uuml;r die Nutzung eines Druckers
	      bezahlen m&uuml;ssen, kann der Textfilter &uuml;ber die
	      Anzahl der gedruckten Zeilen auch die Anzahl der von Ihnen
	      gedruckten Seiten ermitteln.  Der Textfilter wird mit
	      folgenden Argumenten gestartet:</para>

              <cmdsynopsis>
                <command>filter-name</command>
                <arg>-c</arg>
                <arg choice="plain">-w <replaceable>width</replaceable></arg>
                <arg choice="plain">-l <replaceable>length</replaceable></arg>
                <arg choice="plain">-i <replaceable>indent</replaceable></arg>
                <arg choice="plain">-n <replaceable>login</replaceable></arg>
                <arg choice="plain">-h <replaceable>host</replaceable></arg>
                <arg choice="plain"><replaceable>acct-file</replaceable></arg>
              </cmdsynopsis>

              <para>Die einzelnen Argumente haben folgende Bedeutung:</para>

              <variablelist>
                <varlistentry>
                  <term><option>-c</option></term>

                  <listitem>
                    <para>Notwendig, wenn <command>lpr
                      <option>-l</option></command> verwendet wird.</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><replaceable>width</replaceable></term>

                  <listitem>
                    <para>Der Wert der in
                      <filename>/etc/printcap</filename> festgelegten
                      Option <literal>pw</literal> (<foreignphrase>page
                      width</foreignphrase>).  In der Voreinstellung
                      ist dieser Wert auf 132 gesetzt.</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><replaceable>length</replaceable></term>

                  <listitem>
                    <para>Der Wert der
                      <literal>pl</literal>-F&auml;higkeit
                      (<foreignphrase>page length</foreignphrase>),
                      Voreinstellung 66.</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><replaceable>indent</replaceable></term>

                  <listitem>
                    <para>Der durch <command>lpr
                      <option>-i</option></command> festgelegte Einzug,
                      Voreinstellung 0.</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><replaceable>login</replaceable></term>

                  <listitem>
                    <para>Der Name des Benutzers, der die Datei
                      druckt.</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><replaceable>host</replaceable></term>

                  <listitem>
                    <para>Der Rechner, auf dem der Druckauftrag
                      gestartet wurde.</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term><replaceable>acct-file</replaceable></term>

                  <listitem>
                    <para>Der Name der Verrechnungsdatei, in der die
                      Ergebnisse der
                      <literal>af</literal>-F&auml;higkeit gespeichert
                      werden.</para>
                  </listitem>
                </varlistentry>
              </variablelist>
          </listitem>

          <indexterm>
            <primary>Drucken</primary>
            <secondary>Filter</secondary>
          </indexterm>

	  <listitem>
	    <para>Ein <emphasis>Konvertierungsfilter</emphasis>
	      konvertiert verschiedene Dateiformate in ein Format, das
	      Ihr Drucker auf Papier ausgeben kann.  So kann etwa der
	      ditroff-Schriftsatz nicht direkt gedruckt werden, daher
	      m&uuml;ssen Sie einen Konvertierungsfilter installieren,
	      um diese Daten in ein Format zu bringen, das Ihr Drucker
	      verarbeiten und drucken kann.  Der Abschnitt <link
	      linkend="printing-advanced-convfilters">
	      Konvertierungsfilter</link> enth&auml;lt ausf&uuml;hrliche
	      Informationen zu diesen Filtern.  Konvertierungsfilter
	      k&ouml;nnen auch zur Verrechnung verwendet werden.  Sie
	      werden mit folgenden Argumenten gestartet:</para>

              <cmdsynopsis>
                <command>filter-name</command>
                <arg
                  choice="plain">-x <replaceable>pixel-width</replaceable></arg>
                <arg choice="plain">-y <replaceable>pixel-height</replaceable></arg>
                <arg choice="plain">-n <replaceable>login</replaceable></arg>
                <arg choice="plain">-h <replaceable>host</replaceable></arg>
                <arg choice="plain"><replaceable>acct-file</replaceable></arg>
              </cmdsynopsis>

              <para><replaceable>pixel-width</replaceable> ist der Wert
                der <literal>px</literal>-F&auml;higkeit (Voreinstellung 0),
                w&auml;hrend <replaceable>pixel-height</replaceable> dem Wert
                der <literal>py</literal>-F&auml;higkeit (Voreinstellung
                ebenfalls 0) entspricht.</para>
          </listitem>

          <listitem>
            <para><emphasis>Ausgabefilter</emphasis> werden nur verwendet, wenn
              keine Textfilter vorhanden sind oder wenn Deckbl&auml;tter
              ben&ouml;tigt werden.  Der Abschnitt <link
              linkend="printing-advanced-of">Ausgabefilter</link>
              enth&auml;lt weitere Informationen.  Ausgabefilter
              unterst&uuml;tzen nur zwei Argumente:</para>

              <cmdsynopsis>
                <command>filter-name</command>
                <arg choice="plain">-w <replaceable>width</replaceable></arg>
                <arg choice="plain">-l <replaceable>length</replaceable></arg>
              </cmdsynopsis>

              <para>Beide Argumente entsprechen den Optionen
                <option>-w</option> und <option>-l</option> der
                Textfilter.</para>
          </listitem>
        </itemizedlist>

        <para>Alle Filter sollten mit folgenden R&uuml;ckgabewerten
          (Exitcodes) <emphasis>beendet</emphasis> werden:</para>

        <variablelist>
          <varlistentry>
            <term>exit 0</term>

            <listitem>
              <para>Der Filter hat die Datei erfolgreich gedruckt.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>exit 1</term>

            <listitem>
              <para>Der Filter war nicht in der Lage, die Datei zu
                drucken und meldet diesen Exitcode an
                <application>LPD</application>, um die Datei erneut
                zu drucken.  <application>LPD</application> startet
                daraufhin den Filter erneut.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>exit 2</term>

            <listitem>
              <para>Der Filter war nicht in der Lage, die Datei zu
                drucken.  Bei diesem Exitcode soll
                <application>LPD</application> aber nicht versuchen,
                die Datei erneut zu drucken, sondern den Druckauftrag
                verwerfen.</para>
            </listitem>
          </varlistentry>
        </variablelist>

	<para><filename>/usr/libexec/lpr/lpf</filename>, der mit &os;
	  gelieferte Textfilter, nutzt die Argumente <foreignphrase>page
	  width</foreignphrase> und <foreignphrase>page
	  length</foreignphrase>, um festzulegen, wann ein Seitenumbruch
	  (<foreignphrase>form feed</foreignphrase>) gesendet werden
	  soll sowie zur Verrechnung von Druckauftr&auml;gen.  Dazu werden
	  der Benutzername, der f&uuml;r den Druckauftrag verwendete
	  Rechner sowie die Verrechnungsdatei ausgewertet, um die
	  entsprechenden Eintr&auml;ge zu erstellen.</para>

	<para>Wenn Sie auf der Suche nach Filtern sind, achten Sie
	  darauf, dass diese LPD-kompatibel sind.  Dazu m&uuml;ssen
	  diese die oben beschriebenen Argumente unterst&uuml;tzen.
	  Wenn Sie planen, Ihre Filter selbst zu erstellen, m&uuml;ssen
	  diese ebenfalls die gleichen Argumente und Exitcodes
	  unterst&uuml;tzen.</para>
      </sect3>

      <sect3 id="printing-advanced-if-conversion">
	<title>Normalen Text auf &postscript;-Druckern drucken</title>

	<indexterm><primary>Druckjob</primary></indexterm>

	<para>Sie sind der alleinige Benutzer Ihres Computers und Ihres
	  &postscript;-Druckers und Sie sind sich sicher, dass Sie
	  niemals normalen Text an Ihren Drucker senden werden?
	  Au&szlig;erdem werden Sie niemals ein Programm verwenden,
	  um normalen Text auszudrucken?  Nur wenn dies alles zutrifft,
	  k&ouml;nnen Sie diesen Abschnitt &uuml;berspringen.</para>

	<para>Wollen Sie allerdings sowohl &postscript; als auch
	  normalen Text drucken, m&uuml;ssen Sie Ihren Drucker zuvor
	  entsprechend konfigurieren.  Dazu muss Ihr Textfilter in der
	  Lage sein, zu unterscheiden, ob es sich bei einem ankommenden
	  Druckauftrag um normalen Text oder um &postscript;-Daten
	  handelt.  Jeder &postscript;-Druckauftrag muss mit den Zeichen
	  <literal>%!</literal> beginnen (sehen Sie in Ihrem
	  Druckerhandbuch nach, ob Ihr Drucker weitere Sprachen
	  unterst&uuml;tzt).  Sind dies die beiden ersten Zeichen eines
	  Druckauftrages, so handelt es sich um &postscript;-Daten, die
	  direkt gedruckt werden k&ouml;nnen.  Fehlen diese Zeichen allerdings,
	  muss der Textfilter den Inhalt der Datei nach &postscript;
	  konvertieren, bevor die Datei gedruckt werden kann.</para>

        <para>Wie funktioniert diese Unterscheidung?</para>

        <indexterm>
          <primary>Drucker</primary>
          <secondary>seriell</secondary>
        </indexterm>

	<para>Haben Sie einen seriellen Drucker, k&ouml;nnen Sie
	  <command>lprps</command> installieren.
	  <command>lprps</command> ist ein &postscript;-Druckerfilter,
	  der eine Zweiwegekommunikation mit einem Drucker
	  erm&ouml;glicht.  Er aktualisiert die Druckerstatusdatei mit
	  Protokollinformationen des Druckers.  Dadurch sind Anwender
	  und Administratoren in der Lage, den genauen Zustand des
	  Druckers zu pr&uuml;fen (durch Meldungen wie <errorname>toner
	  low</errorname> oder <errorname>paper jam</errorname>).
	  Wichtiger ist allerdings, dass <command>lprps</command>
	  <command>psif</command> enth&auml;lt, ein Programm, das
	  feststellen kann, ob ein ankommender Druckauftrag normalen
	  Text enth&auml;lt.  Ist dies der Fall, wird
	  <command>textps</command> (das ebenfalls mit
	  <command>lprps</command> geliefert wird) aufgerufen und die
	  Datei nach &postscript; konvertiert.  Danach kann
	  <command>lprps</command> die Datei an den Drucker senden.</para>

	<para><command>lprps</command> ist in der &os;
	  <link linkend="ports">Ports-Sammlung</link> enthalten.  Je
	  nach der von Ihnen verwendeten Papiergr&ouml;&szlig;e
	  installieren Sie dazu den Port <filename
	  role="package">print/lprps-a4</filename> oder <filename
	  role="package">print/lprps-letter</filename>.  Nach
	  der Installation m&uuml;ssen Sie nur noch den Pfad zum
	  Programm <command>psif</command> angeben, das als Teil von
	  <command>lprps</command> installiert wird.  Haben Sie
	  <command>lprps</command> &uuml;ber die Ports-Sammlung installiert,
	  f&uuml;gen Sie folgende Zeile in den Eintrag Ihres
	  &postscript;-Druckers in
	  <filename>/etc/printcap</filename> ein:</para>

        <programlisting>:if=<filename>/usr/local/libexec/psif</filename>:</programlisting>

	<para>Zus&auml;tzlich sollten Sie die
	  <literal>rw</literal>-F&auml;higkeit aktivieren, um
	  <application>LPD</application> im Schreib- und Lesemodus
	  zu &ouml;ffnen.</para>

	<para>Haben Sie hingegen einen parallelen &postscript;-Drucker,
	 was eine Zweiwegekommunikation mit Ihrem Drucker (auf die
	 <command>lprps</command> angewiesen ist) unm&ouml;glich
	 macht, k&ouml;nnen Sie das folgende Shell-Skript verwenden:</para>

        <programlisting>#!/bin/sh
#
#  psif - Drucke PostScript oder normalen Text auf einem PostScript-Drucker
#  Script-Version; das ist NICHT die mit lprps gelieferte Version!
#  Installiert unter:  /usr/local/libexec/psif
#

IFS="" read -r first_line
first_two_chars=`expr "$first_line" : '\(..\)'`

if [ "$first_two_chars" = "%!" ]; then
    #
    #  PostScript - einfach drucken.
    #
    echo "$first_line" &amp;&amp; cat &amp;&amp; printf "\004" &amp;&amp; exit 0
    exit 2
else
    #
    #  Normaler Text - zuerst konvertieren, dann drucken.
    #
    ( echo "$first_line"; cat ) | /usr/local/bin/textps &amp;&amp; printf "\004" &amp;&amp; exit 0
    exit 2
fi      </programlisting>

	<para>F&uuml;r dieses Skript wurde <command>textps</command>
	  als seperates Programm installiert, um normalen Text nach
	  &postscript; zu konvertieren.  Sie k&ouml;nnen aber auch jeden
	  anderen Text-nach-&postscript;-Konverter verwenden.  Die
	  &os; <link linkend="ports">Ports-Sammlung</link>
	  enth&auml;lt mit <literal>a2ps</literal> ein umfangreiches
	  Programm zur Konvertierung von normalem Text nach
	  &postscript;.</para>
      </sect3>

      <sect3 id="printing-advanced-ps">
        <title>&postscript; auf Nicht-&postscript;-Druckern emulieren</title>

        <indexterm>
          <primary>PostScript</primary>
          <secondary>Emulation</secondary>
        </indexterm>
        <indexterm>
          <primary>Ghostscript</primary></indexterm>

	<para>Bei &postscript; handelt es sich um den
	  <emphasis>de facto</emphasis>-Standard f&uuml;r hochwertigen
	  Schriftsatz und Druck.  Leider ist &postscript; aber auch ein
	  <emphasis>teurer</emphasis> Standard.  Gl&uuml;cklicherweise
	  hat Aladdin Enterprises daher eine freie
	  &postscript;-&auml;hnliche Implementierung namens
	  <application>Ghostscript</application> entwickelt, die auch
	  unter &os; lauff&auml;hig ist.
	  <application>Ghostscript</application> kann fast jede
	  &postscript;-Datei lesen und auf den verschiedensten
	  Ger&auml;ten ausgeben, darunter auch auf vielen
	  Nicht-&postscript;-Druckern.  Durch die Installation von
	  <application>Ghostscript</application> und die Nutzung eines
	  speziellen Textfilters erreichen Sie, dass sich Ihr
	  Nicht-&postscript;-Drucker wie ein echter &postscript;-Drucker
	  verh&auml;lt.</para>

	<para><application>Ghostscript</application> ist in
	  verschiedenen Versionen in der &os; Ports-Sammlung enhalten,
	  die am h&auml;figsten verwendete Version ist <filename
	  role="package">print/ghostscript-gpl</filename>.</para>

	<para>Um &postscript; zu emulieren, muss der Textfilter erkennen, ob er
	  eine &postscript;-Datei drucken soll.  Ist dies nicht der Fall, wird
	  die Datei direkt an den Drucker geschickt.  Anderenfalls wird die
	  Datei an <application>Ghostscript</application> &uuml;bergeben, das
	  die Datei in ein Format konvertiert, das Ihr Drucker versteht.</para>

	<para>Dazu ein Beispiel.  Das folgende Skript ist ein Textfilter
	  f&uuml;r den Drucker DeskJet 500 von Hewlett Packard.  Nutzen
	  Sie einen anderen Drucker, m&uuml;ssen Sie die Option
	  <option>-sDEVICE</option> beim Aufruf von <command>gs</command>
	  (Ghostscript) entsprechend anpassen.  Eine Liste der von
	  <application>Ghostscript</application> unterst&uuml;tzten
	  Ger&auml;te erhalten Sie durch die Eingabe von
	  <command>gs <option>-h</option></command> auf der
	  Kommandozeile.</para>

        <programlisting>#!/bin/sh
#
#  ifhp - Ghostscript-emuliertes PostScript auf einem HP DeskJet 500 drucken
#  Installiert unter:  /usr/local/libexec/ifhp

#
#  LF als CR+LF behandeln (um einen "Treppeneffekt" auf HP/PCL-Drucker
#  zu vermeiden)
#
printf "\033&amp;k2G" || exit 2

#
#  Lies die ersten zwei Zeichen der Datei
#
IFS="" read -r first_line
first_two_chars=`expr "$first_line" : '\(..\)'`

if [ "$first_two_chars" = "%!" ]; then
    #
    #  Oh.  Es ist PostScript; mit Ghostscript konvertieren, danach drucken.
    #
    /usr/local/bin/gs -dSAFER -dNOPAUSE -q -sDEVICE=djet500 \
      -sOutputFile=- - &amp;&amp; exit 0
else
    #
    #  Normaler Text oder HP/PCL, einfach direkt drucken.  Ans Ende setzen wir
    #  einen Seitenumbruch (also ein Form Feed), damit auch die letzte Seite
    #  ausgeworfen wird.
    #
    echo "$first_line" &amp;&amp; cat &amp;&amp; printf "\033&amp;l0H" &amp;&amp;
exit 0
fi

exit 2</programlisting>

	<para>Zuletzt m&uuml;ssen Sie <application>LPD</application>
	  noch durch die <literal>if</literal>-F&auml;higkeit &uuml;ber
	  den neuen Filter informieren:</para>

	<programlisting>:if=<filename>/usr/local/libexec/ifhp</filename>:</programlisting>

	<para>Das ist alles.  Ab sofort sollte sowohl ein <command>lpr
	  <filename><replaceable>normaler.text</replaceable></filename></command>
	  als auch ein <command>lpr <replaceable>wasauchimmer.ps</replaceable></command>
	  funktionieren und beide Dateien sollten problemlos gedruckt
	  werden.</para>
      </sect3>

      <sect3 id="printing-advanced-convfilters">
	<title>Konvertierungsfilter</title>

	<para>Nachdem Sie Ihren Drucker wie unter <link
	  linkend="printing-simple">Einfache Drucker-Konfiguration</link>
	  eingerichtet haben, wollen Sie wahrscheinlich einige
	  Konvertierungsfilter installieren, damit Sie (abgesehen von
	  ASCII-Text) auch Ihre Lieblings-Dateiformate drucken
	  k&ouml;nnen.</para>

	<sect4>
	  <title>Warum sollte ich einen Konvertierungsfilter
	    installieren?</title>

	  <indexterm>
	    <primary>&tex;</primary>
	    <secondary>DVI-Dateien drucken</secondary>
	  </indexterm>

	  <para>Konvertierungsfilter erleichtern das Drucken von
	    verschiedenen Dateiformaten.  Nehmen wir beispielsweise an,
	    dass Sie sehr viel mit dem &tex;-Satzsystem arbeiten und
	    &uuml;ber einen &postscript;-Drucker verf&uuml;gen.  Eine
	    vom &tex;-System erzeugte DVI-Datei kann erst dann gedruckt
	    werden, nachdem diese nach &postscript; konvertiert wurde.
	    Dazu geben Sie Folgendes ein:</para>

	  <screen>&prompt.user; <userinput><command>dvips <filename><replaceable>seaweed-analysis.dvi</replaceable></filename></command></userinput>
&prompt.user; <userinput><command>lpr <filename><replaceable>seaweed-analysis.ps</replaceable></filename></command></userinput></screen>

	  <para>Haben Sie einen Konvertierungsfilter f&uuml;r DVI-Dateien
	    installiert, k&ouml;nnen Sie die manuelle Konvertierung
	    &uuml;berspringen, da dies nun <application>LPD</application>
	    f&uuml;r Sie erledigt.  Wollen Sie eine DVI-Datei drucken, geben
	    Sie nur noch den folgenden Befehl ein:</para>

	  <screen>&prompt.user; <userinput><command>lpr <option>-d</option> <filename><replaceable>seaweed-analysis.dvi</replaceable></filename></command></userinput></screen>

	  <para>Durch die Verwendung der Option <option>-d</option>
	    wurde <application>LPD</application> angewiesen, unsere
	    DVI-Datei vor dem Druck zu konvertieren.  Der Abschnitt
	    <link linkend="printing-lpr-options-format">Formatierungs-
	    und Konvertierungsoptionen</link> beschreibt die dabei
	    m&ouml;glichen Optionen.</para>

	  <para>F&uuml;r jede Konvertierungsoption, die Ihr Drucker
	    unterst&uuml;tzen soll, m&uuml;ssen Sie einen eigenen
	    <emphasis>Konvertierungsfilter</emphasis> installieren und
	    dessen Pfad in der Datei <filename>/etc/printcap</filename>
	    angeben.  Ein Konvertierungsfilter verh&auml;lt sich im
	    Prinzip wie ein Textfilter bei einer einfachen
	    Druckerkonfiguration (lesen Sie dazu auch den Abschnitt <link
	    linkend="printing-textfilter">Den Textfilter installieren</link>),
	    allerdings konvertiert er die Datei in ein Format, das Ihr Drucker
	    versteht, anstatt normalen Text zu drucken.</para>
	</sect4>

	<sect4>
	  <title>Welche Konvertierungsfilter sollte ich installieren?</title>

	  <para>Sie sollten nur Filter installieren, die Sie auch
	    ben&ouml;tigen.  Wenn Sie sehr viele DVI-Dateien drucken,
	    sollten Sie auch einen DVI-Konvertierungsfilter installieren.
	    M&uuml;ssen Sie viele troff-Daten drucken, ist ein troff-Filter
	    hilfreich.</para>

	  <para>Die folgende Tabelle listet die von
	    <application>LPD</application> unterst&uuml;tzten Filter
	    sowie die Eintr&auml;ge in <filename>/etc/printcap</filename> auf,
	    mit denen Sie diese F&auml;higkeiten aktivieren.  Zus&auml;tzlich
	    wird angegeben, wie Sie <command>lpr</command> jeweils
	    aufrufen m&uuml;ssen:</para>

          <informaltable frame="none" pgwide="1">
            <tgroup cols="3">
              <thead>
                <row>
                  <entry>Dateityp</entry>
                  <entry><filename>/etc/printcap</filename>-F&auml;higkeit</entry>
                  <entry><command>lpr</command>-Option</entry>
                </row>
              </thead>

              <tbody>
                <row>
                  <entry>cifplot</entry>
                  <entry><literal>cf</literal></entry>
                  <entry><option>-c</option></entry>
                </row>

                <row>
                  <entry>DVI</entry>
                  <entry><literal>df</literal></entry>
                  <entry><option>-d</option></entry>
                </row>

                <row>
                  <entry>plot</entry>
                  <entry><literal>gf</literal></entry>
                  <entry><option>-g</option></entry>
                </row>

                <row>
                  <entry>ditroff</entry>
                  <entry><literal>nf</literal></entry>
                  <entry><option>-n</option></entry>
                </row>

                <row>
                  <entry>FORTRAN-Text</entry>
                  <entry><literal>rf</literal></entry>
                  <entry><option>-f</option></entry>
                </row>

                <row>
                  <entry>troff</entry>
                  <entry><literal>tf</literal></entry>
                  <entry><option>-f</option></entry>
                </row>

                <row>
                  <entry>Rasterdaten</entry>
                  <entry><literal>vf</literal></entry>
                  <entry><option>-v</option></entry>
                </row>

                <row>
                  <entry>Normaler Text</entry>
                  <entry><literal>if</literal></entry>
                  <entry>keine, <option>-p</option>, or
                    <option>-l</option></entry>
                </row>
              </tbody>
            </tgroup>
          </informaltable>

	  <para>Wollen Sie also <command>lpr <option>-d</option></command>
	    verwenden, muss die <literal>df</literal>-F&auml;higkeit in
	    <filename>/etc/printcap</filename> aktiviert sein.</para>

	  <indexterm><primary>FORTRAN</primary></indexterm>

	  <para>Obwohl manche Leute etwas anderes behaupten, sind
	    Formate wie FORTRAN-Text und -Plot inzwischen nahezu
	    obsolet.  Wenn Sie diese Formate dennoch ben&ouml;tigen,
	    installieren Sie einfach einen angepassten Filter.  Wollen
	    Sie beispielsweise zwar Printerleaf-Dateien (also Dateien des
	    Desktop Publishing-Programms von Interleaf), aber keine
	    Plotdateien drucken, so k&ouml;nnen Sie einen
	    Printerleaf-Konvertierungsfilter installieren, der es durch
	    die Aktivierung der <literal>gf</literal>-F&auml;higkeit
	    erlaubt, diese Dateien direkt zu drucken.  Nun m&uuml;ssen
	    Sie Ihren Mitarbeitern nur noch mitteilen, dass
	    <command>lpr <option>-g</option></command> nun f&uuml;r
	    <quote>drucke Printerleaf-Dateien</quote> steht.</para>
	</sect4>

	<sect4>
	  <title>Konvertierungsfilter installieren</title>

	  <para>Da Konvertierungsfilter nicht zum Basissystem von &os;
	    geh&ouml;ren, sollten diese unter <filename
	    class="directory">/usr/local</filename> installiert werden.
	    H&auml;ufig wird das Verzeichnis <filename
	    class="directory">/usr/local/libexec</filename> verwendet, da es
	    sich bei Konvertierungsfiltern um spezielle Programme
	    handelt, die nur von <application>LPD</application>, aber
	    nicht von einem normalen Benutzer gestartet werden.</para>

	  <para>Um einen Konvertierungsfilter zu aktivieren, m&uuml;ssen
	    Sie dessen Pfad zus&auml;tzlich zur ben&ouml;tigten F&auml;higkeit
	    in der Datei <filename>/etc/printcap</filename> eintragen.</para>

	  <para>In unserem Beispiel wollen wir einen
	    DVI-Konvertierungsfilter f&uuml;r den Drucker
	    <literal>bamboo</literal> installieren.  Unsere bereits
	    bekannte <filename>/etc/printcap</filename> wurde
	    allerdings um die <literal>df</literal>-F&auml;higkeit
	    f&uuml;r den Drucker <literal>bamboo</literal> erweitert:</para>

          <programlisting>#
#  /etc/printcap des Rechners rose - neuer df-Filter f&uuml;r bamboo
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=<filename class="directory">/var/spool/lpd/rattan</filename>:\
        :lp=<filename class="devicefile">/dev/lpt0</filename>:\
        :if=<filename>/usr/local/libexec/if-simple</filename>:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<filename class="directory">/var/spool/lpd/bamboo</filename>:\
        :lp=<filename class="devicefile">/dev/ttyu5</filename>:ms#-parenb cs8 clocal crtscts:rw:\
        :if=<filename>/usr/local/libexec/psif</filename>:\
        :df=<filename>/usr/local/libexec/psdf</filename>:</programlisting>

	  <para>Beim DVI-Filter handelt es sich um ein Shell-Skript
	    namens <filename>/usr/local/libexec/psdf</filename>:</para>

	  <programlisting>#!/bin/sh
#
#  psdf - DVI-nach-PostScript Druckerfilter
#  Installiert unter:  /usr/local/libexec/psdf
#
#  Wird von lpd aktiviert, wenn der Nutzer lpr -d eingibt.
#
exec /usr/local/bin/dvips -f | /usr/local/libexec/lprps "$@"</programlisting>

	  <para>Dieses Skript startet <command>dvips</command> im
	    Filtermodus (durch das Argument <option>-f</option> wird der
	    Druckauftrag &uuml;ber die Standardeingabe entgegengenommen).
	    Danach wird der &postscript;-Druckerfilter
	    <command>lprps</command> (lesen Sie dazu auch den Abschnitt <link
	    linkend="printing-advanced-if-conversion">Drucken von reinen
	    Textdateien auf einem &postscript;-Drucker</link>) mit den von
	    <application>LPD</application> &uuml;bergebenen Argumenten
	    gestartet.  Das <command>lprps</command>-Werkzeug wiederum nutzt
	    diese Argumente, um die gedruckten Seiten zu verrechnen.</para>
	</sect4>

	<sect4>
	  <title>Beispiele f&uuml;r Konvertierungsfilter</title>

	  <para>Da es keine verbindliche Prozedur zur Installation eines
	    Druckerfilters gibt, folgen nun weitere Beispiele in diesem
	    Abschnitt.  Verwenden Sie diese, um Ihre eigenen Filter zu
	    erstellen.  Falls ein Filter Ihren Anforderungen bereits
	    entspricht, k&ouml;nnen Sie ihn auch direkt verwenden.</para>

	  <para>Das erste Beispiel beschreibt einen Konvertierungsfilter
            f&uuml;r GIF-Dateien f&uuml;r den Drucker LaserJet III-Si von
            Hewlett Packard:</para>

	  <programlisting>#!/bin/sh
#
#  hpvf - Konvertiert GIF-Dateien nach HP/PCL, danach wird gedruckt.
#  Installiert unter:  /usr/local/libexec/hpvf

PATH=/usr/X11R6/bin:$PATH; export PATH
giftopnm | ppmtopgm | pgmtopbm | pbmtolj -resolution 300 \
    &amp;&amp; exit 0 \
    || exit 2</programlisting>

	  <para>Dieser Filter konvertiert eine GIF-Datei in eine portable
	    Anymap, diese in ein portables Graustufenbild, dieses wiederum in
	    eine portable Bitmap, die schlie&szlig;lich in ein
	    LaserJet/PCL-kompatibles Format umgewandelt wird.</para>

	  <para><filename>/etc/printcap</filename> muss f&uuml;r einen Drucker,
	    der diesen Filter nutzen will, folgenden Eintrag enthalten:</para>

	  <programlisting>#
#  /etc/printcap des Rechners orchid
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=<filename class="devicefile">/dev/lpt0</filename>:sh:sd=<filename class="directory">/var/spool/lpd/teak</filename>:mx#0:\
        :if=<filename>/usr/local/libexec/hpif</filename>:\
        :vf=<filename>/usr/local/libexec/hpvf</filename>:</programlisting>

	  <para>Das folgende Skript ist ein Konvertierungsfilter, der
	    das Drucken von troff-Daten des groff-Textsatzsystems
	    auf dem &postscript;-Drucker <literal>bamboo</literal>
	    erm&ouml;glicht:</para>

	  <programlisting>#!/bin/sh
#
#  pstf - Konvertiert groff's troff-Daten nach PS, dann wird gedruckt.
#  Installiert unter:  /usr/local/libexec/pstf
#
exec grops | /usr/local/libexec/lprps "$@"</programlisting>

	  <para>Dieses Skript nutzt wiederum <command>lprps</command>,
	    um mit dem Drucker zu kommunizieren.  W&auml;re der Drucker
	    an einem parallelen Port angeschlossen, w&uuml;rde das Skript
	    so aussehen:</para>

	  <programlisting>#!/bin/sh
#
#  pstf - Konvertiert groff's troff-Daten nach PS, danach wird gedruckt.
#  Installiert unter:  /usr/local/libexec/pstf
#
exec grops</programlisting>

	  <para>Das ist alles.  Um den Filter verwenden zu k&ouml;nnen,
	    m&uuml;ssen Sie ihn allerdings noch in
	    <filename>/etc/printcap</filename> aktivieren:</para>

	  <programlisting>:tf=<filename>/usr/local/libexec/pstf</filename>:</programlisting>

	  <para>Das n&auml;chste Skript ist ein FORTRAN-Textfilter
	    f&uuml;r jeden Drucker, der normalen Text direkt drucken
	    kann und der hier f&uuml;r den Drucker
	    <literal>teak</literal> installiert wird:</para>

	  <programlisting>#!/bin/sh
#
# hprf - FORTRAN-Textfilter f&uuml;r den Drucker LaserJet 3si:
# Installiert unter:  /usr/local/libexec/hprf
#

printf "\033&amp;k2G" &amp;&amp; fpr &amp;&amp; printf "\033&amp;l0H" &amp;&amp;
 exit 0
exit 2    </programlisting>

	  <para>Zus&auml;tzlich ben&ouml;tigen wir wiederum einen Eintrag in
	    <filename>/etc/printcap</filename>, um diesen Filter f&uuml;r den
	    Drucker <literal>teak</literal> zu aktivieren:</para>

	  <programlisting>:rf=<filename>/usr/local/libexec/hprf</filename>:</programlisting>

	  <para>Das letzte Beispiel ist etwas komplexer.  Es soll ein
	    DVI-Filter f&uuml;r den bereits erw&auml;hnten
	    LaserJet-Drucker <literal>teak</literal> installiert werden.
	    Der erste Teil ist einfach:  Sie m&uuml;ssen den Pfad des
	    DVI-Filters in <filename>/etc/printcap</filename> eintragen:</para>

	  <programlisting>:df=<filename>/usr/local/libexec/hpdf</filename>:</programlisting>

	  <para>Nun kommt der schwierige Teil:  Sie m&uuml;ssen den
	    Filter funktionsf&auml;hig machen.  Dazu ben&ouml;tigen Sie
	    einen DVI-nach-LaserJet/PCL-Konverter.
	    Gl&uuml;cklicherweise enth&auml;lt die &os; <link
	    linkend="ports">Ports-Sammlung</link> mit <filename
	    role="package">print/dvi2xx</filename> ein solches Programm.  Nach
	    der Installation des Pakets verf&uuml;gen wir &uuml;ber das
	    Programm <command>dvilj2p</command>, das zur Konvertierung
	    von DVI-Daten in zu den Druckern LaserJet IIp, LaserJet III,
	    sowie LaserJet 2000 kompatible Codes ben&ouml;tigt wird.</para>

	  <para>Durch den Einsatz von <command>dvilj2p</command> wird
	    der Filter <command>hpdf</command> relativ komplex, da
	    <command>dvilj2p</command> nicht von der Standardeingabe
	    lesen kann, sondern als Eingabe einen Dateinamen erwartet.
	    Zus&auml;tzlich muss der Dateiname auf <filename>.dvi</filename>
	    enden, daher ist die Verwendung von <filename
	    class="devicefile">/dev/fd/0</filename> als Standardeingabe
	    problematisch.  Wir k&ouml;nnen diese Problem aber umgehen, indem
	    wir einen tempor&auml;ren Dateinamen symbolisch nach <filename
	    class="devicefile">/dev/fd/0</filename> linken.
	    Dadurch wird <command>dvilj2p</command> gezwungen, dennoch von der
	    Standardeingabe zu lesen.</para>

	  <para>Das letzte Problem, das wir noch l&ouml;sen m&uuml;ssen,
	    ist, dass wir <filename class="directory">/tmp</filename> nicht als
	    tempor&auml;ren Link verwenden k&ouml;nnen.  Symbolische
	    Links geh&ouml;ren dem User sowie der Gruppe
	    <username>bin</username>.  Der Filter l&auml;uft aber als
	    User <username>daemon</username>.  Au&szlig;erdem ist
	    <filename class="directory">/tmp</filename> durch ein Sticky-Bit
	    gesichert.  Daher kann der Filter den Link zwar erzeugen, ein
	    Aufr&auml;umen ist aber nicht mehr m&ouml;glich, weil sich
	    die Eigent&uuml;mer des Filters und des tempor&auml;ren
	    Verzeichnisses unterscheiden.</para>

	  <para>Daher legt der Filter den symbolischen Link im
	    Arbeitsverzeichnis an, das gleichzeitig als Spooling-Verzeichnis
	    dient (festgelegt durch die Aktivierung
	    der <literal>sd</literal>-F&auml;higkeit in
	    <filename>/etc/printcap</filename>).  Das Arbeitsverzeichnis
	    ist ein idealer Ort f&uuml;r den Filter, insbesondere da dieses
	    (manchmal) sogar &uuml;ber mehr freien Speicherplatz als <filename
	    class="directory">/tmp</filename> verf&uuml;gt.</para>

	  <para>Mit diesen Informationen sind wir nun in der Lage, den
	    Filter zu entwickeln:</para>

	  <programlisting>#!/bin/sh
#
#  hpdf - DVI-Daten auf einen HP/PCL-Drucker drucken
#  Installiert unter:  /usr/local/libexec/hpdf

PATH=/usr/local/bin:$PATH; export PATH

#
#  Eine Funktion zum Aufr&auml;umen unserer tempor&auml;ren Dateien.
#  Diese finden sich im Arbeitsverzeichnis, das wir auch als
#  Spooling-Verzeichnis f&uuml;r unseren Drucker verwenden werden.
#
cleanup() {
   rm -f hpdf$$.dvi
}

#
#  Eine Funktion, um fatale Fehler zu behandeln.  Dazu die Meldung
#  ausgeben, danach ein exit 2.  Dadurch wei&szlig; LPD, dass es
#  den Auftrag nicht noch einmal drucken soll.
#
fatal() {
    echo "$@" 1&gt;&amp;2
    cleanup
    exit 2
}

#
#  Wenn ein Anwender den Auftrag entfernt, sendet LPD ein SIGINT, daher
#  wollen wir SIGINT und einige andere Signale abfangen (trappen), um
#  nach der Konvertierung aufr&auml;umen zu k&ouml;nnen.
#
trap cleanup 1 2 15

#
#  Bevor wir anfangen, r&auml;umen wir noch auf.  Sicher ist sicher.
#
cleanup

#
#  Die DVI-Eingabedatei auf die Standardeingabe linken (die zu druckende
#  Datei).
#
ln -s /dev/fd/0 hpdf$$.dvi || fatal "Konnte Symlink nicht anlegen!"

#
#  Umwandeln: LF = CR+LF
#
printf "\033&amp;k2G" || fatal "Konnte Drucker nicht initialisieren!"

#
#  Konvertieren und drucken.  Da der R&uuml;ckgabewert von dvilj2p
#  unzuverl&auml;ssig ist, ignorieren wir ihn einfach.
#
dvilj2p -M1 -q -e- dfhp$$.dvi

#
#  Aufr&auml;umen und beenden.
#
cleanup
exit 0    </programlisting>
	</sect4>

	<sect4 id="printing-advanced-autoconv">
	  <title>Automatische Konvertierung:  Eine Alternative zu
	    Konvertierungsfiltern</title>

	  <para>Alle in diesem Abschnitt besprochenen Konvertierungsfilter sind
	    zwar sehr hilfreich, allerdings m&uuml;ssen Sie nach wie vor bei
	    jedem Aufruf von &man.lpr.1; angeben, welchen Filter sie verwenden
	    wollen, was mit der Zeit sicher nervend wird.  Schlimmer ist
	    allerdings, dass die Auswahl eines unpassenden Filters dazu
	    f&uuml;hren kann, dass Sie Hunderte Seiten Papier ausdrucken.</para>

	  <para>Statt also Konvertierungsfilter zu installieren,
	    k&ouml;nnten Sie den Textfilter (der ohnehin der
	    Standardfilter ist) verwenden, um den zu druckenden
	    Dateityp zu erkennen und anschlie&szlig;end den korrekten
	    Konvertierungsfilter auszuw&auml;hlen.  Um den Dateityp
	    zu bestimmen, k&ouml;nnen Sie beispielsweise
	    <command>file</command> verwenden.  Leider ist es bei
	    <emphasis>einigen</emphasis> Dateitypen problematisch, diese zu
	    unterscheiden.  Daher k&ouml;nnten Sie f&uuml;r diese Dateitypen
	    dennoch einen Konvertierungsfilter installieren.</para>

	  <indexterm><primary>apsfilter</primary></indexterm>

	  <indexterm>
	    <primary>Drucken</primary>
	    <secondary>Filter</secondary>
	    <tertiary>apsfilter</tertiary>
	  </indexterm>

	  <para>Die &os; Ports-Sammlung enth&auml;lt mit
	    <command>apsfilter</command> (<filename
	    role="package">print/apsfilter</filename>) einen Textfilter, der
	    diese automatische Konvertierung durchf&uuml;hren kann.  Er ist
	    in der Lage, normalen Text, &postscript;, DVI und beinahe jede
	    Art von Datei zu erkennen, diese zu konvertieren und auf
	    Ihren Drucker auszugeben.</para>
        </sect4>
      </sect3>

      <sect3 id="printing-advanced-of">
	<title>Ausgabefilter</title>

	<para><application>LPD</application> unterst&uuml;tzt noch eine
	  weitere Filterart, die sogenannten Ausgabefilter.  Diese sind
	  &ndash;&nbsp;analog zu einem Textfilter&nbsp;&ndash;&nbsp;
	  f&uuml;r den Druck von normalem Text ausgelegt, allerdings
	  verf&uuml;gen sie im Vergleich zu diesen nur &uuml;ber
	  sehr eingeschr&auml;nkte F&auml;higkeiten.  Wenn Sie einen
	  Ausgabefilter (aber keinen Textfilter) verwenden, dann</para>

	<itemizedlist>
	  <listitem>
	    <para>startet <application>LPD</application> nur einen
	      Ausgabefilter f&uuml;r den kompletten Druckauftrag, statt
	      f&uuml;r jede Datei des Auftrags einen eigenen Filter zu
	      starten.</para>
	  </listitem>

	  <listitem>
	    <para>k&uuml;mmert sich <application>LPD</application> nicht
	      darum, den Beginn oder das Ende einer Datei innerhalb des
	      Druckauftrages zu finden.</para>
	  </listitem>

	  <listitem>
	    <para>&uuml;bergibt <application>LPD</application> weder
	      den Benutzer- noch den Rechnernamen desjenigen, der den
	      Druckauftrag erteilt hat, an den Ausgabefilter, was
	      eine Verrechnung von Druckauftr&auml;gen unm&ouml;glich
	      macht.  Ausgabefilter unterst&uuml;tzen insgesamt nur
	      zwei Argumente:</para>

	    <cmdsynopsis>
	      <command>filter-name</command>
	      <arg choice="plain">-w <replaceable>width</replaceable></arg>
	      <arg choice="plain">-l <replaceable>length</replaceable></arg>
	    </cmdsynopsis>

	    <para><replaceable>width</replaceable> basiert auf der
	      <literal>pw</literal>-F&auml;higkeit,
	      <replaceable>length</replaceable> hingegen auf der
	      <literal>pl</literal>-F&auml;higkeit des gew&auml;hlten
	      Druckers.</para>
	  </listitem>
	</itemizedlist>

	<para>Lassen Sie sich von dieser angeblichen Einfachheit eines
	  Ausgabefilters nicht t&auml;uschen.  Ausgabefilter sind
	  beispielsweise <emphasis>nicht dazu in der Lage</emphasis>,
	  jede Datei eines Druckauftrages auf einer neuen Seite zu
	  drucken.  Dazu ben&ouml;tigen Sie einen Textfilter (die im
	  Abschnitt <link linkend="printing-textfilter">Den Textfilter
	  installieren</link> beschrieben werden).  Au&szlig;erdem
	  sind Ausgabefilter in Wirklichkeit
	  <emphasis>komplexer</emphasis>, da sie den gesendeten
	  Bytestrom nicht nur auf Sonderzeichen hin untersuchen
	  m&uuml;ssen, sondern auch die &Uuml;bertragung von Signalen
	  f&uuml;r <application>LPD</application> &uuml;bernehmen
	  m&uuml;ssen.</para>

	<para>Sie <emphasis>ben&ouml;tigen</emphasis> Ausgabefilter
	  aber dann, wenn Sie Deckbl&auml;tter drucken wollen, da
	  dazu Escape-Sequenzen und Initialisierungsstrings
	  erforderlich sind.  (Es ist allerdings <emphasis>nicht
	  m&ouml;glich</emphasis>, den Druck dieser Deckbl&auml;tter
	  zu verrechnen, da <application>LPD</application>
	  keine Benutzer- oder Rechnerinformationen an den Ausgabefilter
	  &uuml;bergibt.)</para>

	<para><application>LPD</application> kann f&uuml;r den gleichen
	  Drucker sowohl Ausgabefilter als auch Textfilter verwenden.
	  In solchen F&auml;llen verwendet <application>LPD</application>
	  den Ausgabefilter nur f&uuml;r den Druck von Deckbl&auml;ttern
	  (die im Abschnitt <link
	  linkend="printing-advanced-header-pages">Deckbl&auml;tter</link>
	  n&auml;her beschrieben werden).  Nach dem Druck des Deckblattes
	  erwartet <application>LPD</application>, dass sich der
	  Ausgabefilter <emphasis>selbst beendet</emphasis>.  Dazu werden
	  zwei Bytes an den Ausgabefilter gesendet:  ASCII 031, gefolgt
	  von ASCII 001.  Wenn ein Ausgabefilter diese zwei Bytes
          (031, 001) empf&auml;ngt, sendet er das Signal
	  <literal>SIGSTOP</literal> an sich selbst.  Nachdem
	  <application>LPD</application> den Rest des Druckauftrages
	  erledigt hat, wird der Ausgabefilter erneut gestartet, indem
	  ein <literal>SIGCONT</literal> an den Ausgabefilter
	  gesendet wird.</para>

	<para>Haben Sie nur einen Ausgabefilter, aber
	  <emphasis>keinen</emphasis> Textfilter installiert, dann
	  verwendet <application>LPD</application> den Ausgabefilter auch
	  f&uuml;r den Druck von normalem Text.  Wie bereits erw&auml;hnt,
	  werden dabei allerdings alle Dateien des Druckauftrags unmittelbar
	  hintereinander gedruckt, Seitenumbr&uuml;che oder ein
	  zus&auml;tzlicher Papiervorschub sind also nicht m&ouml;glich.
	  Da dieses Verhalten von Ihnen wahrscheinlich
	  <emphasis>nicht</emphasis> gew&uuml;nscht wird, werden Sie in
	  fast allen F&auml;llen einen zus&auml;tzlichen Textfilter
	  ben&ouml;tigen.</para>

	<para>Der weiter oben beschriebene Textfilter
	  <command>lpf</command> kann auch als Ausgabefilter verwendet
	  werden.  Wenn Sie nur einen funktionierenden Ausgabefilter
	  ben&ouml;tigen, aber nicht den daf&uuml;r ben&ouml;tigten
	  Code (zur Zeichenerkennung und zum Senden von Signalen)
	  schreiben wollen, sollten Sie sich <command>lpf</command>
	  n&auml;her ansehen.  Sie k&ouml;nnen <command>lpf</command>
	  auch in ein Shell-Skript einbinden, um von Ihrem Drucker
	  ben&ouml;tigte Initialisierungscodes zu verarbeiten.</para>
      </sect3>

      <sect3 id="printing-advanced-lpf">
	<title><command>lpf</command>:  Ein Textfilter</title>

	<para>Der Textfilter (Eingabefilter)
	  <filename>/usr/libexec/lpr/lpf</filename> wird bereits mit
	  &os; geliefert.  Er erlaubt das Einr&uuml;cken der
	  Ausgabe (&uuml;ber <command>lpr <option>-i</option></command>), die
	  &Uuml;bergabe von Zeichen-Literalen
	  (&uuml;ber <command>lpr <option>-l</option></command>), das Anpassen
	  der Druckposition bei gel&ouml;schten Zeichen
	  (<foreignphrase>Backspaces</foreignphrase>) oder Tabulatoren,
	  sowie die Verrechnung gedruckter Seiten.  Zus&auml;tzlich
	  kann dieser Textfilter auch als Ausgabefilter arbeiten.</para>

	<para><command>lpf</command> ist f&uuml;r viele verschiedene
	  Druckumgebungen geeignet.  Zwar ist dieser Textfilter nicht
	  in der Lage, Initialisierungssequenzen an einen Drucker
	  zu senden, dieses Problem kann allerdings durch das Schreiben
	  und Ausf&uuml;hren eines Shell-Skripts (das diese Funktion
	  &uuml;bernimmt) und das anschlie&szlig;ende Aufrufen von
	  <command>lpf</command> gel&ouml;st werden.</para>

        <indexterm><primary>Seiten verrechnen</primary></indexterm>
        <indexterm>
          <primary>verrechnen</primary>
          <secondary>Druckernutzung</secondary>
        </indexterm>

	<para>Damit Sie <command>lpf</command> f&uuml;r die Verrechnung
	  von Druckauftr&auml;gen einsetzen k&ouml;nnen, m&uuml;ssen Sie
	  die korrekten Werte f&uuml;r die <literal>pw</literal>- und
	  <literal>pl</literal>-F&auml;higkeiten in
	  <filename>/etc/printcap</filename> eintragen.
	  <command>lpf</command> verwendet diese Werte, um festzustellen,
	  wieviel Text auf eine Seite passt und wieviele Seiten im
	  Druckauftrag enthalten sind.  Weitere Informationen zur
	  Verrechnung der Druckernutzung enth&auml;lt der Abschnitt
	  <link linkend="printing-advanced-acct">Die Druckernutzung
	  verrechnen</link>.</para>
      </sect3>
    </sect2>

    <sect2 id="printing-advanced-header-pages">
      <title>Deckbl&auml;tter</title>

      <para>Wenn Sie <emphasis>viele</emphasis> Benutzer mit verschiedenen
        Druckern verwalten m&uuml;ssen, sollten Sie
        <emphasis>Deckbl&auml;tter</emphasis> als notwendiges &Uuml;bel
	akzeptieren.</para>

      <indexterm>
        <primary>Bannerseiten</primary>
	<see>Deckbl&auml;tter</see>
      </indexterm>

      <indexterm><primary>Deckbl&auml;tter</primary></indexterm>

      <para>Deckbl&auml;tter (manchmal auch als
	<emphasis>Bannerseiten</emphasis> oder
	<emphasis>burst pages</emphasis> bezeichnet) geben an, wem
	die Ausgabe eines Druckauftrags geh&ouml;rt.  Sie werden
	normalerweise in gro&szlig;en fetten Buchstaben gedruckt,
	manchmal sogar mit zus&auml;tzlicher Umrandung, damit man
	sie leichter von den tats&auml;chlichen Seiten eines
	Druckauftrages unterscheiden kann.  Der Nachteil von
	Deckbl&auml;ttern ist allerdings, dass es sich dabei um
	eine zus&auml;tzliche zu druckende Seite handelt, die in
	der Regel bereits nach wenigen Minuten wieder im Papierkorb
	landet.  Da aber f&uuml;r jeden Druckauftrag nur ein einziges
	Deckblatt gedruckt wird, ist der Papierverbrauch in den
	meisten F&auml;llen tolerierbar.</para>

      <para>Das <application>LPD</application>-System kann
	Deckbl&auml;tter automatisch erzeugen, <emphasis>wenn</emphasis>
	Ihr Drucker normalen Text direkt drucken kann.  Haben Sie
	hingegen einen &postscript;-Drucker, ben&ouml;tigen Sie ein
	externes Programm, um die Deckbl&auml;tter zu generieren
	(Lesen Sie dazu auch den Abschnitt <link
	linkend="printing-advanced-header-pages-ps">Deckbl&auml;tter
	auf &postscript;-Druckern erzeugen</link>.).</para>

      <sect3 id="printing-advanced-header-pages-enabling">
	<title>Deckbl&auml;tter aktivieren</title>

	<para>Im Abschnitt <link linkend="printing-simple">Einfache
	  Drucker-Konfiguration</link> haben wir die Ausgabe von
	  Deckbl&auml;ttern durch die die Angabe der Option
	  <literal>sh</literal>
	  (<foreignphrase>suppress header</foreignphrase>) in
	  <filename>/etc/printcap</filename> deaktiviert.  Um die
	  Ausgabe von Deckbl&auml;ttern wieder zu aktivieren,
	  m&uuml;ssen Sie daher die <literal>sh</literal>-F&auml;higkeit
	  wieder entfernen.</para>

	<para>Das klingt zu einfach?  Wo ist der Haken?</para>

	<para>Sie haben recht.  Es ist <emphasis>m&ouml;glich</emphasis>,
	  dass Sie einen Ausgabefilter verwenden m&uuml;ssen, um die
	  n&ouml;tigen Initialisierungsstrings an den Drucker zu senden.
	  Das folgende Beispiel beschreibt einen Ausgabefilter f&uuml;r
	  PCL-kompatible Drucker von Hewlett Packard:</para>

	<programlisting>#!/bin/sh
#
#  hpof - Ausgabefilter f&uuml;r PCL-kompatible Drucker von Hewlett Packard
#  Installiert unter:  /usr/local/libexec/hpof

printf "\033&amp;k2G" || exit 2
exec /usr/libexec/lpr/lpf</programlisting>

	<para>Geben Sie den Pfad des Ausgabefilters &uuml;ber die
	  <literal>of</literal>-F&auml;higkeit an.  Weitere Informationen
	  finden Sie im Abschnitt <link
	  linkend="printing-advanced-of">Ausgabefilter</link>.</para>

	<para>Das n&auml;chste Beispiel beschreibt die Datei
	  <filename>/etc/printcap</filename> des bereits erw&auml;hnten
	  Druckers <literal>teak</literal>.  Allerdings sind nun die
	  Ausgabe von Deckbl&auml;ttern sowie der vorhin beschriebene
	  Ausgabefilter enthalten:</para>

	<programlisting>#
#  /etc/printcap f&uuml;r den Rechner orchid
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=<filename class="devicefile">/dev/lpt0</filename>:sd=<filename class="directory">/var/spool/lpd/teak</filename>:mx#0:\
        :if=<filename>/usr/local/libexec/hpif</filename>:\
        :vf=<filename>/usr/local/libexec/hpvf</filename>:\
        :of=<filename>/usr/local/libexec/hpof</filename>:</programlisting>

	<para>Wenn ein Anwender nun einen Druckauftrag an den Drucker
	  <literal>teak</literal> schickt, wird f&uuml;r jeden
	  Druckauftrag ein Deckblatt erstellt.  Ben&ouml;tigt ein
	  Anwender keine Deckbl&auml;tter, kann er die Ausgabe dieser
	  Seiten durch die Verwendung von <command>lpr
	  <option>-h</option></command> unterdr&uuml;cken.  Weitere, f&uuml;r
	  die Ausgabe von Deckbl&auml;ttern interessante &man.lpr.1;-Optionen
	  finden Sie im Abschnitt <link
	  linkend="printing-lpr-options-misc">Deckblattoptionen</link>.</para>

	<note>
          <para><application>LPD</application> verwendet ein
	    <foreignphrase>Form Feed</foreignphrase>, um das Deckblatt
	    abzuschlie&szlig;en.  Wenn Ihr Drucker ein anderes Zeichen
	    verwendet, um eine Seite auszuwerfen, geben Sie dieses
	    &uuml;ber die <literal>ff</literal>-F&auml;higkeit in
	    <filename>/etc/printcap</filename> an.</para>
        </note>
      </sect3>

      <sect3 id="printing-advanced-header-pages-controlling">
	<title>Deckbl&auml;tter kontrollieren</title>

	<para>Haben Sie die Ausgabe von Deckbl&auml;ttern aktiviert,
	  gibt <application>LPD</application> eine ganze Seite in
	  gro&szlig;en Buchstaben aus, die den Anwender, den
	  verwendeten Rechner sowie den Druckauftrag beschreiben.
	  Das folgende Beispiel ist ein Deckblatt f&uuml;r den
	  Druckauftrag <quote>outline</quote>, der von
	  <username>kelly</username> auf dem Rechner <hostid>rose</hostid>
	  erstellt wurde:</para>

	<screen>      k                   ll       ll
      k                    l        l
      k                    l        l
      k   k     eeee       l        l     y    y
      k  k     e    e      l        l     y    y
      k k      eeeeee      l        l     y    y
      kk k     e           l        l     y    y
      k   k    e    e      l        l     y   yy
      k    k    eeee      lll      lll     yyy y
                                               y
                                          y    y
                                           yyyy


                                   ll
                          t         l        i
                          t         l
       oooo    u    u   ttttt       l       ii     n nnn     eeee
      o    o   u    u     t         l        i     nn   n   e    e
      o    o   u    u     t         l        i     n    n   eeeeee
      o    o   u    u     t         l        i     n    n   e
      o    o   u   uu     t  t      l        i     n    n   e    e
       oooo     uuu u      tt      lll      iii    n    n    eeee









      r rrr     oooo     ssss     eeee
      rr   r   o    o   s    s   e    e
      r        o    o    ss      eeeeee
      r        o    o      ss    e
      r        o    o   s    s   e    e
      r         oooo     ssss     eeee







                                              Job:  outline
                                              Date: Sun Sep 17 11:04:58 1995</screen>

	<para><application>LPD</application> f&uuml;gt ein
	  <foreignphrase>Form Feed</foreignphrase> an diesen Text an,
	  damit der eigentliche Druckauftrag auf einer neuen Seite
	  gestartet wird (es sei denn, Sie haben die
	  <literal>sf</literal>-F&auml;higkeit (<foreignphrase>suppress
	  form feeds</foreignphrase>) des jeweiligen Druckers in
	  <filename>/etc/printcap</filename> aktiviert).</para>

	<para>Wenn Sie dies w&uuml;schen, kann
	  <application>LPD</application> auch nur ein <emphasis>kurzes
	  Deckblatt</emphasis> ausgeben.  Dazu verwenden Sie die
	  Option <literal>sb</literal>
	  (<foreignphrase>short banner</foreignphrase>)
	  in <filename>/etc/printcap</filename>.  Dadurch erhalten Sie
	  ein Deckblatt &auml;hnlich dem folgenden:</para>

	<screen>rose:kelly  Job: outline  Date: Sun Sep 17 11:07:51 1995</screen>

	<para>In der Voreinstellung druckt <application>LPD</application>
	  zuerst das Deckblatt und danach den eigentlichen Druckauftrag.
	  Um diese Reihenfolge umzukehren, geben Sie die Option
	  <literal>hl</literal> (<foreignphrase>header
	  last</foreignphrase>) in <filename>/etc/printcap</filename>
	  ans.</para>
      </sect3>

      <sect3 id="printing-advanced-header-pages-accounting">
	<title>Deckbl&auml;tter verrechnen</title>

	<para>Wenn Sie die in <application>LPD</application> eingebaute
	  Funktion zur Erstellung von Deckbl&auml;ttern verwenden,
	  werden Sie auf folgendes Paradigma sto&szlig;en:
	  Deckbl&auml;tter m&uuml;ssen <emphasis>kostenlos</emphasis>
	  sein.</para>

	<para>Warum ist das so?</para>

	<para>Weil der Ausgabefilter das einzige externe Programm ist,
	  das zum Zeitpunkt der Erstellung des Deckblatts eine
	  Verrechnung durchf&uuml;hren k&ouml;nnte.  Da Ausgabefilter
	  aber weder &uuml;ber <emphasis>Benutzer- noch &uuml;ber
	  Rechnerinformationen</emphasis> verf&uuml;gen, ist es nicht
	  m&ouml;glich, einen Druckauftrag einem bestimmten Benutzer
	  zuzuordnen.  Da ein Benutzer die Ausgabe von Deckbl&auml;ttern
	  &uuml;ber <command>lpr <option>-h</option></command>
	  unterdr&uuml;cken kann, ist es auch nicht m&ouml;glich, die Vorgabe
	  <quote>verrechne eine zus&auml;tzliche Seite</quote> in den Text-
	  oder Konvertierungsfilter (die &uuml;ber die zur Verrechnung
	  n&ouml;tigen Benutzer- und Rechnerinformationen verf&uuml;gen)
	  aufzunehmen, weil Benutzer sonst f&uuml;r Deckbl&auml;tter
	  bezahlen m&uuml;ssten, die sie nicht gedruckt haben.</para>

	<para>Es ist <emphasis>ebenfalls nicht ausreichend</emphasis>,
	  jeden Filter eigene Deckbl&auml;tter erzeugen zu lassen (und
	  sie dadurch verrechnen zu k&ouml;nnen).  Wollte ein Benutzer
	  durch ein <command>lpr <option>-h</option></command> die Ausgabe
	  eines Deckblattes unterdr&uuml;cken, w&uuml;rde dieses nun trotzdem
	  verrechnet werden, da <application>LPD</application> keine
	  Informationen &uuml;ber die Verwendung der Option
	  <option>-h</option> an einen Filter weitergibt.</para>

	<para>Welche M&ouml;glichkeiten habe ich nun?</para>

	<para>Sie k&ouml;nnen:</para>

	<itemizedlist>
	  <listitem>
	    <para>Das Paradigma von <application>LPD</application> einfach
	      akzeptieren und die Deckbl&auml;tter gratis abgeben.</para>
	  </listitem>

	  <listitem>
	    <para>Eine alternatives Drucksystem wie
	      <application>LPRng</application> installieren. Der
	      Abschnitt <link linkend="printing-lpd-alternatives">
	      Alternativen zum Standard-Drucksystem</link> beschreibt
	      verschiedene Drucksysteme, die
	      <application>LPD</application> ersetzen k&ouml;nnen.</para>
	  </listitem>

	  <listitem>
	    <para>Schreiben Sie einen <emphasis>intelligenten</emphasis>
	      Ausgabefilter.  Normalerweise k&uuml;mmert sich ein
	      Ausgabefilter nur um die Initialisierung des Druckers oder
	      um eine einfache Zeichenkonvertierung.  Au&szlig;erdem
	      eignet er sich f&uuml;r die Ausgabe von Deckbl&auml;ttern
	      und normalem Text, wenn Sie keinen Text- oder Eingabefilter
	      installiert haben.  Haben Sie allerdings einen Textfilter
	      installiert, verwendet <application>LPD</application>
	      Ausgabefilter nur f&uuml;r die Ausgabe von Deckbl&auml;ttern.
	      Ein Ausgabefilter kann den Text des von
	      <application>LPD</application> erzeugten Deckblattes
	      untersuchen, um festzustellen, welcher Benutzer und welcher
	      Rechner den Druckauftrag gestartet hat.  Leider wei&szlig;
	      der Ausgabefilter auch mit dieser Methode nicht, welche
	      Datei er zur Verrechnung verwenden soll (da der Name dieser
	      Datei durch die <literal>af</literal>-F&auml;higkeit
	      &uuml;bergeben wird).  Wenn Sie eine
	      Standard-Verrechnungsdatei verwenden, k&ouml;nnen Sie diese
	      in den Ausgabefilter einbauen.  Um den Text des Deckblattes
	      zu untersuchen, verwenden Sie die
	      <literal>sh</literal>-F&auml;higkeit
	      (<foreignphrase>short header</foreignphrase>) in
	      <filename>/etc/printcap</filename>.  Falls Ihnen das zuviel
	      Aufwand ist, freuen sich Ihre Benutzer sicher dar&uuml;ber,
	      wenn Sie ihnen den kostenlosen Druck von Deckbl&auml;ttern
	      erlauben.</para>
	  </listitem>
	</itemizedlist>
      </sect3>

      <sect3 id="printing-advanced-header-pages-ps">
	<title>Deckbl&auml;tter auf &postscript;-Druckern ausgeben</title>

	<para>In der Regel erzeugt <application>LPD</application> ein Deckblatt
	  mit normalem Text, das f&uuml;r viele verschiedene Drucker geeignet
	  ist.  Da &postscript;-Drucker normalen Text aber nicht drucken
	  k&ouml;nnen, ist die <application>LPD</application>-Funktion zur
	  Erstellung von Deckbl&auml;ttern auf diesen Drucker relativ
	  sinnlos.</para>

	<para>Es sei denn, jeder Text- und Konvertierungsfilter erzeugt
	  &uuml;ber den Benutzer- und Rechnernamen sein eigenes, f&uuml;r
	  den jeweiligen Drucker geeignetes Deckblatt.  Das Problem
	  dieser Methode ist allerdings, dass ein Anwender auch dann ein
	  Deckblatt erh&auml;lt, wenn er dies &uuml;ber
	  <command>lpr <option>-h</option></command> verhindern wollte.</para>

	<para>Das folgende Skript ben&ouml;tigt drei Argumente (den
	  Loginnamen des Benutzers, den Rechnernamen und den Namen
	  des Druckauftrages), um daraus ein einfaches
	  &postscript;-Deckblatt zu erzeugen:</para>

	<programlisting>#!/bin/sh
#
#  make-ps-header - ein PostScript-Deckblatt auf stdout ausgeben
#  Installiert unter:  /sr/local/libexec/make-ps-header
#

#
#  Die folgenden Werte sind PostScript-Einheiten (72 pro Zoll).
#  Passen Sie diese Werte f&uuml;r A4 oder die von Ihnen verwendete
#  Papiergr&ouml;&szlig;e an:
#
page_width=612
page_height=792
border=72

#
#  Argumente pr&uuml;fen
#
if [ $# -ne 3 ]; then
    echo "Usage: `basename $0` &lt;user&gt; &lt;host&gt; &lt;job&gt;" 1&gt;&amp;2
    exit 1
fi

#
#  Diese Werte in Variablen speichern, damit der PostScript-Code
#  &uuml;bersichtlicher wird.
#
user=$1
host=$2
job=$3
date=`date`

#
#  Sende den PostScript-Code an stdout.
#
exec cat &lt;&lt;EOF
%!PS

%
%  Sicherstellen, dass es keine unerw&uuml;nschten Wechselwirkungen mit
%  dem folgenden Druckauftrag gibt.
%
save

%
%  Ziehe eine fette Umrandung.
%
$border $border moveto
$page_width $border 2 mul sub 0 rlineto
0 $page_height $border 2 mul sub rlineto
currentscreen 3 -1 roll pop 100 3 1 roll setscreen
$border 2 mul $page_width sub 0 rlineto closepath
0.8 setgray 10 setlinewidth stroke 0 setgray

%
%  Zeige den Benutzernamen gro&szlig; und fett an.
%
/Helvetica-Bold findfont 64 scalefont setfont
$page_width ($user) stringwidth pop sub 2 div $page_height 200 sub moveto
($user) show

%
%  Und nun zeige noch die Einzelheiten an.
%
/Helvetica findfont 14 scalefont setfont
/y 200 def
[ (Job:) (Host:) (Date:) ] {
200 y moveto show /y y 18 sub def }
forall

/Helvetica-Bold findfont 14 scalefont setfont
/y 200 def
[ ($job) ($host) ($date) ] {
        270 y moveto show /y y 18 sub def
} forall

%
% Das wars.
%
restore
showpage
EOF     </programlisting>

	<para>Nun kann jeder Konvertierungs- oder Textfilter dieses
	  Skript aufrufen, um zuerst das Deckblatt zu erzeugen und
	  danach den Druckauftrag zu drucken.  Das n&auml;chste
	  Beispiel enth&auml;lt den bereits beschriebenen
	  DVI-Konvertierungsfilter, der hier um die Funktion zur
	  Erzeugung eines Deckblatts erweitert wurde:</para>

	<programlisting>#!/bin/sh
#
#  psdf - DVI-nach-PostScript - Druckerfilter
#  Installiert unter:  /usr/local/libexec/psdf
#
#  Wird von lpd aufgerufen, wenn der Benutzer lpr -d verwendet.
#

orig_args="$@"

fail() {
    echo "$@" 1&gt;&amp;2
    exit 2
}

while getopts "x:y:n:h:" option; do
    case $option in
        x|y)  ;; # Ignore
        n)    login=$OPTARG ;;
        h)    host=$OPTARG ;;
        *)    echo "LPD started `basename $0` wrong." 1&gt;&amp;2
              exit 2
              ;;
    esac
done

[ "$login" ] || fail "No login name"
[ "$host" ] || fail "No host name"

( /usr/local/libexec/make-ps-header $login $host "DVI File"
  /usr/local/bin/dvips -f ) | eval /usr/local/libexec/lprps $orig_args</programlisting>

	<para>Beachten Sie, dass der Filter die Liste der Argumente
	  &uuml;berpr&uuml;ft, um den Benutzer- und den Rechnernamen
	  zu ermitteln.  Dieser Vorgang ist prinzipiell f&uuml;r alle
	  Filter identisch.  Der Textfilter ben&ouml;tigt allerdings
	  etwas andere Argumente, die im Abschnitt <link
	  linkend="printing-advanced-filters">Die Funktionsweise von
	  Filtern</link> beschrieben werden.</para>

	<para>Wie bereits erw&auml;hnt, deaktiviert diese Methode
	  leider die <quote>suppress header page</quote>-Option
	  (also die Option <option>-h</option>) von
	  <command>lpr</command>.  Benutzer k&ouml;nnen danach den
	  Ausdruck eines Deckblattes nicht mehr verhindern, da der
	  angepasste Filter zu jedem Druckauftrag automatisch ein
	  Deckblatt erstellt.</para>

	<para>Damit ein Benutzer bei Bedarf den Ausdruck eines
	  Deckblatts dennoch unterbinden kann, m&uuml;ssen Sie
	  auch hier den im Abschnitt <link
	  linkend="printing-advanced-header-pages-accounting">
	  Deckbl&auml;tter verrechnen</link> beschriebenen
	  Trick einsetzen:   Schreiben Sie einen Ausgabefilter, der
	  das von LPD erzeugte Deckblatt untersucht und daraus
	  eine &postscript;-Version erzeugt.  Wenn der Benutzer
	  den Druckauftrag mit <command>lpr <option>-h</option></command>
	  verschickt, erzeugt <application>LPD</application> kein Deckblatt,
	  was in weiterer Folge auch f&uuml;r Ihren Ausgabefilter gilt.
	  Soll hingegen ein Deckblatt erzeugt werden, liest der
	  Ausgabefilter den von <application>LPD</application>
	  &uuml;bergebenen Text und erzeugt daraus ein f&uuml;r
	  Ihren &postscript;-Drucker geeignetes Deckblatt.</para>

	<para>Haben Sie Ihren &postscript;-Drucker &uuml;ber eine
	  serielle Verbindung angeschlossen, k&ouml;nnen Sie auch
	  <command>lprps</command> verwenden.  In diesem Paket ist
	  mit <command>psof</command> auch ein Ausgabefilter
	  enthalten, der die eben beschriebenen Funktionen
	  &uuml;bernehmen kann.  Beachten Sie aber, dass Sie mit
	  <command>psof</command> keine Deckbl&auml;tter verrechnen
	  k&ouml;nnen.</para>
      </sect3>
    </sect2>

    <sect2 id="printing-advanced-network-printers">
      <title>Drucken &uuml;ber ein Netzwerk</title>

      <indexterm>
        <primary>Drucker</primary>
        <secondary>Netzwerk</secondary>
      </indexterm>

      <indexterm><primary>Netzwerkdruck</primary></indexterm>

      <para>&os; unterst&uuml;tzt das Drucken &uuml;ber ein Netzwerk, also den
        Versand von Druckauftr&auml;gen an einen entfernten Drucker.  Man
        unterscheidet dabei zwei M&ouml;glichkeiten:</para>

      <itemizedlist>
	<listitem>
	  <para>Den Zugriff auf einen an einem entfernten Rechner
	    angeschlossenen Drucker.  Sie konfigurieren dabei auf Ihrem
	    System einen Drucker, der &uuml;ber eine konventionelle
	    serielle oder parallele Verbindung an einem anderen Rechner
	    angeschlossen ist.  Danach richten Sie
	    <application>LPD</application> auf dem entfernten System
	    so ein, dass andere Drucker &uuml;ber das Netzwerk auf
	    diesen Drucker zugreifen k&ouml;nnen.  Der Abschnitt
	    <link linkend="printing-advanced-network-rm">Auf entfernten
	    Rechnern installierte Drucker</link> beschreibt, wie Sie
	    dazu vorgehen m&uuml;ssen.</para>
	</listitem>

	<listitem>
	  <para>Den Zugriff auf einen direkt an ein Netzwerk
	    angeschlossenen Drucker.  Ein solcher Drucker verf&uuml;gt
	    anstelle (oder zus&auml;tzlich zu) einer parallelen oder
	    seriellen Schnittstelle &uuml;ber eine Netzwerkschnittstelle.
	    Ein solcher Drucker kann sich auf zwei Arten verhalten:</para>

	  <itemizedlist>
	    <listitem>
	      <para>Er kann das <application>LPD</application>-Protokoll
	        direkt unterst&uuml;tzen und sogar Druckjobs von entfernten
	        Rechner verwalten.  In diesem Fall verh&auml;lt sich der
	        Drucker wie ein normaler Rechner, auf dem
	        <application>LPD</application> l&auml;uft.  Lesen Sie den
	        Abschnitt <link linkend="printing-advanced-network-rm">
	        Auf entfernten Rechnern installierte Drucker</link>, um
	        einen solchen Drucker einzurichten.</para>
	    </listitem>

	    <listitem>
	      <para>Er k&ouml;nnte Verbindungen &uuml;ber ein
	        Netzwerk unterst&uuml;tzen.  In diesem Fall
	        <quote>verbinden</quote> Sie den Drucker mit einem
	        Rechner Ihres Netzwerks, der danach f&uuml;r die
	        Verwaltung von Druckauftr&auml;gen sowie den
	        tats&auml;chlichen Druck verantwortlich ist.  Der
	        Abschnitt <link
	        linkend="printing-advanced-network-net-if">Drucker mit
	        direkter TCP-Schnittstelle</link> enth&auml;lt
	        Hinweise zur Installation derartiger Drucker.</para>
	    </listitem>
	  </itemizedlist>
	</listitem>
      </itemizedlist>

      <sect3 id="printing-advanced-network-rm">
	<title>Auf entfernten Rechnern installierte Drucker</title>

	<para>Das <application>LPD</application>-Drucksystem
	  unterst&uuml;tzt den Versand von Druckauftr&auml;gen an
	  andere Rechner, auf denen entweder
	  <application>LPD</application> l&auml;uft oder die zu
	  <application>LPD</application> kompatibel sind.  Dadurch
	  k&ouml;nnen Sie einen Drucker auf einem Rechner installieren
	  und von anderen Rechnern des Netzwerks darauf zugreifen.
	  Au&szlig;erdem werden Drucker mit direkter TCP-Schnittstelle
	  unterst&uuml;tzt, wenn diese das
	  <application>LPD</application>-Protokoll
	  unterst&uuml;tzen.</para>

	<para>Um diese Art des Druckens &uuml;ber ein Netzwerk zu
	  aktivieren, installieren Sie zuerst Ihren Drucker auf einem
	  Rechner Ihres Netzwerks, dem sogenannten
	  <emphasis>printer host</emphasis>.  Die dazu n&ouml;tigen
	  Schritte werden im Abschnitt <link linkend="printing-simple">
	  Einfache Drucker-Konfiguration</link> beschrieben.  Falls
	  Sie eine erweiterte Druckerkonfiguration ben&ouml;tigen,
	  sollten Sie auch den Abschnitt <link
	  linkend="printing-advanced">Erweiterte
	  Drucker-Konfiguration</link> lesen.  Danach testen Sie, ob
	  der Drucker alle von Ihnen aktivierten
	  <application>LPD</application>-F&auml;higkeiten
	  unterst&uuml;tzt.  Stellen Sie auch sicher, dass Ihr
	  <emphasis>lokales System</emphasis> berechtigt ist, den
	  <application>LPD</application>-Dienst auf dem
	  <emphasis>entfernten System</emphasis> zu nutzen (lesen
	  Sie dazu den Abschnitt <link
	  linkend="printing-advanced-restricting-remote">
	  Druckauftr&auml;ge auf entfernten Druckern
	  beschr&auml;nken</link>).</para>

        <indexterm>
          <primary>Drucker</primary>
          <secondary>Netzwerk</secondary>
        </indexterm>

	<indexterm><primary>Netzwerkdrucker</primary></indexterm>

	<para>Wenn Sie einen Drucker mit einer zu
	  <application>LPD</application> kompatiblen
	  Netzwerkschnittstelle verwenden, handelt es sich beim
	  <emphasis>printer host</emphasis> um den Drucker selbst,
	  und der <emphasis>Druckername</emphasis> ist der von Ihnen
	  f&uuml;r diesen Drucker vorgegebene Name.  Lesen Sie die
	  Dokumentation Ihres Druckers und/oder der Netzwerkschnittstelle
	  Ihres Druckers, um dies zu kl&auml;ren.</para>

	<tip>
	  <para>Wenn Sie einen Hewlett Packard Laserjet-Drucker
	    verwenden, sorgt der Druckername <literal>text</literal>
	    f&uuml;r eine automatische LF-zu-CRLF-Konvertierung.  In
	    diesem Fall wird das <filename>hpif</filename>-Skript
	    nicht ben&ouml;tigt.</para>
	</tip>

	<para>Danach m&uuml;ssen Sie auf jedem Rechner, der auf diesen
	  Drucker zugreifen soll, einen entsprechenden Eintrag in
	  deren <filename>/etc/printcap</filename> aufnehmen.  Dazu
	  werden folgende Informationen ben&ouml;tigt:</para>

	<orderedlist>
	  <listitem>
	    <para>Der Name des Eintrags.  Entspricht in der Regel dem
	      Eintrag auf dem <emphasis>printer host</emphasis>.</para>
	  </listitem>

	  <listitem>
	    <para>Lassen Sie den Eintrag f&uuml;r die
	      <literal>lp</literal>-F&auml;higkeit leer, schreiben Sie
	      also <literal>:lp=:</literal>.</para>
	  </listitem>

	  <listitem>
	    <para>Erzeugen Sie ein Spooling-Verzeichnis und geben Sie
	      dessen Pfad &uuml;ber die
	      <literal>sd</literal>-F&auml;higkeit an.
	      <application>LPD</application> speichert Ihre
	      Druckauftr&auml;ge in diesem Verzeichnis, bevor sie an den
	      Drucker geschickt werden.</para>
	  </listitem>

	  <listitem>
	    <para>Geben Sie den Namen des <emphasis>printer
	      hosts</emphasis> &uuml;ber die
	      <literal>rm</literal>-F&auml;higkeit an.</para>
	  </listitem>

	  <listitem>
	    <para>Geben Sie den Namen des Druckers (auf dem
	      <emphasis>printer host</emphasis>) &uuml;ber die
	      <literal>rp</literal>-F&auml;higkeit an.</para>
	  </listitem>
	</orderedlist>

	<para>Das ist alles.  Sie ben&ouml;tigen weder
	  Konvertierungsfilter, noch Seitengr&ouml;&szlig;en oder
	  sonstige Angaben in Ihrer lokalen
	  <filename>/etc/printcap</filename>.</para>

	<para>Dazu ein Beispiel.  Der Rechner <hostid>rose</hostid>
	  verf&uuml;gt &uuml;ber zwei Drucker, <literal>bamboo</literal>
	  und <literal>rattan</literal>.  Wir wollen nun allen Benutzern
	  des Rechners <hostid>orchid</hostid> erlauben, diese Drucker
	  zu verwenden.  Es folgt nun wieder die bereits aus dem Abschnitt
	  <link linkend="printing-advanced-header-pages-enabling">
	  Deckbl&auml;tter verwenden</link> bekannte
	  <filename>/etc/printcap</filename> f&uuml;r den Rechner
	  <hostid>orchid</hostid>.  Diese enthielt bereits einen Eintrag
	  f&uuml;r den Drucker <literal>teak</literal>.  Zus&auml;tzlich
	  tragen wir nun die zwei Drucker des Rechners
	  <hostid>rose</hostid> ein:</para>

	<programlisting>#
#  /etc/printcap f&uuml;r den Rechner orchid - mit zus&auml;tzlichen
#  Eintr&auml;gen f&uuml;r die (entfernten) Drucker auf dem Rechner rose
#

#
#  teak ist ein lokaler Drucker und direkt mit orchid verbunden:
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=<filename class="devicefile">/dev/lpt0</filename>:sd=<filename class="directory">/var/spool/lpd/teak</filename>:mx#0:\
        :if=<filename>/usr/local/libexec/ifhp</filename>:\
        :vf=<filename>/usr/local/libexec/vfhp</filename>:\
        :of=<filename>/usr/local/libexec/ofhp</filename>:

#
#  rattan ist mit rose verbunden, Druckauftr&auml;ge f&uuml;r rattan gehen daher
#  an den Rechner rose:
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :lp=:rm=rose:rp=rattan:sd=<filename class="directory">/var/spool/lpd/rattan</filename>:

#
#  bamboo ist ebenfalls mit rose verbunden:
#
bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :lp=:rm=rose:rp=bamboo:sd=<filename class="directory">/var/spool/lpd/bamboo</filename>:</programlisting>

	<para>Nun m&uuml;ssen wir nur noch die Spooling-Verzeichnisse
	  auf dem Rechner <hostid>orchid</hostid> erzeugen:</para>

	<screen>&prompt.root; <userinput><command>mkdir <option>-p</option> <filename class="directory">/var/spool/lpd/rattan</filename> <filename class="directory">/var/spool/lpd/bamboo</filename></command></userinput>
&prompt.root; <userinput><command>chmod 770 <filename class="directory">/var/spool/lpd/rattan</filename> <filename class="directory">/var/spool/lpd/bamboo</filename></command></userinput>
&prompt.root; <userinput><command>chown daemon:daemon <filename class="directory">/var/spool/lpd/rattan</filename> <filename class="directory">/var/spool/lpd/bamboo</filename></command></userinput></screen>

	<para>Damit k&ouml;nnen Benutzer des Rechners
	  <hostid>orchid</hostid> die Drucker <literal>rattan</literal>
	  und <literal>bamboo</literal> verwenden.  Ein Benutzer gibt
	  auf <hostid>orchid</hostid> beispielsweise ein:</para>

	<screen>&prompt.user; <userinput><command>lpr <option>-P</option> bamboo <option>-d</option> <filename><replaceable>sushi-review.dvi</replaceable></filename></command></userinput></screen>

	<para>Die Anwendung <application>LPD</application> auf dem Rechner
	  <hostid>orchid</hostid> kopiert daraufhin den Druckauftrag in das
	  Spooling-Verzeichnis <filename
	  class="directory">/var/spool/lpd/bamboo</filename> und stellt fest,
	  dass es sich um einen DVI-Auftrag handelt.  Sobald
	  <hostid>rose</hostid> &uuml;ber genug freien Platz im
	  <literal>bamboo</literal>-Spooling-Verzeichnis verf&uuml;gt,
	  w&uuml;rden die beiden <application>LPD</application> die Datei auf
	  den Rechner <hostid>rose</hostid> transferieren.  Diese Datei
	  verbleibt danach in der Druckerwarteschlange des Rechners
	  <hostid>rose</hostid>, bis der Ausdruck der Datei abgeschlossen ist.
	  Vor dem Ausdruck w&uuml;rde die Datei noch von DVI nach &postscript;
	  konvertiert werden, da es sich bei <literal>bamboo</literal> um einen
	  an den Rechner <hostid>rose</hostid> angeschlossenen
	  &postscript;-Drucker handelt.</para>
      </sect3>

      <sect3 id="printing-advanced-network-net-if">
	<title>Drucker mit direkter TCP-Schnittstelle</title>

	<para>Wenn Sie eine Netzwerkkarte f&uuml;r Ihren Drucker kaufen,
	  k&ouml;nnen Sie zwei verschiedene Versionen w&auml;hlen:
	  Eine Version, die ein Drucksystem emuliert (die teure Version),
	  oder eine Version, die sich verh&auml;lt, als w&auml;re der
	  Drucker an eine serielle oder parallele Schnittstelle
	  angeschlossen (die billige Version).  Dieser Abschnitt
	  beschreibt die billige Variante.  Bevorzugen Sie die teure
	  Variante, sollten Sie den Abschnitt <link
	  linkend="printing-advanced-network-rm">Auf entfernten
	  Rechnern installierte Drucker</link> nochmals lesen.</para>

	<para>Das Format der Datei <filename>/etc/printcap</filename>
	  erlaubt es Ihnen, anzugeben, welche serielle oder parallele
	  Schnittstelle verwendet werden soll und (falls Sie eine
	  serielle Schnittstelle verwenden) welche Parameter (Baudrate,
	  Flu&szlig;kontrolle, Behandlung von Tabulatoren, Konvertierung
	  von neuen Zeilen und andere mehr) Sie verwenden wollen.  Es
	  gibt allerdings keine M&ouml;glichkeit, eine Verbindung zu
	  einem Drucker zu definieren, der einen TCP/IP- oder einem
	  anderem Netzwerkport auf Druckauftr&auml;ge hin abfragt.</para>

	<para>Um Daten an einen Netzwerkdrucker zu schicken, m&uuml;ssen
	  Sie daher ein Kommunikationsprogramm entwickeln, das von
	  Text- und Konvertierungsfiltern aufgerufen werden kann.  Dazu
	  ein Beispiel.  Das Skript <command>netprint</command>
	  &uuml;bernimmt alle Daten von der Standardeingabe und schickt
	  sie an einen Netzwerkdrucker.  <command>netprint</command>
	  erwartet zwei Argumente:  Als erstes Argument wird der Hostname
	  des Druckers und als zweites Argument der Port, &uuml;ber den
	  die Verbindung erfolgen soll, &uuml;bergeben.  Dabei handelt
	  sich allerdings um eine Ein-Wege-Kommunikation (von &os; zum
	  Drucker).  Viele Netzwerkdrucker unterst&uuml;tzen aber auch
	  eine Zwei-Wege-Kommunikation, deren Vorteile (Abfrage des
	  Druckerstatus, die Verrechnung von Druckauftr&auml;gen und
	  andere mehr) Sie vielleicht nutzen wollen.</para>

        <programlisting>#!/usr/bin/perl
#
#  netprint - Textfilter f&uuml;r einen Netzwerkdrucker
#  Installiert unter:  /usr/local/libexec/netprint
#
$#ARGV eq 1 || die "Usage: $0 &lt;printer-hostname&gt; &lt;port-number&gt;";

$printer_host = $ARGV[0];
$printer_port = $ARGV[1];

require 'sys/socket.ph';

($ignore, $ignore, $protocol) = getprotobyname('tcp');
($ignore, $ignore, $ignore, $ignore, $address)
    = gethostbyname($printer_host);

$sockaddr = pack('S n a4 x8', &amp;AF_INET, $printer_port, $address);

socket(PRINTER, &amp;PF_INET, &amp;SOCK_STREAM, $protocol)
    || die "Can't create TCP/IP stream socket: $!";
connect(PRINTER, $sockaddr) || die "Can't contact $printer_host: $!";
while (&lt;STDIN&gt;) { print PRINTER; }
exit 0; </programlisting>

	<para>Dieses Skript kann f&uuml;r verschiedene Filter
	  eingesetzt werden.  Das folgende Beispiel verwendet den
	  an ein Netzwerk angeschlossenen Zeilendrucker Diablo 750-N.
	  Dieser Drucker empf&auml;ngt zu druckende Daten auf dem
	  Port 5100.  Der Hostname des Druckers lautet
	  <hostid>scrivener</hostid>.
	  Daher sieht der Textfilter f&uuml;r diesen Drucker wie folgt
	  aus:</para>

	<programlisting>#!/bin/sh
#
#  diablo-if-net - Textfilter f&uuml;r den Diablo-Drucker `scrivener'.
#  Drucker lauscht auf Port 5100.
#  Installiert unter:  /usr/local/libexec/diablo-if-net
#
exec /usr/libexec/lpr/lpf "$@" | /usr/local/libexec/netprint scrivener 5100</programlisting>
      </sect3>
    </sect2>

    <sect2 id="printing-advanced-restricting">
      <title>Den Druckerzugriff beschr&auml;nken</title>

      <indexterm>
        <primary>Drucker</primary>
        <secondary>den Zugriff beschr&auml;nken</secondary>
      </indexterm>

      <para>Dieser Abschnitt beschreibt, wie Sie den Druckerzugriff
	beschr&auml;nken k&ouml;nnen.  Das
	<application>LPD</application>-Drucksystem erlaubt Ihnen die
	Kontrolle dar&uuml;ber, wer lokal oder &uuml;ber ein Netzwerk
	auf einen Drucker zugreifen darf, ob mehrere Kopien erstellt
	werden d&uuml;rfen und wie gro&szlig; Druckauftr&auml;ge und
	Druckerwarteschlangen werden d&uuml;rfen.</para>

      <sect3 id="printing-advanced-restricting-copies">
	<title>Den Ausdruck von mehreren Kopien verhindern</title>

	<para>Das <application>LPD</application>-System macht es dem
	  einzelnen Benutzer einfach, mehrere Kopien einer Datei zu
	  drucken.  So werden mit <command>lpr <option>-#5</option></command>
	  beispielsweise f&uuml;nf Kopien jeder Datei des Druckauftrags
	  erstellt.  Ob dies gut oder schlecht ist, m&uuml;ssen Sie
	  selbst entscheiden.</para>

	<para>Wenn Sie der Meinung sind, dass multiple Kopien eine
	  unn&ouml;tige Beanspruchung Ihres Druckers darstellen,
	  sollten Sie die <option>-#</option>-Opion von &man.lpr.1;
	  deaktivieren, indem Sie die
	  <literal>sc</literal>-F&auml;higkeit in Ihre
	  <filename>/etc/printcap</filename> aufnehmen.  Verwendet ein
	  Benutzer dennoch die Option <option>-#</option>, erh&auml;lt
	  er daraufhin folgende Meldung:</para>

	<screen>lpr: multiple copies are not allowed</screen>

	<para>Wenn Sie den Zugriff auf einen entfernten Drucker
	  (wie in Abschnitt <link
	  linkend="printing-advanced-network-rm">Auf entfernten
	  Rechnern installierte Drucker</link> beschrieben) konfiguriert
	  haben, m&uuml;ssen Sie die <literal>sc</literal>-F&auml;higkeit
	  auch auf den entfernten Rechnern, die auf Ihren Drucker
	  zugreifen d&uuml;rfen, in <filename>/etc/printcap</filename>
	  eintragen, damit Benutzer diese Vorgabe nicht durch den Wechsel
	  auf einen anderen Rechner umgehen k&ouml;nnen.</para>

	<para>Dazu ein Beispiel.  Es handelt sich dabei um die Datei
	  <filename>/etc/printcap</filename> auf dem Rechner
	  <hostid>rose</hostid>.  Der Drucker <literal>rattan</literal>
	  soll multiple Kopien zulassen, auf dem Laserdrucker
	  <literal>bamboo</literal> sollen multiple Kopien hingegen
	  nicht erlaubt sein, daher m&uuml;ssen wir f&uuml;r diesen
	  Drucker die <literal>sc</literal>-F&auml;higkeit
	  aktivieren:</para>

	<programlisting>#
#  /etc/printcap f&uuml;r den Rechner rose - multiple Kopien auf bamboo verbieten
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=<filename class="directory">/var/spool/lpd/rattan</filename>:\
        :lp=<filename class="devicefile">/dev/lpt0</filename>:\
        :if=<filename>/usr/local/libexec/if-simple</filename>:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<filename class="directory">/var/spool/lpd/bamboo</filename>:sc:\
        :lp=<filename class="devicefile">/dev/ttyu5</filename>:ms#-parenb cs8 clocal crtscts:rw:\
        :if=<filename>/usr/local/libexec/psif</filename>:\
        :df=<filename>/usr/local/libexec/psdf</filename>:</programlisting>

	<para>Au&szlig;erdem m&uuml;ssen wir noch die
	  <literal>sc</literal>-F&auml;higkeit in der Datei
          <filename>/etc/printcap</filename> des Rechners
	  <hostid>orchid</hostid> aktivieren.  Parallel dazu untersagen
	  wir das Erstellen von multiplen Kopien auf dem Drucker
	  <literal>teak</literal>:</para>

	<programlisting>#
#  /etc/printcap f&uuml;r den Rechner orchid - lokal machen wir keine multiplen Kopien
#  Lokaler Drucker teak oder entfernter Drucker bamboo:
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=<filename class="devicefile">/dev/lpt0</filename>:sd=<filename class="directory">/var/spool/lpd/teak</filename>:mx#0:sc:\
        :if=<filename>/usr/local/libexec/ifhp</filename>:\
        :vf=<filename>/usr/local/libexec/vfhp</filename>:\
        :of=<filename>/usr/local/libexec/ofhp</filename>:

rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :lp=:rm=rose:rp=rattan:sd=<filename class="directory">/var/spool/lpd/rattan</filename>:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :lp=:rm=rose:rp=bamboo:sd=<filename class="directory">/var/spool/lpd/bamboo</filename>:sc:</programlisting>

	<para>Durch die Verwendung der
	  <literal>sc</literal>-F&auml;higkeit ist zwar die Verwendung
	  von <command>lpr <option>-#</option></command> nicht mehr
	  m&ouml;glich, ein Benutzer kann aber weiterhin &man.lpr.1; mehrmals
	  hintereinander aufrufen oder eine Datei mehrfach in den gleichen
	  Druckauftrag aufnehmen:</para>

	<screen>&prompt.user; <userinput>lpr <filename><replaceable>forsale.sign forsale.sign forsale.sign forsale.sign forsale.sign</replaceable></filename></userinput></screen>

	<para>Auch dieser Mi&szlig;brauch Ihres Druckers kann verhindert
	  werden, falls Sie dies w&uuml;nschen.  Diese Ma&szlig;nahmen
	  werden in diesem Abschnitt allerdings nicht behandelt.</para>
      </sect3>

      <sect3 id="printing-advanced-restricting-access">
	<title>Den Zugriff auf bestimmte Drucker beschr&auml;nken</title>

	<para>Sie k&ouml;nnen angeben, wer auf welchem Drucker drucken
	  darf, wenn Sie den Gruppenmechanismus von &unix; in Kombination
	  mit der <literal>rg</literal>-F&auml;higkeit von
	  <filename>/etc/printcap</filename> einsetzen.  Weisen Sie dazu
	  alle Benutzer, die auf einen Drucker zugreifen d&uuml;rfen,
	  einer gemeinsamen Gruppe zu und geben Sie diese Gruppe
	  &uuml;ber die <literal>rg</literal>-F&auml;higkeit an.</para>

	<para>Wenn Benutzer, die dieser Gruppe nicht angeh&ouml;ren (dies
	  gilt auch f&uuml;r <username>root</username>), werden diese durch
	  die Meldung begr&uuml;sst, wenn Sie diesen Drucker verwenden
	  wollen.</para>

	<screen>lpr: Not a member of the restricted group</screen>

	<para>Analog zur <literal>sc</literal>-F&auml;higkeit
	  (<emphasis>suppress multiple copies</emphasis>) m&uuml;ssen
	  Sie die <literal>rg</literal>-F&auml;higkeit auch auf allen
	  entfernten Rechnern aktivieren, die auf Ihren Drucker
	  zugreifen d&uuml;rfen (lesen Sie dazu auch den Abschnitt
	  <link linkend="printing-advanced-network-rm">Auf entfernten
	  Rechnern installierte Drucker</link>).</para>

	<para>Wollen wir beispielsweise allen Benutzern die Verwendung
	  des Druckers <literal>rattan</literal>, aber nur Mitgliedern
	  der Gruppe <groupname>artists</groupname> die Verwendung des
	  Druckers <literal>bamboo</literal> erlauben, passen wir die
	  bereits bekannte <filename>/etc/printcap</filename> des
	  Rechners <hostid>rose</hostid> entsprechend an:</para>

	<programlisting>#
#  /etc/printcap des Rechners rose - Zugriffsbeschr&auml;nkung f&uuml;r bamboo
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=<filename class="directory">/var/spool/lpd/rattan</filename>:\
        :lp=<filename class="devicefile">/dev/lpt0</filename>:\
        :if=<filename>/usr/local/libexec/if-simple</filename>:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<filename class="directory">/var/spool/lpd/bamboo</filename>:sc:rg=artists:\
        :lp=<filename class="devicefile">/dev/ttyu5</filename>:ms#-parenb cs8 clocal crtscts:rw:\
        :if=<filename>/usr/local/libexec/psif</filename>:\
        :df=<filename>/usr/local/libexec/psdf</filename>:</programlisting>

	<para>Die Datei <filename>/etc/printcap</filename> des Rechners
	  <hostid>orchid</hostid> wird dadurch nicht beeinflusst.  Jeder
	  Benutzer des Rechners <hostid>orchid</hostid> kann also
	  weiterhin den Drucker <literal>bamboo</literal> verwenden.</para>

	<note>
	  <para>F&uuml;r jeden Drucker kann nur eine einzige
	    priviligierte Gruppe erstellt werden.</para>
	</note>
      </sect3>

     <sect3 id="printing-advanced-restricting-sizes">
	<title>Die Gr&ouml;&szlig;e von Druckauftr&auml;gen kontrollieren</title>

	<indexterm><primary>Druckauftr&auml;ge</primary></indexterm>

	<para>Wenn Sie viele Benutzer haben, die Ihre Drucker verwenden
	  d&uuml;rfen, werden Sie wahrscheinlich eine Obergrenze f&uuml;r
	  Dateien angeben wollen, die Benutzer an Ihren Drucker senden
	  d&uuml;rfen.  Dies ist sinnvoll, weil Speicherplatz f&uuml;r
	  Spooling-Verzeichnisse nur begrenzt verf&uuml;gbar ist und Sie stets
	  sicherstellen m&uuml;ssen, dass auch die Druckauftr&auml;ge anderer
	  Benutzer verarbeitet werden k&ouml;nnen.</para>

        <indexterm>
          <primary>Druckauftrag</primary>
          <secondary>kontrollieren</secondary>
        </indexterm>

	<para><application>LPD</application> verwendet die
	  <literal>mx</literal>-F&auml;higkeit, um die maximal erlaubte
	  Gr&ouml;&szlig;e von Dateien eines Druckauftrags anzugeben.
	  Dieser Wert wird in 1.024 Bytes gro&szlig;en
	  <literal>BUFSIZ</literal>-Bl&ouml;cken angegeben.  Setzen Sie
	  diesen Wert auf Null, gibt es keine
	  Gr&ouml;&szlig;enbeschr&auml;nkung.  Existiert die
	  <literal>mx</literal>-F&auml;higkeit hingegen &uuml;berhaupt
	  nicht, so gilt ein Limit von 1.000&nbsp;Bl&ouml;cken.</para>

	<note>
	  <para>Diese Limits gelten nur f&uuml;r die Gr&ouml;&szlig;e
	    von <emphasis>Dateien</emphasis> innerhalb eines
	    Druckauftrages, <emphasis>nicht aber</emphasis> f&uuml;r
	    die Gesamtgr&ouml;&szlig;e des Druckauftrags.</para>
	</note>

	<para><application>LPD</application> lehnt eine Datei auch dann
	  nicht ab, wenn sie das Limit des Druckers &uuml;berschreitet.
	  Vielmehr wird die Datei bis zum Erreichen des Limits in die
	  Warteschlange geladen, danach wird der Druck gestartet.  Der
	  das Limit &uuml;berschreitende Rest wird hingegen verworfen
	  und nicht gedruckt!</para>

	<para>Mit diesem Wissen k&ouml;nnen wir nun Limits f&uuml;r die
	  Drucker <literal>rattan</literal> und <literal>bamboo</literal>
	  definieren.  Da &postscript;-Dateien der Gruppe
	  <groupname>artists</groupname> in der Regel sehr gro&szlig;
	  sind, setzen wir ein Limit von f&uuml;nf Megabytes.  F&uuml;r
	  den Druck von normalen Text (auf dem Drucker
	  <literal>rattan</literal>) setzen wir hingegen kein Limit:</para>

	<programlisting>#
#  /etc/printcap f&uuml;r den Rechner rose
#

#
#  Kein Gr&ouml;&szlig;enlimit:
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:mx#0:sd=<filename class="directory">/var/spool/lpd/rattan</filename>:\
        :lp=<filename class="devicefile">/dev/lpt0</filename>:\
        :if=<filename>/usr/local/libexec/if-simple</filename>:

#
#  Ein Limit von 5 Megabyte:
#
bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<filename class="directory">/var/spool/lpd/bamboo</filename>:sc:rg=artists:mx#5000:\
        :lp=<filename class="devicefile">/dev/ttyu5</filename>:ms#-parenb cs8 clocal crtscts:rw:\
        :if=<filename>/usr/local/libexec/psif</filename>:\
        :df=<filename>/usr/local/libexec/psdf</filename>:</programlisting>

	<para>Auch diese Limits gelten nur f&uuml;r lokale Benutzer.
	  Wenn Sie den Zugriff auf Ihren Drucker auch &uuml;ber ein
	  Netzwerk erlauben wollen, unterliegen die Benutzer dieser
	  Rechner diesen Limits nicht.  Daher m&uuml;ssen Sie diese
	  Limits &uuml;ber die <literal>mx</literal>-F&auml;higkeit
	  auch in der <filename>/etc/printcap</filename> jedes
	  Rechners definieren, der Ihren Drucker verwenden darf.
	  Der Abschnitt <link linkend="printing-advanced-network-rm">
	  Auf entfernten Rechnern installierte Drucker</link>
	  enth&auml;lt weitere Informationen zum Drucken &uuml;ber
	  ein Netzwerk.</para>

	<para>Es gibt eine weitere M&ouml;glichkeit, um die
	  Gr&ouml;&szlig;e von Druckauftr&auml;gen von entfernten
	  Rechnern zu beschr&auml;nken.  Lesen Sie dazu den Abschnitt
	  <link linkend="printing-advanced-restricting-remote">
	  Druckauftr&auml;ge von entfernten Rechnern
	  beschr&auml;nken</link>.</para>
      </sect3>

      <sect3 id="printing-advanced-restricting-remote">
	<title>Druckauftr&auml;ge von entfernten Rechnern
	  beschr&auml;nken</title>

	<para>Das <application>LPD</application>-System bietet mehrere
	  M&ouml;glichkeiten, um Druckauftr&auml;ge zu beschr&auml;nken,
	  die auf entfernten Rechnern gestartet wurden:</para>

	<variablelist>
	  <varlistentry>
	    <term>Rechner beschr&auml;nken</term>

	    <listitem>
	      <para>Sie k&ouml;nnen festlegen, von welchen entfernten
	        Rechnern ein lokaler <application>LPD</application>
	        Druckauftr&auml;ge annimmt, indem Sie die Dateien
	        <filename>/etc/hosts.equiv</filename> sowie
	        <filename>/etc/hosts.lpd</filename> entsprechend
	        anpassen.  <application>LPD</application>
	        &uuml;berpr&uuml;ft diese Dateien, um festzustellen,
	        ob ein Druckauftrag von einem Rechner stammt, der in
	        einer dieser Dateien aufgef&uuml;hrt ist.  Ist dies
	        nicht der Fall, lehnt <application>LPD</application>
	        den Druckauftrag ab.</para>

	      <para>Der Aufbau dieser Datei ist sehr einfach:  Jede
	        Zeile enth&auml;lt einen einzigen Rechnernamen.
	        Beachten Sie aber, dass
	        <filename>/etc/hosts.equiv</filename> auch vom
	        &man.ruserok.3;-Protokoll ben&ouml;tigt wird und
	        &Auml;nderungen dieser Datei auch Programme wie
	        &man.rsh.1; und &man.rcp.1; beeinflussen
	        k&ouml;nnen.</para>

	      <para>Das folgende Beispiel beschreibt die Datei
	        <filename>/etc/hosts.lpd</filename> auf dem Rechner
	        <hostid>rose</hostid>:</para>

	      <programlisting>orchid
violet
madrigal.fishbaum.de</programlisting>

	      <para>Durch diese Vorgaben akzeptiert <hostid>rose</hostid>
	        nur noch Druckauftr&auml;ge von den Rechnern
	        <hostid>orchid</hostid>, <hostid>violet</hostid>,
	        und <hostid role="fqdn">madrigal.fishbaum.de</hostid>.
	        Versucht ein anderer Rechner, auf den
	        <application>LPD</application> von
	        <hostid>rose</hostid> zuzugreifen, wird dieser
	        Druckauftrag abgelehnt werden.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>Gr&ouml;&szlig;enbeschr&auml;nkungen</term>

	    <listitem>
	      <para>Sie k&ouml;nnen festlegen, wieviel Speicherplatz
	        auf dem Dateisystem, in dem das Spooling-Verzeichnis
	        liegt, mindestens frei sein muss.  Dazu erzeugen Sie im
	        Spooling-Verzeichnis Ihres lokalen Druckers die Datei
	        <filename>minfree</filename>.  In dieser Datei geben
	        Sie an, wieviele 512&nbsp;Byte gro&szlig;e
	        Bl&ouml;cke auf Ihrer Platte frei sein m&uuml;ssen,
	        damit ein Druckauftrag von einem entfernten Rechner
	        akzeptiert wird.</para>

	      <para>Durch diese Vorgabe k&ouml;nnen Sie sicherstellen,
	        dass Benutzer von entfernten Rechnern Ihr Dateisystem
	        nicht <quote>zum&uuml;llen</quote>.  Au&szlig;erdem
	        k&ouml;nnen Sie damit lokale Benutzer bevorzugen, da
	        diese auch dann noch Druckauftr&auml;ge erteilen
	        d&uuml;rfen, wenn der verf&uuml;gbare Plattenplatz
	        unter das in der Datei <filename>minfree</filename>
	        definierte Limit gefallen ist.</para>

	      <para>Legen wir nun die Datei <filename>minfree</filename>
	        f&uuml;r den Drucker <literal>bamboo</literal> an.  Zuerst
	        untersuchen wir <filename>/etc/printcap</filename>, um
	        das Spooling-Verzeichnis f&uuml;r diesen Drucker zu
	        finden.  Das folgende Beispiel zeigt den Eintrag
	        f&uuml;r den Drucker <literal>bamboo</literal>:</para>

	      <programlisting>bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<filename class="directory">/var/spool/lpd/bamboo</filename>:sc:rg=artists:mx#5000:\
        :lp=<filename class="devicefile">/dev/ttyu5</filename>:ms#-parenb cs8 clocal crtscts:rw:mx#5000:\
        :if=<filename>/usr/local/libexec/psif</filename>:\
        :df=<filename>/usr/local/libexec/psdf</filename>:</programlisting>

	      <para>Das Spooling-Verzeichnis wird &uuml;ber die
	        <literal>sd</literal>-F&auml;higkeit festgelegt.
	        Wir wollen, dass mindestens drei Megabyte
	        (also 6144&nbsp;Bl&ouml;cke) freier Plattenplatz
	        vorhanden sein m&uuml;ssen, damit
	        <application>LPD</application> einen Druckauftrag
	        von einem entfernten Rechner akzeptiert:</para>

	      <screen>&prompt.root; <userinput><command>echo 6144 &gt; <filename>/var/spool/lpd/bamboo/minfree</filename></command></userinput></screen>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>Benutzer beschr&auml;nken</term>

	    <listitem>
	      <para>Sie k&ouml;nnen auch festlegen, welche entfernten
	        Benutzer Ihren lokalen Drucker verwenden d&uuml;rfen,
	        indem Sie die <literal>rs</literal>-F&auml;higkeit in
	        <filename>/etc/printcap</filename> definieren.  Wenn
	        f&uuml;r den Eintrag eines lokalen Druckers die
	        <literal>rs</literal>-F&auml;higkeit definiert ist,
	        akzeptiert <application>LPD</application>
	        Druckauftr&auml;ge von entfernten Rechnern nur dann,
	        <emphasis>wenn</emphasis> der Benutzer, der den
	        Druckauftrag gesendet hat, auch &uuml;ber ein
	        gleichnamiges Benutzerkonto auf dem lokalen Rechner
	        verf&uuml;gt.  Ist dies nicht der Fall, lehnt
	        <application>LPD</application> den Druckauftrag ab.</para>

	      <para>Diese F&auml;higkeit ist besonders in Umgebungen
	        n&uuml;tzlich, in denen beispielsweise verschiedene
	        Abteilungen ein gemeinsames Netzwerk teilen, wobei
	        einige Benutzer zu mehreren Abteilungen geh&ouml;ren.
	        Haben diese Benutzer auch ein Benutzerkonto auf Ihrem
	        System, so k&ouml;nnen sie Ihren Drucker auch von
	        ihrer eigenen Abteilung aus nutzen.  Wollen Sie zwar
	        den Zugriff auf Ihren Drucker, <emphasis>nicht
	        aber</emphasis> den Zugriff auf Ihre &uuml;brigen
	        Ressourcen erlauben, k&ouml;nnen Sie f&uuml;r diese
	        Benutzer einen sogenannten <quote>Token-Account</quote>
	        ohne Heimatverzeichnis und mit einer nutzlosen Shell
	        wie <filename>/usr/bin/false</filename> erstellen.</para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </sect3>
    </sect2>

    <sect2 id="printing-advanced-acct">
      <title>Die Druckernutzung verrechnen</title>

      <indexterm>
        <primary>Drucker</primary>
        <secondary>verrechnen</secondary>
      </indexterm>

      <para>Sie wollen die Nutzung Ihrer Drucker kostenpflichtig machen?
	Warum auch nicht?  Papier und Tinte kosten Geld.  Auch eine
	regelm&auml;&szlig;ige Wartung muss bezahlt werden.  Nachdem Sie
	einen Preis festgelegt haben, den Sie f&uuml;r jede
	gedruckte Seite verrechnen wollen, stellt sich die Frage, wie Sie
	die Verrechnung der Druckkosten technisch umsetzen
	k&ouml;nnen.</para>

      <para>Die schlechte Nachricht ist, dass das
	<application>LPD</application>-System dabei wenig hilfreich ist.
	Die Verrechnung von Druckauftr&auml;gen h&auml;ngt stark vom
	verwendeten Drucker, den zu druckenden Dateiformaten und
	<emphasis>Ihren</emphasis> Anforderungen an die Verrechnung
	der Druckernutzung ab.</para>

      <para>Um die Verrechnung der Druckernutzung zu implementieren,
	m&uuml;ssen Sie sowohl Ihre Textfilter (um den Druck von
	normalem Text abzurechnen) als auch Ihre Konvertierungsfilter
	(um den Druck sonstiger Formate abzurechnen) entsprechend
	anpassen, damit diese die Zahl der gedruckten Seiten
	ermitteln k&ouml;nnen.  Leider k&ouml;nnen Sie dazu nicht
	einen einfachen Ausgabefilter verwenden, da diese die
	Verrechnung von Druckauftr&auml;gen nicht unterst&uuml;tzen.
	Weitere Informationen zu den verschiedenen Filterarten finden
	Sie im Abschnitt <link
	linkend="printing-advanced-filter-intro">Filter</link>.</para>

      <para>Prinzipiell gibt es zwei M&ouml;glichkeiten, wie Sie diese
	Verrechnung umsetzen k&ouml;nnen:</para>

      <itemizedlist>
	<listitem>
	  <para>Die <emphasis>periodische Verrechnung</emphasis> wird
	    h&auml;ufiger verwendet, da sie einfacher zu implementieren
	    ist.  Wenn ein Druckauftrag ausgef&uuml;hrt wird,
	    schreibt der Filter den Benutzer, den verwendeten Rechner
	    sowie die Anzahl der gedruckten Seiten in eine
	    Verrechnungsdatei.  Nach einem zu definierenden Zeitraum
	    werden diese Dateien ausgewertet, die Gesamtzahl der
	    von einem Benutzer gedruckten Seiten bestimmt und dem
	    jeweiligen Benutzer verrechnet.  Danach werden alle
	    Protokolldateien zur&uuml;ckgesetzt, und die Protokollierung
	    beginnt von Neuem.</para>
	</listitem>

	<listitem>
	  <para>Die <emphasis>unmittelbare Verrechnung</emphasis> wird
	    nur selten eingesetzt, das sie schwieriger zu implementieren
	    ist.  Bei dieser Methode wird der Druckauftrag verrechnet,
	    sobald der Drucker verwendet wird.  Dadurch k&ouml;nnen Sie
	    beispielsweise verhindern, dass ein Benutzer seine erlaubte
	    <quote>Druckquote</quote> &uuml;berschreitet.
	    Zus&auml;tzlich k&ouml;nnen Sie es Ihren Benutzern erlauben,
	    deren Druckquote abzufragen oder anzupassen.  Allerdings
	    ben&ouml;tigen Sie eine Datenbank, um Benutzer und deren
	    Quoten verwalten zu k&ouml;nnen.</para>
	</listitem>
      </itemizedlist>

      <para>Das <application>LPD</application>-Drucksystem
	unterst&uuml;tzt beide Methoden.  Allerdings m&uuml;ssen Sie
	die ben&ouml;tigen Filter sowie den zur Verrechnung n&ouml;tigen
	Code selbst bereitstellen.  Der Vorteil dabei ist allerdings,
	dass Sie in der Wahl Ihrer Verrechnungsmethode &auml;u&szlig;erst
	flexibel sind.  So k&ouml;nnen Sie sich etwa f&uuml;r die
	periodische oder die unmittelbare Verrechnung entscheiden.  Sie
	k&ouml;nnen festlegen, welche Informationen Sie erfassen wollen:
	Benutzernamen, Rechnernamen, die Art der Druckauftr&auml;ge,
	die Anzahl der gedruckten Seiten, den Papierverbrauch, den
	Zeitaufwand f&uuml;r die Bearbeitung eines Druckauftrages und
	viele andere mehr.  Dazu m&uuml;ssen Sie Ihre Filter entsprechend
	anpassen, damit diese Informationen erfassst und gespeichert
	werden.</para>

      <sect3>
	<title>Kurzanleitung f&uuml;r die Implementierung der
	  Druckerverrechnung</title>

	<para>&os; bietet Ihnen zwei Programme, um eine periodische
	  Verrechnung rasch zu implementieren.  Dabei handelt es sich
	  um den im Abschnitt <link
	  linkend="printing-advanced-lpf">lpf:  Ein Textfilter</link>
	  behandelten Textfilter sowie um &man.pac.8;, ein Programm,
	  mit dem Sie Eintr&auml;ge aus Verrechnungsdateien auslesen
	  und aufsummieren k&ouml;nnen.</para>

	<para>Wie bereits im Abschnitt <link
	  linkend="printing-advanced-filters">Filter</link> erw&auml;hnt,
	  startet <application>LPD</application> den Text- oder
	  Konvertierungsfilter mit dem Namen der Verrechnungsdatei als
	  Argument.  Dadurch wei&szlig; der Filter, in welche Datei
	  er einen Verrechnungseintrag schreiben soll.  Der Name dieser
	  Datei wird &uuml;ber die <literal>af</literal>-F&auml;higkeit
	  in <filename>/etc/printcap</filename> festgelegt.  Falls die
	  Datei nicht &uuml;ber einen absoluten Pfad angegeben wird,
	  handelt es sich um einen Pfad relativ zum
	  Spooling-Verzeichnis.</para>

	<para><application>LPD</application> startet
	  <command>lpf</command> mit den Argumenten <emphasis>page width
	  und page length</emphasis>, die &uuml;ber die
	  <literal>pw</literal>- und <literal>pl</literal>-F&auml;higkeit
	  definiert werden.  Das Kommando <command>lpf</command> verwendet
	  diese Argumente danach, um den Papierverbrauch zu bestimmen.  Nachdem
	  die Datei an den Drucker geschickt wurde, wird ein
	  Verrechnungseintrag in die Verrechnungsdatei geschrieben.  Ein
	  solcher Eintrag sieht dabei &auml;hnlich den folgenden aus:</para>

	<programlisting>2.00 rose:andy
3.00 rose:kelly
3.00 orchid:mary
5.00 orchid:mary
2.00 orchid:zhang</programlisting>

	<para>Sie sollten f&uuml;r jeden Drucker eine eigene
	  Verrechnungsdatei verwenden, da <command>lpf</command>
	  die Verrechnungsdatei nicht sperren kann.  Sind also
	  gleichzeitig zwei <command>lpf</command>-Instanzen aktiv,
	  kann es dazu kommen, dass Ihre Verrechnungsdatei zerst&ouml;rt
	  wird, wenn beide Instanzen gleichzeitig in die gleiche Datei
	  schreiben.  Damit f&uuml;r jeden Drucker eine eigene
	  Verrechnungsdatei angelegt wird, f&uuml;gen Sie den
	  Eintrag <literal>af=acct</literal> in
	  <filename>/etc/printcap</filename> ein.  Dadurch wird f&uuml;r
	  jeden Drucker eine separate Verrechnungsdatei mit dem Namen
	  <filename>acct</filename> im Spooling-Verzeichnis des
	  jeweiligen Druckers erzeugt.</para>

	<para>Wenn Sie Ihre Daten erfasst haben und die entstandenen
	  Kosten Ihren Benutzern verrechnen wollen, starten Sie
	  &man.pac.8;.  Dazu wechseln Sie in das Spooling-Verzeichnis
	  des auszuwertenden Druckers und geben <command>pac</command>
	  ein.  Dadurch erhalten Sie eine Ausgabe &auml;hnlich
	  der folgenden:</para>

	<screen>  Login               pages/feet   runs    price
orchid:kelly                5.00    1   $  0.10
orchid:mary                31.00    3   $  0.62
orchid:zhang                9.00    1   $  0.18
rose:andy                   2.00    1   $  0.04
rose:kelly                177.00  104   $  3.54
rose:mary                  87.00   32   $  1.74
rose:root                  26.00   12   $  0.52

total                     337.00  154   $  6.74</screen>

	<para>Folgende Argumente k&ouml;nnen an &man.pac.8;
	  &uuml;bergeben werden:</para>

	<variablelist>
	  <varlistentry>
	    <term><option>-P<replaceable>Drucker</replaceable></option></term>

	    <listitem>
	      <para>Gibt an, welcher <replaceable>Drucker</replaceable>
	        ausgewertet werden soll.  Diese Option setzt voraus,
	        dass f&uuml;r die <literal>af</literal>-F&auml;higkeit
	        in <filename>/etc/printcap</filename> ein absoluter
	        Pfad angegeben wurde.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-c</option></term>

	    <listitem>
	      <para>Sortiert die Ausgabe nach den verursachten Kosten
	        anstelle einer alphabetischen Sortierung der
	        Benutzernamen.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-m</option></term>

	    <listitem>
	      <para>Ignoriert den Rechnernamen in Verrechnungsdateien.
	        Ist diese Option gesetzt, ist der Benutzer
	        <username>smith</username> auf dem Rechner
	        <hostid>alpha</hostid> mit dem Benutzer
	        <username>smith</username> auf dem Rechner
	        <hostid>gamma</hostid> identisch.  Ist diese Option
	        nicht gesetzt, handelt es sich um unterschiedliche
	        Benutzer.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-p<replaceable>Preis</replaceable></option></term>

	    <listitem>
	      <para>Berechnet die entstandenen Kosten aus dem
	        <replaceable>Preis</replaceable> in Dollar pro Seite
	        statt aus dem &uuml;ber die
	        <literal>pc</literal>-F&auml;higkeit in
	        <filename>/etc/printcap</filename> definierten Preis.
	        In der Voreinstellung sind dies zwei Cent pro Seite.
	        Sie k&ouml;nnen aber auch einen eigenen
	        <replaceable>Preis</replaceable> in Form einer
	        Gleitkommazahl angeben.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-r</option></term>

	    <listitem>
	      <para>Die Sortierreihenfolge umkehren.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-s</option></term>

	    <listitem>
	      <para>Die Verrechnungsdatei in einer neuen Datei
	        aufsummieren und die originale Verrechnungsdatei
	        zur&uuml;cksetzen.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><replaceable>name</replaceable>
	      <replaceable>&hellip;</replaceable></term>

	    <listitem>
	      <para>Verrechnungsinformationen nur f&uuml;r die
	        angegebenen Benutzernamen ausgeben.</para>
	    </listitem>
	  </varlistentry>
	</variablelist>

	<para>In der Voreinstellung gibt &man.pac.8; aus, wieviele
	  Seiten von welchem Benutzer auf welchem Rechner gedruckt
	  wurden.  Wenn Rechnernamen f&uuml;r Sie uninteressant sind
	  (weil sich Benutzer beispielsweise auf jedem Rechner
	  anmelden k&ouml;nnen), sollten Sie <command>pac
	  <option>-m</option></command> verwenden, um die folgende Ausgabe zu
	  erhalten:</para>

	<screen>  Login               pages/feet   runs    price
andy                        2.00    1   $  0.04
kelly                     182.00  105   $  3.64
mary                      118.00   35   $  2.36
root                       26.00   12   $  0.52
zhang                       9.00    1   $  0.18

total                     337.00  154   $  6.74</screen>


	<para>Um den zu verrechnenden Betrag zu ermitteln, verwendet
	  &man.pac.8; die <literal>pc</literal>-F&auml;higkeit von
	  <filename>/etc/printcap</filename> (Voreinstellung 200, dieser
	  Wert entspricht 2 Cents).  Geben Sie hier (als Hundertfaches
	  des tats&auml;chlichen Wertes) den Preis pro Seite an, den
	  Sie verrechnen wollen. Sie k&ouml;nnen diesen Wert
	  &uuml;berschreiben, wenn Sie &man.pac.8; mit der Option
	  <option>-p</option> ausf&uuml;hren.  Beachten Sie dabei aber,
	  dass Sie in diesem Fall die Einheiten in Dollar angeben, und
	  nicht als Hundertfaches des tats&auml;chlichen Cent-Betrages.
	  So steht</para>

	  <screen>&prompt.root; <userinput><command>pac <option>-p1.50</option></command></userinput></screen>

	  <para>beispielsweise f&uuml;r einen Preis von einem Dollar und
	  f&uuml;nfzig Cent pro Seite.</para>

	<para>Der Aufruf von <command>pac <option>-s</option></command>
          f&uuml;hrt schlie&szlig;lich dazu, dass die aufsummierten
          Informationen in einer eigenen Auswertedatei gespeichert werden.
          Diese hat den gleichen Namen wie die Verrechnungsdatei, es wird
	  lediglich ein <literal>_sum</literal> an den Dateinamen
	  angeh&auml;ngt.   Danach wird die Verrechnungsdatei
	  zur&uuml;ckgesetzt.  Wenn Sie &man.pac.8; erneut aufrufen,
	  wird die Auswertedatei eingelesen, um die Startbetr&auml;ge
	  zu erhalten, alle weiteren Informationen stammen danach
	  aus der normalen Verrechnungsdatei.</para>
      </sect3>

      <sect3>
	<title>Wie kann man die Anzahl der gedruckten Seiten
	  ermitteln?</title>

	<para>Um die Druckernutzung auch nur ann&auml;hernd genau
	  verrechnen zu k&ouml;nnen, m&uuml;ssen Sie ermitteln, wieviel
	  Papier ein Druckauftrag verbraucht.  Die Bestimmung dieses
	  Wertes ist das zentrale Problem, das Sie l&ouml;sen m&uuml;ssen,
	  wenn Sie Druckauftr&auml;ge kostenpflichtig machen wollen.</para>

	<para>Normaler Text stellt in der Regel kein Problem dar:  Sie
	  z&auml;hlen dazu nur die Zeilen des Druckauftrages und
	  dividieren diesen Wert durch die Anzahl der Zeilen pro Seite,
	  die Ihr Drucker bietet.  Allerdings d&uuml;rfen Sie dabei
	  nicht vergessen, dass gel&ouml;schte Zeichen
	  (<foreignphrase>Backspaces</foreignphrase>) Zeilen
	  &uuml;berschreiben.  Au&szlig;erdem k&ouml;nnen sich lange
	  logische Zeilen (im Druckauftrag) &uuml;ber mehrere
	  physikalische Zeilen (am Ausdruck) erstrecken.</para>

	<para>Der im Abschnitt <link linkend="printing-advanced-lpf">lpf:
	  Ein Textfilter</link> vorgestellte Textfilter
	  <command>lpf</command> ber&uuml;cksichtigt diese
	  Besonderheiten. Wenn Sie einen eigenen Textfilter f&uuml;r
	  die Verrechnung der Druckernutzung schreiben wollen, sollten
	  Sie sich daher den Quellcode von <command>lpf</command>
	  n&auml;her ansehen.</para>

	<para>Aber was ist mit anderen Dateiformaten?</para>

	<para>F&uuml;r die DVI-nach-LaserJet- oder f&uuml;r die
	  DVI-nach-&postscript;-Konvertierung k&ouml;nnen Sie die
	  Protokolldateien von <command>dvilj</command> oder
	  <command>dvips</command> auslesen, um festzustellen, wieviele
	  Seiten konvertiert wurden.  Die gleiche Methode k&ouml;nnte
	  auch mit anderen Dateitypen funktionieren.</para>

	<para>Alle diese Methoden haben aber das Problem, dass ein
	  Drucker m&ouml;glicherweise nicht alle Seiten des
	  Druckauftrages drucken kann.  So k&ouml;nnte es etwa zu einem
	  Papierstau kommen, der Toner k&ouml;nnte zu Ende gehen oder
	  es k&ouml;nnte ein Druckerdefekt
	  auftreten&nbsp;&ndash;&nbsp;trotzdem w&uuml;rden alle Seiten
	  des Druckauftrages verrechnet werden.</para>

	<para>Was kann man dagegen tun?</para>

	<para>Es gibt nur eine einzige <emphasis>sichere</emphasis>
	  Methode, um die Druckernutzung <emphasis>exakt</emphasis>
	  zu bestimmen.  Besorgen Sie sich einen Drucker, der das
	  verbrauchte Papier protokolliert und verbinden Sie ihn
	  &uuml;ber eine serielle oder eine Netzwerkverbindung.
	  Nahezu alle &postscript;-Drucker, aber auch viele andere
	  Modelle und Druckertypen (beispielsweise Laserdrucker von
	  Imagen) sind dazu in der Lage.  Passen Sie die Filter
	  f&uuml;r diese Drucker entsprechend an, damit diese
	  nach jedem Druckauftrag die Anzahl der gedruckten Seiten
	  ermitteln und verrechnen Sie Druckauftr&auml;ge
	  <emphasis>ausschlie&szlig;lich</emphasis> &uuml;ber diesen
	  Wert.  Danach m&uuml;ssen Sie sich um die Anzahl
	  der gedruckten Zeilen oder um m&ouml;gliche Druckerprobleme
	  nie mehr k&uuml;mmern.</para>

        <para>Sie k&ouml;nnen aber auch gro&szlig;z&uuml;gig sein und alle
          Ausdrucke kostenlos abgeben.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 id="printing-using">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Johann</firstname>
	  <surname>Kois</surname>
	  <contrib>&Uuml;bersetzt von </contrib>
	</author>
      </authorgroup>
    </sect1info>

    <title>Drucker verwenden</title>

    <indexterm>
      <primary>Drucker</primary>
      <secondary>verwenden</secondary>
   </indexterm>

    <para>Dieser Abschnitt beschreibt, wie Sie einen unter &os;
      konfigurierten Drucker verwenden k&ouml;nnen.  Die folgende
      Liste bietet einen &Uuml;berblick &uuml;ber wichtige
      Anwenderbefehle:</para>

    <variablelist>
      <varlistentry>
	<term>&man.lpr.1;</term>

	<listitem>
	  <para>Einen Druckauftrag drucken</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>&man.lpq.1;</term>

	<listitem>
	  <para>Eine Druckerwarteschlange pr&uuml;fen</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>&man.lprm.1;</term>

	<listitem>
	  <para>Einen Druckauftrag aus einer Warteschlange entfernen
	    (stornieren)</para>
	</listitem>
      </varlistentry>
    </variablelist>

    <para>Zus&auml;tzlich existiert mit &man.lpc.8; ein Befehl zur
      zur Steuerung von Druckern und Druckerwarteschlangen, der im
      Abschnitt <link linkend="printing-lpc">Drucker verwalten</link>
      n&auml;her beschrieben wird.</para>

    <para>Jeder der drei Befehle &man.lpr.1;, &man.lprm.1;, sowie
      &man.lpq.1; akzeptiert die Option
      <option>-P <replaceable>printer-name</replaceable></option>,
      mit der Sie den zu verwendenden Drucker (der dazu in
      <filename>/etc/printcap</filename> definiert sein muss)
      festlegen.   Dadurch sind Sie in der Lage, Druckauftr&auml;ge
      zu erstellen, zu stornieren, oder den Status Ihrer
      Druckauftr&auml;ge zu &uuml;berpr&uuml;fen.  Verwenden Sie die
      Option <option>-P</option> nicht, wird der in der Umgebungsvariable
      <envar>PRINTER</envar> definierte Drucker verwendet.  Existiert
      diese Variable nicht, greifen diese Befehle auf den Drucker
      <literal>lp</literal> zur&uuml;ck.</para>

    <para>Im Folgenden steht der Begriff
      <emphasis>Standarddrucker</emphasis> daher
      f&uuml;r den &uuml;ber die Umgebungsvariable <envar>PRINTER</envar>
      definierten Drucker, oder, falls diese Variable nicht existiert,
      f&uuml;r den Drucker <literal>lp</literal>.</para>

    <sect2 id="printing-lpr">
      <title>Druckauftr&auml;ge erstellen</title>

      <para>Um eine Datei zu drucken, geben Sie folgenden Befehl ein:</para>

      <screen>&prompt.user; <userinput><command>lpr <filename><replaceable>filename</replaceable></filename> <replaceable>...</replaceable></command></userinput></screen>

      <indexterm><primary>printing</primary></indexterm>

      <para>Dadurch wird jede angegebene Datei an den Standarddrucker
	geschickt.  Wenn Sie keine Datei angeben, liest &man.lpr.1;
	die zu druckenden Daten von der Standardeingabe.  Um
	beispielsweise einige wichtige Systemdateien zu drucken, geben
	Sie folgenden Befehl ein:</para>

      <screen>&prompt.user; <userinput><command>lpr <filename>/etc/host.conf</filename> <filename>/etc/hosts.equiv</filename></command></userinput></screen>

      <para>Um einen bestimmten Drucker auszuw&auml;hlen, verwenden Sie:</para>

      <screen>&prompt.user; <userinput><command>lpr <option>-P</option> <replaceable>printer-name</replaceable> <filename><replaceable>filename</replaceable></filename> <replaceable>...</replaceable></command></userinput></screen>

      <para>Das folgende Beispiel gibt eine ausf&uuml;hrliche Liste aller
	im Arbeitsverzeichnis enthaltenen Dateien auf den Drucker
	<literal>rattan</literal> aus:</para>

      <screen>&prompt.user; <userinput><command>ls <option>-l</option> | lpr <option>-P</option> rattan</command></userinput></screen>

      <para>Da keine Dateien an &man.lpr.1; &uuml;bergeben werden, liest
	<command>lpr</command> die zu druckenden Daten von der
	Standardeingabe, in unserem Fall also die Ausgabe des Befehls
	<command>ls <option>-l</option></command>.</para>

      <para>&man.lpr.1; akzeptiert auch verschiedene Optionen zur
	Formatierung und Konvertierung von Dateien, zur Erzeugung von
	multiplen Ausdrucken und so weiter.  Lesen Sie dazu den
	Abschnitt <link
	linkend="printing-lpr-options">Druckoptionen</link>.</para>
    </sect2>

    <sect2 id="printing-lpq">
      <title>Druckauftr&auml;ge verwalten</title>

      <indexterm><primary>Druckauftrag</primary></indexterm>

      <para>Wenn Sie &man.lpr.1; verwenden, werden alle zu druckenden
	Daten in ein Paket, den sogenannten <quote>Druckauftrag</quote>,
	gepackt und an <application>LPD</application> geschickt.  Jeder
	Drucker verf&uuml;gt &uuml;ber eine Druckerwarteschlange, in der Ihre
	Druckauftr&auml;ge gemeinsam mit denen anderer Benutzer verbleiben, bis
	sie gedruckt werden k&ouml;nnen.  Zuerst eintreffende
	Druckauftr&auml;ge werden dabei auch zuerst gedruckt.</para>

      <para>Um die Druckerwarteschlange des Standarddruckers anzuzeigen,
	verwenden Sie &man.lpq.1;.  Wollen Sie einen anderen Drucker
	abfragen, m&uuml;ssen Sie die Option <option>-P</option>
	verwenden.  Der Befehl

	<screen>&prompt.user; <userinput><command>lpq <option>-P</option> bamboo</command></userinput></screen>

	zeigt so die Druckerwarteschlange des Druckers
	<literal>bamboo</literal> an.  Dieser Befehl liefert eine
	Ausgabe &auml;hnlich der folgenden:</para>

      <screen>bamboo is ready and printing
Rank   Owner    Job  Files                              Total Size
active kelly    9    /etc/host.conf, /etc/hosts.equiv   88 bytes
2nd    kelly    10   (standard input)                   1635 bytes
3rd    mary     11   ...                                78519 bytes</screen>

      <para>Derzeit enth&auml;lt die Warteschlange von
	<literal>bamboo</literal> drei Druckauftr&auml;ge.  Dem ersten
	Auftrag, der vom Benutzer kelly erstellt wurde, wurde die
	<quote>Auftragsnummer (job number)</quote> 9 zugewiesen.
	Analog erh&auml;lt jeder Druckerauftrag eine eindeutige Nummer
	zugewiesen.  Diese Nummern sind nur dann von Bedeutung, wenn
	Sie einen Druckauftrag stornieren wollen.  Der Abschnitt
	<link linkend="printing-lprm">Druckauftr&auml;ge
	stornieren</link> beschreibt, wie Sie dazu vorgehen.</para>

      <para>Der Auftrag mit der Nummer 9 besteht aus zwei Dateien,
	mehrere an &man.lpr.1; &uuml;bergebene Dateien werden also als
	Teil eines (gemeinsamen) Druckauftrags betrachtet.  Dieser
	Druckauftrag ist derzeit aktiv (beachten Sie den Status
	<literal>active</literal> in der Spalte <quote>Rank</quote>),
	wird also gerade gedruckt.  Der zweite Auftrag besteht aus
	Daten, die von der Standardeingabe an &man.lpr.1;
	&uuml;bergeben wurden.  Der dritte Auftrag wurde vom Benutzer
	<username>mary</username> erstellt.  Er ist sehr viel
	gr&ouml;&szlig;er als die anderen Auftr&auml;ge.  Da der
	Pfad der zu druckenden Datei aufgrund seiner L&auml;nge nicht
	in der Spalte <quote>Files</quote> Platz hat, werden von
	&man.lpq.1; nur drei Punkte angezeigt.</para>

      <para>Die erste Zeile der Ausgabe von &man.lpq.1; ist ebenfalls
	sehr n&uuml;tzlich:  Sie beschreibt den momentanen Druckerstatus
	(oder zumindest, was <application>LPD</application> denkt,
	dass der Drucker gerade macht).</para>

      <para>&man.lpq.1; unterst&uuml;tzt auch die Option
	<option>-l</option> zur Erstellung einer ausf&uuml;hrlicheren
	Ausgabe.  Die Eingabe von <command>lpq <option>-l</option></command>
	erzeugt f&uuml;r unser obiges Beispiel die folgende Ausgabe:</para>

      <screen>waiting for bamboo to become ready (offline ?)
kelly: 1st				 [job 009rose]
       /etc/host.conf                    73 bytes
       /etc/hosts.equiv                  15 bytes

kelly: 2nd				 [job 010rose]
       (standard input)                  1635 bytes

mary: 3rd                                [job 011rose]
      /home/orchid/mary/research/venus/alpha-regio/mapping 78519 bytes</screen>
    </sect2>

    <sect2 id="printing-lprm">
      <title>Druckauftr&auml;ge stornieren</title>

      <para>Mit &man.lprm.1; k&ouml;nnen Sie einen Druckauftrag
	stornieren.  H&auml;ufig ist &man.lprm.1; auch noch in der
	Lage, einen bereits aktiven Auftrag abzubrechen, allerdings
	wird dabei in der Regel trotzdem ein Teil des Auftrages oder
	der gesamte Auftrag gedruckt.</para>

      <para>Um einen Druckauftrag auf dem Standarddrucker zu
	stornieren, m&uuml;ssen Sie zuerst die Auftragsnummer
	&uuml;ber &man.lpq.1; ermitteln.  Danach geben Sie
	Folgendes ein:</para>

      <screen>&prompt.user; <userinput><command>lprm <replaceable>Job-Nummer</replaceable></command></userinput></screen>

      <para>Um einen Druckauftrag eines anderen Druckers zu stornieren,
	ben&ouml;tigen Sie wiederum die Option <option>-P</option>.  Der
	folgende Befehl entfernt den Druckauftrag mit der Nummer 10
	aus der Warteschlange des Druckers
	<literal>bamboo</literal>:</para>

      <screen>&prompt.user; <userinput><command>lprm <option>-P</option> bamboo 10</command></userinput></screen>

      <para>&man.lprm.1; unterst&uuml;tzt verschiedene Kurzbefehle:</para>

      <variablelist>
	<varlistentry>
	  <term>lprm -</term>

	  <listitem>
	    <para>Entfernt alle Druckauftr&auml;ge (des Standarddruckers),
	      die von Ihnen erstellt wurden.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>lprm <replaceable>user</replaceable></term>

	  <listitem>
	    <para>Entfernt alle Druckauftr&auml;ge (des Standarddruckers),
	      die vom Benutzer <replaceable>user</replaceable> erstellt
	      wurden.  Der Superuser kann im Gegensatz zu einem normalen
	      Benutzer auch Auftr&auml;ge anderer Benutzer entfernen.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term>lprm</term>

	  <listitem>
	    <para>Wenn Sie weder eine Auftragsnummer, einen Benutzernamen,
	      noch die Option <option>-</option> angeben, entfernt
	      &man.lprm.1; den aktiven Druckauftrag auf dem
	      Standarddrucker, falls dieser Auftrag von Ihnen erstellt
	      wurde.  Der Superuser kann hingegen jeden aktiven
	      Druckauftrag abbrechen.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>Verwenden Sie zus&auml;tzlich die Option <option>-P</option>
	zu den eben beschriebenen Kurzbefehlen, wenn Sie diese auf einen
	anderen Drucker als den Standarddrucker anwenden wollen.  So
	entfernt der folgende Befehl beispielsweise alle
	Druckauftr&auml;ge des aktuellen Benutzers aus der
	Druckerwarteschlange des Druckers
	<literal>rattan</literal>:</para>

      <screen>&prompt.user; <userinput><command>lprm <option>-P</option> rattan -</command></userinput></screen>

      <note>
	<para>Wenn Sie in einer Netzwerkumgebung arbeiten, erlaubt es
	  &man.lprm.1; Ihnen nur, Druckauftr&auml;ge auf dem Rechner
	  zu stornieren, auf dem sie erstellt wurden.  Dies gilt selbst
	  dann, wenn der gleiche Drucker auch auf anderen Rechnern des
	  Netzwerks verf&uuml;gbar ist.  Die folgende Befehlsfolge
	  veranschaulicht diesen Umstand:</para>

	<screen>&prompt.user; <userinput><command>lpr <option>-P</option> rattan <filename><replaceable>myfile</replaceable></filename></command></userinput>
&prompt.user; <userinput><command>rlogin orchid</command></userinput>
&prompt.user; <userinput><command>lpq <option>-P</option> rattan</command></userinput>
Rank   Owner	  Job  Files                          Total Size
active seeyan	  12	...                           49123 bytes
2nd    kelly      13   myfile                         12 bytes
&prompt.user; <userinput><command>lprm <option>-P</option> rattan 13</command></userinput>
rose: Permission denied
&prompt.user; <userinput><command>logout</command></userinput>
&prompt.user; <userinput><command>lprm <option>-P</option> rattan 13</command></userinput>
dfA013rose dequeued
cfA013rose dequeued
	</screen>
      </note>
    </sect2>

    <sect2 id="printing-lpr-options">
      <title>Abseits von normalem Text:  Druckoptionen</title>

      <para>&man.lpr.1; unterst&uuml;tzt verschiedene Optionen zur
	Formatierung von Text, zur Konvertierung von Grafik- und
	anderen Dateiformaten, zur Erzeugung von multiplen Kopien,
	zur Verwaltung von Druckauftr&auml;gen und andere mehr.
	Dieser Abschnitt beschreibt einige dieser Optionen.</para>

      <sect3 id="printing-lpr-options-format">
	<title>Formatierungs- und Konvertierungsoptionen</title>

	<para>Die folgenden &man.lpr.1;-Optionen kontrollieren die
	  Formatierung von in einem Druckauftrag enthaltenen Dateien.
	  Verwenden Sie diese Optionen, wenn Ihr Druckauftrag keinen
	  normalen Text enth&auml;lt, oder wenn Sie normalen Text
	  mit &man.pr.1; formatieren wollen.</para>

        <indexterm><primary>&tex;</primary></indexterm>

	<para>Der folgende Befehl druckt so beispielsweise eine
	  DVI-Datei (des &tex;-Satzsystems) namens
	  <filename><replaceable>fish-report.dvi</replaceable></filename> auf
	  dem Drucker <literal>bamboo</literal>:</para>

	<screen>&prompt.user; <userinput><command>lpr <option>-P</option> bamboo -d <filename><replaceable>fish-report.dvi</replaceable></filename></command></userinput></screen>

	<para>Diese Optionen gelten f&uuml;r jede Datei des
	  Druckauftrags, daher ist es nicht m&ouml;glich beispielsweise
	  DVI- und ditroff-Dateien &uuml;ber den gleichen Druckauftrag
	  zu drucken.  Sie m&uuml;ssen diese Dateien vielmehr &uuml;ber
	  getrennte Druckauftr&auml;ge drucken, wobei Sie jeweils
	  geeignete Konvertierungsoptionen verwenden.</para>

	<note>
	  <para>Alle Optionen mit Ausnahme von <option>-p</option> und
	    <option>-T</option> setzen einen installierten und
	    f&uuml;r den jeweiligen Drucker konfigurierten
	    Konvertierungsfilter voraus.  So ben&ouml;tigt die Option
	    <option>-d</option> den DVI-Konvertierungsfilter.  Diese
	    Filter werden im Abschnitt <link
	    linkend="printing-advanced-convfilters">
	    Konvertierungsfilter</link> ausf&uuml;hrlich
	    beschrieben.</para>
	</note>

	<variablelist>
	  <varlistentry>
	    <term><option>-c</option></term>

	    <listitem>
	      <para>Druckt cifplot-Dateien.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-d</option></term>

	    <listitem>
	      <para>Druckt DVI-Dateien.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-f</option></term>

	    <listitem>
	      <para>Druckt FORTRAN-Textdateien.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-g</option></term>

	    <listitem>
	      <para>Druckt Plot-Daten.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-i <replaceable>anzahl</replaceable></option></term>

	    <listitem>
	      <para>R&uuml;ckt die Ausgabe um
	        <replaceable>anzahl</replaceable> Spalten ein, lassen
	        Sie  <replaceable>anzahl</replaceable> weg, wird der Text
	        um 8 Spalten einger&uuml;ckt.  Beachten Sie aber, dass
	        diese Option nicht mit allen Konvertierungsfiltern
	        funktioniert.</para>

	      <note>
	        <para>Zwischen der Option <option>-i</option> und der
	          der Zahl darf dabei kein Leerzeichen stehen.</para>
	      </note>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-l</option></term>

	    <listitem>
	      <para>Druckt Text inklusive vorhandener Steuerzeichen.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-n</option></term>

	    <listitem>
	      <para>Druckt ditroff-Dateien (ger&auml;teunabh&auml;ngiges
	       troff).</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>-p</term>

	    <listitem>
	      <para>Formatiert normalen Text mit &man.pr.1;, bevor der
	        Ausdruck erfolgt.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-T <replaceable>titel</replaceable></option></term>

	    <listitem>
	      <para>Verwende <replaceable>titel</replaceable> auf dem
	        &man.pr.1;-Deckblatt anstelle des Dateinamens.  Diese
	        Option ist nur wirksam, wenn sie gemeinsam mit der
	        Option <option>-p</option> verwendet.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-t</option></term>

	    <listitem>
	      <para>Druckt troff-Daten.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term><option>-v</option></term>

	    <listitem>
	      <para>Druckt Rasterdaten.</para>
	    </listitem>
	  </varlistentry>
	</variablelist>

	<para>Dazu ein Beispiel.  Der folgende Befehl druckt eine
	  formatierte Version der Manualpage zu &man.ls.1; auf den
	  Standarddrucker:</para>

	<screen>&prompt.user; <userinput><command>zcat <filename>/usr/share/man/man1/ls.1.gz</filename> | troff <option>-t</option> -man | lpr <option>-t</option></command></userinput></screen>

	<para>&man.zcat.1; dekomprimiert den Quellcode der Manualpage
	  &man.ls.1; und reicht ihn an &man.troff.1; weiter, das
	  ihn formatiert und daraus GNU troff-Daten erzeugt.  Diese
	  werden wiederum an &man.lpr.1; weitergereicht, das den
	  Druckauftrag schlie&szlig;lich an
	  <application>LPD</application> &uuml;bergibt.  Da die Option
	  <option>-t</option> von &man.lpr.1; verwendet wurde,
	  konvertiert das Drucksystem die GNU troff-Daten zuvor in
	  ein Format, das der Standarddrucker verstehen und ausgeben
	  kann.</para>
      </sect3>

      <sect3 id="printing-lpr-options-job-handling">
	<title>Druckauftr&auml;ge verwalten</title>

	<para>Die folgenden Optionen von &man.lpr.1; weisen
	  <application>LPD</application> an, den Druckauftrag auf
	  verschiedene Art und Weise zu behandeln:</para>

	<variablelist>
	  <varlistentry>
	    <term>-# <replaceable>anzahl</replaceable></term>

	    <listitem>
	      <para>Erzeugt <replaceable>anzahl</replaceable> Ausdrucke
	        jeder im Druckauftrag enthaltenen Datei anstelle eines
	        einzigen Exemplars.  Diese Option kann von einem
	        Administrator deaktiviert werden, um die Beanspruchung
	        des Druckers zu verringern.  Lesen Sie den Abschnitt
	        <link linkend="printing-advanced-restricting-copies">
	        Den Ausdruck von mehreren Kopien verhindern</link>,
	        wenn Sie diese Funktion ben&ouml;tigen.</para>

	      <para>Das folgende Beispiel druckt drei Kopien der Datei
	        <filename><replaceable>parser.c</replaceable></filename>,
	        gefolgt von drei Kopien von
	        <filename><replaceable>parser.h</replaceable></filename> auf
	        den Standarddrucker:</para>

	      <screen>&prompt.user; <userinput><command>lpr <option>-#3</option> <filename><replaceable>parser.c parser.h</replaceable></filename></command></userinput></screen>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>-m</term>

	    <listitem>
	      <para>Verschickt eine E-Mail, nachdem der Druckauftrag
	        beendet wurde.  Verwenden Sie diese Option, sendet
	        <application>LPD</application> Ihnen eine E-Mail, wenn
	        es die Bearbeitung Ihres Druckauftrages abgeschlossen
	        hat.  Diese Nachricht enth&auml;lt Informationen
	        dar&uuml;ber, ob Ihr Auftrag erfolgreich erledigt wurde
	        oder ob ein Fehler auftrat. Ist dies der Fall, wird
	        meist noch angegeben, welcher Fehler auftrat.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>-s</term>

	    <listitem>
	      <para>Kopiert die Dateien nicht in das
	        Spooling-Verzeichnis, sondern verlinkt stattdessen
	        symbolisch auf diese Dateien.</para>

	      <para>Wenn Sie einen umfangreichen Druckauftrag erstellen,
	        werden Sie diese Option wahrscheinlich verwenden wollen.
	        Einerseits sparen Sie dadurch Speicherplatz im
	        Spooling-Verzeichnis (im schlimmsten Fall k&ouml;nnte
	        Ihr Druckauftrag ansonsten das Dateisystem des
	        Spooling-Verzeichnis zum &Uuml;berlaufen bringen),
	        andererseits sparen Sie dadurch auch Zeit, weil
	        <application>LPD</application> die in Ihrem Druckauftrag
	        enthaltenen Dateien nicht in das Spooling-Verzeichnis
	        kopieren muss.</para>

	      <para>Da <application>LPD</application> in diesem Fall die
	        Originaldateien verwendet, muss sichergestellt sein,
	        dass diese nicht ver&auml;ndert werden, bevor der
	        Ausdruck abgeschlossen ist.</para>

	      <note>
	        <para>Wenn Sie auf einen entfernten Drucker drucken,
	          muss <application>LPD</application> die Dateien dennoch
	          vom lokalen auf den entfernten Rechner kopieren.  In
	          diesem Fall spart die Option <option>-s</option>
	          Speicherplatz lediglich im lokalen Spooling-Verzeichnis,
	          nicht aber im entfernten.  Dennoch ist diese Option auch in
	          diesem Fall n&uuml;tzlich.</para>
	      </note>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>-r</term>

	    <listitem>
	      <para>L&ouml;scht die im Druckauftrag enthaltenen Dateien,
	        nachdem sie in das Spooling-Verzeichnis kopiert oder
	        unter Verwendung der Option <option>-s</option>
	        gedruckt werden.  Verwenden Sie diese Option daher
	        nur mit &auml;u&szlig;erster Vorsicht!</para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </sect3>

      <sect3 id="printing-lpr-options-misc">
	<title>Deckblatt-Optionen</title>

	<para>Die folgenden &man.lpr.1;-Optionen passen den Text an,
	  der auf einem Deckblatt eines Druckauftrages ausgegeben
	  wird.  Wird die Ausgabe von Deckbl&auml;ttern auf dem
	  Zieldrucker unterdr&uuml;ckt, bleiben diese Optionen
	  wirkungslos.  Lesen Sie den Abschnitt <link
	  linkend="printing-advanced-header-pages">Deckbl&auml;tter</link>,
	  wenn Sie diese Funktion ben&ouml;tigen.</para>

	<variablelist>
	  <varlistentry>
	    <term>-C <replaceable>text</replaceable></term>

	    <listitem>
	      <para>Ersetzt den Rechnernamen auf dem Deckblatt durch
	        <replaceable>text</replaceable>.  Der Rechnername ist
	        dabei in der Regel der Name des Rechners, auf dem der
	        Druckauftrag erstellt wurde.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>-J <replaceable>text</replaceable></term>

	    <listitem>
	      <para>Ersetzt den Namen des Druckauftrages auf dem
	        Deckblatt durch <replaceable>text</replaceable>.  Der
	        Name des Druckauftrages entspricht in der Regel dem
	        Namen der ersten Datei des Druckauftrages oder
	        <filename>stdin</filename>, wenn Sie die
	        Standardeingabe an den Drucker weiterleiten.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>-h</term>

	    <listitem>
	      <para>Verhindert den Ausdruck von Deckbl&auml;ttern.</para>

	      <note>
	        <para>Ob diese Option funktioniert, h&auml;ngt von der
	          Art und Weise ab, wie Deckbl&auml;tter auf Ihrem
	          System erzeugt werden.  Lesen Sie den Abschnitt
	          <link linkend="printing-advanced-header-pages">
	          Deckbl&auml;tter</link> f&uuml;r weitere
	          Informationen.</para>
	      </note>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </sect3>
    </sect2>

    <sect2 id="printing-lpc">
      <title>Drucker verwalten</title>

      <para>Als Administrator Ihres Systems ist es Ihre Aufgabe, Drucker
	zu installieren, zu konfigurieren und zu testen.  Um mit Ihrem
	Drucker zu kommunizieren, k&ouml;nnen Sie &man.lpc.8; verwenden.
	Dadurch sind Sie in der Lage,</para>

      <itemizedlist>
	<listitem>
	  <para>Ihre Drucker zu starten und zu beenden.</para>
	</listitem>

	<listitem>
	  <para>Die Warteschlangen Ihrer Drucker zu aktivieren und zu
	    deaktivieren.</para>
	</listitem>

	<listitem>
	  <para>Die Reihenfolge der Druckauftr&auml;ge zu
	    &auml;ndern.</para>
	</listitem>
      </itemizedlist>

      <para>Am Anfang dieses Abschnitts steht die Erkl&auml;rung
	einiger Begriffe.  Wenn ein Drucker <emphasis>beendet</emphasis>
	ist, wird der Inhalt seiner Warteschlange nicht gedruckt.
	Druckauftr&auml;ge k&ouml;nnen zwar weiterhin erstellt werden,
	diese verbleiben aber solange in der Warteschlange, bis der
	Drucker wieder <emphasis>gestartet</emphasis> oder die
	Warteschlange gel&ouml;scht wird.</para>

      <para>Ist eine Warteschlange <emphasis>deaktiviert</emphasis>,
	kann (mit Ausnahme von <username>root</username>) kein Benutzer
	mehr einen Druckauftrag erteilen.  Ist die Warteschlange hingegen
	<emphasis>aktiviert</emphasis>, k&ouml;nnen Druckauftr&auml;ge
	erteilt werden.  Ist ein Drucker zwar
	<emphasis>gestartet</emphasis>, die Warteschlange hingegen
	<emphasis>deaktiviert</emphasis>, werden dennoch alle noch in
	der Warteschlange vorhandenen Druckauftr&auml;ge gedruckt.</para>

      <para>Im Allgemeinen ben&ouml;tigen Sie
	<username>root</username>-Rechte, um &man.lpc.8; einsetzen zu
	k&ouml;nnen.  Als normaler Benutzer erlaubt es Ihnen &man.lpc.8;
	lediglich, den Druckstatus abzufragen und einen h&auml;ngenden
	Drucker neu zu starten.</para>

      <para>Es folgt nun eine Zusammenfassung der Befehle von
	&man.lpc.8;.  Die meisten dieser Befehle ben&ouml;tigen das
	Argument <replaceable>printer-name</replaceable>, mit dem Sie
	angeben, auf welchen Drucker der Befehl angewendet werden soll.
	Wenn Sie f&uuml;r <replaceable>printer-name</replaceable>
	<literal>all</literal> angeben, wird der Befehl auf alle in
	<filename>/etc/printcap</filename> definierten Drucker
	angewendet.</para>

      <variablelist>
	<varlistentry>
	  <term><command>abort
	      <replaceable>printer-name</replaceable></command></term>

	  <listitem>
	    <para>Bricht den aktuellen Druckauftrag ab und beendet den
	      Drucker.  Solange die Warteschlange aktiviert ist,
	      k&ouml;nnen allerdings weiterhin Druckauftr&auml;ge
	      erteilt werden.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><command>clean
	      <replaceable>printer-name</replaceable></command></term>

	  <listitem>
	    <para>Entfernt veraltete Dateien aus dem
	      Spooling-Verzeichnis des Druckers, da diese manchmal nicht
	      vollst&auml;ndig von <application>LPD</application>
	      entfernt werden k&ouml;nnen.  Dies ist insbesondere dann
	      der Fall, wenn w&auml;hrend der Bearbeitung des
	      Druckauftrages Fehler auftraten.  Dieser Befehl sucht
	      dabei nach Dateien, die nicht in das Spooling-Verzeichnis
	      geh&ouml;ren und entfernt diese.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><command>disable
	      <replaceable>printer-name</replaceable></command></term>

	  <listitem>
	    <para>Deaktiviert die Annahme neuer Druckauftr&auml;ge.
	      Solange der Drucker nicht beendet wird, werden weiterhin
	      alle in der Warteschlange enthaltenen Auftrage bearbeitet
	      und gedruckt.  <username>root</username> kann jederzeit
	      Druckauftr&auml;ge erstellen, selbst dann, wenn die
	      Druckerwarteschlange deaktiviert ist.</para>

	    <para>Dieser Befehl ist besonders n&uuml;tzlich, wenn Sie
	      einen neuen Drucker testen m&uuml;ssen oder einen neuen
	      Filter installiert haben.  Dazu deaktivieren Sie die
	      Warteschlange des Druckers und erstellen Ihre
	      Druckauftr&auml;ge als <username>root</username>.
	      Andere Benutzer k&ouml;nnen erst dann einen Druckauftrag
	      erstellen, wenn Sie Ihre Tests abgeschlossen haben und
	      die Druckerwarteschlange mit <command>enable</command>
	      wieder reaktivieren.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><command>down <replaceable>printer-name</replaceable>
	      <replaceable>nachricht</replaceable></command></term>

	  <listitem>
	    <para>Beendet einen Drucker.  &Auml;quivalent zu
	      <command>disable</command>, gefolgt von
	      <command>stop</command>.  Die von Ihnen definierte
	      <replaceable>nachricht</replaceable> wird als
	      Druckerstatus angezeigt, wenn ein Benutzer die
	      Warteschlange des Druckers mit &man.lpq.1; oder
	      mit <command>lpc status</command> abfragt.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><command>enable
	      <replaceable>printer-name</replaceable></command></term>

	  <listitem>
	    <para>Aktiviert die Warteschlange eines Druckers.  Erteilte
	      Druckauftr&auml;ge k&ouml;nnen zwar erteilt werden, diese
	      werden aber nur dann gedruckt, wenn der Drucker auch
	      gestartet ist.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><command>help
	      <replaceable>command-name</replaceable></command></term>

	  <listitem>
	    <para>Ausgaben von hilfreichen Informationen zu
	      <replaceable>command-name</replaceable>.  Wird kein
	      <replaceable>command-name</replaceable> angegeben, wird
	      die Liste der verf&uuml;gbaren Befehle ausgegeben.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><command>restart
	      <replaceable>printer-name</replaceable></command></term>

	  <listitem>
	    <para>Startet den Drucker.  Normale Benutzer k&ouml;nnen diesen
	      Befehl verwenden, um einen h&auml;ngenden
	      <application>LPD</application> zu reaktivieren, sie sind
	      allerdings nicht berechtigt, einen Drucker zu starten, der mit
	      <command>stop</command> oder <command>down</command> beendet
	      wurde.  Dieser Befehl ist &auml;quivalent zu
	      <command>abort</command>, gefolgt von
	      <command>start</command>.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><command>start
	      <replaceable>printer-name</replaceable></command></term>

	  <listitem>
	    <para>Startet den Drucker, um die in der Warteschlange
	      enthaltenen Auftr&auml;ge zu drucken.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><command>stop
	      <replaceable>printer-name</replaceable></command></term>

	  <listitem>
	    <para>Beendet den Drucker.  Der Drucker beendet den aktiven
	      Druckauftrag noch, danach wird kein weiterer in der
	      Warteschlange enthaltener Auftrag gedruckt.  Obwohl der
	      Drucker beendet wurde, k&ouml;nnen weiterhin
	      Druckauftr&auml;ge erteilt werden, solange die
	      Warteschlange nicht deaktiviert wurde.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><command>topq <replaceable>printer-name</replaceable>
	      <replaceable>job-or-username</replaceable></command></term>

	  <listitem>
	    <para>Sortiert die Druckerwarteschlange des Druckers
	      <replaceable>printer-name</replaceable> um, wobei
	      der Auftrag mit der angegebenen
	      <replaceable>Auftragsnummer</replaceable>,
	      oder Druckauftr&auml;ge, die von
	      <replaceable>username</replaceable> erstellt wurden, an
	      den Beginn der Warteschlange gesetzt werden.  F&uuml;r
	      diesen Befehl kann die Option <literal>all</literal>
	      nicht als <replaceable>printer-name</replaceable>
	      verwendet werden.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><command>up
	      <replaceable>printer-name</replaceable></command></term>

	  <listitem>
	    <para>Startet einen Drucker.  Das Gegenst&uuml;ck zu
	      <command>down</command>.  &Auml;quivalent zu
	      <command>start</command>, gefolgt von
	      <command>enable</command>.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>&man.lpc.8; akzeptiert diese Befehle direkt auf der
	Kommandozeile.  Geben Sie keinen Befehl ein, wird
	&man.lpc.8; im interaktiven Modus gestartet.  In diesem
	Modus k&ouml;nnen Sie solange Befehle eingeben, bis Sie
	<command>exit</command> oder <command>quit</command>
	eingeben.</para>
    </sect2>
  </sect1>

  <sect1 id="printing-lpd-alternatives">
    <title>Alternativen zum
      <application>LPD</application>-Drucksystem</title>

    <para>Wenn Sie dieses Kapitel bis hierher gelesen haben, wissen
      Sie so gut wie alles &uuml;ber
      <application>LPD</application>, das Standarddrucksystem von
      &os;.  Wahrscheinlich sind Ihnen bereits einige
      Unzul&auml;nglichkeiten dieses Systems aufgefallen, und Sie
      fragen sich nun, welche anderen Drucksysteme es f&uuml;r &os;
      gibt.</para>

    <variablelist>
      <varlistentry>
	<term>LPRng</term>

	<indexterm><primary>LPRng</primary></indexterm>

	<listitem>
	  <para><application>LPRng</application> steht f&uuml;r
	    <quote>LPR: the Next Generation</quote>.  Dabei handelt es
	    sich um eine von Grund auf neu geschriebene Version von PLP.
	    LPRng wurde von Patrick Powell und Justin Mason, dem
	    Hauptmaintainer von PLP, entwickelt.  Die offizielle
	    Webseite von <application>LPRng</application> ist unter
	    <ulink url="http://www.lprng.org/"></ulink> zu finden.</para>
	</listitem>
      </varlistentry>
      <varlistentry>
	<term>CUPS</term>

	<indexterm><primary>CUPS</primary></indexterm>

	<listitem>
	  <para><application>CUPS</application>, das
	    <foreignphrase>Common UNIX Printing System</foreignphrase>,
	    stellt eine portable Abstraktionsschicht dar, die das
	    Drucken auf allen &unix;-artigen Betriebsystemen
	    erm&ouml;glicht.  <application>CUPS</application> wurde von
	    Easy Software entwickelt, um &unix;-Herstellern und
	    -Benutzern eine einheitliche Standardl&ouml;sung f&uuml;r
	    den Druck von Dokumenten zu bieten.</para>

	  <para><application>CUPS</application> verwendet das Internet
	    Printing Protocol (<acronym>IPP</acronym>), um
	    Druckauftr&auml;ge und -warteschlangen zu verwalten.
	    Zus&auml;tzlich werden die Protokolle
	    <foreignphrase>Line Printer Daemon</foreignphrase>
	    (<acronym>LPD</acronym>),
	    <foreignphrase>Server Message Block</foreignphrase>
	    (<acronym>SMB</acronym>), und
	    <foreignphrase>AppSocket/JetDirect</foreignphrase>),
	    unterst&uuml;tzt, wenn auch nur mit eingeschr&auml;nkter
	    Funktionalit&auml;t.  Ausserdem erm&ouml;glicht
	    <application>CUPS</application> das Auffinden von
	    Netzwerkdruckern sowie die Verwendung auf
	    <foreignphrase>PostScript Printer
	    Description</foreignphrase> (<acronym>PPD</acronym>)
	    basierender Druckoptionen.</para>

	  <para>Die offizielle Webseite von <application>CUPS</application>
	    ist <ulink url="http://www.cups.org/"></ulink>.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
        <term>HPLIP</term>

        <indexterm><primary>HPLIP</primary></indexterm>

        <listitem>
          <para><application>HPLIP</application>, das HP &linux; Imaging and
            Printing System, ist eine von HP entwickelte Sammlung von
            Programmen, die Unterst&uuml;tzung f&uuml;r das drucken, scannen
            und faxen bei HP-Ger&auml;ten bieten.  Diese Programm-Sammlung
            verwendet <application>CUPS</application> als Grundlage f&uuml;r
            einige seiner Druck-Eigenschaften.</para>

          <para>Die Hauptseite f&uuml;r <application>HPLIP</application> ist
            <ulink url="http://hplipopensource.com/hplip-web/index.html"></ulink>.</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 id="printing-troubleshooting">
    <title>Problembehandlung</title>

    <para>Wenn Sie eine einfache Testseite mit &man.lptest.1; gedruckt
      haben, k&ouml;nnte eines der folgenden Probleme aufgetreten
      sein:</para>

    <variablelist>
      <varlistentry>
	<term>Der Druck hat erst mit einer gewissen Verz&ouml;gerung
	  geklappt oder das bedruckte Blatt verblieb im Drucker, so als
	  w&auml;re der Druckvorgang noch nicht abgeschlossen.</term>

	<listitem>
	  <para>Die Testseite wurde zwar gedruckt, danach tat sich
	    allerdings nichts mehr.  Vielleicht mussten Sie sogar eine
	    Taste Ihres Druckers, etwa PRINT REMAINING oder FORM FEED
	    dr&uuml;cken, damit der Druckvorgang fortgesetzt wurde.</para>

	  <para>Wenn das der Fall ist, hat der Drucker vermutlich vor
	    dem eigentlichen Drucken gewartet, ob noch weitere Daten
	    f&uuml;r Ihren Druckauftrag gesendet werden.  Um dieses
	    Problem zu beheben, k&ouml;nnen Sie den Textfilter
	    anweisen, ein <foreignphrase>Form Feed</foreignphrase>
	    -Zeichen (oder ein anderes entsprechendes Zeichen) an den
	    Drucker zu senden.  Dies reicht f&uuml;r gew&ouml;hnlich
	    aus, um den Drucker zum Druck des noch im internen
	    Puffer verbliebenen Textes zu bewegen.  Dadurch kann auch
	    sichergestellt werden, dass jeder neue Druckauftrag auf
	    einer neuen Seite beginnt.</para>

	  <para>Der folgende Ersatz f&uuml;r das Shell-Skript
	    <filename>/usr/local/libexec/if-simple</filename> gibt
	    ein <quote>Form Feed</quote> aus, nachdem der Auftrag an
	    den Drucker geschickt wurde:</para>

	  <programlisting>#!/bin/sh
#
# if-simple - Einfacher Eingabefilter f&uuml;r lpd
# Installiert unter /usr/local/libexec/if-simple
#
# Kopiert stdin einfach nach stdout. Ignoriert alle Filter-Argumente.
# Schreibt ein Form-Feed-Zeichen (\f) nach dem Ende des Druckauftrages.

/bin/cat &amp;&amp; printf "\f" &amp;&amp; exit 0
exit 2</programlisting>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Der Drucker erzeugte einen <quote>Treppeneffekt</quote>
	  (<foreignphrase>staircase effect</foreignphrase>).</term>

	<listitem>
	  <para>Sie haben einen Ausdruck &auml;hnlich dem folgenden
	    erhalten:</para>

	  <screen>!"#$%&amp;'()*+,-./01234
                "#$%&amp;'()*+,-./012345
                                 #$%&amp;'()*+,-./0123456</screen>

	  <indexterm><primary>MS-DOS</primary></indexterm>
	  <indexterm><primary>OS/2</primary></indexterm>
	  <indexterm><primary>ASCII</primary></indexterm>

	  <para>Sie sind zu einem weiteren Opfer des
	    <emphasis>Treppeneffekts</emphasis> geworden.  Verursacht
	    wird dieser Effekt durch unterschiedliche Ansichten
	    dar&uuml;ber, welche Zeichen den Beginn einer neuen Zeile
	    anzeigen sollen.  &unix;-&auml;hnliche Betriebssysteme
	    verwenden daf&uuml;r ein einzelnes Zeichen:  ASCII-Code 10,
	    auch als <foreignphrase>Line Feed</foreignphrase> (LF)
	    bekannt.  &ms-dos;, &os2; und andere Betriebssysteme
	    verwenden stattdessen ein Zeichenpaar:  ASCII-Code 10
	    <emphasis>und</emphasis> ASCII-Code 13,
	    <foreignphrase>Carriage Return</foreignphrase> (CR).  Viele
	    Drucker verwenden in der Voreinstellung die Konvention von
	    &ms-dos;, um Zeilenumbr&uuml;che darzustellen.</para>

	  <para>Wenn Sie unter &os; drucken, wird nur das Zeichen
	    <foreignphrase>Line Feed</foreignphrase> verwendet.  Der
	    Drucker erkennt dieses Zeichen und erweitert den
	    Druckbereich um eine Zeile, verbleibt zum Druck des
	    n&auml;chsten Zeichens aber in derselben horizontalen
	    Position.  Das ist der Grund f&uuml;r die Verwendung des
	    <foreignphrase>Carriage Return</foreignphrase>:  Es setzt
	    die Position f&uuml;r das folgende Zeichen auf den linken
	    Rand der Seite.</para>

	  <para>&os; erwartet von einem Drucker das folgende
	    Verhalten:</para>

	  <informaltable frame="none" pgwide="1">
	    <tgroup cols="2">
	      <tbody>
		<row>
		  <entry>Drucker empf&auml;ngt CR</entry>
		  <entry>Drucker druckt CR</entry>
		</row>

		<row>
		  <entry>Drucker empf&auml;ngt LF</entry>
		  <entry>Drucker druckt CR + LF</entry>
		</row>
	      </tbody>
	    </tgroup>
	  </informaltable>

	  <para>Es gibt mehrere M&ouml;glichkeiten, dieses Verhalten zu
	    erreichen:</para>

	  <itemizedlist>
	    <listitem>
	      <para>Ver&auml;ndern Sie die Konfiguration Ihres Druckers,
		um die Interpretation dieser Zeichen zu ver&auml;ndern.
		Lesen Sie Ihr Druckerhandbuch, wenn Sie nicht wissen,
		was Sie dazu tun m&uuml;ssen.</para>

	      <note>
		<para>Wenn Sie auf Ihrem Rechner neben &os; noch
		  andere Betriebssysteme verwenden, m&uuml;ssen Sie
		  Ihren Drucker m&ouml;glicherweise anschlie&szlig;end
		  <emphasis>erneut konfigurieren</emphasis>, damit die
		  Zeichen CR und LF unter diesen Systemen korrekt
		  interpretiert werden.  Ist dies bei Ihnen der Fall,
		  werden Sie wohl eine der folgenden L&ouml;sungen
		  bevorzugen.</para>
	      </note>
	    </listitem>

	    <listitem>
	      <para>Lassen Sie LF durch den Treiber der seriellen
		Schnittstelle automatisch in CR+LF konvertieren.
		Selbstverst&auml;ndlich funktioniert dies nur mit
		Druckern, die an einer seriellen Schnittstelle
		angeschlossen sind.  Um diese M&ouml;glichkeit zu
		nutzen, m&uuml;ssen Sie die
		<literal>ms#</literal>-F&auml;higkeit verwenden und
		in <filename>/etc/printcap</filename> den
		<literal>onlcr</literal>-Modus f&uuml;r den Drucker
		aktivieren.</para>
	    </listitem>

	    <listitem>
	      <para>Senden Sie eine <emphasis>Escape-Sequenz</emphasis>
		an den Drucker, damit das Zeichen LF zeitweilig anders
		behandelt wird.  Suchen Sie im Handbuch Ihres Druckers
		nach den von Ihrem Drucker unterst&uuml;tzten
		Escape-Sequenzen.  Wenn Sie eine entsprechenden
		Escape-Sequenz finden, m&uuml;ssen Sie den Textfilter so
		anpassen, dass zuerst die Escape-Sequenz und
		anschlie&szlig;end der Druckauftrag gesendet wird.</para>

	      <indexterm><primary>PCL</primary></indexterm>

	      <para>Es folgt nun ein Bespieltextfilter f&uuml;r einen
		Drucker, der die Hewlett Packard PCL Escape-Sequenzen
		versteht.  Dieser Filter veranlasst den Drucker,
		LF-Zeichen als Folgen von LF+CR aufzufassen.
		Anschlie&szlig;end wird der Druckauftrag gesendet.  Als
		Abschluss wird ein <foreignphrase>Form
		Feed</foreignphrase> gesendet, um die letzte Seite des
		Druckauftrags auszuwerfen.  Dieses Beispiel sollte mit
		nahezu allen Druckern von Hewlett Packard
		funktionieren.</para>

	      <programlisting>#!/bin/sh
#
# hpif - Einfacher Text-Eingabefilter f&uuml;r lpd f&uuml;r auf HP-PCL basierende Drucker
# Installiert unter /usr/local/libexec/hpif
#
# Kopiert stdin einfach nach stdout.  Ignoriert alle Filterargumente.
# Weist den Drucker an LF als CR+LF zu interpretieren.
# Wirft die Seite nach dem Drucken aus.

printf "\033&amp;k2G" &amp;&amp; cat &amp;&amp; printf "\033&amp;l0H" &amp;&amp; exit 0
exit 2</programlisting>

	      <para>Das n&auml;chste Beispiel aus
		<filename>/etc/printcap</filename> beschreibt den
		Rechner <hostid>orchid</hostid>, an dessen Parallelport
		ein Drucker angeschlossen ist.  Es handelt sich dabei um
		einen Hewlett Packard LaserJet&nbsp;3Si, der den Namen
		<literal>teak</literal> verwendet.  Als Textfilter wird
		das Skript aus dem letzten Beispiel verwendet:</para>

	      <programlisting>#
#  /etc/printcap f&uuml;r den Rechner orchid
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=<filename class="devicefile">/dev/lpt0</filename>:sh:sd=<filename class="directory">/var/spool/lpd/teak</filename>:mx#0:\
        :if=<filename>/usr/local/libexec/hpif</filename>:</programlisting>
	    </listitem>
          </itemizedlist>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Alle Zeilen wurden in die gleiche Zeile gedruckt.</term>

	<listitem>
	  <para>Der Drucker hat niemals eine neue Zeile begonnen.  Alle
	    Zeilen des Textes wurden in eine einzige Zeile gedruckt.</para>

	  <para>Dieses Problem ist das <quote>Gegenteil</quote> des
	    oben beschriebenen Treppeneffekts und kommt wesentlich
	    seltener vor.  Die von &os; zum Abschluss einer Zeile
	    benutzten LF-Zeichen werden als CR-Zeichen interpretiert.
	    Dadurch wird die Druckposition zwar auf den linken Rand
	    der Seite, aber nicht um eine Zeile nach unten gesetzt.</para>

	  <para>Konfigurieren Sie Ihren Drucker, um die folgende
	    Interpretation der Zeichen LF und CR zu erzwingen:</para>

	  <informaltable frame="none" pgwide="1">
	    <tgroup cols="2">
	      <thead>
		<row>
		  <entry>Drucker empf&auml;ngt</entry>
		  <entry>Drucker druckt</entry>
		</row>
	      </thead>

	      <tbody>
		<row>
		  <entry>CR</entry>
		  <entry>CR</entry>
		</row>

		<row>
		  <entry>LF</entry>
		  <entry>CR + LF</entry>
		</row>
	      </tbody>
	    </tgroup>
	  </informaltable>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Manche Zeichen wurden nicht gedruckt.</term>

	<listitem>
	  <para>Der Drucker hat in jeder Zeile einige Zeichen nicht
	    gedruckt.  Vielleicht ist das Problem auch w&auml;hrend des
	    Druckens schlimmer geworden, und der Drucker hat immer mehr
	    Zeichen nicht gedruckt.</para>

	  <para>Dieses Problem entsteht, weil der Drucker mit der
	    Geschwindigkeit, mit der die Daten &uuml;ber die serielle
	    Schnittstelle (an einer parallelen Schnittstelle sollte das
	    Problem nicht auftreten) eintreffen, nicht mithalten kann.
	    Es gibt zwei M&ouml;glichkeiten, dieses Problem zu
	    l&ouml;sen:</para>

	  <itemizedlist>
	    <listitem>
	      <para>Wenn der Drucker die Flusskontrolle mit XON/XOFF
		unterst&uuml;tzt, k&ouml;nnen Sie in der
		<literal>ms#</literal>-F&auml;higkeit den
		<literal>ixon</literal>-Modus aktivieren.</para>
	    </listitem>

	    <listitem>
	      <para>Unterst&uuml;tzt der Drucker die Anfrage zum
	        Senden/L&ouml;schen des Sende-Hardware-Handshakes (allgemein
	        bekannt als <literal>RTS/CTS</literal>, dann sollten Sie den
		<literal>crtscts</literal>-Modus in der
		<literal>ms#</literal>-F&auml;higkeit aktivieren.
		Stellen Sie aber sicher, dass das verwendete
		Druckerkabel auch f&uuml;r die Hardware-Flusskontrolle
		geeignet ist.</para>
	    </listitem>
	  </itemizedlist>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Es wurden nur wirre Zeichen gedruckt.</term>

	<listitem>
	  <para>Anstelle des gew&uuml;nschten Textes wurden nur
	    zuf&auml;llige Zeichen gedruckt.</para>

	  <para>Dieses Problem wird ebenfalls durch falsche
	    Konfigurationsparameter im Zusammenhang mit einem seriellen
	    Drucker verursacht.  Kontrollieren Sie die bps-Rate in der
	    <literal>br</literal>-F&auml;higkeit und die
	    Parit&auml;tseinstellung
	    (<foreignphrase>Parity</foreignphrase>) in der
	    <literal>ms#</literal>-F&auml;higkeit.  &Uuml;berpr&uuml;fen
	    Sie au&szlig;erdem, ob der Drucker auch tats&auml;chlich die
	    gleichen Einstellungen verwendet, die in
	    <filename>/etc/printcap</filename> definiert wurden.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Der Drucker hat &uuml;berhaupt nicht reagiert.</term>

	<listitem>
	  <para>Wenn gar nichts passiert ist, dann liegt das vermutlich
	    an &os; und nicht am Drucker.  Aktivieren Sie die
	    Protokollierung (<literal>lf</literal>-F&auml;higkeit)
	    f&uuml;r den entsprechenden Drucker in der Datei
	    <filename>/etc/printcap</filename>.  Es folgt nun ein
	    Beispieleintrag f&uuml;r den Drucker
	    <literal>rattan</literal>, bei dem die
	    <literal>lf</literal>-F&auml;higkeit aktiviert wurde.</para>

	  <programlisting>rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=<filename class="directory">/var/spool/lpd/rattan</filename>:\
        :lp=<filename class="devicefile">/dev/lpt0</filename>:\
        :if=<filename>/usr/local/libexec/if-simple</filename>:\
        :lf=<filename>/var/log/rattan.log</filename></programlisting>

	  <para>Versuchen Sie jetzt noch einmal zu drucken.
	    &Uuml;berpr&uuml;fen Sie die Protokolldatei (in unserem
	    Beispiel <filename>/var/log/rattan.log</filename>) auf
	    etwaige Fehlermeldungen.  Versuchen Sie aufgrund dieser
	    Meldungen, das Problem zu beheben.</para>

	  <para>Wenn Sie keine Protokolldatei festlegen, verwendet
	    <application>LPD</application> in der Voreinstellung <filename
	    class="devicefile">/dev/console</filename> f&uuml;r die Ausgabe
	    der Fehlermeldungen.</para>
	</listitem>
      </varlistentry>
    </variablelist>
  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->

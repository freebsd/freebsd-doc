.\" NOTE:  changes to the manual page for "top" should be made in the
.\"        file "top.X" and NOT in the file "top.1".
.\" jpman %Id: top.1,v 1.3 1997/08/19 03:06:41 h-nokubi Stab %
.nr N %topn%
.nr D %delay%
.TH TOP 1 Local
.UC 4
.SH 名称
top \- CPU プロセスの上位リストに関する情報を表示/更新する
.SH 書式
.B top
[
.B \-SbiInqut
] [
.BI \-d count
] [
.BI \-s time
] [
.BI \-o field
] [
.BI \-U username
] [
.I number
]
.SH 解説
.\" This defines appropriate quote strings for nroff and troff
.ds lq \&"
.ds rq \&"
.if t .ds lq ``
.if t .ds rq ''
.\" Just in case these number registers aren't set yet...
.if \nN==0 .nr N 10
.if \nD==0 .nr D 5
.I top
はシステム内の上位
.if !\nN==-1 \nN
プロセスを表示し、その情報を定期的に更新します。
.if \nN==-1 \
\{\
標準出力がインテリジェント端末 (以下を参照) なら、
デフォルトでは端末画面に合わせて表示プロセス数を決定します。
それ以外の場合、適切な数のプロセス (約 20 プロセス) が表示されます。
.\}
生の CPU パーセンテージを用いてプロセス順位を決めます。もし
.I number
が指定されると、デフォルト値に代えて、上位
.I number
プロセスが表示されます。
.PP
.I top
の動作は高機能端末とそうでない端末とで異なります。
この差異によって、いくつかのオプションのデフォルト値も変わってきます。
以下の部分では、\*(lqインテリジェント\*(rq 端末とは、
カーソルアドレシング、画面クリアおよび行末までのクリアをサポートしている
端末のことを指します。
逆に \*(lqダム\*(rq 端末とは、そのような機能をサポートしていないものを
いいます。
.I top
の出力をファイルにリダイレクトすると、
あたかもダム端末上で動作しているように振る舞います。
.SH オプション
.TP
.B \-S
システムプロセスも画面に表示します。
pager や swapper といったシステムプロセスは通常、表示されませんが、
このオプションによりそれらも見えるようになります。
.TP
.B \-b
\*(lqバッチ\*(rq モードにします。
バッチモードでは、端末からの入力は全て無視されます。
ただし割り込みキャラクタ (^C や ^\e など) は有効です。
ダム端末上で実行する場合や出力先が端末以外の場合は、これがデフォルトです。
.TP
.B \-i
\*(lq対話的実行\*(rq モードにします。
対話的実行モードでは、あらゆる入力は直ちに読み込んで処理されます。
どのキーがどういう機能をもっているかについては、
\*(lq対話的実行モード\*(rq のセクションを参照して下さい。
コマンドが処理されると、そのコマンドが理解されなかった場合でも、
画面は直ちに更新されます。
出力先がインテリジェント端末の場合は、これがデフォルトです。
.TP
.B \-I
アイドル状態のプロセスを表示しません。
デフォルトでは、
top はアクティブプロセスもアイドルプロセスも両方とも表示します。
.TP
.B \-t
.I top
プロセスを表示しないようにします。
.TP
.B \-n
\*(lq非対話的実行\*(rq モードにします。
これは \*(lqバッチ\*(rq モードと同じです。
.TP
.B \-q
.I top
を -20 に renice し、より高速に実行されるようにします。
この機能は、システムが大変重い場合に、問題箇所を発見する可能性を高めるために
用いられます。
このオプションは root のみ使用可能です。
.TP
.B \-u
uid 値をユーザ名に変換する時間を割かないようにします。
通常、
.I top
は必要に応じてファイル \*(lq/etc/passwd\*(rq を読み、
出現する全てのユーザ id 値をログイン名に変換します。
このオプションはその変換を全て止め、できるだけ実行時間を低減させます。
ログイン名の代わりに uid 値が表示されます。
.TP
.BI \-d count
.I count
回だけ表示し、その後終了します。
1 回の表示とは、1 回の画面更新のことです。
このオプションにより、ユーザは希望する回数だけ状況を表示し、
その後自動的に
.I top
を終了させることができます。
インテリジェント端末では、表示回数の上限は設定されていません。
ダム端末ではデフォルト値は 1 回です。
.TP
.BI \-s time
画面更新間隔を
.I time
秒に設定します。デフォルトの画面更新間隔は \nD 秒です。
.TP
.BI \-o field
プロセス表示領域を指定したフィールドによってソートします。
フィールド名には出力で示されているカラム名を用いますが、小文字で指定します。
しばしば用いられる値は \*(lqcpu\*(rq, \*(lqsize\*(rq, 
\*(lqres\*(rq, \*(lqtime\*(rq ですが、これは OS によっても異なります。
必ずしも全ての OS でこのオプションがサポートされているわけではないことに
注意して下さい。
.TP
.BI \-U username
ユーザ
.IR username
が所有しているプロセスのみ表示します。
現在のところ、このオプションはユーザ名指定のみ可能で、uid 値は指定できません。
.PP
.I count
と
.I number
はいずれも \*(lq無限\*(rq を指定でき、
その場合、それらは可能な限り引き延ばされます。
これは、キーワード
\*(lqinfinity\*(rq,
\*(lqmaximum\*(rq,
\*(lqall\*(rq
のいずれかの、
一意に識別可能な先頭からの部分文字列を指定することで行われます。
実際、インテリジェント端末での
.I count
のデフォルト値は
.BI infinity
となっています。
.PP
コマンドラインのオプションを調べる前に、
環境変数
.B TOP
が調べられます。これによりユーザ自身のデフォルト値を設定できます。
表示プロセス数も環境変数
.BR TOP
で指定可能です。
オプション
.BR \-I ,
.BR \-S ,
.BR \-u ,
.B \-t
は実際はトグルオプションです。これらのオプションを 2 回指定すると、
最初の指定を無効にします。
ですから、環境変数
.B TOP
を \*(lq\-I\*(rq と設定しているユーザは、
\*(lqtop \-I\*(rq とすることでアイドルプロセスの状況を見ることができます。
.SH 対話的実行モード
\*(lq対話的実行モード\*(rq で動作している場合、
.I top
は端末からコマンドを読み込み、それに応じて動作を行います。
このモードでは端末は \*(lqCBREAK\*(rq モードに設定され、
入力文字が速やかに処理されるようになります。
.I top
の表示と表示の間、
つまり
.I top
が
.I time
秒が経過するのを待っている間、ほとんどいつでもキー入力可能です。
実際キーが押されると、そのコマンドは直ちに処理され、
画面が更新されます (そのコマンドが指示した変更も反映されます)。
これはコマンドが正しくない場合にも行われます。
画面を更新している最中にキーが押されると、
.I top
は画面更新を終らせて、そのコマンドを処理します。
コマンドによっては更に情報の指定が必要になるものもありますが、
その場合、それに応じてユーザに入力が求められます。
その情報を入力する間、ユーザの削除キーと行削除キー (
.IR stty コマンドで設定される) が利用でき、改行により入力が完了します。
.PP
現在のところ、以下のコマンドが利用可能です (^L は control-L を表します):
.TP
.B ^L
画面を再描画します。
.IP "\fBh\fP\ or\ \fB?\fP"
コマンド一覧 (ヘルプ画面) を表示します。
.TP
.B q
.I top
を終了します。
.TP
.B d
表示する画面数を変更します (新しい数値入力が求められます)。
次回の表示が 1 回目となります。ですから
.B d1
と入力すると、
.I top
は 1 回表示して直ちに終了します。
.TP
.B n or #
表示するプロセス数を変更します (新しい数値入力が求められます)。
.TP
.B s
表示間隔の秒数を変更します (新しい数値入力が求められます)。
.TP
.B k
プロセスリストにシグナル (デフォルトでは \*(lqkill\*(rq) を送ります。
.IR kill (1) コマンドと同様の働きをします。
.TP
.B r
プロセスリストの優先度 (\*(lqnice\*(rq 値) を変更します。
.IR renice (8) コマンドと同様の働きをします。
.TP
.B u
指定したユーザ名のユーザが所有するプロセスのみ表示します (ユーザ名入力
が求められます)。
ユーザ名として単に \*(lq+\*(rq が指定された場合、
全ユーザのプロセスが表示されます。
.TP
.B e
前回の
.BR k ill
または
.BR r enice
コマンドで生じたシステムエラーがあれば、そのリストを表示します。
.TP
.B i
(または
.BR I )
アイドルプロセスの表示有無を切り替えます。
.TP
.B t
.I top
の表示有無を切り替えます。
.SH 表示
実際の表示画面は、そのマシンで動作している Unix の種類によって異なります。
ここでの説明は、この特定マシンで動作する top コマンドの出力と
厳密には合っていないかもしれません。
相違点はこのマニュアルの終りに示してあります。
.PP
表示画面の先頭数行にはシステム状態に関する情報として、
プロセスに割り当てられた最終プロセス ID (ほとんどのシステム)、
3 種のロードアベレージ、現在時刻、存在するプロセス数、
各状態 (sleep 中、実行中、実行開始中、ゾンビ、停止中) のプロセス数、
各プロセッサ状態 (ユーザ, nice, システム, アイドル) で消費した時間の割合
等が表示されます。
物理メモリおよび仮想メモリの割り当てに関する情報も表示されます。
.PP
画面の残りの部分には各プロセスに関する情報が表示されます。
表示項目は、内容的には
.IR ps (1)
に似ていますが、正確には同じではありません。
PID はプロセス id、USERNAME はプロセス所有者名 (
.B \-u
指定時は UID カラムが USERNAME に取って替わる)、
PRI は現在のプロセス優先度、
NICE は nice 値 (\-20 から 20 までの範囲)、
SIZE はプロセスサイズの合計 (text, data, stack)、
RES は現在のメモリ常駐量 (SIZE と RES はいずれもキロバイト単位)、
STATE は現在の状態 (\*(lqsleep\*(rq, \*(lqWAIT\*(rq, 
\*(lqrun\*(rq, \*(lqidl\*(rq, \*(lqzomb\*(rq, \*(lqstop\*(rq のいずれか)、
TIME はプロセスが消費したシステム時間およびユーザ時間の秒数、
WCPU は (もしあれば) 重み付き CPU パーセンテージ (これは
.IR ps (1)
が CPU として表示するものと同じ)、
CPU は生のパーセンテージで、プロセス順序を決めるソート処理に用いられるもの、
そして COMMAND はプロセスが現在実行しているコマンド名です (もしプロセスが
スワップアウト中なら、このカラムには \*(lq<swapped>\*(rq という印がつく)。
.SH 注意
\*(lqABANDONED\*(rq 状態 (カーネル中では \*(lqSWAIT\*(rq 状態として
知られています) は捨て去られたものゆえ、この名称がついています。
プロセスはこの状態で終るべきではありません。
.SH 作者
William LeFebvre, EECS Department, Northwestern University
.SH 環境変数
.DT
TOP	ユーザが設定できるオプションのデフォルト値
.SH 関連ファイル
.DT
/dev/kmem		カーネルメモリ
.br
/dev/mem		物理メモリ
.br
/etc/passwd		uid 値をユーザ名に変換するのに使用
.br
/kernel		システムイメージ
.SH バグ
.B \-I
のデフォルト値が もう一度変更されましたが、私を責めないで下さい。
.I top
が全プロセスを表示するわけではないことで大変多くの人が混乱したため、
バージョン 2 の頃と同様、デフォルトでアイドルプロセスも表示することに
決めました。
しかしこの動作に耐えられない人々のために、環境変数
.B TOP
に \*(lqデフォルト\*(rq オプションを設定しておく機能を
追加しました (オプションのセクションを参照)。
バージョン 3.0 が持っている振る舞いが必要な人は、環境変数
.B TOP
に値 \*(lq\-I\*(rq を設定するだけで OK です。
.PP
スワップされたプロセスに対するコマンド名は追跡すべきですが、
それを行うとプログラムの動作が遅くなるでしょう。
.PP
.IR ps (1)
と同様、
.I top
が更新情報を収集している間に事態が変化する可能性があります。
表示内容は現実に近い近似値に過ぎません。
.SH 関連項目
kill(1),
ps(1),
stty(1),
mem(4),
renice(8)
.SH FreeBSD に関する注釈

.SH メモリに関する説明
Mem: 9220K Active, 1032K Inact, 3284K Wired, 1MB Cache, 2M Buf, 1320K Free
Swap:   91M Total, 79M Free, 13% Inuse, 80K In, 104 K Out

.B K:
キロバイト。
.TP
.B M:
メガバイト。
.TP
.B %:
1/100。
.TP
.B Active:
アクティブなページ数。
.TP
.B Inact:
アクティブでないページ数。
.TP
.B Wired:
固定されているページ数。キャッシュされたファイルデータページを含む。
.TP
.B Cache:
VM レベルのディスクキャッシュに使用しているページ数。
.TP
.B Buf:
BIO レベルのディスクキャッシュに使用しているページ数。
.TP
.B Free: 
未使用ページ数。
.TP
.B Total: 
使用可能なスワップ合計。
.TP 
.B Free: 
未使用スワップ合計。
.TP 
.B Inuse: 
使用中スワップ。
.TP 
.B In: 
(直前の表示間隔において) スワップデバイスからページインしたページ数
.TP
.B Out: 
(直前の表示間隔において) スワップデバイスにページアウトしたページ数

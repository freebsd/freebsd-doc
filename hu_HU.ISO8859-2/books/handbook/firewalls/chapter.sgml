<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->

<!-- The FreeBSD Hungarian Documentation Project
     Translated by: PALI, Gabor <pgj@FreeBSD.org>
     %SOURCE%	en_US.ISO8859-1/books/handbook/firewalls/chapter.sgml
     %SRCID%	1.89
-->

<chapter id="firewalls" lang="hu">
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Joseph J.</firstname>
	<surname>Barbish</surname>
	<contrib>&Iacute;rta: </contrib>
      </author>
    </authorgroup>
    <authorgroup>
      <author>
	<firstname>Brad</firstname>
	<surname>Davis</surname>
	<contrib>SGML form&aacute;tum&uacute;ra alak&iacute;totta
	  &eacute;s aktualiz&aacute;lta: </contrib>
      </author>
    </authorgroup>
  </chapterinfo>

  <title>T&#251;zfalak</title>

  <indexterm><primary>t&#251;zfalak</primary></indexterm>

  <indexterm>
    <primary>biztons&aacute;g</primary>
    <secondary>t&#251;zfalak</secondary>
  </indexterm>

  <sect1 id="firewalls-intro">
    <title>Bevezet&eacute;s</title>

    <para>A t&#251;zfalakkal a rendszer&uuml;nk&ouml;n
      kereszt&uuml;lfoly&oacute; bej&ouml;v&#245; &eacute;s kimen&#245;
      forgalmat tudjuk sz&#251;rni.  A t&#251;zfalak egy vagy t&ouml;bb
      <quote>szab&aacute;lyrendszer</quote> alapj&aacute;n
      vizsg&aacute;lj&aacute;k az &eacute;ppen &eacute;rkez&#245; vagy
      t&aacute;voz&oacute; h&aacute;l&oacute;zati csomagokat, &eacute;s
      vagy tov&aacute;bbengedik ezeket vagy
      meg&aacute;ll&iacute;tj&aacute;k.  A t&#251;zfalak
      szab&aacute;lyai a csomagok egy vagy t&ouml;bb
      jellemz&#245;j&eacute;t veszik szem&uuml;gyre, amelyek lehetnek
      p&eacute;ld&aacute;ul a protokoll t&iacute;pusa, a forr&aacute;s
      vagy c&eacute;l h&aacute;l&oacute;zati c&iacute;me, esetleg a
      forr&aacute;s- vagy a c&eacute;lport.</para>

    <para>A t&#251;zfalak jelent&#245;s m&eacute;rt&eacute;kben
      k&eacute;pesek gyarap&iacute;tani egy g&eacute;p vagy egy
      h&aacute;l&oacute;zat v&eacute;delm&eacute;t.  Legink&aacute;bb a
      k&ouml;vetkez&#245;kre tudjuk felhaszn&aacute;lni:</para>

    <itemizedlist>
      <listitem>
	<para>A bels&#245; h&aacute;l&oacute;zatunkban fut&oacute;
	  alkalmaz&aacute;sok, szolg&aacute;ltat&aacute;sok,
	  g&eacute;pek megv&eacute;d&eacute;s&eacute;re &eacute;s
	  elszigetel&eacute;s&eacute;re az internetr&#245;l
	  &eacute;rkez&#245; nem k&iacute;v&aacute;nt forgalom
	  ellen</para>
      </listitem>

      <listitem>
	<para>A bels&#245; h&aacute;l&oacute;zatban lev&#245;
	  g&eacute;pek el&eacute;r&eacute;s&eacute;t tudjuk
	  korl&aacute;tozni vagy letiltani az interneten
	  el&eacute;rhet&#245; szolg&aacute;ltat&aacute;sok
	  fel&eacute;</para>
      </listitem>

      <listitem>
	<para>A h&aacute;l&oacute;zati c&iacute;mford&iacute;t&aacute;s
	  (Network Address Translation, <acronym>NAT</acronym>)
	  be&aacute;ll&iacute;t&aacute;s&aacute;hoz, ahol a bels&#245;
	  h&aacute;l&oacute;zatunk priv&aacute;t
	  <acronym>IP</acronym>-c&iacute;meket haszn&aacute;lnak
	  &eacute;s egy k&ouml;z&ouml;s kapcsolaton kereszt&uuml;l
	  &eacute;rik el az internetet (egyetlen
	  <acronym>IP</acronym>-c&iacute;mmel, vagy pedig automatikusan
	  kiosztott publikus c&iacute;mekkel).</para>
      </listitem>
    </itemizedlist>

    <para>A fejezet elolvas&aacute;sa sor&aacute;n
      megismerj&uuml;k:</para>

    <itemizedlist>
      <listitem>
	<para>hogyan adjuk meg helyesen a csomagok
	  sz&#251;r&eacute;s&eacute;t le&iacute;r&oacute;
	  szab&aacute;lyokat;</para>
      </listitem>

      <listitem>
	<para>a &os;-be &eacute;p&iacute;tett t&#251;zfalak k&ouml;zti
	  k&uuml;l&ouml;nbs&eacute;geket;</para>
      </listitem>

      <listitem>
	<para>hogyan &aacute;ll&iacute;tsuk be &eacute;s
	  haszn&aacute;ljuk az OpenBSD <application>PF</application>
	  t&#251;zfal&aacute;t;</para>
      </listitem>

      <listitem>
	<para>hogyan &aacute;ll&iacute;tsuk be &eacute;s
	  haszn&aacute;ljuk az <application>IPFILTER</application>
	  t&#251;zfalat;</para>
      </listitem>

      <listitem>
	<para>hogyan &aacute;ll&iacute;tsuk be &eacute;s
	  haszn&aacute;ljuk az <application>IPFW</application>
	  t&#251;zfalat.</para>
      </listitem>
    </itemizedlist>

    <para>A fejezet elolvas&aacute;sa el&#245;tt aj&aacute;nlott:</para>

    <itemizedlist>
      <listitem>
	<para>a &os;-hez &eacute;s az internethez k&ouml;t&#245;d&#245;
	  alapvet&#245; fogalmak ismerete.</para>
      </listitem>
    </itemizedlist>

  </sect1>

  <sect1 id="firewalls-concepts">
    <title>R&ouml;viden a t&#251;zfalakr&oacute;l</title>

    <indexterm>
      <primary>t&#251;zfalak</primary>
      <secondary>szab&aacute;lyrendszerei</secondary>
    </indexterm>

    <para>A t&#251;zfalak szab&aacute;lyrendszereit alapvet&#245;en
      k&eacute;tf&eacute;lek&eacute;ppen tudjuk
      &ouml;ssze&aacute;ll&iacute;tani: <quote>inkluz&iacute;v</quote>,
      vagyis megenged&#245;, illetve <quote>exkluz&iacute;v</quote>
      vagyis kiz&aacute;r&oacute; m&oacute;don.  Az exkluz&iacute;v
      t&#251;zfalak minden forgalmat &aacute;tengednek, amir&#245;l nem
      rendelkeznek a t&#251;zfal szab&aacute;lyai.  Az inkluz&iacute;v
      t&#251;zfalak ennek pontosan az ellenkez&#245;j&eacute;t teszik.
      Csak azt a forgalmat engedik &aacute;t, amir&#245;l van
      szab&aacute;ly &eacute;s minden m&aacute;st blokkolnak.</para>

    <para>Az inkluz&iacute;v t&#251;zfalak alkalmaz&aacute;s&aacute;val
      sokkal jobban kez&uuml;nkbentudjuk tartani a
      h&aacute;l&oacute;zatunk kimen&#245; forgalm&aacute;t,
      ez&eacute;rt legink&aacute;bb az internetes
      szolg&aacute;ltat&aacute;sokat futtat&oacute; rendszerek
      eset&eacute;ben bizonyulhat jobb v&aacute;laszt&aacute;snak.
      Emellett az internetr&#245;l a h&aacute;l&oacute;zatunk
      fel&eacute; ir&aacute;nyul&oacute; forgalmat is k&eacute;pes
      szab&aacute;lyozni.  Ekkor az egyetlen szab&aacute;lyra sem
      illeszked&#245; csomagokat egyszer&#251;en eldobjuk &eacute;s
      napl&oacute;zzuk.  Az inkluz&iacute;v t&#251;zfalak
      &aacute;ltal&aacute;ban biztons&aacute;gosabbak az exkluz&iacute;v
      t&iacute;pus&uacute; t&aacute;rsaikn&aacute;l, mivel
      eset&uuml;kben jelent&#245;s m&eacute;rt&eacute;kben visszaszorul
      a nem k&iacute;v&aacute;natos &aacute;tfoly&oacute;
      forgalom.</para>

    <note>
      <para>Hacsak nem emelj&uuml;k ki k&uuml;l&ouml;n, a fejezet
	tov&aacute;bbi r&eacute;sz&eacute;ben minden
	p&eacute;ldak&eacute;nt megadott szab&aacute;lyrendszer
	inkluz&iacute;v t&#251;zfalat hoz l&eacute;tre.</para>
    </note>

    <para>Ez a t&iacute;pus&uacute; v&eacute;delem m&eacute;g
      tov&aacute;bb fokozhat&oacute; az
      <quote>&aacute;llapottart&oacute; t&#251;zfalak</quote> (stateful
      firewall) haszn&aacute;lat&aacute;val.  Az ilyen
      t&iacute;pus&uacute; t&#251;zfalak szemmel tartj&aacute;k a rajtuk
      kereszt&uuml;l megnyitott kapcsolatokat, &eacute;s vagy csak a
      m&aacute;r meglev&#245; kapcsolathoz tartoz&oacute; forgalmat
      engedik &aacute;t vagy nyitnak egy &uacute;jat.  Az
      &aacute;llapottart&oacute; t&#251;zfalak h&aacute;tr&aacute;nya,
      hogy a <quote>Denial of Service</quote> (<acronym>DoS</acronym>)
      t&iacute;pus&uacute; t&aacute;mad&aacute;sokkal szemben sokkal
      s&eacute;r&uuml;l&eacute;kenyebbek olyan helyzetekben, amikor az
      &uacute;j kapcsolatok nagyon gyorsan j&ouml;nnek l&eacute;tre.  A
      legt&ouml;bb t&#251;zfal eset&eacute;ben azonban tudjuk
      vegy&iacute;teni az &aacute;llapottart&oacute; &eacute;s nem
      &aacute;llapottart&oacute; viselked&eacute;st, &eacute;s ezzel egy
      ide&aacute;lis be&aacute;ll&iacute;t&aacute;st
      kialak&iacute;tani.</para>

  </sect1>

  <sect1 id="firewalls-apps">
    <title>T&#251;zfalak</title>

    <para>A &os; alaprendszer&eacute;be h&aacute;rom
      k&uuml;l&ouml;nb&ouml;z&#245; t&#251;zfalat
      &eacute;p&iacute;tettek be, melyek a k&ouml;vetkez&#245;k: az
      <emphasis>IPFILTER</emphasis> (m&aacute;sik nev&eacute;n
      <acronym>IPF</acronym>), az <emphasis>IPFIREWALL</emphasis>
      (m&aacute;s n&eacute;ven <acronym>IPFW</acronym>) &eacute;s az
      <emphasis>OpenBSD csomagsz&#251;r&#245;je</emphasis> (Packet
      Filter, azaz <acronym>PF</acronym>).  A forgalom
      szab&aacute;lyoz&aacute;s&aacute;ra (vagyis alapvet&#245;en a
      s&aacute;vsz&eacute;less&eacute;g
      kihaszn&aacute;lts&aacute;g&aacute;nak
      vez&eacute;rl&eacute;s&eacute;re) a &os; k&eacute;t
      be&eacute;p&iacute;tett csomagot tartalmaz: ez az &man.altq.4;
      &eacute;s a &man.dummynet.4;.  &Aacute;ltal&aacute;ban a Dummynet
      az <acronym>IPFW</acronym>, m&iacute;g az <acronym>ALTQ</acronym>
      a <acronym>PF</acronym> partnere.  Az IPFILTER eset&eacute;ben
      maga az IPFILTER v&eacute;gzi a c&iacute;mford&iacute;t&aacute;st
      &eacute;s a sz&#251;r&eacute;st, a
      s&aacute;vsz&eacute;less&eacute;get pedig az
      <acronym>IPFW</acronym> a &man.dummynet.4;
      <emphasis>vagy</emphasis> a <acronym>PF</acronym> az
      <acronym>ALTQ</acronym> seg&iacute;ts&eacute;g&eacute;vel.  Az
      <acronym>IPFW</acronym> &eacute;s a <acronym>PF</acronym>
      szab&aacute;lyokkal rendelkezik a rendszer&uuml;nkbe
      &eacute;rkez&#245; vagy onnan t&aacute;voz&oacute;
      csomagokr&oacute;l, hab&aacute;r megold&aacute;saik teljesen
      m&aacute;shogy m&#251;k&ouml;dnek &eacute;s a szab&aacute;lyok
      megad&aacute;si m&oacute;dja is elt&eacute;r.</para>

    <para>A &os; az&eacute;rt tartalmaz egyszerre ennyif&eacute;le
      t&#251;zfalat, mert az emberek elv&aacute;r&aacute;sai &eacute;s
      ig&eacute;nyei elt&eacute;rnek.  Egyik&uuml;k sem tekinthet&#245;
      a legjobbnak.</para>

    <para>A szerz&#245; egy&eacute;bk&eacute;nt az IPFILTER
      megold&aacute;s&aacute;t r&eacute;szes&iacute;ti el&#245;nyben,
      mivel egy h&aacute;l&oacute;zati c&iacute;mford&iacute;t&aacute;st
      alkalmaz&oacute; k&ouml;rnyezetben sokkal k&ouml;nnyebb vele
      megfogalmazni az &aacute;llapottart&oacute; szab&aacute;lyokat,
      valamint tartalmaz egy be&eacute;p&iacute;tett FTP proxyt is,
      amivel &iacute;gy a kimen&#245; FTP kapcsolatok
      be&aacute;ll&iacute;t&aacute;sa m&eacute;g tov&aacute;bb
      egyszer&#251;s&ouml;dik.</para>

    <para>Mivel az &ouml;sszes t&#251;zfal a csomagok
      fejl&eacute;c&eacute;nek bizonyos mez&#245;inek alapj&aacute;n
      dolgozik, ez&eacute;rt a t&#251;zfal
      szab&aacute;lyrendszer&eacute;t megalkot&oacute; egy&eacute;nnek
      teljesen tiszt&aacute;ban kell lennie a <acronym>TCP/IP</acronym>
      m&#251;k&ouml;d&eacute;s&eacute;vel, tov&aacute;bb&aacute; azzal,
      hogy ezekben a mez&#245;kben milyen &eacute;rt&eacute;kek
      szerepelhetnek &eacute;s ezeket hogyan haszn&aacute;lj&aacute;k
      egy &aacute;tlagos kapcsolat alatt.  Ebben a t&eacute;m&aacute;ban
      a <ulink url="http://www.ipprimer.com/overview.cfm"></ulink>
      c&iacute;men tal&aacute;lhatunk egy remek ismertet&#245;t
      (angolul).</para>

  </sect1>

  <sect1 id="firewalls-pf">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>John</firstname>
	  <surname>Ferrell</surname>
	  <contrib>&Aacute;tn&eacute;zte &eacute;s
	    aktualiz&aacute;lta:</contrib>
	</author>
      </authorgroup>
    </sect1info>

    <title>Az OpenBSD csomagsz&#251;r&#245;je (PF) &eacute;s az
      <acronym>ALTQ</acronym></title>

    <indexterm>
      <primary>t&#251;zfalak</primary>
      <secondary>PF</secondary>
    </indexterm>

    <para>2003 j&uacute;lius&aacute;ban az OpenBSD <acronym>PF</acronym>
      n&eacute;ven ismert csomagsz&#251;r&#245;j&eacute;t
      &aacute;t&iacute;rt&aacute;k &os;-re &eacute;s
      el&eacute;rhet&#245;v&eacute; tett&eacute;k a &os;
      Portgy&#251;jtem&eacute;ny&eacute;nek r&eacute;szek&eacute;nt.  A
      <acronym>PF</acronym> programot be&eacute;p&iacute;tetten
      tartalmaz&oacute; els&#245; kiad&aacute;s pedig 2004
      november&eacute;ben a &os;&nbsp;5.3 volt.  A <acronym>PF</acronym>
      egy teljes, mindentud&oacute; t&#251;zfal, amely t&aacute;mogatja
      az &uacute;n.  <acronym>ALTQ</acronym> (Alternate Queuing, vagyis
      a <quote>v&aacute;lt&oacute;besorol&aacute;s</quote>)
      megold&aacute;st.  Az <acronym>ALTQ</acronym> lehet&#245;v&eacute;
      teszi a s&aacute;vsz&eacute;less&eacute;g
      korl&aacute;toz&aacute;s&aacute;t a szolg&aacute;ltat&aacute;s
      min&#245;s&eacute;ge (Quality of Service, <acronym>QoS</acronym>)
      alapj&aacute;n.</para>

   <para>Az OpenBSD Projekt kiv&aacute;l&oacute; munk&aacute;t
      v&eacute;gez a PF <ulink
	url="http://www.openbsd.org/faq/pf/">felhaszn&aacute;l&oacute;i
	&uacute;tmutat&oacute;j&aacute;nak</ulink>
      karbantart&aacute;s&aacute;val.  A k&eacute;zik&ouml;nyv ezen
      szakasza ez&eacute;rt els&#245;sorban azzal foglalkozik, hogyan
      kell a <acronym>PF</acronym>-et &os; alatt haszn&aacute;lni,
      mik&ouml;zben igyekszik egy &aacute;ltal&aacute;nos
      &ouml;sszefoglal&aacute;st adni a t&eacute;m&aacute;r&oacute;l.  A
      r&eacute;szletesebb inform&aacute;ci&oacute;kkal kapcsolatban
      azonban felt&eacute;tlen&uuml;l n&eacute;zz&uuml;k meg a
      felhaszn&aacute;l&oacute;i &uacute;tmutat&oacute;t.</para>

    <para>A <ulink url="http://pf4freebsd.love2party.net/"></ulink>
      c&iacute;men olvashatunk t&ouml;bbet arr&oacute;l (angolul), hogy
      a <acronym>PF</acronym>-et hogyan haszn&aacute;ljunk
      &os;-n.</para>

    <sect2>
      <title>A PF rendszermagmodul haszn&aacute;lata</title>

      <para>A &os;&nbsp;5.3 megjelen&eacute;se &oacute;ta a
	<acronym>PF</acronym> az alaprendszer r&eacute;sze mint
	fut&aacute;s k&ouml;zben bet&ouml;lthet&#245; rendszermagmodul.
	A rendszer indul&aacute;skor teh&aacute;t k&eacute;pes
	automatikusan bet&ouml;lteni, ha az &man.rc.conf.5;
	&aacute;llom&aacute;nyban megadjuk a
	<literal>pf_enable="YES"</literal> sort.  A
	<acronym>PF</acronym> modul azonban csak akkor fog
	m&#251;k&ouml;d&eacute;sbe l&eacute;pni, ha tal&aacute;l
	hozz&aacute;tartoz&oacute; szab&aacute;lyrendszert, amely
	alap&eacute;rtelmez&eacute;s szerint az
	<filename>/etc/pf.conf</filename> &aacute;llom&aacute;nyban
	tal&aacute;lhat&oacute;.  Amennyiben a <acronym>PF</acronym>
	szab&aacute;lyrendszere a mi eset&uuml;nkben m&aacute;shol
	tal&aacute;lhat&oacute;, akkor az <filename>rc.conf</filename>
	&aacute;llom&aacute;nyban ne felejts&uuml;k megadni a
	<literal>pf_rules="<replaceable>/el&eacute;r&eacute;si/&uacute;tvonal/pf.szab&aacute;lyok</replaceable>"</literal>
	sor haszn&aacute;lat&aacute;val.</para>

      <note>
	<para>A &os;&nbsp;7.0 kiad&aacute;ssal a minta
	  <filename>pf.conf</filename> &aacute;llom&aacute;ny az
	  <filename class="directory">/etc</filename>
	  k&ouml;nyvt&aacute;rb&oacute;l &aacute;tker&uuml;lt a
	  <filename class="directory">/usr/share/examples/pf</filename>
	  k&ouml;nyvt&aacute;rba.  A &os;&nbsp;7.0 el&#245;tti
	  kiad&aacute;sokban alap&eacute;rtelmez&eacute;s szerint
	  tal&aacute;lhat&oacute; egy <filename>pf.conf</filename>
	  &aacute;llom&aacute;ny az <filename
	  role="directory">/etc</filename>
	  k&ouml;nyvt&aacute;rban.</para>
      </note>

      <para>A <acronym>PF</acronym> modul parancssorb&oacute;l
	ak&aacute;r k&eacute;zzel is bet&ouml;lthet&#245;:</para>

      <screen>&prompt.root; <userinput>kldload pf.ko</userinput></screen>

      <para>A bet&ouml;lthet&#245; modul tartalmazza a &man.pflog.4;
	t&aacute;mogat&aacute;s&aacute;t, amely
	seg&iacute;ts&eacute;g&eacute;vel napl&oacute;zni is tudunk.
	Amennyiben a <acronym>PF</acronym> tov&aacute;bbi
	szolg&aacute;ltat&aacute;saira is sz&uuml;ks&eacute;g&uuml;nk
	lenne, akkor a <acronym>PF</acronym>
	t&aacute;mogat&aacute;s&aacute;t be kell
	&eacute;p&iacute;ten&uuml;nk a rendszermagba.</para>
    </sect2>

    <sect2>
      <title>A PF rendszermagbeli
	be&aacute;ll&iacute;t&aacute;sai</title>

      <indexterm>
	<primary>a rendszermag
	  be&aacute;ll&iacute;t&aacute;sai</primary>
	<secondary>device pf</secondary>
      </indexterm>

      <indexterm>
	<primary>a rendszermag
	  be&aacute;ll&iacute;t&aacute;sai</primary>
	<secondary>device pflog</secondary>
      </indexterm>

      <indexterm>
	<primary>a rendszermag
	  be&aacute;ll&iacute;t&aacute;sai</primary>
	<secondary>device pfsync</secondary>
      </indexterm>

      <para>Noha egy&aacute;ltal&aacute;n nem sz&uuml;ks&eacute;ges
	be&eacute;p&iacute;ten&uuml;nk a <acronym>PF</acronym>
	t&aacute;mogat&aacute;s&aacute;t a rendszermagba, abban az
	esetben m&eacute;gis sz&uuml;ks&eacute;g&uuml;nk lehet
	r&aacute;, amikor a <acronym>PF</acronym> olyan komolyabb
	lehet&#245;s&eacute;geit szeretn&eacute;nk kiakn&aacute;zni,
	amelyek m&aacute;r nem r&eacute;szei a modulnak.  Ilyen
	p&eacute;ld&aacute;ul a &man.pfsync.4;, amely a
	<acronym>PF</acronym> &aacute;ltal haszn&aacute;lt
	&aacute;llapott&aacute;bl&aacute;zatok bizonyos
	v&aacute;ltoz&aacute;sainak megjelen&iacute;t&eacute;s&eacute;re
	alkalmas pszeudoeszk&ouml;z.  A &man.carp.4;
	megold&aacute;s&aacute;val p&aacute;ros&iacute;tva &iacute;gy
	ak&aacute;r hibat&#251;r&#245; t&#251;zfalak is
	kialak&iacute;that&oacute;ak a <acronym>PF</acronym>-fel.  A
	<acronym>CARP</acronym> megold&aacute;s&aacute;r&oacute;l a
	k&eacute;zik&ouml;nyvben b&#245;vebb ismertet&eacute;st a <xref
	  linkend="carp"> ad.</para>

      <para>A <acronym>PF</acronym> rendszermag
	konfigur&aacute;ci&oacute;s be&aacute;ll&iacute;t&aacute;sai a
	<filename>/usr/src/sys/conf/NOTES</filename>
	&aacute;llom&aacute;nyban tal&aacute;lhat&oacute;ak:</para>

      <programlisting>device pf
device pflog
device pfsync</programlisting>

      <para>A <literal>device pf</literal>
	be&aacute;ll&iacute;t&aacute;s enged&eacute;lyezi a
	csomagsz&#251;r&#245; t&#251;zfalat (&man.pf.4;).</para>

      <para>A <literal>device pflog</literal> megad&aacute;s&aacute;val
	keletkezik egy &man.pflog.4; pszeudo h&aacute;l&oacute;zati
	eszk&ouml;z, amellyel egy &man.bpf.4; eszk&ouml;zre
	&eacute;rkez&#245; forgalmat tudunk napl&oacute;zni.
	Ezut&aacute;n a &man.pflogd.8; d&eacute;mon
	haszn&aacute;lhat&oacute; t&#245;le sz&aacute;rmaz&oacute;
	napl&oacute;zott adatok
	r&ouml;gz&iacute;t&eacute;s&eacute;re.</para>

      <para>A <literal>device pfsync</literal> enged&eacute;lyezi a
	&man.pfsync.4; pszeudo h&aacute;l&oacute;zati eszk&ouml;z
	l&eacute;trej&ouml;tt&eacute;t, amely az &uacute;n.
	<quote>&aacute;llapotv&aacute;lt&aacute;sok</quote>
	megfigyel&eacute;s&eacute;re alkalmas.</para>
    </sect2>

    <sect2>
      <title>Az <filename>rc.conf</filename> &aacute;llom&aacute;nyban
	el&eacute;rhet&#245; be&aacute;ll&iacute;t&aacute;sok</title>

      <para>A k&ouml;vetkez&#245; &man.rc.conf.5;
	be&aacute;ll&iacute;t&aacute;sok aktiv&aacute;lj&aacute;k a
	rendszerind&iacute;t&aacute;s sor&aacute;n a
	<acronym>PF</acronym> &eacute;s a &man.pflog.4;
	haszn&aacute;lat&aacute;t:</para>

      <programlisting>pf_enable="YES"                 # a PF enged&eacute;lyez&eacute;se (a modul bet&ouml;lt&eacute;se, ha kell)
pf_rules="/etc/pf.conf"         # a pf szab&aacute;lyait tartalmaz&oacute; &aacute;llom&aacute;ny
pf_flags=""                     # a pfctl ind&iacute;t&aacute;s&aacute;hoz sz&uuml;ks&eacute;ges tov&aacute;bbi param&eacute;terek
pflog_enable="YES"              # a pflogd(8) elind&iacute;t&aacute;sa
pflog_logfile="/var/log/pflog"  # hol tartsa a pflogd az napl&oacute;it
pflog_flags=""                  # a pflogd ind&iacute;t&aacute;s&aacute;hoz sz&uuml;ks&eacute;ges param&eacute;terek</programlisting>

      <para>Ha a t&#251;zfalunk m&ouml;g&ouml;tt egy helyi
	h&aacute;l&oacute;zat is megh&uacute;z&oacute;dik, akkor az ott
	lev&#245; g&eacute;pek sz&aacute;m&aacute;ra valamilyen
	m&oacute;don tudnunk kell tov&aacute;bb&iacute;tani a csomagokat
	vagy c&iacute;mford&iacute;t&aacute;st kell v&eacute;gezni,
	&iacute;gy ez is mindenk&eacute;ppen kelleni fog:</para>

      <programlisting>gateway_enable="YES"            # az &aacute;tj&aacute;r&oacute; funkci&oacute;k enged&eacute;lyez&eacute;se</programlisting>
    </sect2>

    <sect2>
      <title>A sz&#251;r&eacute;si szab&aacute;lyok
	megfogalmaz&aacute;sa</title>

      <para>A <acronym>PF</acronym> a be&aacute;ll&iacute;t&aacute;sait
	a &man.pf.conf.5; &aacute;llom&aacute;ny t&aacute;rolja (amely
	alap&eacute;rtelmez&eacute;s szerint az
	<filename>/etc/pf.conf</filename> helyen
	tal&aacute;lhat&oacute;), &eacute;s az ebben
	tal&aacute;lhat&oacute; szab&aacute;lyok alapj&aacute;n
	m&oacute;dos&iacute;tja, dobja el vagy &eacute;ppen engedi
	&aacute;t a csomagokat.  A &os; rendszer&uuml;nkben ehhez
	tal&aacute;lhatunk n&eacute;h&aacute;ny p&eacute;ld&aacute;t a
	<filename>/usr/share/examples/pf/</filename>
	k&ouml;nyvt&aacute;rban.  A <acronym>PF</acronym> &aacute;ltal
	haszn&aacute;lt szab&aacute;lyokr&oacute;l minden
	r&eacute;szletre kiterjed&#245;en a PF <ulink
	  url="http://www.openbsd.org/faq/pf/">felhaszn&aacute;l&oacute;i
	  &uacute;tmutat&oacute;j&aacute;ban</ulink> olvashatunk.</para>

      <warning>
	<para>A PF <ulink
	    url="http://www.openbsd.org/faq/pf/">felhaszn&aacute;l&oacute;i
	    &uacute;tmutat&oacute;j&aacute;nak</ulink>
	  olvas&aacute;sakor ne feledkezz&uuml;nk meg r&oacute;la, hogy
	  a k&uuml;l&ouml;nb&ouml;z&#245; &os; verzi&oacute;k
	  k&uuml;l&ouml;nb&ouml;z&#245; <acronym>PF</acronym>
	  verzi&oacute;kat tartalmaznak:</para>

	<itemizedlist>
	  <listitem>
	    <para>&os;&nbsp;5.<replaceable>X</replaceable> &mdash;
	      OpenBSD&nbsp;3.5 <acronym>PF</acronym></para>
	  </listitem>
	  <listitem>
	    <para>&os;&nbsp;6.<replaceable>X</replaceable> &mdash;
	      OpenBSD&nbsp;3.7 <acronym>PF</acronym></para>
	  </listitem>
	  <listitem>
	    <para>&os;&nbsp;7.<replaceable>X</replaceable> &mdash;
	      OpenBSD&nbsp;4.1 <acronym>PF</acronym></para>
	  </listitem>
	</itemizedlist>
      </warning>

      <para>A &a.pf; remek hely a <acronym>PF</acronym> t&#251;zfal
	be&aacute;ll&iacute;t&aacute;s&aacute;val &eacute;s
	futtat&aacute;s&aacute;val kapcsolatos k&eacute;rd&eacute;sekre.
	A k&eacute;rdez&eacute;s el&#245;tt azonban ne felejts&uuml;k el
	alaposan &aacute;tn&eacute;zni az arch&iacute;vumot!</para>
    </sect2>

    <sect2>
      <title>A PF haszn&aacute;lata</title>

      <para>A <acronym>PF</acronym> a &man.pfctl.8;
	seg&iacute;ts&eacute;g&eacute;vel vez&eacute;relhet&#245;.  Az
	al&aacute;bbiakban ezzel kapcsolatban most &ouml;sszefoglalunk
	n&eacute;h&aacute;ny hasznos parancsot (de ne felejts&uuml;k el
	megn&eacute;zni a &man.pfctl.8; man oldalon
	tal&aacute;lhat&oacute; t&ouml;bbi lehet&#245;s&eacute;get
	sem):</para>

      <informaltable frame="none" pgwide="1">
	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Parancs</entry>
	      <entry>Le&iacute;r&aacute;s</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><command>pfctl <option>-e</option></command></entry>
	      <entry>A PF enged&eacute;lyez&eacute;se</entry>
	    </row>

	    <row>
	      <entry><command>pfctl <option>-d</option></command></entry>
	      <entry>A PF tilt&aacute;sa</entry>
	    </row>

	    <row>
	      <entry><command>pfctl <option>-F</option> all <option>-f</option> /etc/pf.conf</command></entry>
	      <entry>Az &ouml;sszes (c&iacute;mford&iacute;t&aacute;si,
		sz&#251;r&eacute;si, &aacute;llapottart&aacute;si stb.)
		szab&aacute;ly t&ouml;rl&eacute;se, &eacute;s az
		<filename>/etc/pf.conf</filename> &aacute;llom&aacute;ny
		&uacute;jrat&ouml;lt&eacute;se</entry>
	    </row>

	    <row>
	      <entry><command>pfctl <option>-s</option> [ rules | nat | state ]</command></entry>
	      <entry>A sz&#251;r&eacute;si (<literal>rules</literal>),
		c&iacute;mford&iacute;t&aacute;si
		(<literal>nat</literal>) &eacute;s
		&aacute;llapottart&aacute;si (<literal>state</literal>)
		inform&aacute;ci&oacute;k
		lek&eacute;rdez&eacute;se</entry>
	    </row>

	    <row>
	      <entry><command>pfctl <option>-vnf</option> /etc/pf.conf</command></entry>
	      <entry>Az <filename>/etc/pf.conf</filename>
		&aacute;llom&aacute;ny ellen&#245;rz&eacute;se a benne
		lev&#245; szab&aacute;lyok bet&ouml;lt&eacute;se
		n&eacute;lk&uuml;l</entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>
    </sect2>

    <sect2>
      <title>Az <acronym>ALTQ</acronym>
	enged&eacute;lyez&eacute;se</title>

      <para>Az <acronym>ALTQ</acronym> kiz&aacute;r&oacute;lag csak
	&uacute;gy haszn&aacute;lhat&oacute;, ha a
	konfigur&aacute;ci&oacute;s be&aacute;ll&iacute;t&aacute;sokon
	kereszt&uuml;l be&eacute;p&iacute;tj&uuml;k a &os;
	rendszermagj&aacute;ba.  Az <acronym>ALTQ</acronym>
	alkalmaz&aacute;s&aacute;t nem minden h&aacute;l&oacute;zati
	k&aacute;rtya meghajt&oacute;ja t&aacute;mogatja, ez&eacute;rt
	ezt a &man.altq.4; man oldalon ellen&#245;rizz&uuml;k.</para>

      <para>A k&ouml;vetkez&#245; rendszermag
	konfigur&aacute;ci&oacute;s be&aacute;ll&iacute;t&aacute;sokkal
	enged&eacute;lyezhetj&uuml;k az <acronym>ALTQ</acronym>
	haszn&aacute;lat&aacute;t &eacute;s b&#245;v&iacute;thetj&uuml;k
	azt tov&aacute;bbi lehet&#245;s&eacute;gekkel:</para>

      <programlisting>options         ALTQ
options         ALTQ_CBQ        # oszt&aacute;lyoz&aacute;s alap&uacute; besorol&aacute;s (Class Bases Queuing, CBQ)
options         ALTQ_RED        # v&eacute;letlen korai &eacute;szlel&eacute;s (Random Early Detection, RED)
options         ALTQ_RIO        # RED befele/kifele
options         ALTQ_HFSC       # hiearchikus csomag&uuml;temez&#245; (Hierarchical Packet Scheduler, HFSC)
options         ALTQ_PRIQ       # priorit&aacute;sos besorol&aacute;s (Priority Queuing, PRIQ)
options         ALTQ_NOPCC      # az SMP eset&eacute;n kell</programlisting>

      <para>Az <literal>options ALTQ</literal> az
	<acronym>ALTQ</acronym> rendszert enged&eacute;lyezi.</para>

      <para>Az <literal>options ALTQ_CBQ</literal> enged&eacute;lyezi a
	oszt&aacute;lyoz&aacute;s alap&uacute; besorol&aacute;st
	(<emphasis>Class Based Queuing</emphasis>,
	<acronym>CBQ</acronym>).  A <acronym>CBQ</acronym>
	haszn&aacute;lat&aacute;val a kapcsolatunkhoz tartoz&oacute;
	s&aacute;vsz&eacute;less&eacute;get
	k&uuml;l&ouml;nb&ouml;z&#245; oszt&aacute;lyokra vagy sorokra
	tudjuk bontani &eacute;s a sz&#251;r&eacute;si
	szab&aacute;lyoknak megfelel&#245;en oszt&aacute;lyozni
	seg&iacute;ts&eacute;g&uuml;kkel a forgalmat.</para>

      <para>Az <literal>options ALTQ_RED</literal> a v&eacute;letlen
	korai &eacute;szlel&eacute;s (<emphasis>Random Early
	Detection</emphasis>, <acronym>RED</acronym>)
	haszn&aacute;lat&aacute;t enged&eacute;lyezi.  A
	<acronym>RED</acronym> a h&aacute;l&oacute;zati forgalomban
	keletkez&#245; torl&oacute;d&aacute;sok
	elker&uuml;l&eacute;s&eacute;re alkalmas.  A
	<acronym>RED</acronym> ezt a probl&eacute;m&aacute;t &uacute;gy
	oldja meg, hogy m&eacute;ri a sorok hossz&aacute;t &eacute;s
	&ouml;sszeveti a hozz&aacute;tartoz&oacute; minim&aacute;lis
	&eacute;s maxim&aacute;lis
	k&uuml;sz&ouml;b&eacute;rt&eacute;kekkel.  Ha a sor hossza
	meghaladja a sz&aacute;m&aacute;ra el&#245;&iacute;rt
	maxim&aacute;lis &eacute;rt&eacute;ket, akkor az &uacute;j
	csomagokat eldobja.  Nev&eacute;hez h&#251;en a
	<acronym>RED</acronym> az eldob&aacute;sra &iacute;t&eacute;lt
	csomagokat v&eacute;letlenszer&#251;en v&aacute;lasztja
	ki.</para>

      <para>Az <literal>options ALTQ_RIO</literal> enged&eacute;lyezi a
	<acronym>RED</acronym> haszn&aacute;lat&aacute;t mind a
	k&eacute;t ir&aacute;nyba, teh&aacute;t be- &eacute;s
	kifel&eacute;.</para>

      <para>Az <literal>options ALTQ_HFSC</literal> a p&aacute;rtatlan
	hierachikus szolg&aacute;ltat&aacute;si g&ouml;rbe alap&uacute;
	csomag&uuml;temez&#245;t (<emphasis>Hierarchical Fair Service
	Curve Packet Scheduler</emphasis>, <acronym>HFSC</acronym>)
	enged&eacute;lyezi.  Vele kapcsolatban a <ulink
	  url="http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html"></ulink>
	c&iacute;men tal&aacute;lhatunk b&#245;vebben
	olvasnival&oacute;t (angolul).</para>

      <para>Az <literal>options ALTQ_PRIQ</literal> a priorit&aacute;sos
	besorol&aacute;st (<emphasis>Priority Queuing</emphasis>,
	<acronym>PRIQ</acronym>) teszi el&eacute;rhet&#245;v&eacute;.  A
	<acronym>PRIQ</acronym> mindig els&#245;k&eacute;nt a nagyobb
	&eacute;rt&eacute;k&#251; sorban lev&#245; forgalmat
	tov&aacute;bb&iacute;tja.</para>

      <para>Az <literal>options ALTQ_NOPCC</literal> az
	<acronym>ALTQ</acronym> <acronym>SMP</acronym>, vagyis
	t&ouml;bbprocesszoros t&aacute;mogat&aacute;s&aacute;t adja meg.
	Ilyen t&iacute;pus&uacute; rendszerekben ez
	k&ouml;telez&#245;.</para>

    </sect2>
  </sect1>

  <sect1 id="firewalls-ipf">
    <title>Az IPFILTER (IPF) t&#251;zfal</title>

    <indexterm>
      <primary>t&#251;zfalak</primary>
      <secondary>IPFILTER</secondary>
    </indexterm>

    <para>Az IPFILTER szerz&#245;je Darren Reed.  Az IPFILTER nem
      k&ouml;t&#245;dik egyik rendszerhez sem: ez egy olyan ny&iacute;lt
      forr&aacute;sk&oacute;d&uacute; alkalmaz&aacute;s, amelyet
      &aacute;t&iacute;rtak &os;, NetBSD, OpenBSD, &sunos;, HP/UX
      &eacute;s &solaris; oper&aacute;ci&oacute;s rendszerekre.  Az
      IPFILTER karbantart&aacute;sa &eacute;s t&aacute;mogat&aacute;sa
      pillanatnyilag is akt&iacute;v, folyamatosan jelennek meg
      &uacute;jabb v&aacute;ltozatai.</para>

    <para>Az IPFILTER egy rendszermag oldal&aacute;n
      m&#251;k&ouml;d&#245; t&#251;zfalaz&aacute;si &eacute;s egy
      c&iacute;mford&iacute;t&aacute;si mechanizmusra alapszik, amelyet
      felhaszn&aacute;l&oacute;i programokkal tudunk fel&uuml;gyelni
      &eacute;s vez&eacute;relni.  A t&#251;zfal szab&aacute;lyai az
      &man.ipf.8; seg&eacute;dprogrammal
      &aacute;ll&iacute;that&oacute;ak be vagy
      t&ouml;r&ouml;lhet&#245;ek.  A h&aacute;l&oacute;zati
      c&iacute;mford&iacute;t&aacute;sra vonatkoz&oacute;
      szab&aacute;lyokat az &man.ipnat.1; seg&eacute;dprogrammal
      &aacute;ll&iacute;thatjuk be vagy t&ouml;r&ouml;lhetj&uuml;k.  Az
      &man.ipfstat.8; seg&eacute;dprogram k&eacute;pes fut&aacute;s
      k&ouml;zben statisztik&aacute;kat k&eacute;sz&iacute;teni az
      IPFILTER rendszermagban elhelyezked&#245; r&eacute;szeinek
      viselked&eacute;s&eacute;r&#245;l.  Az &man.ipmon.8; program pedig
      az IPFILTER cselekv&eacute;seit k&eacute;pes a
      rendszernapl&oacute;kba feljegyezni.</para>

    <para>Az IPF eredetileg olyan szab&aacute;lyfeldolgoz&aacute;si
      m&oacute;dszer szerint k&eacute;sz&uuml;lt, amelyben <quote>az
      utols&oacute; egyez&#245; szab&aacute;ly nyer</quote> &eacute;s
      csak &aacute;llapotn&eacute;lk&uuml;li szab&aacute;lyokat ismert.
      Az id&#245; m&uacute;l&aacute;s&aacute;val az IPF
      r&eacute;sz&eacute;v&eacute; v&aacute;lt a <quote>quick</quote>
      opci&oacute; &eacute;s a <quote>keep state</quote> opci&oacute;n
      kereszt&uuml;l az &aacute;llapottart&aacute;s is, melyek
      dr&aacute;mai m&eacute;rt&eacute;kben
      korszer&#251;s&iacute;tett&eacute;k a szab&aacute;lyok
      feldolgoz&aacute;s&aacute;nak elv&eacute;t.  Az IPF hivatalos
      dokument&aacute;ci&oacute;ja csak a r&eacute;gi szab&aacute;lyok
      l&eacute;trehoz&aacute;s&aacute;t &eacute;s azok
      feldolgoz&aacute;s&aacute;nak le&iacute;r&aacute;s&aacute;t
      tartalmazza.  A korszer&#251;s&iacute;tett funkci&oacute;k csak
      kieg&eacute;sz&iacute;t&eacute;sk&eacute;ppen jelennek meg,
      &eacute;s az &aacute;ltaluk felk&iacute;n&aacute;lt
      el&#245;ny&ouml;k meg&eacute;rt&eacute;se egy sokkal magasabb
      szint&#251; &eacute;s biztons&aacute;gosabb t&#251;zfal
      meg&eacute;p&iacute;t&eacute;s&eacute;t teszik
      lehet&#245;v&eacute;.</para>

    <para>A szakaszban szerepl&#245; utas&iacute;t&aacute;sokban olyan
      szab&aacute;lyok szerepelnek, amelyek kihaszn&aacute;lj&aacute;k a
      <quote>quick</quote> &eacute;s <quote>keep state</quote>
      opci&oacute;kat.  Ezek az inkluz&iacute;v
      t&#251;zfalszab&aacute;lyok l&eacute;trehoz&aacute;s&aacute;nak
      alapjai.</para>

    <para>A r&eacute;gi t&iacute;pus&uacute; szab&aacute;lyokr&oacute;l
      a <ulink
	url="http://www.obfuscation.org/ipf/ipf-howto.html#TOC_1"></ulink>
      &eacute;s <ulink
	url="http://coombs.anu.edu.au/~avalon/ip-filter.html"></ulink>
      c&iacute;meken olvashatunk (angolul).</para>

    <para>Az IPF gyakran ism&eacute;telt k&eacute;rd&eacute;sei a <ulink
	url="http://www.phildev.net/ipf/index.html"></ulink> c&iacute;men
      &eacute;rhet&#245;ek el (angolul).</para>

    <para>A ny&iacute;lt forr&aacute;s&uacute; IPFILTER
      levelez&eacute;si lista kereshet&#245; arch&iacute;vumait a <ulink
	url="http://marc.theaimsgroup.com/?l=ipfilter"></ulink>
      c&iacute;men tal&aacute;ljuk (angolul).</para>

    <sect2>
      <title>Az IPF enged&eacute;lyez&eacute;se</title>

      <indexterm>
	<primary>IPFILTER</primary>
	<secondary>enged&eacute;lyez&eacute;s</secondary>
      </indexterm>

      <para>Az IPF megtal&aacute;lhat&oacute; a &os;
	alaptelep&iacute;t&eacute;s&eacute;ben mint menet k&ouml;zben
	k&uuml;l&ouml;n bet&ouml;lthet&#245; modul.  Ha az
	<filename>rc.conf</filename> &aacute;llom&aacute;nyba
	be&iacute;rjuk a <literal>ipfilter_enable="YES"</literal> sort,
	akkor ez a modul dinamikusan bet&ouml;lt&#245;dik.  A
	bet&ouml;lthet&#245; modul alapb&oacute;l napl&oacute;z
	&eacute;s a <literal>default pass all</literal>
	be&aacute;ll&iacute;t&aacute;st tartalmazza.  Ha helyette a
	<literal>block all</literal> szab&aacute;lyt akarjuk
	haszn&aacute;lni, akkor emiatt m&eacute;g nem kell
	felt&eacute;tlen&uuml;l &uacute;jraford&iacute;tanunk a &os;
	rendszermagj&aacute;t, el&eacute;g ha egyszer&#251;en csak a
	szab&aacute;lyrendszer&uuml;nk v&eacute;g&eacute;re
	besz&uacute;rjuk.</para>

    </sect2>

    <sect2>
      <title>A rendszermag be&aacute;ll&iacute;t&aacute;sai</title>

      <indexterm>
	<primary>a rendszermag
	  be&aacute;ll&iacute;t&aacute;sai</primary>
	<secondary>IPFILTER</secondary>
      </indexterm>

      <indexterm>
	<primary>a rendszermag
	  be&aacute;ll&iacute;t&aacute;sai</primary>
	<secondary>IPFILTER_LOG</secondary>
      </indexterm>

      <indexterm>
	<primary>a rendszermag
	  be&aacute;ll&iacute;t&aacute;sai</primary>
	<secondary>IPFILTER_DEFAULT_BLOCK</secondary>
      </indexterm>

      <indexterm>
	<primary>IPFILTER</primary>
	<secondary>a rendszermag
	  be&aacute;ll&iacute;t&aacute;sai</secondary>
      </indexterm>

      <para>Az IPF haszn&aacute;lat&aacute;hoz nem k&ouml;telez&#245; a
	k&ouml;vetkez&#245; be&aacute;ll&iacute;t&aacute;sokkal
	&uacute;jraford&iacute;tani a &os; rendszermagj&aacute;t, itt
	csup&aacute;n
	h&aacute;tt&eacute;rinform&aacute;ci&oacute;k&eacute;nt
	szerepel.  Amikor az IPF a rendszermagba ker&uuml;l, a
	bet&ouml;lhet&#245; modulra nem lesz sz&uuml;ks&eacute;g.</para>

      <para>Az IPF a rendszermag forr&aacute;sai k&ouml;z&ouml;tt
	tal&aacute;lhat&oacute;
	<filename>/usr/src/sys/conf/NOTES</filename>
	&aacute;llom&aacute;nyban megadott
	be&aacute;ll&iacute;t&aacute;sai a k&ouml;vetkez&#245;
	m&oacute;don foglalhat&oacute;ak &ouml;ssze:</para>

      <programlisting>options IPFILTER
options IPFILTER_LOG
options IPFILTER_DEFAULT_BLOCK</programlisting>

      <para>Az <literal>options IPFILTER</literal> enged&eacute;lyezi az
	<quote>IPFILTER</quote> t&#251;zfal
	t&aacute;mogat&aacute;s&aacute;t.</para>

      <para>Az <literal>options IPFILTER_LOG</literal>
	hat&aacute;s&aacute;ra az IPF az <devicename>ipl</devicename>
	csomagnapl&oacute;z&oacute; pszeudo eszk&ouml;zre jegyzi fel a
	forgalmat &mdash; minden olyan szab&aacute;ly eset&eacute;n,
	ahol megjelenik a <literal>log</literal> kulcssz&oacute;.</para>

      <para>Az <literal>options IPFILTER_DEFAULT_BLOCK</literal>
	megv&aacute;ltoztatja az alap&eacute;rtelmezett
	viselked&eacute;st, teh&aacute;t minden olyan csomag, amely nem
	illeszkedik a t&#251;zfal valamelyik <literal>pass</literal>
	t&iacute;pus&uacute; (&aacute;tenged&#245;)
	szab&aacute;ly&aacute;ra, blokkol&aacute;sra ker&uuml;l.</para>

      <para>Ezek a be&aacute;ll&iacute;t&aacute;sok csak azt
	k&ouml;vet&#245;en &eacute;rv&eacute;nyes&uuml;lnek, ha
	ford&iacute;tottunk &eacute;s telep&iacute;tett&uuml;nk
	vel&uuml;k egy &uacute;j rendszermagot.</para>

    </sect2>

    <sect2>
      <title>Az <filename>rc.conf</filename> &aacute;llom&aacute;ny
	be&aacute;ll&iacute;t&aacute;sai</title>

      <para>Az <filename>/etc/rc.conf</filename>
	&aacute;llom&aacute;nyban a k&ouml;vetkez&#245;
	utas&iacute;t&aacute;sokra lesz sz&uuml;ks&eacute;g&uuml;nk az
	IPF m&#251;k&ouml;d&eacute;sbe hoz&aacute;s&aacute;ra a rendszer
	ind&iacute;t&aacute;sa sor&aacute;n:</para>

      <programlisting>ipfilter_enable="YES"             # az ipf t&#251;zfal ind&iacute;t&aacute;sa
ipfilter_rules="/etc/ipf.rules"   # bet&ouml;lti a szab&aacute;lyokat tartalmaz&oacute; sz&ouml;veges &aacute;llom&aacute;nyt
ipmon_enable="YES"                # elind&iacute;tja az IP monitor napl&oacute;z&aacute;s&aacute;t
ipmon_flags="-Ds"                 # D = ind&iacute;t&aacute;s d&eacute;monk&eacute;nt
                                  # s = napl&oacute;z&aacute;s a syslog haszn&aacute;lat&aacute;val
                                  # v = a tcp ablak, ack, seq csomagok napl&oacute;z&aacute;sa
                                  # n = az IP-c&iacute;mek &eacute;s portok felold&aacute;sa</programlisting>

      <para>Ha olyan helyi h&aacute;l&oacute;zat &aacute;ll meg a
	t&#251;zfal m&ouml;g&ouml;tt, amely egy fenntartott
	priv&aacute;t IP-c&iacute;mtartom&aacute;nyt haszn&aacute;l,
	akkor m&eacute;g a k&ouml;vetkez&#245;
	utas&iacute;t&aacute;sokra is sz&uuml;ks&eacute;g&uuml;nk lesz a
	c&iacute;mford&iacute;t&aacute;s
	bekapcsol&aacute;s&aacute;hoz:</para>

      <programlisting>gateway_enable="YES"              # a helyi h&aacute;l&oacute;zat &aacute;tj&aacute;r&oacute;ja
ipnat_enable="YES"                # az ipnat funkci&oacute; elind&iacute;t&aacute;sa
ipnat_rules="/etc/ipnat.rules"    # az ipnat m&#251;k&ouml;d&eacute;s&eacute;hez sz&uuml;ks&eacute;ges defin&iacute;ci&oacute;k</programlisting>

    </sect2>

    <sect2>
      <title>IPF</title>

      <indexterm><primary><command>ipf</command></primary></indexterm>

      <para>Az &man.ipf.8; parancs haszn&aacute;lhat&oacute; a
	szab&aacute;lyokat tartalmaz&oacute; &aacute;llom&aacute;ny
	bet&ouml;lt&eacute;s&eacute;re.  &Aacute;ltal&aacute;ban egy
	&aacute;llom&aacute;nyba &iacute;rjuk &ouml;ssze a t&#251;zfal
	szab&aacute;lyait &eacute;s ezzel a paranccsal
	cser&eacute;lj&uuml;k le egyszerre a t&#251;zfalban lev&#245;
	jelenlegi szab&aacute;lyokat:</para>

      <screen>&prompt.root; <userinput>ipf -Fa -f /etc/ipf.rules</userinput></screen>

      <para>Az <option>-Fa</option> az &ouml;sszes bels&#245;
	szab&aacute;ly t&ouml;rl&eacute;s&eacute;t jelenti.</para>

      <para>Az <option>-f</option> jelzi, hogy egy
	&aacute;llom&aacute;nyb&oacute;l kell beolvasni a
	bet&ouml;ltend&#245; szab&aacute;lyokat.</para>

      <para>Ezzel mintegy lehet&#245;s&eacute;g&uuml;nk van
	v&aacute;ltoztatni a kor&aacute;bban
	&ouml;ssze&aacute;ll&iacute;tott szab&aacute;lyainkon, futtatni
	a fenti IPF parancsot &eacute;s ezen kereszt&uuml;l &uacute;gy
	friss&iacute;teni a szab&aacute;lyok friss
	m&aacute;solat&aacute;val a m&aacute;r m&#251;k&ouml;d&#245;
	t&#251;zfalat, hogy nem is kell &uacute;jraind&iacute;tanunk a
	rendszert.  Ez a m&oacute;dszer igen k&eacute;nyelmes az
	&uacute;j szab&aacute;lyok
	kipr&oacute;b&aacute;l&aacute;s&aacute;hoz, mivel
	b&aacute;rmikor tetsz&#245;legesen
	v&eacute;grehajthat&oacute;.</para>

      <para>Az &man.ipf.8; man oldala tartalmazza a parancsnak
	megadhat&oacute; tov&aacute;bbi
	be&aacute;ll&iacute;t&aacute;sokat.</para>

      <para>Az &man.ipf.8; parancs a szab&aacute;lyokat
	t&aacute;rol&oacute; &aacute;llom&aacute;nyt egy
	szabv&aacute;nyos sz&ouml;veges &aacute;llom&aacute;nynak
	tekinti, semmilyen szimbolikus helyettes&iacute;t&eacute;st
	alkalmaz&oacute; szkriptet nem fogad el.</para>

      <para>Lehet&#245;s&eacute;g&uuml;nk van azonban olyan IPF
	szab&aacute;lyokat k&eacute;sz&iacute;teni, amelyek
	kiakn&aacute;zz&aacute;k a szkriptek szimbolikus
	helyettes&iacute;t&eacute;s&eacute;nek lehet&#245;s&eacute;geit.
	Err&#245;l b&#245;vebben l&aacute;sd <xref
	linkend="firewalls-ipf-rules-script">.</para>

    </sect2>

    <sect2>
      <title>Az IPFSTAT</title>

      <indexterm><primary><command>ipfstat</command></primary></indexterm>

      <indexterm>
	<primary>IPFILTER</primary>
	<secondary>statisztika</secondary>
      </indexterm>

      <para>Az &man.ipfstat.8; alap&eacute;rtelmez&eacute;s szerint a
	arra haszn&aacute;latos, hogy le tudjuk k&eacute;rdezni
	&eacute;s megjelen&iacute;teni a t&#251;zfalhoz tartoz&oacute;
	sz&aacute;ml&aacute;l&oacute;k &eacute;rt&eacute;keit, amelyek a
	legut&oacute;bbi ind&iacute;t&aacute;s vagy az <command>ipf
	-Z</command> parancs &aacute;ltal kiadott
	lenull&aacute;z&aacute;suk &oacute;ta a bej&ouml;v&#245; vagy
	kimen&#245; forgalomb&oacute;l a megadott szab&aacute;lyoknak
	megfelel&#245; csomagok alapj&aacute;n gy&#251;jtenek &ouml;ssze
	statisztik&aacute;kat.</para>

      <para>A parancs m&#251;k&ouml;d&eacute;s&eacute;nek
	r&eacute;szleteit az &man.ipfstat.8; man oldalon
	olvashatjuk.</para>

      <para>Az &man.ipfstat.8; megh&iacute;v&aacute;sa alapb&oacute;l
	&iacute;gy n&eacute;z ki:</para>

      <screen>input packets: blocked 99286 passed 1255609 nomatch 14686 counted 0
 output packets: blocked 4200 passed 1284345 nomatch 14687 counted 0
 input packets logged: blocked 99286 passed 0
 output packets logged: blocked 0 passed 0
 packets logged: input 0 output 0
 log failures: input 3898 output 0
 fragment state(in): kept 0 lost 0
 fragment state(out): kept 0 lost 0
 packet state(in): kept 169364 lost 0
 packet state(out): kept 431395 lost 0
 ICMP replies: 0 <acronym>TCP</acronym> RSTs sent: 0
 Result cache hits(in): 1215208 (out): 1098963
 IN Pullups succeeded: 2 failed: 0
 OUT Pullups succeeded: 0 failed: 0
 Fastroute successes: 0 failures: 0
 <acronym>TCP</acronym> cksum fails(in): 0 (out): 0
 Packet log flags set: (0)</screen>

      <para>Az <option>-i</option> mint bej&ouml;v&#245; (inbound), vagy
	az <option>-o</option> mint kimen&#245; (outbound) forgalomra
	vonatkoz&oacute; param&eacute;terek megad&aacute;s&aacute;val a
	rendszermagban az adott oldalon jelenleg telep&iacute;tett
	&eacute;s alkalmazott szab&aacute;lyokat k&eacute;rhetj&uuml;k
	le &eacute;s jelen&iacute;thetj&uuml;k meg.</para>

      <para>Az <command>ipfstat -in</command> parancs &iacute;gy a
	bej&ouml;v&#245; forgalomra vonatkoz&oacute; bels&#245;
	szab&aacute;lyokat mutatja a szab&aacute;lyok
	sz&aacute;m&aacute;val.</para>

      <para>Az <command>ipfstat -on</command> parancs a kimen&#245;
	forgalmat &eacute;rint&#245; bels&#245; szab&aacute;lyokat
	mutatja a szab&aacute;lyok sz&aacute;m&aacute;val.</para>

      <para>Az eredm&eacute;ny k&ouml;r&uuml;lbel&uuml;l ilyen
	lesz:</para>

      <screen>@1 pass out on xl0 from any to any
@2 block out on dc0 from any to any
@3 pass out quick on dc0 proto tcp/udp from any to any keep state</screen>

      <para>Az <command>ipfstat -ih</command> a bej&ouml;v&#245;
	forgalomhoz tartoz&oacute; bels&#245; szab&aacute;lyokat mutatja
	&eacute;s mindegyik el&eacute; oda&iacute;rja, hogy eddig mennyi
	csomag illeszkedett r&aacute;juk.</para>

      <para>Az <command>ipfstat -oh</command> ugyan&iacute;gy a
	kiment&#245; forgalom eset&eacute;n mutatja a bels&#245;
	szab&aacute;lyokat &eacute;s mindegyik el&#245;tt
	felt&uuml;nteti, hogy az adott pillanatig mennyi csomag
	illeszkedett r&aacute;juk.</para>

      <para>A kimenete nagyj&aacute;b&oacute;l ilyen lesz:</para>

      <screen>2451423 pass out on xl0 from any to any
354727 block out on dc0 from any to any
430918 pass out quick on dc0 proto tcp/udp from any to any keep state</screen>

      <para>Az <command>ipfstat</command> parancs tal&aacute;n egyik
	legfontosabb funkci&oacute;ja a <option>-t</option>
	kapcsol&oacute;val csalhat&oacute; el&#245;, melynek
	hat&aacute;s&aacute;ra a rendszerben akt&iacute;v
	&aacute;llapotok t&aacute;bl&aacute;zat&aacute;t mutatja meg
	ugyan&uacute;gy, ahogy a &man.top.1; a &os; rendszerben
	fut&oacute; programokat.  Amikor a t&#251;zfalunk
	t&aacute;mad&aacute;s alatt &aacute;ll, ezzel a
	funkci&oacute;val tudjuk a probl&eacute;m&aacute;t
	beazonos&iacute;tani, le&aacute;sni a m&eacute;ly&eacute;be
	&eacute;s l&aacute;tni a t&aacute;mad&oacute;t&oacute;l
	&eacute;rkez&#245; csomagokat.  A
	kieg&eacute;sz&iacute;t&eacute;sk&eacute;ppen megadhat&oacute;
	alkapcsol&oacute;k megad&aacute;s&aacute;val
	kiv&aacute;laszthatjuk azt a c&eacute;l vagy forr&aacute;s
	IP-c&iacute;met, portot vagy protokollt, amelyet val&oacute;s
	id&#245;ben meg akarunk figyelni.  Ennek r&eacute;szleteit az
	&man.ipfstat.8; man oldal&aacute;n l&aacute;thatjuk.</para>

    </sect2>

    <sect2>
      <title>Az IPMON</title>

      <indexterm><primary><command>ipmon</command></primary></indexterm>

      <indexterm>
	<primary>IPFILTER</primary>
	<secondary>napl&oacute;z&aacute;s</secondary>
      </indexterm>

      <para>Az <command>ipmon</command> megfelel&#245;
	m&#251;k&ouml;d&eacute;s&eacute;hez be kell kapcsolnunk a
	rendszermag <literal>IPFILTER_LOG</literal>
	be&aacute;ll&iacute;t&aacute;s&aacute;t.  Ez a parancs
	k&eacute;t k&uuml;l&ouml;nb&ouml;z&#245; m&oacute;dban
	haszn&aacute;lhat&oacute;.  Ha parancsot a <option>-D</option>
	opci&oacute; n&eacute;lk&uuml;l g&eacute;pelj&uuml;k be, akkor
	ezek k&ouml;z&uuml;l alapb&oacute;l a nat&iacute;v m&oacute;dot
	kapjuk meg.</para>

      <para>A d&eacute;mon m&oacute;d abban az esetben hasznos, ha
	folyamatosan napl&oacute;zni akarjuk a rendszerben zajl&oacute;
	esem&eacute;nyeket, majd k&eacute;s&#245;bb ezeket
	&aacute;tn&eacute;zni.  &Iacute;gy k&eacute;pes egym&aacute;ssal
	egy&uuml;ttm&#251;k&ouml;dni a &os; &eacute;s az IPFILTER.  A
	&os; be&eacute;p&iacute;tve tartalmaz olyan
	lehet&#245;s&eacute;get, aminek r&eacute;v&eacute;n
	mag&aacute;t&oacute;l cser&eacute;li a rendszernapl&oacute;kat.
	Ez&eacute;rt ha &aacute;tk&uuml;ldj&uuml;k a &man.syslogd.8;
	d&eacute;monnak a napl&oacute;zand&oacute; &uuml;zeneteket,
	akkor sokkal jobban j&aacute;runk, mintha egyszer&#251;en csak
	mezei &aacute;llom&aacute;nyba napl&oacute;zn&aacute;nk.  Az
	<filename>rc.conf</filename> alap&eacute;rtelmez&eacute;sei
	k&ouml;z&ouml;tt az <literal>ipmon_flags</literal>
	be&aacute;ll&iacute;t&aacute;s a <option>-Ds</option>
	kapcsol&oacute;kat r&ouml;gz&iacute;ti:</para>

      <programlisting>ipmon_flags="-Ds" # D = ind&iacute;t&aacute;s d&eacute;monk&eacute;nt
                  # s = napl&oacute;z&aacute;s a syslog haszn&aacute;lat&aacute;val
                  # v = a tcp ablak, ack, seq csomagok napl&oacute;z&aacute;sa
                  # n = az IP-c&iacute;mek &eacute;s portok nev&eacute;nek felold&aacute;sa</programlisting>

      <para>Ennek a viselked&eacute;snek az el&#245;nyei minden
	bizonnyal egy&eacute;rtelm&#251;ek.
	Seg&iacute;ts&eacute;g&eacute;vel k&eacute;pesek vagyunk az
	esetek megt&ouml;rt&eacute;nte ut&aacute;n
	&aacute;tn&eacute;zni, hogyan milyen csomagokat dobott el a
	rendszer, azok milyen c&iacute;mekr&#245;l &eacute;rkeztek
	&eacute;s hova sz&aacute;nt&aacute;k.  Ez egy komoly fegyver a
	t&aacute;mad&oacute;k lenyomoz&aacute;s&aacute;ban.</para>

      <para>Hi&aacute;ba enged&eacute;lyezz&uuml;k a
	napl&oacute;z&aacute;st, az IPF
	&ouml;nsz&aacute;nt&aacute;b&oacute;l semmilyen
	napl&oacute;z&aacute;si szab&aacute;lyt nem fog gy&aacute;rtani.
	A t&#251;zfal gazd&aacute;j&aacute;nak kell eld&ouml;ntenie,
	hogy a szab&aacute;lyokat k&ouml;z&uuml;l melyiket akarja
	napl&oacute;zni, &eacute;s &iacute;gy neki kell megadnia a
	<literal>log</literal> kulcssz&oacute;t ezekben az esetekben.
	Norm&aacute;lis esetben csak a <literal>deny</literal>
	szab&aacute;lyokat napl&oacute;zz&aacute;k.</para>

      <para>Egy&aacute;ltal&aacute;n nem ritka, hogy a
	szab&aacute;lyrendszer v&eacute;g&eacute;n egy
	alap&eacute;rtelmez&eacute;s szerint mindent eldob&oacute;
	szab&aacute;ly &aacute;ll, amely napl&oacute;z.  Ezzel
	lehet&#245;s&eacute;g&uuml;nk ny&iacute;lik
	r&ouml;gz&iacute;teni azokat a csomagokat, amelyek egyetlen
	szab&aacute;lyra sem illeszkedtek.</para>

    </sect2>

    <sect2>
      <title>Napl&oacute;z&aacute;s az IPMON
	haszn&aacute;lat&aacute;val</title>

      <para>A <application>syslogd</application> egy saj&aacute;t
	m&oacute;dszert alkalmaz a napl&oacute;zott adatok
	elk&uuml;l&ouml;n&iacute;t&eacute;s&eacute;re.  Egy
	<quote>funkci&oacute;k</quote> (facility) &eacute;s
	<quote>szintek</quote> (level) seg&iacute;ts&eacute;g&eacute;vel
	kialak&iacute;tott speci&aacute;lis csoportos&iacute;t&aacute;st
	alkalmaz.  Az IPMON <option>-Ds</option> m&oacute;dja a
	<literal>security</literal> (biztons&aacute;g)
	<quote>funkci&oacute;t</quote> haszn&aacute;lja.  Teh&aacute;t
	az IPMON &aacute;ltal napl&oacute;zott &ouml;sszes adat a
	<literal>security</literal> csoportj&aacute;ba ker&uuml;l.  Ezen
	t&uacute;l a k&ouml;vetkez&#245; szinteken
	k&uuml;l&ouml;n&iacute;thetj&uuml;k el ig&eacute;nyeinknek
	megfelel&#245;en a napl&oacute;zott adatokat:</para>

      <screen>LOG_INFO - az &aacute;tenged&eacute;s vagy blokkol&aacute;s helyett a "log" kulcssz&oacute;val ell&aacute;tott csomagok
LOG_NOTICE - az &aacute;t is engedett csomagok
LOG_WARNING - a blokkolt csomagok
LOG_ERR - a napl&oacute;zott csomagok k&ouml;z&uuml;l azok, amelyek t&uacute;ls&aacute;gosan kicsik (hib&aacute;s a fejl&eacute;c&uuml;k)</screen>

      <para>Az IPFILTER csak akkor tud napl&oacute;zni a
	<filename>/var/log/ipfilter.log</filename>
	&aacute;llom&aacute;nyba, ha el&#245;tte l&eacute;trehozzuk.  Az
	al&aacute;bbi parancs erre t&ouml;k&eacute;letesen
	megfelel&#245;:</para>

      <screen>&prompt.root; <userinput>touch /var/log/ipfilter.log</userinput></screen>

      <para>A &man.syslogd.8; m&#251;k&ouml;d&eacute;s&eacute;t az
	<filename>/etc/syslog.conf</filename> &aacute;llom&aacute;nyban
	szerepl&#245; defin&iacute;ci&oacute;k vez&eacute;rlik.  A
	<filename>syslog.conf</filename> &aacute;llom&aacute;ny
	sz&aacute;mottev&#245; m&eacute;rt&eacute;kben k&eacute;pes
	meghat&aacute;rozni azt, ahogy a
	<application>syslog</application> az IPF &eacute;s a
	hozz&aacute; hasonl&oacute; alkalmaz&aacute;sokt&oacute;l kapott
	rendszerszint&#251; &uuml;zeneteket kezeli.</para>

      <para>Az <filename>/etc/syslog.conf</filename>
	&aacute;llom&aacute;nyba az al&aacute;bbi sor kell
	felvenn&uuml;nk:</para>

      <programlisting>security.* /var/log/ipfilter.log</programlisting>

      <para>A <literal>security.*</literal> megad&aacute;s&aacute;val az
	&ouml;sszes ilyen t&iacute;pus&uacute; &uuml;zenet egy
	el&#245;re r&ouml;gz&iacute;tett helyre ker&uuml;l.</para>

      <para>Az <filename>/etc/syslog.conf</filename>
	&aacute;llom&aacute;nyban elv&eacute;gzett
	m&oacute;dos&iacute;t&aacute;sokat &uacute;gy
	l&eacute;ptethetj&uuml;k &eacute;rv&eacute;nybe, ha
	&uacute;jraind&iacute;tjuk a
	sz&aacute;m&iacute;t&oacute;g&eacute;pet vagy az
	<command>/etc/rc.d/syslogd reload</command> paranccsal
	megk&eacute;rj&uuml;k a &man.syslogd.8; d&eacute;mont, hogy
	olvassa &uacute;jra az <filename>/etc/syslog.conf</filename>
	&aacute;llom&aacute;nyt.</para>

      <para>Az im&eacute;nt l&eacute;trehozott napl&oacute;t ne
	felejts&uuml;k el megadni az
	<filename>/etc/newsyslog.conf</filename>
	&aacute;llom&aacute;nyban sem, &eacute;s akkor ezzel a
	cser&eacute;j&eacute;t is megoldjuk.</para>

    </sect2>

    <sect2>
      <title>A napl&oacute;zott &uuml;zenetek form&aacute;tuma</title>

      <para>Az <command>ipmon</command> &aacute;ltal l&eacute;trehozott
	&uuml;zenetek whitespace karakterekkel elv&aacute;lasztott
	adatmez&#245;kb&#245;l &aacute;llnak.  A k&ouml;vetkez&#245;
	mez&#245;k az &ouml;sszes &uuml;zenet eset&eacute;ben
	megjelennek:</para>

      <orderedlist>
	<listitem>
	  <para>A csomag meg&eacute;rkez&eacute;s&eacute;nek
	    d&aacute;tuma</para>
	</listitem>

	<listitem>
	  <para>A csomag meg&eacute;rkez&eacute;s&eacute;nek
	    id&#245;pontja.  &Oacute;&Oacute;:PP:MM.E alakban jelennek
	    meg az &oacute;r&aacute;k, percek, m&aacute;sodpercek
	    &eacute;s ezredm&aacute;sodpercek (ez t&ouml;bb
	    sz&aacute;mjegy hossz&uacute; is lehet) szerint</para>
	</listitem>

	<listitem>
	  <para>Azon interf&eacute;sz a neve, ahol a csomag
	    feldolgoz&aacute;sra ker&uuml;lt, p&eacute;ld&aacute;ul
	    <devicename>dc0</devicename></para>
	</listitem>

	<listitem>
	  <para>A szab&aacute;lyhoz tartoz&oacute; csoport &eacute;s
	    sorsz&aacute;m, p&eacute;ld&aacute;ul
	    <literal>@0:17</literal></para>
	</listitem>
      </orderedlist>

      <para>Ezek az <command>ipfstat -in</command> paranccsal
	n&eacute;zhet&#245;ek meg.</para>

      <orderedlist>
	<listitem>
	  <para>Cselekv&eacute;s: a p mint &aacute;tment (passed), b
	    mint blokkolt (blocked), S mint r&ouml;vid csomag (short
	    packet), n mint egyik szab&aacute;lyra sem illeszkedett (not
	    match), L mint napl&oacute;z&aacute;s (log).  A
	    m&oacute;dos&iacute;t&oacute;k
	    megjelen&iacute;t&eacute;s&eacute;nek sorrendje: S, p, b, n,
	    L.  A nagybet&#251;s P &eacute;s B azt jelzi, hogy a
	    csomagot egy fels&#245;bb szint&#251;
	    be&aacute;ll&iacute;t&aacute;s miatt
	    napl&oacute;zt&aacute;k, nem egy szab&aacute;ly
	    hat&aacute;s&aacute;ra.</para>
	</listitem>

	<listitem>
	  <para>C&iacute;mek: ez tulajdonk&eacute;ppen h&aacute;rom
	    mez&#245;t takar: a forr&aacute;s c&iacute;met &eacute;s
	    portot (melyet egy vessz&#245; v&aacute;laszt el), a -&gt;
	    jelet &eacute;s c&eacute;l c&iacute;met &eacute;s portot.
	    P&eacute;ld&aacute;ul: <literal>209.53.17.22,80 -&gt;
	    198.73.220.17,1722</literal>.</para>
	</listitem>

	<listitem>
	  <para>A <literal>PR</literal> ut&aacute;n a protokoll neve
	    vagy sz&aacute;ma olvashat&oacute;, p&eacute;ld&aacute;ul
	    <literal>PR tcp</literal>.</para>
	</listitem>

	<listitem>
	  <para>A <literal>len</literal> csomaghoz tartoz&oacute;
	    fejl&eacute;c &eacute;s t&ouml;rzs&eacute;nek teljes
	    hossz&aacute;t jel&ouml;li, p&eacute;ld&aacute;ul
	    <literal>len 20 40</literal>.</para>
	</listitem>
      </orderedlist>

      <para>Amennyiben a csomag <acronym>TCP</acronym>, egy
	k&ouml;t&#245;jellel kezd&#245;d&#245;en tov&aacute;bbi
	mez&#245;k is megjelenhetnek a be&aacute;ll&iacute;tott
	opci&oacute;knak megfelel&#245; bet&#251;k
	k&eacute;p&eacute;ben.  A bet&#251;ket &eacute;s
	be&aacute;ll&iacute;t&aacute;saikat az &man.ipmon.8; man
	oldal&aacute;n olvashatjuk.</para>

      <para>Amennyiben a csomag ICMP, a sort k&eacute;t mez&#245;
	z&aacute;rja, melyek k&ouml;z&uuml;l az els&#245; tartalma
	mindig <quote>ICMP</quote>, &eacute;s ezt egy perjellel
	elv&aacute;lasztva az ICMP &uuml;zenet t&iacute;pusa &eacute;s
	alt&iacute;pusa k&ouml;veti.  Teh&aacute;t p&eacute;ld&aacute;ul
	az ICMP 3/3 a <quote>nem el&eacute;rhet&#245; port</quote>
	&uuml;zenetet hordozza.</para>

    </sect2>

    <sect2 id="firewalls-ipf-rules-script">
      <title>A szab&aacute;lyok fel&iacute;r&aacute;sa szimbolikus
	helyettes&iacute;t&eacute;ssel</title>

      <para>Az IPF haszn&aacute;lat&aacute;ban gyakorlott
	felhaszn&aacute;l&oacute;k k&ouml;z&uuml;l
	n&eacute;h&aacute;nyan k&eacute;pesek olyan
	st&iacute;lus&uacute; szab&aacute;lyrendszert
	k&eacute;sz&iacute;teni, ahol szimbolikus
	helyettes&iacute;t&eacute;st haszn&aacute;lnak.  Ennek az egyik
	legnagyobb el&#245;nye az, hogy ilyenkor el&eacute;g csak a
	szimbolikus n&eacute;vhez tartoz&oacute; &eacute;rt&eacute;ket
	megv&aacute;ltoztatni &eacute;s amikor a szkript lefut, akkor az
	&ouml;sszes r&aacute; hivatkoz&oacute; szab&aacute;lyba ez
	ker&uuml;l be.  Szkript l&eacute;v&eacute;n a szimbolikus
	helyettes&iacute;t&eacute;ssel ki tudjuk emelni a gyakran
	haszn&aacute;lt &eacute;rt&eacute;keket &eacute;s
	behelyettes&iacute;teni ezeket t&ouml;bb helyre.  Ezt a most
	k&ouml;vetkez&#245; p&eacute;ld&aacute;ban
	l&aacute;thatjuk.</para>

      <para>Az itt alkalmazott fel&iacute;r&aacute;s kompatibilis az
	&man.sh.1;, &man.csh.1; &eacute;s &man.tcsh.1;
	parancs&eacute;rtelmez&#245;kkel.</para>

      <para>A szimbolikus helyettes&iacute;t&eacute;st egy
	doll&aacute;rjellel fejezz&uuml;k ki:
	<literal>&dollar;</literal>.</para>

      <para>A szimbolikus mez&#245;kben nem szerepel a &dollar;
	jel&ouml;l&eacute;s.</para>

      <para>A szimbolikus mez&#245; tartalm&aacute;t kett&#245;s
	id&eacute;z&#245;jelbe (<literal>"</literal>)
	tessz&uuml;k.</para>

      <para>Kezdj&uuml;k &iacute;gy el a szab&aacute;lyok
	&iacute;r&aacute;s&aacute;t:</para>

      <programlisting>######### Az IPF szab&aacute;lyait tartalmaz&oacute; szkript eleje ###########

oif="dc0"            # a kimen&#245; interf&eacute;sz neve
odns="192.0.2.11"    # az internet szolg&aacute;ltat&oacute; n&eacute;vszerver&eacute;nek IP-c&iacute;me
myip="192.0.2.7"     # a szolg&aacute;ltat&oacute;t&oacute;l kapott statikus IP-c&iacute;m&uuml;nk
ks="keep state"
fks="flags S keep state"

# V&aacute;laszthatunk, hogy az /etc/ipf.rules &aacute;llom&aacute;nyt ebb&#245;l a szkriptb&#245;l
# hozzuk l&eacute;tre vagy futtathatjuk "mag&aacute;t" a szkriptet.
#
# Egyszerre csak az egyik sort haszn&aacute;ljuk.
#
# 1) Ezzel gy&aacute;rhatjuk le az /etc/ipf.rules &aacute;llom&aacute;nyt:
#cat &gt; /etc/ipf.rules &lt;&lt; EOF
#
# 2) Ezzel futtathajuk "mag&aacute;t" a szkriptet:
/sbin/ipf -Fa -f - &lt;&lt; EOF

# Enged&eacute;lyezz&uuml;k a szolg&aacute;ltat&oacute; n&eacute;vszerver&eacute;nek el&eacute;r&eacute;s&eacute;t.
pass out quick on &dollar;oif proto tcp from any to &dollar;odns port = 53 &dollar;fks
pass out quick on &dollar;oif proto udp from any to &dollar;odns port = 53 &dollar;ks

# Enged&eacute;lyezz&uuml;k kifel&eacute; a titkos&iacute;tatlan www funkci&oacute;t.
pass out quick on &dollar;oif proto tcp from &dollar;myip to any port = 80 &dollar;fks

# Enged&eacute;lyezz&uuml;k kifel&eacute; a TLS SSL felett &uuml;zemel&#245; titkos&iacute;tott www funkci&oacute;t.
pass out quick on &dollar;oif proto tcp from &dollar;myip to any port = 443 &dollar;fks
EOF
################## Itt az IPF szkript v&eacute;ge ########################</programlisting>

      <para>Ennyi lenne.  A p&eacute;ld&aacute;ban szerepl&#245;
	szab&aacute;lyok most nem annyira l&eacute;nyegesek, a
	hangs&uacute;ly most igaz&aacute;b&oacute;l a szimbolikus
	helyettes&iacute;t&eacute;sen &eacute;s annak
	haszn&aacute;lat&aacute;n van.  Ha a fenti p&eacute;ld&aacute;t
	az <filename>/etc/ipf.rules.script</filename>
	&aacute;llom&aacute;nyba mentj&uuml;k, akkor ezeket a
	szab&aacute;lyokat a k&ouml;vetkez&#245; paranccsal &uacute;jra
	tudjuk t&ouml;lteni:</para>

      <screen>&prompt.root; <userinput>sh /etc/ipf.rules.script</userinput></screen>

      <para>Egyetlen apr&oacute;cska gond van a be&aacute;gyazott
	szimb&oacute;lumokat tartalmaz&oacute;
	&aacute;llom&aacute;nyokkal: az IPF maga nem k&eacute;pes
	meg&eacute;rteni a helyettes&iacute;t&eacute;seket, az&eacute;rt
	k&ouml;zvetlen&uuml;l nem olvassa a szkriptet.</para>

      <para>Ez a szkript k&eacute;t m&oacute;don
	hasznos&iacute;that&oacute;:</para>

      <itemizedlist>
	<listitem>
	  <para>Vegy&uuml;k ki megjegyz&eacute;sb&#245;l a
	    <literal>cat</literal> paranccsal kezd&#245;d&#245; sort,
	    &eacute;s tegy&uuml;k megjegyz&eacute;sbe az
	    <literal>/sbin/ipf</literal> kezdet&#251;t.  A megszokottak
	    szerint tegy&uuml;k az
	    <literal>ipfilter_enable="YES"</literal> sort az
	    <filename>/etc/rc.conf</filename> &aacute;llom&aacute;nyba,
	    majd minden egyes m&oacute;dos&iacute;t&aacute;sa
	    ut&aacute;n futtassuk le a szkriptet az
	    <filename>/etc/ipf.rules</filename> &aacute;llom&aacute;ny
	    l&eacute;trehoz&aacute;s&aacute;hoz vagy
	    friss&iacute;t&eacute;s&eacute;hez.</para>
	</listitem>

	<listitem>
	  <para>Tiltsuk le az IPFILTER aktiv&aacute;l&aacute;s&aacute;t
	    a rendszerind&iacute;t&aacute;skor, teh&aacute;t
	    &iacute;rjuk bele az <literal>ipfilter_enable="NO"</literal>
	    sort (ami mellesleg az alap&eacute;rtelmezett
	    &eacute;rt&eacute;ke) az <filename>/etc/rc.conf</filename>
	    &aacute;llom&aacute;nyba.</para>

	  <para>Tegy&uuml;nk egy, az al&aacute;bbi szkripthez
	    hasonl&oacute;t az <filename
	      class="directory">/usr/local/etc/rc.d/</filename>
	    k&ouml;nyvt&aacute;rba.  A szkriptnek adjuk valamilyen
	    &eacute;rtelmes nevet, p&eacute;ld&aacute;ul
	    <filename>ipf.loadrules.sh</filename>.  Az
	    <filename>.sh</filename> kiterjeszt&eacute;s
	    haszn&aacute;lata k&ouml;telez&#245;.</para>

	  <programlisting>#!/bin/sh
sh /etc/ipf.rules.script</programlisting>

	  <para>A szkript enged&eacute;lyeit &aacute;ll&iacute;tsuk be
	    &uacute;gy, hogy a <username>root</username>
	    tulajdon&aacute;ban legyen &eacute;s k&eacute;pes legyen
	    olvasni, &iacute;rni valamint v&eacute;grehajtani.</para>

	  <screen>&prompt.root; <userinput>chmod 700 /usr/local/etc/rc.d/ipf.loadrules.sh</userinput></screen>
	</listitem>
      </itemizedlist>

      <para>Most miut&aacute;n a rendszer elindult, az IPF
	szab&aacute;lyai be fognak t&ouml;lt&#245;dni.</para>

    </sect2>

    <sect2>
      <title>Szab&aacute;lyrendszerek az IPF-ben</title>

      <para>Az IPF eset&eacute;ben a szab&aacute;lyrendszer olyan
	szab&aacute;lyokb&oacute;l &aacute;ll, amelyek a
	csomagokr&oacute;l tartalmuk alapj&aacute;n eld&ouml;ntik, hogy
	&aacute;t kell engedni vagy vissza kell tartani.  A g&eacute;pek
	k&ouml;zt k&eacute;t ir&aacute;nyban &aacute;raml&oacute;
	csomagok egy munkamenet alap&uacute; t&aacute;rsalg&aacute;st
	k&eacute;peznek.  A t&#251;zfalhoz tartoz&oacute;
	szab&aacute;lyrendszer egyar&aacute;nt feldolgozza a
	internetr&#245;l a h&aacute;l&oacute;zatunk fel&eacute;
	igyekv&#245; csomagokat, illetve a h&aacute;l&oacute;zatunk
	ezekre adott v&aacute;laszait.  Az egyes
	<acronym>TCP/IP</acronym> szolg&aacute;ltat&aacute;sokat (mint
	p&eacute;ld&aacute;ul telnet, www, levelez&eacute;s stb.) a
	hozz&aacute;juk tartoz&oacute; protokol &eacute;s
	szabv&aacute;nyos (fogad&oacute;) portsz&aacute;m &iacute;rja
	le.  Ezekre a forr&aacute;sr&oacute;l &aacute;ltal&aacute;ban
	valamilyen nem szabv&aacute;nyos (magasabb
	&eacute;rt&eacute;k&#251;) portr&oacute;l &eacute;rkeznek
	csomagok.  Ekkor a kommunik&aacute;ci&oacute; &ouml;sszes
	param&eacute;tere (vagyis a portok &eacute;s c&iacute;mek)
	b&aacute;rmelyike alapj&aacute;n defini&aacute;lhatunk
	blokkol&aacute;st vagy tov&aacute;bbenged&eacute;st
	le&iacute;r&oacute; szab&aacute;lyokat.</para>

      <indexterm>
	<primary>IPFILTER</primary>
	<secondary>a szab&aacute;lyok feldolgoz&aacute;s&aacute;nak
	  sorrendje</secondary>
       </indexterm>

      <para>Az IPF eredetileg &uacute;gy &iacute;r&oacute;dott, hogy a
	szab&aacute;lyokat <quote>az utols&oacute; illeszked&#245;
	szab&aacute;ly nyer</quote> st&iacute;lusban dolgozza fel
	&eacute;s csak &aacute;llapot n&eacute;lk&uuml;li
	szab&aacute;lyokat ismert.  Az id&#245;k folyam&aacute;n az IPF
	szab&aacute;lyai kieg&eacute;sz&uuml;ltek a <quote>quick</quote>
	&eacute;s az &aacute;llapottart&aacute;sra vonatkoz&oacute;
	<quote>keep state</quote> opci&oacute;kkal, amelynek
	k&ouml;sz&ouml;nhet&#245;en &oacute;ri&aacute;si
	m&eacute;rt&eacute;kben korszer&#251;s&ouml;d&ouml;tt a
	szab&aacute;lyok feldolgoz&aacute;sa.</para>

      <para>A szakaszban szerepl&#245; utas&iacute;t&aacute;sok olyan
	szab&aacute;lyokat alkalmaznak, amelyekben egyar&aacute;nt
	szerepel a <quote>quick</quote> &eacute;s az
	&aacute;llapottart&aacute;s&eacute;rt felel&#245;s <quote>keep
	state</quote> be&aacute;ll&iacute;t&aacute;s.  Ez az
	inkluz&iacute;v t&#251;zfalak
	l&eacute;trehoz&aacute;s&aacute;nak egyik
	alapeszk&ouml;ze.</para>

      <warning>
	<para>A t&#251;zfal szab&aacute;lyainak
	  &ouml;ssze&aacute;ll&iacute;t&aacute;sa sor&aacute;n
	  <emphasis>nagyon &oacute;vatosnak</emphasis> kell
	  lenn&uuml;nk!  Bizonyos be&aacute;ll&iacute;t&aacute;sok
	  hat&aacute;s&aacute;ra ak&aacute;r <emphasis>ki is
	  z&aacute;rhatjuk magunkat</emphasis> a
	  szerver&uuml;nkr&#245;l.  Az ebb&#245;l fakad&oacute;
	  esetleges kellemetlens&eacute;gek elker&uuml;l&eacute;se
	  &eacute;rdek&eacute;ben javasoljuk, hogy a t&#251;zfal
	  alapjait el&#245;sz&ouml;r helyi konzolr&oacute;l
	  &eacute;p&iacute;ts&uuml;k fel, ne pedig
	  t&aacute;volr&oacute;l, p&eacute;ld&aacute;ul
	  <application>ssh</application>
	  seg&iacute;ts&eacute;g&eacute;vel.</para>
      </warning>

    </sect2>

    <sect2>
      <title>A szab&aacute;lyok fel&eacute;p&iacute;t&eacute;se</title>

      <indexterm>
	<primary>IPFILTER</primary>
	<secondary>a szab&aacute;lyok
	  fel&eacute;p&iacute;t&eacute;se</secondary>
      </indexterm>

      <para>A szab&aacute;lyok fel&eacute;p&iacute;t&eacute;s&eacute;nek
	bemutat&aacute;s&aacute;t itt most lesz&#251;k&iacute;tj&uuml;k
	a modern &aacute;llapottart&oacute; szab&aacute;lyokra &eacute;s
	az <quote>els&#245; illeszked&#245; szab&aacute;ly nyer</quote>
	t&iacute;pus&uacute; feldolgoz&aacute;sra.  A szab&aacute;lyok
	fel&iacute;r&aacute;s&aacute;nak r&eacute;gebbi m&oacute;djai az
	&man.ipf.8; man oldalon tal&aacute;lhat&oacute;ak.</para>

      <para>A <literal>#</literal> karakterrel egy megjegyz&eacute;s
	kezdet&eacute;t jelezz&uuml;k, &eacute;s &aacute;ltal&aacute;ban
	a sor v&eacute;g&eacute;n vagy egy k&uuml;l&ouml;n sorban bukkan
	fel.  Az &uuml;res sorokat a rendszer nem veszi
	figyelembe.</para>

      <para>A szab&aacute;lyok kulcsszavakat tartalmaznak.  Ezeknek a
	kulcsszavaknak balr&oacute;l jobbra haladva adott sorrendben
	kell szerepelni&uuml;k.  A kulcsszavakat kiemelt&uuml;k.  Egyes
	kulcsszavakhoz tov&aacute;bbi be&aacute;ll&iacute;t&aacute;sok
	is tartozhatnak, amelyek maguk is kulcsszavak lehetnek,
	&eacute;s m&eacute;g tov&aacute;bbi opci&oacute;kkal
	rendelkezhetnek.  Az al&aacute;bbi nyelvtan mindegyik
	elem&eacute;t kiemelt&uuml;k &eacute;s az al&aacute;bbiakban
	egyenk&eacute;nt kifejtj&uuml;k a r&eacute;szleteiket.</para>

      <para><replaceable>CSELEKV&Eacute;S BE-KI OPCI&Oacute;K
	SZ&#219;R&Eacute;S &Aacute;LLAPOTTART&Oacute; PROTOKOLL
	FORR&Aacute;S_C&Iacute;M,C&Eacute;L_C&Iacute;M OBJEKTUM
	PORTSZ&Aacute;M TCP_BE&Aacute;LL&Iacute;T&Aacute;S
	&Aacute;LLAPOTTART&Oacute;</replaceable></para>

      <para><replaceable>CSELEKV&Eacute;S</replaceable> = block |
	pass</para>

      <para><replaceable>BE-KI</replaceable> = in | out</para>

      <para><replaceable>OPCI&Oacute;K</replaceable> = log | quick | on
	<replaceable>interf&eacute;sz</replaceable></para>

      <para><replaceable>SZ&#219;R&Eacute;S</replaceable> = proto
	<replaceable>&eacute;rt&eacute;k</replaceable> |
	<replaceable>forr&aacute;s/c&eacute;l IP</replaceable> | port =
	<replaceable>sz&aacute;m</replaceable> | flags
	<replaceable>be&aacute;ll&iacute;t&aacute;s</replaceable></para>

      <para><replaceable>PROTOKOLL</replaceable> = tcp/udp | udp | tcp |
	icmp</para>

      <para><replaceable>FORR&Aacute;S_C&Iacute;M,C&Eacute;L_C&Iacute;M</replaceable>
	= all | from <replaceable>objektum</replaceable> to
	<replaceable>objektum</replaceable></para>

      <para><replaceable>OBJEKTUM</replaceable> =
	<replaceable>IP-c&iacute;m</replaceable> | any</para>

      <para><replaceable>PORTSZ&Aacute;M</replaceable> =
	<replaceable>portsz&aacute;m</replaceable></para>

      <para><replaceable>TCP_BE&Aacute;LL&Iacute;T&Aacute;S</replaceable>
	= S</para>

      <para><replaceable>&Aacute;LLAPOTTART&Oacute;</replaceable> = keep
	state</para>

      <sect3>
	<title>CSELEKV&Eacute;S</title>

	<para>A cselekv&eacute;s hat&aacute;rozza meg, hogy mit kell
	  tenni azokkal a csomagokkal, amelyek illeszkednek a
	  szab&aacute;ly t&ouml;bbi r&eacute;sz&eacute;re.  Minden
	  szab&aacute;lyhoz tartoznia <emphasis>kell</emphasis> egy
	  cselekv&eacute;snek.  A k&ouml;vetkez&#245; cselekv&eacute;sek
	  k&ouml;z&uuml;l v&aacute;laszthatunk:</para>

	<para>A <literal>block</literal> megad&aacute;s&aacute;val a
	  szab&aacute;lyban szerepl&#245; sz&#251;r&eacute;si
	  felt&eacute;telre illeszked&#245; csomagot eldobjuk.</para>

	<para>A <literal>pass</literal> megad&aacute;s&aacute;val a
	  szab&aacute;lyban szerepl&#245; sz&#251;r&eacute;si
	  felt&eacute;telre illeszked&#245; csomagot
	  &aacute;tengedj&uuml;k a t&#251;zfalon.</para>

      </sect3>

      <sect3>
	<title>BE-KI</title>

	<para>Az &ouml;sszes sz&#251;r&eacute;si szab&aacute;ly
	  eset&eacute;ben k&ouml;telez&#245; egy&eacute;rtelm&#251;en
	  nyilatkozunk arr&oacute;l, hogy a bemen&#245; vagy a
	  kimen&#245; forgalomra vonatkozik.  Ez&eacute;rt a
	  k&ouml;vetkez&#245; kulcssz&oacute; vagy az
	  <literal>in</literal> vagy pedig az <literal>out</literal>, de
	  k&ouml;z&uuml;l&uuml;k egyszerre csak az egyiket szabad
	  haszn&aacute;lni, m&aacute;sk&uuml;l&ouml;nben a
	  szab&aacute;ly hib&aacute;snak min&#245;s&uuml;l.</para>

	<para>Az <literal>in</literal> jelenti, hogy a szab&aacute;lyt
	  az internet fel&#245;l az adott interf&eacute;szen
	  be&eacute;rkez&#245; csomagokra kell alkalmazni.</para>

	<para>Az <literal>out</literal> jelenti, hogy a szab&aacute;lyt
	  az internet fel&eacute; az adott interf&eacute;szen
	  kik&uuml;ld&ouml;tt csomagokra kell alkalmazni.</para>
      </sect3>

      <sect3>
	<title>OPCI&Oacute;K</title>

	<note>
	  <para>Ezek az opci&oacute;k csak a lentebb bemutatott
	    sorrendben haszn&aacute;lhat&oacute;k.</para>
	</note>

	<para>A <literal>log</literal> jelzi, hogy illeszked&eacute;s
	  eset&eacute;n a csomag fejl&eacute;c&eacute;t az
	  <devicename>ipl</devicename> eszk&ouml;z&ouml;n kereszt&uuml;l
	  napl&oacute;zni kell (l&aacute;sd a
	  napl&oacute;z&aacute;sr&oacute;l sz&oacute;l&oacute;
	  szakaszt).</para>

	<para>A <literal>quick</literal>jelzi, hogy illeszked&eacute;s
	  eset&eacute;n ez lesz a legutols&oacute;nak
	  ellen&#245;rz&ouml;tt szab&aacute;ly &eacute;s &iacute;gy egy
	  olyan <quote>r&ouml;vidz&aacute;rat</quote> tudunk
	  k&eacute;pezni a feldolgoz&aacute;sban, amellyel
	  elker&uuml;lj&uuml;k a csomagra egy&eacute;bk&eacute;nt
	  vonatkoz&oacute; t&ouml;bbi szab&aacute;ly
	  illeszt&eacute;s&eacute;t.  Ez az opci&oacute; a
	  korszer&#251;s&iacute;tett szab&aacute;lyfeldolgoz&aacute;s
	  kihaszn&aacute;l&aacute;s&aacute;hoz elengedhetetlen.</para>

	<para>Az <literal>on</literal> haszn&aacute;lat&aacute;val a
	  sz&#251;r&eacute;s felt&eacute;telei k&ouml;z&eacute;
	  bevonhatjuk a csomaghoz tartoz&oacute; h&aacute;l&oacute;zati
	  interf&eacute;szt.  Itt az interf&eacute;szek az
	  &man.ifconfig.8; &aacute;ltal megjelen&iacute;tett
	  form&aacute;ban adhat&oacute;ak meg.  Az opci&oacute;
	  megad&aacute;s&aacute;val csak az adott interf&eacute;szen az
	  adott ir&aacute;nyba (befel&eacute;/kifel&eacute;)
	  k&ouml;zleked&#245; csomagokra fog illeszkedni a
	  szab&aacute;ly.  Ez az opci&oacute; a
	  korszer&#251;s&iacute;tett szab&aacute;lyfeldolgoz&aacute;s
	  kihaszn&aacute;l&aacute;s&aacute;hoz
	  n&eacute;lk&uuml;l&ouml;zhetetlen.</para>

	<para>Amikor napl&oacute;zunk egy csomagot, akkor a
	  hozz&aacute;tartoz&oacute; fejl&eacute;c az
	  <acronym>IPL</acronym> csomagnapl&oacute;z&oacute; pszeudo
	  eszk&ouml;zh&ouml;z ker&uuml;l.  A <literal>log</literal>
	  kulcssz&oacute; ut&aacute;n k&ouml;zvetlen&uuml;l a
	  k&ouml;vetkez&#245; min&#245;s&iacute;t&#245;k szerepelhetnek
	  (a k&ouml;vetkez&#245; sorrendben):</para>

	<para>A <literal>body</literal> jelzi, hogy a csomag
	  tartalm&aacute;nak els&#245; 128 byte-j&aacute;t m&eacute;g
	  jegyezz&uuml;k fel a fejl&eacute;c mell&eacute;.</para>

	<para>A <literal>first</literal> min&#245;s&iacute;t&#245;t
	  akkor &eacute;rdemes haszn&aacute;lnunk, amikor a
	  <literal>log</literal> kulcssz&oacute;t a <literal>keep
	  state</literal> opci&oacute;val egy&uuml;tt alkalmazzuk, mivel
	  ilyenkor csak a szab&aacute;lyt kialak&iacute;t&oacute; csomag
	  ker&uuml;l napl&oacute;z&aacute;sra &eacute;s nem minden
	  olyan, ami illeszkedik az &aacute;llapottart&aacute;si
	  felt&eacute;telekre.</para>
      </sect3>

      <sect3>
	<title>SZ&#219;R&Eacute;S</title>

	<para>Ebben a szakaszban olyan kulcsszavak jelenhetnek meg,
	  amelyekkel a csomagok k&uuml;l&ouml;nf&eacute;le
	  tulajdons&aacute;gai alapj&aacute;n
	  &iacute;t&eacute;lkezhet&uuml;nk azok
	  illeszked&eacute;s&eacute;r&#245;l.  Itt adott egy
	  kiindul&oacute; kulcssz&oacute;, amelyhez tov&aacute;bbi
	  kulcsszavak is tartoznak, &eacute;s amelyek k&ouml;z&uuml;l
	  csak egyet v&aacute;laszthatunk.  Az al&aacute;bbi
	  &aacute;ltal&aacute;nos tulajdons&aacute;gok alapj&aacute;n
	  tudjuk sz&#251;rni a csomagokat, ebben a sorrendben:</para>

      </sect3>

      <sect3>
	<title>PROTOKOLL</title>

	<para>A <literal>proto</literal> egy olyan kulcssz&oacute;,
	  amelyhez hozz&aacute; kell rendeln&uuml;nk m&eacute;g
	  valamelyik opci&oacute;j&aacute;t is.  Ez az opci&oacute;
	  seg&iacute;t az adott protokolloknak megfelel&#245;en
	  v&aacute;logatni a csomagok k&ouml;z&ouml;tt.  A
	  korszer&#251;s&iacute;tett szab&aacute;lyfeldolgoz&aacute;s
	  lehet&#245;s&eacute;geinek
	  kihaszn&aacute;l&aacute;s&aacute;hoz
	  n&eacute;lk&uuml;l&ouml;zhetetlen.</para>

	<para>Opci&oacute;k&eacute;nt a <literal>tcp/udp | udp | tcp |
	  icmp</literal>, vagy b&aacute;rmelyik, az
	  <filename>/etc/protocols</filename> &aacute;llom&aacute;nyban
	  megtal&aacute;lhat&oacute; kulcssz&oacute;
	  felhaszn&aacute;lhat&oacute;.  A <literal>tcp/udp</literal>
	  ebb&#245;l a szempontb&oacute;l speci&aacute;lisnak
	  tekinthet&#245;, mivel hat&aacute;s&aacute;ra egyszerre
	  illeszthet&#245;ek a szab&aacute;lyra a <acronym>TCP</acronym>
	  &eacute;s <acronym>UDP</acronym> csomagok, &eacute;s
	  &iacute;gy a protokollt&oacute;l eltekintve azonos
	  szab&aacute;lyok felesleges
	  t&ouml;bbsz&ouml;r&ouml;z&eacute;s&eacute;t
	  ker&uuml;lhetj&uuml;k el.</para>

      </sect3>

      <sect3>
	<title>FORR&Aacute;S_C&Iacute;M/C&Eacute;L_C&Iacute;M</title>

	<para>Az <literal>all</literal> kulcssz&oacute; gyakorlatilag a
	  <quote>from any to any</quote> (<quote>b&aacute;rhonnan
	  b&aacute;rhova</quote>) szinon&iacute;m&aacute;ja &eacute;s
	  nem tartozik hozz&aacute; param&eacute;ter.</para>

	<para>A <literal>from <replaceable>forr&aacute;s</replaceable>
	  to <replaceable>c&eacute;l</replaceable></literal>
	  fel&eacute;p&iacute;t&eacute;se: a <literal>from</literal>
	  &eacute;s <literal>to</literal> kulcsszavak az IP-c&iacute;mek
	  illeszt&eacute;s&eacute;re haszn&aacute;lhat&oacute;ak.
	  Ilyenkor a szab&aacute;lyokban a forr&aacute;s
	  <emphasis>&eacute;s</emphasis> a c&eacute;l
	  param&eacute;tereknek is szerepelni&uuml;k kell.  Az
	  <literal>any</literal> egy olyan speci&aacute;lis
	  kulcssz&oacute;, amely tetsz&#245;leges IP-c&iacute;mre
	  illeszkedik.  N&eacute;h&aacute;ny p&eacute;lda az
	  alkalmaz&aacute;s&aacute;ra: <literal>from any to
	  any</literal> vagy <literal>from 0.0.0.0/0 to any</literal>,
	  <literal>from any to 0.0.0.0/0</literal>, <literal>from
	  0.0.0.0/0 to any</literal> vagy <literal>from any to
	  0.0.0.0</literal>.</para>

	<para>Az IP-c&iacute;mek megadhat&oacute;ak pontozott numerikus
	  form&aacute;ban a h&aacute;l&oacute;zati maszk bitekben
	  m&eacute;rt hossz&aacute;val egy&uuml;tt, vagy ak&aacute;r
	  egyetlen pontozott numerikus IP-c&iacute;mk&eacute;nt.</para>

	<para>Nincs lehet&#245;s&eacute;g olyan
	  IP-c&iacute;mtartom&aacute;nyok illeszt&eacute;s&eacute;re,
	  amelyek nem adhat&oacute;ak meg k&eacute;nyelmesen ponttal
	  elv&aacute;lasztott sz&aacute;mok &eacute;s maszk
	  hossz&aacute;val.  A <filename
	    role="package">net-mgmt/ipcalc</filename> port az ilyen
	  sz&aacute;m&iacute;t&aacute;sokat k&ouml;nny&iacute;ti meg.  A
	  h&aacute;l&oacute;zati maszkok hossz&aacute;nak
	  meg&aacute;llap&iacute;t&aacute;sban seg&iacute;thet az
	  eml&iacute;tett seg&eacute;dprogram (angol nyelv&#251;)
	  honlapja: <ulink
	    url="http://jodies.de/ipcalc"></ulink>.</para>
      </sect3>

      <sect3>
	<title>PORT</title>

	<para>Amikor portra vonatkoz&oacute; illeszked&eacute;st
	  &iacute;runk el&#245;, megadhatjuk a forr&aacute;sra &eacute;s
	  c&eacute;lra, amit azt&aacute;n vagy csak
	  <acronym>TCP</acronym> vagy pedig csak <acronym>UDP</acronym>
	  csomagokra alkalmazunk.  A portok felt&eacute;teleinek
	  megfogalmaz&aacute;s&aacute;n&aacute;l haszn&aacute;lhatjuk a
	  portok sz&aacute;m&aacute;t vagy az
	  <filename>/etc/services</filename> &aacute;llom&aacute;nyban
	  szerepl&#245; nev&uuml;ket.  Amikor a port egy
	  <literal>from</literal> t&iacute;pus&uacute; objektum
	  le&iacute;r&aacute;s&aacute;ban jelenik meg, akkor
	  automatikusan a forr&aacute;sportot jelenti, m&iacute;g a
	  <literal>to</literal> objektum le&iacute;r&aacute;s&aacute;ban
	  pedig a c&eacute;lportot.  A <literal>to</literal>
	  objektumokn&aacute;l a port megad&aacute;sa elengedhetetlen a
	  korszer&#251;s&iacute;tett szab&aacute;lyfeldolgoz&aacute;s
	  el&#245;nyeinek kihaszn&aacute;l&aacute;s&aacute;hoz.
	  P&eacute;lda: <literal>from any to any port =
	  80</literal>.</para>

	<para>Az egyes portokat k&uuml;l&ouml;nb&ouml;z&#245;
	  m&#251;veletek seg&iacute;ts&eacute;g&eacute;vel, numerikusan
	  hasonl&iacute;thatjuk &ouml;ssze, ahol ak&aacute;r
	  porttartom&aacute;nyt is megadhatunk.</para>

	<para>port "=" | "!=" | "&lt;" | "&gt;" | "&lt;=" | "&gt;=" |
	  "eq" | "ne" | "lt" | "gt" | "le" | "ge".</para>

	<para>A porttartom&aacute;nyok megad&aacute;s&aacute;hoz
	  haszn&aacute;ljuk a <literal>port</literal> "&lt;&gt;" |
	  "&gt;&lt;" fel&iacute;r&aacute;si m&oacute;dot.</para>

	<warning>
	  <para>A forr&aacute;sra &eacute;s c&eacute;lra
	    vonatkoz&oacute; param&eacute;terek ut&aacute;n
	    szerepl&#245; m&aacute;sik k&eacute;t param&eacute;ter
	    n&eacute;lk&uuml;l&ouml;zhetetlen a
	    korszer&#251;s&iacute;tett szab&aacute;lyfeldolgoz&aacute;s
	    m&#251;k&ouml;d&eacute;s&eacute;hez.</para>
	</warning>
      </sect3>

      <sect3>
	<title><acronym>TCP</acronym>_BE&Aacute;LL&Iacute;T&Aacute;S</title>

	<para>A be&aacute;ll&iacute;t&aacute;sok csak a
	  <acronym>TCP</acronym> forgalom
	  sz&#251;r&eacute;s&eacute;n&eacute;l
	  &eacute;rv&eacute;nyes&uuml;lnek.  A bet&#251;k jel&ouml;lik
	  azokat a lehets&eacute;ges be&aacute;ll&iacute;t&aacute;sokat,
	  amelyek a <acronym>TCP</acronym> csomagok
	  fejl&eacute;c&eacute;ben
	  megvizsg&aacute;lhat&oacute;ak.</para>

	<para>A korszer&#251;s&iacute;tett
	  szab&aacute;lyfeldolgoz&aacute;s a <literal>flags S</literal>
	  param&eacute;ter seg&iacute;ts&eacute;g&eacute;vel ismeri fel
	  a <acronym>TCP</acronym> munkameneteket
	  kezdem&eacute;nyez&#245; k&eacute;r&eacute;seket.</para>

      </sect3>

      <sect3>
	<title>&Aacute;LLAPOTTART&Oacute;</title>

	<para>A <literal>keep state</literal> jelzi, hogy a
	  szab&aacute;ly param&eacute;tereinek megfelel&#245;
	  b&aacute;rmely csomag aktiv&aacute;lja az
	  &aacute;llapottart&oacute; sz&#251;r&eacute;s
	  haszn&aacute;lat&aacute;t.</para>

	<note>
	  <para>Ez a be&aacute;ll&iacute;t&aacute;s
	    felt&eacute;tlen&uuml;l sz&uuml;ks&eacute;ges a
	    korszer&#251;s&iacute;tett szab&aacute;lyfeldolgoz&aacute;s
	    megfelel&#245; kihaszn&aacute;l&aacute;s&aacute;hoz.</para>
	</note>

      </sect3>
    </sect2>

    <sect2>
      <title>&Aacute;llapottart&oacute; csomagsz&#251;r&eacute;s</title>

      <indexterm>
	<primary>IPFILTER</primary>
	<secondary>&aacute;llapottart&oacute;
	  sz&#251;r&eacute;s</secondary>
      </indexterm>

      <para>Az &aacute;llapottart&oacute; sz&#251;r&eacute;s a csomagok
	k&eacute;tir&aacute;ny&uacute; &aacute;raml&aacute;s&aacute;t
	egy l&eacute;trej&ouml;tt kapcsolatba sorolja be.  Amikor
	aktiv&aacute;l&oacute;dik, az &aacute;llapottart&oacute;
	szab&aacute;ly el&#245;re dinamikusan l&eacute;trehozza a
	k&eacute;tir&aacute;ny&uacute; kommunik&aacute;ci&oacute;ban
	megfordul&oacute; csomagokhoz a megfelel&#245; bels&#245;
	szab&aacute;lyokat.  Olyan vizsg&aacute;latokat v&eacute;gez,
	amelyek seg&iacute;ts&eacute;g&eacute;vel ki tudja
	der&iacute;teni, hogy a csomag k&uuml;ld&#245;je &eacute;s
	c&iacute;mzettje k&ouml;z&ouml;tt fenn&aacute;ll&oacute;
	k&eacute;tir&aacute;ny&uacute; kapcsolat &eacute;rv&eacute;nyes
	szab&aacute;lyok szerint zajlik-e.  Minden olyan csomagot, amely
	nem illeszkedik megfelel&#245;en a kapcsolatra vonatkoz&oacute;
	s&eacute;m&aacute;ra, csal&aacute;snak tekintj&uuml;k &eacute;s
	automatikusan eldobjuk.</para>

      <para>Az &aacute;llapottart&aacute;s r&eacute;v&eacute;n
	lehet&#245;s&eacute;g&uuml;nk van a <acronym>TCP</acronym> vagy
	<acronym>UDP</acronym> kapcsolatokhoz tartoz&oacute;
	<acronym>ICMP</acronym> csomagokat is &aacute;tengedni a
	t&#251;zfalon.  Teh&aacute;t ha kapunk egy 3-as
	t&iacute;pus&uacute;, 4-es k&oacute;d&uacute;
	<acronym>ICMP</acronym> v&aacute;laszt valamilyen
	b&ouml;ng&eacute;sz&eacute;sre haszn&aacute;lt
	&aacute;llapottart&oacute; szab&aacute;lyon kereszt&uuml;l
	kik&uuml;ld&ouml;tt k&eacute;r&eacute;sre, akkor az
	automatikusan bej&ouml;het.  Amelyik csomagot az IPF
	egy&eacute;rtelm&#251;en k&eacute;pes besorolni az akt&iacute;v
	kapcsolatba, m&eacute;g ha az elt&eacute;r&#245; protokollt is
	haszn&aacute;l, beengedi.</para>

      <para>Ami ilyenkor t&ouml;rt&eacute;nik:</para>

      <para>Az internethez csatlakoz&oacute; interf&eacute;szen
	kereszt&uuml;l kifel&eacute; halad&oacute; csomagokat
	el&#245;sz&ouml;r egy dinamikus &aacute;llapott&aacute;bla
	alapj&aacute;n illesztj&uuml;k, &eacute;s ha a csomag
	illeszkedik az akt&iacute;v kapcsolatban
	k&ouml;vetkez&#245;k&eacute;nt v&aacute;rt csomagra, akkor
	&aacute;tmegy a t&#251;zfalon &eacute;s a dinamikus
	&aacute;llapott&aacute;bl&aacute;ban friss&uuml;l a kapcsolat
	&aacute;llapota.  Az akt&iacute;v munkameneten k&iacute;v&uuml;l
	csomagok pedig egyszer&#251;en a kimen&#245;
	szab&aacute;lyrendszer szerint ker&uuml;lnek
	ellen&#245;rz&eacute;sre.</para>

      <para>Hasonl&oacute;an az el&#245;z&#245;h&ouml;z, az internethez
	csatlakoz&oacute; interf&eacute;szen kereszt&uuml;l
	befel&eacute; halad&oacute; csomagokat el&#245;sz&ouml;r egy
	dinamikus &aacute;llapott&aacute;bla alapj&aacute;n
	illesztj&uuml;k, &eacute;s ha a csomag illeszkedik az
	akt&iacute;v kapcsolatban k&ouml;vetkez&#245;k&eacute;nt
	v&aacute;rt csomagra, akkor &aacute;tmegy a t&#251;zfalon
	&eacute;s a dinamikus &aacute;llapott&aacute;bl&aacute;ban
	friss&uuml;l a kapcsolat &aacute;llapota.  Az akt&iacute;v
	munkamenethez nem tartoz&oacute; csomagok pedig egyszer&#251;en
	a bej&ouml;v&#245; szab&aacute;lyrendszer szerint ker&uuml;lnek
	ellen&#245;rz&eacute;sre.</para>

      <para>Amikor egy kapcsolat befejez&#245;dik, automatikusan
	t&ouml;rl&#245;dik a dinamikus
	&aacute;llapott&aacute;bl&aacute;b&oacute;l.</para>

      <para>Az &aacute;llapottart&oacute; csomagsz&#251;r&eacute;s
	haszn&aacute;lat&aacute;val az &uacute;jonnan keletkez&#245;
	kapcsolatok elutas&iacute;t&aacute;s&aacute;ra vagy
	enged&eacute;lyez&eacute;s&eacute;re tudunk koncentr&aacute;lni.
	Ha enged&eacute;lyezt&uuml;k egy &uacute;j kapcsolat
	l&eacute;trej&ouml;tt&eacute;t, akkor a
	r&aacute;k&ouml;vetkez&#245; &ouml;sszes t&ouml;bbi csomag
	automatikusan &aacute;tmegy a t&#251;zfalon &eacute;s minden
	m&aacute;s hamis csomag eldob&oacute;dik.  Ha tiltjuk az
	&uacute;j kapcsolatot, akkor egyetlen
	r&aacute;k&ouml;vetkez&#245; csomag sem juthat &aacute;t.  Az
	&aacute;llapottart&oacute; sz&#251;r&eacute;s &aacute;ltal
	felk&iacute;n&aacute;lt fejlett elemz&eacute;si
	lehet&#245;s&eacute;gek k&eacute;pesek v&eacute;delmet
	ny&uacute;jtani a behatol&oacute;k r&eacute;sz&eacute;r&#245;l
	alkalmazott megannyi k&uuml;l&ouml;nb&ouml;z&#245;
	t&aacute;mad&aacute;si m&oacute;dszer ellen.</para>
    </sect2>

    <sect2>
      <title>P&eacute;lda inkluz&iacute;v
	szab&aacute;lyrendszerre</title>

      <para>A most k&ouml;vetkez&#245; szab&aacute;lyrendszer arra mutat
	p&eacute;ld&aacute;t, hogyan programozzunk le egy nagyon
	biztons&aacute;gos inkluz&iacute;v t&#251;zfalat.  Az
	inkluz&iacute;v t&#251;zfalak csak a szab&aacute;lyainak
	megfelel&#245; szolg&aacute;ltat&aacute;sokat engedik
	kereszt&uuml;l, &eacute;s alap&eacute;rtelmez&eacute;s szerint
	minden m&aacute;st blokkolnak.  Egy h&aacute;l&oacute;zat
	g&eacute;peit v&eacute;d&#245; t&#251;zfalnak, amelyet gyakran
	<quote>h&aacute;l&oacute;zati t&#251;zfalnak</quote> (network
	firewall) is neveznek, legal&aacute;bb k&eacute;t
	h&aacute;l&oacute;zati interf&eacute;sszel kell rendelkeznie.
	Ezeket az interf&eacute;szeket &aacute;ltal&aacute;ban
	&uacute;gy &aacute;ll&iacute;tj&aacute;k be, hogy
	t&ouml;k&eacute;letesen megb&iacute;znak az egyik oldalban (a
	helyi h&aacute;l&oacute;zatban), a m&aacute;sikban (az
	internetben) pedig egy&aacute;ltal&aacute;n nem.  A
	t&#251;zfalat egy&eacute;bk&eacute;nt &uacute;gy is
	be&aacute;ll&iacute;thatjuk, hogy csak a t&#251;zfalat
	m&#251;k&ouml;dtet&#245; g&eacute;pet v&eacute;dje &mdash; ezt
	<quote>egyrendszeres t&#251;zfalnak</quote> (host based
	firewall) nevezik.  Az ilyen t&iacute;pus&uacute;
	megold&aacute;sokat nem biztons&aacute;gos
	h&aacute;l&oacute;zaton kereszt&uuml;l kommunik&aacute;l&oacute;
	szerverekn&eacute;l alkalmaznak.</para>

      <para>Mindegyik &unix;-t&iacute;pus&uacute; rendszert,
	k&ouml;zt&uuml;k a &os;-t is &uacute;gy
	alak&iacute;tott&aacute;k ki, hogy az oper&aacute;ci&oacute;s
	rendszeren bel&uuml;li kommunik&aacute;ci&oacute; az
	<devicename>lo0</devicename> interf&eacute;szen &eacute;s a
	<hostid role="ipaddr">127.0.0.1</hostid> IP-c&iacute;men
	kereszt&uuml;l t&ouml;rt&eacute;nik.  A t&#251;zfal
	szab&aacute;lyai k&ouml;z&ouml;tt felt&eacute;tlen&uuml;l
	szerepelni&uuml;k kell olyanoknak, amelyek lehet&#245;v&eacute;
	teszik ezen a speci&aacute;lis intef&eacute;szen a csomagok
	zavartalan mozg&aacute;s&aacute;t.</para>

      <para>Az internetre csatlakoz&oacute; interf&eacute;szhez kell
	rendelni a kifel&eacute; &eacute;s befel&eacute; halad&oacute;
	forgalom hiteles&iacute;t&eacute;s&eacute;t &eacute; a
	hozz&aacute;f&eacute;r&eacute;s&eacute;nek
	vez&eacute;rl&eacute;s&eacute;t.  Ez lehet a
	felhaszn&aacute;l&oacute;i PPP &aacute;ltal l&eacute;trehozott
	<devicename>tun0</devicename> interf&eacute;sz vagy a DSL-,
	illetve k&aacute;belmodemhez csatlakoz&oacute;
	h&aacute;l&oacute;zati k&aacute;rtya.</para>

      <para>Ahol egy vagy t&ouml;bb h&aacute;l&oacute;zati k&aacute;rtya
	is csatlakozik t&ouml;bb k&uuml;l&ouml;nb&ouml;z&#245; helyi
	h&aacute;l&oacute;zathoz, &uacute;gy kell
	be&aacute;ll&iacute;tani a hozz&aacute;juk tartoz&oacute;
	interf&eacute;szeket, hogy egym&aacute;s fel&eacute; &eacute;s
	az internet fel&eacute; k&eacute;pesek legyenek k&uuml;ldeni
	&eacute;s fogadni.</para>

      <para>A szab&aacute;lyokat el&#245;sz&ouml;r h&aacute;rom nagy
	csoportba kell szervezn&uuml;nk: el&#245;sz&ouml;r j&ouml;nnek a
	megb&iacute;zhat&oacute; interf&eacute;szek, ezeket k&ouml;vetik
	az internet fel&eacute; mutat&oacute; interf&eacute;szek,
	v&eacute;g&uuml;l internet fel&#245;l j&ouml;v&#245;, nem
	megb&iacute;zhat&oacute; interf&eacute;szeke.</para>

      <para>Az egyes csoportokban szerepl&#245; szab&aacute;lyokat
	&uacute;gy kell megadni, hogy k&ouml;z&uuml;l&uuml;k el&#245;re
	ker&uuml;ljenek a leggyakrabban alkalmazottak, &eacute;s a
	csoport utols&oacute; szab&aacute;lya blokkoljon &eacute;s
	napl&oacute;zzon minden csomagot az adott interf&eacute;szen
	&eacute;s ir&aacute;nyban.</para>

      <para>A kimen&#245; forgalomat vez&eacute;rl&#245;
	szab&aacute;lyrendszer csak <literal>pass</literal>
	(teh&aacute;t &aacute;tenged&#245;) szab&aacute;lyokat
	tartalmazhat, amelyek bentr&#245;l az interneten
	el&eacute;rhet&#245; szolg&aacute;ltat&aacute;sokat
	azonos&iacute;tj&aacute;k egy&eacute;rtelm&#251;en.  Az
	&ouml;sszes ilyen szab&aacute;lyban meg kell jelenni a
	<literal>quick</literal>, <literal>on</literal>,
	<literal>proto</literal>, <literal>port</literal> &eacute;s
	<literal>keep state</literal>
	be&aacute;ll&iacute;t&aacute;soknak.  A <literal>proto
	tcp</literal> szab&aacute;lyok eset&eacute;ben meg kell adni a
	<literal>flag</literal> opci&oacute;t is, amivel fel tudjuk
	ismertetni a kapcsolatok keletkez&eacute;s&eacute;t &eacute;s
	ezen kereszt&uuml;l aktiv&aacute;lni az
	&aacute;llapottart&aacute;st.</para>

      <para>A bej&ouml;v&#245; forgalmat vez&eacute;rl&#245;
	szab&aacute;lyrendszerben el&#245;sz&ouml;r az eldobni
	k&iacute;v&aacute;nt csomagokat kell megadni, aminek k&eacute;t
	elt&eacute;r&#245; oka van.  El&#245;sz&ouml;r is
	el&#245;fordulhat, hogy a vesz&eacute;lyes csomagok
	r&eacute;szleges illeszked&eacute;s miatt szab&aacute;lyosnak
	t&#251;nnek.  Az ilyen csomagokat &eacute;rtelemszer&#251;en nem
	lenne szabad beengedni a szab&aacute;lyok r&eacute;szleges
	megfelel&eacute;se alapj&aacute;n.  A m&aacute;sodszor az eleve
	ismerten probl&eacute;m&aacute;s &eacute;s &eacute;rtelmetlen
	csomagokat csendben el kellene vetni, miel&#245;tt a szakaszhoz
	tartoz&oacute; utols&oacute; szab&aacute;ly fogn&aacute; meg
	&eacute;s napl&oacute;zn&aacute;.  Ez az utols&oacute;
	szab&aacute;ly egy&eacute;bk&eacute;nt sz&uuml;ks&eacute;g
	eset&eacute;n felhaszn&aacute;lhat&oacute; a
	t&aacute;mad&oacute;k elleni bizony&iacute;t&eacute;kok
	begy&#251;jt&eacute;s&eacute;re.</para>

      <para>A m&aacute;sik, amire m&eacute;g oda kell figyeln&uuml;nk,
	hogy a blokkolt csomagok eset&eacute;ben semmilyen v&aacute;lasz
	nem keletkezzen, egyszer&#251;en csak t&#251;njenek el.
	&Iacute;gy a t&aacute;mad&oacute; nem fogja tudni, hogy a
	csomagjai vajon el&eacute;rt&eacute;k-e a rendszer&uuml;nket.
	Min&eacute;l kevesebb inform&aacute;ci&oacute;t tudnak
	&ouml;sszegy&#251;jteni a rendszer&uuml;nkr&#245;l a
	t&aacute;mad&oacute;k, ann&aacute;l t&ouml;bb id&#245;t kell
	sz&aacute;nniuk cs&iacute;nytev&eacute;seik
	kieszel&eacute;s&eacute;re.  A <literal>log first</literal>
	opci&oacute;t tartalmaz&oacute; szab&aacute;lyok csak az
	illeszked&eacute;sn&eacute;l fogj&aacute;k napl&oacute;zni a
	hozz&aacute;juk tartoz&oacute; esem&eacute;nyt.  Erre
	l&aacute;thatunk p&eacute;ld&aacute;t az <literal>nmap OS
	fingerprint</literal> szab&aacute;lyn&aacute;l.  Az <filename
	  role="package">security/nmap</filename> seg&eacute;dprogramot
	a t&aacute;mad&oacute;k gyakran alkalmazz&aacute;k a
	megt&aacute;madni k&iacute;v&aacute;nt szerver
	oper&aacute;ci&oacute;s rendszer&eacute;nek
	felder&iacute;t&eacute;s&eacute;re.</para>

      <para>Minden <literal>log first</literal> opci&oacute;val megadott
	szab&aacute;ly illeszked&eacute;s&eacute;n&eacute;l a
	<command>ipfstat -hio</command> parancs
	meghat&aacute;roz&oacute;dik az eddigi illeszked&eacute;sek
	aktu&aacute;lis sz&aacute;ma.  Nagyobb &eacute;rt&eacute;kek
	eset&eacute;ben k&ouml;vetkeztethet&uuml;nk arra, hogy a
	rendszer&uuml;nket megt&aacute;madt&aacute;k (vagyis csomagokkal
	&aacute;rasztj&aacute;k &eacute;ppen el).</para>

      <para>Az ismeretlen portsz&aacute;mok
	felder&iacute;t&eacute;s&eacute;re az
	<filename>/etc/services</filename> &aacute;llom&aacute;ny,
	esetleg a <ulink
	  url="http://www.securitystats.com/tools/portsearch.php"></ulink>
	(angol nyelv&#251;) honlap haszn&aacute;lhat&oacute;.</para>

      <para>&Eacute;rdemes tov&aacute;bb&aacute; megn&eacute;zni a
	tr&oacute;jai programok &aacute;ltal haszn&aacute;lt portokat a
	<ulink
	url="http://www.simovits.com/trojans/trojans.html"></ulink>
	c&iacute;men (angolul).</para>

      <para>A k&ouml;vetkez&#245; szab&aacute;lyrendszer egy olyan
	biztons&aacute;gos <quote>inkluz&iacute;v</quote>
	t&iacute;pus&uacute; t&#251;zfal, amelyet &eacute;les rendszeren
	is haszn&aacute;lnak.  Ezt a rendszer&uuml;nk&ouml;n nem
	haszn&aacute;lt szolg&aacute;ltat&aacute;sokra vonatkoz&oacute;
	<literal>pass</literal> szab&aacute;lyok
	t&ouml;rl&eacute;s&eacute;vel k&ouml;nnyed&eacute;n a
	saj&aacute;t ig&eacute;nyeink szerint
	alak&iacute;thatjuk.</para>

      <para>Ha nem akarunk l&aacute;tni bizonyos &uuml;zeneteket, akkor
	vegy&uuml;nk fel hozz&aacute;juk egy <literal>block</literal>
	t&iacute;pus&uacute; szab&aacute;lyt a befel&eacute;
	ir&aacute;nyul&oacute; forgalomhoz tartoz&oacute;
	szab&aacute;lyok k&ouml;z&eacute;.</para>

      <para>A szab&aacute;lyokban &iacute;rjuk &aacute;t a
	<devicename>dc0</devicename> interf&eacute;sz nev&eacute;t annak
	a h&aacute;l&oacute;zati k&aacute;rty&aacute;nak az
	interf&eacute;sz&eacute;re, amelyen kereszt&uuml;l csatlakozunk
	az internethez.  A felhaszn&aacute;l&oacute;i PPP
	eset&eacute;ben ez a <devicename>tun0</devicename> lesz.</para>

      <para>Teh&aacute;t a k&ouml;vetkez&#245;ket kell be&iacute;rni az
	<filename>/etc/ipf.rules</filename>
	&aacute;llom&aacute;nyba:</para>

      <programlisting>#################################################################
# A helyi h&aacute;l&oacute;zatunkon zajl&oacute; forgalmat ne korl&aacute;tozzuk.
# Csak akkor kell, ha helyi h&aacute;l&oacute;zathoz is csatlakozunk.
#################################################################

#pass out quick on xl0 all
#pass in quick on xl0 all

#################################################################
# A bels&#245; interf&eacute;szen szint&eacute;n ne korl&aacute;tozzunk semmit.
#################################################################
pass in quick on lo0 all
pass out quick on lo0 all

#################################################################
# Az internet fel&eacute; forgalmaz&oacute; interf&eacute;sz (kimen&#245; kapcsolatok)
# A saj&aacute;t h&aacute;l&oacute;zatunkr&oacute;l bel&uuml;lr&#245;l vagy err&#245;l az &aacute;tj&aacute;r&oacute;r&oacute;l
# kezdem&eacute;nyezett kapcsolatokat vizsg&aacute;ljuk az internet fel&eacute;.
#################################################################

# Enged&eacute;lyezz&uuml;k az internet szolg&aacute;ltat&oacute;k n&eacute;vszerver&eacute;nek el&eacute;r&eacute;s&eacute;t,
# az "xxx" helyett a n&eacute;vszervet IP-c&iacute;m&eacute;t kell megadni.
# M&aacute;soljuk le ezeket a sorokat, ha a szolg&aacute;ltat&oacute;nknak t&ouml;bb
# n&eacute;vszerver&eacute;t is beakarjuk &aacute;ll&iacute;tani. A c&iacute;meiket az /etc/resolv.conf
# &aacute;llom&aacute;nyban tal&aacute;ljuk.
pass out quick on dc0 proto tcp from any to xxx port = 53 flags S keep state
pass out quick on dc0 proto udp from any to xxx port = 53 keep state

# DSL vagy k&aacute;beles h&aacute;l&oacute;zatokn&aacute;l enged&eacute;lyezz&uuml;k a
# szolg&aacute;ltat&oacute;nk DHCP szerver&eacute;nek el&eacute;r&eacute;s&eacute;t.
# Ez a szab&aacute;ly nem kell, ha "felhaszn&aacute;l&oacute;i PPP"-vel
# kapcsol&oacute;dunk az internethez, ilyenkor teh&aacute;t az eg&eacute;sz
# csoport t&ouml;r&ouml;lhet&#245;.
# Haszn&aacute;ljuk az al&aacute;bbi szab&aacute;lyt &eacute;s keress&uuml;k meg a napl&oacute;ban az
# IP-c&iacute;met. Ha megtal&aacute;ltuk, akkor tegy&uuml;k bele a megjegyz&eacute;sben
# szerepl&#245; szab&aacute;lyba &eacute;s t&ouml;r&ouml;lj&uuml;k az els&#245; szab&aacute;lyt.
pass out log quick on dc0 proto udp from any to any port = 67 keep state
#pass out quick on dc0 proto udp from any to z.z.z.z port = 67 keep state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a szabv&aacute;nyos nem biztons&aacute;gos WWW funkci&oacute;kat.
pass out quick on dc0 proto tcp from any to any port = 80 flags S keep state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a biztons&aacute;gos WWW funkci&oacute;kat TLS SSL
# protokollal.
pass out quick on dc0 proto tcp from any to any port = 443 flags S keep state

# Kifel&eacute; enged&eacute;lyezz&uuml;k az e-mailek k&uuml;ld&eacute;s&eacute;t &eacute;s fogad&aacute;s&aacute;t.
pass out quick on dc0 proto tcp from any to any port = 110 flags S keep state
pass out quick on dc0 proto tcp from any to any port = 25 flags S keep state

# Kifel&eacute; enged&eacute;lyezz&uuml;k az id&#245; szolg&aacute;ltat&aacute;st.
pass out quick on dc0 proto tcp from any to any port = 37 flags S keep state

# Kifel&eacute; enged&eacute;lyezz&uuml;k az nntp h&iacute;reket.
pass out quick on dc0 proto tcp from any to any port = 119 flags S keep state

# Kifel&eacute; enged&eacute;lyezz&uuml;k az &aacute;tj&aacute;r&oacute;r&oacute;l &eacute;s a helyi h&aacute;l&oacute;zatr&oacute;l a nem
# biztons&aacute;gos FTP haszn&aacute;lat&aacute;t (passz&iacute;v &eacute;s ak&iacute;v m&oacute;dokban is). Ez a
# funkci&oacute; a m&#251;k&ouml;d&eacute;s&eacute;hez a nat szab&aacute;lyokat tartalmaz&oacute; &aacute;llom&aacute;nyban
# hivatkozott FTP proxyt haszn&aacute;lja. Amennyiben a pkg_add paranccsal
# csomagokat akarunk telep&iacute;teni az &aacute;tj&aacute;r&oacute;ra, erre a szab&aacute;lyra
# mindenk&eacute;ppen sz&uuml;ks&eacute;g&uuml;nk lesz.
pass out quick on dc0 proto tcp from any to any port = 21 flags S keep state

# Kifel&eacute; enged&eacute;lyezz&uuml;k az ssh/sftp/scp # (biztons&aacute;gos telnet/rlogin/FTP)
# szolg&aacute;ltat&aacute;sok # el&eacute;r&eacute;s&eacute;t az SSH (secure shell) haszn&aacute;lat&aacute;val.
pass out quick on dc0 proto tcp from any to any port = 22 flags S keep state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a nem biztons&aacute;gos telnet el&eacute;r&eacute;s&eacute;t.
pass out quick on dc0 proto tcp from any to any port = 23 flags S keep state

# Kifel&eacute; enged&eacute;lyezz&uuml;k FreeBSD CVSUp funkci&oacute;j&aacute;t.
pass out quick on dc0 proto tcp from any to any port = 5999 flags S keep state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a pinget.
pass out quick on dc0 proto icmp from any to any icmp-type 8 keep state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a helyi h&aacute;l&oacute;zatr&oacute;l &eacute;rkez&#245; whois k&eacute;r&eacute;seket.
pass out quick on dc0 proto tcp from any to any port = 43 flags S keep state

# Minden m&aacute;st eldobunk &eacute;s napl&oacute;zzuk az els&#245; el&#245;fordul&aacute;sukat.
# Ez a szab&aacute;ly blokkol alap&eacute;rtelmez&eacute;s szerint mindent.
block out log first quick on dc0 all

#################################################################
# Az internet fel&#245;li interf&eacute;sz (bej&ouml;v&#245; kapcsolatok)
# A saj&aacute;t h&aacute;l&oacute;zatunk fel&eacute; vagy erre az &aacute;tj&aacute;r&oacute;ra
# nyitott kapcsolatokat vizsg&aacute;ljuk az internet fel&#245;l.
#################################################################

# Eldobjuk az &ouml;sszes olyan bej&ouml;v&#245; forgalmat, amit hivatalosan nem
# lehetne tov&aacute;bb&iacute;tani vagy fenntartott c&iacute;mter&uuml;lethez tartozik.
block in quick on dc0 from 192.168.0.0/16 to any    #RFC 1918: priv&aacute;t IP
block in quick on dc0 from 172.16.0.0/12 to any     #RFC 1918: priv&aacute;t IP
block in quick on dc0 from 10.0.0.0/8 to any        #RFC 1918: priv&aacute;t IP
block in quick on dc0 from 127.0.0.0/8 to any       #helyi
block in quick on dc0 from 0.0.0.0/8 to any         #helyi
block in quick on dc0 from 169.254.0.0/16 to any    #DHCP
block in quick on dc0 from 192.0.2.0/24 to any      #dokument&aacute;ci&oacute;s c&eacute;lokra fenntartva
block in quick on dc0 from 204.152.64.0/23 to any   #Sun klaszterek &ouml;sszek&ouml;t&eacute;s&eacute;re haszn&aacute;lt
block in quick on dc0 from 224.0.0.0/3 to any       #D &eacute;s E oszt&aacute;ly&uacute; multicast

##### Itt eldobunk egy rak&aacute;s cs&uacute;f dolgot ############
# Ezeket nem akarjuk a napl&oacute;ban l&aacute;tni:

# Eldobjuk a t&ouml;red&eacute;kcsomagokat.
block in quick on dc0 all with frags

# Eldobjuk a t&uacute;ls&aacute;gosan r&ouml;vid TCP csomagokat.
block in quick on dc0 proto tcp all with short

# Eldobjuk a forr&aacute;s &aacute;ltal k&ouml;zvet&iacute;tett (source routed) csomagokat.
block in quick on dc0 all with opt lsrr
block in quick on dc0 all with opt ssrr

# Elutas&iacute;tjuk az "OS fingerprint" k&eacute;r&eacute;seket.
# Napl&oacute;zzuk az els&#245; el&#245;fordul&aacute;st, &iacute;gy n&aacute;lunk lesz a k&iacute;v&aacute;ncsiskod&oacute;
# egy&eacute;n IP-c&iacute;me.
block in log first quick on dc0 proto tcp from any to any flags FUP

# Eldobunk mindent, aminek speci&aacute;lis be&aacute;ll&iacute;t&aacute;sai vannak.
block in quick on dc0 all with ipopts

# Elutas&iacute;tjuk a publikus pinget.
block in quick on dc0 proto icmp all icmp-type 8

# Elutas&iacute;tjuk az ident k&eacute;r&eacute;seket.
block in quick on dc0 proto tcp from any to any port = 113

# Blokkoljuk az &ouml;sszes Netbios szolg&aacute;ltat&aacute;st: 137=n&eacute;v, 138=datagram,
# 139=session. A Netbios az MS Windows megoszt&aacute;s&aacute;t implement&aacute;lja.
# Blokkoljuk az MS Windows hosts2 n&eacute;vszerver k&eacute;r&eacute;seit is a 81-es
# porton.
block in log first quick on dc0 proto tcp/udp from any to any port = 137
block in log first quick on dc0 proto tcp/udp from any to any port = 138
block in log first quick on dc0 proto tcp/udp from any to any port = 139
block in log first quick on dc0 proto tcp/udp from any to any port = 81

# Enged&eacute;lyezz&uuml;k a szolg&aacute;ltat&oacute;nk DHCP szerver&eacute;t&#245;l &eacute;rkez&#245; forgalmat.
# Ebben a szab&aacute;lyban meg kell adnunk a szolg&aacute;ltat&oacute; DHCP szerver&eacute;nek
# IP-c&iacute;m&eacute;t, mivel itt csak a hiteles forr&aacute;sb&oacute;l fogadunk el csomagokat.
# Erre csak DSL- &eacute;s k&aacute;belmodemes kapcsolat eset&eacute;ben van sz&uuml;ks&eacute;g, a
# "felhaszn&aacute;l&oacute;i PPP" alkalmaz&aacute;sa sor&aacute;n sz&uuml;ks&eacute;gtelen. Ez az IP-c&iacute;m
# megegyezik a kimen&#245; kapcsolatokn&aacute;l megadott c&iacute;mmel.
pass in quick on dc0 proto udp from z.z.z.z to any port = 68 keep state

# Befel&eacute; enged&eacute;lyezz&uuml;k a szabv&aacute;nyos WWW funkci&oacute;t, mivel webszerver&uuml;nk
# van.
pass in quick on dc0 proto tcp from any to any port = 80 flags S keep state

# Befel&eacute; enged&eacute;lyezz&uuml;k az internetr&#245;l &eacute;rkez&#245; nem biztons&aacute;gos telnet
# kapcsolatokat. Az&eacute;rt nem biztons&aacute;gos, mert az azonos&iacute;t&oacute;kat &eacute;s
# jelszavakat titkos&iacute;tatlan form&aacute;ban k&ouml;zli az interneten kereszt&uuml;l.
# T&ouml;r&ouml;lj&uuml;k ezt a szab&aacute;lyt, ha nem haszn&aacute;lunk telnet szervert.
#pass in quick on dc0 proto tcp from any to any port = 23 flags S keep state

# Befel&eacute; enged&eacute;lyezz&uuml;k az internetr&#245;l # &eacute;rkez&#245; ssh/sftp/scp (biztons&aacute;gos
# telnet/rlogin/FTP) # kapcsolatokat az SSH (secure shell) haszn&aacute;lat&aacute;val.
pass in quick on dc0 proto tcp from any to any port = 22 flags S keep state

# Minden m&aacute;st dobjuk el &eacute;s napl&oacute;zzuk az els&#245; el&#245;fordul&aacute;sukat.
# Az els&#245; alkalom napl&oacute;z&aacute;s&aacute;val elej&eacute;t tudjuk venni a "Denial of
# Service" t&iacute;pus&uacute; t&aacute;mad&aacute;soknak, amivel egy&eacute;bk&eacute;nt lehets&eacute;ges lenne a
# napl&oacute; el&aacute;raszt&aacute;sa.
# Ez a szab&aacute;ly blokkol alap&eacute;rtelmez&eacute;s szerint mindent.
block in log first quick on dc0 all
################### Itt van a szab&aacute;lyok v&eacute;ge ##############################</programlisting>
    </sect2>

    <sect2>
      <title><acronym>NAT</acronym></title>

      <indexterm><primary>NAT</primary></indexterm>
      <indexterm>
	<primary>IP maszkol&aacute;s</primary>
	<see>NAT</see>
      </indexterm>

      <indexterm>
	<primary>h&aacute;l&oacute;zati
	  c&iacute;mford&iacute;t&aacute;s</primary>
	<see>NAT</see>
      </indexterm>

      <para>A <acronym>NAT</acronym> jelent&eacute;se <emphasis>Network
	Address Translation</emphasis>, vagyis h&aacute;l&oacute;zati
	c&iacute;mford&iacute;t&aacute;s.  A &linux; eset&eacute;ben ezt
	<quote>IP masqueradingnak</quote>, vagyis IP maszkol&aacute;snak
	h&iacute;vj&aacute;k.  A h&aacute;l&oacute;zati
	c&iacute;mford&iacute;t&aacute;s &eacute;s az IP
	maszkol&aacute;s l&eacute;nyegben ugyanazt takarja.  Az IPF
	c&iacute;mford&iacute;t&aacute;s&eacute;rt felel&#245;s
	funkci&oacute;j&aacute;nak k&ouml;sz&ouml;nhet&#245;en
	k&eacute;pesek vagyunk a t&#251;zfal m&ouml;g&ouml;tt
	elhelyezked&#245; helyi h&aacute;l&oacute;zat
	sz&aacute;m&aacute;ra megosztani az
	internet-szolg&aacute;ltat&oacute;l kapott publikus
	IP-c&iacute;met.</para>

      <para>Sokakban felmer&uuml;lhet a k&eacute;rd&eacute;s, hogy erre
	vajon mi sz&uuml;ks&eacute;g&uuml;nk lehet.  Az
	internet-szolg&aacute;ltat&oacute;k a
	mag&aacute;nszem&eacute;lyeknek &aacute;ltal&aacute;ban
	dinamikus IP-c&iacute;meket osztanak ki.  A dinamikus itt arra
	utal, hogy a c&iacute;m&uuml;nk minden alkalommal
	v&aacute;ltozik, amikor bet&aacute;rcs&aacute;zunk a
	szolg&aacute;ltat&oacute;hoz vagy amikor ki- &eacute;s
	bekapcsoljuk a modem&uuml;nket.  Ez a dinamikus IP-c&iacute;m
	fog azonos&iacute;tani minket az interneten.</para>

      <para>Most tegy&uuml;k fel, hogy &ouml;t g&eacute;p&uuml;nk van
	otthon, viszont csak egyetlen el&#245;fizet&eacute;ssel
	rendelkez&uuml;nk.  Ebben az esetben &ouml;t telefonvonalat
	kellene haszn&aacute;lnunk &eacute;s mindegyik g&eacute;phez
	el&#245;fizetni az internetre.</para>

      <para>A h&aacute;l&oacute;zati c&iacute;mford&iacute;t&aacute;s
	alkalmaz&aacute;s&aacute;val azonban mind&ouml;ssze egyetlen
	el&#245;fizet&eacute;s kell.  A g&eacute;pek k&ouml;z&uuml;l
	n&eacute;gyet hozz&aacute;k&ouml;t&uuml;nk egy switch-hez
	&eacute;s a switch-et pedig a fennmarad&oacute; g&eacute;phez,
	amelyen &os; fut.  Ez ut&oacute;bbi lesz az &iacute;gy
	kialak&iacute;tott helyi h&aacute;l&oacute;zatunk
	&aacute;tj&aacute;r&oacute;ja.  A t&#251;zfalban
	m&#251;k&ouml;d&#245; c&iacute;mford&iacute;t&aacute;s
	seg&iacute;ts&eacute;g&eacute;vel a helyi
	h&aacute;l&oacute;zaton tal&aacute;lhat&oacute; g&eacute;pek
	IP-c&iacute;meit &eacute;szrev&eacute;tlen&uuml;l &aacute;t
	tudjuk ford&iacute;tani a h&aacute;l&oacute;zatunk publikus
	IP-c&iacute;m&eacute;re, ahogy a csomagok elhagyj&aacute;k az
	&aacute;tj&aacute;r&oacute;t.  A be&eacute;rkez&#245; csomagok
	eset&eacute;ben mindez visszafel&eacute; t&ouml;rt&eacute;nik
	meg.</para>

      <para>Az IP-c&iacute;mek k&ouml;z&uuml;l adott egy
	tartom&aacute;ny, amit a c&iacute;mford&iacute;t&aacute;st
	haszn&aacute;l&oacute; helyi h&aacute;l&oacute;zatok
	r&eacute;sz&eacute;re tartanak fenn.  Az RFC&nbsp;1918 szerint
	az al&aacute;bbi IP-c&iacute;mtartom&aacute;nyok
	haszn&aacute;lhat&oacute;k a helyi h&aacute;l&oacute;zatban,
	mivel ezeken kereszt&uuml;l k&ouml;zvetlen&uuml;l sosem lehet
	kijutni az internetre:</para>

      <informaltable frame="none" pgwide="1">
	<tgroup cols="2">
	  <colspec colwidth="1*">
	  <colspec colwidth="1*">
	  <colspec colwidth="1*">

	  <tbody>
	    <row>
	      <entry>Kezd&#245; IP: <hostid
		role="ipaddr">10.0.0.0</hostid></entry>
	      <entry>-</entry>
	      <entry>Z&aacute;r&oacute; IP: <hostid
		role="ipaddr">10.255.255.255</hostid></entry>
	    </row>

	    <row>
	      <entry>Kezd&#245; IP: <hostid
		role="ipaddr">172.16.0.0</hostid></entry>
	      <entry>-</entry>
	      <entry>Z&aacute;r&oacute; IP: <hostid
		role="ipaddr">172.31.255.255</hostid></entry>
	    </row>

	    <row>
	      <entry>Kezd&#245; IP: <hostid
		role="ipaddr">192.168.0.0</hostid></entry>
	      <entry>-</entry>
	      <entry>Z&aacute;r&oacute; IP: <hostid
		role="ipaddr">192.168.255.255</hostid></entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>
    </sect2>

    <sect2>
      <title>IP<acronym>NAT</acronym></title>

      <indexterm>
	<primary>NAT</primary>
	<secondary>IPFILTER</secondary>
      </indexterm>

      <indexterm><primary><command>ipnat</command></primary></indexterm>

      <para>A c&iacute;mford&iacute;t&aacute;sra vonatkoz&oacute;
	szab&aacute;lyokat az <command>ipnat</command> paranccsal tudjuk
	bet&ouml;lteni.  Az ilyen t&iacute;pus&uacute;
	szab&aacute;lyokat &aacute;ltal&aacute;ban az
	<filename>/etc/ipnat.rules</filename> &aacute;llom&aacute;nyban
	tal&aacute;ljuk.  A r&eacute;szleteket l&aacute;sd az
	&man.ipnat.1; man oldal&aacute;n.</para>

      <para>Amikor a c&iacute;mford&iacute;t&aacute;s &uuml;zembe
	helyez&eacute;se ut&aacute;n meg akarjuk v&aacute;ltoztatni a
	c&iacute;mford&iacute;t&aacute;s szab&aacute;lyait,
	el&#245;sz&ouml;r a c&iacute;mford&iacute;t&aacute;s
	szab&aacute;lyait tartalmaz&oacute; &aacute;llom&aacute;nyt
	m&oacute;dos&iacute;tsuk, majd a bels&#245;
	c&iacute;mford&iacute;t&aacute;si szab&aacute;lyok &eacute;s a
	c&iacute;mford&iacute;t&aacute;si t&aacute;bl&aacute;zatban
	szerepl&#245; akt&iacute;v bejegyz&eacute;sek
	t&ouml;rl&eacute;s&eacute;hez futassuk le az
	<command>ipnat</command> parancsot a <option>-CF</option>
	be&aacute;ll&iacute;t&aacute;ssal.</para>

      <para>A c&iacute;mford&iacute;t&aacute;si szab&aacute;lyok
	&uacute;jrat&ouml;lt&eacute;s&eacute;t egy ehhez hasonl&oacute;
	paranccsal tudjuk elv&eacute;gezni:</para>

      <screen>&prompt.root; <userinput>ipnat -CF -f <replaceable>/etc/ipnat.szab&aacute;lyok</replaceable></userinput></screen>

      <para>A c&iacute;mford&iacute;t&aacute;shoz tartoz&oacute;
	statisztik&aacute;kat ezzel a paranccsal tudjuk
	lek&eacute;rdezni:</para>

      <screen>&prompt.root; <userinput>ipnat -s</userinput></screen>

      <para>A c&iacute;mford&iacute;t&aacute;si
	t&aacute;bl&aacute;zatban pillanatnyilag szerepl&#245;
	&ouml;sszerendel&eacute;seket a k&ouml;vetkez&#245; paranccsal
	tudjuk list&aacute;zni:</para>

      <screen>&prompt.root; <userinput>ipnat -l</userinput></screen>

      <para>A szab&aacute;lyok feldolgoz&aacute;s&aacute;val &eacute;s
	az akt&iacute;v szab&aacute;lyokkal/bejegyz&eacute;sekkel
	kapcsolatos inform&aacute;ci&oacute;k
	r&eacute;szletez&eacute;s&eacute;t &iacute;gy
	enged&eacute;lyezhetj&uuml;k:</para>

      <screen>&prompt.root; <userinput>ipnat -v</userinput></screen>

    </sect2>

    <sect2>
      <title>A c&iacute;mford&iacute;t&aacute;si
	szab&aacute;lyok</title>

      <para>A c&iacute;mford&iacute;t&aacute;si szab&aacute;lyok nagyon
	rugalmasak &eacute;s rengeteg olyan funkci&oacute;t meg tudunk
	vel&uuml;k val&oacute;s&iacute;tani, ami az &uuml;zleti
	&eacute;s otthoni felhaszn&aacute;l&oacute;k
	sz&aacute;m&aacute;ra egyar&aacute;nt hasznos.</para>

      <para>Itt most a szab&aacute;lyok
	fel&eacute;p&iacute;t&eacute;s&eacute;t csak
	egyszer&#251;s&iacute;tve mutatjuk be, legink&aacute;bb a nem
	&uuml;zleti k&ouml;rnyezetek tekintet&eacute;ben.  A
	szab&aacute;lyok komplett formai le&iacute;r&aacute;s&aacute;t
	az &man.ipnat.5; man oldal&aacute;n tal&aacute;ljuk.</para>

      <para>Egy c&iacute;mford&iacute;t&aacute;si szab&aacute;ly
	teh&aacute;t valahogy &iacute;gy n&eacute;z ki:</para>

      <programlisting>map <replaceable>INTERF&Eacute;SZ</replaceable> <replaceable>HELYI_IP_TARTOM&Aacute;NY</replaceable> -&gt; <replaceable>PUBLIKUS_C&Iacute;M</replaceable></programlisting>

      <para>A szab&aacute;lyt a <literal>map</literal> kulcssz&oacute;
	kezdi.</para>

      <para>A <replaceable>INTERF&Eacute;SZ</replaceable> hely&eacute;re
	az internet fel&eacute; mutat&oacute; k&uuml;ls&#245;
	interf&eacute;sz nev&eacute;t &iacute;rjuk be.</para>

      <para>A <replaceable>HELYI_IP_TARTOM&Aacute;NY</replaceable> lesz
	az, amelyben a kliensek c&iacute;meznek.  Ez
	p&eacute;ld&aacute;ul a <hostid
	role="ipaddr">192.168.1.0/24</hostid>.</para>

      <para>A <replaceable>PUBLIKUS_C&Iacute;M</replaceable> lehet egy
	k&uuml;ls&#245; IP-c&iacute;m vagy a <literal>0/32</literal>
	speci&aacute;lis kulcssz&oacute;, amellyel a
	<replaceable>FEL&Uuml;LET</replaceable>-hez rendelt
	IP-c&iacute;mre hivatkozunk.</para>

    </sect2>

    <sect2>
      <title>Hogyan m&#251;k&ouml;dik a h&aacute;l&oacute;zati
	c&iacute;mford&iacute;t&aacute;s</title>

      <para>A publikus c&eacute;l fel&eacute; halad&oacute; csomag
	meg&eacute;rkezik a helyi h&aacute;l&oacute;zatr&oacute;l.
	Miut&aacute;n a kimen&#245; kapcsolatokra vonatkoz&oacute;
	szab&aacute;lyok &aacute;tengedik, a
	c&iacute;mford&iacute;t&aacute;s kapja meg a szerepet &eacute;s
	fentr&#245;l lefel&eacute; haladva nekil&aacute;t alkalmazni a
	saj&aacute;t szab&aacute;lyait, ahol az els&#245; egyez&#245;
	szerint cselekszik.  A c&iacute;mford&iacute;t&aacute;s a
	szab&aacute;lyokat a csomaghoz tartoz&oacute; interf&eacute;szre
	&eacute;s a forr&aacute;s IP-c&iacute;m&eacute;re illeszti.
	Amikor a csomag interf&eacute;sz&eacute;nek neve illeszkedik egy
	c&iacute;mford&iacute;t&aacute;si szab&aacute;lyra, akkor
	ezut&aacute;n a csomag forr&aacute;s (vagyis a helyi
	h&aacute;l&oacute;zaton bel&uuml;li)
	IP-c&iacute;m&eacute;r&#245;l igyekszik eld&ouml;nteni, hogy a
	szab&aacute;ly nyil&aacute;nak bal oldal&aacute;n szerepl&#245;
	tartom&aacute;nyba esik-e.  Ha erre is illeszkedik, akkor a
	forr&aacute;s IP-c&iacute;m&eacute;t &aacute;t&iacute;rjuk a
	<literal>0/32</literal> kulcssz&oacute; alapj&aacute;n
	felder&iacute;tett publikus IP-c&iacute;mre.  A
	c&iacute;mford&iacute;t&oacute; rutin ezt feljegyzi a
	saj&aacute;t bels&#245; t&aacute;bl&aacute;zat&aacute;ba,
	&iacute;gy amikor a csomag visszat&eacute;r az internetr&#245;l,
	akkor k&eacute;pes lesz visszaford&iacute;tani az eredeti
	bels&#245; IP-c&iacute;m&eacute;re &eacute;s
	feldolgoz&aacute;sra &aacute;tadni a t&#251;zfal
	szab&aacute;lyainak.</para>
    </sect2>

    <sect2>
      <title>A c&iacute;mford&iacute;t&aacute;s
	enged&eacute;lyez&eacute;se</title>

      <para>A c&iacute;mford&iacute;t&aacute;s &eacute;letre
	kelt&eacute;s&eacute;hez a k&ouml;vetkez&#245;ket kell
	be&aacute;ll&iacute;tanunk az <filename>/etc/rc.conf</filename>
	&aacute;llom&aacute;nyban.</para>

      <para>El&#245;sz&ouml;r enged&eacute;lyezz&uuml;k a
	g&eacute;p&uuml;nknek, hogy k&ouml;zvet&iacute;tsen forgalmat az
	interf&eacute;szek k&ouml;z&ouml;tt:</para>

      <programlisting>gateway_enable="YES"</programlisting>

      <para>Minden alkalommal ind&iacute;tsuk el a
	c&iacute;mford&iacute;t&aacute;s&eacute;rt felel&#245;s IPNAT
	programot:</para>

      <programlisting>ipnat_enable="YES"</programlisting>

      <para>Adjuk meg az IPNAT sz&aacute;m&aacute;ra a
	bet&ouml;ltend&#245; szab&aacute;lyokat:</para>

      <programlisting>ipnat_rules="/etc/ipnat.rules"</programlisting>

    </sect2>

    <sect2>
      <title>H&aacute;l&oacute;zati c&iacute;mford&iacute;t&aacute;s
	nagyon nagy helyi h&aacute;l&oacute;zatok
	eset&eacute;ben</title>

      <para>Az olyan helyi h&aacute;l&oacute;zatokban, ahol rengeteg PC
	tal&aacute;lhat&oacute; vagy t&ouml;bb alh&aacute;l&oacute;zatot
	is tartalmaz, az &ouml;sszes priv&aacute;t IP-c&iacute;m
	egyetlen publikus IP-c&iacute;mbe
	t&ouml;m&ouml;r&iacute;t&eacute;se igen komoly
	probl&eacute;m&aacute;v&aacute; tud dagadni &eacute;s az azonos
	portok gyakori haszn&aacute;lata a helyi h&aacute;l&oacute;zatra
	k&ouml;t&ouml;tt sz&aacute;m&iacute;t&oacute;g&eacute;pek
	k&ouml;z&ouml;tt &uuml;tk&ouml;z&eacute;seket okoz.  K&eacute;t
	m&oacute;don tudunk megold&aacute;st ny&uacute;jtani erre a
	probl&eacute;m&aacute;ra.</para>

      <sect3>
	<title>A haszn&aacute;lhat&oacute; portok
	  kioszt&aacute;sa</title>

	<para>Egy norm&aacute;lis c&iacute;mford&iacute;t&aacute;si
	  szab&aacute;ly valahogy &iacute;gy n&eacute;zne ki:</para>

	<programlisting>map dc0 192.168.1.0/24 -&gt; 0/32</programlisting>

	<para>A fenti szab&aacute;lyban a csomag
	  forr&aacute;sportj&aacute;t az IP<acronym>NAT</acronym>
	  v&aacute;ltozatlanul a feldolgoz&aacute;s ut&aacute;n hagyja.
	  Ha ehhez m&eacute;g hozz&aacute;tessz&uuml;k a
	  <literal>portmap</literal> kulcssz&oacute;t, akkor ezzel
	  utas&iacute;tani tudjuk az IP<acronym>NAT</acronym>-ot, hogy
	  csak az adott tartom&aacute;nyban k&eacute;pezze le a
	  forr&aacute;sportokat.  P&eacute;ld&aacute;ul a
	  k&ouml;vetkez&#245; szab&aacute;ly hat&aacute;s&aacute;ra az
	  IP<acronym>NAT</acronym> a forr&aacute;sportokat egy adott
	  tartom&aacute;nyon bel&uuml;l fogja
	  m&oacute;dos&iacute;tani:</para>

	<programlisting>map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp 20000:60000</programlisting>

	<para>Ha viszont m&eacute;g ink&aacute;bb meg akarjuk
	  k&ouml;nny&iacute;teni a dolgunkat, akkor itt egyszer&#251;en
	  csak adjuk meg az <literal>auto</literal> kulcssz&oacute;t,
	  amellyel az IP<acronym>NAT</acronym>
	  &ouml;nmag&aacute;t&oacute;l meg&aacute;llap&iacute;tja, hogy
	  milyen portokat tud haszn&aacute;lni:</para>

	<programlisting>map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp auto</programlisting>

      </sect3>

      <sect3>
	<title>T&ouml;bb publikus c&iacute;m haszn&aacute;lata</title>

	<para>Minden nagyobb helyi h&aacute;l&oacute;zat eset&eacute;ben
	  el&eacute;rkez&uuml;nk ahhoz a ponthoz, ahol m&aacute;r
	  egyetlen publikus c&iacute;m nem el&eacute;g.  Ha t&ouml;bb
	  publikus IP-c&iacute;mmel is rendelkez&uuml;nk, akkor
	  ezekb&#245;l a c&iacute;mekb&#245;l egy <quote>k&ouml;z&ouml;s
	  k&eacute;szletet</quote> hozhatunk l&eacute;tre, amib&#245;l
	  majd az IPNAT v&aacute;logathat mik&ouml;zben a csomagok
	  c&iacute;meit &aacute;t&iacute;rja kifel&eacute;
	  menetben.</para>

	<para>P&eacute;ld&aacute;ul ahelyett, hogy a csomagokat egyetlen
	  publikus IP-c&iacute;mre k&eacute;pezn&eacute;nk le, ahogy itt
	  tessz&uuml;k:</para>

	<programlisting>map dc0 192.168.1.0/24 -&gt; 204.134.75.1</programlisting>

	<para>A h&aacute;l&oacute;zati maszk
	  seg&iacute;ts&eacute;g&eacute;vel meg tudjuk adni
	  IP-c&iacute;mek egy tartom&aacute;ny&aacute;t is:</para>

	<programlisting>map dc0 192.168.1.0/24 -&gt; 204.134.75.0/255.255.255.0</programlisting>

	<para>CIDR-jel&ouml;l&eacute;ssel:</para>

	<programlisting>map dc0 192.168.1.0/24 -&gt; 204.134.75.0/24</programlisting>
      </sect3>
    </sect2>

    <sect2>
      <title>A portok &aacute;tir&aacute;ny&iacute;t&aacute;sa</title>

      <para>Gyakran el&#245;fordul, hogy van webszerver&uuml;nk,
	levelez&#245; szerver&uuml;nk, adatb&aacute;zis szerver&uuml;nk
	&eacute;s n&eacute;vszerver&uuml;nk, melyek a helyi
	h&aacute;l&oacute;zat k&uuml;l&ouml;nb&ouml;z&#245;
	g&eacute;pein futnak.  Ebben az esetben a szerverekhez
	tartoz&oacute; forgalmat is ford&iacute;tanunk kell, illetve
	valamilyen m&oacute;don a bej&ouml;v&#245; forgalmat is
	&aacute;t kell ir&aacute;ny&iacute;tanunk a helyi
	h&aacute;l&oacute;zat megfelel&#245; g&eacute;peihez.  Az
	IP<acronym>NAT</acronym> ezt a gondot a h&aacute;l&oacute;zati
	c&iacute;mford&iacute;t&aacute;s
	&aacute;tir&aacute;ny&iacute;t&aacute;st t&aacute;mogat&oacute;
	funkci&oacute;ival sz&uuml;nteti meg.  Tegy&uuml;k fel, hogy a
	<hostid role="ipaddr">10.0.10.25</hostid> bels&#245;
	c&iacute;men van egy webszerver&uuml;nk, amelyhez a <hostid
	role="ipaddr">20.20.20.5</hostid> publikus IP tartozik.
	Ilyenkor a k&ouml;vetkez&#245; szab&aacute;lyt adjuk meg:</para>

	<programlisting>rdr dc0 20.20.20.5/32 port 80 -&gt; 10.0.10.25 port 80</programlisting>

	<para>vagy:</para>

	<programlisting>rdr dc0 0.0.0.0/0 port 80 -&gt; 10.0.10.25 port 80</programlisting>

	<para>&Iacute;gy tudjuk be&aacute;ll&iacute;tani a <hostid
	  role="ipaddr">10.0.10.33</hostid> c&iacute;mmel
	  rendelkez&#245; n&eacute;vszervert a kintr&#245;l
	  &eacute;rkez&#245; n&eacute;vfelold&aacute;si
	  k&eacute;r&eacute;sek fogad&aacute;s&aacute;ra:</para>

	<programlisting>rdr dc0 20.20.20.5/32 port 53 -&gt; 10.0.10.33 port 53 udp</programlisting>

    </sect2>

    <sect2>
      <title>Az FTP &eacute;s a c&iacute;mford&iacute;t&aacute;s</title>

      <para>Az FTP egy olyan &#245;sk&ouml;v&uuml;let, amely m&eacute;g
	az internet egy r&eacute;gi korszak&aacute;b&oacute;l maradt fenn,
	amikor az egyetemek k&ouml;z&ouml;tt m&eacute;g b&eacute;relt
	vonal l&eacute;tezett &eacute;s az FTP szolg&aacute;lt a
	kutat&oacute;k k&ouml;zt az &aacute;llom&aacute;nyok
	megoszt&aacute;s&aacute;ra.  Ez m&eacute;g abban az id&#245;ben
	t&ouml;rt&eacute;nt, amikor a biztons&aacute;g
	egy&aacute;ltal&aacute;n nem volt l&eacute;nyeges szempont.  Az
	&eacute;vek el&#245;rehaladt&aacute;val az FTP protokoll
	beleiv&oacute;dott a felt&ouml;rekv&#245; internet
	gerinc&eacute;be &eacute;s a titkos&iacute;tatlanul
	k&uuml;ld&ouml;tt azonos&iacute;t&oacute;ival &eacute;s
	jelszavaival tov&aacute;bbra is ugyanolyan v&eacute;dtelen
	maradt.  Az FTP k&eacute;t v&aacute;ltozatban, akt&iacute;v
	&eacute;s passz&iacute;v m&oacute;dban k&eacute;pes
	m&#251;k&ouml;dni.  Az elt&eacute;r&eacute;s kettej&uuml;k
	k&ouml;z&ouml;tt az adatcsatorna
	meg&aacute;llap&iacute;t&aacute;s&aacute;ban van.  A
	passz&iacute;v m&oacute;d sokkal biztons&aacute;gosabb, mivel
	ilyenkor az adatcsatorn&aacute;t az FTP kapcsolatot
	kezdem&eacute;nyez&#245; &aacute;ll&iacute;tja be.  Az FTP
	k&uuml;l&ouml;nb&ouml;z&#245; m&oacute;djainak
	magyar&aacute;zat&aacute;t &eacute;s a k&ouml;zt&uuml;k
	lev&#245; k&uuml;l&ouml;nbs&eacute;get a <ulink
	url="http://www.slacksite.com/other/ftp.html"></ulink>
	c&iacute;men ismerhetj&uuml;k meg r&eacute;szleteiben
	(angolul).</para>

      <sect3>
	<title>Az IPNAT szab&aacute;lyai</title>

	<para>Az IPNAT egy speci&aacute;lis be&eacute;p&iacute;tett FTP
	  proxyval rendelkezik, amelyre a h&aacute;l&oacute;zati
	  c&iacute;mford&iacute;t&aacute;s lek&eacute;pez&eacute;sei
	  k&ouml;z&ouml;tt hivatkozhatunk.  K&eacute;pes figyelni az
	  &ouml;sszes akt&iacute;v vagy passz&iacute;v FTP kapcsolathoz
	  tartoz&oacute; kimen&#245; k&eacute;r&eacute;st &eacute;s
	  ezekhez dinamikusan l&eacute;trehozni olyan ideiglenes
	  sz&#251;r&eacute;si szab&aacute;lyokat, amelyek val&oacute;ban
	  csak az adatcsatorn&aacute;hoz felhaszn&aacute;lt portokat
	  tartalmazz&aacute;k.  Ezzel ki tudjuk
	  k&uuml;sz&ouml;b&ouml;lni az FTP azon k&aacute;ros
	  hat&aacute;s&aacute;t a t&#251;zfalra n&eacute;zve, hogy
	  egyszerre t&uacute;ls&aacute;gosan sok magasabb
	  tartom&aacute;nybeli port legyen nyitva.</para>

	<para>Ez a szab&aacute;ly a bels&#245; h&aacute;l&oacute;zat
	  &ouml;sszes FTP forgalm&aacute;t lekezeli:</para>

	<programlisting>map dc0 10.0.10.0/29 -&gt; 0/32 proxy port 21 ftp/tcp</programlisting>

	<para>Ez a szab&aacute;ly pedig az
	  &aacute;tj&aacute;r&oacute;r&oacute;l &eacute;rkez&#245; FTP
	  forgalommal b&iacute;rk&oacute;zik meg:</para>

	<programlisting>map dc0 0.0.0.0/0 -&gt; 0/32 proxy port 21 ftp/tcp</programlisting>

	<para>Ez a szab&aacute;ly kezeli a bels&#245;
	  h&aacute;l&oacute;zatr&oacute;l &eacute;rkez&#245; &ouml;sszes
	  nem FTP t&iacute;pus&uacute; forgalmat:</para>

	<programlisting>map dc0 10.0.10.0/29 -&gt; 0/32</programlisting>

	<para>Az FTP lek&eacute;pz&eacute;s&eacute;re vonatkoz&oacute;
	  szab&aacute;ly a szok&aacute;sos lek&eacute;pz&eacute;si
	  szab&aacute;ly el&eacute; ker&uuml;l.  Az &ouml;sszes csomag
	  fentr&#245;l haladva az els&#245; illeszked&#245;
	  szab&aacute;ly alapj&aacute;n ker&uuml;l feldolgoz&aacute;sra.
	  El&#245;sz&ouml;r az interf&eacute;sz nev&eacute;t
	  vizsg&aacute;ljuk, majd a bels&#245; h&aacute;l&oacute;zatbeli
	  forr&aacute;s IP-t, v&eacute;g&uuml;l azt, hogy a csomag egy
	  FTP kapcsolat r&eacute;sze.  Ha minden
	  param&eacute;ter&eacute;ben megfelel, akkor az FTP proxy
	  k&eacute;sz&iacute;t egy ideiglenes sz&#251;r&eacute;si
	  szab&aacute;lyt hozz&aacute;, amellyel az FTP kapcsolathoz
	  tartoz&oacute; csomagok mind a k&eacute;t ir&aacute;nyba
	  k&eacute;pesek lesznek v&aacute;ndorolni, term&eacute;szetesen
	  a c&iacute;mford&iacute;t&aacute;ssal egy&uuml;tt.  Az
	  &ouml;sszes t&ouml;bbi bentr&#245;l &eacute;rkez&#245; csomag
	  &aacute;tl&eacute;p ezen a szab&aacute;lyon &eacute;s
	  meg&aacute;ll a harmadikn&aacute;l, ahol az
	  interf&eacute;sznek &eacute;s forr&aacute;s IP-nek
	  megfelel&#245;en &aacute;tford&iacute;tjuk a
	  c&iacute;m&eacute;t.</para>
      </sect3>

      <sect3>
	<title>Az IPNAT sz&#251;r&eacute;si szab&aacute;lyai
	  FTP-re</title>

	<para>Az FTP eset&eacute;ben csak egyetlen sz&#251;r&eacute;si
	  szab&aacute;lyra van sz&uuml;ks&eacute;g&uuml;nk a
	  h&aacute;l&oacute;zati c&iacute;mford&iacute;t&aacute;sba
	  &eacute;p&iacute;tett FTP proxy
	  haszn&aacute;lat&aacute;hoz.</para>

	<para>FTP proxy n&eacute;lk&uuml;l az al&aacute;bbi h&aacute;rom
	  szab&aacute;ly kellene:</para>

	<programlisting># Kifel&eacute; enged&eacute;lyezz&uuml;k a bels&#245; g&eacute;pek FTP el&eacute;r&eacute;st az internet ir&aacute;ny&aacute;ba,
# akt&iacute;v &eacute;s passz&iacute;v m&oacute;dokban.
pass out quick on rl0 proto tcp from any to any port = 21 flags S keep state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a passz&iacute;v m&oacute;dhoz tartoz&oacute; magasabb tartom&aacute;nybeli
# adatcsatorn&aacute;kat.
pass out quick on rl0 proto tcp from any to any port &gt; 1024 flags S keep state

# Akt&iacute;v m&oacute;dban beengedj&uuml;k az FTP szervert&#245;l &eacute;rkez&#245; adatcsatorn&aacute;t.
pass in quick on rl0 proto tcp from any to any port = 20 flags S keep state</programlisting>
      </sect3>
    </sect2>
  </sect1>

  <sect1 id="firewalls-ipfw">
    <title>IPFW</title>

    <indexterm>
      <primary>t&#251;zfalak</primary>
      <secondary>IPFW</secondary>
    </indexterm>

    <para>Az IPFIREWALL (<acronym>IPFW</acronym>) a &os; &aacute;ltal
      t&aacute;mogatott t&#251;zfalaz&oacute; alkalmaz&aacute;s, melyet a
      &os; Projektben r&eacute;sztvev&#245; &ouml;nk&eacute;ntesek
      fejlesztettek ki &eacute;s tartanak karban.  R&eacute;gi
      t&iacute;pus&uacute;, &aacute;llapottart&aacute;s
      n&eacute;lk&uuml;li szab&aacute;lyokat haszn&aacute;l, &eacute;s
      az itt haszn&aacute;latos szab&aacute;ly&iacute;r&aacute;si
      technik&aacute;t <quote>egyszer&#251; &aacute;llapottart&oacute;
      megold&aacute;snak</quote> nevezz&uuml;k.</para>

    <para>Az IPFW szabv&aacute;ny &os;-ben lev&#245;, mintak&eacute;nt
      szolg&aacute;l&oacute; szab&aacute;lyrendszere (ez az
      <filename>/etc/rc.firewall</filename> &eacute;s
      <filename>/etc/rc.firewall6</filename> &aacute;llom&aacute;nyokban
      tal&aacute;lhat&oacute; meg) annyira egyszer&#251;, hogy komolyabb
      m&oacute;dos&iacute;t&aacute;sok n&eacute;lk&uuml;l nem
      aj&aacute;nlatos haszn&aacute;lni.  Ez a p&eacute;lda nem
      tartalmaz &aacute;llapottart&oacute; sz&#251;r&eacute;st, ami
      viszont a legt&ouml;bb esetben k&iacute;v&aacute;natos lenne,
      ez&eacute;rt ezt a szakaszt nem erre alapozzuk.</para>

    <para>Az IPFW &aacute;llapottart&aacute;s n&eacute;lk&uuml;li
      szab&aacute;lyainak fel&eacute;p&iacute;t&eacute;s&eacute;ben
      olyan technikailag kifinomult lev&aacute;logat&aacute;si
      k&eacute;pess&eacute;gek b&uacute;jnak meg, amelyek
      j&oacute;csk&aacute;n meghaladj&aacute;k az &aacute;tlagos
      t&#251;zfal&eacute;p&iacute;t&#245;k tud&aacute;s&aacute;t.  Az
      IPFW els&#245;sorban olyan szakemberek vagy szakmailag
      el&#245;rehaladott felhaszn&aacute;l&oacute;k
      sz&aacute;m&aacute;ra k&eacute;sz&uuml;lt, akiknek
      speci&aacute;lis csomagsz&#251;r&eacute;si ig&eacute;nyeik vannak.
      A k&uuml;l&ouml;nb&ouml;z&#245; protokollok
      haszn&aacute;lat&aacute;nak &eacute;s a hozz&aacute;juk
      tartoz&oacute; fejl&eacute;cinform&aacute;ci&oacute;k mindenre
      kiterjed&#245; ismerete szinte n&eacute;lk&uuml;l&ouml;zhetetlen
      az IPFW val&oacute;di erej&eacute;nek
      kihaszn&aacute;l&aacute;s&aacute;hoz.  Ez a szint azonban
      t&uacute;lmutat a k&eacute;zik&ouml;nyv ezen szakasz&aacute;nak
      keretein.</para>

    <para>Az IPFW h&eacute;t komponensb&#245;l &eacute;p&uuml;l fel,
      melyek k&ouml;z&uuml;l az els&#245;dleges a rendszermag
      t&#251;zfalaz&aacute;s&eacute;rt felel&#245;s
      szab&aacute;lyfeldolgoz&oacute; &eacute;s a
      hozz&aacute;tartoz&oacute; csomagnyilv&aacute;ntart&aacute;s, majd
      ezt k&ouml;veti a napl&oacute;z&aacute;s, a h&aacute;l&oacute;zati
      c&iacute;mford&iacute;t&aacute;st aktiv&aacute;l&oacute;
      <literal>divert</literal> szab&aacute;ly, valamint a komolyabb
      c&eacute;lok megval&oacute;s&iacute;t&aacute;s&aacute;ra alkalmas
      lehet&#245;s&eacute;gek: a forgalom
      korl&aacute;toz&aacute;s&aacute;&eacute;rt felel&#245;s dummynet,
      a tov&aacute;bbk&uuml;ld&eacute;sre alkalmas <literal>fwd
      rule</literal> szab&aacute;ly, a h&aacute;l&oacute;zati hidak
      t&aacute;mogat&aacute;sa, illetve az ipstealth.  Az IPFW
      egyar&aacute;nt haszn&aacute;lhat&oacute; IPv4 &eacute;s IPv6
      eset&eacute;n.</para>

    <sect2 id="firewalls-ipfw-enable">
      <title>Az IPFW enged&eacute;lyez&eacute;se</title>

      <indexterm>
	<primary>IPFW</primary>
	<secondary>enged&eacute;lyez&eacute;se</secondary>
      </indexterm>

      <para>Az IPFW az alap &os; telep&iacute;t&eacute;sben
	k&uuml;l&ouml;n, fut&aacute;s id&#245;ben bet&ouml;lthet&#245;
	modulk&eacute;nt &eacute;rhet&#245; el.  Ha az
	<filename>rc.conf</filename> &aacute;llom&aacute;nyban megadjuk
	a <literal>firewall_enable="YES"</literal>
	be&aacute;ll&iacute;t&aacute;st, akkor a rendszer
	indul&aacute;sakor ezt a modult dinamikusan bet&ouml;lti.  Az
	IPFW-t csak akkor kell a &os; rendszermagj&aacute;ba
	be&eacute;p&iacute;ten&uuml;nk, ha sz&uuml;ks&eacute;g&uuml;nk
	van a c&iacute;mford&iacute;t&aacute;si
	funkci&oacute;j&aacute;ra is.</para>

      <para>Ha teh&aacute;t az <filename>rc.conf</filename>
	&aacute;llom&aacute;nyban megadtuk a
	<literal>firewall_enable="YES"</literal> sort &eacute;s
	&uacute;jraind&iacute;tottuk a
	sz&aacute;m&iacute;t&oacute;g&eacute;p&uuml;nket, akkor a
	k&ouml;vetkez&#245; feh&eacute;rrel kiemelt &uuml;zenet fog
	megjelenni a rendszerind&iacute;t&aacute;s sor&aacute;n:</para>

      <screen>ipfw2 initialized, divert disabled, rule-based forwarding disabled, default to deny, logging disabled</screen>

      <para>A <quote>logging disabled</quote> &uuml;zenetb&#245;l
	kider&uuml;l, hogy a modul nem v&eacute;gez
	napl&oacute;z&aacute;st.  A napl&oacute;z&aacute;st &eacute;s a
	hozz&aacute;tartoz&oacute; r&eacute;szletess&eacute;g
	szintj&eacute;t &uacute;gy tudjuk be&aacute;ll&iacute;tani, ha
	az <filename>/etc/sysctl.conf</filename>
	&aacute;llom&aacute;nyba felvessz&uuml;k a k&ouml;vetkez&#245;
	sorokat, amivel a k&ouml;vetkez&#245; ind&iacute;t&aacute;skor
	m&aacute;r m&#251;k&ouml;dni fog:</para>

      <programlisting>net.inet.ip.fw.verbose=1
net.inet.ip.fw.verbose_limit=5</programlisting>

    </sect2>

    <sect2 id="firewalls-ipfw-kernel">
      <title>A rendszermag be&aacute;ll&iacute;t&aacute;sai</title>

      <indexterm>
	<primary>a rendszermag
	  be&aacute;ll&iacute;t&aacute;sai</primary>
	<secondary>IPFIREWALL</secondary>
      </indexterm>

      <indexterm>
	<primary>a rendszermag
	  be&aacute;ll&iacute;t&aacute;sai</primary>
	<secondary>IPFIREWALL_VERBOSE</secondary>
      </indexterm>

      <indexterm>
	<primary>a rendszermag
	  be&aacute;ll&iacute;t&aacute;sai</primary>
	<secondary>IPFIREWALL_VERBOSE_LIMIT</secondary>
      </indexterm>

      <indexterm>
	<primary>IPFW</primary>
	<secondary>a rendszermag
	  be&aacute;ll&iacute;t&aacute;sai</secondary>
      </indexterm>

      <para>Ha nem akarjuk kihaszn&aacute;lni az IPFW &aacute;ltal
	felk&iacute;n&aacute;lt c&iacute;mford&iacute;t&aacute;si
	lehet&#245;s&eacute;geket, akkor egy&aacute;ltal&aacute;n nem
	sz&uuml;ks&eacute;ges a &os; rendszermagj&aacute;ba
	beleford&iacute;tani a t&aacute;mogat&aacute;s&aacute;t.
	Ez&eacute;rt az al&aacute;bbiakat csak
	kieg&eacute;sz&iacute;t&#245;
	inform&aacute;ci&oacute;k&eacute;nt t&uuml;ntett&uuml;k
	fel.</para>

      <programlisting>options    IPFIREWALL</programlisting>

      <para>Ez a be&aacute;ll&iacute;t&aacute;s enged&eacute;lyezi az
	IPFW haszn&aacute;lat&aacute;t a rendszermag
	r&eacute;szek&eacute;nt.</para>

      <programlisting>options    IPFIREWALL_VERBOSE</programlisting>

      <para>Ezzel &eacute;s a <literal>log</literal> kulcssz&oacute;val
	tudjuk az IPFW szab&aacute;lyain kereszt&uuml;lhalad&oacute;
	csomagokat napl&oacute;zni.</para>

      <programlisting>options    IPFIREWALL_VERBOSE_LIMIT=5</programlisting>

      <para>Ez az &eacute;rt&eacute;k korl&aacute;tozza a
	&man.syslogd.8; seg&iacute;ts&eacute;g&eacute;vel
	napl&oacute;zott azonos bejegyz&eacute;sek maxim&aacute;lis
	sz&aacute;m&aacute;t.  Ezt a be&aacute;ll&iacute;t&aacute;st
	olyan vesz&eacute;lyes k&ouml;rnyezetekben &eacute;rdemes
	haszn&aacute;lnunk, ahol napl&oacute;zni akarunk.
	Seg&iacute;ts&eacute;g&eacute;vel meg tudjuk akad&aacute;lyozni,
	hogy a rendszernapl&oacute; el&aacute;raszt&aacute;s&aacute;val
	megakassz&aacute;k a rendszer&uuml;nket.</para>

      <indexterm>
	<primary>a rendszermag
	  be&aacute;ll&iacute;t&aacute;sai</primary>
	<secondary>IPFIREWALL_DEFAULT_TO_ACCEPT</secondary>
      </indexterm>

      <programlisting>options    IPFIREWALL_DEFAULT_TO_ACCEPT</programlisting>

      <para>Ezen be&aacute;ll&iacute;t&aacute;s hat&aacute;s&aacute;ra a
	t&#251;zfal alap&eacute;rtelmez&eacute;s szerint mindent
	&aacute;tenged, ami &aacute;ltal&aacute;ban akkor j&ouml;het
	j&oacute;l, amikor el&#245;sz&ouml;r be&aacute;ll&iacute;tjuk a
	t&#251;zfalat.</para>

      <indexterm>
	<primary>a rendszermag
	  be&aacute;ll&iacute;t&aacute;sai</primary>
	<secondary>IPDIVERT</secondary>
      </indexterm>

      <programlisting>options    IPDIVERT</programlisting>

      <para>Ezzel a be&aacute;ll&iacute;t&aacute;ssal
	enged&eacute;lyezz&uuml;k a c&iacute;mford&iacute;t&aacute;s
	haszn&aacute;lat&aacute;t.</para>

      <note>
	<para>Ha nem adjuk meg az IPFIREWALL_DEFAULT_TO_ACCEPT
	  be&aacute;ll&iacute;t&aacute;st, vagy ha nem
	  enged&eacute;lyezz&uuml;k a bej&ouml;v&#245; csomagokat, akkor
	  a g&eacute;p&uuml;nkre semmilyen csomag nem lesz k&eacute;pes
	  bejutni, illetve onnan kijutni.</para>
      </note>

    </sect2>

    <sect2 id="firewalls-ipfw-rc">
      <title>Az <filename>/etc/rc.conf</filename>
	be&aacute;ll&iacute;t&aacute;sai</title>

      <para>&Iacute;gy tudjuk enged&eacute;lyezni a
	t&#251;zfalat:</para>

      <programlisting>firewall_enable="YES"</programlisting>

      <para>A &os;-hez mell&eacute;kelt alap&eacute;rtelmezett
	t&#251;zfalt&iacute;pusok k&ouml;z&uuml;l az
	<filename>/etc/rc.firewall</filename> &aacute;llom&aacute;ny
	&aacute;tolvas&aacute;s&aacute;val tudunk v&aacute;lasztani,
	&eacute;s megadni az al&aacute;bbi helyett:</para>

      <programlisting>firewall_type="open"</programlisting>

      <para>A k&ouml;vetkez&#245; &eacute;rt&eacute;kek &aacute;llnak
	rendelkez&eacute;s&uuml;nkre:</para>

      <itemizedlist>
	<listitem>
	  <para><literal>open</literal> &mdash; &aacute;tengedi az
	    &ouml;sszes forgalmat</para>
	</listitem>
	<listitem>
	  <para><literal>client</literal> &mdash; csak ezt a
	    g&eacute;pet v&eacute;di</para>
	</listitem>
	<listitem>
	  <para><literal>simple</literal> &mdash; az eg&eacute;sz
	    h&aacute;l&oacute;zatot v&eacute;di</para>
	</listitem>
	<listitem>
	  <para><literal>closed</literal> &mdash; a helyi
	    interf&eacute;sz kiv&eacute;tel&eacute;vel minden IP
	    alap&uacute; forgalmat tilt</para>
	</listitem>
	<listitem>
	  <para><literal>UNKNOWN</literal> &mdash; tiltja a t&#251;zfal
	    szab&aacute;lyainak bet&ouml;lt&eacute;s&eacute;t</para>
	</listitem>
	<listitem>
	  <para><filename><replaceable>&aacute;llom&aacute;nyn&eacute;v</replaceable></filename>
	    &mdash; a t&#251;zfal szab&aacute;lyait tartalmaz&oacute;
	    &aacute;llom&aacute;ny abszol&uacute;t el&eacute;r&eacute;si
	    &uacute;tvonala</para>
	</listitem>
      </itemizedlist>

      <para>K&eacute;t k&uuml;l&ouml;nb&ouml;z&#245; m&oacute;don lehet
	bet&ouml;lteni a saj&aacute;t <application>ipfw</application>
	szab&aacute;lyainkat.  Az egyik k&ouml;z&uuml;l&uuml;k, ha a
	<literal>firewall_type</literal> v&aacute;ltoz&oacute;ban
	megadjuk a <emphasis>t&#251;zfal szab&aacute;lyait</emphasis>
	tartalmaz&oacute; &aacute;llom&aacute;ny abszol&uacute;t
	el&eacute;r&eacute;si &uacute;tvonal&aacute;t, az &man.ipfw.8;
	parancssori be&aacute;ll&iacute;t&aacute;sai n&eacute;lk&uuml;l.
	Egy egyszer&#251; szab&aacute;lyrendszer lehet
	p&eacute;ld&aacute;ul a k&ouml;vetkez&#245;:</para>

      <programlisting>add block in  all
add block out all</programlisting>

      <para>M&aacute;sr&eacute;szr&#245;l az
	<literal>firewall_script</literal> v&aacute;ltoz&oacute;ban is
	megadhatjuk azt a szkriptet, amelyben a
	rendszerind&iacute;t&aacute;s sor&aacute;n megh&iacute;vjuk
	<command>ipfw</command> parancsot.  Az im&eacute;nti
	szab&aacute;lyrendszert az al&aacute;bbi szkripttel tudjuk
	kiv&aacute;ltani:</para>

     <programlisting>#!/bin/sh

ipfw -q flush

ipfw add block in  all
ipfw add block out all</programlisting>

      <note>
	<para>Ha a <literal>firewall_type</literal>
	  v&aacute;ltoz&oacute; <literal>client</literal> vagy
	  <literal>simple</literal> &eacute;rt&eacute;k&eacute;t
	  haszn&aacute;ljuk, akkor az
	  <filename>/etc/rc.firewall</filename>
	  &aacute;llom&aacute;nyban tal&aacute;lhat&oacute;
	  alap&eacute;rtelmezett szab&aacute;lyokat &eacute;rdemes
	  &aacute;tvizsg&aacute;lnunk, hogy kell&#245;en illeszkednek-e
	  az adott g&eacute;phez.  Hozz&aacute;tenn&eacute;nk, hogy a
	  fejezetben szerepl&#245; p&eacute;ld&aacute;k azt
	  felt&eacute;telezik, hogy a <literal>firewall_script</literal>
	  &eacute;rt&eacute;ke az <filename>/etc/ipfw.rules</filename>
	  &aacute;llom&aacute;ny.</para>
      </note>

      <para>A napl&oacute;z&aacute;s &iacute;gy
	enged&eacute;lyezhet&#245;:</para>

      <programlisting>firewall_logging="YES"</programlisting>

      <warning>
	<para>A <varname>firewall_logging</varname>
	  v&aacute;ltoz&oacute; egyed&uuml;l csak annyit tesz, hogy
	  be&aacute;ll&iacute;tja a
	  <varname>net.inet.ip.fw.verbose</varname> sysctl
	  v&aacute;ltoz&oacute;nak az <literal>1</literal>
	  &eacute;rt&eacute;ket (l&aacute;sd <xref
	  linkend="firewalls-ipfw-enable">).  A napl&oacute;
	  korl&aacute;toz&aacute;s&aacute;ra nincs k&uuml;l&ouml;n
	  v&aacute;ltoz&oacute; az <filename>rc.conf</filename>
	  &aacute;llom&aacute;nyon bel&uuml;l, de az
	  <filename>/etc/sysctl.conf</filename> &aacute;llom&aacute;ny
	  seg&iacute;ts&eacute;g&eacute;vel &eacute;s manu&aacute;lisan
	  be tudjuk &aacute;ll&iacute;tani a hozz&aacute;tartoz&oacute;
	  v&aacute;ltoz&oacute;t:</para>

	<programlisting>net.inet.ip.fw.verbose_limit=5</programlisting>
      </warning>

      <para>Amennyiben a g&eacute;p&uuml;nk
	&aacute;tj&aacute;r&oacute;k&eacute;nt viselkedik, teh&aacute;t
	a &man.natd.8; seg&iacute;ts&eacute;g&eacute;vel
	c&iacute;mford&iacute;t&aacute;st v&eacute;gez, a <xref
	linkend="network-natd">ban olvashatunk ut&aacute;na, hogy ehhez
	az <filename>/etc/rc.conf</filename> &aacute;llom&aacute;nyban
	milyen be&aacute;ll&iacute;t&aacute;sokat kell megadnunk.</para>

    </sect2>

    <sect2 id="firewalls-ipfw-cmd">
      <title>Az IPFW parancs</title>

      <indexterm><primary><command>ipfw</command></primary></indexterm>

      <para>Norm&aacute;l esetben az <command>ipfw</command> parancs
	haszn&aacute;latos arra, hogy a t&#251;zfal
	m&#251;k&ouml;d&eacute;se k&ouml;zben az akt&iacute;v bels&#245;
	szab&aacute;lyai k&ouml;z&eacute; vegy&uuml;nk fel vagy
	t&ouml;r&ouml;lj&uuml;nk k&ouml;z&uuml;l&uuml;k
	manu&aacute;lisan bejegyz&eacute;seket.  Ennek a
	m&oacute;dszernek az egyed&uuml;li h&aacute;tr&aacute;nya, hogy
	az &iacute;gy v&eacute;grehajtott
	m&oacute;dos&iacute;t&aacute;sok el fognak veszni a rendszer
	le&aacute;ll&iacute;t&aacute;s&aacute;val.  Itt ink&aacute;bb
	azt a megold&aacute;st javasoljuk, hogy az &ouml;sszes
	szab&aacute;lyt tegy&uuml;k bele egy &aacute;llom&aacute;nyba
	&eacute;s a rendszerind&iacute;t&aacute;s sor&aacute;n ezt
	t&ouml;lts&uuml;k be, majd ha v&aacute;ltoztatni akarunk a
	t&#251;zfalon, akkor ezt az &aacute;llom&aacute;nyt
	m&oacute;dos&iacute;tsuk &eacute;s a r&eacute;giek
	t&ouml;rl&eacute;s&eacute;vel t&ouml;lts&uuml;k be &uacute;jra
	az eg&eacute;sz szab&aacute;lyrendszert.</para>

      <para>Az <command>ipfw</command> parancs mellesleg remek&uuml;l
	haszn&aacute;lhat&oacute; a jelenleg fut&oacute;
	t&#251;zfalszab&aacute;lyok megjelen&iacute;t&eacute;s&eacute;re
	a konzolon.  Az IPFW nyilv&aacute;ntart&aacute;s&aacute;ban az
	egyes szab&aacute;lyokhoz dinamikusan j&ouml;nnek l&eacute;tre
	sz&aacute;ml&aacute;l&oacute;k, amelyek a r&aacute;
	illeszked&#245; csomagokat sz&aacute;molj&aacute;k.  A
	t&#251;zfal tesztel&eacute;se folyam&aacute;n a szab&aacute;lyok
	&eacute;s hozz&aacute;tartoz&oacute;
	sz&aacute;ml&aacute;l&oacute;k lek&eacute;rdez&eacute;se a
	megfelel&#245; m&#251;k&ouml;d&eacute;s
	ellen&#245;rz&eacute;s&eacute;nek egyik lehets&eacute;ges
	m&oacute;dja.</para>

      <para>A szab&aacute;lyokat &iacute;gy tudjuk egym&aacute;s
	ut&aacute;n felsoroltatni:</para>

      <screen>&prompt.root; <userinput>ipfw list</userinput></screen>

      <para>A szab&aacute;lyokat &iacute;gy tudjuk az utols&oacute;
	illeszked&eacute;s&uuml;k idej&eacute;vel egy&uuml;tt
	megjelen&iacute;teni:</para>

      <screen>&prompt.root; <userinput>ipfw -t list</userinput></screen>

      <para>A k&ouml;vetkez&#245; p&eacute;ld&aacute;ban a
	nyilv&aacute;ntart&aacute;si inform&aacute;ci&oacute;kat
	k&eacute;rdezz&uuml;k le, ekkor a szab&aacute;lyok mellett az
	illeszked&#245; csomagok sz&aacute;ma is
	l&aacute;that&oacute;v&aacute; v&aacute;lik.  Az els&#245;
	sorban a szab&aacute;ly sz&aacute;ma szerepel, majd ezt
	k&ouml;veti rendre az illeszked&#245; kimen&#245; &eacute;s
	bej&ouml;v&#245; csomagok mennyis&eacute;ge, valamint
	v&eacute;g&uuml;l maga a szab&aacute;ly.</para>

      <screen>&prompt.root; <userinput>ipfw -a list</userinput></screen>

      <para>A statikus szab&aacute;lyok mellett a dinamikusakat
	&iacute;gy lehet kilist&aacute;zni:</para>

      <screen>&prompt.root; <userinput>ipfw -d list</userinput></screen>

      <para>A lej&aacute;rt dinamikus szab&aacute;lyokat is meg tudjuk
	n&eacute;zni:</para>

      <screen>&prompt.root; <userinput>ipfw -d -e list</userinput></screen>

      <para>A sz&aacute;ml&aacute;l&oacute;k
	null&aacute;z&aacute;sa:</para>

      <screen>&prompt.root; <userinput>ipfw zero</userinput></screen>

      <para>Csak a <replaceable>SZ&Aacute;M</replaceable>
	sorsz&aacute;m&uacute; szab&aacute;lyhoz tartoz&oacute;
	sz&aacute;ml&aacute;l&oacute;k null&aacute;z&aacute;sa:</para>

      <screen>&prompt.root; <userinput>ipfw zero <replaceable>SZ&Aacute;M</replaceable></userinput></screen>

    </sect2>

    <sect2 id="firewalls-ipfw-rules">
      <title>Szab&aacute;lyrendszerek az IPFW-ben</title>

      <para>Az IPFW eset&eacute;ben a szab&aacute;lyrendszer olyan
	szab&aacute;lyokb&oacute;l &aacute;ll, amelyek a
	csomagokr&oacute;l tartalmuk alapj&aacute;n eld&ouml;ntik, hogy
	&aacute;t kell engedni vagy vissza kell tartani.  A g&eacute;pek
	k&ouml;zt k&eacute;t ir&aacute;nyban &aacute;raml&oacute;
	csomagok egy munkamenet alap&uacute; t&aacute;rsalg&aacute;st
	k&eacute;peznek.  A t&#251;zfalhoz tartoz&oacute;
	szab&aacute;lyrendszer egyar&aacute;nt feldolgozza a
	internetr&#245;l a h&aacute;l&oacute;zatunk fel&eacute;
	igyekv&#245; csomagokat, illetve a h&aacute;l&oacute;zatunk
	ezekre adott v&aacute;laszait.  Az egyes
	<acronym>TCP/IP</acronym> szolg&aacute;ltat&aacute;sokat (mint
	p&eacute;ld&aacute;ul telnet, www, levelez&eacute;s stb.) a
	hozz&aacute;juk tartoz&oacute; protokol &eacute;s
	szabv&aacute;nyos (fogad&oacute;) portsz&aacute;m &iacute;rja
	le.  Ezekre a forr&aacute;sr&oacute;l &aacute;ltal&aacute;ban
	valamilyen nem szabv&aacute;nyos (magasabb
	&eacute;rt&eacute;k&#251;) portr&oacute;l &eacute;rkeznek
	csomagok.  Ekkor a kommunik&aacute;ci&oacute; &ouml;sszes
	param&eacute;tere (vagyis a portok &eacute;s c&iacute;mek)
	b&aacute;rmelyike alapj&aacute;n defini&aacute;lhatunk
	blokkol&aacute;st vagy tov&aacute;bbenged&eacute;st
	le&iacute;r&oacute; szab&aacute;lyokat.</para>

      <indexterm>
	<primary>IPFW</primary>
	<secondary>a szab&aacute;lyok feldolgoz&aacute;s&aacute;nak
	  sorrendje</secondary>
      </indexterm>

      <para>Amikor egy csomag el&eacute;ri a t&#251;zfalat, a
	szab&aacute;lyrendszer els&#245; szab&aacute;ly&aacute;val
	ker&uuml;l &ouml;sszehasonl&iacute;t&aacute;sra &eacute;s
	am&iacute;g nem illeszkedik valamelyikre, addig lefut r&aacute;
	a t&ouml;bbi szab&aacute;ly is fentr&#245;l lefel&eacute;
	egyes&eacute;vel, a sorsz&aacute;muknak megfelel&#245;
	n&ouml;vekv&#245; sorrendben.  Ha a csomag megfelel valamelyik
	szab&aacute;ly lev&aacute;logat&aacute;si param&eacute;tereinek,
	akkor a benne megnevezett cselekv&eacute;s zajlik le, &eacute;s
	sz&aacute;m&aacute;ra a feldolgoz&aacute;s befejez&#245;dik.
	Ezt a viselked&eacute;st nevezt&uuml;k <quote>az els&#245;
	illeszked&eacute;s nyer</quote> t&iacute;pus&uacute;
	keres&eacute;snek.  Amennyiben a csomag egyetlen
	szab&aacute;lyra sem illeszkedik, akkor az IPFW 65535-&ouml;s
	sorsz&aacute;m&uacute; &aacute;lland&oacute; szab&aacute;lya
	fogja elcs&iacute;pni, amely feladata szerint eldobja az
	&ouml;sszes hozz&aacute; be&eacute;rkez&#245; csomagot
	an&eacute;lk&uuml;l, hogy b&aacute;rmit is v&aacute;laszolna a
	csomag felad&oacute;j&aacute;nak.</para>

      <note>
	<para>A keres&eacute;s a <literal>count</literal>,
	  <literal>skipto</literal> &eacute;s <literal>tee</literal>
	  szab&aacute;lyok ut&aacute;n m&eacute;g
	  folytat&oacute;dik.</para>
      </note>

      <para>Az itt szerepl&#245; utas&iacute;t&aacute;sok
	k&uuml;l&ouml;nb&ouml;z&#245; &aacute;llapottart&aacute;sra
	vonatkoz&oacute; opci&oacute;kat, p&eacute;ld&aacute;ul a
	<literal>keep state</literal>, <literal>limit</literal>,
	<literal>in</literal>, <literal>out</literal> &eacute;s
	<literal>via</literal> kulcsszavakat tartalmaz&oacute;
	szab&aacute;lyokon alapulnak.  L&eacute;nyeg&eacute;ben ezt
	tekinthetj&uuml;k az inkluz&iacute;v t&iacute;pus&uacute;
	t&#251;zfalak kiindul&aacute;si alapjak&eacute;nt.</para>

      <warning>
	<para>A t&#251;zfal szab&aacute;lyainak
	  be&aacute;ll&iacute;t&aacute;sa sor&aacute;n nem &aacute;rt
	  &oacute;vatosnak lenn&uuml;nk, mert
	  figyelmetlens&eacute;g&uuml;nk r&eacute;v&eacute;n
	  k&ouml;nnyen kiz&aacute;rathatjuk magunkat a
	  g&eacute;p&uuml;nkr&#245;l.</para>
      </warning>

      <sect3 id="firewalls-ipfw-rules-syntax">
	<title>A szab&aacute;lyok
	  fel&eacute;p&iacute;t&eacute;se</title>

	<indexterm>
	  <primary>IPFW</primary>
	  <secondary>a szab&aacute;lyok
	    fel&eacute;p&iacute;t&eacute;se</secondary>
	</indexterm>

	<para>Az itt bemutat&aacute;sra ker&uuml;l&#245;
	  szab&aacute;lyok fel&eacute;p&iacute;t&eacute;s&eacute;t csak
	  olyan m&eacute;rt&eacute;kig r&eacute;szletezz&uuml;k, ami
	  elenged&#245; a szabv&aacute;nyos inkluz&iacute;v
	  t&iacute;pus&uacute; t&#251;zfalak
	  kialak&iacute;t&aacute;s&aacute;hoz.  A szab&aacute;lyok
	  fel&eacute;p&iacute;t&eacute;s&eacute;nek pontos
	  le&iacute;r&aacute;s&aacute;t az &man.ipfw.8; man
	  oldal&aacute;n tal&aacute;lhatjuk meg.</para>

	<para>A szab&aacute;lyok kulcsszavakat tartalmaznak.  Ezeket a
	  kulcsszavakat soronk&eacute;nt egy el&#245;re
	  r&ouml;gz&iacute;tett sorrendben kell szerepeltetni.  A
	  kulcsszavakat a sz&ouml;vegben kiemelt&uuml;k.  Bizonyos
	  kulcsszavakhoz tov&aacute;bbi opci&oacute;khoz is
	  tartozhatnak, amelyek gyakran maguk is kulcsszavak &eacute;s
	  szint&eacute;n tov&aacute;bbi opci&oacute;kat
	  tartalmazhatnak.</para>

	<para>A <literal>#</literal> egy megjegyz&eacute;s
	  kezdet&eacute;t jelzi, mely egyar&aacute;nt megjelenhet egy
	  k&uuml;l&ouml;n sorban, vagy egy szab&aacute;lyt
	  tartalmaz&oacute; sor v&eacute;g&eacute;n.  Az &uuml;res sorok
	  nem vesznek r&eacute;szt a feldolgoz&aacute;sban.</para>

	<para><replaceable>PARANCS SZAB&Aacute;LY_SZ&Aacute;M
	  CSELEKV&Eacute;S NAPL&Oacute;Z&Aacute;S SZ&#219;R&Eacute;S
	  &Aacute;LLAPOTTART&Aacute;S</replaceable></para>

	<sect4>
	  <title>PARANCS</title>

	  <para>Minden &uacute;j szab&aacute;ly el&#245;ttt az
	    <parameter>add</parameter> (mint hozz&aacute;ad&aacute;s)
	    parancsnak kell szerepelni, amellyel a bels&#245;
	    t&aacute;bl&aacute;zatba tudjuk felvenni.</para>

	</sect4>

	<sect4>
	  <title>SZAB&Aacute;LY_SZ&Aacute;M</title>

	  <para>A szab&aacute;lyokhoz mindig tartozik egy sorsz&aacute;m
	    is.</para>

	</sect4>

	<sect4>
	  <title>CSELEKV&Eacute;S</title>

	  <para>A szab&aacute;lyhoz az al&aacute;bbi cselekv&eacute;sek
	    valamelyike kapcsolhat&oacute;, amely akkor hajt&oacute;dik
	    v&eacute;gre, amikor a csomag megfelel a
	    hozz&aacute;tartoz&oacute; sz&#251;r&eacute;si
	    felt&eacute;teleknek.</para>

	  <para><parameter>allow | accept | pass |
	      permit</parameter></para>

	  <para>A fentiek k&ouml;z&uuml;l mindegyik ugyanazt jelenti,
	    vagyis hat&aacute;sukra az illeszked&#245; csomag
	    kil&eacute;p a t&#251;zfalb&oacute;l.  Ez a szab&aacute;ly
	    meg&aacute;ll&iacute;tja a keres&eacute;st.</para>

	  <para><parameter>check-state</parameter></para>

	  <para>A csomagot a dinamikus szab&aacute;lyokat
	    t&aacute;rol&oacute; t&aacute;bl&aacute;zattal veti
	    &ouml;ssze.  Ha itt egyez&eacute;st tal&aacute;l, akkor
	    v&eacute;grehajtja az egyez&#245; dinamikus
	    szab&aacute;lyhoz tartoz&oacute; cselekv&eacute;st, minden
	    m&aacute;s esetben tov&aacute;bbl&eacute;p a
	    k&ouml;vetkez&#245; szab&aacute;lyra.  Ennek a
	    szab&aacute;lynak nincs illeszthet&#245; param&eacute;tere.
	    Ha a szab&aacute;lyrendszerben nem szerepel ilyen, akkor a
	    dinamikus szab&aacute;lyok vizsg&aacute;lat&aacute;t az
	    els&#245; <literal>keep-state</literal> vagy
	    <literal>limit</literal> haszn&aacute;lat&aacute;n&aacute;l
	    vonja be a rendszer.</para>

	  <para><parameter>deny | drop</parameter></para>

	  <para>Mind a k&eacute;t sz&oacute; ugyanarra utal, vagyis a
	    szab&aacute;lyra illeszked&#245; csomagokat el kell dobni.
	    Ebben az esetben a keres&eacute;s befejez&#245;dik.</para>

	</sect4>

	<sect4>
	  <title>NAPL&Oacute;Z&Aacute;S</title>

	  <para><parameter>log</parameter> vagy
	    <parameter>logamount</parameter></para>

	  <para>Amikor egy csomag egy <literal>log</literal>
	    kulcssz&oacute;t tartalmaz&oacute; szab&aacute;lyra
	    illeszkedik, akkor a rendszernapl&oacute;ban egy &uuml;zenet
	    keletkezik a <literal>security</literal> (biztons&aacute;g)
	    funkci&oacute;n kereszt&uuml;l.  A napl&oacute;ba
	    t&eacute;nylegesen csak akkor ker&uuml;l bele az
	    &uuml;zenet, ha az adott szab&aacute;ly m&eacute;g nem
	    haladta meg a hozz&aacute;tartoz&oacute;
	    <literal>logamount</literal> param&eacute;ter
	    &eacute;rt&eacute;k&eacute;t.  Ha ezt nem adtuk meg, akkor
	    az itt &eacute;rv&eacute;nyes korl&aacute;t a
	    <varname>net.inet.ip.fw.verbose_limit</varname> sysctl
	    v&aacute;ltoz&oacute;b&oacute;l fog sz&aacute;rmazni.  A
	    nulla &eacute;rt&eacute;k mind a k&eacute;t esetben
	    megsz&uuml;nteti ezt a korl&aacute;toz&aacute;st.  Ha
	    el&eacute;rt&uuml;k a korl&aacute;tot, akkor a
	    napl&oacute;z&aacute;st &uacute;gy tudjuk &uacute;jra
	    enged&eacute;lyezni, ha t&ouml;r&ouml;lj&uuml;k a
	    napl&oacute;z&aacute;shoz tartoz&oacute;
	    sz&aacute;ml&aacute;l&oacute; &eacute;rt&eacute;k&eacute;t,
	    l&aacute;sd az <command>ipfw reset log</command>
	    parancsot.</para>

	  <note>
	    <para>A napl&oacute;z&aacute;s mindig az &ouml;sszes
	      param&eacute;ter illeszked&eacute;s&eacute;nek
	      ellen&#245;rz&eacute;se ut&aacute;n t&ouml;rt&eacute;nik,
	      de m&eacute;g a cselekv&eacute;s (accept, deny)
	      elv&eacute;gz&eacute;se el&#245;tt.  Teljesen rajtunk
	      m&uacute;lik, hogyan milyen szab&aacute;lyokat
	      napl&oacute;zunk.</para>
	  </note>

	</sect4>

	<sect4>
	  <title>SZ&#219;R&Eacute;S</title>

	  <para>Ebben a szakaszban azok a kulcsszavak
	    tal&aacute;lhat&oacute;ak, amelyek
	    seg&iacute;ts&eacute;g&eacute;vel a csomagok
	    k&uuml;l&ouml;nb&ouml;z&#245; tulajdons&aacute;gait tudjuk
	    megvizsg&aacute;lni &eacute;s eld&ouml;nteni, hogy
	    illeszkedik-e a szab&aacute;lyra vagy sem.  A
	    k&ouml;vetkez&#245; &aacute;ltal&aacute;nos
	    tulajdons&aacute;gokat tudjuk megvizsg&aacute;lni, ebben a
	    k&ouml;t&ouml;tt sorrendben:</para>

	  <para><parameter>udp | tcp | icmp</parameter></para>

	  <para>B&aacute;rmilyen m&aacute;s olyan protokoll is
	    megadhat&oacute;, amely megtal&aacute;lhat&oacute; az
	    <filename>/etc/protocols</filename>
	    &aacute;llom&aacute;nyban.  Ezzel adjuk a csomaghoz
	    tartoz&oacute; protokollt.  Haszn&aacute;lata
	    k&ouml;telez&#245;.</para>

	  <para><parameter>from <replaceable>forr&aacute;s</replaceable>
	    to <replaceable>c&eacute;l</replaceable></parameter></para>

	  <para>Mind a <literal>from</literal> &eacute;s
	    <literal>to</literal> kulcsszavak IP-c&iacute;mek
	    illeszt&eacute;s&eacute;re alkalmasak.  A
	    szab&aacute;lyoknak tartalmazniuk kell a
	    <replaceable>forr&aacute;s</replaceable> &Eacute;S a
	    <replaceable>c&eacute;l</replaceable> param&eacute;tereket
	    is.  Az <literal>any</literal> egy olyan kulcssz&oacute;,
	    amely tetsz&#245;leges IP-c&iacute;mre illeszkedik.  A
	    <literal>me</literal> pedig egy olyan speci&aacute;lis
	    kulcssz&oacute;, amely a t&#251;zfalat
	    m&#251;k&ouml;dtet&#245; &os;-s g&eacute;p (teh&aacute;t ez
	    a g&eacute;p) adott interf&eacute;szhez tartoz&oacute;
	    IP-c&iacute;m&eacute;t jel&ouml;li, mint ahogy a
	    <literal>from me to any</literal>, <literal>from any to
	    me</literal>, <literal>from 0.0.0.0/0 to any</literal>,
	    <literal>from any to 0.0.0.0/0</literal>, <literal>from
	    0.0.0.0 to any</literal>, <literal>from any to
	    0.0.0.0</literal> vagy <literal>from me to 0.0.0.0</literal>
	    param&eacute;terekben.  Az IP-c&iacute;mek numerikus
	    pontozott form&aacute;ban a h&aacute;l&oacute;zati maszk
	    hossz&aacute;val egy&uuml;tt (CIDR-jel&ouml;l&eacute;ssel),
	    vagy egyszer&#251;en csak pontozott form&aacute;ban
	    adhat&oacute;ak meg.  A h&aacute;l&oacute;zati maszkok
	    meg&aacute;llap&iacute;t&aacute;s&aacute;ban a <filename
	      role="package">net-mgmt/ipcalc</filename> port lehet
	    seg&iacute;ts&eacute;g&uuml;nkre.  Err&#245;l b&#245;vebb
	    inform&aacute;ci&oacute;kat a seg&eacute;dprogram
	    honlapj&aacute;n, a <ulink
	      url="http://jodies.de/ipcalc"></ulink> c&iacute;men
	    tal&aacute;lhatunk (angolul).</para>

	  <para><parameter>port
	    <replaceable>sz&aacute;m</replaceable></parameter></para>

	  <para>A portsz&aacute;mokat is ismer&#245; protokollok
	    eset&eacute;ben (mint p&eacute;ld&aacute;ul a
	    <acronym>TCP</acronym> vagy <acronym>UDP</acronym>) adhatjuk
	    meg.  Fontos, hogy itt annak a szolg&aacute;ltat&aacute;snak
	    a portsz&aacute;m&aacute;t adjuk meg, amelyre a
	    szab&aacute;ly vonatkozik.  A szolg&aacute;ltat&aacute;s (az
	    <filename>/etc/services</filename>
	    &aacute;llom&aacute;nyb&oacute;l sz&aacute;rmaz&oacute;)
	    nev&eacute;t is megadhatjuk a port sz&aacute;ma
	    helyett.</para>

	  <para><parameter>in | out</parameter></para>

	  <para>A be&eacute;rkez&#245; valamint a kimen&#245; csomagokat
	    adhatjuk meg ezen a m&oacute;don.  Itt az
	    <literal>in</literal> &eacute;s <literal>out</literal>
	    kulcsszavak, melyeket k&ouml;telez&#245; megadni a
	    szab&aacute;ly r&eacute;szek&eacute;nt.</para>

	  <para><parameter>via
	    <replaceable>interf&eacute;sz</replaceable></parameter></para>

	  <para>N&eacute;v szerint az adott interf&eacute;szen
	    kereszt&uuml;l halad&oacute; csomagokat tudjuk sz&#251;rni.
	    A <literal>via</literal> kulcssz&oacute;
	    hat&aacute;s&aacute;ra a haszn&aacute;lt interf&eacute;sz is
	    sz&aacute;m&iacute;tani fog a csomag feldolgoz&aacute;sa
	    sor&aacute;n.</para>

	  <para><parameter>setup</parameter></para>

	  <para>Ez a kulcssz&oacute; a <acronym>TCP</acronym> csomagok
	    eset&eacute;ben a kapcsolatok
	    fel&eacute;p&iacute;t&eacute;s&eacute;re vonatkoz&oacute;
	    k&eacute;r&eacute;seket seg&iacute;t
	    beazonos&iacute;tani.</para>

	  <para><parameter>keep-state</parameter></para>

	  <para>Ez egy k&ouml;telez&#245; kulcssz&oacute;.
	    Feldolgoz&aacute;sakor a t&#251;zfal l&eacute;trehoz
	    dinamikus szab&aacute;lyt, amely
	    alap&eacute;rtelmez&eacute;s szerint az egyazon protokollt
	    haszn&aacute;l&oacute; forr&aacute;s &eacute;s c&eacute;l
	    IP/port p&aacute;rosok k&ouml;zti
	    k&eacute;tir&aacute;ny&uacute; forgalomra fog automatikusan
	    illeszkedni.</para>

	  <para><parameter>limit
	    {<replaceable>forr&aacute;sc&iacute;m</replaceable> |
	    <replaceable>forr&aacute;sport</replaceable> |
	    <replaceable>c&eacute;lc&iacute;m</replaceable> |
	    <replaceable>c&eacute;lport</replaceable>}</parameter></para>

	  <para>A t&#251;zfal csak <replaceable>N</replaceable> darab, a
	    szab&aacute;lynak megfelel&#245; azonos
	    param&eacute;ter&#251; kapcsolatot fog &aacute;tengedi.  Itt
	    egy vagy t&ouml;bb forr&aacute;s- &eacute;s
	    c&eacute;lc&iacute;m valamint forr&aacute;s- &eacute;s
	    c&eacute;lport adhat&oacute; meg.  A
	    <literal>limit</literal> &eacute;s a
	    <literal>keep-state</literal> egy szab&aacute;lyon
	    bel&uuml;l nem haszn&aacute;lhat&oacute;.  A
	    <literal>limit</literal> ugyanazokat az
	    &aacute;llapottart&oacute; funkci&oacute;kat
	    k&eacute;pviseli, mint a <literal>keep-state</literal>, csak
	    a saj&aacute;t kieg&eacute;sz&iacute;t&eacute;seivel
	    megtoldva.</para>

	</sect4>
      </sect3>

      <sect3>
	<title>&Aacute;LLAPOTTART&Aacute;S</title>

	<indexterm>
	  <primary>IPFW</primary>
	  <secondary>&aacute;llapottart&oacute;
	    sz&#251;r&eacute;s</secondary>
	</indexterm>

	<para>Az &aacute;llapottart&oacute; sz&#251;r&eacute;s a
	  k&eacute;tir&aacute;ny&uacute; csomagv&aacute;lt&aacute;sokat
	  egy l&eacute;trej&ouml;tt kapcsolatba sorolja.  Olyan
	  vizsg&aacute;latokat v&eacute;gez, amivel k&eacute;pes
	  meg&aacute;llap&iacute;tani, hogy a csomag k&uuml;ld&#245;je
	  &eacute;s c&iacute;mzettje k&ouml;z&ouml;tt kialakult
	  kommunik&aacute;ci&oacute; k&ouml;vet-e valamilyen
	  k&eacute;tir&aacute;ny&uacute; csomagk&uuml;ld&eacute;sre
	  &eacute;rv&eacute;nyes folyamatot.  Az &iacute;gy
	  fel&aacute;ll&iacute;tott sablont&oacute;l elt&eacute;r&#245;
	  &ouml;sszes csomag hamisnak min&#245;s&uuml;l &eacute;s
	  automatikusan eldob&aacute;sra ker&uuml;l.</para>

	<para>A <literal>check-state</literal>
	  seg&iacute;ts&eacute;g&eacute;vel ellen&#245;rizhetj&uuml;k,
	  hogy az adott csomag a IPFW szerint megfelel-e valamelyik
	  dinamikusan lek&eacute;pzett szab&aacute;lynak.  Ha egyezik
	  valamelyik&#245;j&uuml;kkel, akkor a csomag a
	  t&#251;zfalb&oacute;l kil&eacute;pve folytatja
	  &uacute;tj&aacute;t &eacute;s a kommunik&aacute;ci&oacute;ban
	  soron k&ouml;vetkez&#245; csomag sz&aacute;m&aacute;ra
	  l&eacute;trej&ouml;n egy m&aacute;sik dinamikus
	  szab&aacute;ly.  Ha nincs egyez&eacute;s, akkor csomag
	  feldolgoz&aacute;sa a szab&aacute;lyrendszer
	  k&ouml;vetkez&#245; szab&aacute;ly&aacute;n&aacute;l
	  folytat&oacute;dik.</para>

	<para>A dinamikus szab&aacute;lyokat kezel&#245; rutin
	  sebezhet&#245;, mivel ha egyszerre nagy mennyis&eacute;g&#251;
	  SYN csomagot k&uuml;ld&uuml;nk, akkor olyan sok dinamikus
	  bejegyz&eacute;s keletkezik, hogy egyszer&#251;en kifogyunk a
	  rendelkez&eacute;sre &aacute;ll&oacute;
	  er&#245;forr&aacute;sokb&oacute;l.  A &os; fejleszt&#245;i
	  azonban az ilyen term&eacute;szet&#251;
	  t&aacute;mad&aacute;sok kiv&eacute;d&eacute;s&eacute;re is
	  felk&eacute;sz&iacute;tett&eacute;k, &eacute;s
	  kialak&iacute;tott&aacute;k bel&#245;le a
	  <literal>limit</literal> opci&oacute;t.
	  Alkalmaz&aacute;s&aacute;val le tudjuk korl&aacute;tozni az
	  egyszerre foly&oacute; p&aacute;rhuzamos kapcsolatok
	  sz&aacute;m&aacute;t a forr&aacute;s vagy a c&eacute;l a
	  <literal>limit</literal> param&eacute;tern&eacute;l megadott
	  mez&#245;inek &eacute;s a csomag IP-c&iacute;me
	  alapj&aacute;n.  &Iacute;gy az adott szab&aacute;lyhoz
	  &eacute;s IP-c&iacute;mhez csak el&#245;re
	  r&ouml;gz&iacute;tett mennyis&eacute;g&#251; nyitott
	  &aacute;llapot&uacute; dinamikus szab&aacute;ly
	  l&eacute;tezhet egy id&#245;ben.  Ha ezt a korl&aacute;tot
	  &aacute;tl&eacute;pj&uuml;k, a csomag eldob&oacute;dik.</para>
      </sect3>

      <sect3>
	<title>A t&#251;zfal &uuml;zeneteinek
	  napl&oacute;z&aacute;sa</title>

	<indexterm>
	  <primary>IPFW</primary>
	  <secondary>napl&oacute;z&aacute;s</secondary>
	</indexterm>

	<para>A napl&oacute;z&aacute;s el&#245;nyei
	  nyilv&aacute;nval&oacute;ak.  Ha enged&eacute;lyezz&uuml;k,
	  aktiv&aacute;l&aacute;sa ut&aacute;n k&eacute;pesek
	  lesz&uuml;nk olyan inform&aacute;ci&oacute;knak
	  ut&aacute;nan&eacute;zni, mint p&eacute;ld&aacute;ul milyen
	  csomagokat dobtunk el, honnan &eacute;rkeztek, hova tartottak.
	  Ez egy komoly fegyver&uuml;nk lehet a potenci&aacute;lis
	  t&aacute;mad&oacute;kkal szemben.</para>

	<para>Azonban hi&aacute;ba enged&eacute;lyezz&uuml;nk
	  &ouml;nmag&aacute;ban a napl&oacute;z&aacute;st, att&oacute;l
	  az IPFW m&eacute;g saj&aacute;t mag&aacute;t&oacute;l nem fog
	  napl&oacute;z&aacute;st el&#245;&iacute;r&oacute;
	  szab&aacute;lyokat gy&aacute;rtani.  A t&#251;zfal
	  karbantart&oacute;inak maguknak kell eld&ouml;ntenie, hogy a
	  szab&aacute;lyrendszerben mely szab&aacute;lyokhoz tartozzon
	  napl&oacute;z&aacute;s, nekik kell felvenni ezekhez a
	  <literal>log</literal> kulcssz&oacute;t.
	  &Aacute;ltal&aacute;ban csak az eldob&aacute;ssal
	  j&aacute;r&oacute; <literal>deny</literal>
	  t&iacute;pus&uacute; szab&aacute;lyokat vagy a
	  bej&ouml;v&#245; <acronym>ICMP</acronym> pingeket
	  szokt&aacute;k napl&oacute;zni.  Gyakran &uacute;gy
	  oldj&aacute;k meg ezt, hogy a szab&aacute;lyrendszer
	  utols&oacute; szab&aacute;lyak&eacute;nt
	  lem&aacute;solj&aacute;k az <command>ipfw</command>
	  alap&eacute;rtelmezett <quote>mindent eldobunk</quote>
	  szab&aacute;ly&aacute;t &eacute;s a napl&oacute;z&aacute;st
	  adj&aacute;k meg benne.  Ezen a m&oacute;don f&eacute;ny
	  der&uuml;l azokra a csomagokra, amelyek a
	  szab&aacute;lyrendszerben semmire sem illeszkedtek.</para>

	<para>A napl&oacute;z&aacute;s azonban egy
	  k&eacute;t&eacute;l&#251; fegyver, mivel ha nem vagyunk
	  el&eacute;g k&ouml;r&uuml;ltekint&#245;ek, akkor a sok
	  napl&oacute;inform&aacute;ci&oacute; k&ouml;z&ouml;tt
	  k&ouml;nnyen el tudunk veszni &eacute;s a lemez&uuml;nk is
	  gyorsan betelhet a mindent elfoglal&oacute;
	  napl&oacute;kt&oacute;l.  Mellesleg a napl&oacute;k
	  megdagaszt&aacute;s&aacute;t c&eacute;lz&oacute; DoS
	  t&iacute;pus&uacute; t&aacute;mad&aacute;s a rendszerek
	  leb&eacute;n&iacute;t&aacute;s&aacute;ra alkalmazott egyik
	  leg&#245;sibb technika.  Ezek az &uuml;zenetek nem csak a
	  rendszernapl&oacute;ba ker&uuml;lnek bele, hanem az
	  els&#245;dleges konzol k&eacute;perny&#245;j&eacute;re is
	  ki&iacute;r&oacute;dnak, ami egy id&#245; ut&aacute;n
	  ideges&iacute;t&#245; tud lenni.</para>

	<para>A rendszermag
	  <literal>IPFIREWALL_VERBOSE_LIMIT=5</literal>
	  be&aacute;ll&iacute;t&aacute;s&aacute;val azonban
	  k&eacute;pesek vagyunk korl&aacute;tozni azokat a
	  rendszernapl&oacute; fel&eacute; k&uuml;ld&ouml;tt
	  egym&aacute;s ut&aacute;n k&ouml;vetkez&#245; &uuml;zeneteket,
	  amelyek ugyanarra a szab&aacute;lyra vonatkoznak.  Amikor ezt
	  a be&aacute;ll&iacute;t&aacute;st megadjuk a rendszermag
	  ford&iacute;t&aacute;s&aacute;n&aacute;l, akkor az egyes
	  szab&aacute;lyokhoz az &aacute;ltala meghat&aacute;rozott
	  &eacute;rt&eacute;ken fel&uuml;l nem j&ouml;n l&eacute;tre
	  t&ouml;bb hasonl&oacute; &uuml;zenet.  Hiszen semmi sem
	  der&uuml;l ki 200 teljesen azonos
	  napl&oacute;&uuml;zenetb&#245;l.  P&eacute;ld&aacute;ul, ha az
	  egyes szab&aacute;lyokhoz legfeljebb &ouml;t egym&aacute;st
	  k&ouml;vet&#245; &uuml;zenetet enged&eacute;lyez&uuml;nk,
	  akkor a t&ouml;bbi fennmarad&oacute; azonos &uuml;zenetet
	  &ouml;sszesz&aacute;molja a rendszer &eacute;s a
	  k&ouml;vetkez&#245; m&oacute;don k&ouml;zvet&iacute;ti a
	  rendszernapl&oacute;z&oacute; szolg&aacute;ltat&aacute;s
	  fel&eacute;:</para>

	<programlisting>last message repeated 45 times</programlisting>

	<para>Ami magyarul &iacute;gy hangzik:</para>

	<programlisting>az utols&oacute; &uuml;zenet 45 alkalommal ism&eacute;tl&#245;d&ouml;tt meg</programlisting>

	<para>Az &ouml;sszes csomagokkal kapcsolatos
	  napl&oacute;z&aacute;s alap&eacute;rtelmez&eacute;s szerint a
	  <filename>/var/log/security</filename>
	  &aacute;llom&aacute;nyba ker&uuml;l, amelyet az
	  <filename>/etc/syslog.conf</filename> &aacute;llom&aacute;ny
	  defini&aacute;l.</para>

      </sect3>

      <sect3 id="firewalls-ipfw-rules-script">
	<title>Szab&aacute;lyokat tartalmaz&oacute; szkript
	  k&eacute;sz&iacute;t&eacute;se</title>

	<para>A rutinosabb IPFW felhaszn&aacute;l&oacute;k a
	  szab&aacute;lyokat egy &aacute;llom&aacute;nyban
	  programozz&aacute;k le olyan st&iacute;lusban, hogy
	  szkriptk&eacute;nt is futtathat&oacute; legyen.  Ennek az
	  egyik legnagyobb el&#245;nye, hogy a t&#251;zfal
	  szab&aacute;lyai &iacute;gy egyszerre cser&eacute;lhet&#245;ek
	  a rendszer &uacute;jraind&iacute;t&aacute;sa
	  n&eacute;lk&uuml;l.  Ez a m&oacute;dszer nagyon
	  k&eacute;nyelmes az &uacute;j szab&aacute;lyok
	  kipr&oacute;b&aacute;l&aacute;s&aacute;n&aacute;l, mivel
	  tetsz&#245;leges alkalommal v&eacute;grehajthatjuk.  Mivel ez
	  egy szkript, ki tudjuk haszn&aacute;lni az itt megszokott
	  szimbolikus helyettes&iacute;t&eacute;s &aacute;ltal
	  felk&iacute;n&aacute;lt lehet&#245;s&eacute;geket, &eacute;s
	  ezzel a gyakran haszn&aacute;lt &eacute;rt&eacute;keket is
	  egyszerre t&ouml;bb szab&aacute;lyban tudjuk
	  helyettes&iacute;teni.  Erre a k&ouml;vetkez&#245;kben fogunk
	  egy konkr&eacute;t p&eacute;ld&aacute;t l&aacute;tni.</para>

	<para>A szkript fel&eacute;p&iacute;t&eacute;se kompatibilis a
	  &man.sh.1;, &man.csh.1; &eacute;s &man.tcsh.1;
	  parancs&eacute;rtelmez&#245;kkel.  A szimbolikus mez&#245;k
	  helyettes&iacute;t&eacute;s&eacute;t a &dollar; vagyis
	  doll&aacute;rjel vezeti be.  Maguk a szimbolikus mez&#245;k
	  nem tartalmazz&aacute;k a &dollar; el&#245;tagot.  A
	  szimbolikus mez&#245;k &eacute;rt&eacute;keit "kett&#245;s
	  id&eacute;z&#245;jelek" k&ouml;z&ouml;tt kell megadni.</para>

	<para>A szab&aacute;lyok &ouml;ssze&iacute;r&aacute;s&aacute;t
	  kezdj&uuml;k el &iacute;gy:</para>

	<programlisting>####### itt kezd&#245;dik az ipfw szab&aacute;lyait tartalmaz&oacute; szkript ######
#
ipfw -q -f flush       # t&ouml;r&ouml;lj&uuml;k az &ouml;sszes aktu&aacute;lis szab&aacute;lyt
# Set defaults
oif="tun0"             # a kimen&#245; interf&eacute;sz
odns="192.0.2.11"      # az internet szolg&aacute;ltat&oacute; n&eacute;vszerver&eacute;nek IP-c&iacute;me
cmd="ipfw -q add "     # a szab&aacute;lyok hozz&aacute;ad&aacute;s&aacute;hoz sz&uuml;ks&eacute;ges elemek
ks="keep-state"        # csup&aacute;n a lustas&aacute;g miatt
&dollar;cmd 00500 check-state
&dollar;cmd 00502 deny all from any to any frag
&dollar;cmd 00501 deny tcp from any to any established
&dollar;cmd 00600 allow tcp from any to any 80 out via &dollar;oif setup &dollar;ks
&dollar;cmd 00610 allow tcp from any to &dollar;odns 53 out via &dollar;oif setup &dollar;ks
&dollar;cmd 00611 allow udp from any to &dollar;odns 53 out via &dollar;oif &dollar;ks
#### itt fejez&#245;dik be az ipfw szab&aacute;lyait tartalmaz&oacute; szkript ######</programlisting>

	<para>Ezzel k&eacute;szen is vagyunk.  Most ne
	  t&ouml;r&#245;dj&uuml;nk a p&eacute;ld&aacute;ban
	  szerepl&#245; szab&aacute;lyokkal, itt most a szimbolikus
	  helyettes&iacute;t&eacute;s haszn&aacute;lat&aacute;t
	  igyekezt&uuml;k bemutatni.</para>

	<para>Ha az im&eacute;nti p&eacute;ld&aacute;t az
	  <filename>/etc/ipfw.rules</filename> &aacute;llom&aacute;nyba
	  mentett&uuml;k el, akkor az al&aacute;bbi parancs
	  kiad&aacute;s&aacute;val tudjuk &uacute;jrat&ouml;lteni a
	  benne szerepl&#245; szab&aacute;lyokat:</para>

	<screen>&prompt.root; <userinput>sh /etc/ipfw.rules</userinput></screen>

	<para>Az <filename>/etc/ipfw.rules</filename>
	  &aacute;llom&aacute;nyt egy&eacute;bk&eacute;nt
	  tetsz&#245;leges n&eacute;ven h&iacute;vhatjuk &eacute;s
	  b&aacute;rhov&aacute; rakhatjuk.</para>

	<para>Ugyanez term&eacute;szetesen el&eacute;rhet&#245; a
	  k&ouml;vetkez&#245; parancsok egym&aacute;s ut&aacute;ni
	  beg&eacute;pel&eacute;s&eacute;vel is:</para>

	<screen>&prompt.root; <userinput>ipfw -q -f flush</userinput>
&prompt.root; <userinput>ipfw -q add check-state</userinput>
&prompt.root; <userinput>ipfw -q add deny all from any to any frag</userinput>
&prompt.root; <userinput>ipfw -q add deny tcp from any to any established</userinput>
&prompt.root; <userinput>ipfw -q add allow tcp from any to any 80 out via tun0 setup keep-state</userinput>
&prompt.root; <userinput>ipfw -q add allow tcp from any to 192.0.2.11 53 out via tun0 setup keep-state</userinput>
&prompt.root; <userinput>ipfw -q add 00611 allow udp from any to 192.0.2.11 53 out via tun0 keep-state</userinput></screen>
      </sect3>

      <sect3>
	<title>&Aacute;llapottart&oacute;
	  szab&aacute;lyrendszerek</title>

	<para>A most k&ouml;vetkez&#245;
	  c&iacute;mford&iacute;t&aacute;s n&eacute;lk&uuml;li
	  szab&aacute;lyrendszer arra mutat p&eacute;ld&aacute;t, hogyan
	  val&oacute;s&iacute;tsunk meg egy biztons&aacute;gos
	  <quote>inkluz&iacute;v</quote> t&#251;zfalat.  Az
	  inkluz&iacute;v t&#251;zfalak csak a szab&aacute;lyainak
	  megfelel&#245; szolg&aacute;ltat&aacute;sokat engedik
	  &aacute;t, minden m&aacute;st alap&eacute;rtelmez&eacute;s
	  szerint tiltanak.  A komplett h&aacute;l&oacute;zati
	  szegmensek v&eacute;delm&eacute;re
	  &ouml;ssze&aacute;ll&iacute;tott t&#251;zfalaknak
	  legal&aacute;bb k&eacute;t interf&eacute;sz&uuml;k van,
	  amelyek mindegyik&eacute;hez tartoznia kell
	  szab&aacute;lyoknak a megfelel&#245;
	  m&#251;k&ouml;d&eacute;shez.</para>

	<para>Az &unix; mint&aacute;j&uacute; oper&aacute;ci&oacute;s
	  rendszer, k&ouml;zt&uuml;l a &os; is olyan, hogy a rendszerben
	  bel&uuml;li kommunik&aacute;ci&oacute;t a
	  <devicename>lo0</devicename> nev&#251; interf&eacute;szen
	  &eacute;s a <hostid role="ipaddr">127.0.0.1</hostid>
	  IP-c&iacute;men bonyol&iacute;tja le.  A t&#251;zfalban
	  mindenk&eacute;ppen szerepelni&uuml;k kell olyan
	  szab&aacute;lyoknak, amelyek gondoskodnak ezen
	  speci&aacute;lis bels&#245; csomagok zavartalan
	  k&ouml;zleked&eacute;s&eacute;r&#245;l.</para>

	<para>Az internet fel&eacute; csatlakoz&oacute; interf&eacute;sz
	  lesz az, amelyen kereszt&uuml;l a kifel&eacute; men&#245;
	  k&eacute;r&eacute;seket hiteles&iacute;tj&uuml;k &eacute;s
	  vez&eacute;relj&uuml;k az internet
	  el&eacute;r&eacute;s&eacute;t, valamint ahol sz&#251;rj&uuml;k
	  az internet fel&#245;l &eacute;rkez&#245;
	  k&eacute;r&eacute;seket.  Ez lehet a <acronym>PPP</acronym>
	  eset&eacute;ben a <devicename>tun0</devicename> eszk&ouml;z,
	  vagy a DSL-, illetve k&aacute;belmodemhez csatlakoz&oacute;
	  h&aacute;l&oacute;zati k&aacute;rtya.</para>

	<para>Abban az esetben, amikor egy vagy t&ouml;bb
	  h&aacute;l&oacute;zati k&aacute;rty&aacute;val csatlakozunk a
	  t&#251;zfal m&ouml;g&ouml;tt tal&aacute;lhat&oacute;
	  bels&#245; helyi h&aacute;l&oacute;zatra, szint&eacute;n
	  gondoskodnunk kell a helyi h&aacute;l&oacute;zaton bel&uuml;l
	  mozg&oacute; csomagok akad&aacute;lymentes
	  tov&aacute;bb&iacute;t&aacute;s&aacute;r&oacute;l.</para>

	<para>A szab&aacute;lyokat el&#245;sz&ouml;r h&aacute;rom
	  nagyobb oszt&aacute;lyba kell sorolnunk: az &ouml;sszes
	  szabadon forgalmaz&oacute; interf&eacute;sz, a publikus
	  kimen&#245; &eacute;s a publikus bej&ouml;v&#245;
	  interf&eacute;sz csoportj&aacute;ba.</para>

	<para>A publikus interf&eacute;szekhez tartoz&oacute;
	  csoportokban &uacute;gy kell rendezn&uuml;nk a
	  szab&aacute;lyokat, hogy el&#245;re ker&uuml;ljenek a
	  gyakrabban haszn&aacute;ltak &eacute;s h&aacute;tra a
	  kev&eacute;sb&eacute; haszn&aacute;ltak, valamint a csoportok
	  utols&oacute; szab&aacute;lya blokkoljon &eacute;s
	  napl&oacute;zzon minden csomagot az adott interf&eacute;szen
	  &eacute;s ir&aacute;nyban.</para>

	<para>A k&ouml;vetkez&#245; szab&aacute;lyrendszerben
	  szerepl&#245;, a kimen&#245; kapcsolatokat tartalmaz&oacute;
	  csoport csak olyan <literal>allow</literal>
	  t&iacute;pus&uacute; szab&aacute;lyokat tartalmaz, amelyek
	  sz&#251;r&eacute;si felt&eacute;telei egy&eacute;rtelm&#251;en
	  azonos&iacute;tj&aacute;k az interneten el&eacute;rhet&#245;
	  szolg&aacute;ltat&aacute;sokat.  Az &ouml;sszes
	  szab&aacute;lyban megjelennek a <literal>proto</literal>,
	  <literal>port</literal>,
	  <literal>in</literal>/<literal>out</literal>,
	  <literal>via</literal> &eacute;s <literal>keep
	  state</literal> opci&oacute;k.  A <literal>proto
	  tcp</literal> szab&aacute;lyokban emellett szerepel m&eacute;g
	  egy <literal>setup</literal> opci&oacute; is, amellyel a
	  kapcsolatokat kezdem&eacute;nyez&#245; csomagokat tudjuk
	  azonos&iacute;tani &eacute;s felvenni az
	  &aacute;llapottart&aacute;s&eacute;rt felel&#245;s dinamikus
	  szab&aacute;lyok k&ouml;z&eacute;.</para>

	<para>A bej&ouml;v&#245; forgalmat vez&eacute;rl&#245;
	  szab&aacute;lyrendszerben el&#245;sz&ouml;r az eldobni
	  k&iacute;v&aacute;nt csomagokat kell megadni, aminek
	  k&eacute;t elt&eacute;r&#245; oka van.  El&#245;sz&ouml;r is
	  el&#245;fordulhat, hogy a vesz&eacute;lyes csomagok
	  r&eacute;szleges illeszked&eacute;s miatt szab&aacute;lyosnak
	  t&#251;nnek.  Az ilyen csomagokat &eacute;rtelemszer&#251;en
	  nem lenne szabad beengedni a szab&aacute;lyok r&eacute;szleges
	  megfelel&eacute;se alapj&aacute;n.  A m&aacute;sodszor az
	  eleve ismerten probl&eacute;m&aacute;s &eacute;s
	  &eacute;rtelmetlen csomagokat csendben el kellene vetni,
	  miel&#245;tt a szakaszhoz tartoz&oacute; utols&oacute;
	  szab&aacute;ly fogn&aacute; meg &eacute;s
	  napl&oacute;zn&aacute;.  Ez az utols&oacute; szab&aacute;ly
	  egy&eacute;bk&eacute;nt sz&uuml;ks&eacute;g eset&eacute;n
	  felhaszn&aacute;lhat&oacute; a t&aacute;mad&oacute;k elleni
	  bizony&iacute;t&eacute;kok
	  begy&#251;jt&eacute;s&eacute;re.</para>

	<para>A m&aacute;sik, amire m&eacute;g oda kell figyeln&uuml;nk,
	  hogy a blokkolt csomagok eset&eacute;ben semmilyen
	  v&aacute;lasz nem keletkezzen, egyszer&#251;en csak
	  t&#251;njenek el.  &Iacute;gy a t&aacute;mad&oacute; nem fogja
	  tudni, hogy a csomagjai vajon el&eacute;rt&eacute;k-e a
	  rendszer&uuml;nket.  Min&eacute;l kevesebb
	  inform&aacute;ci&oacute;t tudnak &ouml;sszegy&#251;jteni a
	  rendszer&uuml;nkr&#245;l a t&aacute;mad&oacute;k, ann&aacute;l
	  biztons&aacute;gosabbnak tekinthet&#245;.
	  Amikor ismeretlen portokra &eacute;rkez&#245; csomagokat
	  napl&oacute;zunk, &eacute;rdemes az
	  <filename>/etc/services/</filename> &aacute;llom&aacute;nyban
	  vagy <ulink
	    url="http://www.securitystats.com/tools/portsearch.php"></ulink>
	  c&iacute;men (angolul) ut&aacute;nan&eacute;zni a porthoz
	  tartoz&oacute; szolg&aacute;ltat&aacute;snak.  A
	  k&uuml;l&ouml;nb&ouml;z&#245; tr&oacute;jai programok
	  &aacute;ltal portok sz&aacute;mai ezen a linken
	  &eacute;rhet&#245;ek el (angolul): <ulink
	    url="http://www.simovits.com/trojans/trojans.html"></ulink>.</para>
      </sect3>

      <sect3>
	<title>P&eacute;lda egy inkluz&iacute;v
	  szab&aacute;lyrendszerre</title>

	<para>A most k&ouml;vetkez&#245;,
	  c&iacute;mford&iacute;t&aacute;st nem tartalmaz&oacute;
	  szab&aacute;lyrendszer teljesen inkluz&iacute;v
	  t&iacute;pus&uacute;.  les rendszereken is nyugodtan
	  alkalmazhatjuk.  Egyszer&#251;en csak annyit kell
	  tenn&uuml;nk, hogy megjegyz&eacute;sbe tessz&uuml;k az olyan
	  szolg&aacute;ltat&aacute;sokra vonatkoz&oacute;
	  szab&aacute;lyokat, amelyeket nem akarunk enged&eacute;lyezni.
	  Amikor pedig olyan &uuml;zenetek jelennek meg a
	  napl&oacute;ban, amelyeket nem akarunk tov&aacute;bb
	  l&aacute;tni, a bej&ouml;v&#245; kapcsolatokhoz vegy&uuml;nk
	  fel egy <literal>deny</literal> t&iacute;pus&uacute;
	  szab&aacute;lyt hozz&aacute;juk.  Minden szab&aacute;lyban
	  cser&eacute;lj&uuml;k ki a <literal>dc0</literal>
	  interf&eacute;szt arra a h&aacute;l&oacute;zati
	  k&aacute;rty&aacute;ra, amely k&ouml;zvetlen&uuml;l
	  csatlakoztatja rendszer&uuml;nket az internethez.  A
	  felhaszn&aacute;l&oacute;i <acronym>PPP</acronym>
	  eset&eacute;ben ez a <literal>tun0</literal>.</para>

	<para>A szab&aacute;lyok haszn&aacute;lat&aacute;ban
	  felfedezhet&uuml;nk egyfajta
	  rendszerszer&#251;s&eacute;get:</para>

	<itemizedlist>
	  <listitem>
	    <para>Mindegyik sorban, ahol az internet fel&eacute; nyitunk
	      meg egy kapcsolatot, a <literal>keep-state</literal>
	      opci&oacute;t haszn&aacute;ljuk.</para>
	  </listitem>

	  <listitem>
	    <para>Az internetr&#245;l az &ouml;sszes hiteles&iacute;tett
	      szolg&aacute;ltat&aacute;s el&eacute;r&eacute;se
	      tartalmazza a <literal>limit</literal> opci&oacute;t az
	      el&aacute;raszt&aacute;sok kiv&eacute;d&eacute;se
	      miatt.</para>
	  </listitem>

	  <listitem>
	    <para>Az &ouml;sszes szab&aacute;lyban az
	      <literal>in</literal> vagy az <literal>out</literal>
	      param&eacute;terrel megadjuk sz&#251;rni
	      k&iacute;v&aacute;nt forgalom
	      ir&aacute;ny&aacute;t.</para>
	  </listitem>

	  <listitem>
	    <para>Az &ouml;sszes szab&aacute;lyban szerepel a
	      <literal>via</literal> param&eacute;terrel a csomagokat
	      tov&aacute;bb&iacute;t&oacute; interf&eacute;sz
	      neve.</para>
	  </listitem>
	</itemizedlist>

	<para>Az al&aacute;bbi szab&aacute;lyokat tegy&uuml;k az
	  <filename>/etc/ipfw.rules</filename>
	  &aacute;llom&aacute;nyba.</para>

	<programlisting>############## Itt kezd&#245;dnek az IPFW szab&aacute;lyai ##########################
# Kezd&eacute;s el&#245;tt t&ouml;r&ouml;lj&uuml;k az &ouml;sszes akt&iacute;v szab&aacute;lyt.
ipfw -q -f flush

# &Aacute;ll&iacute;tsuk be a parancsok tov&aacute;bbi sz&uuml;ks&eacute;ges opci&oacute;t.
cmd="ipfw -q add"
pif="dc0"     # az internethez csatlakoz&oacute;
              # interf&eacute;sz neve

#################################################################
# A bels&#245; h&aacute;l&oacute;zat sz&aacute;m&aacute;ra ne korl&aacute;tozzunk semmit se.
# Ha nincs helyi h&aacute;l&oacute;zatunk, akkor erre nincs sz&uuml;ks&eacute;g&uuml;nk.
# Az 'xl0' nev&eacute;t &iacute;rjuk &aacute;t a helyi h&aacute;l&oacute;zatra csatlakoz&oacute;
# interf&eacute;sz nev&eacute;re.
################################################################
#&dollar;cmd 00005 allow all from any to any via xl0

################################################################
# A rendszer bels&#245; interf&eacute;sz&eacute;t se sz&#251;rj&uuml;k.
################################################################
&dollar;cmd 00010 allow all from any to any via lo0

################################################################
# A csomagot engedj&uuml;k &aacute;t a t&#251;zfalon, ha kor&aacute;bban m&aacute;r felvett&uuml;nk
# hozz&aacute; egy dinamikus szab&aacute;lyt a keep-state opci&oacute;val.
################################################################
&dollar;cmd 00015 check-state

################################################################
# Az internet fel&eacute; forgalmaz&oacute; interf&eacute;sz (kimen&#245; kapcsolatok)
# A saj&aacute;t h&aacute;l&oacute;zatunkr&oacute;l bel&uuml;lr&#245;l vagy err&#245;l az &aacute;tj&aacute;r&oacute;r&oacute;l
# kezdem&eacute;nyezett kapcsolatokat vizsg&aacute;ljuk az internet fel&eacute;.
################################################################

# Kifel&eacute; enged&eacute;lyezz&uuml;k az internet-szolg&aacute;ltat&oacute;nk n&eacute;vszerver&eacute;nek
# el&eacute;r&eacute;s&eacute;t. Az x.x.x.x a szolg&aacute;ltat&oacute;nk n&eacute;vszerver&eacute;nek IP-c&iacute;me
# legyen. Ha a szolg&aacute;ltat&oacute;nak t&ouml;bb n&eacute;vszervere is van, akkor
# m&aacute;soljuk le ezeket a sorokat &eacute;s az /etc/resolv.conf
# &aacute;llom&aacute;nyban tal&aacute;lhat&oacute; IP-c&iacute;meket helyettes&iacute;ts&uuml;k be.
&dollar;cmd 00110 allow tcp from any to x.x.x.x 53 out via &dollar;pif setup keep-state
&dollar;cmd 00111 allow udp from any to x.x.x.x 53 out via &dollar;pif keep-state

# K&aacute;bel/DSL konfigur&aacute;ci&oacute;k eset&eacute;ben kifel&eacute; enged&eacute;lyezz&uuml;k a
# szolg&aacute;ltat&oacute;nk DHCP szerver&eacute;nek el&eacute;r&eacute;s&eacute;t. Ha a "felhaszn&aacute;l&oacute;i
# PPP"-t haszn&aacute;ljuk, akkor erre nem lesz sz&uuml;ks&eacute;g&uuml;nk, az eg&eacute;sz
# csoportot t&ouml;r&ouml;lhetj&uuml;k. Az al&aacute;bbi szab&aacute;llyal cs&iacute;phetj&uuml;k el a
# be&iacute;rand&oacute; IP-c&iacute;met. Ha a napl&oacute;ban megtal&aacute;ltuk, akkor vegy&uuml;k
# ki az els&#245; szab&aacute;lyt, a m&aacute;sodikba &iacute;rjuk bele a c&iacute;met &eacute;s
# enged&eacute;lyezz&uuml;k.
&dollar;cmd 00120 allow log udp from any to any 67 out via &dollar;pif keep-state
#&dollar;cmd 00120 allow udp from any to x.x.x.x 67 out via &dollar;pif keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a szabv&aacute;ny nem biztons&aacute;gos WWW
# funkci&oacute; el&eacute;r&eacute;s&eacute;t.
&dollar;cmd 00200 allow tcp from any to any 80 out via &dollar;pif setup keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a biztons&aacute;gos HTTPS funkci&oacute;
# el&eacute;r&eacute;s&eacute;t TLS SSL haszn&aacute;lat&aacute;val.
&dollar;cmd 00220 allow tcp from any to any 443 out via &dollar;pif setup keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a e-mailek k&uuml;ld&eacute;s&eacute;t &eacute;s fogad&aacute;s&aacute;t.
&dollar;cmd 00230 allow tcp from any to any 25 out via &dollar;pif setup keep-state
&dollar;cmd 00231 allow tcp from any to any 110 out via &dollar;pif setup keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a FreeBSD (a make install &eacute;s a CVSUP)
# funkci&oacute;it. Ezzel l&eacute;nyeg&eacute;ben a rendszeradminisztr&aacute;tornak
# ,,ISTENI'' jogokat adunk.
&dollar;cmd 00240 allow tcp from me to any out via &dollar;pif setup keep-state uid root

# Kifel&eacute; enged&eacute;lyezz&uuml;k a pinget.
&dollar;cmd 00250 allow icmp from any to any out via &dollar;pif keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k az id&#245; szolg&aacute;ltat&aacute;st.
&dollar;cmd 00260 allow tcp from any to any 37 out via &dollar;pif setup keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k az nntp news szolg&aacute;ltat&aacute;st
# (vagyis a h&iacute;rcsoportokat)
&dollar;cmd 00270 allow tcp from any to any 119 out via &dollar;pif setup keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a biztons&aacute;gos FTP, telnet &eacute;s SCP
# el&eacute;r&eacute;s&eacute;t az SSH (secure shell) haszn&aacute;lat&aacute;val.
&dollar;cmd 00280 allow tcp from any to any 22 out via &dollar;pif setup keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a whois szolg&aacute;ltat&aacute;st.
&dollar;cmd 00290 allow tcp from any to any 43 out via &dollar;pif setup keep-state

# Dobjuk el &eacute;s napl&oacute;zzunk mindent, ami megpr&oacute;b&aacute;l kijutni.
# Ez a szab&aacute;ly gondoskodik r&oacute;la, hogy alap&eacute;rtelmez&eacute;s szerint
# mindent blokkoljunk.
&dollar;cmd 00299 deny log all from any to any out via &dollar;pif

################################################################
# Az internet fel&#245;li interf&eacute;sz (bej&ouml;v&#245; kapcsolatok)
# A saj&aacute;t h&aacute;l&oacute;zatunk fel&eacute; vagy erre az &aacute;tj&aacute;r&oacute;ra
# nyitott kapcsolatokat vizsg&aacute;ljuk az internet fel&#245;l.
################################################################

# Blokkoljunk minden olyan bej&ouml;v&#245; forgalmat, amely a fenntartott
# c&iacute;mtartom&aacute;nyok fel&eacute; tart.
&dollar;cmd 00300 deny all from 192.168.0.0/16 to any in via &dollar;pif  #RFC 1918: priv&aacute;t IP
&dollar;cmd 00301 deny all from 172.16.0.0/12 to any in via &dollar;pif   #RFC 1918: priv&aacute;t IP
&dollar;cmd 00302 deny all from 10.0.0.0/8 to any in via &dollar;pif      #RFC 1918: priv&aacute;t IP
&dollar;cmd 00303 deny all from 127.0.0.0/8 to any in via &dollar;pif     #helyi
&dollar;cmd 00304 deny all from 0.0.0.0/8 to any in via &dollar;pif       #helyi
&dollar;cmd 00305 deny all from 169.254.0.0/16 to any in via &dollar;pif  #DHCP
&dollar;cmd 00306 deny all from 192.0.2.0/24 to any in via &dollar;pif    #dokument&aacute;ci&oacute;s c&eacute;lokra fenntartott
&dollar;cmd 00307 deny all from 204.152.64.0/23 to any in via &dollar;pif #Sun klaszterek &ouml;sszek&ouml;t&eacute;s&eacute;re haszn&aacute;lt
&dollar;cmd 00308 deny all from 224.0.0.0/3 to any in via &dollar;pif     #D &eacute;s E oszt&aacute;ly&uacute; multicast

# A nyilv&aacute;nos pingek tilt&aacute;sa.
&dollar;cmd 00310 deny icmp from any to any in via &dollar;pif

# Az ident szolg&aacute;ltat&aacute;s tilt&aacute;sa.
&dollar;cmd 00315 deny tcp from any to any 113 in via &dollar;pif

# Blokkoljuk az &ouml;sszes Netbios szolg&aacute;ltat&aacute;st: 137=n&eacute;v, 138=datagram,
# 139=session. A Netbios az MS Windows megoszt&aacute;s&aacute;t implement&aacute;lja.
# Blokkoljuk az MS Windows hosts2 n&eacute;vszerver k&eacute;r&eacute;seit is a 81-es
# porton.
&dollar;cmd 00320 deny tcp from any to any 137 in via &dollar;pif
&dollar;cmd 00321 deny tcp from any to any 138 in via &dollar;pif
&dollar;cmd 00322 deny tcp from any to any 139 in via &dollar;pif
&dollar;cmd 00323 deny tcp from any to any 81 in via &dollar;pif

# Eldobjuk az &ouml;sszes k&eacute;s&#245;n &eacute;rkez&#245; csomagot.
&dollar;cmd 00330 deny all from any to any frag in via &dollar;pif

# Eldobjuk azokat az ACK csomagokat, amelyek egyik dinamikus
# szab&aacute;lynak sem felelnek meg.
&dollar;cmd 00332 deny tcp from any to any established in via &dollar;pif

# Befel&eacute; enged&eacute;lyezz&uuml;k a szolg&aacute;ltat&oacute; DHCP szerver&eacute;nek v&aacute;lasz&aacute;t. Ebben
# a szab&aacute;lyban csak a DHCP szerver IP-c&iacute;me szerepelhet, mivel ez az
# egyetlen olyan hiteles&iacute;tett forr&aacute;s, ami ilyen csomagokat k&uuml;ldhet.
# Ez csak a k&aacute;beles &eacute;s DSL t&iacute;pus&uacute; kapcsolatok eset&eacute;ben sz&uuml;ks&eacute;ges.
# Amikor a "felhaszn&aacute;l&oacute;i PPP"-vel csatlakozunk az internethez, nem
# kell ez a szab&aacute;ly. Ugyanazt az IP-c&iacute;met kell megadnunk, amelyet a
# kimen&#245; kapcsolatokn&aacute;l is.
#&dollar;cmd 00360 allow udp from any to x.x.x.x 67 in via &dollar;pif keep-state

# Befel&eacute; enged&eacute;lyezz&uuml;k a szabv&aacute;ny WWW funkci&oacute;t, mivel webszerver&uuml;nk
# is van.
&dollar;cmd 00400 allow tcp from any to me 80 in via &dollar;pif setup limit src-addr 2

# Befel&eacute; enged&eacute;lyezz&uuml;k a biztons&aacute;gos FTP, telnet &eacute;s SCP
# t&iacute;pus&uacute; kapcsolatokat az internetr&#245;l.
&dollar;cmd 00410 allow tcp from any to me 22 in via &dollar;pif setup limit src-addr 2

# Befel&eacute; enged&eacute;lyezz&uuml;k az internetr&#245;l &eacute;rkez&#245; nem biztons&aacute;gos telnet
# kapcsolatokat. Az&eacute;rt tekintj&uuml;k nem biztons&aacute;gosnak, mert az
# azonos&iacute;t&oacute;k &eacute;s a jelszavak az interneten titkos&iacute;tatlanul v&aacute;ndorolnak.
# T&ouml;r&ouml;lj&uuml;k ezt a csoportot, ha nincs telnet szolg&aacute;ltat&aacute;sunk.
&dollar;cmd 00420 allow tcp from any to me 23 in via &dollar;pif setup limit src-addr 2

# Dobjuk el &eacute;s napl&oacute;zzuk az &ouml;sszes t&ouml;bbi kintr&#245;l &eacute;rkez&#245; csomagot.
&dollar;cmd 00499 deny log all from any to any in via &dollar;pif

# Alap&eacute;rtelmez&eacute;s szerint dobjuk el mindent. Az ide &eacute;rkez&#245;
# csomagokat is napl&oacute;zzuk, amib&#245;l t&ouml;bbet is ki tudunk majd
# der&iacute;teni.
&dollar;cmd 00999 deny log all from any to any
############# Itt fejez&#245;dnek be az IPFW szab&aacute;lyai #####################</programlisting>
      </sect3>

      <sect3>
	<title>P&eacute;lda h&aacute;l&oacute;zati
	  c&iacute;mford&iacute;t&aacute;sra &eacute;s
	  &aacute;llapottart&aacute;sra</title>

	<indexterm>
	  <primary>c&iacute;mford&iacute;t&aacute;s</primary>
	  <secondary>&eacute;s az IPFW</secondary>
	</indexterm>

	<para>Az IPFW c&iacute;mford&iacute;t&oacute;
	  funkci&oacute;j&aacute;nak
	  kihaszn&aacute;l&aacute;s&aacute;hoz tov&aacute;bbi
	  konfigur&aacute;ci&oacute;s be&aacute;ll&iacute;t&aacute;sok
	  alkalmaz&aacute;s&aacute;ra is sz&uuml;ks&eacute;g&uuml;nk
	  lesz.  A rendszermagban opci&oacute; k&ouml;z&ouml;tt meg kell
	  adnunk az <literal>option IPDIVERT</literal> sort a t&ouml;bbi
	  <literal>IPFIREWALL</literal> sor mellett, &eacute;s
	  ford&iacute;tanunk egy saj&aacute;t verzi&oacute;t.</para>

	<para>Emellett m&eacute;g az <filename>/etc/rc.conf</filename>
	  &aacute;llom&aacute;nyban is enged&eacute;lyezni kell az IPFW
	  alapvet&#245; funkci&oacute;it.</para>

	<programlisting>natd_enable="YES"                   # enged&eacute;lyezz&uuml;k a c&iacute;mford&iacute;t&aacute;s&eacute;rt felel&#245;s d&eacute;mont
natd_interface="rl0"                # az internet fel&eacute; mutat&oacute; h&aacute;l&oacute;zati k&aacute;rtya neve
natd_flags="-dynamic -m"            # -m = a portsz&aacute;mok megtart&aacute;sa, ha lehets&eacute;ges</programlisting>

	<para>Az &aacute;llapottart&oacute; szab&aacute;lyok
	  haszn&aacute;lata a <literal>divert natd</literal>
	  c&iacute;mford&iacute;t&aacute;si opci&oacute;val egy&uuml;tt
	  nagyban n&ouml;veli a szab&aacute;lyrendszer
	  leprogramoz&aacute;s&aacute;nak bonyolults&aacute;g&aacute;t.
	  A <literal>check-state</literal> &eacute;s <literal>divert
	  natd</literal> szab&aacute;lyok helye kritikus a
	  megfelel&#245; m&#251;k&ouml;d&eacute;s tekintet&eacute;ben.
	  Az eddig megszokott egyszer&#251; viselked&eacute;s itt
	  m&aacute;r nem &eacute;rv&eacute;nyes&uuml;l.  Bevezet&uuml;nk
	  egy &uacute;j cselekv&eacute;st is, amelynek a neve
	  <literal>skipto</literal>.  A <literal>skipto</literal>
	  parancs haszn&aacute;lat&aacute;hoz elengedhetetlen a
	  szab&aacute;lyok sorsz&aacute;moz&aacute;sa, mivel pontosan
	  tudnunk kell, hogy a <literal>skipto</literal>
	  hat&aacute;s&aacute;ra hova kell ugrania a
	  vez&eacute;rl&eacute;snek.</para>

	<para>A k&ouml;vetkez&#245; p&eacute;ld&aacute;ban nem fogunk
	  sok megjegyz&eacute;st l&aacute;tni, mivel benne az egyik
	  lehets&eacute;ges programoz&aacute;si st&iacute;lust
	  pr&oacute;b&aacute;ljuk &eacute;rz&eacute;keltetni &eacute;s a
	  csomagok szab&aacute;lyrendszerek k&ouml;zti
	  &aacute;raml&aacute;s&aacute;t magyar&aacute;zzuk.</para>

	<para>A feldolgoz&aacute;s a szab&aacute;lyokat
	  tartalmaz&oacute; &aacute;llom&aacute;ny tetej&eacute;n
	  tal&aacute;lhat&oacute; els&#245; szab&aacute;llyal
	  kezd&#245;dik, &eacute;s innen egyes&eacute;vel pereg
	  v&eacute;gig lefel&eacute; a feldolgoz&aacute;s eg&eacute;szen
	  addig, am&iacute;g a csomag a sz&#251;r&eacute;si
	  felt&eacute;telek valamelyik&eacute;nek eleget nem tesz
	  &eacute;s t&aacute;vozik a t&#251;zfalb&oacute;l.
	  Legink&aacute;bb a 100-as, 101-es, 450-es, 500-as &eacute;s
	  510-es sorsz&aacute;m&uacute; szab&aacute;lyokat
	  emeln&eacute;nk ki.  Ezek vez&eacute;rlik kimen&#245;
	  &eacute;s bej&ouml;v&#245; csomagok
	  ford&iacute;t&aacute;s&aacute;t, ez&eacute;rt a
	  hozz&aacute;juk tartoz&oacute; dinamikus
	  &aacute;llapottart&oacute; bejegyz&eacute;sek mindig a helyi
	  h&aacute;l&oacute;zat IP-c&iacute;meire hivatkoznak.  Amit
	  m&eacute;g &eacute;rdemes megfigyeln&uuml;nk, hogy az
	  &ouml;sszes &aacute;tereszt&#245; &eacute;s eldob&oacute;
	  szab&aacute;lyban szerepel a csomag halad&aacute;si
	  ir&aacute;nya (teh&aacute;t kimen&#245; vagy &eacute;ppen
	  bej&ouml;v&#245;) &eacute;s az &eacute;rintett
	  interf&eacute;szt megnevez&eacute;se.  Emellett azt is
	  vegy&uuml;k &eacute;szre, hogy az &ouml;sszes kifel&eacute;
	  ir&aacute;nyul&oacute; kapcsolatl&eacute;trehoz&aacute;si
	  k&eacute;r&eacute;s az 500-as sorsz&aacute;m&uacute;
	  szab&aacute;lyhoz fog ugrani a
	  c&iacute;mford&iacute;t&aacute;s
	  elv&eacute;gz&eacute;s&eacute;hez.</para>

	<para>Tegy&uuml;k fel, hogy a helyi h&aacute;l&oacute;zatunkon
	  lev&#245; felhaszn&aacute;l&oacute;k szeretnek honlapokat
	  n&eacute;zgetni az interneten.  A honlapok a 80-as porton
	  kereszt&uuml;l kommunik&aacute;lnak.  Teh&aacute;t amikor egy
	  ilyen csomag el&eacute;ri a t&#251;zfalat, nem fog illeszkedni
	  a 100-as szab&aacute;lyra, mert a fejl&eacute;ce szerint
	  kifel&eacute; halad &eacute;s nem befel&eacute;.  A 101-es
	  szab&aacute;lyon is &aacute;tl&eacute;p, mivel ez az els&#245;
	  csomag, &iacute;gy a dinamikus &aacute;llapottart&oacute;
	  t&aacute;bl&aacute;zatban sem szerepel m&eacute;g.  A csomag
	  v&eacute;g&uuml;l a 125-&ouml;s szab&aacute;lyra fog
	  illeszkedni: kifel&eacute; halad az internetre
	  csatlakoz&oacute; h&aacute;l&oacute;zati
	  k&aacute;rty&aacute;n.  A csomagban azonban m&eacute;g mindig
	  az eredeti forr&aacute;s IP-c&iacute;me
	  tal&aacute;lhat&oacute;, amely a helyi h&aacute;l&oacute;zat
	  egyik g&eacute;p&eacute;re hivatkozik.  A szab&aacute;ly
	  illeszked&eacute;sekor k&eacute;t cselekv&eacute;s is
	  v&eacute;gbemegy.  A <literal>keep-state</literal> opci&oacute;
	  hat&aacute;s&aacute;ra ez a szab&aacute;ly felveszi ezt a
	  kapcsolatot az &aacute;llapottart&oacute; dinamikus
	  szab&aacute;lyok k&ouml;z&eacute; &eacute;s v&eacute;grehajtja
	  a m&aacute;sik megadott feladatot.  Ez a feladat r&eacute;sze
	  a dinamikus t&aacute;bl&aacute;zatba r&ouml;gz&iacute;tett
	  bejegyz&eacute;snek, ami ebben az esetben a <literal>skipto
	  500</literal> (<quote>ugorjunk az 500-as
	  szab&aacute;lyra</quote>) lesz.  Az 500-as szab&aacute;ly a
	  tov&aacute;bbk&uuml;ld&eacute;s el&#245;tt leford&iacute;tja a
	  csomag forr&aacute;s IP-c&iacute;m&eacute;t.  Ezt ne
	  felejts&uuml;k el, nagyon fontos!  A csomag ezut&aacute;n
	  eljut a c&eacute;lj&aacute;hoz, &eacute;s visszat&eacute;rve
	  ism&eacute;t bel&eacute;p a szab&aacute;lyrendszer
	  tetej&eacute;n.  Ez&uacute;ttal illeszkedni fog a 100-as
	  szab&aacute;lyra &eacute;s a c&eacute;l IP-c&iacute;m&eacute;t
	  visszaford&iacute;tjuk a helyi h&aacute;l&oacute;zatunk
	  megfelel&#245; g&eacute;p&eacute;nek c&iacute;m&eacute;re.
	  Ezut&aacute;n a <literal>check-state</literal>
	  szab&aacute;lyhoz ker&uuml;l, amely megtal&aacute;lja a
	  dinamikus szab&aacute;lyok k&ouml;z&ouml;tt &eacute;s
	  tov&aacute;bbengedi a bels&#245; h&aacute;l&oacute;zatra.
	  Ezzel visszaker&uuml;l a k&uuml;ld&#245; g&eacute;phez, amely
	  egy &uacute;jabb csomagot k&uuml;ld egy &uacute;jabb
	  adatszeletet k&eacute;rve a t&aacute;voli szervert&#245;l.
	  Ekkor m&aacute;r a <literal>check-state</literal>
	  szab&aacute;ly megtal&aacute;lja a hozz&aacute;tartoz&oacute;
	  bejegyz&eacute;st a dinamikus szab&aacute;lyok
	  k&ouml;z&ouml;tt &eacute;s v&eacute;grehajt&oacute;dik a
	  kor&aacute;bban let&aacute;rolt <literal>skipto 500</literal>
	  m&#251;velet.  A csomag erre az 500-as szab&aacute;lyra ugrik,
	  ahol leford&iacute;tjuk a c&iacute;m&eacute;t &eacute;s
	  tov&aacute;bbk&uuml;ldj&uuml;k.</para>

	<para>Az bej&ouml;v&#245; oldalon minden, ami egy
	  kor&aacute;bban kialakult kapcsolat r&eacute;szek&eacute;nt
	  &eacute;rkezik, automatikusan a <literal>check-state</literal>
	  &eacute;s a megfelel&#245; helyre rakott <literal>divert
	  natd</literal> szab&aacute;lyok &aacute;ltal dolgoz&oacute;dik
	  fel.  Itt mind&ouml;ssze a rossz csomagok
	  eldob&aacute;s&aacute;val &eacute;s a hiteles&iacute;tett
	  szolg&aacute;ltat&aacute;sok el&eacute;r&eacute;s&eacute;nek
	  biztos&iacute;t&aacute;s&aacute;val kell foglalkoznunk.
	  P&eacute;ld&aacute;ul a t&#251;zfalon egy webszerver fut,
	  &eacute;s azt szeretn&eacute;nk, hogy az internetr&#245;l
	  k&eacute;pesek legyenek el&eacute;rni a rajta lev&#245;
	  oldalakat.  Az &uacute;jonnan be&eacute;rkez&#245;
	  kapcsolat&eacute;p&iacute;t&eacute;si k&eacute;relem a 100-as
	  szab&aacute;lyra fog illeszkedni, amelynek a c&eacute;l
	  IP-c&iacute;m&eacute;t a t&#251;zfal helyi
	  h&aacute;l&oacute;zaton tal&aacute;lhat&oacute;
	  c&iacute;m&eacute;re fogjuk lek&eacute;pezni.  A csomagot
	  ezut&aacute;n m&eacute;g megvizsg&aacute;ljuk, nem tartalmaz-e
	  valamilyen huncuts&aacute;got, majd v&eacute;g&uuml;l a
	  425-&ouml;s szab&aacute;lyn&aacute;l fog kik&ouml;tni.  Az
	  egyez&eacute;skor k&eacute;t dolog t&ouml;rt&eacute;nhet: a
	  csomaghoz felvesz&uuml;nk egy dinamikus szab&aacute;lyt, de
	  ez&uacute;ttal az adott forr&aacute;s IP-c&iacute;mr&#245;l
	  &eacute;rkez&#245; kapcsolatk&eacute;r&eacute;sek
	  sz&aacute;m&aacute;t 2-re lekorl&aacute;tozzuk.  Ezzel az
	  adott szolg&aacute;ltat&aacute;s portj&aacute;n meg tudjuk
	  &oacute;vni a t&#251;zfalat &uuml;zemeltet&#245; g&eacute;pet
	  a DoS t&iacute;pus&uacute; t&aacute;mad&aacute;sokt&oacute;l.
	  A csomagot ezut&aacute;n hozz&aacute;tartoz&oacute;
	  cselekv&eacute;s szerint tov&aacute;bbengedj&uuml;k a
	  bels&#245; h&aacute;l&oacute;zat fel&eacute;.
	  Visszat&eacute;r&eacute;skor a t&#251;zfal felismeri, hogy a
	  csomag egy m&aacute;r meglev&#245; kapcsolathoz tartozik,
	  ez&eacute;rt k&ouml;zvetlen&uuml;l az 500-as szab&aacute;lyhoz
	  ker&uuml;l c&iacute;mford&iacute;t&aacute;sra, majd a
	  kimen&#245; interf&eacute;szen kereszt&uuml;l
	  tov&aacute;bbk&uuml;ldj&uuml;k.</para>

	<para>&Iacute;me az els&#245; p&eacute;lda egy ilyen
	  szab&aacute;lyrendszerre:</para>

	<programlisting>#!/bin/sh
cmd="ipfw -q add"
skip="skipto 500"
pif=rl0
ks="keep-state"
good_tcpo="22,25,37,43,53,80,443,110,119"

ipfw -q -f flush

&dollar;cmd 002 allow all from any to any via xl0  # nem sz&#251;rj&uuml;k a bels&#245; h&aacute;l&oacute;zatot
&dollar;cmd 003 allow all from any to any via lo0  # nem sz&#251;rj&uuml;k a helyi interf&eacute;szt

&dollar;cmd 100 divert natd ip from any to any in via &dollar;pif
&dollar;cmd 101 check-state

# A kimen&#245; csomagok hiteles&iacute;t&eacute;se:
&dollar;cmd 120 &dollar;skip udp from any to xx.168.240.2 53 out via &dollar;pif &dollar;ks
&dollar;cmd 121 &dollar;skip udp from any to xx.168.240.5 53 out via &dollar;pif &dollar;ks
&dollar;cmd 125 &dollar;skip tcp from any to any &dollar;good_tcpo out via &dollar;pif setup &dollar;ks
&dollar;cmd 130 &dollar;skip icmp from any to any out via &dollar;pif &dollar;ks
&dollar;cmd 135 &dollar;skip udp from any to any 123 out via &dollar;pif &dollar;ks


# Az &ouml;sszes olyan csomagot eldobjuk, amely a fenntartott
# c&iacute;mtartom&aacute;nyokba tart:
&dollar;cmd 300 deny all from 192.168.0.0/16  to any in via &dollar;pif  #RFC 1918: priv&aacute;t IP
&dollar;cmd 301 deny all from 172.16.0.0/12   to any in via &dollar;pif  #RFC 1918: priv&aacute;t IP
&dollar;cmd 302 deny all from 10.0.0.0/8      to any in via &dollar;pif  #RFC 1918: priv&aacute;t IP
&dollar;cmd 303 deny all from 127.0.0.0/8     to any in via &dollar;pif  #helyi
&dollar;cmd 304 deny all from 0.0.0.0/8       to any in via &dollar;pif  #helyi
&dollar;cmd 305 deny all from 169.254.0.0/16  to any in via &dollar;pif  #DHCP
&dollar;cmd 306 deny all from 192.0.2.0/24    to any in via &dollar;pif  #dokument&aacute;ci&oacute;s c&eacute;lokra fenntartott
&dollar;cmd 307 deny all from 204.152.64.0/23 to any in via &dollar;pif  #Sun klaszter
&dollar;cmd 308 deny all from 224.0.0.0/3     to any in via &dollar;pif  #D &eacute;s E oszt&aacute;ly&uacute; multicast

# Az &eacute;rkez&#245; csomagok hiteles&iacute;t&eacute;se:
&dollar;cmd 400 allow udp from xx.70.207.54 to any 68 in &dollar;ks
&dollar;cmd 420 allow tcp from any to me 80 in via &dollar;pif setup limit src-addr 1


&dollar;cmd 450 deny log ip from any to any

# Ide ugrunk a kimen&#245; &aacute;llapottart&oacute; szab&aacute;lyokn&aacute;l:
&dollar;cmd 500 divert natd ip from any to any out via &dollar;pif
&dollar;cmd 510 allow ip from any to any

##################### a szab&aacute;lyok v&eacute;ge ##################</programlisting>

	<para>A k&ouml;vetkez&#245; p&eacute;lda teljesen megegyezik az
	  el&#245;z&#245;vel, azonban itt m&aacute;r
	  dokument&aacute;ci&oacute;s sz&aacute;nd&eacute;kkal
	  szerepelnek megjegyz&eacute;sek is, melyek a tapasztalatlan
	  IPFW szab&aacute;ly&iacute;r&oacute;knak seg&iacute;tik jobban
	  meg&eacute;rteni a szab&aacute;lyok pontos
	  m&#251;k&ouml;d&eacute;s&eacute;t.</para>

	<para>A m&aacute;sodik p&eacute;lda:</para>

	<programlisting>#!/bin/sh
############# Az IPFW szab&aacute;lyai itt kezd&#245;dnek ###########################
# Kezd&eacute;s el&#245;tt t&ouml;r&ouml;lj&uuml;k az &ouml;sszes jelenleg akt&iacute;v szab&aacute;lyt:
ipfw -q -f flush

# Be&aacute;ll&iacute;tjuk a parancsok megfelel&#245; el&#245;tagjait:
cmd="ipfw -q add"
skip="skipto 800"
pif="rl0"     # az internethez csatlakoz&oacute;
              # h&aacute;l&oacute;zati interf&eacute;sz neve

#################################################################
# A bels&#245; h&aacute;l&oacute;zat sz&aacute;m&aacute;ra ne korl&aacute;tozzunk semmit se.
# Ha nincs helyi h&aacute;l&oacute;zatunk, akkor erre nincs sz&uuml;ks&eacute;g&uuml;nk.
# Az 'xl0' nev&eacute;t &iacute;rjuk &aacute;t a helyi h&aacute;l&oacute;zatra csatlakoz&oacute;
# interf&eacute;sz nev&eacute;re.
#################################################################
&dollar;cmd 005 allow all from any to any via xl0

#################################################################
# A rendszer bels&#245; interf&eacute;sz&eacute;t se sz&#251;rj&uuml;k.
#################################################################
&dollar;cmd 010 allow all from any to any via lo0

#################################################################
# Ellen&#245;rizz&uuml;k, hogy ez egy be&eacute;rkez&#245; csomag &eacute;s ha igen, akkor
# ford&iacute;tsuk a c&iacute;m&eacute;t.
#################################################################
&dollar;cmd 014 divert natd ip from any to any in via &dollar;pif

#################################################################
# Ha ehhez a csomaghoz kor&aacute;bban m&aacute;r vett&uuml;k fel dinamikus
# szab&aacute;lyt a keep-state opci&oacute; r&eacute;v&eacute;n, akkor engedj&uuml;k tov&aacute;bb.
#################################################################
&dollar;cmd 015 check-state

#################################################################
# Az internet fel&eacute; forgalmaz&oacute; interf&eacute;sz (kimen&#245; kapcsolatok)
# A saj&aacute;t h&aacute;l&oacute;zatunkr&oacute;l bel&uuml;lr&#245;l vagy err&#245;l az &aacute;tj&aacute;r&oacute;r&oacute;l
# kezdem&eacute;nyezett kapcsolatokat vizsg&aacute;ljuk az internet fel&eacute;.
#################################################################

# Kifel&eacute; enged&eacute;lyezz&uuml;k az internet-szolg&aacute;ltat&oacute;nk n&eacute;vszerver&eacute;nek
# el&eacute;r&eacute;s&eacute;t. Az x.x.x.x a szolg&aacute;ltat&oacute; n&eacute;vszerver&eacute;nek IP-c&iacute;me
# lesz. Ha a szolg&aacute;ltat&oacute;nknak t&ouml;bb n&eacute;vszervere is van, akkor
# az /etc/resolv.conf &aacute;llom&aacute;nyb&oacute;l n&eacute;zz&uuml;k ki a c&iacute;meiket &eacute;s
# m&aacute;soljuk le az al&aacute;bbi sor mindegyik&uuml;kh&ouml;z.
&dollar;cmd 020 &dollar;skip tcp from any to x.x.x.x 53 out via &dollar;pif setup keep-state


# A k&aacute;beles &eacute;s DSL kapcsolatok eset&eacute;n enged&eacute;lyezz&uuml;k a szolg&aacute;ltat&oacute;
# DHCP szerver&eacute;nek el&eacute;r&eacute;s&eacute;t.
&dollar;cmd 030 &dollar;skip udp from any to x.x.x.x 67 out via &dollar;pif keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a szabv&aacute;ny nem biztons&aacute;gos WWW funkci&oacute;t
&dollar;cmd 040 &dollar;skip tcp from any to any 80 out via &dollar;pif setup keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a biztons&aacute;gos HTTPS funkci&oacute;t a TLS SSL
# haszn&aacute;lat&aacute;val.
&dollar;cmd 050 &dollar;skip tcp from any to any 443 out via &dollar;pif setup keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k az e-mailek k&uuml;ld&eacute;s&eacute;t &eacute;s fogad&aacute;s&aacute;t.
&dollar;cmd 060 &dollar;skip tcp from any to any 25 out via &dollar;pif setup keep-state
&dollar;cmd 061 &dollar;skip tcp from any to any 110 out via &dollar;pif setup keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a FreeBSD (make install &eacute;s CVSUP) funkci&oacute;it.
# Ezzel a rendszeradminisztr&aacute;tornak ,,ISTENI'' jogokat adunk.
&dollar;cmd 070 &dollar;skip tcp from me to any out via &dollar;pif setup keep-state uid root

# Kifel&eacute; enged&eacute;lyezz&uuml;k a pinget.
&dollar;cmd 080 &dollar;skip icmp from any to any out via &dollar;pif keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k az id&#245; szolg&aacute;ltat&aacute;st.
&dollar;cmd 090 &dollar;skip tcp from any to any 37 out via &dollar;pif setup keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k az nntp news szolg&aacute;ltat&aacute;st (teh&aacute;t a
# h&iacute;rcsoportokat).
&dollar;cmd 100 &dollar;skip tcp from any to any 119 out via &dollar;pif setup keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k a biztons&aacute;gos FTP, telnet &eacute;s SCP
# funkci&oacute;kat az SSH (secure shell) haszn&aacute;lat&aacute;val.
&dollar;cmd 110 &dollar;skip tcp from any to any 22 out via &dollar;pif setup keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k ki a whois k&eacute;r&eacute;seket.
&dollar;cmd 120 &dollar;skip tcp from any to any 43 out via &dollar;pif setup keep-state

# Kifel&eacute; enged&eacute;lyezz&uuml;k az NTP id&#245;szerver el&eacute;r&eacute;s&eacute;t.
&dollar;cmd 130 &dollar;skip udp from any to any 123 out via &dollar;pif keep-state

#################################################################
# Az internet fel&#245;li interf&eacute;sz (bej&ouml;v&#245; kapcsolatok)
# A saj&aacute;t h&aacute;l&oacute;zatunk fel&eacute; vagy erre az &aacute;tj&aacute;r&oacute;ra
# nyitott kapcsolatokat vizsg&aacute;ljuk az internet fel&#245;l.
#################################################################

# Tiltsuk a fenntartott c&iacute;mtartom&aacute;nyok fel&eacute; halad&oacute; &ouml;sszes be&eacute;rkez&#245;
# forgalmat.
&dollar;cmd 300 deny all from 192.168.0.0/16  to any in via &dollar;pif  #RFC 1918: priv&aacute;t IP
&dollar;cmd 301 deny all from 172.16.0.0/12   to any in via &dollar;pif  #RFC 1918: priv&aacute;t IP
&dollar;cmd 302 deny all from 10.0.0.0/8      to any in via &dollar;pif  #RFC 1918: priv&aacute;t IP
&dollar;cmd 303 deny all from 127.0.0.0/8     to any in via &dollar;pif  #helyi
&dollar;cmd 304 deny all from 0.0.0.0/8       to any in via &dollar;pif  #helyi
&dollar;cmd 305 deny all from 169.254.0.0/16  to any in via &dollar;pif  #DHCP
&dollar;cmd 306 deny all from 192.0.2.0/24    to any in via &dollar;pif  #dokument&aacute;ci&oacute;s c&eacute;lokra fenntartott
&dollar;cmd 307 deny all from 204.152.64.0/23 to any in via &dollar;pif  #Sun klaszter
&dollar;cmd 308 deny all from 224.0.0.0/3     to any in via &dollar;pif  #D &eacute;s E oszt&aacute;ly&uacute; multicast

# Az ident tilt&aacute;sa.
&dollar;cmd 315 deny tcp from any to any 113 in via &dollar;pif

# Blokkoljuk az &ouml;sszes Netbios szolg&aacute;ltat&aacute;st: 137=n&eacute;v, 138=datagram,
# 139=session. A Netbios az MS Windows megoszt&aacute;s&aacute;t implement&aacute;lja.
# Blokkoljuk az MS Windows hosts2 n&eacute;vszerver k&eacute;r&eacute;seit is a 81-es
# porton.
&dollar;cmd 320 deny tcp from any to any 137 in via &dollar;pif
&dollar;cmd 321 deny tcp from any to any 138 in via &dollar;pif
&dollar;cmd 322 deny tcp from any to any 139 in via &dollar;pif
&dollar;cmd 323 deny tcp from any to any 81  in via &dollar;pif

# Dobjuk el a k&eacute;s&#245;n &eacute;rkez&#245; csomagokat.
&dollar;cmd 330 deny all from any to any frag in via &dollar;pif

# Dobjuk el azokat az ACK csomagokat, amelyekre nincs
# dinamikus szab&aacute;ly.
&dollar;cmd 332 deny tcp from any to any established in via &dollar;pif

# Enged&eacute;lyezz&uuml;k a szolg&aacute;ltat&oacute; DHCP szerver&eacute;t&#245;l &eacute;rkez&#245; forgalmat. Ennek
# a szab&aacute;lynak tartalmaznia kell a DHCP szerver c&iacute;m&eacute;t, mert csak t&#245;le
# fogadunk el ilyen t&iacute;pus&uacute; csomagokat. Egyed&uuml;l csak k&aacute;beles vagy DSL
# konfigur&aacute;ci&oacute;k eset&eacute;n haszn&aacute;latos, a "felhaszn&aacute;l&oacute;i PPP" eset&eacute;ben
# t&ouml;r&ouml;lhetj&uuml;k. Ez ugyanaz az IP-c&iacute;m, amelyet a kimen&#245; kapcsolatokn&aacute;l
# megadtunk.
&dollar;cmd 360 allow udp from x.x.x.x to any 68 in via &dollar;pif keep-state

# Befel&eacute; enged&eacute;lyezz&uuml;k a szabv&aacute;ny WWW funkci&oacute;t, mivel van
# webszerver&uuml;nk.
&dollar;cmd 370 allow tcp from any to me 80 in via &dollar;pif setup limit src-addr 2

# Befel&eacute; enged&eacute;lyezz&uuml;k a biztons&aacute;gos FTP, telnet &eacute;s SCP
# haszn&aacute;lat&aacute;t az internetr&#245;l.
&dollar;cmd 380 allow tcp from any to me 22 in via &dollar;pif setup limit src-addr 2

# Befel&eacute; enged&eacute;lyezz&uuml;k a nem biztons&aacute;gos telnet el&eacute;r&eacute;s&eacute;t az
# internetr&#245;l. Az&eacute;rt nem tekintj&uuml;k biztons&aacute;gosnak, mert az
# azonos&iacute;t&oacute;kat &eacute;s a jelszavakat az interneten titkos&iacute;tatlanul
# k&ouml;zvet&iacute;ti. Ha nincs telnet szolg&aacute;ltat&aacute;sunk, akkor t&ouml;r&ouml;lhetj&uuml;k is ezt
# a csoportot.
&dollar;cmd 390 allow tcp from any to me 23 in via &dollar;pif setup limit src-addr 2

# Dobjuk el &eacute;s napl&oacute;zzuk az &ouml;sszes internetr&#245;l &eacute;rkez&#245; hiteles&iacute;tetlen kapcsolatot.
&dollar;cmd 400 deny log all from any to any in via &dollar;pif

# Dobjuk el &eacute;s napl&oacute;zzuk az &ouml;sszes internetre men&#245; hiteles&iacute;tetlen kapcsolatot.
&dollar;cmd 450 deny log all from any to any out via &dollar;pif

# Ez lesz a kimen&#245; szab&aacute;lyokhoz tartoz&oacute; "skipto" c&eacute;lja.
&dollar;cmd 800 divert natd ip from any to any out via &dollar;pif
&dollar;cmd 801 allow ip from any to any

# Minden m&aacute;st alap&eacute;rtelmez&eacute;s szerint tiltunk &eacute;s napl&oacute;zunk.
&dollar;cmd 999 deny log all from any to any
############# Az IPFW szab&aacute;lyai itt fejez&#245;dnek be #####################</programlisting>
      </sect3>
    </sect2>
  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->

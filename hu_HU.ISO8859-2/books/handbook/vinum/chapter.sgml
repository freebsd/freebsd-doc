<!--
     The Vinum Volume Manager
     By Greg Lehey (grog at lemis dot com)

     Added to the Handbook by Hiten Pandya <hmp@FreeBSD.org>
     and Tom Rhodes <trhodes@FreeBSD.org>

     For the FreeBSD Documentation Project
     $FreeBSD$
-->
<!-- The FreeBSD Hungarian Documentation Project
     Translated by: PALI, Gabor <pgj@FreeBSD.org>
     %SOURCE%	en_US.ISO8859-1/books/handbook/vinum/chapter.sgml
     %SRCID%	1.47
-->

<chapter id="vinum-vinum" lang="hu">
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Greg</firstname>
	<surname>Lehey</surname>
	<contrib>Az eredeti v&aacute;ltozatot &iacute;rta:</contrib>
      </author>
    </authorgroup>
  </chapterinfo>

  <title>A Vinum k&ouml;tetkezel&#245;</title>

  <sect1 id="vinum-synopsis">
    <title>&Aacute;ttekint&eacute;s</title>

    <para>Nem sz&aacute;m&iacute;t, milyen lemezeink is vannak, ugyanis
      mindig ad&oacute;dnak vel&uuml;k kapcsolatban gondjaink:</para>

    <itemizedlist>
      <listitem>
	<para>Kicsik.</para>
      </listitem>

      <listitem>
	<para>Lass&uacute;k.</para>
      </listitem>

      <listitem>
	<para>Nem el&eacute;g megb&iacute;zhat&oacute;ak.</para>
      </listitem>
    </itemizedlist>

    <para>Ezekre a probl&eacute;m&aacute;kra javasoltak &eacute;s meg is
      val&oacute;s&iacute;tottak sz&aacute;mos megold&aacute;st.  A
      felhaszn&aacute;l&oacute;k egy r&eacute;sze
      &aacute;ltal&aacute;ban &uacute;gy v&eacute;dekezik ellen&uuml;k,
      hogy t&ouml;bb, gyakran redund&aacute;nsan t&aacute;rol&oacute;
      lemezt haszn&aacute;l.  A k&uuml;l&ouml;nf&eacute;le
      k&aacute;rty&aacute;k &eacute;s hardveres
      RAID-vez&eacute;rl&#245;k t&aacute;mogat&aacute;sa mellett a &os;
      alaprendszer&eacute;ben megtal&aacute;lhat&oacute; egy blokkos
      eszk&ouml;zmeghajt&oacute;k&eacute;nt a Vinum
      k&ouml;tetkezel&#245; is, amellyel virtu&aacute;lis
      lemezmeghajt&oacute;kat lehet l&eacute;trehozni.  Teh&aacute;t a
      <emphasis>Vinum</emphasis> egy olyan &uacute;n.
      <emphasis>k&ouml;tetkezel&#245;</emphasis>, vagyis
      virtu&aacute;lis lemezkezel&#245;, ami az eml&iacute;tett
      h&aacute;rom probl&eacute;m&aacute;ra pr&oacute;b&aacute;l
      megold&aacute;st adni.  A Vinum a hagyom&aacute;nyos lemezes
      t&aacute;rol&aacute;sn&aacute;l j&oacute;val nagyobb
      rugalmass&aacute;got, teljes&iacute;tm&eacute;nyt &eacute;s
      megb&iacute;zhat&oacute;s&aacute;got biztos&iacute;t, valamint
      ismeri a RAID-0, RAID-1 &eacute;s RAID-5 modelleket
      k&uuml;l&ouml;n-k&uuml;l&ouml;n &eacute;s kombin&aacute;lva
      is.</para>

    <para>Ebben a fejezetben &ouml;sszefoglaljuk a hagyom&aacute;nyos
      lemezes t&aacute;rol&aacute;s jellegzetes probl&eacute;m&aacute;it
      &eacute;s bemutatjuk a Vinum k&ouml;tetkezel&#245;t.</para>

    <note>
      <para>A &os; 5-&ouml;s verzi&oacute;j&aacute;t&oacute;l kezdve a
	Vinumot &uacute;jra&iacute;rt&aacute;k a GEOM-nak
	megfelel&#245;en (<xref linkend="GEOM">), megtartva az eredeti
	elgondol&aacute;sokat, elnevez&eacute;seket &eacute;s a lemezen
	t&aacute;rolt metaadatok form&aacute;tum&aacute;t.  Ezt az
	&uacute;jra&iacute;rt v&aacute;ltozatot nevezik
	<emphasis>gvinum</emphasis>nak (<emphasis>GEOM
	vinum</emphasis>).  A sz&ouml;vegben a
	<emphasis>Vinum</emphasis>ra kiz&aacute;r&oacute;lag csak
	&aacute;ltal&aacute;noss&aacute;gban hivatkozunk,
	f&uuml;ggetlen&uuml;l az
	implement&aacute;ci&oacute;j&aacute;t&oacute;l.  Most m&aacute;r
	az &ouml;sszes parancsot a <command>gvinum</command>
	haszn&aacute;lat&aacute;val kell kiadni, illetve a
	hozz&aacute; tartoz&oacute; modul neve
	<filename>vinum.ko</filename>-r&oacute;l
	<filename>geom_vinum.ko</filename>-ra v&aacute;ltozott &eacute;s
	a megfelel&#245; eszk&ouml;zle&iacute;r&oacute;k a
	<filename class="directory">/dev/vinum</filename>
	k&ouml;nyvt&aacute;r helyett a <filename
	  class="directory">/dev/gvinum</filename>
	k&ouml;nyvt&aacute;rban tal&aacute;lhat&oacute;ak.  A &os; 6.
	verzi&oacute;j&aacute;t&oacute;l pedig a r&eacute;gi Vinum
	implement&aacute;ci&oacute; t&ouml;bb&eacute; m&aacute;r nem is
	r&eacute;sze az alaprendszernek.</para>
    </note>

  </sect1>

  <sect1 id="vinum-intro">
    <title>Kicsik a lemezeink</title>

    <indexterm><primary>Vinum</primary></indexterm>
    <indexterm>
      <primary>RAID</primary>
      <secondary>szoftver</secondary>
    </indexterm>

    <para>A lemezek kapacit&aacute;sa ugyan n&ouml;vekszik, de
      vel&uuml;k egy&uuml;tt a t&aacute;rig&eacute;nyek is.
      Ez&eacute;rt gyakran &eacute;rezz&uuml;k &uacute;gy, hogy a
      rendelkez&eacute;s&uuml;nkre &aacute;ll&oacute; lemezek
      t&aacute;rkapacit&aacute;s&aacute;t meghalad&oacute;
      &aacute;llom&aacute;nyrendszerre lenne
      sz&uuml;ks&eacute;g&uuml;nk.  K&eacute;ts&eacute;gtelen, hogy ez a
      probl&eacute;ma messze nem akkora jelent&#245;s&eacute;g&#251;,
      mint p&eacute;ld&aacute;ul t&iacute;z &eacute;vvel ezel&#245;tt,
      de m&eacute;g mindig fenn&aacute;ll.  Egyes rendszerek ezt
      &uacute;gy hidalt&aacute;k &aacute;t, hogy l&eacute;trehoztak egy
      olyan absztrakt eszk&ouml;zt, amely az adatokat t&ouml;bb lemezen
      t&aacute;rolja el.</para>

  </sect1>

  <sect1 id="vinum-access-bottlenecks">
    <title>A hozz&aacute;f&eacute;r&eacute;si id&#245;k sz&#251;k
      keresztmetszetei</title>

    <para>Napjaink rendszerei szinte &aacute;lland&oacute;an egyszerre
      t&ouml;bb adathoz is hozz&aacute; akarnak f&eacute;rni.
      P&eacute;ld&aacute;ul egy nagy forgalm&uacute; FTP vagy HTTP
      szerver t&ouml;bb 100&nbsp;Mbit/s sebess&eacute;g&#251;
      kapcsolattal is csatlakozhat a vil&aacute;gh&aacute;l&oacute;hoz,
      amelyeken kereszt&uuml;l p&aacute;rhuzamosan t&ouml;bbezernyi
      tranzakci&oacute;t is folytathat, ami jelent&#245;sen meghaladja a
      legt&ouml;bb lemez &aacute;tlagos &aacute;tviteli
      sebess&eacute;g&eacute;t.</para>

    <para>A jelenleg kaphat&oacute; lemezek soros adat&aacute;tviteli
      sebess&eacute;ge eg&eacute;szen 70&nbsp;MB/s-ig is terjedhet, de
      ennek az &eacute;rt&eacute;knek kev&eacute;s a
      jelent&#245;s&eacute;ge olyan k&ouml;rnyezetekben, ahol t&ouml;bb,
      egym&aacute;st&oacute;l f&uuml;ggetlen&uuml;l fut&oacute; program
      pr&oacute;b&aacute;l egyszerre hozz&aacute;f&eacute;rni, hiszen
      ilyen esetekben csak a t&ouml;red&eacute;k&eacute;t k&eacute;pesek
      el&eacute;rni.  Ilyenkor sokkal &eacute;rdekesebb a lemezt
      kezel&#245; alrendszer szempontj&aacute;b&oacute;l n&eacute;zni a
      probl&eacute;m&aacute;t: &iacute;gy az egyes adat&aacute;tviteli
      k&eacute;r&eacute;sek terhel&eacute;se lesz a
      meghat&aacute;roz&oacute; param&eacute;ter, vagyis az az id&#245;,
      amit a k&eacute;r&eacute;s teljes&iacute;t&eacute;s&eacute;ben
      &eacute;rintett meghajt&oacute;k elt&ouml;ltenek a
      feldolgoz&aacute;ssal.</para>

    <para>B&aacute;rmelyik k&eacute;r&eacute;st is vessz&uuml;k, a
      kiszolg&aacute;l&aacute;shoz a meghajt&oacute;nak
      el&#245;sz&ouml;r a megfelel&#245; helyre kell mozgatnia az
      &iacute;r&oacute;/olvas&oacute; fejeket, meg kell v&aacute;rni a
      fej alatt elhalad&oacute; els&#245; szektort, majd
      v&eacute;grehajtani a megfelel&#245; m&#251;veletet.  Ezek a
      m&#251;veletek sz&eacute;tv&aacute;laszthatatlanok: semmi
      &eacute;rtelme nincs megszak&iacute;tani ezeket.</para>

    <para><anchor id="vinum-latency">Tekints&uuml;nk egy
      &aacute;tlagosnak mondhat&oacute;, nagyj&aacute;b&oacute;l
      10&nbsp;kB m&eacute;ret&#251; adat&aacute;tvitelt: a
      leg&uacute;jabb nagyteljes&iacute;tm&eacute;ny&#251; lemezek
      &aacute;tlagosan 3,5&nbsp;ms alatt k&eacute;pesek
      pozicion&aacute;lni a fejeket.  A leggyorsabb lemezek
      15&nbsp;000&nbsp; fordulatot tesznek meg percenk&eacute;nt (RPM),
      &iacute;gy az &aacute;tlagos forg&aacute;si
      k&eacute;sleltet&eacute;s (egy f&eacute;l fordulat ideje)
      2&nbsp;ms.  70&nbsp;MB/s-os sebess&eacute;g mellett az
      &aacute;tvitel maga megk&ouml;zel&iacute;t&#245;leg
      150&nbsp;&mu;s, ami szinte elhanyagolhat&oacute; a
      pozicion&aacute;l&aacute;s idej&eacute;hez k&eacute;pest.  Ilyen
      esetekben a t&eacute;nyleges adat&aacute;tviteli sebess&eacute;g
      1&nbsp;MB/s-n&eacute;l alig valamivel t&ouml;bbre esik vissza,
      &eacute;s tiszt&aacute;n l&aacute;tszik, hogy er&#245;sen
      f&uuml;gg az &aacute;tvitt adat
      mennyis&eacute;g&eacute;t&#245;l.</para>

    <para>A hagyom&aacute;nyos &eacute;s k&eacute;zenfekv&#245;
      megold&aacute;sa ennek a probl&eacute;m&aacute;nak
      <quote>m&eacute;g t&ouml;bb cs&eacute;ve</quote>
      haszn&aacute;lata: egyetlen nagy lemez helyett alkalmazzunk
      t&ouml;bb kisebb, de azonos t&aacute;rkapacit&aacute;s&uacute;
      lemezt.  Mindegyik lemez k&eacute;pes egym&aacute;st&oacute;l
      f&uuml;ggetlen&uuml;l mozgatni a fejeiket &eacute;s az adatokat,
      aminek k&ouml;sz&ouml;nhet&#245;en a t&eacute;nyleges
      adat&aacute;tvitel m&eacute;rt&eacute;ke nagyj&aacute;b&oacute;l a
      lemezek sz&aacute;m&aacute;val ar&aacute;nyosan
      n&ouml;vekszik.</para>

    <para>Az adat&aacute;tvitelben bek&ouml;vetkez&#245; javul&aacute;s
      pontos ar&aacute;nya term&eacute;szetesen kisebb, mint a lemezek
      sz&aacute;ma: hab&aacute;r az egyes meghajt&oacute;k
      k&eacute;pesek p&aacute;rhuzamosan mozgatni az adatokat, semmilyen
      m&oacute;don garant&aacute;lhatjuk, hogy a k&eacute;r&eacute;sek
      egyenletesen oszlanak el k&ouml;zt&uuml;k.  Emiatt szinte
      elker&uuml;lhetetlen, hogy az egyik meghajt&oacute;t nagyobb
      terhel&eacute;s &eacute;rje, mint a m&aacute;sikat.</para>

    <indexterm><primary>lemezek
      &ouml;sszef&#251;z&eacute;se</primary></indexterm>
    <indexterm>
      <primary>Vinum</primary>
      <secondary>&ouml;sszef&#251;z&eacute;s</secondary>
    </indexterm>

    <para>A lemezekre es&#245; terhel&eacute;s egyenletess&eacute;ge
      er&#245;sen f&uuml;gg att&oacute;l, hogyan osztjuk el az adatokat
      a meghajt&oacute;k k&ouml;z&ouml;tt.  Az itt haszn&aacute;lt
      p&eacute;ld&aacute;ban a lemezen t&aacute;rolt adatokat egy
      k&ouml;nyv oldalaik&eacute;nt &eacute;rdemes elk&eacute;pzelni,
      vagyis rengeteg sz&aacute;m szerint c&iacute;mezhet&#245;
      adatszektork&eacute;nt.  A virtu&aacute;lis lemezt ennek
      megfelel&#245;en a legegyszer&#251;bben &uacute;gy tudjuk
      felosztani az egym&aacute;s ut&aacute;n k&ouml;vetkez&#245;
      f&uuml;ggetlen fizikai lemezek m&eacute;rete szerint &eacute;s
      &iacute;gy haszn&aacute;lni, mintha egy nagy k&ouml;nyvet kisebb
      r&eacute;szekre t&eacute;pt&uuml;nk volna.  Ezt a m&oacute;dszert
      nevezik <emphasis>&ouml;sszef&#251;z&eacute;snek</emphasis>,
      &eacute;s el&#245;nye, hogy a r&eacute;sztvev&#245; lemezeknek nem
      kell azonos m&eacute;ret&#251;eknek lenni&uuml;k.  Ez a
      megold&aacute;s remek&uuml;l m&#251;k&ouml;dik abban az esetben,
      amikor a virtu&aacute;lis lemez hozz&aacute;f&eacute;r&eacute;sei
      egyenletesen oszlanak el annak teljes ter&uuml;let&eacute;n.
      Amikor viszont az el&eacute;r&eacute;s csak egy kisebb
      ter&uuml;letre korl&aacute;toz&oacute;dik, kevesebb javul&aacute;s
      tapasztalhat&oacute;.  A <xref linkend="vinum-concat"> mutatja be
      lemezek egy ilyen &ouml;sszef&#251;z&ouml;tt
      konfigur&aacute;ci&oacute;j&aacute;t.</para>

    <para>
      <figure id="vinum-concat">
	<title>Az &ouml;sszef&#251;z&ouml;tt szervez&eacute;si
	  m&oacute;d</title>
	<graphic fileref="vinum/vinum-concat">
      </figure>
    </para>

  <indexterm><primary>lemezcs&iacute;koz&aacute;s</primary></indexterm>
  <indexterm>
    <primary>Vinum</primary>
    <secondary>cs&iacute;koz&aacute;s</secondary>
  </indexterm>
  <indexterm><primary>RAID</primary></indexterm>

  <para>Feloszthatjuk a virtu&aacute;lis lemez&uuml;nket kisebb azonos
    m&eacute;ret&#251; darabokra is, melyeket
    k&uuml;l&ouml;nb&ouml;z&#245; eszk&ouml;z&ouml;k&ouml;n sorosan
    t&aacute;rolunk el.  P&eacute;ld&aacute;ul az els&#245; 256 szektort
    elt&aacute;roljuk az els&#245; lemezen, majd a k&ouml;vetkez&#245;
    256 szektort a k&ouml;vetkez&#245; lemezen &eacute;s &iacute;gy
    tov&aacute;bb.  Az utols&oacute; lemez kit&ouml;lt&eacute;se
    ut&aacute;n az eg&eacute;sz folyamat ism&eacute;tl&#245;dik,
    eg&eacute;szen az &ouml;sszes lemez megt&ouml;lt&eacute;s&eacute;ig.
    Ezt a lek&eacute;pez&eacute;st
    <emphasis>cs&iacute;koz&aacute;s</emphasis>nak
    (<quote>striping</quote>) vagy <acronym>RAID-0</acronym>-nak
    nevezz&uuml;k
    <footnote>
      <para>A <acronym>RAID</acronym> jelent&eacute;se: Olcs&oacute;
	lemezek hibat&#251;r&#245; t&ouml;mbje (Redundant Array of
	Inexpensive Disks).  K&uuml;l&ouml;nf&eacute;le
	t&iacute;pus&uacute; hibat&#251;r&eacute;si megold&aacute;sokat
	vonultat fel, hab&aacute;r az eredeti elnevez&eacute;s
	f&eacute;lrevezet&#245; lehet, mivel redundanci&aacute;t nem
	tartalmaz.</para>
    </footnote>.
    A cs&iacute;koz&aacute;s haszn&aacute;lata sor&aacute;n valamivel
    bonyolultabb&aacute; v&aacute;lik az adatok
    megtal&aacute;l&aacute;sa &eacute;s t&ouml;bbletmunk&aacute;t is
    jelenthet olyan esetekben, amikor az adat&aacute;tvitel t&ouml;bb
    lemezt is &eacute;rint, de ezzel egyid&#245;ben sokkal jobban
    sz&eacute;tosztja a terhel&eacute;st a lemezek k&ouml;z&ouml;tt.  A
    <xref linkend="vinum-striped"> mutatja be a lemezek cs&iacute;kozott
    szervez&eacute;s&eacute;t.</para>

    <para>
      <figure id="vinum-striped">
	<title>A cs&iacute;kozott szervez&eacute;si m&oacute;d</title>
	<graphic fileref="vinum/vinum-striped">
      </figure>
    </para>

  </sect1>

  <sect1 id="vinum-data-integrity">
    <title>Adatintegrit&aacute;s</title>

    <para>A modern lemezhajt&oacute;k utols&oacute; fontos
      probl&eacute;m&aacute;ja, hogy nem el&eacute;gg&eacute;
      megb&iacute;zhat&oacute;ak.  Annak ellen&eacute;re, hogy a lemezek
      ezen a t&eacute;ren meglehet&#245;sen sokat fejl&#245;dtek az
      ut&oacute;bbi p&aacute;r &eacute;vben, egy szervernek m&eacute;g
      mindig ezek azok a k&ouml;zponti r&eacute;szei, amelyek a
      legink&aacute;bb hajlamosak a meghib&aacute;sod&aacute;sra.
      Amikor ez bek&ouml;vetkezik, a hat&aacute;sa ak&aacute;r egy
      katasztr&oacute;f&aacute;val is fel&eacute;rhet: a
      s&eacute;r&uuml;lt lemezmeghajt&oacute;k cser&eacute;je &eacute;s
      az adatok vissza&aacute;ll&iacute;t&aacute;sa napokat is
      ig&eacute;nybe vehet.</para>

    <indexterm><primary>lemezt&uuml;kr&ouml;z&eacute;s</primary></indexterm>
    <indexterm>
      <primary>Vinum</primary>
      <secondary>t&uuml;kr&ouml;z&eacute;s</secondary>
    </indexterm>
    <indexterm><primary>RAID-1</primary></indexterm>

    <para>Ennek a probl&eacute;m&aacute;nak a hagyom&aacute;nyos
      megk&ouml;zel&iacute;t&eacute;se lenne a
      <emphasis>t&uuml;kr&ouml;z&eacute;s</emphasis>
      (<quote>mirroring</quote>), vagyis amikor ugyanarr&oacute;l az
      adatr&oacute;l tartunk k&eacute;t p&eacute;ld&aacute;nyt
      k&eacute;t elt&eacute;r&#245; fizikai hardveren.  A
      <acronym>RAID</acronym>-szintek bek&ouml;sz&ouml;nt&eacute;vel ezt
      a technik&aacute;t <acronym>RAID level 1</acronym>-nak vagy
      <acronym>RAID-1</acronym>-nek is nevezik.  Amikor &iacute;runk a
      k&ouml;tetre, mindenhova &iacute;runk, az olvas&aacute;s pedig
      b&aacute;rmelyik eszk&ouml;zr&#245;l elv&eacute;gezhet&#245;.
      &Iacute;gy ha az egyik meghajt&oacute; t&ouml;nkremenne, egy
      m&aacute;sikon m&eacute;g mindig megtal&aacute;lhat&oacute; az
      &ouml;sszes adat.</para>

    <para>A t&uuml;kr&ouml;z&eacute;s k&eacute;t probl&eacute;m&aacute;t
      vet fel:</para>

      <itemizedlist>
	<listitem>
	  <para>&Aacute;r.  Legal&aacute;bb k&eacute;tszer annyiba
	    ker&uuml;l, mint a nem redund&aacute;nsan
	    t&aacute;rol&oacute; megold&aacute;sok.</para>
	</listitem>

	<listitem>
	  <para>Teljes&iacute;tm&eacute;nycs&ouml;kken&eacute;s.  Mivel
	    az &iacute;r&aacute;st minden meghajt&oacute;n v&eacute;gre
	    kell hajtani, legal&aacute;bb k&eacute;tszer annyi
	    s&aacute;vsz&eacute;less&eacute;get is fel&eacute;meszt,
	    mint a nem t&uuml;kr&ouml;z&ouml;tt k&ouml;tetek
	    eset&eacute;n.  Az olvas&aacute;s viszont nem vesz&iacute;t
	    a sebess&eacute;g&eacute;b&#245;l: s&#245;t, m&eacute;g
	    gyorsabbnak is t&#251;nhet.</para>
	</listitem>
      </itemizedlist>

    <indexterm><primary>lemezparit&aacute;s</primary></indexterm>
    <indexterm>
      <primary>Vinum</primary>
      <secondary>parit&aacute;s</secondary>
    </indexterm>
    <indexterm><primary>RAID-5</primary></indexterm>

    <para>Az adatintegrit&aacute;s meg&#245;rz&eacute;s&eacute;re egy
      m&aacute;sik megold&aacute;s a <emphasis>parit&aacute;s</emphasis>
      haszn&aacute;lata, melyet a 2, 3, 4 &eacute;s 5
      <acronym>RAID</acronym>-szintek val&oacute;s&iacute;tanak meg.
      Ezek k&ouml;z&uuml;l tal&aacute;n a <acronym>RAID-5</acronym> a
      leg&eacute;rdekesebb.  A Vinumban egy olyan cs&iacute;kozott
      szervez&eacute;si m&oacute;dk&eacute;nt
      val&oacute;s&iacute;tott&aacute;k meg, ahol minden
      cs&iacute;kb&oacute;l egy blokk az &ouml;sszes t&ouml;bbi
      parit&aacute;si inform&aacute;ci&oacute;j&aacute;t tartalmazza.  A
      <acronym>RAID-5</acronym> &aacute;ltal megval&oacute;s&iacute;tott
      szervez&eacute;s hasonl&iacute;t a cs&iacute;koz&aacute;shoz,
      azonban a <acronym>RAID-5</acronym>-ben mindegyik cs&iacute;k
      tartalmaz egy parit&aacute;si inform&aacute;ci&oacute;t is.
      Teh&aacute;t a Vinumban, ahogy azt <acronym>RAID-5</acronym> a
      megk&ouml;veteli, a parit&aacute;st t&aacute;rol&oacute; blokkok
      helye az egyik cs&iacute;kr&oacute;l a m&aacute;sikra
      v&aacute;ltozik.  Az adatblokkokban tal&aacute;lhat&oacute;
      sz&aacute;mok relat&iacute;v blokksz&aacute;mokat
      jel&ouml;lnek.</para>

    <para>
      <figure id="vinum-raid5-org">
	<title>A RAID-5 szervez&eacute;si m&oacute;d</title>
	<graphic fileref="vinum/vinum-raid5-org">
      </figure>
    </para>

    <para>A <acronym>RAID-5</acronym>-nek a t&uuml;kr&ouml;z&eacute;shez
      k&eacute;pest megvan az az el&#245;nye, hogy jelent&#245;sen
      kevesebb t&aacute;rhelyet ig&eacute;nyel.  Az olvas&aacute;s
      hasonl&oacute; a cs&iacute;kozott szervez&eacute;sek&eacute;hez,
      azonban az &iacute;r&aacute;s j&oacute;val lassabb, k&ouml;zel
      25%-a az olvas&aacute;s sebess&eacute;g&eacute;nek.  Az egyik
      meghajt&oacute; meghib&aacute;sod&aacute;sa eset&eacute;n a
      t&ouml;mb cs&ouml;kkentett m&oacute;dban m&eacute;g k&eacute;pes
      folytatni a m&#251;k&ouml;d&eacute;st: a fennmarad&oacute;
      meghajt&oacute;kr&oacute;l tov&aacute;bbra is a megszokott
      m&oacute;don lehet olvasni, viszont a s&eacute;r&uuml;lt
      meghajt&oacute;r&oacute;l olvasott adatokat folyamatosan
      jav&iacute;tani kell a t&ouml;bbir&#245;l sz&aacute;rmaz&oacute;
      seg&eacute;dinform&aacute;ci&oacute;k szerint.</para>

  </sect1>

  <sect1 id="vinum-objects">
    <title>A Vinum objektumai</title>

    <para>A t&aacute;rgyalt probl&eacute;m&aacute;k
      orvosl&aacute;s&aacute;ra a Vinumban egy n&eacute;gyszint&#251;
      objektumhierarchi&aacute;t alak&iacute;tottak ki:</para>

    <itemizedlist>
      <listitem>
	<para>A legjobban &eacute;szlelhet&#245; objektum a
	  virtu&aacute;lis lemez, amelyet
	  <emphasis>k&ouml;tet</emphasis>nek (volume) nevez&uuml;nk.  Ez
	  a k&ouml;tet l&eacute;nyeg&eacute;ben ugyanazokkal a
	  tulajdons&aacute;gokkal rendelkezik, mint egy &unix;-os
	  lemezmeghajt&oacute;, hab&aacute;r akadnak finomabb
	  k&uuml;l&ouml;nbs&eacute;gek.  M&eacute;rete korl&aacute;tlan
	  lehet.</para>
      </listitem>

      <listitem>
	<para>A k&ouml;tetek <emphasis>erek</emphasis>b&#245;l (plex)
	  &aacute;llnak, melyek a k&ouml;tet teljes
	  ter&uuml;let&eacute;t k&eacute;pviselik.  Enn&eacute;lfogva a
	  hierarchia ezen szintje ny&uacute;jtja a redundanci&aacute;t.
	  Az ereket legegyszer&#251;bben a t&uuml;kr&ouml;z&ouml;tt
	  t&ouml;mbben helyet foglal&oacute; lemezekk&eacute;nt tudjuk
	  elk&eacute;pzelni, melyek ugyanazt az adatot
	  tartalmazz&aacute;k.</para>
      </listitem>

      <listitem>
	<para>Mivel a Vinum a &unix; lemezes t&aacute;rol&aacute;st
	  megval&oacute;s&iacute;t&oacute; alrendszer&eacute;ben
	  helyezkedik el, a t&ouml;bblemezes erek
	  fel&eacute;p&iacute;t&eacute;s&eacute;hez
	  haszn&aacute;lhatn&aacute;nk a &unix;-os
	  part&iacute;ci&oacute;kat, azonban ehhez a feladathoz nem
	  el&eacute;gg&eacute; rugalmasak, mivel a &unix;-os lemezek
	  csak korl&aacute;tozott sz&aacute;m&uacute;
	  part&iacute;ci&oacute;t tartalmazhatnak.  A Vinum ehelyett
	  <emphasis>allemez</emphasis>nek (subdisk) nevezett folytonos
	  ter&uuml;letekre osztja fel az egyes &unix;-os
	  part&iacute;ci&oacute;kat (a
	  <emphasis>meghajt&oacute;</emphasis>kat), melyeket
	  azt&aacute;n az erek l&eacute;trehoz&aacute;s&aacute;ra
	  haszn&aacute;l fel.</para>
      </listitem>

      <listitem>
	<para>A Vinum &aacute;ltal l&eacute;trehozott
	  <emphasis>meghajt&oacute;</emphasis>kon (drive) lev&#245;
	  allemezek lesznek val&oacute;di &unix;-os
	  part&iacute;ci&oacute;k.  A Vinum-meghajt&oacute;k
	  tetsz&#245;leges sz&aacute;m&uacute; allemezt tartalmazhatnak.
	  Eltekintve a meghajt&oacute; elej&eacute;n
	  tal&aacute;lhat&oacute; apr&oacute; ter&uuml;lett&#245;l,
	  melyen a be&aacute;ll&iacute;t&aacute;sokra &eacute;s az
	  &aacute;llapotra vonatkoz&oacute; inform&aacute;ci&oacute;k
	  t&aacute;rol&oacute;dnak, az eg&eacute;sz meghajt&oacute;
	  felhaszn&aacute;lhat&oacute; adatok
	  t&aacute;rol&aacute;s&aacute;ra.</para>
      </listitem>
    </itemizedlist>

    <para>A most k&ouml;vetkez&#245; szakaszokban ismertetj&uuml;k, hogy
      ezek az objektumok milyen m&oacute;don szolg&aacute;ltatj&aacute;k
      a Vinum r&eacute;sz&eacute;r&#245;l elv&aacute;rt
      funkci&oacute;kat.</para>

    <sect2>
      <title>A k&ouml;tetek m&eacute;rete</title>

      <para>Az erek k&eacute;pesek a Vinum
	konfigur&aacute;ci&oacute;j&aacute;ban tal&aacute;lhat&oacute;
	t&ouml;bb k&uuml;l&ouml;nb&ouml;z&#245; meghajt&oacute;n
	elhelyezked&#245; allemezeket is nyal&aacute;bba k&ouml;tni.
	Ennek k&ouml;vetkezm&eacute;nyek&eacute;ppen az egyes
	meghajt&oacute;k m&eacute;rete nem korl&aacute;tozza az erek
	m&eacute;ret&eacute;t, emiatt a k&ouml;tet&eacute;t sem.</para>

    </sect2>

    <sect2>
      <title>Redund&aacute;ns adatt&aacute;rol&aacute;s</title>

      <para>A Vinum a t&uuml;kr&ouml;z&eacute;st t&ouml;bb &eacute;r
	egyetlen k&ouml;tett&eacute; olvaszt&aacute;s&aacute;val hozza
	l&eacute;tre.  Az erek mindegyike a k&ouml;teten
	tal&aacute;lhat&oacute; adatokat k&eacute;pviseli.  Egy
	k&ouml;tet legal&aacute;bb egy, legfeljebb nyolc eret
	tartalmazhat.</para>

      <para>Hab&aacute;r egy &eacute;r egy k&ouml;tet teljes
	adat&aacute;t &aacute;br&aacute;zolja, el&#245;fordulhat olyan
	eset, hogy bizonyos r&eacute;szei hi&aacute;nyoznak fizikai,
	kialak&iacute;t&aacute;si (nem t&aacute;rs&iacute;tottunk
	allemezeket hozz&aacute;juk) okokb&oacute;l
	ad&oacute;d&oacute;an vagy v&eacute;letlen&uuml;l (a
	hozz&aacute; tartoz&oacute; lemezter&uuml;letek
	s&eacute;r&uuml;ltek).  Am&iacute;g legal&aacute;bb egy
	&eacute;r k&eacute;pes a k&ouml;tet teljes tartalm&aacute;t
	szolg&aacute;ltatni, addig a k&ouml;tet teljesen &eacute;pnek
	tekinthet&#245;.</para>

    </sect2>

    <sect2>
      <title>Teljes&iacute;tm&eacute;ny</title>

      <para>A Vinum az &ouml;sszef&#251;z&eacute;st &eacute;s a
	cs&iacute;koz&aacute;st is egyar&aacute;nt
	megval&oacute;s&iacute;tja az erek szintj&eacute;n:</para>

      <itemizedlist>
	<listitem>
	  <para>Az <emphasis>&ouml;sszef&#251;z&ouml;tt
	    &eacute;r</emphasis> allemezek ter&uuml;leteib&#245;l
	    &eacute;p&iacute;tkezik.</para>
	</listitem>

	<listitem>
	  <para>A <emphasis>cs&iacute;kozott &eacute;r</emphasis>
	    felosztja az adatokat az allemezek k&ouml;z&ouml;tt.  Az
	    allemezek mindegyik&eacute;nek ugyanakkor&aacute;nak kell
	    lennie, &eacute;s legal&aacute;bb k&eacute;t allemeznek
	    lennie kell, hogy elt&eacute;rjen az
	    &ouml;sszef&#251;z&ouml;tt &eacute;rt&#245;l.</para>
	</listitem>
      </itemizedlist>

    </sect2>

    <sect2>
      <title>Hogyan szervezz&uuml;k az ereket?</title>

      <para>A &os;&nbsp;&rel.current; verzi&oacute;j&aacute;ban
	k&eacute;t fajta erez&eacute;si megold&aacute;st
	tal&aacute;lhatunk:</para>

      <itemizedlist>
	<listitem>
	  <para>Az &ouml;sszef&#251;z&ouml;tt erek a legrugalmasabbak:
	    tetsz&#245;leges sz&aacute;m&uacute; allemezt
	    tartalmazhatnak, az allemezek m&eacute;rete pedig
	    elt&eacute;rhet.  Az &eacute;r &uacute;jabb allemezek
	    hozz&aacute;ad&aacute;s&aacute;val tov&aacute;bb
	    b&#245;v&iacute;thet&#245;.  Kevesebb processzorid&#245;t
	    ig&eacute;nyel, mint egy cs&iacute;kozott &eacute;r,
	    hab&aacute;r a kett&#245; t&ouml;bbletk&ouml;lts&eacute;ge
	    k&ouml;zti elt&eacute;r&eacute;s nem m&eacute;rhet&#245;.
	    M&aacute;sr&eacute;szr&#245;l azonban nagyon
	    &eacute;rz&eacute;kenyek a forgalmasabb pontokra, vagyis
	    amikor az egyik lemez folyamatosan haszn&aacute;latban van,
	    mik&ouml;zben a t&ouml;bbi &uuml;resen j&aacute;r.</para>
	</listitem>

	<listitem>
	  <para>A cs&iacute;kozott (<acronym>RAID-0</acronym>) erek
	    legnagyobb el&#245;nye, hogy cs&ouml;kkentik a forgalmasabb
	    pontok kialakul&aacute;s&aacute;t: a megfelel&#245;
	    m&eacute;ret&#251; cs&iacute;ksz&eacute;less&eacute;g (ami
	    kb.  256&nbsp;kB) v&aacute;laszt&aacute;s&aacute;val el
	    tudjuk egyengetni a t&ouml;mbben dolgoz&oacute;
	    meghajt&oacute;k terhel&eacute;s&eacute;t.  Ennek a
	    megk&ouml;zel&iacute;t&eacute;snek a h&aacute;tr&aacute;nya
	    (r&eacute;szben) a sokkal &ouml;sszetettebb k&oacute;d,
	    valamint az allemezekre vonatkoz&oacute;
	    megszor&iacute;t&aacute;s, amely szerint meg kell
	    egyezni&uuml;k a m&eacute;ret&uuml;knek, illetve az
	    &eacute;rhez annyira bonyolult &uacute;jabb allemezeket
	    kapcsolni, hogy a Vinum jelenleg nem is k&eacute;pes
	    r&aacute;.  Ezeken k&iacute;v&uuml; a Vinum m&eacute;g
	    t&aacute;maszt egy trivi&aacute;lis ig&eacute;nyt is: a
	    cs&iacute;kozott &eacute;rben legal&aacute;bb k&eacute;t
	    allemeznek lennie kell, mivel m&aacute;sk&eacute;pp nem
	    t&eacute;r el egy &ouml;sszef&#251;z&ouml;tt
	    &eacute;rt&#245;l.</para>
	</listitem>
      </itemizedlist>

      <para>A <xref linkend="vinum-comparison"> foglalja &ouml;ssze az
	egyes erez&eacute;sek el&#245;nyeit &eacute;s
	h&aacute;tr&aacute;nyait.</para>

      <table id="vinum-comparison" frame="none">
	<title>Vinum erez&eacute;sek</title>
	<tgroup cols="5">
	  <thead>
	    <row>
	      <entry>Erez&eacute;s t&iacute;pusa</entry>
	      <entry>Legkevesebb allemez</entry>
	      <entry>B&#245;v&iacute;thet&#245;</entry>
	      <entry>Megegyez&#245; m&eacute;ret</entry>
	      <entry>Alkalmaz&aacute;s</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>&ouml;sszef&#251;z&ouml;tt</entry>
	      <entry>1</entry>
	      <entry>igen</entry>
	      <entry>nem</entry>
	      <entry>Sok adat t&aacute;rol&aacute;sa, ahol a
		hangs&uacute;ly a rugalmass&aacute;gon &eacute;s a
		m&eacute;rs&eacute;kelt teljes&iacute;tm&eacute;nyen
		van.</entry>
	    </row>

	    <row>
	      <entry>cs&iacute;kozott</entry>
	      <entry>2</entry>
	      <entry>nem</entry>
	      <entry>igen</entry>
	      <entry>Nagy teljes&iacute;tm&eacute;ny, nagy
		mennyis&eacute;g&#251; egyidej&#251;
		hozz&aacute;f&eacute;r&eacute;s mellett</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

    </sect2>
  </sect1>

  <sect1 id="vinum-examples">
    <title>P&eacute;ld&aacute;k</title>

    <para>A Vinum a rendszerben ismert objektumokkal kapcsolatos
      inform&aacute;ci&oacute;kat egy
      <emphasis>konfigur&aacute;ci&oacute;s
      adatb&aacute;zis</emphasis>ban tartja fenn.  Kezdetben a
      felhaszn&aacute;l&oacute; egy vagy t&ouml;bb
      konfigur&aacute;ci&oacute;s &aacute;llom&aacute;ny
      seg&iacute;ts&eacute;g&eacute;vel hozza l&eacute;tre ezt az
      adatb&aacute;zist a &man.gvinum.8; seg&eacute;dprogrammal.  A
      Vinum ezt a konfigur&aacute;ci&oacute;s adatb&aacute;zist
      bem&aacute;solja mindegyik ir&aacute;ny&iacute;t&aacute;sa alatt
      &aacute;ll&oacute; slice-ba (melyek a Vinum
      <emphasis>eszk&ouml;z</emphasis>nek h&iacute;v).  Az
      adatb&aacute;zis minden egyes &aacute;llapotv&aacute;lt&aacute;s
      folyam&aacute;n friss&uuml;l, &iacute;gy egy
      &uacute;jraind&iacute;t&aacute;s ut&aacute;n minden egyes
      Vinum-objektum &aacute;llapota pontosan
      helyre&aacute;ll&iacute;t&oacute;dik.</para>

    <sect2>
      <title>A konfigur&aacute;ci&oacute;s
	&aacute;llom&aacute;ny</title>

      <para>A konfigur&aacute;ci&oacute;s &aacute;llom&aacute;ny
	&iacute;rja le az egyes objektumokat.  Egy egyszer&#251;bb
	k&ouml;tet defin&iacute;ci&oacute;ja &iacute;gy n&eacute;zhet
	ki:</para>

      <programlisting>
    drive a device /dev/da3h
    volume myvol
      plex org concat
        sd length 512m drive a</programlisting>

      <para>Ez az &aacute;llom&aacute;ny n&eacute;gy Vinum-objektumot
	defini&aacute;l:</para>

      <itemizedlist>
	<listitem>
	  <para>A <emphasis>drive</emphasis> kezdet&#251; sor adja meg a
	    lemez part&iacute;ci&oacute;j&aacute;t
	    (<emphasis>meghajt&oacute;</emphasis>j&aacute;t) &eacute;s a
	    hardveren lev&#245; elhelyezked&eacute;s&eacute;t.  Az
	    <emphasis>a</emphasis> szimbolikus nevet kapta.  A
	    szimbolikus &eacute;s a konkr&eacute;t eszk&ouml;znevek
	    sz&eacute;tv&aacute;laszt&aacute;s&aacute;val
	    lehet&#245;v&eacute; v&aacute;lik, hogy a lemezek
	    f&eacute;lre&eacute;rt&eacute;sek n&eacute;lk&uuml;l
	    &aacute;tker&uuml;lhessek egyik helyr&#245;l a
	    m&aacute;sikra.</para>
	</listitem>

	<listitem>
	  <para>A <emphasis>volume</emphasis> kezdet&#251; sor adja meg
	    a k&ouml;tetet.  Itt az egyetlen sz&uuml;ks&eacute;ges
	    jellemz&#245; a n&eacute;v, ami ebben az esetben a
	    <emphasis>myvol</emphasis>.</para>
	</listitem>

	<listitem>
	  <para>A <emphasis>plex</emphasis> kezdet&#251; sor adja meg az
	    eret.  Itt az egyetlen sz&uuml;ks&eacute;ges
	    param&eacute;ter a szervez&eacute;si m&oacute;d, ami ebben
	    az esetben a <emphasis>concat</emphasis>
	    (&ouml;sszef&#251;z&ouml;tt).  Nevet nem kell megadnunk,
	    mivel a rendszer automatikusan l&eacute;trehoz egy nevet a
	    k&ouml;tet nev&eacute;b&#245;l a
	    <emphasis>.p</emphasis><emphasis>x</emphasis> ut&oacute;tag
	    hozz&aacute;ad&aacute;s&aacute;val, ahol az
	    <emphasis>x</emphasis> az &eacute;r sz&aacute;ma lesz a
	    k&ouml;teten bel&uuml;l.  Emiatt a most defini&aacute;lt
	    &eacute;r neve <emphasis>myvol.p0</emphasis> lesz.</para>
	</listitem>

	<listitem>
	  <para>Az <emphasis>sd</emphasis> kezdet&#251; sor adja meg az
	    allemezt.  Itt legal&aacute;bb meg kell adnunk a
	    meghajt&oacute;nak a nev&eacute;t, ahol t&aacute;rolni
	    akarjuk, ill.  a m&eacute;ret&eacute;t.  Ahogy m&aacute;r
	    eml&iacute;tett&uuml;k az erekn&eacute;l is, nevet nem
	    k&ouml;telez&#245; megadnunk, mivel a rendszer
	    mag&aacute;t&oacute;l rendel hozz&aacute; nevet, amit a
	    hozz&aacute; tartoz&oacute; &eacute;r nev&eacute;b&#245;l
	    sz&aacute;rmaztat, hozz&aacute;adja a
	    <emphasis>.s</emphasis><emphasis>x</emphasis>
	    ut&oacute;tagot, ahol az <emphasis>x</emphasis> az allemez
	    &eacute;ren bel&uuml;li sorsz&aacute;ma lesz.  Ennek
	    k&ouml;vetkezt&eacute;ben a Vinum ennek az allemeznek a
	    <emphasis>myvol.p0.s0</emphasis> nevet adja.</para>
	</listitem>
      </itemizedlist>

      <para>Miut&aacute;n a &man.gvinum.8; feldolgozta ezt az
	&aacute;llom&aacute;nyt, az al&aacute;bbi kimenetet fogja
	adni:</para>

      <programlisting width="97">
      &prompt.root; gvinum -&gt; <userinput>create config1</userinput>
      Configuration summary
      Drives:         1 (4 configured)
      Volumes:        1 (4 configured)
      Plexes:         1 (8 configured)
      Subdisks:       1 (16 configured)

	D a                     State: up       Device /dev/da3h        Avail: 2061/2573 MB (80%)

	V myvol                 State: up       Plexes:       1 Size:        512 MB

	P myvol.p0            C State: up       Subdisks:     1 Size:        512 MB

	S myvol.p0.s0           State: up       PO:        0  B Size:        512 MB</programlisting>

      <para>Ez a kimenet a &man.gvinum.8; egyszer&#251;
	list&aacute;z&aacute;si form&aacute;tum&aacute;t mutatja.
	Grafikusan a <xref linkend="vinum-simple-vol"> mutatja
	be.</para>

      <para>
	<figure id="vinum-simple-vol">
	  <title>Egyszer&#251; Vinum-k&ouml;tet</title>
	  <graphic fileref="vinum/vinum-simple-vol">
	</figure>
      </para>

      <para>Ezen &eacute;s az ezt k&ouml;vet&#245; &aacute;br&aacute;n
	egy k&ouml;tetet l&aacute;thatunk, amely ereket tartalmaz,
	amelyek pedig allemezeket.  Ebben az alapvet&#245;
	p&eacute;ld&aacute;ban a k&ouml;tet egyetlen eret tartalmaz,
	amiben pedig egyetlen allemez van.</para>

      <para>Az itt bemutatott k&ouml;tetnek nincs semmilyen el&#245;nye
	a hagyom&aacute;nyos lemezpart&iacute;cion&aacute;l&aacute;shoz
	k&eacute;pest.  Egyetlen eret tartalmaz, teh&aacute;t nem is
	redund&aacute;ns.  Az &eacute;r egyetlen allemezt tartalmaz,
	teh&aacute;t nem t&eacute;r el a megszokott
	lemezpart&iacute;ci&oacute;k
	helyfoglal&aacute;s&aacute;t&oacute;l sem.  A
	k&ouml;vetkez&#245; szakaszokban sokkal &eacute;rdekesebb
	konfigur&aacute;ci&oacute;s m&oacute;dszereket is
	illusztr&aacute;lunk.</para>

    </sect2>

    <sect2>
      <title>Megn&ouml;velt rugalmass&aacute;g:
	t&uuml;kr&ouml;z&eacute;s</title>

      <para>A k&ouml;tetek rugalmass&aacute;ga
	t&uuml;kr&ouml;z&eacute;ssel n&ouml;velhet&#245;.  Egy
	t&uuml;kr&ouml;z&ouml;tt k&ouml;tet kioszt&aacute;sa
	sor&aacute;n felt&eacute;tlen&uuml;l gondoskodnunk kell
	arr&oacute;l, hogy az egyes erekhez tartoz&oacute; allemezek
	elt&eacute;r&#245; meghajt&oacute;kon tal&aacute;lhat&oacute;ak,
	&iacute;gy az esetleges meghib&aacute;sod&aacute;sok nem
	k&aacute;ros&iacute;tj&aacute;k mind a k&eacute;t eret.  Az
	al&aacute;bbi konfigur&aacute;ci&oacute;ban egy k&ouml;tetet
	t&uuml;kr&ouml;z&uuml;nk:</para>

      <programlisting>
	drive b device /dev/da4h
	volume mirror
      plex org concat
        sd length 512m drive a
	  plex org concat
	    sd length 512m drive b</programlisting>

      <para>Ebben a p&eacute;ld&aacute;ban m&aacute;r nem kellett
	&uacute;jra megadnunk az <emphasis>a</emphasis>
	meghajt&oacute;t, mivel a Vinum figyelemmel k&iacute;s&eacute;ri
	az &ouml;sszes objektumot a saj&aacute;t
	konfigur&aacute;ci&oacute;s adatb&aacute;zis&aacute;ban.  A
	defin&iacute;ci&oacute; feldolgoz&aacute;sa ut&aacute;n a
	konfigur&aacute;ci&oacute; &iacute;gy fog kin&eacute;zni:</para>

      <programlisting width="97">
	Drives:         2 (4 configured)
	Volumes:        2 (4 configured)
	Plexes:         3 (8 configured)
	Subdisks:       3 (16 configured)

	D a                     State: up       Device /dev/da3h        Avail: 1549/2573 MB (60%)
	D b                     State: up       Device /dev/da4h        Avail: 2061/2573 MB (80%)

    V myvol                 State: up       Plexes:       1 Size:        512 MB
    V mirror                State: up       Plexes:       2 Size:        512 MB
 
    P myvol.p0            C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p0           C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p1           C State: initializing     Subdisks:     1 Size:        512 MB
 
    S myvol.p0.s0           State: up       PO:        0  B Size:        512 MB
	S mirror.p0.s0          State: up       PO:        0  B Size:        512 MB
	S mirror.p1.s0          State: empty    PO:        0  B Size:        512 MB</programlisting>

      <para>A <xref linkend="vinum-mirrored-vol"> ugyanezt a szerkezetet
	grafikusan is.</para>

      <para>
	<figure id="vinum-mirrored-vol">
	  <title>T&uuml;kr&ouml;z&ouml;tt Vinum-k&ouml;tet</title>
	  <graphic fileref="vinum/vinum-mirrored-vol">
	</figure>
      </para>

      <para>Ebben a p&eacute;ld&aacute;ban minden &eacute;r tartalmazza
	a teljes 512&nbsp;MB-os ter&uuml;letet.  Ahogy a kor&aacute;bbi
	p&eacute;lda eset&eacute;n, itt is mindegyik &eacute;r csak
	egyetlen allemezt tartalmaz.</para>

    </sect2>

    <sect2>
      <title>A teljes&iacute;tm&eacute;ny jav&iacute;t&aacute;sa</title>

      <para>Az el&#245;bbi p&eacute;ld&aacute;ban szerepl&#245;
	t&uuml;kr&ouml;z&ouml;tt k&ouml;tet egy t&uuml;kr&ouml;zetlen
	k&ouml;tetn&eacute;l m&aacute;r jobban ellen&aacute;ll a
	hib&aacute;knak, azonban a teljes&iacute;tm&eacute;nye is
	kisebb.  A k&ouml;teten minden egyes &iacute;r&aacute;s mind a
	k&eacute;t meghajt&oacute;ra &eacute;rv&eacute;nyes&uuml;l,
	ez&aacute;ltal a lemezek teljes
	s&aacute;vsz&eacute;less&eacute;g&eacute;t nagyobb
	ar&aacute;nyban haszn&aacute;lja.  A
	teljes&iacute;tm&eacute;nyre vonatkoz&oacute;
	megfontol&aacute;saink egy m&aacute;sik
	megk&ouml;zel&iacute;t&eacute;st k&iacute;v&aacute;nnak meg: a
	t&uuml;kr&ouml;z&eacute;s helyett ink&aacute;bb cs&iacute;kozzuk
	sz&eacute;t az adatot a lehet&#245; legt&ouml;bb lemezen.  Az
	al&aacute;bbi konfigur&aacute;ci&oacute; egy olyan k&ouml;tetet
	mutat be, ahol egy eret n&eacute;gy lemezmeghajt&oacute;an
	kereszt&uuml;l cs&iacute;kozunk:</para>

      <programlisting>
	drive c device /dev/da5h
	drive d device /dev/da6h
	volume stripe
	plex org striped 512k
	  sd length 128m drive a
	  sd length 128m drive b
	  sd length 128m drive c
	  sd length 128m drive d</programlisting>

      <para>Mint ahogy azt m&aacute;r kor&aacute;bban is
	eml&iacute;tett&uuml;k, nem sz&uuml;ks&eacute;ges m&eacute;g
	egyszer megadni azokat a meghajt&oacute;kat, amiket a Vinum
	m&aacute;r ismer.  A defin&iacute;ci&oacute; feldolgoz&aacute;sa
	ut&aacute;n a konfigur&aacute;ci&oacute;nk
	nagyj&aacute;b&oacute;l &iacute;gy n&eacute;z ki:</para>

      <programlisting width="92">
	Drives:         4 (4 configured)
	Volumes:        3 (4 configured)
	Plexes:         4 (8 configured)
	Subdisks:       7 (16 configured)

    D a                     State: up       Device /dev/da3h        Avail: 1421/2573 MB (55%)
    D b                     State: up       Device /dev/da4h        Avail: 1933/2573 MB (75%)
    D c                     State: up       Device /dev/da5h        Avail: 2445/2573 MB (95%)
    D d                     State: up       Device /dev/da6h        Avail: 2445/2573 MB (95%)

    V myvol                 State: up       Plexes:       1 Size:        512 MB
    V mirror                State: up       Plexes:       2 Size:        512 MB
    V striped               State: up       Plexes:       1 Size:        512 MB

    P myvol.p0            C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p0           C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p1           C State: initializing     Subdisks:     1 Size:        512 MB
    P striped.p1            State: up       Subdisks:     1 Size:        512 MB

    S myvol.p0.s0           State: up       PO:        0  B Size:        512 MB
    S mirror.p0.s0          State: up       PO:        0  B Size:        512 MB
    S mirror.p1.s0          State: empty    PO:        0  B Size:        512 MB
    S striped.p0.s0         State: up       PO:        0  B Size:        128 MB
    S striped.p0.s1         State: up       PO:      512 kB Size:        128 MB
    S striped.p0.s2         State: up       PO:     1024 kB Size:        128 MB
    S striped.p0.s3         State: up       PO:     1536 kB Size:        128 MB</programlisting>

      <para>
	<figure id="vinum-striped-vol">
	  <title>Cs&iacute;kozott Vinum-k&ouml;tet</title>
	  <graphic fileref="vinum/vinum-striped-vol">
	</figure>
      </para>

      <para>Ez a k&ouml;tet a <xref linkend="vinum-striped-vol">ban
	l&aacute;that&oacute;.  A cs&iacute;kok
	s&ouml;t&eacute;ted&eacute;se jelzi a hely&uuml;ket az &eacute;r
	ter&uuml;let&eacute;ben: a vil&aacute;gosabbak el&ouml;l, a
	s&ouml;t&eacute;tebbek h&aacute;tul szerepelnek.</para>

    </sect2>

    <sect2>
      <title>Rugalmass&aacute;g &eacute;s
	teljes&iacute;tm&eacute;ny</title>

      <para><anchor id="vinum-resilience">Megfelel&#245; hardver
	birtok&aacute;ban lehet olyan k&ouml;teteket is
	&eacute;p&iacute;teni, amelyek mind megn&ouml;velt
	rugalmass&aacute;got, mind pedig megn&ouml;velt
	teljes&iacute;tm&eacute;nyt mutatnak a szabv&aacute;nyos
	&unix;-os part&iacute;ci&oacute;khoz k&eacute;pest.  Ennek a
	konfigur&aacute;ci&oacute;s &aacute;llom&aacute;nya &iacute;gy
	n&eacute;zne ki:</para>

      <programlisting>
	volume raid10
      plex org striped 512k
        sd length 102480k drive a
        sd length 102480k drive b
        sd length 102480k drive c
        sd length 102480k drive d
        sd length 102480k drive e
      plex org striped 512k
        sd length 102480k drive c
        sd length 102480k drive d
        sd length 102480k drive e
        sd length 102480k drive a
        sd length 102480k drive b</programlisting>

      <para>A m&aacute;sodik &eacute;r allemezei el vannak tolva az
	els&#245; &eacute;r allemezeit&#245;l k&eacute;t
	meghajt&oacute;nyival.  Ez seg&iacute;t megel&#245;zni, hogy az
	&iacute;r&aacute;si m&#251;veletek ne ugyanarra az allemezre
	vonatkozznak, m&eacute;g akkor is, ha az adat&aacute;tvitel
	k&eacute;t meghajt&oacute;n is kereszt&uuml;l&iacute;vel.</para>

      <para>A <xref linkend="vinum-raid10-vol"> illusztr&aacute;lja
	ennek a k&ouml;tetnek a szerkezet&eacute;t.</para>

      <para>
	<figure id="vinum-raid10-vol">
	  <title>T&uuml;kr&ouml;z&ouml;tt, cs&iacute;kozott
	    Vinum-k&ouml;tet</title>
	  <graphic fileref="vinum/vinum-raid10-vol">
        </figure>
      </para>

    </sect2>
  </sect1>

  <sect1 id="vinum-object-naming">
    <title>Az objektumok elnevez&eacute;se</title>

    <para>Kor&aacute;bban m&aacute;r megismerhett&uuml;k, hogy a Vinum
      alap&eacute;rtelmezett neveket t&aacute;rs&iacute;t az erekhez
      &eacute;s az allemezekhez, hab&aacute;r ezek a nevek
      fel&uuml;lb&iacute;r&aacute;lhat&oacute;ak.  Ez viszont
      egy&aacute;ltal&aacute;n nem aj&aacute;nlott, mivel m&aacute;r a
      VERITAS k&ouml;tetkezel&#245;, ahol tetsz&#245;leges neveket
      rendelhet&uuml;nk az objektumokhoz, haszn&aacute;lata sor&aacute;n
      kider&uuml;lt, hogy akkora m&eacute;rt&eacute;k&#251;
      rugalmass&aacute;got nem k&iacute;n&aacute;l fel, mint amennyi
      zavart k&eacute;pes okozni.</para>

    <para>A nevek tartalmazhatnak b&aacute;rmilyen nem &uuml;res
      karaktert, azonban &eacute;rdemes ink&aacute;bb csak bet&#251;ket,
      sz&aacute;mjegyeket &eacute;s az al&aacute;h&uacute;z&aacute;st
      haszn&aacute;lni.  A k&ouml;tetek, erek &eacute;s allemezek nevei
      ak&aacute;r 64 karakteresek is lehetnek, a meghajt&oacute;k nevei
      pedig 32 karakteresek.</para>

    <para>A Vinum objektumai a <filename
	class="directory">/dev/gvinum</filename> k&ouml;nyvt&aacute;ron
      bel&uuml;li hierarchi&aacute;ban helyezkednek el
      eszk&ouml;zle&iacute;r&oacute;kk&eacute;nt.  Az im&eacute;nt
      eml&iacute;tett p&eacute;ldakonfigur&aacute;ci&oacute;
      hat&aacute;s&aacute;ra a k&ouml;vetkez&#245;
      eszk&ouml;zle&iacute;r&oacute;k j&ouml;nnek l&eacute;tre:</para>

    <itemizedlist>
      <listitem>
	<note>
	  <para>Ez a r&eacute;sz csak a Vinum kor&aacute;bbi, elavult
	    implement&aacute;ci&oacute;j&aacute;ra vonatkozik.</para>
	</note>

	<para>A <filename
	    class="devicefile">/dev/vinum/control</filename> &eacute;s
	  <filename class="devicefile">/dev/vinum/controld</filename>
	  nev&#251; vez&eacute;rl&#245;eszk&ouml;z&ouml;k, melyeket a
	  &man.gvinum.8; &eacute;s a Vinum d&eacute;mon
	  haszn&aacute;l.</para>
      </listitem>

      <listitem>
	<para>Mindegyik k&ouml;tethez egy eszk&ouml;zle&iacute;r&oacute;
	  tartozik.  Ezek a Vinum sz&aacute;m&aacute;ra a k&ouml;zponti
	  eszk&ouml;z&ouml;k, ez&eacute;rt az el&#245;bbi
	  konfigur&aacute;ci&oacute; r&eacute;v&eacute;n megjelennek a
	  <filename class="devicefile">/dev/gvinum/myvol</filename>,
	  <filename class="devicefile">/dev/gvinum/mirror</filename>,
	  <filename class="devicefile">/dev/gvinum/striped</filename>,
	  <filename class="devicefile">/dev/gvinum/raid5</filename>
	  &eacute;s <filename
	    class="devicefile">/dev/gvinum/raid10</filename>
	  eszk&ouml;z&ouml;k.</para>
      </listitem>

      <listitem>
	<note>
	  <para>Ez a r&eacute;sz csak a Vinum kor&aacute;bbi, elavult
	    implement&aacute;ci&oacute;j&aacute;ra vonatkozik.</para>
	</note>

	<para>Az egyes meghajt&oacute;khoz tartoz&oacute;
	  le&iacute;r&oacute;k a <filename
	    class="directory">/dev/vinum/drive</filename>
	  k&ouml;nyvt&aacute;rban tal&aacute;lhat&oacute;ak.  Ezek
	  val&oacute;j&aacute;ban szimbolikus linkek a megfelel&#245;
	  lemezes eszk&ouml;z&ouml;kre.</para>
      </listitem>

      <listitem>
	<para>Minden k&ouml;tethez k&ouml;zvetlen le&iacute;r&oacute;k
	  tartoznak <filename class="directory">/dev/gvinum</filename>
	  k&ouml;nyvt&aacute;rban.</para>
      </listitem>

      <listitem>
	<para>Az egyes erek &eacute;s allemezek
	  eszk&ouml;zle&iacute;r&oacute;i a
	  <filename class="directory">/dev/gvinum/plex</filename>
	  &eacute;s <filename
	    class="directory">/dev/gvinum/sd</filename>
	  k&ouml;nyvt&aacute;rakban jelennek meg.</para>
      </listitem>
    </itemizedlist>

    <para>P&eacute;ld&aacute;ul tekints&uuml;k most az al&aacute;bbi
      konfigur&aacute;ci&oacute;s &aacute;llom&aacute;nyt:</para>

	<programlisting>
	drive drive1 device /dev/sd1h
	drive drive2 device /dev/sd2h
	drive drive3 device /dev/sd3h
	drive drive4 device /dev/sd4h
    volume s64 setupstate
      plex org striped 64k
        sd length 100m drive drive1
        sd length 100m drive drive2
        sd length 100m drive drive3
        sd length 100m drive drive4</programlisting>

    <para>Az &aacute;llom&aacute;ny feldolgoz&aacute;sa ut&aacute;n az
      eszk&ouml;zle&iacute;r&oacute;kat a &man.gvinum.8; az
      al&aacute;bbi m&oacute;don szervezi a
      <filename class="directory">/dev/gvinum</filename>
      k&ouml;nyvt&aacute;rban:</para>

    <programlisting>
	drwxr-xr-x  2 root  wheel       512 Apr 13 16:46 plex
	crwxr-xr--  1 root  wheel   91,   2 Apr 13 16:46 s64
	drwxr-xr-x  2 root  wheel       512 Apr 13 16:46 sd

    /dev/vinum/plex:
    total 0
    crwxr-xr--  1 root  wheel   25, 0x10000002 Apr 13 16:46 s64.p0

    /dev/vinum/sd:
    total 0
    crwxr-xr--  1 root  wheel   91, 0x20000002 Apr 13 16:46 s64.p0.s0
    crwxr-xr--  1 root  wheel   91, 0x20100002 Apr 13 16:46 s64.p0.s1
    crwxr-xr--  1 root  wheel   91, 0x20200002 Apr 13 16:46 s64.p0.s2
    crwxr-xr--  1 root  wheel   91, 0x20300002 Apr 13 16:46 s64.p0.s3</programlisting>

    <para>J&oacute;llehet, az ereket &eacute;s allemezeket nem
      aj&aacute;nlott k&uuml;l&ouml;n-k&uuml;l&ouml;n elnevezni, a Vinum
      meghajt&oacute;knak nevet kell adni.  Ezzel
      megoldhat&oacute;v&aacute; v&aacute;lik, hogy az egyes
      meghajt&oacute;k automatikusan felismerhet&#245;ek legyenek abban
      az esetben is, amikor fizikailag &aacute;thelyezz&uuml;k ezeket.
      A meghajt&oacute;k nevei legfeljebb 32 karakteresek
      lehetnek.</para>

    <sect2>
      <title>&Aacute;llom&aacute;nyrendszerek
	l&eacute;trehoz&aacute;sa</title>

      <para>A k&ouml;tetek egyetlen kiv&eacute;tellel teljesen azonosak
	a lemezekkel a rendszer sz&aacute;m&aacute;ra.  Ugyanis a
	&unix;-os meghajt&oacute;kt&oacute;l elt&eacute;r&#245;en a
	Vinum nem particion&aacute;lja a k&ouml;teteket, &eacute;s
	ez&eacute;rt nem is t&aacute;rolnak part&iacute;ci&oacute;s
	t&aacute;bl&aacute;t.  Ez megk&ouml;vetelte n&eacute;h&aacute;ny
	lemezkezel&#245; seg&eacute;dprogram, legink&aacute;bb a
	&man.newfs.8; m&oacute;dos&iacute;t&aacute;s&aacute;t, mivel
	azok kor&aacute;bban megpr&oacute;b&aacute;lt&aacute;k a
	Vinum-k&ouml;tetek nev&eacute;nek utols&oacute; bet&#251;it egy
	part&iacute;ci&oacute; azonos&iacute;t&oacute;jak&eacute;nt
	&eacute;rtelmezni.  P&eacute;ld&aacute;ul egy lemezes
	meghajt&oacute; neve <filename
	  class="devicefile">/dev/ad0a</filename> vagy <filename
	  class="devicefile">/dev/da2h</filename> alak&uacute;.  Az
	el&#245;bbi az els&#245; (0) IDE lemez els&#245;
	(<devicename>a</devicename>) part&iacute;ci&oacute;j&aacute;t,
	m&iacute;g az ut&oacute;bbi a harmadik (2) SCSI lemez nyolcadik
	(<devicename>h</devicename>) part&iacute;ci&oacute;j&aacute;t
	jel&ouml;li.  Ezzel szemben azonban a Vinum-k&ouml;tetek neve
	<filename class="devicefile">/dev/gvinum/concat</filename>
	alak&uacute; lesz, ahol a n&eacute;v semmilyen kapcsolatban nem
	&aacute;ll a part&iacute;ci&oacute; nev&eacute;vel.</para>

      <para>H&eacute;tk&ouml;znapi esetben a &man.newfs.8;
	megpr&oacute;b&aacute;lja a lemez nev&eacute;t
	&eacute;rtelmezni, &eacute;s panaszkodik, ha nem siker&uuml;l.
	P&eacute;ld&aacute;ul:</para>

      <screen>&prompt.root; <userinput>newfs /dev/gvinum/concat</userinput>
newfs: /dev/gvinum/concat: can't figure out file system partition</screen>

      <para>A k&ouml;teten a &man.newfs.8; parancs
	kiad&aacute;s&aacute;val tudunk &aacute;llom&aacute;nyrendszert
	l&eacute;trehozni:</para>

      <screen>&prompt.root; <userinput>newfs /dev/gvinum/concat</userinput></screen>

      <note>
	<para>A &os; 5.0 el&#245;tt verzi&oacute;iban a &man.newfs.8;
	  parancsnak a r&eacute;gi elnevez&eacute;si s&eacute;ma
	  haszn&aacute;lata mellett m&eacute;g &aacute;t kell adni egy
	  -v kapcsol&oacute;t is:</para>

	<screen>&prompt.root; <userinput>newfs -v /dev/vinum/concat</userinput></screen>
      </note>
    </sect2>
  </sect1>

  <sect1 id="vinum-config">
    <title>A Vinum be&aacute;ll&iacute;t&aacute;sa</title>

    <para>A <filename>GENERIC</filename> rendszermag nem tartalmazza a
      Vinumot.  Hab&aacute;r k&eacute;sz&iacute;teni lehet olyan
      rendszermagot, amelyik t&aacute;mogatja a Vinumot, m&eacute;gsem
      aj&aacute;nlott.  A Vinumot a szabv&aacute;nyos m&oacute;don
      modulk&eacute;nt (<acronym>kld</acronym>) ind&iacute;thatjuk el.
      M&eacute;g a &man.kldload.8; haszn&aacute;lat&aacute;ra sincs
      sz&uuml;ks&eacute;g, mivel a &man.gvinum.8; indul&aacute;sa
      sor&aacute;n ellen&#245;rzi a modul jelenl&eacute;t&eacute;t
      &eacute;s bet&ouml;lti, ha m&eacute;g nem lenne jelen.</para>

    <sect2>
      <title>Ind&iacute;t&aacute;s</title>

      <para>A Vinum alapvet&#245;en ugyan&uacute;gy t&aacute;rolja a
	konfigur&aacute;ci&oacute;kat a slice-okban, mint maguk a
	konfigur&aacute;ci&oacute;s &aacute;llom&aacute;nyok.  A
	konfigur&aacute;ci&oacute;s adatb&aacute;zis beolvas&aacute;sa
	sor&aacute;n a Vinum felismeri azokat a kulcsszavakat,
	amelyeknek nem szabad el&#245;fordulniuk az
	&aacute;llom&aacute;nyokban.  P&eacute;ld&aacute;ul a lemezek
	be&aacute;ll&iacute;t&aacute;sa tartalmazhatja a
	k&ouml;vetkez&#245; sz&ouml;veget:</para>

      <programlisting width="119">volume myvol state up
volume bigraid state down
plex name myvol.p0 state up org concat vol myvol
plex name myvol.p1 state up org concat vol myvol
plex name myvol.p2 state init org striped 512b vol myvol
plex name bigraid.p0 state initializing org raid5 512b vol bigraid
sd name myvol.p0.s0 drive a plex myvol.p0 state up len 1048576b driveoffset 265b plexoffset 0b
sd name myvol.p0.s1 drive b plex myvol.p0 state up len 1048576b driveoffset 265b plexoffset 1048576b
sd name myvol.p1.s0 drive c plex myvol.p1 state up len 1048576b driveoffset 265b plexoffset 0b
sd name myvol.p1.s1 drive d plex myvol.p1 state up len 1048576b driveoffset 265b plexoffset 1048576b
sd name myvol.p2.s0 drive a plex myvol.p2 state init len 524288b driveoffset 1048841b plexoffset 0b
sd name myvol.p2.s1 drive b plex myvol.p2 state init len 524288b driveoffset 1048841b plexoffset 524288b
sd name myvol.p2.s2 drive c plex myvol.p2 state init len 524288b driveoffset 1048841b plexoffset 1048576b
sd name myvol.p2.s3 drive d plex myvol.p2 state init len 524288b driveoffset 1048841b plexoffset 1572864b
sd name bigraid.p0.s0 drive a plex bigraid.p0 state initializing len 4194304b driveoff set 1573129b plexoffset 0b
sd name bigraid.p0.s1 drive b plex bigraid.p0 state initializing len 4194304b driveoff set 1573129b plexoffset 4194304b
sd name bigraid.p0.s2 drive c plex bigraid.p0 state initializing len 4194304b driveoff set 1573129b plexoffset 8388608b
sd name bigraid.p0.s3 drive d plex bigraid.p0 state initializing len 4194304b driveoff set 1573129b plexoffset 12582912b
sd name bigraid.p0.s4 drive e plex bigraid.p0 state initializing len 4194304b driveoff set 1573129b plexoffset 16777216b</programlisting>

      <para>Az el&#245;bbiekt&#245;l nyilv&aacute;nval&oacute;an
	elt&eacute;r abban, hogy itt m&aacute;r megjelennek a
	konkr&eacute;t poz&iacute;ci&oacute;kra &eacute;s
	elnevez&eacute;sekre vonatkoz&oacute; inform&aacute;ci&oacute;k
	(melyeket a felhaszn&aacute;l&oacute; is megadhat, azonban ezt
	nem tan&aacute;csoljuk), valamint az &aacute;llapotok (ezeket
	nem l&aacute;thatja a felhaszn&aacute;l&oacute;).  A Vinum a
	konfigur&aacute;ci&oacute;ban nem t&aacute;rolja a
	meghajt&oacute;kat, helyette a be&aacute;ll&iacute;tott lemezes
	meghajt&oacute;k part&iacute;ci&oacute;in fog
	Vinum-c&iacute;mk&eacute;ket keresni.  Ennek
	k&ouml;sz&ouml;nhet&#245;en a Vinum m&eacute;g akkor is
	k&eacute;pes pontosan megtal&aacute;lni a meghajt&oacute;kat,
	amikor megv&aacute;ltoznak a hozz&aacute; tartoz&oacute;
	&unix;-os meghajt&oacute;k azonos&iacute;t&oacute;i.</para>

      <sect3 id="vinum-rc-startup">
	<title>Automatikus ind&iacute;t&aacute;s</title>

	<note>
	  <para>Ez a r&eacute;sz csak a Vinum elavult
	    implement&aacute;ci&oacute;j&aacute;ra vonatkozik.  A
	    &man.loader.conf.5; k&ouml;zvet&iacute;t&eacute;s&eacute;vel
	    a <emphasis>Gvinum</emphasis> mindig automatikusan elindul a
	    hozz&aacute; tartoz&oacute; modul
	    bet&ouml;lt&eacute;s&eacute;vel egy&uuml;tt.  Ha a
	    rendszerind&iacute;t&aacute;skor be akarjuk t&ouml;lteni a
	    <emphasis>Gvinum</emphasis> modult, akkor a
	    <filename>/boot/loader.conf</filename>
	    &aacute;llom&aacute;nyba vegy&uuml;k fel a
	    <literal>geom_vinum_load="YES"</literal> sort.</para>
	</note>

	<para>Az al&aacute;bbi sort mindenk&eacute;ppen hozz&aacute;
	  kell adnunk az <filename>/etc/rc.conf</filename>
	  &aacute;llom&aacute;nyhoz, hogy a Vinum a
	  rendszerind&iacute;t&aacute;s sor&aacute;n automatikusan
	  elinduljon:</para>

	<programlisting>start_vinum="YES"		# &aacute;ll&iacute;tsuk YES-re az ind&iacute;t&aacute;shoz</programlisting>

	<para>Hozzuk l&eacute;tre &eacute;s &iacute;rjuk bele, ha nem
	  lenne <filename>/etc/rc.conf</filename> nev&#251;
	  &aacute;llom&aacute;nyunk.  Ennek hat&aacute;s&aacute;ra a
	  rendszer az indul&aacute;s sor&aacute;n bet&ouml;lti a Vinum
	  <acronym>kld</acronym> modult, &eacute;s a
	  konfigur&aacute;ci&oacute;ban szerepl&#245; objektumokat
	  elind&iacute;tja.  Ez m&eacute;g az
	  &aacute;llom&aacute;nyrendszerek csatlakoztat&aacute;sa
	  el&#245;tt t&ouml;rt&eacute;nik meg, aminek
	  r&eacute;v&eacute;n a Vinum-k&ouml;teteken
	  tal&aacute;lhat&oacute; &aacute;llom&aacute;nyrendszereket a
	  rendszer automatikusan &aacute;t tudja vizsg&aacute;lni az
	  &man.fsck.8; seg&iacute;ts&eacute;g&eacute;vel, majd
	  csatlakoztatja ezeket.</para>

	<para>Amikor a Vinumot a <command>vinum start</command>
	  paranccsal ind&iacute;tjuk el, a Vinum beolvassa a
	  konfigur&aacute;ci&oacute;s adatb&aacute;zist a
	  Vinum-meghajt&oacute;k egyik&eacute;r&#245;l.  Norm&aacute;l
	  k&ouml;r&uuml;lm&eacute;nyek k&ouml;z&ouml;tt mindegyik
	  meghajt&oacute;n megtal&aacute;lhat&oacute; a
	  konfigur&aacute;ci&oacute;s adatb&aacute;zis egy
	  p&eacute;ld&aacute;nya, ez&eacute;rt szinte teljesen mindegy,
	  melyik meghajt&oacute;t is olvassa.  Egy
	  rendszer-&ouml;sszeoml&aacute;s ut&aacute;n azonban a Vinumnak
	  meg kell tudnia &aacute;llap&iacute;tania, melyik
	  meghajt&oacute;n tal&aacute;lhat&oacute; meg az
	  adatb&aacute;zis legfrissebb p&eacute;ld&aacute;nya, &eacute;s
	  ezt kell beolvasnia.  Ezut&aacute;n a lemaradt
	  meghajt&oacute;kon tal&aacute;lhat&oacute;
	  adatb&aacute;zisp&eacute;ld&aacute;nyokat
	  szinkroniz&aacute;lja ehhez a v&aacute;ltozathoz.</para>

      </sect3>
    </sect2>
  </sect1>

  <sect1 id="vinum-root">
    <title>Rendszerind&iacute;t&aacute;s
      Vinum-k&ouml;tetr&#245;l</title>

    <para>Olyan sz&aacute;m&iacute;t&oacute;g&eacute;pekn&eacute;l, ahol
      a teljesen t&uuml;kr&ouml;z&ouml;tt Vinum-alap&uacute;
      &aacute;llom&aacute;nyrendszereket haszn&aacute;lunk,
      k&iacute;v&aacute;natos lehet mag&aacute;t a
      rendszerind&iacute;t&aacute;shoz haszn&aacute;lt
      &aacute;llom&aacute;nyrendszert is t&uuml;kr&ouml;zni.  Egy ilyen
      konfigur&aacute;ci&oacute; &ouml;ssze&aacute;ll&iacute;t&aacute;sa
      m&aacute;r messze nem annyira egyszer&#251;, mint egy
      tetsz&#245;leges &aacute;llom&aacute;nyrendszer eset&eacute;n,
      mivel:</para>

    <itemizedlist>
      <listitem>
	<para>Az ind&iacute;t&aacute;shoz haszn&aacute;lt
	  &aacute;llom&aacute;nyrendszernek m&aacute;r a folyamat nagyon
	  korai szakasz&aacute;ban rendelkez&eacute;sre kell
	  &aacute;llnia, ez&eacute;rt a Vinumnak m&aacute;r itt
	  el&eacute;rhet&#245;nek kell lennie.</para>
      </listitem>
      <listitem>
	<para>A rendszerind&iacute;t&oacute;
	  &aacute;llom&aacute;nyrendszert tartalmaz&oacute; k&ouml;teten
	  m&eacute;g ott kell lennie a rendszerind&iacute;t&oacute;
	  k&oacute;dnak &eacute;s a rendszermagnak is, melyeket a
	  rendszer saj&aacute;t eszk&ouml;zein (p&eacute;ld&aacute;ul
	  ilyen a BIOS a PC-kn&eacute;l) kereszt&uuml;l kell tudnunk
	  beolvasni, amiket viszont nem tudunk
	  felk&eacute;sz&iacute;teni a Vinumra.</para>
      </listitem>
    </itemizedlist>

    <para>A soronk&ouml;vetkez&#245; szakaszokban
      <quote>rendszerind&iacute;t&oacute; k&ouml;tetk&eacute;nt</quote>
      (root volume) fogunk &aacute;ltal&aacute;noss&aacute;gban
      v&eacute;ve hivatkozni a rendszerind&iacute;t&aacute;shoz
      haszn&aacute;lt &aacute;llom&aacute;nyrendszert tartalmaz&oacute;
      Vinum-k&ouml;tetre.  Ennek megfelel&#245;en
      val&oacute;sz&iacute;n&#251;leg j&oacute; &ouml;tlet a
      <literal>"root"</literal> n&eacute;vvel azonos&iacute;tani ezt a
      k&ouml;tetet, hab&aacute;r technikai szempontb&oacute;l ezt semmi
      nem k&ouml;veteli meg.  Az itt felsorakoz&oacute;
      p&eacute;ld&aacute;kban azonban ezt a nevet fogjuk
      haszn&aacute;lni.</para>

    <sect2>
      <title>A Vinum kell&#245;en korai ind&iacute;t&aacute;sa</title>

      <para>Ennek kiv&aacute;lt&aacute;s&aacute;hoz sz&aacute;mos
	l&eacute;p&eacute;st kell megtenn&uuml;nk:</para>

      <itemizedlist>
	<listitem>
	  <para>A rendszermagnak m&aacute;r el kell &eacute;rnie a
	    Vinumot a rendszerind&iacute;t&aacute;s sor&aacute;n.
	    Emiatt a <xref linkend="vinum-rc-startup">ban le&iacute;rt
	    automatikus ind&iacute;t&aacute;si m&oacute;dszer nem
	    alkalmazhat&oacute; erre a feladatra, &eacute;s a
	    <literal>start_vinum</literal> param&eacute;tert
	    <emphasis>nem</emphasis> is szabad haszn&aacute;lni a most
	    ismertetend&#245; konfigur&aacute;ci&oacute;ban.  A Vinumot
	    statikusan bele is &eacute;p&iacute;thetj&uuml;k a
	    rendszermagba &eacute;s &iacute;gy &aacute;lland&oacute;an
	    el&eacute;rhet&#245;, de ez &aacute;ltal&aacute;ban nem
	    kiel&eacute;g&iacute;t&#245; megold&aacute;s.  Megoldhatjuk
	    &uacute;gy is, ha a <filename>/boot/loader</filename>-re
	    (<xref linkend="boot-loader">) b&iacute;zzuk a vinum modul
	    bet&ouml;lt&eacute;s&eacute;t, m&eacute;g a rendszermag
	    el&#245;tt.  Ezt az al&aacute;bbi sorral v&aacute;lthatjuk
	    ki a <filename>/boot/loader.conf</filename>
	    &aacute;llom&aacute;nyban:</para>

	  <programlisting>geom_vinum_load="YES"</programlisting>
	</listitem>

	<listitem>
	  <note>
	    <para>A <emphasis>Gvinum</emphasis> haszn&aacute;lata
	      sor&aacute;n az &ouml;sszes t&ouml;bbi
	      be&aacute;ll&iacute;t&aacute;s automatikusan
	      v&eacute;grehajt&oacute;dik, amint a modul
	      bet&ouml;lt&#245;dik, ez&eacute;rt ilyenkor csak a fentebb
	      le&iacute;rt elj&aacute;r&aacute;sra van
	      sz&uuml;ks&eacute;g.  Az itt felsoroltak csak az elavult
	      Vinum implement&aacute;ci&oacute;ra vonatkoznak,
	      csup&aacute;n a r&eacute;gebbi t&iacute;pus&uacute;
	      rendszerek kedv&eacute;&eacute;rt eml&iacute;tj&uuml;k
	      meg.</para>
	  </note>

	  <para>A Vinumot nagyon kor&aacute;n &eacute;letre kell
	    kelten&uuml;nk, hiszen a rendszerind&iacute;t&aacute;shoz
	    haszn&aacute;lt &aacute;llom&aacute;nyrendszert
	    tartalmaz&oacute; k&ouml;tetet kell
	    &eacute;les&iacute;ten&uuml;nk.
	    Alap&eacute;rtelmez&eacute;s szerint a Vinum rendszerszinten
	    fut&oacute; r&eacute;sze nem keres addig semmilyen
	    Vinum-k&ouml;tetinform&aacute;ci&oacute;val rendelkez&#245;
	    meghajt&oacute;t, am&iacute;g a rendszergazda (vagy
	    valamelyik rendszerind&iacute;t&oacute; szkript) ki nem adja
	    a <command>vinum start</command> parancsot.</para>

	  <note>
	    <para>A most k&ouml;vetkez&#245; bekezd&eacute;sek
	      mutatj&aacute;k be a sz&uuml;ks&eacute;ges
	      l&eacute;p&eacute;seket.</para>
	  </note>

	  <para>Ha hozz&aacute;adjuk a k&ouml;vetkez&#245; sort a
	    <filename>/boot/loader.conf</filename>
	    &aacute;llom&aacute;nyhoz, akkor azzal utas&iacute;thatjuk a
	    Vinumot, hogy a rendszermag ind&iacute;t&aacute;sa
	    sor&aacute;n vizsg&aacute;lja &aacute;t az &ouml;sszes
	    meghajt&oacute;t:</para>

	  <programlisting>vinum.autostart="YES"</programlisting>

	  <para>Nem sz&uuml;ks&eacute;ges megmondani a rendszermagnak,
	    merre keresse a rendszerind&iacute;t&aacute;shoz
	    haszn&aacute;lt &aacute;llom&aacute;nyrendszert.  A
	    <filename>/boot/loader</filename> megkeresi a
	    hozz&aacute; tartoz&oacute; eszk&ouml;zt a
	    <filename>/etc/fstab</filename> &aacute;llom&aacute;nyban
	    &eacute;s &aacute;tadja ezt az inform&aacute;ci&oacute;t a
	    rendszermagnak.  Amikor a csatlakoztat&aacute;s&aacute;ra
	    ker&uuml;l sor, a rendszermag az eszk&ouml;z
	    nev&eacute;b&#245;l meg tudja &aacute;llap&iacute;tani,
	    melyik eszk&ouml;zmeghajt&oacute;t k&eacute;rje meg a
	    bels&#245; (f&#245;- &eacute;s
	    al)eszk&ouml;zazonos&iacute;t&oacute;
	    lek&eacute;pz&eacute;s&eacute;hez.</para>
	</listitem>
      </itemizedlist>

    </sect2>

    <sect2>
      <title>A Vinum-alap&uacute; rendszerind&iacute;t&oacute;
	k&ouml;tet el&eacute;r&eacute;se a rendszert&ouml;lt&eacute;s
	sor&aacute;n</title>

      <para>Mivel a jelenlegi &os; rendszert&ouml;lt&#245; csak 7,5 KB
	m&eacute;ret&#251; &eacute;s egy&eacute;bk&eacute;nt is csak az
	UFS &aacute;llom&aacute;nyrendszerr&#245;l tud
	&aacute;llom&aacute;nyokat beolvasni (mint p&eacute;ld&aacute;ul
	a <filename>/boot/loader</filename>t), teljesen lehetetlen
	m&eacute;g a Vinum bels&#245; szerkezet&eacute;re is
	megtan&iacute;tani, teh&aacute;t a
	Vinum-konfigur&aacute;ci&oacute;k
	&eacute;rtelmez&eacute;s&eacute;re &eacute;s mag&aacute;nak a
	rendszerind&iacute;t&oacute; k&ouml;tet elemeinek
	kielemz&eacute;s&eacute;re.  Ez&eacute;rt be kell vetn&uuml;nk
	n&eacute;h&aacute;ny tr&uuml;kk&ouml;t ahhoz, hogy a
	rendszerind&iacute;t&oacute; k&oacute;d sz&aacute;m&aacute;ra a
	rendszerind&iacute;t&aacute;shoz haszn&aacute;lhat&oacute;
	szabv&aacute;nyos <literal>"a"</literal> part&iacute;ci&oacute;
	k&eacute;pzet&eacute;t kelts&uuml;k.</para>

      <para>Mindez csak akkor v&aacute;lik
	el&eacute;rhet&#245;v&eacute;, ha az al&aacute;bbi
	k&ouml;vetelm&eacute;nyeket teljes&iacute;ti a
	rendszerind&iacute;t&oacute; k&ouml;tet:</para>

      <itemizedlist>
	<listitem>
	  <para>Nem lehet cs&iacute;kozott vagy RAID-5
	    t&iacute;pus&uacute;.</para>
	</listitem>

	<listitem>
	  <para>Erenk&eacute;nt nem tartalmazhat egyn&eacute;l t&ouml;bb
	    &ouml;sszef&#251;z&ouml;tt allemezt.</para>
	</listitem>
      </itemizedlist>

      <para>L&aacute;thatjuk, hogy hasznos &eacute;s lehets&eacute;ges
	is t&ouml;bb eret haszn&aacute;lni, melyek mindegyike a
	rendszerind&iacute;t&oacute; &aacute;llom&aacute;nyrendszer
	egy-egy m&aacute;solat&aacute;t tartalmazza.  Az indul&aacute;s
	folyam&aacute;n azonban ezen p&eacute;ld&aacute;nyok
	k&ouml;z&uuml;l csak az egyiken fogja keresni a rendszer a
	rendszert&ouml;lt&#245;t &eacute;s a t&ouml;bbi
	&aacute;llom&aacute;nyt eg&eacute;szen addig, am&iacute;g a
	rendszermag mag&aacute;t az &aacute;llom&aacute;nyrendszert nem
	csatlakoztatja.  A l&aacute;tszat kedv&eacute;&eacute;rt az
	ereken bel&uuml;l tal&aacute;lhat&oacute; allemezek
	mindegyik&eacute;nek lennie kell egy saj&aacute;t
	<literal>"a"</literal> part&iacute;ci&oacute;j&aacute;nak,
	amivel l&eacute;nyeg&eacute;ben alkalmass&aacute; v&aacute;lik a
	rendszerind&iacute;t&aacute;sra.  Ezeknek a hamis
	<literal>"a"</literal> part&iacute;ci&oacute;knak nem kell
	felt&eacute;tlen&uuml;l a t&ouml;bbiekkel megegyez&#245;
	poz&iacute;ci&oacute;kon elhelyezkedni&uuml;k, azonban a
	t&eacute;ved&eacute;sek elker&uuml;l&eacute;se
	&eacute;rdek&eacute;ben val&oacute;sz&iacute;n&#251;leg hasznos
	olyan Vinum-k&ouml;teteket l&eacute;trehozni, ahol a
	keletkez&#245; t&uuml;kr&ouml;z&ouml;tt eszk&ouml;z&ouml;k
	szimmetrikusak.</para>

      <para>A rendszerind&iacute;t&oacute; k&ouml;tet egyes
	eszk&ouml;z&ouml;k&ouml;n tal&aacute;lhat&oacute;
	<literal>"a"</literal> part&iacute;ci&oacute;it az
	al&aacute;bbiak seg&iacute;ts&eacute;g&eacute;vel
	&aacute;ll&iacute;thatjuk be:</para>

      <procedure>
	<step>
	  <para>A rendszerind&iacute;t&oacute; k&ouml;tet
	    r&eacute;szek&eacute;nt megjelen&#245; eszk&ouml;z&ouml;n
	    tal&aacute;lhat&oacute; allemez hely&eacute;t (az
	    eszk&ouml;z elej&eacute;t&#245;l sz&aacute;m&iacute;tott
	    eltol&aacute;s&aacute;t) &eacute;s m&eacute;ret&eacute;t
	    ellen&#245;rizni kell az al&aacute;bbi parancs
	    seg&iacute;ts&eacute;g&eacute;vel:</para>

	  <screen>&prompt.root; <userinput>gvinum l -rv root</userinput></screen>

	  <para>Ne felejts&uuml;k el, hogy a Vinum az eltol&aacute;sokat
	    &eacute;s m&eacute;reteket byte-okban m&eacute;ri.
	    Ezekb&#245;l teh&aacute;t &uacute;gy nyer&uuml;nk a
	    <command>bsdlabel</command> haszn&aacute;lat&aacute;hoz
	    sz&uuml;ks&eacute;ges blokksz&aacute;mokat, ha ezeket
	    elosztjuk 512-vel.</para>
	</step>

	<step>
	  <para>Futassuk le a</para>

	  <screen>&prompt.root; <userinput>bsdlabel -e <replaceable>eszk&ouml;zn&eacute;v</replaceable></userinput></screen>

	  <para>parancsot minden olyan eszk&ouml;z&ouml;n, amelyik
	    r&eacute;szt vesz a rendszerind&iacute;t&oacute; k&ouml;tet
	    kialak&iacute;t&aacute;s&aacute;ban.  Az
	    <replaceable>eszk&ouml;zn&eacute;v</replaceable> legyen a
	    slice (fdisk)-t&aacute;bl&aacute;t nem tartalmaz&oacute;
	    lemezek eset&eacute;n a lemez neve (mint
	    p&eacute;ld&aacute;ul <devicename>da0</devicename>), vagy
	    ellenkez&#245; esetben a slice neve (p&eacute;ld&aacute;ul
	    <devicename>ad0s1</devicename>).</para>

	  <para>Ha m&aacute;r lenne egy <literal>"a"</literal>
	    part&iacute;ci&oacute; az eszk&ouml;z&ouml;n
	    (val&oacute;sz&iacute;n&#251;leg egy Vinum el&#245;tti
	    rendszer&iacute;nd&iacute;t&oacute;
	    &aacute;llom&aacute;nyrendszert tartalmaz), nevezz&uuml;k
	    &aacute;t valami m&aacute;sra &eacute;s &iacute;gy
	    tov&aacute;bbra is el&eacute;rhet&#245; marad (biztos, ami
	    biztos), viszont t&ouml;bb&eacute; m&aacute;r nem lesz a
	    rendszer sz&aacute;m&aacute;ra alap&eacute;rtelmezett
	    rendszerind&iacute;t&oacute; eszk&ouml;z.  Az akt&iacute;v
	    part&iacute;ci&oacute;k (mint p&eacute;ld&aacute;ul az
	    &eacute;ppen csatlakoztatott rendszerind&iacute;t&oacute;
	    &aacute;llom&aacute;nyrendszer) nem nevezhet&#245;ek
	    &aacute;t, ez&eacute;rt ezt a l&eacute;p&eacute;st csak
	    akkor tudjuk megtenni, ha a rendszer&uuml;nket egy
	    <quote>Fixit</quote> (Helyre&aacute;ll&iacute;t&oacute;)
	    eszk&ouml;zr&#245;l ind&iacute;tjuk, vagy egy olyan
	    k&eacute;tl&eacute;p&eacute;ses folyamat sor&aacute;n, ahol
	    (t&uuml;kr&ouml;z&eacute;s eset&eacute;n) a lemezr&#245;l
	    m&eacute;g nem ind&iacute;tottuk el a rendszert.</para>

	  <para>Ezt k&ouml;vet&#245;en az eszk&ouml;z&ouml;n
	    tal&aacute;lhat&oacute; Vinum-part&iacute;ci&oacute;t
	    (amennyiben l&eacute;tezik) az eszk&ouml;z&ouml;n lev&#245;
	    allemez eltol&aacute;s&aacute;hoz kell helyezni.  Ennek
	    eredm&eacute;nye lesz az &uacute;j <literal>"a"</literal>
	    part&iacute;ci&oacute; <literal>"offset"</literal>
	    &eacute;rt&eacute;ke.  A part&iacute;ci&oacute;
	    <literal>"size"</literal> (m&eacute;ret)
	    &eacute;rt&eacute;ke sz&oacute; szerint
	    &aacute;temelhet&#245; a fenti
	    sz&aacute;m&iacute;t&aacute;sb&oacute;l.  Az
	    <literal>"fstype"</literal> legyen
	    <literal>4.2BSD</literal>.  Az <literal>"fsize"</literal>,
	    <literal>"bsize"</literal> &eacute;s
	    <literal>"cpg"</literal> &eacute;rt&eacute;keket a jelenlegi
	    &aacute;llom&aacute;nyrendszerhez m&eacute;rten
	    aj&aacute;nlott megv&aacute;lasztani, azonban itt most
	    egy&aacute;ltal&aacute;n nem b&iacute;rnak
	    jelent&#245;s&eacute;ggel.</para>

	  <para>Ezzel a m&oacute;dszerrel
	    l&eacute;tes&iacute;tett&uuml;nk egy olyan &uacute;j
	    <literal>"a"</literal> part&iacute;ci&oacute;t, amely lefedi
	    az eszk&ouml;z&ouml;n tal&aacute;lhat&oacute;
	    Vinum-part&iacute;ci&oacute;t.  Jegyezz&uuml;k meg, hogy a
	    <command>bsdlabel</command> kiz&aacute;rolag csak abban az
	    esetben fogja megengedi ezt az &aacute;tfed&eacute;st, ha a
	    Vinum-part&iacute;ci&oacute;nk <literal>"vinum"</literal>
	    t&iacute;pussal van megjel&ouml;lve.</para>
	</step>

	<step>
	  <para>K&eacute;szen is vagyunk!  Most m&aacute;r van minden
	    eszk&ouml;z&ouml;n egy hamis&iacute;tott
	    <literal>"a"</literal> part&iacute;ci&oacute;nk, amelyeken
	    megtal&aacute;lhat&oacute; a rendszerind&iacute;t&oacute;
	    k&ouml;tet egy-egy m&aacute;solata.  Hat&aacute;rozottan
	    aj&aacute;nlott m&eacute;g egyszer ellen&#245;rizni a
	    munk&aacute;nkat az al&aacute;bbi parancs
	    kiad&aacute;s&aacute;val:</para>

	  <screen>&prompt.root; <userinput>fsck -n /dev/<replaceable>eszk&ouml;zn&eacute;v</replaceable>a</userinput></screen>
	</step>
      </procedure>

      <para>Figyelj&uuml;nk arra, hogy az &ouml;sszes
	vez&eacute;rl&eacute;si inform&aacute;ci&oacute;t
	tartalmaz&oacute; &aacute;llom&aacute;nynak a Vinum-k&ouml;teten
	tal&aacute;lhat&oacute; rendszerind&iacute;t&oacute;
	&aacute;llom&aacute;nyrendszerre kell vonatkoznia, ami viszont
	egy &uacute;j Vinum rendszerind&iacute;t&oacute; k&ouml;tet
	be&aacute;ll&iacute;t&aacute;sa ut&aacute;n nem
	felt&eacute;tlen&uuml;l egyezik meg a jelenlegi akt&iacute;v
	&aacute;llom&aacute;nyrendszerrel.  K&uuml;l&ouml;n&ouml;sen az
	<filename>/etc/fstab</filename> &eacute;s
	<filename>/boot/loader.conf</filename>
	&aacute;llom&aacute;nyokat kell ilyen szempontb&oacute;l
	ellen&#245;rizn&uuml;nk.</para>

      <para>A k&ouml;vetkez&#245; ind&iacute;t&aacute;s sor&aacute;n a
	rendszert&ouml;lt&#245; m&aacute;r az &uacute;j
	Vinum-alap&uacute; rendszerind&iacute;t&oacute;
	&aacute;llom&aacute;nyrendszerr&#245;l fogja &ouml;sszeszedni a
	m&#251;k&ouml;d&eacute;s&eacute;hez sz&uuml;ks&eacute;ges
	adatokat &eacute;s ezeknek megfelel&#245;en cselekedni.
	V&eacute;g&uuml;l, a rendszermag inicializ&aacute;l&oacute;ja
	ut&aacute;n, mikor az &ouml;sszes eszk&ouml;zt felismerte, egy
	ehhez hasonl&oacute; felt&#251;n&#245; &uuml;zenet fogja jelezni
	a be&aacute;ll&iacute;t&aacute;s
	sikeress&eacute;g&eacute;t:</para>

      <screen>Mounting root from ufs:/dev/gvinum/root</screen>

    </sect2>

    <sect2>
      <title>Egy Vinum-alap&uacute; rendszerind&iacute;t&oacute;
	&aacute;llom&aacute;nyrendszer p&eacute;ld&aacute;ja</title>

      <para>Miut&aacute;n sikeresen konfigur&aacute;ltuk a
	rendszerind&iacute;t&oacute; Vinum-k&ouml;tetet, a
	<command>gvinum l -rv root</command> kimenete
	nagyj&aacute;b&oacute;l &iacute;gy fog kin&eacute;zni:</para>

	<screen>
...
Subdisk root.p0.s0:
		Size:        125829120 bytes (120 MB)
		State: up
		Plex root.p0 at offset 0 (0  B)
		Drive disk0 (/dev/da0h) at offset 135680 (132 kB)

Subdisk root.p1.s0:
		Size:        125829120 bytes (120 MB)
		State: up
		Plex root.p1 at offset 0 (0  B)
		Drive disk1 (/dev/da1h) at offset 135680 (132 kB)
	</screen>

      <para>Itt (a <filename class="devicefile">/dev/da0h</filename>
	part&iacute;ci&oacute;hoz k&eacute;pesti)
	<literal>135680</literal>-as eltolt&aacute;s
	&eacute;rt&eacute;kekre kell figyeln&uuml;nk.  Ez
	k&eacute;pz&#245;dik le a <command>bsdlabel</command> fogalmi
	rendszer&eacute;ben azt&aacute;n 265 darab 512&nbsp;byte-os
	blokkra a lemezen.  Ehhez hasonl&oacute;an a
	rendszerind&iacute;t&oacute; k&ouml;tet m&eacute;rete
	245&nbsp;760 darab 512&nbsp;byte-os blokk lesz.  A
	rendszerind&iacute;t&oacute; k&ouml;tet
	m&aacute;sodp&eacute;ld&aacute;ny&aacute;t tartalmaz&oacute;
	<filename class="devicefile">/dev/da1h</filename> ugyanilyen
	be&aacute;ll&iacute;t&aacute;sokkal rendelkezik.</para>

      <para>Az eml&iacute;tett eszk&ouml;z&ouml;k valahogy &iacute;gy
	jelennek meg a <command>bsdlabel</command> szerint:</para>

	<screen>
...
8 partitions:
#        size   offset    fstype   [fsize bsize bps/cpg]
  a:   245760      281    4.2BSD     2048 16384     0   # (Cyl.    0*- 15*)
  c: 71771688        0    unused        0     0         # (Cyl.    0 - 4467*)
  h: 71771672       16     vinum                        # (Cyl.    0*- 4467*)
	</screen>

      <para>Megfigyelhet&#245;, hogy a hamis <literal>"a"</literal>
	part&iacute;ci&oacute; <literal>"size"</literal>
	param&eacute;ter &eacute;rt&eacute;ke megegyezik a fentebb
	becs&uuml;lt &eacute;rt&eacute;kkel, mik&ouml;zben az
	<literal>"offset"</literal> param&eacute;ter
	&eacute;rt&eacute;ke egyenl&#245; lesz a <literal>"h"</literal>
	Vinum-part&iacute;ci&oacute;n bel&uuml;li eltol&aacute;s
	&eacute;s az eszk&ouml;z&ouml;n (vagy slice-on) bel&uuml;li
	eltol&aacute;s &ouml;sszeg&eacute;vel.  Ez jellemz&#245;en egy
	olyan be&aacute;ll&iacute;t&aacute;s, amivel
	sz&uuml;ks&eacute;gszer&#251;en el tudjuk ker&uuml;lni a <xref
	linkend="vinum-root-panic">ban le&iacute;rt
	hibajelens&eacute;get.  L&aacute;that&oacute;
	tov&aacute;bb&aacute; az is, hogy az eg&eacute;sz
	<literal>"a"</literal> part&iacute;ci&oacute; v&eacute;gig az
	eszk&ouml;z &ouml;sszes Vinum adat&aacute;t tartalmaz&oacute;
	<literal>"h"</literal> part&iacute;ci&oacute;j&aacute;ban foglal
	helyet.</para>

      <para>A p&eacute;ld&aacute;val kapcsolatban megjegyezz&uuml;k,
	hogy itt az eg&eacute;sz eszk&ouml;zt a Vinum fel&uuml;gyelete
	al&aacute; bocs&aacute;tottuk, teh&aacute;t nem marad
	h&aacute;tra semmilyen Vinum el&#245;tt haszn&aacute;lt
	rendszerind&iacute;t&oacute; part&iacute;ci&oacute;, hiszen ez
	egy olyan lemez, amelyet eleve egy
	Vinum-konfigur&aacute;ci&oacute;ba sz&aacute;ntunk.</para>

    </sect2>

    <sect2>
      <title>Hibakeres&eacute;s</title>

      <para>Fontos tudunk, hogy probl&eacute;ma eset&eacute;n hogyan
	tudjuk helyre&aacute;ll&iacute;tani a rendszer&uuml;nket.  A
	k&ouml;vetkez&#245; felsorol&aacute;sban bemutatunk
	n&eacute;h&aacute;ny ismert buktat&oacute;t &eacute;s a
	megold&aacute;saikat.</para>

      <sect3>
	<title>A rendszert&ouml;lt&#245; elindul, de a rendszer viszont
	  m&aacute;r nem</title>

	<para>Ha valamilyen okb&oacute;l a rendszer nem indulna el, a 10
	  m&aacute;sodpercig tart&oacute;
	  visszasz&aacute;ml&aacute;l&aacute;s sor&aacute;n a
	  rendszert&ouml;lt&#245;t m&eacute;g meg tudjuk
	  &aacute;ll&iacute;tani a <keycap>sz&oacute;k&ouml;z</keycap>
	  lenyom&aacute;s&aacute;val.  Ekkor a bet&ouml;lt&#245;
	  &aacute;ltal haszn&aacute;lt v&aacute;ltoz&oacute;k (mint
	  p&eacute;ld&aacute;ul a <literal>vinum.autostart</literal>) a
	  <command>show</command> seg&iacute;ts&eacute;g&eacute;vel
	  megvizsg&aacute;lhat&oacute;ak &eacute;s a
	  <command>set</command> vagy <command>unset</command>
	  parancsokkal m&oacute;dos&iacute;that&oacute;ak.</para>

	<para>Ha mind&ouml;ssze az volt a probl&eacute;ma, hogy a Vinum
	  modulja nem szerepelt az automatikusan bet&ouml;ltend&#245;
	  modulok k&ouml;z&ouml;tt, a <command>load geom_vinum</command>
	  parancs kiad&aacute;s&aacute;val bet&ouml;lthetj&uuml;k
	  azt.</para>

	<para>Miut&aacute;n v&eacute;gezt&uuml;nk, a
	  rendszerind&iacute;t&aacute;s folyamata a <command>boot
	  -as</command> paranccsal folytathat&oacute;.  A
	  <option>-as</option> kapcsol&oacute;k jelzik a rendszermag
	  sz&aacute;m&aacute;ra, hogy k&eacute;rdezzen r&aacute; a
	  rendszerind&iacute;t&oacute; &aacute;llom&aacute;nyrendszerre
	  a csatlakoztat&aacute;sa el&#245;tt (<option>-a</option>)
	  &eacute;s csak egyfelhaszn&aacute;l&oacute;s m&oacute;dban
	  ind&iacute;tsa a rendszert (<option>-s</option>), ahol a
	  rendszerind&iacute;t&oacute; &aacute;llom&aacute;nyrendszer
	  &iacute;r&aacute;sv&eacute;dett.  &Iacute;gy, ha csak egyetlen
	  eret csatlakoztattunk egy t&ouml;bberes k&ouml;tetb&#245;l, az
	  erek m&eacute;g v&eacute;letlen&uuml;l sem tudnak
	  egym&aacute;snak ellentmond&oacute; &aacute;llapotba
	  ker&uuml;lni.</para>

	<para>Amikor megjelenik a csatlakoztatand&oacute;
	  rendszerind&iacute;t&oacute; &aacute;llom&aacute;nyrendszert
	  bek&eacute;r&eacute;se, b&aacute;rmelyik
	  &eacute;rv&eacute;nyes rendszerind&iacute;t&aacute;sra
	  alkalmas &aacute;llom&aacute;nyrendszer megadhat&oacute;.
	  Amennyiben az <filename>/etc/fstab</filename>
	  &aacute;llom&aacute;nyt j&oacute;l be&aacute;ll&iacute;tottuk,
	  az alap&eacute;rtelmezett &eacute;rt&eacute;k egy
	  <literal>ufs:/dev/gvinum/root</literal> &eacute;rt&eacute;khez
	  hasonl&oacute; alak&uacute; lesz.  Itt &aacute;ltal&aacute;ban
	  egy <literal>ufs:da0d</literal> form&aacute;tum&uacute;
	  &eacute;rt&eacute;ket l&aacute;thatunk, amely feltehet&#245;en
	  egy Vinum haszn&aacute;lata el&#245;tti
	  rendszerind&iacute;t&oacute; &aacute;llom&aacute;nyrendszert
	  tartalmaz&oacute; part&iacute;ci&oacute;.  Legy&uuml;nk
	  &oacute;vatosak, ha itt egy olyan <literal>"a"</literal>
	  part&iacute;ci&oacute;t adunk meg, amely
	  val&oacute;j&aacute;ban egy rendszerind&iacute;t&oacute;
	  Vinum-eszk&ouml;z allemezeire hivatkozik, mivel egy
	  t&uuml;kr&ouml;z&ouml;tt konfigur&aacute;ci&oacute;
	  eset&eacute;n csak az eszk&ouml;z egyik r&eacute;sz&eacute;t
	  fogjuk csatlakoztatni.  Ha a k&eacute;s&#245;bbiekben ezt az
	  &aacute;llom&aacute;nyrendszert m&aacute;r nem csak
	  &iacute;r&aacute;sv&eacute;dett m&oacute;dban csatlakoztatjuk,
	  mindenk&eacute;ppen el kell t&aacute;vol&iacute;tanunk a
	  rendszerind&iacute;t&oacute; Vinum-k&ouml;tetb&#245;l a
	  t&ouml;bbi eret, mivel m&aacute;sk&uuml;l&ouml;nben nagy
	  val&oacute;sz&iacute;n&#251;s&eacute;ggel elt&eacute;r&#245;
	  adatokat fognak tartalmazni.</para>

      </sect3>

      <sect3>
	<title>Csak az els&#245;dleges rendszert&ouml;lt&#245; indul
	  el</title>

	<para>Amikor az els&#245;dleges rendszert&ouml;lt&#245;
	  m&eacute;g elindul, viszont a
	  <filename>/boot/loader</filename> m&aacute;r nem tud
	  bet&ouml;lt&#245;dni (ezt rendszerind&iacute;t&aacute;s
	  megkezd&eacute;se ut&aacute;n bal oldalt r&ouml;gt&ouml;n
	  megjelen&#245; forg&oacute; vonalb&oacute;l vehetj&uuml;k
	  &eacute;szre), a <keycap>sz&oacute;k&ouml;z</keycap>
	  lenyom&aacute;s&aacute;val itt m&eacute;g tehet&uuml;nk egy
	  k&iacute;s&eacute;rletet a bet&ouml;lt&eacute;s
	  megszak&iacute;t&aacute;s&aacute;ra.  Ennek
	  hat&aacute;s&aacute;ra a rendszert&ouml;lt&eacute;s
	  meg&aacute;ll a m&aacute;sodik f&aacute;zisban, l&aacute;sd
	  <xref linkend="boot-boot1">.  Itt a
	  rendszerind&iacute;t&aacute;shoz megpr&oacute;b&aacute;lhatunk
	  megadni egy m&aacute;sik part&iacute;ci&oacute;t,
	  p&eacute;ld&aacute;ul egy olyat, amely a kor&aacute;bbi
	  rendszerind&iacute;t&oacute; &aacute;llom&aacute;nyrendszert
	  tartalmazza &eacute;s amelyet az el&#245;bb
	  &aacute;tnevezt&uuml;nk az
	  <literal>"a"</literal>-r&oacute;l.</para>

      </sect3>

      <sect3 id="vinum-root-panic">
	<title>Semmi sem indul, a rendszert&ouml;lt&#245; hib&aacute;kat
	  &iacute;r</title>

	<para>Ez a helyzet akkor &aacute;llhat el&#245;, ha a Vinum
	  telep&iacute;t&eacute;se sor&aacute;n t&ouml;nkretett&uuml;k
	  volna a rendszert&ouml;lt&#245;t.  Sajnos a Vinum minden
	  esetben 4&nbsp;KB helyet hagy szabadon a
	  part&iacute;ci&oacute; elej&eacute;n, a saj&aacute;t
	  fejl&eacute;c inform&aacute;ci&oacute;j&aacute;nak
	  r&ouml;gz&iacute;t&eacute;se el&#245;tt.  Az ide
	  ker&uuml;l&#245; els&#245; &eacute;s m&aacute;sodik
	  f&aacute;zis&uacute; rendszert&ouml;lt&#245;k, illetve a
	  bsdlabel adatai azonban jelenleg 8&nbsp;KB helyet
	  k&iacute;v&aacute;nnak meg.  &Iacute;gy ha a
	  Vinum-part&iacute;ci&oacute; egy
	  rendszerind&iacute;t&aacute;sra sz&aacute;nt slice vagy lemez
	  0.  eltol&aacute;s&aacute;n&aacute;l kezd&#245;dik, a Vinum
	  be&aacute;ll&iacute;t&aacute;sai fel&uuml;l fogj&aacute;k
	  &iacute;rni a rendszert&ouml;lt&#245;t.</para>

	<para>A rendszert&ouml;lt&#245; is ugyan&iacute;gy
	  fel&uuml;l&iacute;rja a Vinum fejl&eacute;c&eacute;t &eacute;s
	  akkor a Vinum nem tal&aacute;lja a lemezeit, ha a fenti
	  probl&eacute;m&aacute;t orvosolva, p&eacute;ld&aacute;ul egy
	  <quote>Fixit</quote> (Helyre&aacute;ll&iacute;t&oacute;) lemez
	  seg&iacute;ts&eacute;g&eacute;vel,
	  &uacute;jratelep&iacute;tj&uuml;k a rendszert&ouml;lt&#245;t a
	  <xref linkend="boot-boot1">ban bemutatott <command>bsdlabel
	  -B</command> parancs seg&iacute;ts&eacute;g&eacute;vel.  Noha
	  a Vinum egyetlen konkr&eacute;t konfigur&aacute;ci&oacute;s
	  be&aacute;ll&iacute;t&aacute;sa vagy a k&ouml;tetekben
	  t&aacute;rolt adat sem s&eacute;r&uuml;l meg &eacute;s vissza
	  tudjuk &aacute;ll&iacute;tani az &ouml;sszes elveszett
	  inform&aacute;ci&oacute;t ugyannak a
	  Vinum-konfigur&aacute;ci&oacute;nak az &uacute;jb&oacute;li
	  megad&aacute;s&aacute;val, a helyzetet mag&aacute;t
	  neh&eacute;z megoldani.  A Vinum-fejl&eacute;c &eacute;s a
	  rendszert&ouml;lt&#245; &uuml;tk&ouml;z&eacute;s&eacute;nek
	  megsz&uuml;ntet&eacute;s&eacute;hez ugyanis legal&aacute;bb
	  4&nbsp;KB-tal arr&eacute;bb kell mozgatnunk az eg&eacute;sz
	  Vinum-part&iacute;ci&oacute;t.</para>

      </sect3>
    </sect2>
  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->

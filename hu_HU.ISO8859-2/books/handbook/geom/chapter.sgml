<!--
     The FreeBSD Documentation Project
     $FreeBSD$
-->

<!-- The FreeBSD Hungarian Documentation Project
     Translated by: PALI, Gabor <pgj@FreeBSD.org>
     %SOURCE%	en_US.ISO8859-1/books/handbook/geom/chapter.sgml
     %SRCID%	1.50
-->

<chapter id="GEOM" lang="hu">
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Tom</firstname>
	<surname>Rhodes</surname>
	<contrib>&Iacute;rta: </contrib>
      </author>
    </authorgroup>
  </chapterinfo>

  <title>GEOM: A modul&aacute;ris lemezszervez&#245; rendszer</title>

  <sect1 id="GEOM-synopsis">
    <title>&Aacute;ttekint&eacute;s</title>

    <indexterm><primary>GEOM</primary></indexterm>
    <indexterm>
      <primary>A GEOM lemezrendszer</primary>
      <see>GEOM</see>
    </indexterm>

    <para>Ez a fejezet a &os;-ben tal&aacute;lhat&oacute; GEOM rendszert
      mutatja be.  Ez a rendszer t&ouml;m&ouml;r&iacute;ti az
      &aacute;ltala is alkalmazott fontosabb <acronym role="Redundant
      Array of Inexpensive Disks (Olcs&oacute; lemezek
      hibat&#251;r&#245;
      t&ouml;mbje)">RAID</acronym>-vez&eacute;rl&#245;
      seg&eacute;dprogramokat.  A fejezet nem r&eacute;szletezi, hogy a
      GEOM konkr&eacute;tan milyen m&oacute;don kezeli &eacute;s
      vez&eacute;rli az I/O-t, ahogy azt sem, hogyan m&#251;k&ouml;dik
      az alapj&aacute;ul szolg&aacute;l&oacute; alrendszer vagy hogy
      n&eacute;z ki annak forr&aacute;sk&oacute;dja.  Az ilyen
      jelleg&#251; inform&aacute;ci&oacute;k a &man.geom.4; man oldalon,
      valamint az ott felsorolt helyeken tal&aacute;lhat&oacute;ak meg.
      Tov&aacute;bb&aacute;, ez a fejezet magukr&oacute;l a
      <acronym>RAID</acronym>-konfigur&aacute;ci&oacute;kr&oacute;l sem
      ad pontos t&aacute;j&eacute;koztat&aacute;st.
      Kiz&aacute;r&oacute;lag csak a GEOM &aacute;ltal is
      t&aacute;mogatott
      <acronym>RAID</acronym>-besorol&aacute;sokr&oacute;l esik
      sz&oacute;.</para>

    <para>A fejezet elolvas&aacute;sa sor&aacute;n
      megismerj&uuml;k:</para>

    <itemizedlist>
      <listitem>
	<para>a GEOM seg&iacute;ts&eacute;g&eacute;vel milyen
	  fajt&aacute;j&uacute; <acronym>RAID</acronym>
	  t&aacute;mogat&aacute;st &eacute;rhet&uuml;nk el;</para>
      </listitem>

      <listitem>
	<para>hogyan kell haszn&aacute;lni a rendszer &aacute;ltal
	  ny&uacute;jtott alapvet&#245; seg&eacute;deszk&ouml;z&ouml;ket
	  a k&uuml;l&ouml;nf&eacute;le <acronym>RAID</acronym>-szintek
	  konfigur&aacute;l&aacute;s&aacute;hoz,
	  karbantart&aacute;s&aacute;hoz &eacute;s
	  kezel&eacute;s&eacute;hez;</para>
      </listitem>

      <listitem>
	<para>hogyan kell a GEOM-on kereszt&uuml;l t&uuml;kr&ouml;zni,
	  cs&iacute;kozni, titkos&iacute;tani &eacute;s
	  t&aacute;volr&oacute;l &ouml;sszekapcsolni lemezes
	  eszk&ouml;z&ouml;ket;</para>
      </listitem>

      <listitem>
	<para>hogyan kell a GEOM rendszerben &ouml;sszekapcsolt
	  lemezekn&eacute;l felmer&uuml;l&#245; hib&aacute;kat
	  felder&iacute;teni.</para>
      </listitem>
    </itemizedlist>

	<para>A fejezet elolvas&aacute;s&aacute;hoz
	  aj&aacute;nlott:</para>

    <itemizedlist>
      <listitem>
	<para>meg&eacute;rteni, hogyan kezeli a &os; a lemezes
	  eszk&ouml;z&ouml;ket (<xref linkend="disks">);</para>
      </listitem>

      <listitem>
	<para>ismerni, hogyan konfigur&aacute;ljunk &eacute;s
	  telep&iacute;ts&uuml;nk egy &uacute;j &os; rendszermagot (<xref
	  linkend="kernelconfig">).</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 id="GEOM-intro">
    <title>A GEOM bemutat&aacute;sa</title>

    <para>A GEOM rendszer adatszolg&aacute;ltat&oacute;kon vagy
      speci&aacute;lis <filename
	class="directory">/dev</filename>-&aacute;llom&aacute;nyokon
      kereszt&uuml;l hozz&aacute;f&eacute;r&eacute;st &eacute;s
      vez&eacute;rl&eacute;st tesz lehet&#245;v&eacute; bizonyos
      oszt&aacute;lyokhoz &mdash; Master Boot Recordokhoz,
      <acronym>BSD</acronym>-c&iacute;mk&eacute;khez stb.  Sz&aacute;mos
      szoftveres <acronym>RAID</acronym> konfigur&aacute;ci&oacute;
      t&aacute;mogat&aacute;s&aacute;val a GEOM transzparens
      el&eacute;r&eacute;st tesz lehet&#245;v&eacute; mind az
      oper&aacute;ci&oacute;s rendszer, mind pedig az &aacute;ltala
      felk&iacute;n&aacute;lt seg&eacute;dprogramok
      sz&aacute;m&aacute;ra.</para>

  </sect1>

  <sect1 id="GEOM-striping">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Tom</firstname>
	  <surname>Rhodes</surname>
	  <contrib>&Iacute;rta: </contrib>
	</author>
	<author>
	  <firstname>Murray</firstname>
	  <surname>Stokely</surname>
	</author>
      </authorgroup>
    </sect1info>

    <title>RAID0 - Cs&iacute;koz&aacute;s</title>

    <indexterm><primary>GEOM</primary></indexterm>
    <indexterm><primary>Lemezcs&iacute;koz&aacute;s</primary></indexterm>

    <para>A cs&iacute;koz&aacute;s m&oacute;dszer&eacute;t
      haszn&aacute;ljuk abban az esetben, amikor t&ouml;bb
      lemezmeghajt&oacute;t akarunk egyetlen k&ouml;tett&eacute;
      &ouml;sszevonni.  A GEOM lemezalrendszer szoftveres
      t&aacute;mogat&aacute;st ny&uacute;jt a <acronym>RAID</acronym>0,
      m&aacute;s n&eacute;ven a lemezcs&iacute;koz&aacute;s
      megval&oacute;s&iacute;t&aacute;s&aacute;hoz.</para>

    <para>Egy <acronym>RAID</acronym>0 rendszerben az adatokat blokkokra
      bontva &iacute;rjuk fel a t&ouml;mbben tal&aacute;lhat&oacute;
      lemezek k&ouml;z&ouml;tt sz&eacute;tosztva.  &Iacute;gy ahelyett,
      hogy meg kellene v&aacute;rnunk 256 kb-nyi adat egyetlen lemezre
      &iacute;r&aacute;s&aacute;t, egy <acronym>RAID</acronym>0
      rendszerben egyszerre &iacute;r&oacute;dik 64 kb-nyi adat
      n&eacute;gy k&uuml;l&ouml;nb&ouml;z&#245; lemezre, &eacute;s
      ez&aacute;ltal gyorsabb el&eacute;r&eacute;st szolg&aacute;ltat.
      Ez a gyorsas&aacute;g tov&aacute;bbi lemezvez&eacute;rl&#245;k
      haszn&aacute;lat&aacute;val m&eacute;g jobban
      fokozhat&oacute;.</para>

    <para>Az egy <acronym>RAID</acronym>0-cs&iacute;koz&aacute;sban
      r&eacute;sztvev&#245; lemezek mindegyik&eacute;nek azonos
      m&eacute;ret&#251;nek kell lennie, mivel az &iacute;r&aacute;sra
      &eacute;s olvas&aacute;sra ir&aacute;nyul&oacute;
      I/O-k&eacute;r&eacute;sek a p&aacute;rhuzamos
      kiszolg&aacute;l&aacute;s &eacute;rdek&eacute;ben
      &ouml;sszef&eacute;s&uuml;l&#245;dnek.</para>

    <mediaobject>
      <imageobject>
	<imagedata fileref="geom/striping" align="center">
      </imageobject>

      <textobject>
	<phrase>P&eacute;lda lemezcs&iacute;koz&aacute;sra</phrase>
      </textobject>
    </mediaobject>

    <procedure>
      <title>Cs&iacute;koz&aacute;s kialak&iacute;t&aacute;sa
	form&aacute;zatlan ATA-lemezekkel</title>

      <step>
	<para>T&ouml;lts&uuml;k be a <filename>geom_stripe.ko</filename>
	  modult:</para>

	<screen>&prompt.root; <userinput>kldload geom_stripe</userinput></screen>		  
      </step>

      <step>
	<para>Bizonyosodjuk meg r&oacute;la, hogy a rendszer&uuml;nkben
	  tal&aacute;lhat&oacute; egy szabad csatlakoz&aacute;si pont.
	  Ha majd ezt a k&ouml;tetet sz&aacute;njuk rendszer&uuml;nk
	  gy&ouml;k&eacute;rpart&iacute;ci&oacute;j&aacute;nak,
	  haszn&aacute;ljunk erre a c&eacute;lra egy m&aacute;sik
	  k&ouml;nyvt&aacute;rat, p&eacute;ld&aacute;ul a <filename
	    class="directory">/mnt</filename>-ot:</para>

	<screen>&prompt.root; <userinput>mkdir /mnt</userinput></screen>
      </step>

      <step>
	<para>Keress&uuml;k meg a cs&iacute;koz&aacute;sra
	  felhaszn&aacute;lni k&iacute;v&aacute;nt lemezek
	  eszk&ouml;zneveit, &eacute;s hozzunk l&eacute;tre
	  bel&#245;l&uuml;k egy &uacute;j cs&iacute;kozott eszk&ouml;zt.
	  P&eacute;ld&aacute;ul, ha k&eacute;t haszn&aacute;latban nem
	  lev&#245;, particion&aacute;latlan
	  <acronym>ATA</acronym>-lemezt, n&eacute;v szerint a
	  <filename>/dev/ad2</filename> &eacute;s
	  <filename>/dev/ad3</filename> eszk&ouml;z&ouml;ket akarjunk
	  cs&iacute;kozni:</para>

	<screen>&prompt.root; <userinput>gstripe label -v st0 /dev/ad2 /dev/ad3</userinput>
Metadata value stored on /dev/ad2.
Metadata value stored on /dev/ad3.
Done.</screen>
      </step>

      <step>
	<para>Az &iacute;gy l&eacute;trej&ouml;tt &uacute;j k&ouml;teten
	  most hozzunk l&eacute;tre egy &aacute;ltal&aacute;nos
	  c&iacute;mk&eacute;t, vagy m&aacute;s n&eacute;ven egy
	  part&iacute;ci&oacute;s t&aacute;bl&aacute;t, &eacute;s
	  telep&iacute;ts&uuml;k fel r&aacute; a rendszer
	  alap&eacute;rtelmezett rendszerind&iacute;t&oacute;
	  programj&aacute;t:</para>

	<screen>&prompt.root; <userinput>bsdlabel -wB /dev/stripe/st0</userinput></screen>
      </step>

      <step>
	<para>Ezzel meg kellett jelennie tov&aacute;bbi m&aacute;sik
	  k&eacute;t eszk&ouml;znek is a <filename
	    class="directory">/dev/stripe</filename>
	  k&ouml;nyvt&aacute;rban, a <devicename>st0</devicename>
	  eszk&ouml;z mellett.  Ezek t&ouml;bbek k&ouml;zt az
	  <devicename>st0a</devicename> &eacute;s az
	  <devicename>st0c</devicename>.  Itt m&aacute;r ki is tudunk
	  alak&iacute;tani egy &aacute;llom&aacute;nyrendszert az
	  <devicename>st0a</devicename> eszk&ouml;z&ouml;n a
	  <command>newfs</command> haszn&aacute;lat&aacute;val:</para>

	<screen>&prompt.root; <userinput>newfs -U /dev/stripe/st0a</userinput></screen>

	<para>Sok-sok sz&aacute;mot fogunk l&aacute;tni cik&aacute;zni a
	  k&eacute;perny&#245;n, majd n&eacute;h&aacute;ny
	  m&aacute;sodperc m&uacute;lva befejez&#245;dik a folyamat.
	  L&eacute;trehoztuk a k&ouml;tetet, ami most m&aacute;r
	  k&eacute;szen &aacute;ll a becsatol&aacute;sra.</para>
      </step>
    </procedure>

    <para>A kialak&iacute;tott lemezcs&iacute;koz&aacute;st &iacute;gy
      tudjuk k&eacute;zzel csatlakoztatni:</para>

    <screen>&prompt.root; <userinput>mount /dev/stripe/st0a /mnt</userinput></screen>

    <para>A cs&iacute;kozott &aacute;llom&aacute;nyrendszert a
      rendszerind&iacute;t&aacute;s folyam&aacute;n automatikusan
      becsatlakoztathatjuk, ha elhelyezz&uuml;k az al&aacute;bbi
      k&ouml;tetinform&aacute;ci&oacute;kat az
      <filename>/etc/fstab</filename> &aacute;llom&aacute;nyba.  Erre a
      c&eacute;lra <filename class="directory">stripe</filename>
      n&eacute;ven l&eacute;trehozunk egy &aacute;lland&oacute;
      csatlakoz&aacute;si pontot:</para>

    <screen>&prompt.root; <userinput>mkdir /stripe</userinput>
&prompt.root; <userinput>echo "/dev/stripe/st0a /stripe ufs rw 2 2" \</userinput>
      <userinput>&gt;&gt; /etc/fstab</userinput></screen>

    <para>A <filename>geom_stripe.ko</filename> modult is automatikusan
      be kell t&ouml;lteni a rendszerind&iacute;t&aacute;s sor&aacute;n.
      Ehhez a k&ouml;vetkez&#245; sort kell hozz&aacute;adni a
      <filename>/boot/loader.conf</filename>
      &aacute;llom&aacute;nyhoz:</para>

    <screen>&prompt.root; <userinput>echo 'geom_stripe_load="YES"' &gt;&gt; /boot/loader.conf</userinput></screen>

  </sect1>

  <sect1 id="GEOM-mirror">
    <title>RAID1 - T&uuml;kr&ouml;z&eacute;s</title>

    <indexterm><primary>GEOM</primary></indexterm>
    <indexterm><primary>lemezt&uuml;kr&ouml;z&eacute;s</primary></indexterm>

    <para>A t&uuml;kr&ouml;z&eacute;s sz&aacute;mos
      v&aacute;llalatn&aacute;l &eacute;s h&aacute;ztart&aacute;sban
      alkalmazott technol&oacute;gia, amely az adatok
      megszak&iacute;t&aacute;s n&eacute;lk&uuml;li
      lement&eacute;s&eacute;re haszn&aacute;latos.  Amikor
      t&uuml;kr&ouml;z&eacute;st haszn&aacute;lunk, az egyszer&#251;en
      csak arra utal, hogy a B lemez ugyanazokat az adatokat
      tartalmazza, mint az A lemez.  Vagy amikor a C &eacute;s D lemez
      tartalma egyezik meg az A &eacute;s B lemezek&eacute;vel.
      F&uuml;ggetlen&uuml;l a lemezek kioszt&aacute;s&aacute;t&oacute;l,
      itt az a l&eacute;nyeg, hogy az egyik lemez teljes ter&uuml;lete
      vagy az egyik part&iacute;ci&oacute;ja le van m&aacute;solva.
      K&eacute;s&#245;bb az ezen a m&oacute;don lementett adatok
      k&ouml;nnyen vissza&aacute;ll&iacute;that&oacute;ak
      an&eacute;lk&uuml;l, hogy ez a szolg&aacute;ltat&aacute;sban vagy
      az el&eacute;rhet&#245;s&eacute;gben b&aacute;rmilyen
      kimarad&aacute;st okozna, &eacute;s ak&aacute;r m&eacute;g
      fizikailag is biztons&aacute;gosan t&aacute;rolhat&oacute;ak.

    <para>El&#245;sz&ouml;r is szerezn&uuml;nk kell k&eacute;t egyforma
      m&eacute;ret&#251; lemezt, valamint a p&eacute;ld&aacute;k
      felt&eacute;telezik, hogy ezek a lemezek k&ouml;zvetlen
      el&eacute;r&eacute;s&#251; (&man.da.4;)
      <acronym>SCSI</acronym>-lemezek.</para>

    <sect2>
      <title>Az els&#245;dleges lemezek
	t&uuml;kr&ouml;z&eacute;se</title>

      <para>Tegy&uuml;k fel, hogy a &os; az els&#245;,
	<devicename>da0</devicename> nev&#251; lemezmeghajt&oacute;n
	tal&aacute;lhat&oacute;, &eacute;s a &man.gmirror.8;
	sz&aacute;m&aacute;ra ezt szeretn&eacute;nk megadni az
	els&#245;dleges adatok t&aacute;rol&aacute;s&aacute;hoz.</para>

      <para>A t&uuml;kr&ouml;z&eacute;s
	l&eacute;trehoz&aacute;s&aacute;nak megkezd&eacute;se el&#245;tt a
	<varname>kern.geom.debugflags</varname> &man.sysctl.8;
	v&aacute;ltoz&oacute; megfelel&#245;
	be&aacute;ll&iacute;t&aacute;s&aacute;val
	enged&eacute;lyezz&uuml;nk tov&aacute;bbi
	nyomk&ouml;vet&eacute;si inform&aacute;ci&oacute;kat &eacute;s
	hozz&aacute;f&eacute;r&eacute;st az eszk&ouml;zh&ouml;z:</para>

      <screen>&prompt.root; <userinput>sysctl kern.geom.debugflags=17</userinput></screen>

      <para>Most &eacute;p&iacute;ts&uuml;k fel a
	t&uuml;kr&ouml;z&eacute;st.  Kezdj&uuml;k az eg&eacute;szet a
	metaadatok elhelyez&eacute;s&eacute;vel az els&#245;dleges
	lemezmeghajt&oacute;n, teh&aacute;t tulajdonk&eacute;ppen az
	al&aacute;bbi parancs seg&iacute;ts&eacute;g&eacute;vel hozzuk
	l&eacute;tre a <filename
	  class="devicefile">/dev/mirror/gm</filename>
	eszk&ouml;zt:</para>

      <warning>
	<para>A rendszerind&iacute;t&oacute; meghajt&oacute;r&oacute;l
	  k&eacute;sz&iacute;tett t&uuml;kr&ouml;z&eacute;s
	  adatveszt&eacute;st okozhat a lemez utols&oacute;
	  szektor&aacute;ban.  Ennek kock&aacute;zata
	  cs&ouml;kkenthet&#245;, ha k&ouml;zvetlen&uuml;l a &os; friss
	  telep&iacute;t&eacute;se ut&aacute;n &aacute;ll&iacute;tjuk be
	  a t&uuml;kr&ouml;z&eacute;st.</para>
      </warning>

      <screen>&prompt.root; <userinput>gmirror label -vb round-robin gm0 /dev/da0</userinput></screen>

      <para>Erre a rendszernek a k&ouml;vetkez&#245; m&oacute;don kell
	reag&aacute;lnia:</para>

      <screen>Metadata value stored on /dev/da0.
Done.</screen>

      <para>A GEOM inicializ&aacute;l&aacute;s&aacute;hoz
	sz&uuml;ks&eacute;g&uuml;nk lesz a
	<filename>/boot/kernel/geom_mirror.ko</filename> modul
	bet&ouml;lt&eacute;s&eacute;re:</para>

      <screen>&prompt.root; <userinput>gmirror load</userinput></screen>

      <note>
	<para>A parancs sikeres lefut&aacute;sa ut&aacute;n a <filename
	    class="directory">/dev/mirror</filename>
	  k&ouml;nyvt&aacute;rban l&eacute;trehoz egy
	  <devicename>gm0</devicename>
	  eszk&ouml;zle&iacute;r&oacute;t.</para>
      </note>

      <para>A <filename>geom_mirror.ko</filename> modul
	bet&ouml;lt&eacute;s&eacute;t &iacute;gy tudjuk
	enged&eacute;lyezni a rendszer ind&iacute;t&aacute;sakor:</para>

      <screen>&prompt.root; <userinput>echo 'geom_mirror_load="YES"' &gt;&gt; /boot/loader.conf</userinput></screen>

      <para>Nyissuk meg az <filename>/etc/fstab</filename>
	&aacute;llom&aacute;nyt, &eacute;s cser&eacute;lj&uuml;k le
	benne az &ouml;sszes kor&aacute;bbi <devicename>da0</devicename>
	hivatkoz&aacute;st az &uacute;jonnan kialak&iacute;tott
	<devicename>gm0</devicename> t&uuml;kr&ouml;z&eacute;s
	eszk&ouml;zle&iacute;r&oacute;j&aacute;val.</para>

      <note>
	<para>Ha &man.vi.1; sz&ouml;vegszerkeszt&#245;t
	  haszn&aacute;ljuk, akkor a k&ouml;vetkez&#245; m&oacute;don
	  tudjuk ezt egyszer&#251;en megtenni:</para>

	<screen>&prompt.root; <userinput>vi /etc/fstab</userinput></screen>

	<para>A &man.vi.1; ind&iacute;t&aacute;sa ut&aacute;n a
	  <userinput>:w /etc/fstab.bak</userinput>
	  kiad&aacute;s&aacute;val k&eacute;sz&iacute;ts&uuml;nk az
	  <filename>fstab</filename> &aacute;llom&aacute;ny jelenlegi
	  tartalm&aacute;r&oacute;l m&aacute;solatot.  Ezut&aacute;n a
	  <userinput>:%s/da/mirror\/gm/g</userinput> parancs
	  haszn&aacute;lat&aacute;val cser&eacute;lj&uuml;k ki az
	  &ouml;sszes <devicename>da0</devicename> hivatkoz&aacute;st a
	  <devicename>gm0</devicename> eszk&ouml;z nev&eacute;re.</para>
      </note>

      <para>Az &iacute;gy keletkez&#245; <filename>fstab</filename>
	&aacute;llom&aacute;ny nagyj&aacute;b&oacute;l k&ouml;vetkez&#245;
	m&oacute;don fog kin&eacute;zni.  Most teljesen f&uuml;ggetlen,
	hogy <acronym>SCSI</acronym> vagy <acronym>ATA</acronym>
	meghajt&oacute;kkal dolgozunk, a <acronym>RAID</acronym>
	eszk&ouml;z neve mindig <devicename>gm</devicename> lesz:</para>

      <programlisting># Eszk&ouml;z                Csatlakoz&aacute;si pont   T&iacute;pus   Be&aacute;ll&iacute;t&aacute;sok  Dump   Menet
/dev/mirror/gm0s1b      none                swap    sw           0      0
/dev/mirror/gm0s1a      /                   ufs     rw           1      1
/dev/mirror/gm0s1d      /usr                ufs     rw           0      0
/dev/mirror/gm0s1f      /home               ufs     rw           2      2
#/dev/mirror/gm0s2d     /store              ufs     rw           2      2
/dev/mirror/gm0s1e      /var                ufs     rw           2      2
/dev/acd0               /cdrom              cd9660  ro,noauto    0      0</programlisting>

      <para>Ind&iacute;tsuk &uacute;jra a rendszert:</para>

      <screen>&prompt.root; <userinput>shutdown -r now</userinput></screen>

      <para>Ennek megfelel&#245;en a rendszer ind&iacute;t&aacute;sa
	k&ouml;zben a <devicename>da0</devicename> eszk&ouml;z helyett a
	<devicename>gm0</devicename> eszk&ouml;zt fogjuk
	haszn&aacute;lni.  Miut&aacute;n sikeresen
	befejez&#245;d&ouml;tt a rendszerind&iacute;t&aacute;s, a
	<command>mount</command> parancs kiad&aacute;s&aacute;val a
	saj&aacute;t szem&uuml;nkkel is meggy&#245;z&#245;dhet&uuml;nk
	az eredm&eacute;nyr&#245;l:</para>

      <screen>&prompt.root; <userinput>mount</userinput>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/mirror/gm0s1a   1012974  224604   707334    24%    /
devfs                      1       1        0   100%    /dev
/dev/mirror/gm0s1f  45970182   28596 42263972     0%    /home
/dev/mirror/gm0s1d   6090094 1348356  4254532    24%    /usr
/dev/mirror/gm0s1e   3045006 2241420   559986    80%    /var
devfs                      1       1        0   100%    /var/named/dev</screen>

      <para>A parancs kimenete az elv&aacute;r&aacute;sainknak
	megfelel&#245;en remek&uuml;l n&eacute;z ki.
	Z&aacute;r&aacute;sk&eacute;ppen a szinkroniz&aacute;l&aacute;s
	megkezd&eacute;s&eacute;hez a k&ouml;vetkez&#245; paranccsal
	illessz&uuml;k be a <devicename>da1</devicename> eszk&ouml;zt a
	t&uuml;kr&ouml;z&eacute;sbe:</para>

      <screen>&prompt.root; <userinput>gmirror insert gm0 /dev/da1</userinput></screen>

      <para>A t&uuml;kr&ouml;z&eacute;s &aacute;llapota a
	l&eacute;trej&ouml;tt&eacute;t k&ouml;vet&#245;en az al&aacute;bbi
	paranccsal ellen&#245;rizhet&#245;:</para>

      <screen>&prompt.root; <userinput>gmirror status</userinput></screen>

      <para>Az im&eacute;nti parancs eredm&eacute;ny&eacute;nek
	nagyj&aacute;b&oacute;l a k&ouml;vetkez&#245;nek kell lennie
	miut&aacute;n a fel&eacute;p&iacute;tett&uuml;k a
	t&uuml;kr&ouml;z&eacute;st &eacute;s szinkroniz&aacute;ltuk az
	adatokat:</para>

      <screen>      Name    Status  Components
mirror/gm0  COMPLETE  da0
                      da1</screen>

      <para>Hiba eset&eacute;n a t&uuml;kr&ouml;z&eacute;s
	tov&aacute;bbra is folytat&oacute;dik, azonban ilyenkor a
	p&eacute;ld&aacute;ban szerepl&#245; <literal>COMPLETE</literal>
	helyett a <literal>DEGRADED</literal> jelz&eacute;st fogjuk
	l&aacute;tni.</para>
    </sect2>

    <sect2>
      <title>Hibakeres&eacute;s</title>

      <sect3>
	<title>A rendszer nem hajland&oacute; elindulni</title>

	<para>Ha a rendszer&uuml;nk ehhez hasonl&oacute; m&oacute;don
	  indul:</para>

	<programlisting>ffs_mountroot: can't find rootvp
Root mount failed: 6
mountroot></programlisting>

	<para>Ind&iacute;tsuk &uacute;jra a g&eacute;p&uuml;nket a
	  kikapcsol&oacute; gomb vagy a reset
	  seg&iacute;ts&eacute;g&eacute;vel.  A
	  rendszerind&iacute;t&oacute; men&uuml;ben v&aacute;lasszuk a
	  hatodik opci&oacute;t (6).  Ennek
	  eredm&eacute;nyek&eacute;ppen megkapjuk a &man.loader.8;
	  parancssor&aacute;t.  T&ouml;lts&uuml;k be a modult
	  manu&aacute;lisan:</para>

	<screen>OK? <userinput>load geom_mirror</userinput>
OK? <userinput>boot</userinput></screen>

	<para>Ha ez bev&aacute;lik, akkor valami&eacute;rt a modult nem
	  siker&uuml;lt rendesen bet&ouml;lteni.
	  Ellen&#245;rizz&uuml;k, hogy a
	  <filename>/boot/loader.conf</filename>
	  &aacute;llom&aacute;nyban a neki szerepl&#245; megfelel&#245;
	  bejegyz&eacute;s helyesen szerepel.  Amennyiben a
	  probl&eacute;ma tov&aacute;bbra is fenn&aacute;ll,
	  helyezz&uuml;k el a k&ouml;vetkez&#245; sort a rendszermag
	  konfigur&aacute;ci&oacute;s &aacute;llom&aacute;ny&aacute;ba,
	  majd ford&iacute;tsuk &uacute;jra &eacute;s
	  telep&iacute;ts&uuml;k:</para>

	<programlisting>options	GEOM_MIRROR</programlisting>

	<para>Ezzel v&aacute;rhat&oacute;an orvosoltuk a
	  probl&eacute;m&aacute;t.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>A meghib&aacute;sodott lemezek cser&eacute;je</title>

      <para>A lemezek t&uuml;kr&ouml;z&eacute;s&eacute;nek egyik
	legcsod&aacute;latosabb el&#245;nye, hogy a menet k&ouml;zben
	meghib&aacute;sodott meghajt&oacute;kat gond, &eacute;s
	&iacute;gy feltehet&#245;en adatveszt&eacute;s
	n&eacute;lk&uuml;l ki tudjuk cser&eacute;lni.</para>

      <para>Vegy&uuml;k az im&eacute;nti <acronym>RAID</acronym>-1
	konfigur&aacute;ci&oacute;t, &eacute;s t&eacute;telezz&uuml;k fel,
	hogy a <devicename>da1</devicename> eszk&ouml;z felmondta a
	szolg&aacute;ltatot &eacute;s cser&eacute;re szorul.  A
	meghajt&oacute; lev&aacute;lt&aacute;s&aacute;hoz keress&uuml;k
	meg a hib&aacute;s eszk&ouml;zt, majd &aacute;ll&iacute;tsuk le
	a rendszert.  Tegy&uuml;k be a hely&eacute;re az &uacute;jat
	&eacute;s ind&iacute;tsuk &uacute;jra a rendszer&uuml;nket.
	Miut&aacute;n elindult az oper&aacute;ci&oacute;s rendszer, a
	k&ouml;vetkez&#245; parancsok kiad&aacute;s&aacute;val tudjuk
	logikailag is lecser&eacute;lni a meghib&aacute;sodott
	lemezt:</para>

      <screen>&prompt.root; <userinput>gmirror forget gm0</userinput>
&prompt.root; <userinput>gmirror insert gm0 /dev/da1</userinput></screen>

      <para>Innen a <command>gmirror</command> <option>status</option>
	parancs&aacute;val k&iacute;s&eacute;rhetj&uuml;k figyelemmel a
	t&uuml;kr&ouml;z&eacute;s &uacute;jraszervez&eacute;s&eacute;nek
	menet&eacute;t.  Csup&aacute;n ennyi az eg&eacute;sz.</para>
    </sect2>
  </sect1>

  <sect1 id="geom-ggate">
    <title>Eszk&ouml;z&ouml;k h&aacute;l&oacute;zati illeszt&eacute;se a
      GEOM-ban</title>

    <para>A GEOM t&aacute;voli eszk&ouml;z&ouml;k, p&eacute;ld&aacute;ul
      lemezek, CD-meghajt&oacute;k stb.  haszn&aacute;lat&aacute;t is
      t&aacute;mogatja a h&aacute;l&oacute;zati illeszt&eacute;st
      szolg&aacute;l&oacute; seg&eacute;dprogramjaival, hasonl&oacute;an
      az <acronym>NFS</acronym>-hez.</para>

    <para>Kezd&eacute;sk&eacute;nt l&eacute;tre kell hozni a
      megoszt&aacute;st el&#245;seg&iacute;t&#245;
      &aacute;llom&aacute;nyt.  Ez az &aacute;llom&aacute;ny
      hat&aacute;rozza meg, ki &eacute;s milyen szinten jogosult
      haszn&aacute;lni a megosztott er&#245;forr&aacute;sokat.
      P&eacute;ld&aacute;ul ha megosztjuk az els&#245;
      <acronym>SCSI</acronym>-lemezen a negyedik slice-ot, az
      al&aacute;bbi <filename>/etc/gg.exports</filename>
      &aacute;llom&aacute;ny t&ouml;k&eacute;letesen megfelel:</para>

    <programlisting>192.168.1.0/24 RW /dev/da0s4d</programlisting>

    <para>Ezzel a bels&#245; h&aacute;l&oacute;zaton lev&#245;
      &ouml;sszes sz&aacute;m&iacute;t&oacute;g&eacute;p k&eacute;pes
      lesz el&eacute;rni a <devicename>da0s4d</devicename>
      part&iacute;ci&oacute;n tal&aacute;lhat&oacute;
      &aacute;llom&aacute;nyrendszert.</para>

    <para>Az eszk&ouml;z megoszt&aacute;s&aacute;hoz el&#245;sz&ouml;r
      gondoskodnunk kell r&oacute;la, hogy ne legyen csatlakoztatva,
      majd ezut&aacute;n ind&iacute;tsuk el a &man.ggated.8; szerver
      d&eacute;monj&aacute;t:</para>

    <screen>&prompt.root; <userinput>ggated</userinput></screen>

    <para>Ezt k&ouml;vet&#245;en a <command>mount</command>
      felhaszn&aacute;l&aacute;s&aacute;val csatoljuk az eszk&ouml;zt a
      kliensen, az al&aacute;bbi parancs
      kiad&aacute;s&aacute;val:</para>

    <screen>&prompt.root; <userinput>ggatec create -o rw 192.168.1.1 /dev/da0s4d</userinput>
ggate0
&prompt.root; <userinput>mount /dev/ggate0 /mnt</userinput></screen>

    <para>Innent&#245;l kezdve az eszk&ouml;z el&eacute;rhet&#245; lesz
      a <filename class="directory">/mnt</filename> csatlakoz&aacute;si
      ponton kereszt&uuml;l.</para>

    <note>
      <para>Fontos kiemeln&uuml;nk, hogy ez a m&#251;velet
	eredm&eacute;nytelen, ha az adott eszk&ouml;zt vagy maga a
	szerver, vagy pedig valamelyik m&aacute;sik kliens m&aacute;r
	kor&aacute;bban csatolta.</para>
    </note>

    <para>Amikor az eszk&ouml;zre m&aacute;r nincs tov&aacute;bb
      sz&uuml;ks&eacute;g&uuml;nk, biztons&aacute;gosan le tudjuk
      v&aacute;lasztani az &man.umount.8; paranccsal, hasonl&oacute;an
      b&aacute;rmelyik m&aacute;s lemezes eszk&ouml;zh&ouml;z.</para>

  </sect1>

  <sect1 id="geom-glabel">
    <title>A lemezes eszk&ouml;z&ouml;k
      c&iacute;mk&eacute;z&eacute;se</title>

    <indexterm><primary>GEOM</primary></indexterm>
    <indexterm><primary>Lemezc&iacute;mk&eacute;k</primary></indexterm>

    <para>A rendszer ind&iacute;t&aacute;sa k&ouml;zben a &os;
      rendszermagja a tal&aacute;lt eszk&ouml;z&ouml;knek
      megfelel&#245;en mindegyiknek l&eacute;trehoz egy-egy
      eszk&ouml;zle&iacute;r&oacute;t.  Ezzel a
      pr&oacute;b&aacute;lgat&aacute;sos m&oacute;dszerrel egy&uuml;tt
      j&aacute;r n&eacute;h&aacute;ny gond, p&eacute;ld&aacute;ul mi
      t&ouml;rt&eacute;nik akkor, ha az &uacute;j lemezes eszk&ouml;zt
      <acronym>USB</acronym>-n kereszt&uuml;l adjuk a rendszerhez?
      Nagyon val&oacute;sz&iacute;n&#251;, hogy ez az eszk&ouml;z
      megkapja a <devicename>da0</devicename> nevet &eacute;s ezzel az
      eredeti <devicename>da0</devicename> eszk&ouml;z eltol&oacute;dik
      a <devicename>da1</devicename> n&eacute;vhez.  Ennek
      k&ouml;sz&ouml;nhet&#245;en az <filename>/etc/fstab</filename>
      &aacute;llom&aacute;nyban felsorolt
      &aacute;llom&aacute;nyrendszerek csatol&aacute;sa vesz&eacute;lybe
      ker&uuml;l, aminek k&ouml;vetkezt&eacute;ben ak&aacute;r
      meghi&uacute;sulhat a rendszerindul&aacute;s is.</para>

    <para>Az egyik lehets&eacute;ges megold&aacute;sa a
      probl&eacute;m&aacute;nak, ha sorbaf&#251;zz&uuml;k a
      <acronym>SCSI</acronym> eszk&ouml;zeinket, &eacute;s &iacute;gy a
      <acronym>SCSI</acronym>-k&aacute;rty&aacute;hoz kapcsolt
      &uacute;jabb eszk&ouml;z egy addig nem haszn&aacute;lt
      sz&aacute;mot fog birtokba venni.  Mi helyzet azonban az
      <acronym>USB</acronym>-s eszk&ouml;z&ouml;kkel, amelyek
      ki&uuml;thetik az els&#245;dleges
      <acronym>SCSI</acronym>-lemezeinket?  Ez egy&eacute;bk&eacute;nt
      az&eacute;rt t&ouml;rt&eacute;nhet meg, mert az
      <acronym>USB</acronym>-s eszk&ouml;z&ouml;ket
      &aacute;ltal&aacute;ban hamarabb keresi a rendszer, mint a
      <acronym>SCSI</acronym> k&aacute;rty&aacute;n lev&#245;
      eszk&ouml;z&ouml;ket.  Megoldhatjuk &uacute;gy ezt a gondot, hogy
      csak azut&aacute;n csatlakoztatjuk az eml&iacute;tett
      eszk&ouml;z&ouml;ket, miut&aacute;n a rendszer elindult.
      Megoldhatjuk viszont &uacute;gy is, hogy csak egyetlen
      <acronym>ATA</acronym>-meghajt&oacute;t haszn&aacute;lunk
      &eacute;s soha nem soroljuk fel a <acronym>SCSI</acronym>
      eszk&ouml;z&ouml;ket az <filename>/etc/fstab</filename>
      &aacute;llom&aacute;nyban.</para>

    <para>Ezekn&eacute;l k&iacute;n&aacute;lkozik azonban egy jobb
      megold&aacute;s!  A <command>glabel</command> nev&#251;
      seg&eacute;dprogrammal a rendszergazda vagy a
      felhaszn&aacute;l&oacute; &uacute;gy tudja c&iacute;mk&eacute;zni
      a lemezmeghajt&oacute;kat, hogy azok a
      <filename>/etc/fstab</filename> &aacute;llom&aacute;nyban
      szerepl&#245; c&iacute;mk&eacute;ket haszn&aacute;lj&aacute;k.
      Mivel a <command>glabel</command> a c&iacute;mk&eacute;t az adott
      szolg&aacute;ltat&oacute; utols&oacute; szektor&aacute;ban
      t&aacute;rolja el, ez a c&iacute;mke megmarad az
      &uacute;jraind&iacute;t&aacute;s ut&aacute;n is.  Ha ezt a
      c&iacute;mk&eacute;t eszk&ouml;zk&eacute;nt haszn&aacute;ljuk, az
      &aacute;llom&aacute;nyrendszerek mindig ugyanarr&oacute;l a
      meghajt&oacute;r&oacute;l fognak csatol&oacute;dni,
      f&uuml;ggetlen&uuml;l att&oacute;l, hogy milyen
      eszk&ouml;zle&iacute;r&oacute;n kereszt&uuml;l &eacute;rj&uuml;k
      el ezeket.</para>

    <note>
      <para>Egy&aacute;ltal&aacute;n nem &aacute;ll&iacute;tottuk, hogy
	egy c&iacute;mke csak &aacute;lland&oacute; lehet.  A
	<command>glabel</command> seg&iacute;ts&eacute;g&eacute;vel
	egyar&aacute;nt l&eacute;tre lehet hozni &aacute;lland&oacute;
	&eacute;s &aacute;tmeneti c&iacute;mk&eacute;ket, de csak az
	&aacute;lland&oacute; c&iacute;mke k&eacute;pes az
	&uacute;jraind&iacute;t&aacute;s ut&aacute;n is megmaradni.  A
	k&eacute;t c&iacute;mket&iacute;pus k&ouml;zti
	k&uuml;l&ouml;nbs&eacute;geket a &man.glabel.8; man oldal
	t&aacute;rgyalja r&eacute;szletesebben.</para>
    </note>

    <sect2>
      <title>C&iacute;mket&iacute;pusok &eacute;s
	p&eacute;ld&aacute;k</title>

      <para>A c&iacute;mk&eacute;knek k&eacute;t t&iacute;pusa
	l&eacute;tezik, az &aacute;ltal&aacute;nos c&iacute;mke
	&eacute;s az &aacute;llom&aacute;nyrendszer-c&iacute;mke.  A
	c&iacute;mk&eacute;k lehetnek &aacute;lland&oacute;ak vagy
	ideiglenesek.  Az &aacute;lland&oacute; c&iacute;mk&eacute;k a
	&man.tunefs.8; vagy &man.newfs.8; parancsokkal hozhat&oacute;ak
	l&eacute;tre.  Ezek a c&iacute;mk&eacute;k az adott
	&aacute;llom&aacute;nyrendszer t&iacute;pusa alapj&aacute;n
	elnevezett alk&ouml;nyvt&aacute;rakban j&ouml;nnek l&eacute;tre
	a <filename class="directory">/dev</filename>
	k&ouml;nyvt&aacute;ron bel&uuml;l.  P&eacute;ld&aacute;ul az
	<acronym>UFS</acronym>2
	&aacute;llom&aacute;nyrendszer-c&iacute;mk&eacute;k a <filename
	  class="directory">/dev/ufs</filename> k&ouml;nyvt&aacute;rban
	keletkeznek.  &Aacute;lland&oacute; c&iacute;mk&eacute;k a
	<command>glabel label</command> paranccsal hozhat&oacute;ak
	l&eacute;tre.  Az ilyen c&iacute;mk&eacute;k nem f&uuml;ggenek
	az &aacute;llom&aacute;nyrendszerek
	t&iacute;pus&aacute;t&oacute;l, a <filename
	  class="directory">/dev/label</filename> k&ouml;nyvt&aacute;rban
	j&ouml;nnek l&eacute;tre.</para>

      <para>Az ideiglenes c&iacute;mk&eacute;k a k&ouml;vetkez&#245;
	indul&aacute;skor elvesznek.  Ezek a c&iacute;mk&eacute;k a
	<filename class="directory">/dev/label</filename>
	k&ouml;nyvt&aacute;rban keletkeznek, &eacute;s ide&aacute;lisak
	a k&iacute;s&eacute;rletezget&eacute;sre.  Ideiglenes
	c&iacute;mk&eacute;ket a <command>glabel create</command>
	paranccsal hozhatunk l&eacute;tre.  Ezzel kapcsolatosan
	r&eacute;szletesebb felvil&aacute;gos&iacute;t&aacute;st a
	&man.glabel.8; man oldalon tal&aacute;lhatunk.</para>

      <para>Ha egy <acronym>UFS</acronym>2
	&aacute;llom&aacute;nyrendszerre szeretn&eacute;nk tenni egy
	&aacute;lland&oacute; c&iacute;mk&eacute;t az adataink
	megsemmis&iacute;t&eacute;se n&eacute;lk&uuml;l, adjuk ki a
	k&ouml;vetkez&#245; parancsot:</para>

      <screen>&prompt.root; <userinput>tunefs -L <replaceable>home</replaceable> <replaceable>/dev/da3</replaceable></userinput></screen>

      <warning>
	<para>Ha az &eacute;rintett &aacute;llom&aacute;nyrendszeren
	  nincs &uuml;res hely, ennek a parancsnak a haszn&aacute;lata
	  adatveszt&eacute;shez vezethet.  Ilyen esetben ink&aacute;bb a
	  felesleges &aacute;llom&aacute;nyok
	  elt&aacute;vol&iacute;t&aacute;s&aacute;val kellene
	  t&ouml;r&#245;dn&uuml;nk, nem pedig c&iacute;mk&eacute;k
	  hozz&aacute;ad&aacute;s&aacute;val.</para>
      </warning>

      <para>Ezut&aacute;n egy c&iacute;mk&eacute;nek kell megjelennie a
	<filename class="directory">/dev/ufs</filename>
	k&ouml;nyvt&aacute;rban, amelyet vegy&uuml;nk is fel az
	<filename>/etc/fstab</filename> &aacute;llom&aacute;nyba:</para>

      <programlisting>/dev/ufs/home		/home            ufs     rw              2      2</programlisting>

      <note>
	<para>Az &aacute;llom&aacute;nyrendszert tilos csatolni a
	  <command>tunefs</command> futtat&aacute;sa alatt!</para>
      </note>

      <para>Most m&aacute;r a megszokott m&oacute;don csatolhatjuk az
	&aacute;llom&aacute;nyrendszert:</para>

      <screen>&prompt.root; <userinput>mount /home</userinput></screen>

      <para>Ett&#245;l a pontt&oacute;l kezdve, am&iacute;g a
	<filename>geom_label.ko</filename> modul bet&ouml;lt&#245;dik a
	rendszerind&iacute;t&aacute;s sor&aacute;n a
	<filename>/boot/loader.conf</filename> &aacute;llom&aacute;nyon
	kereszt&uuml;l, vagy a <literal>GEOM_LABEL</literal>
	opci&oacute; megtal&aacute;lhat&oacute; a rendszermag
	konfigur&aacute;ci&oacute;s &aacute;llom&aacute;ny&aacute;ban,
	az eszk&ouml;zle&iacute;r&oacute; a rendszerre n&eacute;zve
	minden komolyabb k&ouml;vetkezm&eacute;ny n&eacute;lk&uuml;l
	megv&aacute;ltozhat.</para>

      <para>&Aacute;llom&aacute;nyrendszereket l&eacute;trehozhatunk
	alap&eacute;rtelmezett c&iacute;mk&eacute;vel is a
	<command>newfs</command> <option>-L</option>
	param&eacute;ter&eacute;vel.  Err&#245;l r&eacute;szletesebben a
	&man.newfs.8; man oldalon olvashatunk.</para>

      <para>Az al&aacute;bbi paranccsal tudjuk t&ouml;r&ouml;lni a
	c&iacute;mk&eacute;t:</para>

      <screen>&prompt.root; <userinput>glabel destroy home</userinput></screen>

      <para>A k&ouml;vetkez&#245; p&eacute;ld&aacute;ban azt
	l&aacute;thatjuk, hogyan c&iacute;mk&eacute;zz&uuml;k fel a
	rendszerind&iacute;t&oacute; lemez&uuml;nk
	part&iacute;ci&oacute;it.</para>

      <example>
	<title>Part&iacute;ci&oacute;k c&iacute;mk&eacute;z&eacute;se a
	  rendszerind&iacute;t&oacute; lemezen</title>

	<para>A rendszerind&iacute;t&aacute;sra haszn&aacute;lt lemezen
	  lev&#245; part&iacute;ci&oacute;k
	  felc&iacute;mk&eacute;z&eacute;s&eacute;vel a rendszer
	  k&eacute;pes lesz akkor is minden probl&eacute;ma
	  n&eacute;lk&uuml;l elindulni, amikor &aacute;thelyezz&uuml;k
	  egy m&aacute;sik vez&eacute;rl&#245;re vagy &aacute;trakjuk
	  egy m&aacute;sik sz&aacute;m&iacute;t&oacute;g&eacute;pbe.
	  P&eacute;ld&aacute;ul most tegy&uuml;k fel, hogy van egy
	  <acronym>ATA</acronym> csatol&oacute;s lemez&uuml;nk, amelyet
	  a rendszer <devicename>ad0</devicename> n&eacute;ven ismert
	  fel.  Tov&aacute;bb&aacute; azt is felt&eacute;telezz&uuml;k,
	  hogy a &os; telep&iacute;t&eacute;se eset&eacute;n megszokott
	  part&iacute;cion&aacute;l&aacute;si s&eacute;m&aacute;t
	  v&aacute;lasztottuk, ahol <filename
	    class="directory">/</filename>, <filename
	    class="directory">/var</filename>, <filename
	    class="directory">/usr</filename> &eacute;s <filename
	    class="directory">/tmp</filename>
	  &aacute;llom&aacute;nyrendszereink, valamint egy
	  lapoz&oacute;ter&uuml;let&uuml;nk van.</para>

	<para>Ind&iacute;tsuk &uacute;jra a rendszer&uuml;nket &eacute;s
	  a &man.loader.8; men&uuml;j&eacute;ben a <keycap>4</keycap>
	  billenty&#251; lenyom&aacute;s&aacute;val v&aacute;lasszuk az
	  egyfelhaszn&aacute;l&oacute;s m&oacute;dot.  Ezt
	  k&ouml;vet&#245;en adjuk ki a k&ouml;vetkez&#245;
	  parancsokat:</para>

	<screen>&prompt.root; <userinput>glabel label rootfs /dev/ad0s1a</userinput>
GEOM_LABEL: Label for provider /dev/ad0s1a is label/rootfs
&prompt.root; <userinput>glabel label var /dev/ad0s1d</userinput>
GEOM_LABEL: Label for provider /dev/ad0s1d is label/var
&prompt.root; <userinput>glabel label usr /dev/ad0s1f</userinput>
GEOM_LABEL: Label for provider /dev/ad0s1f is label/usr
&prompt.root; <userinput>glabel label tmp /dev/ad0s1e</userinput>
GEOM_LABEL: Label for provider /dev/ad0s1e is label/tmp
&prompt.root; <userinput>glabel label swap /dev/ad0s1b</userinput>
GEOM_LABEL: Label for provider /dev/ad0s1b is label/swap
&prompt.root; <userinput>exit</userinput></screen>

	<para>A rendszer ind&iacute;t&aacute;sa ezut&aacute;n
	  t&ouml;bbfelhaszn&aacute;l&oacute;s m&oacute;dban
	  folytat&oacute;dik.  A rendszerind&iacute;t&aacute;s
	  befejez&#245;d&eacute;se ut&aacute;n nyissuk meg az
	  <filename>/etc/fstab</filename> &aacute;llom&aacute;nyt
	  &eacute;s &iacute;rjuk &aacute;t a hagyom&aacute;nyos
	  eszk&ouml;zneveket a hozz&aacute;juk tartoz&oacute;
	  c&iacute;mk&eacute;kre.  Az <filename>/etc/fstab</filename>
	  v&eacute;gleges v&aacute;ltozata ennek megfelel&#245;en
	  k&ouml;r&uuml;lbel&uuml;l &iacute;gy fog
	  kin&eacute;zni:</para>

	<programlisting># Eszk&ouml;z                 Csatlakoz&aacute;si pont  T&iacute;pus   Be&aacute;ll&iacute;t&aacute;sok     Dump    Menet
/dev/label/swap          none               swap    sw              0        0
/dev/label/rootfs        /                  ufs     rw              1        1
/dev/label/tmp           /tmp               ufs     rw              2        2
/dev/label/usr           /usr               ufs     rw              2        2
/dev/label/var           /var               ufs     rw              2        2</programlisting>

	<para>A rendszer most m&aacute;r
	  &uacute;jraind&iacute;that&oacute;.  Ha mindent j&oacute;l
	  csin&aacute;ltunk, akkor a rendszer ind&iacute;t&aacute;sa
	  probl&eacute;m&aacute;kt&oacute;l mentesen fog zajlani
	  &eacute;s a <command>mount</command> parancs eredm&eacute;nye
	  a k&ouml;vetkez&#245; lesz:</para>

	<screen>&prompt.root; <userinput>mount</userinput>
/dev/label/rootfs on / (ufs, local)
devfs on /dev (devfs, local)
/dev/label/tmp on /tmp (ufs, local, soft-updates)
/dev/label/usr on /usr (ufs, local, soft-updates)
/dev/label/var on /var (ufs, local, soft-updates)</screen>
      </example>

      <para>A &os;&nbsp;7.2 kiad&aacute;s&aacute;t&oacute;l
	kezd&#245;d&#245;en a &man.glabel.8; oszt&aacute;ly az
	<acronym>UFS</acronym> eset&eacute;n t&aacute;mogatja az
	<literal>ufsid</literal>, az &aacute;llom&aacute;nyrendszer
	egyedi rendszerszint&#251;
	azonos&iacute;t&oacute;j&aacute;b&oacute;l sz&aacute;rmaztatott
	&uacute;j c&iacute;mket&iacute;pus haszn&aacute;lat&aacute;t.
	Ezek a c&iacute;mk&eacute;k a rendszer ind&iacute;t&aacute;sa
	sor&aacute;n a <filename class="directory">/dev/ufsid</filename>
	k&ouml;nyvt&aacute;rban j&ouml;nnek automatikusan l&eacute;tre.
	Az <literal>ufsid</literal> c&iacute;mk&eacute;ken
	kereszt&uuml;l tudunk az <filename>/etc/fstab</filename>
	&aacute;llom&aacute;nyban &aacute;llom&aacute;nyrendszereket
	csatlakoztatni.  A jelenleg akt&iacute;v
	&aacute;llom&aacute;nyrendszereket &eacute;s azok
	<literal>ufsid</literal> azonos&iacute;t&oacute;it a
	<command>glabel status</command> paranccsal tudjuk
	lek&eacute;rdezni:</para>

      <screen>&prompt.user; <userinput>glabel status</userinput>
                  Name  Status  Components
ufsid/486b6fc38d330916     N/A  ad4s1d
ufsid/486b6fc16926168e     N/A  ad4s1f</screen>

      <para>Ebben a p&eacute;ld&aacute;ban az
	<devicename>ad4s1d</devicename> k&eacute;pviseli a <filename
	class="directory">/var</filename>
	&aacute;llom&aacute;nyrendszert, m&iacute;g a
	<devicename>ad4s1f</devicename> a <filename
	class="directory">/usr</filename>
	&aacute;llom&aacute;nyrendszert.  Az adott
	<literal>ufsid</literal> &eacute;rt&eacute;kek
	megad&aacute;s&aacute;val az <filename>/etc/fstab</filename>
	&aacute;llom&aacute;nyban a k&ouml;vetkez&#245;k&eacute;ppen
	tudjuk csatlakoztatni ezeket az
	&aacute;llom&aacute;nyrendszereket:</para>

      <programlisting>/dev/ufsid/486b6fc38d330916        /var        ufs        rw        2      2
/dev/ufsid/486b6fc16926168e        /usr        ufs        rw        2      2</programlisting>

      <para>Minden <literal>ufsid</literal> c&iacute;mk&eacute;vel
	rendelkez&#245; part&iacute;ci&oacute; csatlakoztathat&oacute;
	ezen a m&oacute;don.  Ekkor nem kell manu&aacute;lisan
	l&eacute;trehoznunk a sz&aacute;munkra &aacute;lland&oacute;
	c&iacute;mk&eacute;ket, &iacute;gy automatikusan
	&eacute;lvethezhetj&uuml;k az eszk&ouml;zn&eacute;vt&#245;l
	f&uuml;ggetlen csatlakoztat&aacute;s el&#245;nyeit.</para>
    </sect2>
  </sect1>

  <sect1 id="geom-gjournal">
    <title>Napl&oacute;z&oacute; UFS GEOM-on kereszt&uuml;l</title>

    <indexterm><primary>GEOM</primary></indexterm>
    <indexterm><primary>napl&oacute;z&aacute;s</primary></indexterm>

    <para>A &os;&nbsp;7.0-&aacute;s verzi&oacute;j&aacute;nak
      megjelen&eacute;s&eacute;vel egy r&eacute;g v&aacute;rt
      kieg&eacute;sz&iacute;t&eacute;s, a napl&oacute;z&aacute;s
      v&aacute;lt v&eacute;gre el&eacute;rhet&#245;v&eacute;
      v&aacute;lt.  Maga az implement&aacute;ci&oacute; a
      <acronym>GEOM</acronym> alrendszeren kereszt&uuml;l
      &eacute;rhet&#245; el, &eacute;s a &man.gjournal.8;
      seg&eacute;dprogram seg&iacute;ts&eacute;g&eacute;vel
      k&ouml;nnyed&eacute;n be&aacute;ll&iacute;that&oacute;.</para>

    <para>Mit is jelent a napl&oacute;z&aacute;s?  A
      napl&oacute;z&aacute;s t&aacute;mogat&aacute;s&aacute;val a
      rendszer egy napl&oacute;t vezet az
      &aacute;llom&aacute;nyrendszert &eacute;rint&#245;
      tranzakci&oacute;kr&oacute;l &mdash; p&eacute;ld&aacute;ul az
      olyan v&aacute;ltoztat&aacute;sokr&oacute;l, amelyek egy komplett
      &iacute;r&aacute;si m&#251;veletet eredm&eacute;nyeznek &mdash;
      miel&#245;tt m&eacute;g a metaadatok &eacute;s
      lemez&iacute;r&aacute;si m&#251;veletek szab&aacute;lyosan
      befejez&#245;dn&eacute;nek.  Ez a k&ouml;nyvel&eacute;s
      k&eacute;s&#245;bb visszaj&aacute;tszhat&oacute; az
      &aacute;llom&aacute;nyrendszerben lezajlott tranzakci&oacute;k
      reproduk&aacute;l&aacute;s&aacute;hoz, &eacute;s ezzel
      megel&#245;zhet&#245;ek az &aacute;llom&aacute;nyrendszerben
      keletkez&#245; esetleges ellentmond&aacute;sok.</para>

    <para>Ez egy &uacute;jabb m&oacute;dszer az adatveszt&eacute;s
      &eacute;s az &aacute;llom&aacute;nyrendszerben
      el&#245;fordul&oacute; ellentmond&aacute;sok
      elker&uuml;l&eacute;s&eacute;re.  Elt&eacute;r&#245;en a Soft
      Updates m&oacute;dszert&#245;l, ahol a metaadatok
      friss&iacute;t&eacute;s&eacute;t biztos&iacute;tj&aacute;k
      &eacute;s k&ouml;vetik nyomon, vagy a Snapshots
      m&oacute;dszert&#245;l, ahol pillanatk&eacute;peket
      t&aacute;rolunk az &aacute;llom&aacute;nyrendszerr&#245;l, itt egy
      konkr&eacute;t napl&oacute;t t&aacute;rolunk a lemez erre a
      c&eacute;lra fenntartott r&eacute;sz&eacute;n, amely bizonyos
      esetekben ak&aacute;r egy teljes k&uuml;l&ouml;n merevlemez is
      lehet.</para>

    <para>Ellent&eacute;tben a t&ouml;bbi napl&oacute;z&oacute;
      &aacute;llom&aacute;nyrendszert&#245;l, a
      <command>gjournal</command> m&oacute;dszere blokk alap&uacute;
      &eacute;s nem az &aacute;llom&aacute;nyrendszer
      r&eacute;szek&eacute;nt ker&uuml;lt implement&aacute;l&aacute;sra
      &mdash; csup&aacute;n a <acronym>GEOM</acronym> egyik
      b&#245;v&iacute;tm&eacute;nye.</para>

    <para>A <command>gjournal</command>
      t&aacute;mogat&aacute;s&aacute;hoz a &os; rendszermag
      konfigur&aacute;ci&oacute;s &aacute;llom&aacute;ny&aacute;ban be
      kell &aacute;ll&iacute;tani a k&ouml;vetkez&#245; opci&oacute;t
      &mdash; amely a 7.0 &eacute;s k&eacute;s&#245;bbi rendszereken
      alapbe&aacute;ll&iacute;t&aacute;s:</para>

    <programlisting>options	UFS_GJOURNAL</programlisting>

    <para>Amennyiben napl&oacute;z&aacute;ssal rendelkez&#245;
      k&ouml;teteket szeretn&eacute;nk a rendszerind&iacute;t&aacute;s
      sor&aacute;n csatlakoztatni, a
      <filename>/boot/loader.conf</filename> &aacute;llom&aacute;nyban
      k&ouml;vetkez&#245; sor hozz&aacute;ad&aacute;s&aacute;val
      t&ouml;ltess&uuml;k be a <filename>geom_journal.ko</filename>
      modult:</para>

    <programlisting>geom_journal_load="YES"</programlisting>

    <para>Sz&uuml;ks&eacute;g eset&eacute;n ezt a funkci&oacute;t
      ak&aacute;r a rendszermagba is be&eacute;p&iacute;thetj&uuml;k, ha
      felvessz&uuml;k a k&ouml;vetkez&#245; sort a rendszermag
      konfigur&aacute;ci&oacute;s
      &aacute;llom&aacute;ny&aacute;ba:</para>

    <programlisting>options	GEOM_JOURNAL</programlisting>

    <para>Ha ezt aktiv&aacute;ltuk, egy szabad
      &aacute;llom&aacute;nyrendszeren az al&aacute;bbi
      l&eacute;p&eacute;seken kereszt&uuml;l tudunk l&eacute;trehozni
      egy napl&oacute;t, felt&eacute;ve, hogy a
      <devicename>da4</devicename> egy &uacute;j
      <acronym>SCSI</acronym>-meghajt&oacute;:</para>

    <screen>&prompt.root; <userinput>gjournal load</userinput>
&prompt.root; <userinput>gjournal label /dev/ad4</userinput></screen>

    <para>Enn&eacute;l a pontn&aacute;l lennie kell egy
      <devicename>/dev/da4</devicename> &eacute;s egy
      <devicename>/dev/da4.journal</devicename>
      eszk&ouml;zle&iacute;r&oacute;nak.  Hozzunk l&eacute;tre egy
      &aacute;llom&aacute;nyrendszert ezen az eszk&ouml;z&ouml;n:</para>

    <screen>&prompt.root; <userinput>newfs -O 2 -J /dev/da4.journal</userinput></screen>

    <para>Ez a parancs l&eacute;trehoz egy <acronym>UFS</acronym>2
      &aacute;llom&aacute;nyrendszert a napl&oacute;val rendelkez&#245;
      eszk&ouml;z&ouml;n.</para>

    <para>Csatoljuk is be a <command>mount</command>
      seg&iacute;ts&eacute;g&eacute;vel az eszk&ouml;zt
      k&iacute;v&aacute;nt csatlakoz&aacute;si pontra:</para>

    <screen>&prompt.root; <userinput>mount /dev/da4.journal <replaceable>/mnt</replaceable></userinput></screen>

    <note>
      <para>Ha t&ouml;bb slice-unk is van, akkor a napl&oacute;
	mindegyik slice-hoz k&uuml;l&ouml;n l&eacute;trej&ouml;n.
	P&eacute;ld&aacute;ul, ha az <devicename>ad4s1</devicename>
	&eacute;s <devicename>ad4s2</devicename> egyar&aacute;nt
	slice-ok, akkor a <command>gjournal</command> legy&aacute;rtja
	az <devicename>ad4s1.journal</devicename> &eacute;s
	<devicename>ad4s2.journal</devicename>
	eszk&ouml;zle&iacute;r&oacute;kat.</para>
    </note>

    <para>A jobb teljes&iacute;tm&eacute;ny el&eacute;r&eacute;se
      &eacute;rdek&eacute;ben k&iacute;v&aacute;natos lehet a
      napl&oacute;t egy m&aacute;sik lemezen tartani.  Ilyen esetekben a
      napl&oacute;z&aacute;s bekapcsol&aacute;s&aacute;hoz a
      napl&oacute;t biztos&iacute;t&oacute; szolg&aacute;ltat&oacute;t
      vagy t&aacute;rol&oacute;eszk&ouml;zt a napl&oacute;zni
      k&iacute;v&aacute;nt eszk&ouml;z ut&aacute;n kell szerepeltetni.
      A napl&oacute;z&aacute;s ak&aacute;r az aktu&aacute;lisan
      haszn&aacute;lt &aacute;llom&aacute;nyrendszeren is
      aktiv&aacute;lhat&oacute; a <command>tunefs</command>
      haszn&aacute;lat&aacute;val.  Az &aacute;llom&aacute;nyrendszer
      m&oacute;dos&iacute;t&aacute;sakor viszont mindig &eacute;rdemes
      biztons&aacute;gi m&aacute;solatot k&eacute;sz&iacute;teni!  Az
      esetek t&ouml;bbs&eacute;g&eacute;ben a
      <command>gjournal</command> hib&aacute;t fog jelezni, mivel nem
      tudja l&eacute;trehozni a napl&oacute;t, azonban ez nem
      v&eacute;di meg az adatainkat a <command>tunefs</command>
      helytelen haszn&aacute;lata &aacute;ltal okozott
      s&eacute;r&uuml;l&eacute;sekt&#245;l.</para>

    <para>A rendszerind&iacute;t&oacute; lemezen is lehet
      napl&oacute;z&aacute;st haszn&aacute;lni.  Ennek r&eacute;szleit a
      <ulink
	url="&url.articles.gjournal-desktop;">Napl&oacute;z&oacute; UFS haszn&aacute;lata asztali sz&aacute;m&iacute;t&oacute;g&eacute;peken</ulink>
      c&iacute;m&#251; cikkb&#245;l ismerhetj&uuml;k meg.</para>
  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->

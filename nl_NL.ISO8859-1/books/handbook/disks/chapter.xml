<?xml version="1.0" encoding="iso-8859-1"?>
<!--
     The FreeBSD Dutch Documentation Project

     $FreeBSD$

     %SOURCE%	en_US.ISO8859-1/books/handbook/disks/chapter.xml
     %SRCID%	40792
	 (+42118,42226)
-->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="disks">
  <info><title>Opslag</title>
    <authorgroup>
      <author><personname><firstname>René</firstname><surname>Ladan</surname></personname><contrib>Vertaald door </contrib></author>
    </authorgroup>
  </info>

  

  <sect1 xml:id="disks-synopsis">
    <title>Overzicht</title>

    <para>Dit hoofdstuk behandelt het gebruik van schijven in &os;.
      Dit omvat geheugenschijven, schijven die met het netwerk
      verbonden zijn, SCSI/IDE-opslagapparaten en apparaten die gebruik
      maken van de USB-interface.</para>

    <para>Na het lezen van dit hoofdstuk weet de lezer:</para>

    <itemizedlist>
      <listitem>
	<para>Welke terminologie &os; gebruikt om de gegevensindeling
	  op een fysieke schijf te beschrijven (partities en
	  slices);</para>
      </listitem>

      <listitem>
	<para>Hoe aanvullende harde schijven aan een systeem toe te
	  voegen;</para>
      </listitem>

      <listitem>
	<para>Hoe &os; in te stellen om het gebruik te laten maken van
	  USB-opslagapparaten;</para>
      </listitem>

      <listitem>
	<para>Hoe virtuële bestandssystemen, zoals
	  geheugenschijven, aan te maken;</para>
      </listitem>

      <listitem>
	<para>Hoe quota te gebruiken om het schijfgebruik te
	  beperken;</para>
      </listitem>

      <listitem>
	<para>Hoe schijven te versleutelen om ze tegen inbrekers te
	  beschermen;</para>
      </listitem>

      <listitem>
	<para>Hoe vanuit &os; CD's en DVD's aan te maken en te
	  branden;</para>
      </listitem>

      <listitem>
	<para>Wat de verschillende mogelijkheden zijn voor opslagmedia
	  voor back-ups;</para>
      </listitem>

      <listitem>
	<para>Hoe back-upprogramma's te gebruiken die beschikbaar zijn
	  in &os;;</para>
      </listitem>

      <listitem>
	<para>Hoe een back-up naar diskettes te maken;</para>
      </listitem>

      <listitem>
	<para>Wat bestandssysteem snapshots zijn en hoe ze efficiënt te
	  gebruiken.</para>
      </listitem>
    </itemizedlist>

    <para>Aangeraden voorkennis:</para>

    <itemizedlist>
      <listitem>
	<para>Hoe een nieuwe &os;-kernel in te stellen en te
	  installeren (<xref linkend="kernelconfig"/>).</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="disks-naming">
    <title>Apparaatnamen</title>

    <para>De volgende lijst noemt de fysieke opslagapparaten die in
      &os; ondersteund worden, samen met de bijhorende namen.</para>

    <table xml:id="disk-naming-physical-table" frame="none">
      <title>Naamconventies voor fysieke Schijven</title>

      <tgroup cols="2">
	<thead>
	  <row>
	    <entry>Type medium</entry>

	    <entry>Apparaatnaam medium</entry>
	  </row>
	</thead>

	<tbody>
	  <row>
	    <entry>IDE harde schijven</entry>

	    <entry><literal>ad</literal></entry>
	  </row>

	  <row>
	    <entry>IDE CD-ROM-stations</entry>

	    <entry><literal>acd</literal></entry>
	  </row>

	  <row>
	    <entry>SCSI harde schijven en USB-apparaten voor
	      massa-opslag</entry>

	    <entry><literal>da</literal></entry>
	  </row>

	  <row>
	    <entry>SCSI CD-ROM-schijven</entry>

	    <entry><literal>cd</literal></entry>
	  </row>

	  <row>
	    <entry>Overige niet-standaard-CD-ROM-stations</entry>

	    <entry><literal>mcd</literal> voor Mitsumi CD-ROM en
	      <literal>scd</literal> voor Sony CD-ROM apparaten.</entry>
	  </row>

	  <row>
	    <entry>Diskettestations</entry>

	    <entry><literal>fd</literal></entry>
	  </row>

	  <row>
	    <entry>SCSI bandstations</entry>

	    <entry><literal>sa</literal></entry>
	  </row>

	  <row>
	    <entry>IDE bandstations</entry>

	    <entry><literal>ast</literal></entry>
	  </row>

	  <row>
	    <entry>Flashdrives</entry>

	    <entry><literal>fla</literal> voor &diskonchip;
	      flashapparaten</entry>
	  </row>

	  <row>
	    <entry>RAID-schijven</entry>

	    <entry><literal>aacd</literal> voor &adaptec; AdvancedRAID,
	      <literal>mlxd</literal> en <literal>mlyd</literal> voor
	      &mylex;, <literal>amrd</literal> voor AMI &megaraid;,
	      <literal>idad</literal> voor Compaq Smart RAID,
	      <literal>twed</literal> voor &tm.3ware; RAID.</entry>
	  </row>
	</tbody>
      </tgroup>
    </table>
  </sect1>

  <sect1 xml:id="disks-adding">
    <info><title>Schijven toevoegen</title>
      <authorgroup>
	<author><personname><firstname>David</firstname><surname>O'Brien</surname></personname><contrib>Origineel bijgedragen door </contrib></author>
      </authorgroup>
      
    </info>

    

    <indexterm>
      <primary>schijven</primary>

      <secondary>toevoegen</secondary>
    </indexterm>

    <para>De volgende sectie beschrijft hoe een nieuwe <acronym>SCSI</acronym>
      schijf aan een machine toe te voegen die slechts een enkele drive heeft.
      Ten eerste dient de computer uitgeschakeld te worden en dient de
      schijf volgens de instructies van de computer, controller en
      schijffabrikant geïnstalleerd te worden.  Wegens de grote
      variéteiten om dit soort procedures uit te voeren, vallen
      de details buiten het bereik van dit document.</para>

    <para>Er dient als gebruiker <systemitem class="username">root</systemitem> ingelogd te
      worden.  Nadat de schijf is toegevoegd, dient
      <filename>/var/run/dmesg.boot</filename> bekeken te worden om er
      zeker van te zijn dat de nieuwe schijf is gevonden.  Volgens het
      voorbeeld heet de nieuw toegevoegde schijf
      <filename>da1</filename> en die wordt aangekoppeld op
      <filename>/1</filename> (als er een IDE-schijf wordt toegevoegd,
      is de apparaatnaam <filename>ad1</filename>).</para>

    <indexterm><primary>partities</primary></indexterm>

    <indexterm><primary>slices</primary></indexterm>

    <indexterm><primary><command>fdisk</command></primary></indexterm>

    <para>&os; draait op IBM-PC-compatibele computers.  Daarom moet het
      rekening houden met de PC-BIOS-partities.  Deze wijken af van de
      traditionele BSD-partities.  Een PC-schijf bevat tot vier
      ingangen voor BIOS-partities.  Indien de schijf geheel aan &os;
      wordt gewijd, kan de <emphasis>toegewijde</emphasis>-modus
      gebruikt worden.  In het andere geval moet &os; binnen
      één van de vier PC-BIOS-partities draaien.  De
      PC-BIOS-partities worden door &os; <emphasis>slices</emphasis>
      genoemd om ze niet met de traditionele BSD-partities te
      verwarren.  Slices kunnen ook op een schijf worden gebruikt die
      toegewijd is aan &os;, maar in een computer zit die ook andere
      besturingssystemen heeft geïnstalleerd.  Dit is een goede
      manier om verwarring met het programma <command>fdisk</command>
      van andere, niet-&os; besturingssystemen te voorkomen.</para>

    <para>Als er met slices gewerkt wordt, wordt de schijf toegevoegd
      als <filename>/dev/da1s1e</filename>.  Dit moet worden gelezen
      als: SCSI-schijf, eenheid 1 (tweede SCSI-schijf), slice 1
      (PC-BIOS-partitie 1) en BSD-partitie <filename>e</filename>.  Als
      de schijf toegewijd is, wordt deze simpelweg als
      <filename>/dev/da1e</filename> toegevoegd.</para>

    <para>Omdat 32-bit-integers worden gebruikt om het aantal sectoren
      op te slaan, is &man.bsdlabel.8;
      beperkt tot 2^32-1 sectoren per schijf, wat
      meestal neerkomt op 2&nbsp;TB.  Het programma &man.fdisk.8; staat
      geen hogere startsector toe dan 2^32-1 en geen grotere lengte dan
      2^32-1, meestal worden hiermee partities tot 2&nbsp;TB begrensd
      en schijven tot 4&nbsp;TB.  Het formaat van &man.sunlabel.8; is
      beperkt tot 2^32-1 sectoren per partitie en 8 partities per
      schijf, in totaal dus 16&nbsp;TB.  Voor grotere schijven kan
      &man.gpart.8; worden gebruikt om <acronym>GPT</acronym>-partities aan te
      maken.  <acronym>GPT</acronym> heeft het bijkomende voordeel dat het niet
      tot 4 slices beperkt is.</para>

    <sect2>
      <title>&man.sysinstall.8; gebruiken</title>

      <indexterm>
	<primary><application>sysinstall</application></primary>

	<secondary>schijven toevoegen</secondary>
      </indexterm>

      <indexterm><primary>su</primary></indexterm>

      <procedure>
	<step>
	  <title>Navigeren door
	    <application>sysinstall</application></title>

	  <para><command>sysinstall</command>
	    kan gebruikt worden om een nieuwe schijf te
	    partitioneren en te labelen met eenvoudig te gebruiken
	    menu's.  Hiervoor dient òfwel als gebruiker
	    <systemitem class="username">root</systemitem> ingelogd te zijn, òfwel
	    gebruik te worden gemaakt van <command>su</command>.  Draai
	    <command>sysinstall</command> en ga naar het menu
	    <literal>Configure</literal>.  Scroll binnen het
	    <literal>&os; Configuration Menu</literal> naar
	    beneden en kies de optie <literal>Fdisk</literal>.</para>
	</step>

	<step>
	  <title><application>fdisk</application>
	    partitie-bewerker</title>

	  <para>Eenmaal binnen <application>fdisk</application> kan op
	    <keycap>A</keycap> gedrukt worden om de gehele
	    schijf voor &os; te gebruiken.  Wanneer gevraagd wordt of
	    het systeem compatibel dient te blijven met mogelijk
	    toekomstige besturingssystemen, dient met
	    <literal>YES</literal> geantwoord te worden.  Met
	    <keycap>W</keycap> kunnen de veranderingen naar de
	    schijf worden geschreven.  Nu dient de FDISK-bewerker
	    verlaten te worden door op <keycap>Q</keycap> te drukken.
	    Vervolgens wordt er een vraag
	    gesteld over het <quote>Master Boot Record</quote>.  Omdat
	    er een schijf aan een reeds draaiend systeem wordt
	    toegevoegd, dient hier <literal>None</literal> gekozen te
	    worden.</para>
	</step>

	<step>
	  <title>Schijflabelbewerker</title>

	  <indexterm><primary>BSD-partities</primary></indexterm>

	  <para>Vervolgens dient <application>sysinstall</application>
	    verlaten en opnieuw gestart te worden.  Volg bovenstaande
	    aanwijzingen, maar kies deze keer voor de optie
	    <literal>Label</literal>.  Dit geeft toegang tot de
	    <literal>Disk Label Editor</literal>.   Hier worden de
	    traditionele BSD-partities aangemaakt.  Een schijf kan tot
	    acht partities bevatten, gelabeld <literal>a-h</literal>.
	    Enkele partitielabels hebben een speciale functie.  De
	    partitie <literal>a</literal> wordt gebruikt voor de
	    rootpartitie (<filename>/</filename>).  Alleen de
	    systeemschijf (bijvoorbeeld de schijf van waaruit opgestart
	    wordt) moet een partitie <literal>a</literal> hebben.  De
	    partitie <literal>b</literal> wordt voor swappartities
	    gebruikt, en het is mogelijk om vele schijven met
	    swappartities te hebben.  De partitie <literal>c</literal>
	    adresseert de gehele schijf in toegewijde modus, of de
	    gehele &os;-slice in slice-modus.  De andere partities zijn
	    voor algemeen gebruik.</para>

	  <para><application>sysinstall</application>'s Labelbewerker
	    heeft een voorkeur voor de partitie <literal>e</literal>
	    voor niet-root-niet-swap-partities.  Binnen de
	    Labelbewerker dient een enkel bestandssysteem te worden
	    aangemaakt door op <keycap>C</keycap> te drukken.  Kies
	    <literal>FS</literal> wanneer gevraagd wordt of dit een FS
	    (file system) of swap wordt, en geef een koppelpunt in
	    (bijvoorbeeld <filename>/mnt</filename>).  Wanneer een
	    schijf in post-installatie-modus wordt toegevoegd, maakt
	    <application>sysinstall</application> geen ingangen aan in
	    <filename>/etc/fstab</filename>, dus dan is het opgegeven
	    koppelpunt niet van belang.</para>

	  <para>Nu kan het nieuwe label naar de schijf worden
	    geschreven en er een bestandssysteem op aangemaakt worden.
	    Dit kan gedaan worden door op <keycap>W</keycap> te
	    drukken.  Fouten van <application>sysinstall</application>
	    dat de nieuwe partitie niet aankoppeld kon worden kunnen
	    genegeerd worden.  De Labelbewerker en
	    <application>sysinstall</application> kunnen nu volledig
	    verlaten worden.</para>
	</step>

	<step>
	  <title>Afronden</title>

	  <para>De laatste stap bestaat uit het bewerken van
	    <filename>/etc/fstab</filename> om hier een regel voor de
	    nieuwe schijf aan toe te voegen.</para>
	</step>
      </procedure>
    </sect2>

    <sect2>
      <title>Het gebruik van opdrachtregelgereedschappen</title>

      <sect3>
	<title>Het gebruik van slices</title>

	<para>Deze installatie zorgt ervoor dat de schijf correct
	  samenwerkt met andere besturingssystemen die eventueel op de
	  computer zijn geïnstalleerd en dat de
	  <command>fdisk</command>-gereedschappen van andere
	  besturingssystemen niet verward raken.  Het wordt aangeraden
	  om deze methode te gebruiken voor de installatie van nieuwe
	  schijven.  Gebruik de <literal>toegewijde</literal> modus
	  alleen als hier een goede reden voor bestaat!</para>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of/dev/da1 bs=1k count=1</userinput>
&prompt.root; <userinput>fdisk -BI da1</userinput> # Initialiseer de nieuwe schijf.
&prompt.root; <userinput>bsdlabel -B -w da1s1 auto</userinput> # Label de schijf.
&prompt.root; <userinput>bsdlabel -e da1s1</userinput> # Bewerk de zojuist aangemaakte schijflabel en voeg partities toe.
&prompt.root; <userinput>mkdir -p /1</userinput>
&prompt.root; <userinput>newfs /dev/da1s1e</userinput> # Herhaal dit voor alle aangemaakte partities.
&prompt.root; <userinput>mount /dev/da1s1e /1</userinput> # Mount de partitie(s).
&prompt.root; <userinput>vi /etc/fstab</userinput> # Voeg de juiste regel(s) aan <filename>/etc/fstab</filename> toe.</screen>

	<para>Vervang voor een IDE-schijf <filename>da</filename> door
	  <filename>ad</filename>.</para>
      </sect3>

      <sect3>
	<title>Toegewijd</title>

	<indexterm><primary>OS/2</primary></indexterm>

	<para>Indien de nieuwe schijf niet met een ander
	  besturingssysteem gedeeld wordt, kan de
	  <literal>toegewijde</literal> modus gebruikt worden.  Denk
	  eraan dat deze modus besturingssystemen van Microsoft kan
	  verwarren.  Ze richten echter geen schade aan.  IBM's &os2;
	  <quote>fatsoeneert</quote> echter partities die het niet
	  begrijpt.</para>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=/dev/da1 bs=1k count=1</userinput>
&prompt.root; <userinput>bsdlabel -Bw da1 auto</userinput>
&prompt.root; <userinput>bsdlabel -e da1</userinput> # Maak de `e'-partitie aan.
&prompt.root; <userinput>newfs /dev/da1e</userinput>
&prompt.root; <userinput>mkdir -p /1</userinput>
&prompt.root; <userinput>vi /etc/fstab</userinput> # Voeg een regel voor /dev/da1e toe.
&prompt.root; <userinput>mount /1</userinput></screen>

	<para>Een alternatieve methode is:</para>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=/dev/da1 count=2</userinput>
&prompt.root; <userinput>bsdlabel /dev/da1 | bsdlabel -BR da1 /dev/stdin</userinput>
&prompt.root; <userinput>newfs /dev/da1e</userinput>
&prompt.root; <userinput>mkdir -p /1</userinput> # Voeg een regel voor /dev/da1e toe.
&prompt.root; <userinput>mount /1</userinput></screen>

      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="raid">
    <title>RAID</title>

    <sect2 xml:id="raid-soft">
      <title>Software RAID</title>

      <sect3 xml:id="ccd">
	<info><title>Concatenated Disk Driver (CCD) instellingen</title>
	  <authorgroup>
	    <author><personname><firstname>Christopher</firstname><surname>Shumway</surname></personname><contrib>Origineel werk van </contrib></author>
	  </authorgroup>

	  <authorgroup>
	    <author><personname><firstname>Jim</firstname><surname>Brown</surname></personname><contrib>Herzien door </contrib></author>
	  </authorgroup>
	</info>

	

	<indexterm>
	  <primary>RAID</primary>

	  <secondary>softwarematig</secondary>
	</indexterm>

	<indexterm>
	  <primary>RAID</primary>

	  <secondary>CCD</secondary>
	</indexterm>

	<para>Bij het kiezen van een medium voor massa-opslag zijn de
	  belangrijkste afwegingen snelheid, betrouwbaarheid en kosten.
	  Het komt zelden voor dat alle drie in balans zijn.
	  Normaalgesproken is een snel, betrouwbaar apparaat voor
	  massa-opslag duur en kosten sparen gaat ten koste van
	  òfwel snelheid òfwel betrouwbaarheid.</para>

	<para>Bij het ontwerpen van het onderstaande systeem werd
	  primair op de kosten gelet, gevolgd door snelheid en als
	  laatste betrouwbaarheid.  De overdrachtsnelheid van gegevens
	  wordt voor dit systeem uiteindelijk beperkt door het netwerk.
	  En hoewel betrouwbaarheid erg belangrijk is, wordt
	  onderstaande CCD-schijf gebruikt voor het serven van on-line
	  gegevens die reeds volledig op CD-R's zijn geback-upt en
	  eenvoudig vervangen kunnen worden.</para>

	<para>De eerste stap in het kiezen van een
	  massa-opslagoplossing is het bepalen van de eigen
	  benodigdheden.  Indien snelheid belangrijker is dan
	  betrouwbaarheid of kosten, wijkt de oplossing af van het
	  systeem dat in deze sectie wordt beschreven.</para>

	<sect4 xml:id="ccd-installhw">
	  <title>Hardware installeren</title>

	  <para>Als aanvulling op de IDE systeemschijf zijn drie
	    Western Digital IDE-schijven van 30&nbsp;GB, 5400&nbsp;RPM
	    vanuit de kern van de onderstaande CCD-schijf aanwezig, die
	    ongeveer 90&nbsp;GB aan on-line opslag bieden.  Ideaal
	    gezien heeft iedere IDE-schijf een eigen IDE-controller en
	    kabel, maar om de kosten te minimaliseren zijn geen
	    aanvullende IDE-kabels gebruikt.  In plaats hiervan zijn de
	    schijven zodanig met jumpers ingesteld dat elke
	    IDE-controller één master en
	    één slave heeft.</para>

	  <para>Tijdens het opnieuw opstarten werd het systeem-BIOS
	    zodanig ingesteld dat het automatisch de aangekoppelde
	    schijven detecteerde.  Het was belangrijker dat &os; ze
	    tijdens het opnieuw opstarten herkende:</para>

	  <programlisting>ad0: 19574MB &lt;WDC WD205BA&gt; [39770/16/63] at ata0-master UDMA33
ad1: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata0-slave UDMA33
ad2: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata1-master UDMA33
ad3: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata1-slave UDMA33</programlisting>

	  <note>
	    <para>Indien &os; niet alle schijven detecteert, moet
	      gecontroleerd worden of de jumpers juist zijn ingesteld.
	      De meeste IDE-schijven hebben ook een jumper voor
	      <quote>Cable Select</quote>.  Dit is
	      <emphasis>niet</emphasis> de jumper voor de
	      master/slave-instelling.  Voor hulp met het identificeren
	      van de juiste jumper dient de documentatie van de schijf
	      geraadpleegd te worden.</para>
	  </note>
<!--
	  <para>Vervolgens dient besloten te worden hoe ze deel gaan
	    uitmaken van het bestandssysteem.  Hiervoor dienen
	    &man.vinum.4; (<xref linkend="vinum-vinum"/>) en &man.ccd.4;
	    bestudeerd te worden.  Voor deze instellingen werd voor
	    &man.ccd.4; gekozen.</para>
-->
	</sect4>

	<sect4 xml:id="ccd-setup">
	  <title>CCD installeren</title>

	  <para>Het stuurprogramma &man.ccd.4; biedt de mogelijkheid om
	    meerdere identieke schijven aaneen te rijgen tot
	    één logisch bestandssysteem.  Om gebruik te
	    kunnen maken van &man.ccd.4; is een kernel met ingebouwde
	    ondersteuning voor &man.ccd.4; nodig.  De volgende regel
	    dient toegevoegd te worden aan het
	    kernelinstellingenbestand en de kernel dient opnieuw
	    gebouwd en geïnstalleerd te worden:</para>

	  <programlisting>device  ccd</programlisting>

	  <para>Om &man.ccd.4; te installeren dient eerst
	    &man.bsdlabel.8; gebruikt te worden om de schijven te
	    labelen:</para>

	  <programlisting>bsdlabel -w -ad1 auto
bsdlabel -w ad2 auto
bsdlabel -w ad3 auto</programlisting>

	  <para>Bovenstaande maakt een schijflabel aan voor
	    <filename>ad1c</filename>,
	    <filename>ad2c</filename> en
	    <filename>ad3c</filename> die de gehele schijf
	    beslaat.</para>

	  <para>Vervolgens dient het labeltype van de schijf veranderd
	    te worden.  Voor het bewerken van de schijven kan
	    &man.bsdlabel.8; gebruikt worden:</para>

	  <programlisting>bsdlabel -e ad1
bsdlabel -e ad2
bsdlabel -e ad3</programlisting>

	  <para>Dit zorgt ervoor dat het huidige schijflabel van elke
	    schijf met de tekstverwerker wordt geopend die door de
	    omgevingsvariabele <envar>EDITOR</envar> wordt
	    gespecificeerd, vaak &man.vi.1;.</para>

	  <para>Een ongewijzigd schijflabel ziet er ongeveer als volgt
	    uit:</para>

	  <programlisting>8 partitions:
# size	offset	fstype	[fsize	bsize bps/cpg]
c: 60074784 0 unused  0	0 0 # (Cyl. 0 - 59597)</programlisting>

	  <para>Er dient een nieuwe partitie <literal>e</literal>
	    toegevoegd te worden die door &man.ccd.4; gebruikt kan
	    worden.  Deze kan gewoonlijk van partitie
	    <literal>c</literal> overgenomen worden, maar het
	    <option>fstype</option> <emphasis>moet</emphasis>
	    <userinput>4.2BSD</userinput> zijn.  Het schijflabel ziet
	    er nu ongeveer als volgt uit:</para>

	  <programlisting>8 partitions:
# size	offset	fstype	[fsize	bsize bps/cpg]
c:  60074784  0	unused	0 0 0 # (Cyl. 0 - 59597)
e:  60074784  0	4.2BSD	0 0 0 #	(Cyl. 0 - 59597)</programlisting>
	</sect4>

	<sect4 xml:id="ccd-buildingfs">
	  <title>Bestandssysteem aanmaken</title>

	  <para>Nu alle schijven gelabeld zijn, moet de &man.ccd.4;
	    gebouwd worden.  Om dit te doen, dient &man.ccdconfig.8;
	    gebruikt te worden met opties die ongeveer gelijk zijn aan
	    de volgende:</para>

	  <programlisting>ccdconfig ccd0<co xml:id="co-ccd-dev"/> 32<co xml:id="co-ccd-interleave"/> 0<co xml:id="co-ccd-flags"/> /dev/ad1e<co xml:id="co-ccd-devs"/> /dev/ad2e /dev/ad3e</programlisting>

	  <para>Hieronder staat het gebruik en de betekenis van elke
	    optie:</para>

	  <calloutlist>
	    <callout arearefs="co-ccd-dev">
	      <para>Het eerste argument is het in te stellen apparaat,
		in dit geval <filename>/dev/ccd0c</filename>.  Het
		gedeelte <filename>/dev/</filename> is
		optioneel.</para>
	    </callout>

	    <callout arearefs="co-ccd-interleave">
	      <para>De interleave voor het bestandssysteem.  De
		interleave definiëert de grootte van een stripe
		in schijfblokken, elk schijfblok is normaalgesproken
		512&nbsp;bytes groot.  Een interleave van 32 is dus
		16.384&nbsp;bytes groot.</para>
	    </callout>

	    <callout arearefs="co-ccd-flags">
	      <para>Vlaggen voor &man.ccdconfig.8;.  Indien het gewenst
		is om schijfspiegeling aan te zetten, kan er hier een
		vlag voor gespecificeerd worden.  Deze opstelling biedt
		geen spiegeling voor &man.ccd.4;, dus is die op 0 (nul)
		ingesteld.</para>
	    </callout>

	    <callout arearefs="co-ccd-devs">
	      <para>De laatste argumenten voor &man.ccdconfig.8; zijn
		de apparaten die in de rij geplaatst dienen te worden.
		Voor elk apparaat dient de complete padnaam gebruikt te
		worden.</para>
	    </callout>
	  </calloutlist>

	  <para>Nadat &man.ccdconfig.8; gedraaid is, is de &man.ccd.4;
	    ingesteld.  Er kan een bestandssysteem worden
	    geïnstalleerd.  Er kan in &man.newfs.8; worden gekeken
	    voor opties, of het draaien van het onderstaande commando
	    is ook toereikend:</para>

	  <programlisting>newfs /dev/ccd0c</programlisting>
	</sect4>

	<sect4 xml:id="ccd-auto">
	  <title>Alles automatisch maken</title>

	  <para>In het algemeen is het wenselijk om de &man.ccd.4;
	    telkens te mouten wanneer er opnieuw opgestart wordt.
	    Dit dient eerst ingesteld te worden.  Met het volgende
	    commando worden de huidige instellingen naar
	    <filename>/etc/ccd.conf</filename> geschreven:</para>

	  <programlisting>ccdconfig -g &gt; /etc/ccd.conf</programlisting>

	  <para>Tijdens het opstarten draait het script
	    <command>/etc/rc</command> <command>ccdconfig -C</command>
	    indien <filename>/etc/ccd.conf</filename> bestaat.  Dit
	    stelt automatisch de &man.ccd.4; in, zodat die kan worden
	    aangekoppeld.</para>

	  <note>
	    <para>Indien er in enkele-gebruiker-modus wordt opgestart,
	      dient het volgende commando te worden uitgevoerd om de
	      rij in te stellen voordat de &man.ccd.4; aangekoppeld kan
	      worden:</para>

	    <programlisting>ccdconfig -C</programlisting>
	  </note>

	  <para>Om de &man.ccd.4; automatisch aan te koppelen, kan er
	    een regel voor de &man.ccd.4; in
	    <filename>/etc/fstab</filename> geplaatst worden, zodat die
	    tijdens het opstarten aangekoppeld wordt:</para>

	  <programlisting>/dev/ccd0c  /media  ufs rw  2	2</programlisting>
	</sect4>
      </sect3>

      <sect3 xml:id="vinum">
	<title>Volumebeheerder Vinum</title>

	<indexterm>
	  <primary>RAID</primary>

	  <secondary>software</secondary>
	</indexterm>

	<indexterm>
	  <primary>RAID</primary>

	  <secondary>Vinum</secondary>
	</indexterm>

	<para>De volumebeheerder Vinum is een blokstuurprogramma dat
	  virtuele schijven implementeert.  Het isoleert schijfhardware
	  van de blokapparaat-interface en projecteert gegevens op een
	  manier die de flexibiliteit, prestatie en betrouwbaarheid
	  verhoogt in vergelijking met de traditionele slice-blik op
	  schijfopslag.  &man.vinum.4; implementeert de modellen
	  RAID-0, RAID-1 en RAID-5, zowel individueel als als
	  combinatie.</para>
<!--
	<para>In <xref linkend="vinum-vinum"/> staat meer informatie
	  over &man.vinum.4;.</para>
-->
      </sect3>
    </sect2>

    <sect2 xml:id="raid-hard">
      <title>Hardwarematige RAID</title>

      <indexterm>
	<primary>RAID</primary>

	<secondary>hardwarematig</secondary>
      </indexterm>

      <para>&os; ondersteunt ook een verscheidenheid aan hardwarematige
	<acronym>RAID</acronym>-stuurprogramma's.  Deze apparaten
	besturen een <acronym>RAID</acronym>-deelsysteem zonder dat er
	&os;-specifieke software nodig is om de rij te beheren.</para>

      <para>Door gebruik te maken van een <acronym>BIOS</acronym> die
	op de kaart aanwezig is, beheert de kaart de meeste
	schijfbewerkingen zelf.  Nu volgt een korte beschrijving van
	een opzet waarbij een Promise
	<acronym>IDE</acronym>-stuurprogramma is gebruikt.  Wanneer
	deze kaart geïnstalleerd en het systeem opgestart is,
	beeldt het een prompt af waarbij om informatie wordt gevraagd.
	De instructies dienen opgevolgd te worden om bij het
	instelscherm van de kaart te komen.  Van hieruit kunnen alle
	aangekoppelde schijven gecombineerd worden.  Nadat dit gedaan
	is, zien de schijven er voor &os; als één enkele
	schijf uit.  Andere <acronym>RAID</acronym>-niveaus kunnen
	overeenkomstig ingesteld worden.</para>
    </sect2>

    <sect2>
      <title>ATA RAID1-rijen opnieuw bouwen</title>

      <para>Met &os; is het mogelijk om een defecte schijf in een rij
	te vervangen terwijl de computer aanstaat (<quote>hot
	  replace</quote>).  Hiervoor dient de schijf
	vóór het opnieuw opstarten vervangen te
	zijn.</para>

      <para>Waarschijnlijk is zoiets als het volgende in
	<filename>/var/log/messages</filename> of in de uitvoer van
	&man.dmesg.8; te zien:</para>

      <programlisting>ad6 on monster1 suffered a hard error.
ad6: READ command timeout tag=0 serv=0 - resetting
ad6: trying fallback to PIO mode
ata3: resetting devices .. done
ad6: hard error reading fsbn 1116119 of 0-7 (ad6 bn 1116119; cn 1107 tn 4 sn 11)\\
status=59 error=40
ar0: WARNING - mirror lost</programlisting>

      <para>Meer informatie kan met behulp van &man.atacontrol.8;
	gezocht worden:</para>

      <screen>&prompt.root; <userinput>atacontrol list</userinput>
ATA channel 0:
	Master:      no device present
	Slave:   acd0 &lt;HL-DT-ST CD-ROM GCR-8520B/1.00&gt; ATA/ATAPI rev 0

ATA channel 1:
	Master:      no device present
	Slave:       no device present

ATA channel 2:
	Master:  ad4 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
	Slave:       no device present

ATA channel 3:
	Master:  ad6 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
	Slave:       no device present

&prompt.root; <userinput>atacontrol status ar0</userinput>
ar0: ATA RAID1 subdisks: ad4 ad6 status: DEGRADED</screen>

      <procedure>
	<step>
	  <para>Ontkoppel eerst het ata kanaal met de falende schijf
	    zodat deze veilig kan worden verwijderd:</para>

	  <screen>&prompt.root; <userinput>atacontrol detach ata3</userinput></screen>
	</step>

	<step>
	  <para>Vervang de schijf.</para>
	</step>

	<step>
	  <para>Koppel het ata kanaal opnieuw aan:</para>

	  <screen>&prompt.root; <userinput>atacontrol attach ata3</userinput>
Master:  ad6 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
Slave:   no device present</screen>
	</step>

	<step>
	  <para>Voeg de nieuwe schijf toe aan de rij als
	    reserve:</para>

	  <screen>&prompt.root; <userinput>atacontrol addspare ar0 ad6</userinput></screen>
	</step>

	<step>
	  <para>De rij dient nu opnieuw opgebouwd te worden:</para>

	  <screen>&prompt.root; <userinput>atacontrol rebuild ar0</userinput></screen>
	</step>

	<step>
	  <para>Het is mogelijk de voortgang te volgen met het volgende
	    commando:</para>

	  <screen>&prompt.root; <userinput>dmesg | tail -10</userinput>
[uitvoer verwijderd]
ad6: removed from configuration
ad6: deleted from ar0 disk1
ad6: inserted into ar0 disk1 as spare

&prompt.root; <userinput>atacontrol status ar0</userinput>
ar0: ATA RAID1 subdisks: ad4 ad6 status: REBUILDING 0% completed</screen>
	</step>

	<step>
	  <para>Nu moet er gewacht worden tot de bewerking voltooid
	    is.</para>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 xml:id="usb-disks">
    <info><title>USB-opslagapparaten</title>
      <authorgroup>
	<author><personname><firstname>Marc</firstname><surname>Fonvieille</surname></personname><contrib>Bijgedragen door </contrib></author>
      </authorgroup>
      
    </info>

    

    <indexterm>
      <primary>USB</primary>

      <secondary>schijven</secondary>
    </indexterm>

    <para>Veel externe opslagoplossingen gebruiken tegenwoordig de
      Universele Seriële Bus (USB): harde schijven,
      USB-duimdrives, CD-R-branders, etc.  &os; biedt voor al dit soort
      apparaten ondersteuning.</para>

    <sect2>
      <title>Instellen</title>

      <para>Het stuurprogramma &man.umass.4; biedt de ondersteuning
	voor USB-opslagapparaten.  Indien de kernel
	<filename>GENERIC</filename> wordt gebruikt, hoeft er niets aan
	de instellingen gewijzigd te worden.  Als er een eigen kernel
	wordt gebruikt, dienen de volgende regels in het
	kernelinstellingenbestand aanwezig zijn:</para>

      <programlisting>device scbus
device da
device pass
device uhci
device ohci
device ehci
device usb
device umass</programlisting>

      <para>Het stuurprogramma &man.umass.4; gebruikt het subsysteem
	SCSI om toegang te krijgen tot de USB-opslagapparaten.  Het
	USB-apparaat wordt door het systeem als een SCSI-apparaat
	gezien.  Afhankelijk van de chipset op het moederbord is
	slechts òf <literal>device uhci</literal> òf
	<literal>device ohci</literal> nodig voor ondersteuning van USB 1.X.
	Het kan echter geen kwaad om ze beiden in het kernelinstellingenbestand
	te hebben.  Ondersteuning voor USB 2.0 wordt geleverd door het
	stuurprogramma &man.ehci.4; (de regel met
	<literal>device ehci</literal>).  Indien er regels zijn toegevoegd dient
	de kernel opnieuw gecompileerd en geïnstalleerd te worden.</para>

      <note>
	<para>Indien het USB-apparaat een CD-R- of DVD-brander is,
	  dient het SCSI CD-ROM-stuurprogramma &man.cd.4; met de
	  volgende regel aan de kernel toegevoegd te worden:</para>

	<programlisting>device cd</programlisting>

	<para>Aangezien de brander als een SCSI-schijf gezien wordt,
	  dient het stuurprogramma &man.atapicam.4; niet in de
	  kernelinstellingen gebruikt te worden.</para>
      </note>
    </sect2>

    <sect2>
      <title>Instellingen testen</title>

      <para>De instellingen zijn klaar om getest te worden: het
	USB-apparaat dient aangesloten te worden en in de buffer voor
	systeemmeldingen (&man.dmesg.8;) dient het stuurprogramma
	ongeveer als volgt te verschijnen:</para>

      <screen>umass0: USB Solid state disk, rev 1.10/1.00, addr 2
GEOM: create disk da0 dp=0xc2d74850
da0 at umass-sim0 bus 0 target 0 lun 0
da0: &lt;Generic Traveling Disk 1.11&gt; Removable Direct Access SCSI-2 device
da0: 1.000MB/s transfers
da0: 126MB (258048 512 byte sectors: 64H 32S/T 126C)</screen>

      <para>Uiteraard kunnen het merk, de apparaatnode
	(<filename>da0</filename>) en andere details verschillen
	naar gelang de instelling.</para>

      <para>Aangezien het USB-apparaat als een SCSI-apparaat gezien
	wordt, kan het commando <command>camcontrol</command> gebruikt
	worden om de USB-opslagapparaten weer te geven die aan het
	systeem gekoppeld zijn:</para>

      <screen>&prompt.root; <userinput>camcontrol devlist</userinput>
&lt;Generic Traveling Disk 1.11&gt;      at scbus0 target 0 lun 0 (da0,pass0)</screen>

      <para>Indien er een bestandssysteem op de schijf aanwezig is, kan
	dat aangekoppeld worden.  <xref linkend="disks-adding"/> biedt
	indien nodig hulp bij het formatteren en aanmaken van partities
	op de USB-drive.</para>

      <warning>
	<para>Door het toestaan dat gewone gebruikers verschillende
	  media kunnen koppelen door bijvoorbeeld het aanzetten van
	  <literal>vfs.usermount</literal> zoals hieronder beschreven,
	  zou niet als veilig beschoud moeten worden uit een
	  beveiligings oogpunt.  Veel bestandssystemen in &os; zijn
	  niet geschreven om beveiliging te bieden tegen kwaadaardige
	  apparaten.</para>
      </warning>

      <para>Om het apparaat koppelbaar te maken voor de gewone gebruiker
	moeten er een aantal stappen ondernomen worden.  Als eerste
	moeten de apparaten die gecreeerd worden wanneer het USB opslag-
	medium wordt toegevoegd toegankelijk zijn voor de gebruiker.
	Een oplossing is om alle gebruikers die deze rechten nodig hebben
	toe te voegen aan de <systemitem class="groupname">operator</systemitem> groep.  Dit
	kan gedaan worden met &man.pw.8;.  Daarna moet het voor de
	<systemitem class="groupname">operator</systemitem> groep mogelijk zijn te lezen en
	te schrijven naar de gecreeerde apparaten.  Dit kan bewerkstelligd
	worden door de volgende regels toe te voegen aan
	<filename>/etc/devfs.rules</filename>:</para>

      <programlisting>[localrules=5]
add path 'da*' mode 0660 group operator</programlisting>

      <note>
	<para>Als er SCSI schijven in het systeem aanwezig zijn moet dit
	  anders aangepakt worden.  Stel dat het systeem reeds over de
	  volgende schijven beschikt <filename>da0</filename> tot
	  en met <filename>da2</filename>, verander de regel dan
	  in het volgende:</para>

	<programlisting>add path 'da[3-9]*' mode 0660 group operator</programlisting>

	<para>Dit sluit de reeds bestaande schijven buiten van toegang
	  door de operator groep.</para>
      </note>

      <para>Erna moet ook de nieuwe ruleset voor &man.devfs.rules.5;
	ingeschakeld worden door middel van
	<filename>/etc/rc.conf</filename>:</para>

      <programlisting>devfs_system_ruleset="localrules"</programlisting>

      <para>Hierna moet de kernel worden geconfigureerd zodat gewone
	gebruikers rechten krijgen om bestandssystemen te koppelen.
	De makkelijkste manier is door de volgende regel toe te voegen
	aan <filename>/etc/sysctl.conf</filename>:</para>

      <programlisting>vfs.usermount=1</programlisting>

      <para>Let op, deze wijziging wordt pas actief na de volgende
	start van het systeem.  Als alternatief kan ook &man.sysctl.8;
	gebruikt worden om deze variabele te zetten.</para>

      <para>De laatste stap is het creëeren van de map waar het
	bestandssysteem gekoppeld wordt.  Deze map moet eigendom zijn
	van de gebruiker die het bestandssysteem gaat koppelen.  Een
	manier om dat te bewerkstelligen is door met de gebruiker
	<systemitem class="username">root</systemitem> een submap aan te maken die eigendom
	is van de gebruiker als
	<filename>/mntgebruikersnaam</filename>
	(verander <replaceable>gebruikersnaam</replaceable> door de
	loginnaam van de daadwerkelijke gebruiker en
	<replaceable>gebruikersgroep</replaceable> door de primaire
	groep van de gebruiker):</para>

      <screen>&prompt.root; <userinput>mkdir /mnt/gebruikersnaam</userinput>
&prompt.root; <userinput>chown gebruikersnaam:gebruikersgroep /mnt/gebruikersnaam</userinput></screen>

      <para>Stel dat er vervolgens een USB-stick ingeplugged wordt en er
	een <filename>/dev/da0s1</filename> aangemaakt wordt.  Omdat
	deze apparaten meestal voorgeformatteerd met een
	FAT-bestandssysteem komen, kan deze als volgende gekoppeld
	worden:</para>

      <screen>&prompt.user; <userinput>mount -t msdosfs -o -m=644,-M=755 /dev/da0s1 /mnt/gebruikersnaam</userinput></screen>

      <para>Indien het apparaat losgekoppeld wordt (nadat de schijf
	afgekoppeld is), dient in de buffer voor systeemmeldingen iets
	als het volgende te zien te zijn:</para>

      <screen>umass0: at uhub0 port 1 (addr2) disconnected
(da0:umass-sim0:0:0:0): lost device
(da0:umass-sim0:0:0:0): removing device entry
GEOM: destroy disk da0 dp=0xc2d74850
umass0: detached</screen>
    </sect2>

    <sect2>
      <title>Referenties</title>

      <para>Naast de onderdelen <link linkend="disks-adding">Schijven
	  toevoegen</link> en <link linkend="mount-unmount">Bestandssystemen aan- en
	  afkoppelen</link>, kunnen de volgende hulppagina's ook nuttig
	zijn: &man.umass.4;, &man.camcontrol.8; en &man.usbconfig.8; voor
	&os;&nbsp;8.X of &man.usbdevs.8; voor eerdere versies van &os;.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="creating-cds">
    <info><title>Optische media (CD's) aanmaken en gebruiken</title>
      <authorgroup>
	<author><personname><firstname>Mike</firstname><surname>Meyer</surname></personname><contrib>Bijgedragen door </contrib></author>
      </authorgroup>
      
    </info>

    

    <indexterm>
      <primary>CD-ROM's</primary>

      <secondary>aanmaken</secondary>
    </indexterm>

    <sect2>
      <title>Inleiding</title>

      <para>CD's hebben een aantal eigenschappen waardoor ze
	verschillen van conventionele schijven.  Initieel zijn ze door
	de gebruiker niet beschrijfbaar.  Ze zijn zó ontworpen
	dat ze continu, zonder vertragingen van het verplaatsen van de
	kop tussen tracks, gelezen kunnen worden.  Ze zijn ook veel
	gemakkelijker tussen twee systemen te verplaatsen dan
	gelijksoortige media in hun tijd waren.</para>

      <para>CD's hebben tracks, maar die verwijzen naar secties van
	gegevens die continu gelezen dienen te worden en niet naar
	fysieke eigenschappen van de schijf.  Om een CD op &os; te
	produceren, dienen de gegevensbestanden waaruit de tracks op de
	CD gaan bestaan te worden voorbereid, waarna de tracks op de CD
	worden geschreven.</para>

      <indexterm><primary>ISO 9660</primary></indexterm>

      <indexterm>
	<primary>bestandssystemen</primary>

	<secondary>ISO 9660</secondary>
      </indexterm>

      <para>Het bestandssysteem ISO 9660 is ontworpen om met deze
	verschillen om te gaan.  Helaas codeert het
	bestandssysteemgrenzen die destijds gebruikelijk waren.
	Gelukkig biedt het een uitbreidingsmechanisme dat correct
	geschreven CD's toestaat om deze grenzen te overschrijden en
	nog steeds te werken met systemen die deze uitbreidingen niet
	ondersteunen.</para>

      <indexterm><primary><package>sysutils/cdrtools</package></primary></indexterm>

      <para>De port <package>sysutils/cdrtools</package> bevat
	&man.mkisofs.8;, een programma dat gebruikt kan worden om een
	gegevensbestand aan te maken dat een ISO 9660-bestandssysteem
	bevat.  Het bevat opties die verschillende uitbreidingen
	ondersteunen en wordt hieronder beschreven.</para>

      <indexterm>
	<primary>CD-brander</primary>

	<secondary>ATAPI</secondary>
      </indexterm>

      <para>Het gereedschap om de CD te branden hangt af van het feit
	of de CD-brander ATAPI of iets anders is.  ATAPI CD-branders
	gebruiken het programma <command>burncd</command> dat deel uitmaakt
	van het basissysteem.  SCSI en USB CD-branders dienen
	<command>cdrecord</command> van
	de port <package>sysutils/cdrtools</package>
	te gebruiken.  Het is ook mogelijk om <command>cdrecord</command> en andere
	gereedschappen voor SCSI-drives op ATAPI-hardware te
	gebruiken door middel van de <link linkend="atapicam">module ATAPI/CAM</link>.</para>

      <para>Indien CD-brandsoftware met een grafische
	gebruikersinterface gewenst is, is
	<application>X-CD-Roast</application> of <application>K3b
	</application> een mogelijkheid.  Deze gereedschappen zijn
	beschikbaar als package of vanuit de ports <package>sysutils/xcdroast</package> en <package>sysutils/k3b</package>.
	<application>X-CD-Roast</application> en
	<application>K3b</application> hebben de <link linkend="atapicam">module ATAPI/CAM</link> met
	ATAPI-hardware nodig.</para>
    </sect2>

    <sect2 xml:id="mkisofs">
      <title><application>mkisofs</application></title>

      <para>Het programma &man.mkisofs.8;, dat deel uitmaakt van de
	port <package>sysutils/cdrtools</package>,
	maakt een ISO 9660-bestandssysteem aan dat een beeld is van een
	boomstructuur in de &unix; bestandssysteem-namespace.  De
	eenvoudigste gebruiksvorm is:</para>

      <screen>&prompt.root; <userinput>mkisofs -o beeldbestand.iso /pad/naar/boomstructuur</userinput></screen>

      <indexterm>
	<primary>bestandssystemen</primary>

	<secondary>ISO 9660</secondary>
      </indexterm>

      <para>Dit commando maakt een
	<replaceable>beeldbestand.iso</replaceable> aan dat een ISO
	9660-bestandssysteem bevat dat een kopie is van de
	boomstructuur in
	<replaceable>/pad/naar/boomstructuur</replaceable>.  Tijdens
	het proces beeldt het bestandsnamen af op namen die aan de
	beperkingen van het standaard ISO 9660-bestandssysteem voldoen
	en sluit het bestanden uit die namen hebben die niet
	karakteristiek zijn voor ISO-bestandssystemen.</para>

      <indexterm>
	<primary>bestandssystemen</primary>

	<secondary>HFS</secondary>
      </indexterm>

      <indexterm>
	<primary>bestandssystemen</primary>

	<secondary>Joliet</secondary>
      </indexterm>

      <para>Er is een aantal opties beschikbaar om over deze
	beperkingen heen te komen.  In het bijzonder zet
	<option>-R</option> de Rock Ridge-uitbreidingen aan die
	gangbaar zijn voor &unix; systemen, zet <option>-J</option> de
	Rock Ridge-uitbreidingen aan die gebruikt worden op
	Microsoft-systemen en <option>-hfs</option> kan gebruikt worden
	om HFS-bestandssystemen aan te maken die door &macos; gebruikt
	worden.</para>

      <para>Voor CD's die alleen op &os;-systemen gebruikt gaan worden,
	kan <option>-U</option> gebruikt worden om alle restricties op
	bestandsnamen uit te zetten.  Indien het met
	<option>-R</option> gebruikt wordt, maakt het een
	bestandssysteembeeld aan dat identiek is aan de
	&os;-boomstructuur van waaruit begonnen is, alhoewel het
	mogelijk is dat het zich op aantal manieren niet aan de
	ISO 9660-standaard houdt.</para>

      <indexterm>
	<primary>CD-ROM's</primary>

	<secondary>opstartbaar maken</secondary>
      </indexterm>

      <para>De laatste optie voor algemeen gebruik is
	<option>-b</option>.  Deze wordt gebruikt om de plaats van het
	opstartbeeld aan te geven om een <quote>El Torito</quote>
	opstartbare CD te maken.  Deze optie heeft een argument nodig,
	namelijk het pad naar een opstartbeeld dat het begin van de
	boomstructuur die naar de CD geschreven wordt voorstelt.
	Gewoonlijk maakt &man.mkisofs.8; een ISO-beeld aan in de
	zogenaamde <quote>diskette-emulatie</quote>-modus en verwacht
	het dus dat het beeldbestand exact 1200, 1440 of 2880&nbsp;KB
	groot is.  Sommige bootloaders, zoals degene die door de
	distributieschijven van &os; wordt gebruikt, gebruiken de
	emulatiemodus niet.  In dat geval dient de optie
	<option>-no-emul-boot</option> gebruikt te worden.  Dus indien
	<filename>/tmp/myboot</filename> een opstartbaar &os;-systeem
	met het beeldbestand in
	<filename>/tmp/myboot/boot/cdboot</filename> bevat, kan het
	beeld van een ISO 9660-bestandssysteem als volgt in
	<filename>/tmp/bootable.iso</filename> aangemaakt
	worden:</para>

      <screen>&prompt.root; <userinput>mkisofs -R -no-emul-boot -b boot/cdboot -o /tmp/bootable.iso /tmp/myboot</userinput></screen>

      <para>Als dit gedaan is en <filename>md</filename> in de
	kernel is ingesteld, kan het bestandssysteem gekoppeld
	worden:</para>

      <screen>&prompt.root; <userinput>mdconfig -a -t vnode -f /tmp/bootable.iso -u 0</userinput>
&prompt.root; <userinput>mount -t cd9660 /dev/md0 /mnt</userinput></screen>

      <para>Nu kan gecontroleerd worden of <filename>/mnt</filename> en
	<filename>/tmp/myboot</filename> identiek zijn.</para>

      <para>Er zijn vele andere opties die met &man.mkisofs.8; gebruikt
	kunnen worden om het gedrag af te stemmen.  In het bijzonder
	wijzigingen aan een ISO 9660-structuur en het aanmaken van
	Joliet- en HFS-schijven.  Details staan in
	&man.mkisofs.8;.</para>
    </sect2>

    <sect2 xml:id="burncd">
      <title><application>burncd</application></title>

      <indexterm>
	<primary>CD-ROM's</primary>

	<secondary>branden</secondary>
      </indexterm>

      <para>Indien er een ATAPI CD-brander aanwezig is, kan het
	commando <command>burncd</command> gebruikt worden om een
	ISO-beeld naar een CD te branden.  <command>burncd</command>
	maakt deel uit van het basissysteem en is geïnstalleerd
	als <filename>/usr/sbin/burncd</filename>.  Het gebruik is erg
	eenvoudig, aangezien het weinig opties heeft.</para>

      <screen>&prompt.root; <userinput>burncd -f cd-apparaat gegevens beeldbestand.iso fixate</userinput></screen>

      <para>Het bovenstaande commando brandt een kopie van
	<replaceable>beeldbestand.iso</replaceable> naar
	<replaceable>cd-apparaat</replaceable>.  Het standaardapparaat
	is <filename>/dev/acd0</filename>.  Opties om
	de schrijfsnelheid in te stellen, de CD na het branden uit
	te werpen en geluidsgegevens te schrijven staan in
	&man.burncd.8;.</para>
    </sect2>

    <sect2 xml:id="cdrecord">
      <title><application>cdrecord</application></title>

      <para>Indien er geen ATAPI CD-brander aanwezig is, dient
	<command>cdrecord</command> gebruikt te worden om CD's te
	branden.  <command>cdrecord</command> maakt geen deel uit van
	het basissysteem.  Het dient òfwel vanuit de port in
	<package>sysutils/cdrtools</package>
	òfwel als package geïnstalleerd te worden.
	Veranderingen in het basissysteem kunnen ervoor zorgen dat
	binaire versies van dit programma falen, wat mogelijk tot een
	<quote>coaster</quote> leidt.  Daarom dient òfwel de
	port bijgewerkt te worden als het systeem wordt bijgewerkt,
	òwel, als <link linkend="stable">-STABLE gevolgd</link>
	wordt, dient de port bijgewerkt te worden wanneer er een nieuwe
	versie beschikbaar komt.</para>

      <para>Hoewel <command>cdrecord</command> vele opties heeft, is
	het gebruik voor gewone situaties nog eenvoudiger dan dat van
	<command>burncd</command>.  Een ISO 9660-beeld kan gebrand
	worden met:</para>

      <screen>&prompt.root; <userinput>cdrecord dev=device beeldbestand.iso</userinput></screen>

      <para>Het lastige gedeelte in het gebruik van
	<command>cdrecord</command> is het vinden van de juiste
	<option>dev</option>.  Om de juiste instelling te vinden, kan
	de vlag <option>-scanbus</option> van
	<command>cdrecord</command> gebruikt worden, wat resultaten
	zoals de onderstaande kan geven:</para>

      <indexterm>
	<primary>CD-ROM's</primary>

	<secondary>branden</secondary>
      </indexterm>

      <screen>&prompt.root; <userinput>cdrecord -scanbus</userinput>
Cdrecord-Clone  2.01 (i386-unknown-freebsd7.0) Copyright (C) 1995-2004 Jörg Schilling
Using libscg version 'schily-0.1'
scsibus0:
        0,0,0     0) 'SEAGATE ' 'ST39236LW       ' '0004' Disk
        0,1,0     1) 'SEAGATE ' 'ST39173W        ' '5958' Disk
        0,2,0     2) *
        0,3,0     3) 'iomega  ' 'jaz 1GB         ' 'J.86' Removable Disk
        0,4,0     4) 'NEC     ' 'CD-ROM DRIVE:466' '1.26' Removable CD-ROM
        0,5,0     5) *
        0,6,0     6) *
        0,7,0     7) *
scsibus1:
        1,0,0   100) *
        1,1,0   101) *
        1,2,0   102) *
        1,3,0   103) *
        1,4,0   104) *
        1,5,0   105) 'YAMAHA  ' 'CRW4260         ' '1.0q' Removable CD-ROM
        1,6,0   106) 'ARTEC   ' 'AM12S           ' '1.06' Scanner
        1,7,0   107) *</screen>

      <para>Dit geeft de gepaste <option>dev</option>-waarden voor de
	apparaten in de lijst.  De CD-brander dient gezocht te worden,
	waarna de drie getallen gescheiden door komma's gebruikt kunnen
	worden als de waarde voor <option>dev</option>.  In dit geval
	is het CD-RW-apparaat 1,5,0, dus is de juiste invoer
	<option>dev=1,5,0</option>.  Er zijn eenvoudigere manieren om
	deze waarde te specificeren.  In &man.cdrecord.1; staan meer
	details.  Hier staat ook informatie over geluidstracks, de
	snelheid instellen en meer.</para>
    </sect2>

    <sect2 xml:id="duplicating-audiocds">
      <title>Audio-CD's dupliceren</title>

      <para>Een audio-CD kan gedupliceerd worden door de
	geluidsgegevens van de CD naar een serie bestanden te
	schrijven en deze bestanden daarna naar een lege CD te
	schrijven.  Het proces verschilt licht tussen ATAPI- en
	SCSI-drives.</para>

      <procedure>
	<title>SCSI-drives</title>

	<step>
	  <para>Onttrek <command>cdda2wav</command> de audio:</para>

	  <screen>&prompt.user; <userinput>cdda2wav -vall -D2,0 -B -Owav</userinput></screen>
	</step>

	<step>
	  <para>Schrijf met <command>cdrecord</command> de
	    <filename>.wav</filename>-bestanden:</para>

	  <screen>&prompt.user; <userinput>cdrecord -v dev=2,0 -dao -useinfo *.wav</userinput></screen>

	  <para>Controleer of <replaceable>2,0</replaceable> juist is
	    opgegeven, zoals beschreven in <xref linkend="cdrecord"/>.</para>
	</step>
      </procedure>

      <procedure>
	<title>ATAPI-drives</title>

	<note>
	  <para>Met behulp van de <link linkend="atapicam">ATAPI/CAM module</link> kan
	    <command>cdda2wav</command> ook gebruikt worden voor ATAPI-drives.
	    Dit gereedschap is vaak een betere keuze voor de meeste gebruikers
	    (jitter-correctie, endianness-zaken, etc.) dan de methode die
	    hieronder wordt voorgesteld.</para>
	</note>

	<step>
	  <para>Het ATAPI CD-stuurprogramma maakt elke track
	    beschikbaar als
	    <filename>/dev/acddtnn</filename>,
	    waarin <replaceable>d</replaceable> het stationsnummer is
	    en <replaceable>nn</replaceable> het tracknummer is in twee
	    decimale cijfers, dat indien nodig vooraf wordt gegaan door
	    een nul.  Dus is de eerste track op de eerste schijf
	    <filename>/dev/acd0t01</filename>, de tweede
	    <filename>/dev/acd0t02</filename>, de derde
	    <filename>/dev/acd0t03</filename>, enzovoort.</para>

	  <para>Controleer of de juiste bestanden in
	    <filename>/dev</filename> bestaan.  Als de benodigde
	    namen er niet bijstaan, forceer het systeem dan om opnieuw
	    te kijken:</para>

	  <screen>&prompt.root; <userinput>dd if=/dev/acd0 of=/dev/null count=1</userinput></screen>
	</step>

	<step>
	  <para>De track kan met &man.dd.1; onttrokken worden.  Bij het
	    onttrekken van de bestanden dient een specifieke
	    blokgrootte gebruikt te worden.</para>

	  <screen>&prompt.root; <userinput>dd if=/dev/acd0t01 of=track1.cdr bs=2352</userinput>
&prompt.root;<userinput>dd if=/dev/acd0t02 of=track2.cdr bs=2352</userinput>
...</screen>
	</step>

	<step>
	  <para>Brand de onttrokken bestanden met
	    <command>burncd</command>.  Er dient opgegeven te worden
	    dat het geluidsbestanden zijn en dat
	    <command>burncd</command> de schijf moet fixeren wanneer
	    na afronding van het proces.</para>

	  <screen>&prompt.root; <userinput>burncd -f /dev/acd0 audio track1.cdr track2.cdr ... fixate</userinput></screen>
	</step>
      </procedure>
    </sect2>

    <sect2 xml:id="imaging-cd">
      <title>Gegevens-CD's dupliceren</title>

      <para>Een gegevens-CD kan gekopieerd worden naar een beeldbestand
	dat functioneel gelijk is aan het beeldbestand dat met
	&man.mkisofs.8; gemaakt is en het kan gebruikt worden om elke
	gegevens-CD te dupliceren.  Het hier gegeven voorbeeld neemt
	aan dat het CD-ROM-apparaat <filename>acd0</filename>
	is.</para>

      <screen>&prompt.root; <userinput>dd if=/dev/acd0 of=bestand.iso bs=2048</userinput></screen>

      <para>Nu het beeld beschikbaar is, kan het naar CD geschreven
	worden zoals hierboven beschreven.</para>
    </sect2>

    <sect2 xml:id="mounting-cd">
      <title>Gegevens-CD's gebruiken</title>

      <para>Nu er een standaard gegevens-CD-ROM is aangemaakt moet deze
	waarschijnlijk aangekoppeld worden om de gegevens die er op
	staan te lezen.  Normaalgesproken neemt &man.mount.8; aan dat
	een bestandssysteem van het soort <literal>ufs</literal> is.
	Als zoiets als onderstaande geprobeerd wordt komt er een klacht
	over <errorname>Incorrect super block</errorname> en wordt er
	niet aangekoppeld:</para>

      <screen>&prompt.root; <userinput>mount /dev/cd0 /mnt</userinput></screen>

      <para>De CD-ROM bevat geen
	<literal>UFS</literal>-bestandssysteem, dus pogingen om zo aan
	te koppelen mislukken.  Er dient aan &man.mount.8; verteld te
	worden dat het bestandssysteem van het soort
	<literal>ISO9660</literal> is en dan werkt alles.  Dit kan
	door de optie <option>-t cd9660</option> van &man.mount.8; op
	te geven.  Het CD-ROM-apparaat <filename>/dev/cd0</filename>
	onder <filename>/mnt</filename> aankoppelen kan zo:</para>

      <screen>&prompt.root; <userinput>mount -t cd9660 /dev/cd0 /mnt</userinput></screen>

      <para>De apparaatnaam (in dit voorbeeld
	<filename>/dev/cd0</filename>) kan afwijken, afhankelijk van de
	interface die de CD-ROM gebruikt.  Verder voert de optie
	<option>-t cd9660</option> gewoon &man.mount.cd9660.8; uit.
	Bovenstaand voorbeeld kan verkort worden tot:</para>

      <screen>&prompt.root; <userinput>mount_cd9660 /dev/cd0 /mnt</userinput></screen>

      <para>Het is in het algemeen mogelijk om gegevens-CD-ROMs van
	elke fabrikant op deze manier te gebruiken.  Schijven met
	bepaalde uitbreidingen op ISO 9660 kunnen zich echter vreemd
	gedragen.  Joliet-schijven bijvoorbeeld, slaan alle
	bestandsnamen op in twee-byte Unicode-karakters.  De
	&os;-kernel spreekt geen Unicode, maar het &os; CD9660
	stuurprogramma is in staat om Unicode karakters direct te
	converteren.  Als er niet-Engelse karakters verschijnen als
	vraagtekens, moet de lokale karakterset gedefinieerd worden
	met de <option>-C</option> optie.  Zie de &man.mount.cd9660.8;
	handleiding voor meer informatie.</para>

      <note>
	<para>Om in staat te zijn om de karakter conversie te doen met
	  behulp van de <option>-C</option> optie, heeft de kernel de
	  <filename>cd9660_iconv.ko</filename> module nodig.  Deze kan
	  ingeladen worden door het volgende toe te voegen aan
	  <filename>/boot/loader.conf</filename>:</para>

	<programlisting>cd9660_iconv_load="YES"</programlisting>

	<para>en daarna de machine te herstarten of door de module direct
	  in te laden met &man.kldload.8;.</para>
      </note>

      <para>Zo nu en dan kan <errorname>Device not
	  configured</errorname> verschijnen als geprobeerd wordt om een
	CD-ROM aan te koppelen.  Dit betekent meestal dat het
	CD-ROM-station denkt dat er geen schijf in de lade ligt of dat
	het station niet zichtbaar is op de bus.  Omdat het enkele
	seconden kan duren voordat een CD-ROM-station doorheeft dat er
	een CD-ROM in ligt, is geduld geboden.</para>

      <para>Soms wordt een SCSI CD-ROM gemist omdat het station niet
	genoeg tijd had om antwoord te geven op de busreset.  Indien er
	een SCSI CD-ROM aanwezig is, dient de volgende optie aan de
	kernelinstellingen toegevoegd te worden en de <link linkend="kernelconfig-building">kernel opnieuw gebouwd</link>
	te worden.</para>

      <programlisting>options SCSI_DELAY=15000</programlisting>

      <para>Dit zorgt ervoor dat de SCSI-bus 15 seconden pauzeert
	tijdens het opstarten opdat het CD-ROM-station elke gelegenheid
	krijgt om de busreset te beantwoorden.</para>
    </sect2>

    <sect2 xml:id="rawdata-cd">
      <title>Rauwe gegevens-CD's branden</title>

      <para>Een bestand kan direct naar CD geschreven worden zonder een
	ISO 9660-bestandssysteem aan te maken.  Sommige mensen doen dit
	voor back-updoeleinden.  Dit gaat sneller dan een standaard-CD
	branden:</para>

      <screen>&prompt.root; <userinput>burncd -f /dev/acd1 -s 12 gegevens archief.tar.gz fixate</userinput></screen>

      <para>Om de gegevens terug te halen die op zo'n CD gebrand zijn,
	is het noodzakelijk om gegevens van de rauwe apparaatnode te
	lezen:</para>

      <screen>&prompt.root; <userinput>tar xzvf /dev/acd1</userinput></screen>

      <para>Het is niet mogelijk om deze schijf aan te koppelen zoals
	dat voor een normale CD-ROM gedaan wordt.  Zo'n CD-ROM kan onder
	geen enkel besturingssysteem, behalve &os;, gelezen worden.
	Om de CD aan te kunnen koppelen of gegevens te delen met een
	ander besturingssysteem, dient &man.mkisofs.8; gebruikt te
	worden, zoals boven beschreven is.</para>
    </sect2>

    <sect2 xml:id="atapicam">
      <info><title>Het ATAPI/CAM-stuurprogramma gebruiken</title>
	<authorgroup>
	  <author><personname><firstname>Marc</firstname><surname>Fonvieille</surname></personname><contrib>Bijgedragen door </contrib></author>
	</authorgroup>
      </info>

      

      <indexterm>
	<primary>CD-brander</primary>

	<secondary>ATAPI/CAM-stuurprogramma</secondary>
      </indexterm>

      <para>Dit stuurprogramma stelt ATAPI-apparaten (CD-ROM, CD-RW,
	DVD-stations, enzovoort) in staat om vanuit het SCSI-subsysteem
	benaderd te worden en maakt daarmee het gebruik van applicaties
	zoals <package>sysutils/cdrdao</package> of
	&man.cdrecord.1; mogelijk.</para>

      <para>Om dit stuurprogramma te gebruiken, is het noodzakelijk om
	de volgende regel aan het <filename>/boot/loader.conf</filename>
	bestand toe te voegen:</para>

      <programlisting>atapicam_load="YES"</programlisting>

      <para>om daarna de machine opnieuw op te starten.</para>

      <note>
	<para>Als het noodzakelijk is om &man.atapicam.4; statisch toe
	  te voegen aan de kernel moet de volgende regel worden
	  toegevoegd aan het kernelinstellingenbestand:</para>

	<programlisting>device atapicam</programlisting>

	<para>Ook zijn de volgende regels in het
	  kernelinstellingenbestand nodig, die meestal wel aanwezig
	  zijn:</para>

	<programlisting>device ata
device scbus
device cd
device pass</programlisting>

	<para>Hierna dient de nieuwe kernel opnieuw gebouwd en
	  geïnstalleerd te worden en dient de machine opnieuw
	  gestart te worden.</para>
      </note>

      <para>Tijdens het opstartproces dient de brander
	als volgt te verschijnen:</para>

      <screen>acd0: CD-RW &lt;MATSHITA CD-RW/DVD-ROM UJDA740&gt; at ata1-master PIO4
cd0 at ata1 bus 0 target 0 lun 0
cd0: &lt;MATSHITA CD-RW/DVD UJDA740 1.00&gt; Removable CD-ROM SCSI-0 device
cd0: 16.000MB/s transfers
cd0: Attempt to query device size failed: NOT READY, Medium not present - tray closed</screen>

      <para>Het station is nu toegankelijk via de apparaatnaam
	<filename>/dev/cd0</filename>.  Om bijvoorbeeld een CD-ROM op
	<filename>/mnt</filename> aan te koppelen:</para>

      <screen>&prompt.root; <userinput>mount -t cd9660 /dev/cd0 /mnt</userinput></screen>

      <para>Als <systemitem class="username">root</systemitem> kan het volgende commando
	gegeven worden om het SCSI-adres van de brander te
	verkrijgen:</para>

      <screen>&prompt.root; <userinput>camcontrol devlist</userinput>
&lt;MATSHITA CD-RW/DVD UJDA740 1.00&gt; at scbus1 target 0 lun 0 (pass0,cd0)</screen>

      <para>Dus <literal>1,0,0</literal> is het SCSI-adres dat met
	&man.cdrecord.1; en andere SCSI-toepassingen gebruikt dient te
	worden.</para>

      <para>Meer informatie over het ATAPI/CAM en het SCSI-systeem
	staat in de hulppagina's van &man.atapicam.4; en
	&man.cam.4;.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="creating-dvds">
    <info><title>Optische media (DVD's) aanmaken en gebruiken</title>
      <authorgroup>
	<author><personname><firstname>Marc</firstname><surname>Fonvieille</surname></personname><contrib>Bijgedragen door </contrib></author>
      </authorgroup>

      <authorgroup>
	<author><personname><firstname>Andy</firstname><surname>Polyakov</surname></personname><contrib>Met toevoegingen van </contrib></author>
      </authorgroup>
      
    </info>

    

    <indexterm>
      <primary>DVD</primary>

      <secondary>branden</secondary>
    </indexterm>

    <sect2>
      <title>Inleiding</title>

      <para>Vergeleken met de CD behoort de DVD de tot de volgende
	generatie van optische media-opslagtechnologie.  De DVD kan
	meer gegevens bevatten dan enige CD en is tegenwoordig de
	standaard voor videopublicatie.</para>

      <para>Er kunnen vijf fysieke opneembare formaten gedefinieerd
	worden die opneembare DVD heten:</para>

      <itemizedlist>
	<listitem>
	  <para>DVD-R: dit was het eerst beschikbare opneembare
	    DVD-formaat.  De DVD-R-standaard is gedefinieerd door het
	    <link xlink:href="http://www.dvdforum.com/forum.shtml">DVD
	      Forum</link>.  Dit formaat is voor eenmalig
	    schrijven.</para>
	</listitem>

	<listitem>
	  <para>DVD-RW: dit is de herschrijfbare versie van de
	    DVD-R-standaard.  Een DVD-RW kan tot ongeveer 1.000 maal
	    herschreven worden.</para>
	</listitem>

	<listitem>
	  <para>DVD-RAM: dit is ook een herschrijfbaar formaat dat
	    door het DVD Forum ondersteund wordt.  Een DVD-RAM kan
	    gezien worden als een verwisselbare harde schijf.  Dit
	    medium is echter niet uitwisselbaar met de meeste
	    DVD-ROM-stations en DVD-Video-spelers.  Slechts enkele
	    DVD-schrijvers ondersteunen het DVD-RAM-formaat.  Lees
	    <xref linkend="creating-dvd-ram"/> voor meer informatie
	    over het gebruik van DVD-RAM.</para>
	</listitem>

	<listitem>
	  <para>DVD+RW: dit is het herschrijfbare formaat dat is
	    gedefinieerd door de <link xlink:href="http://www.dvdrw.com/">DVD+RW Alliance</link>.  Een
	    DVD+RW kan tot ongeveer 1.000 maal herschreven
	    worden.</para>
	</listitem>

	<listitem>
	  <para>DVD+R: dit formaat is de eenmalig beschrijfbare versie
	    van het DVD+RW-formaat.</para>
	</listitem>
      </itemizedlist>

      <para>Een enkellaags opneembare DVD kan maximaal
	4.700.000.000&nbsp;bytes bevatten, wat eigenlijk 4,38&nbsp;GB
	of 4.485&nbsp;MB is (1&nbsp;kB is 1024 bytes).</para>

      <note>
	<para>Er dient onderscheid gemaakt te worden tussen het fysieke
	  medium en de toepassing.  Een DVD-Video bijvoorbeeld is een
	  specifiek bestandsschema dat op elk fysiek opneembaar
	  DVD-medium geschreven kan worden: DVD-R, DVD+R, DVD-RW,
	  enzovoort.  Voordat het mediumtype gekozen wordt, dient het
	  zeker te zijn dat zowel de brander als de DVD-Video-speler
	  (een onafhankelijke speler of een DVD-ROM-station in een
	  computer) overweg kunnen met het overwogen medium.</para>
      </note>
    </sect2>

    <sect2>
      <title>Instellingen</title>

      <para>Het programma &man.growisofs.1; wordt gebruikt om DVD's op
	te nemen.  Dit commando is deel van de
	<application>dvd+rw-tools</application> gereedschappen
	(<package>sysutils/dvd+rw-tools</package>).
	<application>dvd+rw-tools</application> ondersteunt alle types
	DVD-media.</para>

      <para>Deze gereedschappen gebruiken het SCSI-subsysteem om
	toegang tot de apparaten te krijgen, daarvoor moet <link linkend="atapicam">ondersteuning voor ATAPI/CAM</link> aan de
	kernel toegevoegd worden.  Indien de brander de USB-interface
	gebruikt, is deze toevoeging nutteloos en dient <xref linkend="usb-disks"/> gelezen te worden voor meer details over
	het instellen van USB-apparaten.</para>

      <para>De DMA-toegang voor ATAPI-apparaten dient ook aangezet te
	worden door de volgende regel aan het bestand
	<filename>/boot/loader.conf</filename> toe te voegen:</para>

      <programlisting>hw.ata.atapi_dma="1"</programlisting>

      <para>Voordat de <application>dvd+rw-tools</application> gebruikt
	kunnen worden, dienen de <link xlink:href="http://fy.chalmers.se/~appro/linux/DVD+RW/hcn.html">
	  dvd+rw-tools' hardware compatibility notes</link>
	geraadpleegd te worden voor enige informatie die betrekking
	heeft op de DVD-brander.</para>

      <note>
	<para>Indien een grafische gebruikersinterface gewenst is, is
	  <application>K3b</application> (<package>sysutils/k3b</package>), die een
	  gebruikersvriendelijke interface biedt voor &man.growisofs.1;
	  en vele andere brandprogramma's, het bekijken waard.</para>
      </note>
    </sect2>

    <sect2>
      <title>Gegevens-DVD's branden</title>

      <para>Het commando &man.growisofs.1; is een frontend voor <link linkend="mkisofs">mkisofs</link>.  Het roept &man.mkisofs.8;
	aan om het bestandssysteemoverzicht aan te maken en het
	schrijft naar de DVD.  Hierdoor is het niet nodig om een beeld
	van de gegevens aan te maken voordat met branden begonnen
	wordt.</para>

      <para>Om de gegevens uit de map <filename>/pad/naar/gegevens</filename> op een DVD+R
	of een DVD-R te branden:</para>

      <screen>&prompt.root; <userinput>growisofs -dvd-compat -Z /dev/cd0 -J -R /pad/naar/gegevens</userinput></screen>

      <para>De opties <option>-J -R</option> worden doorgegeven aan
	&man.mkisofs.8; voor het aanmaken van het bestandssysteem (in
	dit geval een ISO 9660-bestandssysteem met Joliet en Rock Ridge
	uitbreidingen).  Meer details staan in de hulppagina
	&man.mkisofs.8;.</para>

      <para>De optie <option>-Z</option> wordt gebruikt voor het
	opnemen van de eerste sessie, ook bij meerdere sessies.  Het
	DVD-apparaat, <replaceable>/dev/cd0</replaceable>, dient aan de
	hand van de instellingen aangepast te worden.  De parameter
	<option>-dvd-compat</option> sluit de schijf zodat er niets aan
	de opname toegevoegd kan worden.  Dit zou als tegenprestatie
	betere uitwisselbaarheid met DVD-ROM-stations moeten
	geven.</para>

      <para>Het is ook mogelijk om een vooraf gemastered beeld te
	branden, om bijvoorbeeld het beeld
	<replaceable>beeldbestand.iso</replaceable> te branden:</para>

      <screen>&prompt.root; <userinput>growisofs -dvd-compat -Z /dev/cd0=beeldbestand.iso</userinput></screen>

      <para>De schrijfsnelheid moet automatisch gedetecteerd en
	ingesteld worden, afhankelijk van het medium en het gebruikte
	station.  Om de schrijfsnelheid te forceren, dient de parameter
	<option>-speed=</option> gebruikt te worden.  Meer informatie
	staat in de hulppagina &man.growisofs.1;.</para>

      <note>
	<para>Om bestanden groter dan 4,38GB in de compilatie op te nemen dient
	  een UDF/ISO-9660 hybride bestandssysteem aangemaakt te worden door de
	  aanvullende parameter <option>-udf -iso-level 3</option> aan
	  &man.mkisofs.8; en alle gerelateerde programma's (i.e.,
	  &man.growisofs.1;) door te geven.  Dit is alleen nodig als een ISO
	  beeldbestand wordt aangemaakt, of als bestanden direct naar een schijf
	  worden geschreven.  Schijven die op deze manier zijn aangemaakt moeten
	  als een UDF-bestandssysteem worden aangekoppeld met het hulpmiddel
	  &man.mount.udf.8;, zodat het alleen bruikbaar is op een
	  besturingssysteem dat zich van UDF bewust is, anders zal het lijken of
	  er corrupte bestanden op staan.</para>

	<para>Om zo'n ISO-bestand aan te maken:</para>

	<screen>&prompt.user; <userinput>mkisofs -R -J -udf -iso-level 3 -o beeldbestand.iso /pad/naar/gegevens</userinput></screen>

	<para>Om de bestanden direct naar een schijf te schrijven:</para>

	<screen>&prompt.root; <userinput>growisofs -dvd-compat -udf -iso-level 3 -Z /dev/cd0 -J -R /pad/naar/gegevens</userinput></screen>

	<para>Wanneer u een ISO-beeld heeft dat al grote bestanden bevat, zijn
	  er geen extra opties nodig om met &man.growisofs.1; het beeld naar een
	  schijf te schrijven.</para>

	<para>Zorg er ook voor dat u een actuele versie van <package>sysutils/cdrtools</package> heeft (welke
	  &man.mkisofs.8; bevat), aangezien oudere versies geen ondersteuning
	  voor grote bestanden bieden.  Als u problemen tegenkomt, gebruik dan
	  de ontwikkelversie, <package>sysutils/cdrtools-devel</package> en lees de
	  handleidingpagina &man.mkisofs.8;.</para>
      </note>
    </sect2>

    <sect2>
      <title>DVD-Video branden</title>

      <indexterm>
	<primary>DVD</primary>

	<secondary>DVD-Video</secondary>
      </indexterm>

      <para>Een DVD-Video is een specifiek bestandsschema dat gebaseerd
	is op de ISO 9660 en de micro-UDF (M-UDF) specificaties.
	DVD-Video heeft ook een specifieke hiërarchie voor de
	gegevensstructuur, de reden waarom een speciaal programma zoals
	<package>multimedia/dvdauthor</package> nodig
	is om de DVD te schrijven.</para>

      <para>Indien er reeds een beeld van het bestandssysteem van de
	DVD-Video beschikbaar is, kan het zoals elk ander beeld gebrand
	worden.  In de vorige sectie staat een voorbeeld.  Als het
	resultaat voor de inhoud voor de DVD bijvoorbeeld in de map
	<filename>/pad/naar/video</filename> staat,
	kan de DVD-Video als volgt gebrand worden:</para>

      <screen>&prompt.root; <userinput>growisofs -Z /dev/cd0 -dvd-video /pad/naar/video</userinput></screen>

      <para>De optie <option>-dvd-video</option> wordt doorgegeven aan
	&man.mkisofs.8; en geeft het opdracht om een
	bestandssysteemschema voor een DVD-Video aan te maken.  Verder
	impliceert de optie <option>-dvd-video</option> de optie
	<option>-dvd-compat</option> van &man.growisofs.1;.</para>
    </sect2>

    <sect2>
      <title>DVD+RW gebruiken</title>

      <indexterm>
	<primary>DVD</primary>

	<secondary>DVD+RW</secondary>
      </indexterm>

      <para>In tegenstelling tot een CD-RW dient een nieuwe DVD+RW voor
	het eerste gebruik geformatteerd te worden.  Het programma
	&man.growisofs.1; regelt dit automatisch als nodig.  Dit is de
	<emphasis>aanbevolen</emphasis> manier.  Het is ook mogelijk om
	<command>dvd+rw-format</command> te gebruiken om een DVD+RW te
	formatteren:</para>

      <screen>&prompt.root; <userinput>dvd+rw-format /dev/cd0</userinput></screen>

      <para>Deze operatie hoeft slechts één maal
	uitgevoerd te worden.  Onthoud dat alleen nieuwe DVD+RW-media
	geformatteerd dienen te worden.  Daarna is het mogelijk om de
	DVD+RW op dezelfde manier te branden zoals in bovenstaande
	secties staat vermeldt.</para>

      <para>Om nieuwe gegevens op een DVD+RW te branden (een geheel
	nieuw bestandssysteem branden, niet wat gegevens toevoegen), is
	het niet nodig om deze te wissen.  Het is voldoende om de
	vorige opname te overschrijven (tijdens het aanmaken van een
	initiële sessie), zoals hieronder:</para>

      <screen>&prompt.root; <userinput>growisofs -Z /dev/cd0 -J -R /pad/naar/nieuwe gegevens</userinput></screen>

      <para>Het DVD+RW-formaat biedt de mogelijkheid om eenvoudig
	nieuwe gegevens aan een vorige opname toe te voegen.  De
	operatie bestaat uit het samenvoegen van een nieuwe sessie en
	de bestaande.  Het is geen multisessie-schrijven.
	&man.growisofs.1; laat het ISO 9660-bestandssysteem dat
	aanwezig is op het medium <emphasis>groeien</emphasis>.</para>

      <para>Om gegevens aan de vorige DVD+RW toe te voegen:</para>

      <screen>&prompt.root; <userinput>growisofs -M /dev/cd0 -J -R /pad/naar/volgende gegevens</userinput></screen>

      <para>Dezelfde opties van &man.mkisofs.8; die gebruikt werden om
	de initiële sessie te branden, dienen gebruikt te worden
	tijdens schrijfsessies.</para>

      <note>
	<para>De optie <option>-dvd-compat</option> kan gebruikt worden
	  als betere uitwisselbaarheid met DVD-ROM-stations gewenst is.
	  In het geval van een DVD+RW verhindert dit het toevoegen van
	  gegevens niet.</para>
      </note>

      <para>Om het medium te wissen:</para>

      <screen>&prompt.root; <userinput>growisofs -Z /dev/cd0=/dev/zero</userinput></screen>
    </sect2>

    <sect2>
      <title>DVD-RW gebruiken</title>

      <indexterm>
	<primary>DVD</primary>

	<secondary>DVD-RW</secondary>
      </indexterm>

      <para>Een DVD-RW accepteert twee schijfformaten: de incrementele
	sequentiële en beperkt overschrijven.  Standaard zijn
	DVD-RW-schijven in het sequentiële formaat.</para>

      <para>Een nieuwe DVD-RW kan direct beschreven worden zonder deze
	te formatteren.  Een gebruikte DVD-RW in sequentieel formaat
	dient echter gewist te worden voordat het mogelijk is om een
	nieuwe initiële sessie te schrijven.</para>

      <para>Om een DVD-RW in sequentiële toestand te wissen, dient
	het volgende gedaan te worden:</para>

      <screen>&prompt.root; <userinput>dvd+rw-format -blank=full /dev/cd0</userinput></screen>

      <note>
	<para>Volledig wissen (<option>-blank=full</option>) neemt
	  ongeveer één uur in beslag op een 1x-medium.
	  Het is mogelijk om snel te wissen door gebruik te maken van
	  de optie <option>blank</option> als de DVD-RW in
	  Disk-At-Once-modus (DAO) wordt opgenomen.  Om de DVD-RW in
	  DAO-modus te branden:</para>

	<screen>&prompt.root; <userinput>growisofs -use-the-force-luke=dao -Z /dev/cd0=beeldbestand.iso</userinput></screen>

	<para>De optie <option>-use-the-force-luke=dao</option> is niet
	  nodig aangezien &man.growisofs.1; probeert om minimale (snel
	  gewiste) media te detecteren en gebruik te maken van
	  DAO-schrijven.</para>

	<para>Eigenlijk moet beperkt overschrijven gebruikt worden met
	  elke DVD-RW.  Dit formaat is flexibeler dan het standaard
	  incrementeel sequentiële.</para>
      </note>

      <para>Om gegevens op een sequentiële DVD-RW te schrijven,
	worden dezelfde instructies gebruikt als voor de andere
	DVD-formaten:</para>

      <screen>&prompt.root; <userinput>growisofs -Z /dev/cd0 -J -R /pad/naar/gegevens</userinput></screen>

      <para>Om wat gegevens aan de vorige opname toe te voegen, dient
	de optie <option>-M</option> van &man.growisofs.1; gebruikt te
	worden.  Als echter gegevens aan een DVD-RW in incrementeel
	sequentiële modus worden toegevoegd, wordt een nieuwe
	sessie op de schijf aangemaakt wat resulteert in een
	multisessie schijf.</para>

      <para>Een DVD-RW in het beperkt overschrijven formaat hoeft niet
	gewist te worden vóór een nieuwe initiële
	sessie.  Het is voldoende om de schijf te overschrijven met de
	optie <option>-Z</option>, wat analoog is aan het geval van de
	DVD+RW.  Het is ook mogelijk om een bestaand ISO
	9660-bestandssysteem te laten groeien op soortgelijke wijze als
	voor een DVD+RW met de optie <option>-M</option>.  Het
	resultaat is een enkelsessie DVD.</para>

      <para>Om een DVD-RW in het beperkt overschrijven-formaat te
	zetten:</para>

      <screen>&prompt.root; <userinput>dvd+rw-format /dev/cd0</userinput></screen>

      <para>Om terug te gaan naar het sequentiële formaat:</para>

      <screen>&prompt.root; <userinput>dvd+rw-format -blank=full /dev/cd0</userinput></screen>
    </sect2>

    <sect2>
      <title>Multisessie</title>

      <para>Multisessie DVD's worden door zeer weinig DVD-ROM-stations
	geaccepteerd en meestal lezen ze hopelijk tenminste  de eerste
	sessie.  DVD+R, DVD-R en DVD-RW kunnen in het sequentiële
	formaat meerdere sessies accepteren.  Het idee van meerdere
	sessies bestaat niet voor de formaten DVD+RW en DVD-RW in
	beperkt overschrijven.</para>

      <para>Om een nieuwe sessie achter een initiële
	(niet-gesloten) sessie op een DVD+R, DVD-R of DVD-RW in
	sequentieel formaat toe te voegen:</para>

      <screen>&prompt.root; <userinput>growisofs -M /dev/cd0 -J -R /pad/naar/volgende gegevens</userinput></screen>

      <para>Het gebruik van dit commando met een DVD+RW of een DVD-RW
	in beperkt overschrijven-formaat voegt gegevens toe door de
	nieuwe sessie samen te voegen met de bestaande.  Dit leidt tot
	een enkelsessie schijf.  Deze manier kan gebruikt worden om
	gegevens achter een initiële sessie aan deze media toe te
	voegen.</para>

      <note>
	<para>Op deze media wordt wat ruimte gebruikt tussen elke
	  sessie om het einde en begin van de sessies aan te geven.
	  Daarom dienen sessies met grote hoeveelheden gegevens
	  toegevoegd te worden om de mediaruimte te optimaliseren.  Het
	  aantal sessies is beperkt tot 154 voor een DVD+R, ongeveer
	  2000 voor een DVD-R en 127 voor een dubbellaags DVD+R.</para>
      </note>
    </sect2>

    <sect2>
      <title>Meer informatie</title>

      <para>Om meer informatie over een DVD te verkrijgen kan het
	commando
	<command>dvd+rw-mediainfo /dev/cd0</command>
	met de schijf in het station gebruikt worden.</para>

      <para>Meer informatie over
	<application>dvd+rw-tools</application> staat in de hulppagina
	&man.growisofs.1;, op de <link xlink:href="http://fy.chalmers.se/~appro/linux/DVD+RW/">dvd+rw-tools
	  website</link> en in de archieven van de <link xlink:href="http://lists.debian.org/cdwrite/">cdwrite mailing
	  list</link>.</para>

      <note>
	<para>De uitvoer van <command>dvd+rw-mediainfo</command> met
	  betrekking tot de resulterende opname of het medium met
	  problemen is verplicht voor elk probleemrapport.  Zonder deze
	  uitvoer volgt geen hulp.</para>
      </note>
    </sect2>

    <sect2 xml:id="creating-dvd-ram">
      <title>DVD-RAM gebruiken</title>

      <indexterm>
	<primary>DVD</primary>

	<secondary>DVD-RAM</secondary>
      </indexterm>

      <sect3>
	<title>Configuratie</title>

	<para>DVD-RAM schrijvers komen met of een SCSI of een ATAPI
	  interface.  DMA toegang voor ATAPI apparaten moet worden
	  ingeschakeld, wat gedaan kan worden door de volgende regel
	  toe te voegen aan
	  <filename>/boot/loader.conf</filename>:</para>

	<programlisting>hw.ata.atapi_dma="1"</programlisting>
      </sect3>

      <sect3>
	<title>Voorbereiden van het medium</title>

	<para>Zoals vermeld in de introductie van dit hoofdstuk kan
	  DVD-RAM gezien worden als een verwijderbare harde schijf.
	  Zoals elke andere harde schijf moet de DVD-RAM
	  <quote>voorbereid</quote> worden voor het eerste gebruik.
	  In het voorbeeld wordt alle beschikbare ruimte gebruikt voor
	  een standaard UFS2 bestandssysteem:</para>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=/dev/acd0 bs=2k count=1</userinput>
&prompt.root; <userinput>bsdlabel -Bw acd0</userinput>
&prompt.root; <userinput>newfs /dev/acd0</userinput></screen>

	<para>Het DVD apparaat, <filename>acd0</filename> moet worden
	  gewijzigd naar gelang de configuratie.</para>
      </sect3>

      <sect3>
	<title>Het medium gebruiken</title>

	<para>Zodra de voorgaande operaties uitgevoerd zijn op de DVD-RAM
	  kan het gekoppeld worden net als een normale harde schijf:</para>

	<screen>&prompt.root; <userinput>mount /dev/acd0 /mnt</userinput></screen>

	<para>Hierna zal de DVD-RAM zowel lees- als beschrijfbaar zijn.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="floppies">
    <info><title>Diskettes aanmaken en gebruiken</title>
      <authorgroup>
	<author><personname><firstname>Julio</firstname><surname>Merino</surname></personname><contrib>Origineel werk door </contrib></author>
      </authorgroup>
      
      <authorgroup>
	<author><personname><firstname>Martin</firstname><surname>Karlsson</surname></personname><contrib>Herschreven door </contrib></author>
      </authorgroup>
      
    </info>

    

    <para>Soms is het opslaan van gegevens op een diskette nuttig,
      bijvoorbeeld als er geen andere verwijderbare opslagmedia
      beschikbaar zijn of als kleine hoeveelheden gegevens naar een
      andere computer moeten worden overgedragen.</para>

    <para>In deze sectie wordt beschreven hoe diskettes in &os;
      gebruikt dienen te worden.  Hier worden hoofdzakelijk het
      formatteren en gebruik van 3,5&nbsp;inch DOS-diskettes behandeld,
      maar de concepten zijn vergelijkbaar voor andere
      disketteformaten.</para>

    <sect2>
      <title>Diskettes formatteren</title>

      <sect3>
	<title>Het apparaat</title>

	<para>Diskettes worden benaderd door ingangen in
	  <filename>/dev</filename> net zoals andere apparaten.  Om
	  een rauwe floppy te benaderen gebruikt u
	  <filename>/dev/fdN</filename>.</para>
      </sect3>

      <sect3>
	<title>Formatteren</title>

	<para>Een diskette dient op laag niveau geformatteerd te worden
	  voordat deze kan worden gebruikt.  Dit wordt meestal door de
	  fabrikant gedaan, maar formatteren is een goede manier om de
	  integriteit van het medium te controleren.  Hoewel het
	  mogelijk is om grotere (of kleinere) schijfgroottes te
	  forceren, zijn de meeste diskettes ontworpen voor
	  1440kB.</para>

	<para>Een diskette kan op laag niveau geformatteerd worden met
	  &man.fdformat.1;.  Dit gereedschap verwacht de apparaatnaam
	  als parameter.</para>

	<para>Op basis van eventuele foutmeldingen kan bepaald worden
	  of een schijf goed of slecht is.</para>

	<sect4>
	  <title>Formatteren van floppies</title>

	  <para>Voor het formatteren van de diskette dienen de
	    apparaten
	    <filename>/dev/fdN</filename>
	    gebruikt te worden.  Nadat een 3,5&nbsp;inch diskette in
	    het station is gestoken:</para>

	  <screen>&prompt.root; <userinput>/usr/sbin/fdformat -f 1440 /dev/fd0</userinput></screen>
	</sect4>
      </sect3>
    </sect2>

    <sect2>
      <title>Schijflabels</title>

      <para>Nadat de diskette op laag niveau is geformatteerd, dient er
	schijflabel aan gekoppeld te worden.  Dit schijflabel wordt
	later vernietigd, maar het systeem heeft het nodig om later de
	grootte en de geometrie van de schijf te bepalen.</para>

      <para>Het nieuwe schijflabel neemt de gehele schijf over en bevat
	alle benodigde informatie over de geometrie van de diskette.
	De geometriewaarden van het schijflabel staan vermeld in
	<filename>/etc/disktab</filename>.</para>

      <para>Nu kan &man.bsdlabel.8; als volgt gedraaid worden:</para>

      <screen>&prompt.root; <userinput>/sbin/bsdlabel -B -w /dev/fd0 fd1440</userinput></screen>
    </sect2>

    <sect2>
      <title>Bestandssystemen</title>

      <para>Nu is de diskette klaar om op hoog niveau geformatteerd te
	worden.  Hiermee wordt een nieuw bestandssysteem opgezet, wat
	&os; in staat stelt om naar de schijf te lezen en te schrijven.
	Nadat het nieuwe bestandssysteem is aangemaakt, wordt het
	schijflabel vernietigd, dus om de schijf te herformatteren is
	het noodzakelijk om het schijflabel opnieuw aan te
	maken.</para>

      <para>Het bestandssysteem voor diskettes kan zowel UFS als FAT
	zijn.  FAT is over het algemeen een betere keuze voor
	diskettes.</para>

      <para>Om een nieuw bestandssysteem op de diskettes te
	zetten:</para>

      <screen>&prompt.root; <userinput>/sbin/newfs_msdos /dev/fd0</userinput></screen>

      <para>De schijf is nu klaar voor gebruik.</para>
    </sect2>

    <sect2>
      <title>Diskettes gebruiken</title>

      <para>Om de diskette te gebruiken kan &man.mount.msdosfs.8;
	gebruikt worden om het medium aan te koppelen.  Ook kan
	<package>emulators/mtools</package> uit de
	Portscollectie worden gebruikt.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="backups-tapebackups">
    <title>Gegevensbanden aanmaken en gebruiken</title>

    <indexterm><primary>bandmedia</primary></indexterm>

    <para>Bandtechnologie is zich blijven ontwikkelen maar het is minder
      waarschijnlijk dat het in moderne systemen wordt gebruikt.  Moderne
      back-upsystemen neigen om offsite gecombineerd met technologieën voor
      plaatselijke verwisselbare schijfstations te gebruiken.  &os; zal nog
      steeds elk bandstation dat SCSI gebruikt zoals LTO en oudere apparaten
      zoals DAT ondersteunen.  Er is ook beperkte ondersteuning voor SATA- en
      USB-bandstations.</para>

    <sect2 xml:id="tapes-sa0">
      <title>Seriële toegang met &man.sa.4;</title>

      <indexterm><primary>bandstations</primary></indexterm>

      <para>&os; gebruikt het stuurprogramma &man.sa.4;, dat
	<filename>/dev/sa0</filename>,
	<filename>/dev/nsa0</filename> en
	<filename>/dev/esa0</filename> aanbiedt.  Voor normaal gebruik is
	alleen <filename>/dev/sa0</filename> nodig.
	<filename>/dev/nsa0</filename> is fysiek hetzelfde apparaat als
	<filename>/dev/sa0</filename> maar spoelt de band niet terug nadat
	een bestand is geschreven.  Dit maakt het mogelijk om meer dan één
	bestand naar een band te schrijven.  <filename>/dev/esa0</filename>
	werpt, indien van toepassing, de band uit nadat het apparaat is
	gesloten.</para>
    </sect2>

    <sect2>
      <title xml:id="tapes-mt">Het bandstation met &man.mt.1; beheren</title>

      <indexterm>
	<primary>bandmedia</primary>

	<secondary>mt</secondary>
      </indexterm>

      <para>&man.mt.1; is het hulpmiddel van &os; om andere bewerkingen op het
	bandstation uit te voeren, zoals bestanden op een band doorzoeken of
	controlepunten naar de band schrijven.</para>

      <para>Als voorbeeld kunnen de eerste drie bestanden op een band bewaard
	worden door ze over te slaan voordat een nieuw bestand wordt
	geschreven:</para>

      <screen>&prompt.root; <userinput>mt -f /dev/nsa0 fsf 3</userinput></screen>
    </sect2>

    <sect2>
      <title xml:id="tapes-tar">&man.tar.1; gebruiken om back-ups op banden te
	lezen en schrijven</title>

      <para>&man.tar.1; gebruiken om een enkel bestand naar band te
	schrijven:</para>

      <screen>&prompt.root; <userinput>tar cvf /dev/sa0 bestand</userinput></screen>

      <para>Bestanden vanuit een &man.tar.1;-archief op band naar de huidige
	map herstellen:</para>

      <screen>&prompt.root; <userinput>tar xvf /dev/sa0</userinput></screen>
    </sect2>

    <sect2>
      <title xml:id="tapes-dumprestore">&man.dump.8; en &man.restore.8; gebruiken
	om back-ups aan te maken en te herstellen</title>

      <para>Een eenvoudige back-up van <filename>/usr</filename> maken met &man.dump.8;:</para>

      <screen>&prompt.root; <userinput>dump -0aL -b64 -f /dev/nsa0 /usr</userinput></screen>

      <para>Interactief bestanden van een &man.dump.8;-bestand vanaf band naar
	de huidige map herstellen:</para>

      <screen>&prompt.root; <userinput>restore -i -f /dev/nsa0</userinput></screen>
    </sect2>

    <sect2>
      <title xml:id="tapes-othersoftwware">Andere bandsoftware</title>

      <para>Er zijn programma's op hoger niveau beschikbaar om het back-uppen
	naar banden eenvoudiger te maken.  De populairste zijn
	<application>AMANDA</application> en <application>Bacula</application>.
	Deze programma's hebben als doel om back-uppen eenvoudiger en
	aangenamer te maken, of om complexe back-ups van meerdere machines te
	automatiseren.  De Portscollectie bevat deze beide en andere
	toepassingen om met banden te werken.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="backups-floppybackups">
    <title>Naar diskettes back-uppen</title>

    <sect2 xml:id="floppies-using">
      <title>Kunnen diskettes gebruikt worden om gegevens te
	back-uppen?</title>

      <indexterm><primary>back-updiskettes</primary></indexterm>

      <indexterm><primary>diskettes</primary></indexterm>

      <para>Diskettes zijn niet bepaald een geschikt medium om
	back-ups mee te maken, omdat:</para>

      <itemizedlist>
	<listitem>
	  <para>Het medium onbetrouwbaar is, in het bijzonder op de
	    langere termijn;</para>
	</listitem>

	<listitem>
	  <para>Het back-uppen en terugzetten erg traag is;</para>
	</listitem>

	<listitem>
	  <para>Diskettes een zeer beperkte capaciteit hebben.  De
	    tijden dat een hele harde schijf naar een tiental diskettes
	    kon worden geback-upped zijn allang verstreken.</para>
	</listitem>
      </itemizedlist>

      <para>Maar als er geen andere manier beschikbaar is om de
	gegevens te back-uppen, is een back-up naar diskettes beter
	dan helemaal geen back-up.</para>

      <para>Gebruikte diskettes moet van goede kwaliteit zijn.
	Diskettes die al jaren op kantoor rondgeslingerd hebben, zijn
	een slechte keuze.  In het ideale geval dienen nieuwe diskettes
	van een reputabele fabrikant gebruikt te worden.</para>
    </sect2>

    <sect2 xml:id="floppies-creating">
      <title>Hoe de gegevens naar diskettes back-uppen?</title>

      <para>Het beste kan naar diskettes worden geback-upped door
	gebruik te maken van &man.tar.1; met de optie
	<option>-M</option> (meerdere volumes), die back-ups over
	meerdere diskettes ondersteunt.</para>

      <para>Om alle bestanden in de huidige map en de submappen te
	back-uppen (als <systemitem class="username"> root</systemitem>):</para>

      <screen>&prompt.root; <userinput>tar Mcvf /dev/fd0 *</userinput></screen>

      <para>Als de eerste diskette vol is, vraagt &man.tar.1; om het
	volgende volume.  Omdat &man.tar.1; media-onafhankelijk is,
	refereert het aan volumes, in deze context diskettes.</para>

      <screen>Prepare volume #2 for /dev/fd0 and hit return:</screen>

      <para>Dit wordt herhaald (met oplopend volumenummer) totdat alle
	gespecificeerde bestanden zijn geback-upped.</para>
    </sect2>

    <sect2 xml:id="floppies-compress">
      <title>Kunnen back-ups gecomprimeerd worden?</title>

      <indexterm><primary><command>tar</command></primary></indexterm>

      <indexterm><primary><command>gzip</command></primary></indexterm>

      <indexterm><primary>compressie</primary></indexterm>

      <para>Helaas staat &man.tar.1; het gebruik van de optie
	<option>-z</option> niet toe voor archieven over meerdere
	volumes.  Het is uiteraard mogelijk om alle bestanden met
	&man.gzip.1; te comprimeren, ze met &man.tar.1; op diskettes te
	zetten en ze daarna met &man.gunzip.1; weer te
	decomprimeren!</para>
    </sect2>

    <sect2 xml:id="floppies-restoring">
      <title>Hoe worden de back-ups teruggezet?</title>

      <para>Om een volledige archief terug te zetten:</para>

      <screen>&prompt.root; <userinput>tar Mxvf /dev/fd0</userinput></screen>

      <para>Er zijn twee manieren om alleen specifieke bestanden terug
	te zetten.  Ten eerste kan met de eerste diskette begonnen
	worden:</para>

      <screen>&prompt.root; <userinput>tar Mxvf /dev/fd0 bestandsnaam</userinput></screen>

      <para>Het programma &man.tar.1; vraagt om de vervolgdiskettes
	totdat het benodigde bestand is gevonden.</para>

      <para>Als alternatief kan, als bekend is op welke diskette het
	bestand staat, de betreffende diskette worden ingestoken en
	bovenstaand commando gebruikt worden.  Als het eerste bestand
	op de diskette een vervolg is van de vorige diskette,
	waarschuwt &man.tar.1; dat het bestand niet teruggezet kan
	worden, zelfs als hier niet om gevraagd is!</para>
    </sect2>
  </sect1>

  <sect1 xml:id="backup-strategies">
    <info><title>Back-up strategieën</title>
      <authorgroup>
	<author><personname><firstname>Lowell</firstname><surname>Gilbert</surname></personname><contrib>Oorspronkelijk werk van </contrib></author>
      </authorgroup>
      
    </info>

    

    <para>Het eerste wat nodig is voor het ontwepken van een
      back-upplan, is er voor te zorgen dat de volgende mogelijke
      problemen worden ondervangen:</para>

    <itemizedlist>
      <listitem>
	<para>Schijffalen</para>
      </listitem>

      <listitem>
	<para>Per ongeluk verwijderde bestanden</para>
      </listitem>

      <listitem>
	<para>Willekeurige bestandscorruptie</para>
      </listitem>

      <listitem>
	<para>Complete machinevernietiging (door bijvoorbeeld brand),
	  inclusief de vernietiging van lokaal beschikbare
	  back-ups.</para>
      </listitem>
    </itemizedlist>

    <para>Het is goed mogelijk dat een aantal systemen het best
      geholpen zijn door voor al deze problemen een andere techniek te
      gebruiken.  Behalve voor volledig persoonlijke systemen met
      niet echt belangrijke gegevens, is het zelfs onwaarschijnlijk dat
      één techniek alle mogelijke problemen kan
      afvangen.</para>

    <para>Een aantal technieken in de gereedschapskist zijn:</para>

    <itemizedlist>
      <listitem>
	<para>Archiveren van een heel systeem op een back-up die niet
	  lokaal wordt bewaard.  Dit biedt bescherming tegen alle
	  hierboven beschreven problemen, maar het is langzaam en
	  onhandig om er een restore van te maken.  Het is mogelijk om
	  lokaal een kopie aan te houden en/of online, maar dan zijn er
	  nog steeds onhandigheden, in het bijzonder voor restores voor
	  gebruikers met beperkte rechten.</para>
      </listitem>

      <listitem>
	<para>Snapshots van bestandssystemen.  Dit werkt eigenlijk
	  alleen in het geval bestanden per ongelijk verwijderd worden,
	  maar het kan in dat geval <emphasis>erg</emphasis> handig
	  zijn en het werkt snel en eenvoudig.</para>
      </listitem>

      <listitem>
	<para>Een kopie maken van hele bestandssystemen en/of schijven
	  (bijvoorbeeld een periodieke &man.rsync.1; van een hele machine).
	  Dit is in het algemeen het meest bruikbaar in netwerken met
	  specifieke eisen.  Voor algemene bescherming tegen het falen
	  van een schijf, is het meestal minder geschikt dan
	  <acronym>RAID</acronym>.  Voor het herstellen van per ongeluk
	  verwijderde bestanden is het vergelijkbaar aan
	  <acronym>UFS</acronym> snapshots, maar dat hangt af van
	  persoonlijke voorkeuren.</para>
      </listitem>

      <listitem>
	<para><acronym>RAID</acronym>.  Minimaliseert of voorkomt
	  downtijd als een schijf faalt.  Dit ten koste van het vaker
	  hebben van schijven die falen (omdat er meer van zijn), maar
	  wel met een veel lagere urgentie.</para>
      </listitem>

      <listitem>
	<para>Controleren van fingerprints van bestanden.  Het
	  hulpprogramma &man.mtree.8; kan hier bij helpen.  Hoewel dit
	  geen back-uptechniek is, zorgt het er wel voor dat kan worden
	  opgemerkt wanneer back-ups geraadpleegd moeten worden.  Dit
	  is in het bijzonder belangrijk voor offline back-ups en de
	  fingerprints horen periodiek gecontroleerd te worden.</para>
      </listitem>
    </itemizedlist>

    <para>Het is makkelijk om met nog meer technieken op de proppen te
      komen, waaronder veel variaties op de bovengenoemde.  Bijzondere
      eisen leiden vaak tot bijzondere oplossingen.  Het back-uppen van
      een draaiende database vereist bijvoorbeeld een methode die
      toegespitst is op de gebruikte database software als tussenstap.
      Het is van groot belang om te onderkennen tegen welke gevaren er
      bescherming dient te zijn en hoe daarmee om te gaan.</para>
  </sect1>

  <sect1 xml:id="backup-basics">
    <title>Back-upbeginselen</title>

    <para>De drie grote back-upprogramma's zijn &man.dump.8;,
      &man.tar.1; en &man.cpio.1;.</para>

    <sect2>
      <title>Dump en Restore</title>

      <indexterm>
	<primary>back-upsoftware</primary>

	<secondary>dump / restore</secondary>
      </indexterm>

      <indexterm><primary><command>dump</command></primary></indexterm>

      <indexterm><primary><command>restore</command></primary></indexterm>

      <para>De traditionele back-upprogramma's voor &unix; zijn
	<command>dump</command> en <command>restore</command>.  Deze
	zien het station als een verzameling van schijfblokken, onder
	de abstracties van bestanden, koppelingen en mappen die door de
	bestandssystemen worden aangemaakt.  In tegenstelling tot andere
	back-upprogramma's, verzorgt <command>dump</command> een
	back-up van een compleet bestandssysteem op een apparaat.  Het
	is niet in staat om slechts een gedeelte van een bestandssysteem
	of een mapstructuur die meer dan één
	bestandssysteem in beslag neemt te back-uppen.  Het commando
	<command>dump</command> schrijft geen bestanden en
	mappen naar band, maar de rauwe gegevensblokken waaruit de
	bestanden en mappen bestaan.  Wanneer het gebruikt wordt om
	gegevens te extraheren, slaat <command>restore</command>
	tijdelijke bestanden standaard op in <filename>/tmp/</filename>
	&mdash; als u werkt vanaf een herstelschijf met een kleine map
	<filename>/tmp</filename>, moet u wellicht de
	omgevingsvariabele <envar>TMPDIR</envar> op een map met meer
	vrije ruimte instellen zodat de restore kan slagen.</para>

      <note>
	<para>Indien <command>dump</command> op een hoofdmap wordt
	  gebruikt, wordt er geen back-up gemaakt van <filename>/home
	  </filename>, <filename>/usr</filename> of van de vele andere
	  mappen, aangezien dit typisch koppelpunten voor andere
	  bestandssystemen of symbolische koppelingen binnen deze
	  bestandssystemen zijn.</para>
      </note>

      <para><command>dump</command> bevat eigenaardigheden die uit de
	begintijd in Versie 6 van AT&amp;T &unix; (circa 1975) zijn
	overgebleven.  De standaardparameters zijn geschikt voor banden
	met 9 sporen (6.250 bpi), niet voor de media met hoge dichtheid
	die vandaag beschikbaar zijn (tot 62.182 ftpi).  Deze
	standaardwaarden dienen op de opdrachtregel overschreven te
	worden om de capaciteit van de huidige bandstations te
	benutten.</para>

      <indexterm><primary><filename>.rhosts</filename></primary></indexterm>

      <para>Het is ook mogelijk om gegevens met
	<command>rdump</command> en <command>rrestore</command> over
	een netwerk naar een bandstation dat aan een andere computer
	gekoppeld is te back-uppen.  Beide programma's maken gebruik
	van &man.rcmd.3; en &man.ruserok.3; om toegang tot het
	bandstation op afstand te krijgen.  De gebruiker die de back-up
	uitvoert moet vermeld staat in het bestand
	<filename>.rhosts</filename> op de computer op afstand.  De
	argumenten die aan <command>rdump</command> en
	<command>rrestore</command> gegeven worden dienen geschikt te
	zijn voor gebruik op de computer op afstand.  Als
	<command>rdump</command> gebruikt wordt om een dump te maken
	van een &os; computer naar een Exabyte-bandstation dat
	met een Sun-computer genaamd <systemitem>komodo</systemitem> verbonden
	is:</para>

      <screen>&prompt.root; <userinput>/sbin/rdump 0dsbfu 54000 13000 126 komodo:/dev/nsa8 /dev/da0a 2&gt;&amp;1</userinput></screen>

      <para>Let op: er kleven veiligheidsbezwaren aan het toestaan van
	authenticatie met <filename>.rhosts</filename>.  De situatie
	dient goed geëvalueerd te worden.</para>

      <para>Het is ook mogelijk om <command>dump</command> en
	<command>restore</command> op een veiligere manier via
	<command>ssh</command> te gebruiken.</para>

      <example>
	<title>Het gebruik van <command>dump</command> via
	  <application>ssh</application></title>

	<screen>&prompt.root; <userinput>/sbin/dump -0uan -f - /usr | gzip -2 | ssh -c blowfish \
	  doelgebruiker@doelmachine.example.com dd of=/mijngrotebestanden/dump-usr-10.gz</userinput></screen>
      </example>

      <para>Ook kan de ingebouwde manier van <command>dump</command>
	gebruikt worden, door de omgevingsvariabele <envar>RSH</envar>
	in te stellen:</para>

      <example>
	<title>Het gebruik van <command>dump</command> via
	  <application>ssh</application> met ingestelde
	  <envar>RSH</envar></title>

	<screen>&prompt.root; <userinput>env RSH=/usr/bin/ssh /sbin/dump -0uan -f doelgebruiker@doelmachine.example.com:/dev/sa0 /usr</userinput></screen>
      </example>
    </sect2>

    <sect2>
      <title><command>tar</command></title>

      <indexterm>
	<primary>back-upsoftware</primary>

	<secondary><command>tar</command></secondary>
      </indexterm>

      <para>&man.tar.1; stamt ook uit de tijd van Versie 6 van AT&amp;T
	&unix; (circa 1975).  Het werkt samen met het bestandssysteem.
	<command>tar</command> schrijft bestanden en mappen naar band
	en ondersteunt niet het volledige scala aan opties dat
	beschikbaar is met &man.cpio.1;, maar <command>tar</command>
	heeft niet de ongebruikelijke opdrachtpijplijn nodig die
	<command>cpio</command> gebruikt.</para>

      <indexterm><primary><command>tar</command></primary></indexterm>

      <para>Om <command>tar</command> toe te passen op een Exabyte-bandstation
	die met een Sun genaamd <systemitem>komodo</systemitem> verbonden
	is:</para>

      <screen>&prompt.root; <userinput>tar cf - . | rsh komodo dd of=tape-device obs=20b</userinput></screen>

      <para>Indien de veiligheid van back-uppen over een netwerk een
	punt is, dient gebruik te worden gemaakt van het commando
	<command>ssh</command> en niet van
	<command>rsh</command>.</para>
    </sect2>

    <sect2>
      <title><command>cpio</command></title>

      <indexterm>
	<primary>back-upsoftware</primary>

	<secondary><command>cpio</command></secondary>
      </indexterm>

      <para>&man.cpio.1; is het originele &unix; bandprogramma voor
	magnetische media om bestanden uit te wisselen.
	<command>cpio</command> heeft opties (naast vele anderen) om
	byte-swapping uit te voeren, een aantal verschillende
	archiefformaten te schrijven en de gegevens over een pijplijn
	naar andere programma's te voeren.  Deze laatste optie maakt
	<command>cpio</command> een uitstekende keuze voor
	installatiemedia.  <command>cpio</command> weet niet hoe het
	door een mapstructuur moet lopen.  Er dient een lijst met
	bestanden door <filename>stdin</filename> aangeleverd te
	worden.</para>

      <indexterm><primary><command>cpio</command></primary></indexterm>

      <para><command>cpio</command> biedt geen ondersteuning voor
	back-ups over het netwerk.  Er kan gebruik worden gemaakt van
	een pijplijn en <command>rsh</command> om de gegevens naar een
	banddrive op afstand te sturen.</para>

      <screen>&prompt.root; <userinput>for f in maplijst;  do</userinput>
<userinput>find $f &gt;&gt; back-up.lijst</userinput>
<userinput>done</userinput>
&prompt.root; <userinput>cpio -v -o --format=newc &lt; back-up.lijst | ssh gebruiker@host "cat &gt; back-upapparaat"</userinput></screen>

      <para>Hier is <replaceable>maplijst</replaceable> een lijst van
	de mappen waarvan een back-up gemaakt dient te worden,
	<replaceable>gebruiker</replaceable>@<replaceable>host</replaceable>
	de gebruiker/hostnaam-combinatie die de back-ups uitvoert, en
	<replaceable>back-upapparaat</replaceable> het apparaat waar de
	back-ups naar toe geschreven te worden (bijvoorbeeld
	<filename>/dev/nsa0</filename>).</para>
    </sect2>

    <sect2>
      <title><command>pax</command></title>

      <indexterm>
	<primary>back-upsoftware</primary>

	<secondary><command>pax</command></secondary>
      </indexterm>

      <indexterm><primary><command>pax</command></primary></indexterm>

      <indexterm><primary>POSIX</primary></indexterm>

      <indexterm><primary>IEEE</primary></indexterm>

      <para>&man.pax.1; is het antwoord van IEEE en &posix; op
	<command>tar</command> en <command>cpio</command>.  In de loop
	der jaren zijn de verscheidene versies van
	<command>tar</command> en <command>cpio</command> licht
	incompatibel geworden.  Dus in plaats van dit uit te vechten en
	ze volledig te standaardiseren, heeft &posix; een nieuw
	archiveringsprogramma gemaakt.  <command>pax</command> poogt om
	veel van de verscheidene formaten van <command>cpio</command>
	en <command>tar</command> te lezen en te schrijven, met daarbij
	nog nieuwe, eigen formaten.  De commandoverzameling lijkt meer
	op die van <command>cpio</command> dan op die van
	<command>tar</command>.</para>
    </sect2>

    <sect2 xml:id="backups-programs-amanda">
      <title><application>Amanda</application></title>

      <indexterm>
	<primary>back-upsoftware</primary>

	<secondary><application>Amanda</application></secondary>
      </indexterm>

      <indexterm><primary><application>Amanda</application></primary></indexterm>

      <para><application>Amanda</application> (Advanced Maryland
	Network Disk Archiver) is een client/server-back-upsysteem, in
	plaats van een enkel programma.  Een
	<application>Amanda</application> server back-upt elk aantal
	computers dat een <application>Amanda</application> client en
	een netwerkverbinding met de <application>Amanda</application>
	server heeft naar een enkel bandstation.  Een veelvoorkomend
	probleem bij bedrijven met een groot aantal schijven is dat de
	tijd die nodig is om de gegevens direct naar band te back-uppen
	langer is dan de tijd die voor de taak gereserveerd is.
	<application>Amanda</application> lost dit probleem op.
	<application>Amanda</application> kan gebruik maken van een
	<quote>tussenschijf</quote> om verschillende bestandssystemen
	tegelijkertijd te back-uppen.
	<application>Amanda</application> maakt
	<quote>archiefverzamelingen</quote> aan, een groep banden die
	gedurende een tijd gebruikt wordt om volledige back-ups te
	maken van alle bestandssystemen die in het
	instellingenbestand van <application>Amanda</application>
	vermeld staan.  De <quote>archiefverzameling</quote> bevat
	ook incrementele (of differentiële) back-ups van alle
	bestandssystemen.  Voor het herstellen van een beschadigd
	bestandssysteem zijn de meest recente volledige back-up en de
	incrementele back-ups nodig.</para>

      <para>Het instellingenbestand biedt verfijnde controle over de
	back-ups en het netwerkverkeer door
	<application>Amanda</application>.
	<application>Amanda</application> kan elk bovenstaand
	back-upprogramma gebruiken om de gegevens naar de band te
	schijven.  <application>Amanda</application> is òf als
	port òf als package beschikbaar.</para>
    </sect2>

    <sect2>
      <title>Nietsdoen</title>

      <para><quote>Nietsdoen</quote> is geen computerprogramma, maar de
	de meest gebruikte back-upstrategie.  Er zijn geen
	initiële kosten.  Er is geen back-upschema om te volgen.
	Zeg gewoon nee.  Als er iets met gegevens gebeurt, lach erom en
	leef ermee!</para>

      <para>Als tijd en gegevens weinig tot niets waard zijn, is
	<quote>Nietsdoen</quote> het meest geschikte back-upprogramma.
	Maar wees bedacht, &unix; is een nuttig stuk gereedschap en er
	is zo maar binnen zes maanden een verzameling bestanden die
	wèl van waarde is.</para>

      <para><quote>Nietsdoen</quote> is de juiste back-upmethode voor
	<filename>/usr/obj</filename> en andere mapstructuren die zo
	opnieuw aangemaakt kunnen worden.  Een voorbeeld zijn de
	bestanden waaruit de HTML- of &postscript; versie van dit
	Handboek bestaan.  Deze documentformaten zijn vanuit
	XML-invoerbestanden aangemaakt.  Het back-uppen van de HTML-
	of &postscript; bestanden is niet nodig.  Van de XML-bestanden
	dient regelmatig een back-up gemaakt te worden.</para>
    </sect2>

    <sect2>
      <title>Welk back-upprogramma is het beste?</title>

      <indexterm><primary>LISA</primary></indexterm>

      <para>&man.dump.8;.  <emphasis>Punt uit.</emphasis>.  Elizabeth
	D. Zwicky heeft stresstesten op alle hierboven besproken
	back-upprogramma's uitgevoerd.  De heldere keuze voor het
	behouden van alle gegevens en alle eigenaardigheden van &unix;
	bestandssystemen is <command>dump</command>.  Elizabeth heeft
	bestandssystemen aangemaakt met een grote verscheidenheid aan
	ongewone omstandigheden (en enkele minder ongebruikelijke) en
	heeft elk programma getest door een back-up van die
	bestandssystemen uit te voeren en ze te herstellen.  De
	eigenaardigheden omvatten bestanden met gaten, bestanden met
	gaten en een blok nullen, bestanden met vreemde tekens in hun
	namen, onleesbare en onschrijfbare bestanden, apparaten,
	bestanden waarvan de grootte verandert tijdens het back-uppen,
	bestanden die aangemaakt/verwijderd worden tijdens het
	back-uppen en meer.  Ze presenteerde de resultaten op LISA V in
	oktober 1991.  Zie <link xlink:href="http://www.coredumps.de/doc/dump/zwicky/testdump.doc.html">torture-testing
	  Backup and Archive Programs</link>.</para>
    </sect2>

    <sect2>
      <title>Noodterugzetprocedure</title>

      <sect3>
	<title>Vóór de ramp</title>

	<para>Er zijn slechts vier stappen om te volgen bij het
	  voorbereiden op elke ramp die voor kan komen.</para>

	<indexterm><primary><command>bsdlabel</command></primary></indexterm>

	<para>Het schijflabel van elke schijf dient afgedrukt te worden
	  (bijvoorbeeld met <command>bsdlabel da0 | lpr</command>), de
	  bestandssysteemtabel (<filename>/etc/fstab</filename>) en
	  alle opstartboodschappen, alles in tweevoud.</para>

	<indexterm><primary>livefs CD</primary></indexterm>

	<para>Ten tweede dient een <quote>livefs</quote> CD-ROM gebrandt te
	  worden.  Deze CD-ROM biedt ondersteuning voor het opstarten in een
	  &os; <quote>livefs</quote> reddingsmodus die gebruiker in staat stelt
	  om vele taken uit te voeren zoals het draaien van &man.dump.8;,
	  &man.restore.8;, &man.fdisk.8;, &man.bsdlabel.8;, &man.newfs.8; en
	  meer.  Een livefs CD-beeld voor
	  &os;/&arch.i386;&nbsp;&rel2.current;-RELEASE is beschikbaar op <uri xlink:href="ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/&arch.i386;/ISO-IMAGES/&rel2.current;/&os;-&rel2.current;-RELEASE-&arch.i386;-livefs.iso">ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/&arch.i386;/ISO-IMAGES/&rel2.current;/&os;-&rel2.current;-RELEASE-&arch.i386;-livefs.iso</uri>.</para>

	<note>
	  <para>Livefs CD-beelden zijn niet beschikbaar voor
	    &os;&nbsp;&rel.current;-RELEASE en nieuwer.  Naast de beelden voor
	    CDROM-installaties kunnen ook beelden voor flash-drive-installaties
	    gebruikt worden om een systeem te redden.  Het
	    <quote>memstick</quote>-beelden voor
	    &os;/&arch.i386;&nbsp;&rel.current;-RELEASE is beschikbaar op <uri xlink:href="ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/&arch.i386;/&arch.i386;/ISO-IMAGES/&rel.current;/&os;-&rel.current;-RELEASE-&arch.i386;-memstick.img">ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/&arch.i386;/&arch.i386;/ISO-IMAGES/&rel.current;/&os;-&rel.current;-RELEASE-&arch.i386;-memstick.img</uri>.</para>
	</note>

	<para>Ten derde dienen regelmatig back-upbanden aangemaakt te
	  worden.  Alle veranderingen die na de laatste back-up zijn
	  gemaakt kunnen onherroepelijk verloren zijn gegaan.  De
	  back-upbanden dienen beveiligd te worden tegen
	  overschrijven.</para>

	<para>Ten vierde dienen de <quote>livefs</quote> CD-ROM die in stap twee
	  gemaakt is en de back-upbanden getest te worden.  Van de handelingen
	  dienen aantekeningen gemaakt te worden.  De aantekeningen, de
	  CD-ROM, de afdrukken en de back-upbanden dienen
	  gezamenlijk bewaard te worden.  Tijdens het herstellen kunnen
	  de notities ervoor zorgen dat de back-upbanden vernietigd
	  worden.  Hoe?  In plaats van <command>tar xvf
	    /dev/sa0</command> kan per ongeluk <command>tar cvf
	    /dev/sa0</command> worden ingetypt, waardoor de back-upband
	  overschreven wordt.</para>

	<para>Als extra veiligheidsmaatregel dienen telkens een
	  <quote>livefs</quote> CD-ROM en twee back-upbanden gemaakt te worden.
	  Eén van deze banden dient op een plaats op afstand
	  bewaard te worden.  Zo'n plaats is NIET de kelder van het
	  zelfde kantoorgebouw.  Een aantal bedrijven in het World
	  Trade Center heeft deze les op de harde manier geleerd.  Zo'n
	  plaats dient fysiek gescheiden te zijn van de computers en de
	  schijven door een significante afstand.</para>
      </sect3>

      <sect3>
	<title>Na de ramp</title>

	<para>De hamvraag is: heeft de hardware het overleefd?  Er zijn
	  regelmatig back-ups gemaakt, dus zorgen over de software
	  zijn niet nodig.</para>

	<para>Indien hardware beschadigd is, dienen kapotte onderdelen
	  vervangen te worden voordat gepoogd wordt om een computer te
	  gebruiken.</para>

	<para>Plaats de <quote>livefs</quote> CD-ROM in de CD-ROM drive indien
	  de hardware in orde is en start de computer op.  Het originele
	  installatiemenu wordt op het scherm getoond.  Kies het land van
	  toepassing en kies daarna <guimenuitem>Fixit -- Repair mode with
	    CDROM/DVD/floppy</guimenuitem> en kies het item
	  <guimenuitem>CDROM/DVD -- Use the live filesystem
	    CDROM/DVD</guimenuitem>. <command>restore</command> en de andere
	  benodigde programma's staan in <filename>/mnt2/rescue</filename>.</para>

	<para>Herstel elk bestandssysteem apart.</para>

	<indexterm><primary><command>mount</command></primary></indexterm>

	<indexterm><primary>rootpartitie</primary></indexterm>

	<indexterm><primary><command>bsdlabel</command></primary></indexterm>

	<indexterm><primary><command>newfs</command></primary></indexterm>

	<para>Probeer de rootpartitie van de eerste schijf aan te
	  koppelen (bijvoorbeeld <command>mount /dev/da0a
	  /mnt</command>).  Als het schijflabel beschadigd is, gebruik
	  dan <command>bsdlabel</command> om de schijf opnieuw te
	  partitioneren en te labelen zodat deze overeenkomt met het
	  afgedrukte en bewaarde label.  Gebruik voor het opnieuw
	  aanmaken van de bestandssystemen <command>newfs</command>.
	  Koppel de rootpartitie van de schijf opnieuw aan voor lezen
	  en schrijven (<command>mount -u -o rw /mnt</command>).
	  Gebruik voor het herstellen van de gegevens van dit
	  bestandssysteem het back-upprogramma en de back-upbanden
	  (bijvoorbeeld <command>restore vrf /dev/sa0</command>).
	  Koppel nu het bestandssysteem af (bijvoorbeeld
	  <command>umount /mnt</command>).  Herhaal dit voor elk
	  beschadigd bestandssysteem.</para>

	<para>Back-up de gegevens naar nieuwe banden als het systeem
	  weer draait.  De omstandigheden die verantwoordelijk waren
	  voor de crash of het gegevensverlies kunnen weer voorkomen.
	  Nu een extra uur investeren, kan later grote zorgen
	  besparen.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="disks-virtual">
    <info><title>Netwerk-, geheugen-, en bestandsgebaseerde
      bestandssystemen</title>
      <authorgroup>
	<author><personname><firstname>Marc</firstname><surname>Fonvieille</surname></personname><contrib>Geherstructureerd en verbeterd door </contrib></author>
      </authorgroup>
    </info>

    

    <indexterm><primary>virtuele schijven</primary></indexterm>

    <indexterm>
      <primary>schijven</primary>

      <secondary>virtueel</secondary>
    </indexterm>

    <para>Naast de schijven die fysiek in de computer zitten,
      diskettes, CD's, harde schijven, enzovoort, worden er ook andere
      vormen van schijven door &os; begrepen: de <firstterm>virtuele
	schijven</firstterm>.</para>

    <indexterm><primary>NFS</primary></indexterm>

    <indexterm><primary>Coda</primary></indexterm>

    <indexterm>
      <primary>schijven</primary>

      <secondary>geheugen</secondary>
    </indexterm>

    <para>Dit omvat netwerkbestandssystemen zoals het <link linkend="network-nfs">Network File System</link> en Coda,
      geheugengebaseerde bestandssystemen en bestandsgebaseerde
      bestandssystemen.</para>

    <para>Nagelang de gebruikte versie van &os;, zijn er andere
      gereedschappen voor het aanmaken en gebruiken van
      bestandsgebaseerde en geheugengebaseerde bestandssystemen.</para>

    <note>
      <para>Gebruik &man.devfs.8; om de apparaatnodes transparant voor
	de gebruiker toe te wijzen.</para>
    </note>

    <sect2 xml:id="disks-mdconfig">
      <title>Bestandsgebaseerd bestandssysteem</title>

      <indexterm>
	<primary>schijven</primary>

	<secondary>bestandsgebaseerd</secondary>
      </indexterm>

      <para>Met &man.mdconfig.8; kunnen geheugenschijven, &man.md.4;,
	ingesteld worden en aangezet worden.  Om
	&man.mdconfig.8; te gebruiken, moet de module &man.md.4;
	geladen worden of ondersteuning aan het
	kernelinstellingenbestand toegevoegd worden:</para>

      <programlisting>device md</programlisting>

      <para>Het commando &man.mdconfig.8; ondersteunt drie types
	geheugen-gebaseerde virtuele schijven: geheugenschijven die met
	&man.malloc.9; toegewezen zijn, geheugenschijven die een
	bestand als basis gebruiken en geheugenschijven die swapruimte
	als basis gebruiken.  Een mogelijk gebruik is het aankoppelen
	van een beeld van een diskette of CD dat in een bestand bewaard
	wordt.</para>

      <para>Om een bestaand beeld van een bestandssysteem aan te
	koppelen:</para>

      <example>
	<title><command>mdconfig</command> gebruiken om een bestaand
	  beeld van een bestandssysteem aan te koppelen</title>

	<screen>&prompt.root; <userinput>mdconfig -a -t vnode -f schijfbeeld -u 0</userinput>
&prompt.root; <userinput>mount /dev/md0 /mnt</userinput></screen>
      </example>

      <para>Om een nieuw beeld van een bestandssysteem aan te maken met
	&man.mdconfig.8;:</para>

      <example>
	<title>Nieuwe bestandsgebaseerde schijf aanmaken met
	  <command>mdconfig</command></title>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=nieuwbeeld bs=1k count=5k</userinput>
5120+0 records in
5120+0 records out
&prompt.root; <userinput>mdconfig -a -t vnode -f nieuwbeeld -u 0</userinput>
&prompt.root; <userinput>bsdlabel -w md0 auto</userinput>
&prompt.root; <userinput>newfs md0a</userinput>
/dev/md0a: 5.0MB (10240 sectors) block size 16384, fragment size 2048
	using 4 cylinder groups of 1.25MB, 80 blks, 192 inodes.
super-block backups (for fsck -b #) at:
 160, 2720, 5280, 7840
&prompt.root; <userinput>mount /dev/md0a /mnt</userinput>
&prompt.root; <userinput>df /mnt</userinput>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0a       4710    4  4330     0%    /mnt</screen>
      </example>

      <para>Indien het eenheidsnummer niet met de optie
	<option>-u</option> gespecificeerd wordt, gebruikt
	&man.mdconfig.8; de automatische toewijzing van &man.md.4; om
	een ongebruikt apparaat te selecteren.  De naam van het
	toegewezen apparaat wordt op stdout weergegeven als
	<filename>md4</filename>.  Meer details staan in de
	hulppagina van &man.mdconfig.8;.</para>

      <para>Het commando &man.mdconfig.8; is erg nuttig, hoewel het
	veel opdrachten vergt om een bestandsgebaseerd bestandssysteem
	aan te maken.  &os; wordt met &man.mdmfs.8; geleverd.  Dit
	programma stelt een &man.md.4;-schijf in door gebruik te maken
	van &man.mdconfig.8;, zet er een bestandssysteem op door gebruik
	te maken van &man.newfs.8; en koppel het aan door gebruik te
	maken van &man.mount.8;.  Om hetzelfde bestandssysteembeeld als
	hierboven aan te maken en aan te koppelen:</para>

      <example>
	<title>Instellen en aankoppelen van een bestandsgebaseerde
	  schijf met <command>mdmfs</command></title>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=nieuwbeeld bs=1k count=5k</userinput>
5120+0 records in
5120+0 records out
&prompt.root; <userinput>mdmfs -F nieuwbeeld -s 5m md0 /mnt</userinput>
&prompt.root; <userinput>df /mnt</userinput>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0        4718    4  4338     0%    /mnt</screen>
      </example>

      <para>Als de optie <option>md</option> zonder eenheidsnummer
	gebruikt wordt, gebruikt &man.mdmfs.8; de automatische
	toewijzing van &man.md.4; om automatisch een ongebruikt
	apparaat te selecteren.  Meer details staan in de hulppagina
	van &man.mdmfs.8;.</para>
    </sect2>

    <sect2 xml:id="disks-md-freebsd5">
      <title>Geheugengebaseerd bestandssysteem</title>

      <indexterm>
	<primary>schijven</primary>

	<secondary>geheugenbestandssysteem</secondary>
      </indexterm>

      <para>Voor een geheugen gebaseerd bestands systeem moet normaal
	gesproken <quote>wisselbestand geheugen</quote> gebruikt worden.
	Gebruik maken van wisselbestand geheugen wil niet perse zeggen
	dat de geheugen schijf direct in het wisselbestand gezet wordt,
	maar dat het bestand naar het wisselbestand geschreven kan worden
	indien nodig.  Het is ook mogelijk om &man.malloc.9; gebaseerde
	geheugen schijven te maken, maar door hiervan gebruik te maken
	kan het gebeuren dat het systeem crashed als de kernel uit het
	geheugen loopt.</para>

      <example>
	<title>Nieuwe geheugengebaseerde schijf aanmaken met
	  <command>mdconfig</command></title>

	<screen>&prompt.root; <userinput>mdconfig -a -t swap -s 5m -u 1</userinput>
&prompt.root; <userinput>newfs -U md1</userinput>
/dev/md1: 5.0MB (10240 sectors) block size 16384, fragment size 2048
	using 4 cylinder groups of 1.27MB, 81 blks, 192 inodes.
	with soft updates
super-block backups (for fsck -b #) at:
 160, 2752, 5344, 7936
&prompt.root; <userinput>mount /dev/md1 /mnt</userinput>
&prompt.root; <userinput>df /mnt</userinput>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md1        4718    4  4338     0%    /mnt</screen>
      </example>

      <example>
	<title>Nieuwe geheugengebaseerde schijf aanmaken met
	  <command>mdmfs</command></title>

	<screen>&prompt.root; <userinput>mdmfs -s 5m md2 /mnt</userinput>
&prompt.root; <userinput>df /mnt</userinput>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md2        4846    2  4458     0%    /mnt</screen>
      </example>
    </sect2>

    <sect2>
      <title>Geheugenschijf van het systeem afkoppelen</title>

      <indexterm>
	<primary>schijven</primary>

	<secondary>geheugenschijf afkoppelen</secondary>
      </indexterm>

      <para>Als een geheugen- of bestandsgebaseerd bestandssysteem
	niet gebruikt wordt, dienen alle bronnen aan het systeem
	vrijgegeven te worden.  Koppel als eerste het bestandssysteem
	af, gebruikt daarna &man.mdconfig.8; om de schijf van een
	systeem los te koppelen en de bronnen vrij te geven.</para>

      <para>Om bijvoorbeeld alle bronnen die door
	<filename>/dev/md4</filename> gebruikt worden los te koppelen
	en vrij te geven:</para>

      <screen>&prompt.root; <userinput>mdconfig -d -u 4
	</userinput></screen>

      <para>Het is mogelijk om de informatie over ingestelde &man.md.4;
	apparaten weer te geven door gebruik te maken van
	<command>mdconfig -l</command>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="snapshots">
    <info><title>Snapshots van bestandssystemen</title>
      <authorgroup>
	<author><personname><firstname>Tom</firstname><surname>Rhodes</surname></personname><contrib>Bijgedragen door </contrib></author>
      </authorgroup>
      
    </info>

    

    <indexterm>
      <primary>bestandssystemen</primary>

      <secondary>snapshots</secondary>
    </indexterm>

    <para>&os; biedt een mogelijkheid om samen met <link linkend="soft-updates">Soft Updates</link>: snapshots van
      bestandssystemen.</para>

    <para>Snapshots bieden de mogelijkheid om beelden van een
      gespecificeerd bestandssysteem te maken en ze als bestand te
      behandelen.  Snapshotbestanden moeten aangemaakt worden in het
      bestandssysteem waarop de handeling wordt uitgevoerd en er mogen
      niet meer dan 20 snapshots per bestandssysteem worden aangemaakt.
      Actieve snapshots worden opgeslagen in het superblok zodat ze
      persistent zijn met afkoppel- en heraankoppelbewerkingen en met
      het opnieuw opstarten van het systeem.  Als een snapshot niet
      langer nodig is, kan het met het standaardcommando &man.rm.1;
      worden verwijderd.  Snapshots kunnen in elke volgorde verwijderd
      worden, alhoewel misschien niet alle gebruikte ruimte
      teruggewonnen wordt omdat sommige vrijgegeven blokken mogelijk
      door een ander snapshot geclaimd worden.</para>

    <para>De onveranderlijke bestandsvlag <option>snapshot</option>
      wordt door &man.mksnap.ffs.8; ingesteld nadat het snapshotbestand
      initieel is aangemaakt.  Het commando &man.unlink.1; maakt een
      uitzondering voor snapshotbestanden aangezien het toestaat dat ze
      verwijderd worden.</para>

    <para>Snapshotbestanden worden aangemaakt met &man.mount.8;.  Om
      een snapshot van <filename>/var</filename> in het bestand
      <filename>/var/snapshot/snap</filename> te plaatsen:</para>

    <screen>&prompt.root; <userinput>mount -o -o snapshot /var/snapshot/snap /var</userinput></screen>

    <para>Als alternatief kan &man.mksnap.ffs.8; gebruikt worden om een
      snapshot aan te maken:</para>

    <screen>&prompt.root; <userinput>mksnap_ffs /var /var/snapshot/snap</userinput></screen>

    <para>Snapshotbestanden kunnen gezocht worden op een
      bestandssysteem (bijvoorbeeld <filename>/var</filename>) door
      gebruik te maken van het commando &man.find.1;:</para>

    <screen>&prompt.root; <userinput>find /var -flags snapshot</userinput></screen>

    <para>Nadat een snapshot is aangemaakt, kan het voor een aantal
      dingen gebruikt worden:</para>

    <itemizedlist>
      <listitem>
	<para>Sommige systeembeheerders gebruiken een snapshotbestand
	  voor back-updoeleinden, omdat het snapshot naar CD's of band
	  overgezet kan worden;</para>
      </listitem>

      <listitem>
	<para>De bestandssysteem integriteit controle, &man.fsck.8;
	  kan gebruikt worden op het snapshot.  Ervan uitgaande dat het
	  bestandssysteem schoon was toen het werd aangekoppeld, zou dit
	  altijd een schoon (en onveranderlijk) resultaat moeten
	  opleveren.  Dit is in principe wat het
	  &man.fsck.8;-achtergrondsproces doet;</para>
      </listitem>

      <listitem>
	<para>Het commando &man.dump.8; draaien op het snapshot.  Er
	  wordt een dump teruggegeven die consistent is met het
	  bestandssysteem en tijdsstempel van het snapshot.
	  &man.dump.8; kan ook in één commando een
	  snapshot maken, een dumpbeeld aanmaken en daarna het snapshot
	  verwijderen door gebruik te maken van de vlag
	  <option>-L</option>;</para>
      </listitem>

      <listitem>
	<para>Het snapshot kan met &man.mount.8; als bevroren beeld van
	  het bestandssysteem worden aangekoppeld.  Om het snapshot
	  <filename>/var/snapshot/snap</filename> aan te koppelen:</para>

	<screen>&prompt.root; <userinput>mdconfig -a -t vnode -f /var/snapshot/snap -u 4</userinput>
&prompt.root; <userinput>mount -r /dev/md4 /mnt</userinput></screen>
      </listitem>
    </itemizedlist>

    <para>Het is nu mogelijk om door de structuur van het bevroren
      bestandssysteem <filename>/var</filename> te lopen dat
      aangekoppeld is op <filename>/mnt</filename>.  Alles zal initieel
      in dezelfde toestand verkeren als op het moment dat het snapshot
      werd aangemaakt.  De enige uitzondering hierop is dat eerdere
      snapshots als bestanden met lengte nul verschijnen.  Als een
      snapshot niet meer nodig is, kan het als volgt afgekoppeld
      worden:</para>

    <screen>&prompt.root; <userinput>umount /mnt</userinput>
&prompt.root; <userinput>mdconfig -d -u 4</userinput></screen>

    <para>Meer informatie over <option>softupdates</option> en
      snapshots van bestandssystemen, inclusief technische documenten,
      staat op de website van Marshall Kirk McKusick op <uri xlink:href="http://www.mckusick.com/">http://www.mckusick.com/</uri>.</para>
  </sect1>

  <sect1 xml:id="quotas">
    <title>Bestandssysteemquota</title>

    <indexterm>
      <primary>accounten</primary>

      <secondary>schijfruimte</secondary>
    </indexterm>

    <indexterm><primary>schijfquota</primary></indexterm>

    <para>Quota zijn een optionele mogelijkheid van het
      besturingssysteem om de hoeveelheid schijfruimte en/of het aantal
      bestanden dat gebruikers of leden van een groep per
      bestandssysteem mogen gebruiken te beperken.  Dit wordt het
      meeste gebruikt op timesharing-systemen waar het wenselijk is om
      het aantal bronnen dat elke gebruiker of groep van gebruikers mag
      gebruiken te beperken.  Dit voorkomt dat één
      gebruiker of groep van gebruikers alle beschikbare schijfruimte
      in beslag neemt.</para>

    <sect2>
      <title>Schijfquota inschakelen</title>

      <para>Controleer alvorens te proberen om schijfquota te
	gebruiken of quota ingesteld zijn in de kernel.  Dit gebeurt
	door het toevoegen van de volgende regel aan het
	kernelinstellingenbestand:</para>

      <programlisting>options QUOTA</programlisting>

      <para>De standaardkernel <filename>GENERIC</filename> heeft deze
	optie niet aanstaan, dus is het nodig om een eigen kernel in te
	stellen, te bouwen en te installeren om gebruik te kunnen maken
	van schijfquota.  Meer informatie over het instellen van de
	kernel staat in <xref linkend="kernelconfig"/>.</para>

      <para>Vervolgens dienen schijfquota aangezet te worden in
	<filename>/etc/rc.conf</filename>.  Op &os;&nbsp;7.X en eerder wordt
	deze regel toegevoegd:</para>

      <programlisting>enable_quotas="YES"</programlisting>

      <para>Voeg op &os;&nbsp;8.0-RELEASE en nieuwer in plaats daarvan deze
	regel toe:</para>

      <programlisting>quota_enable="YES"</programlisting>

      <indexterm>
	<primary>schijfquota</primary>

	<secondary>controleren</secondary>
      </indexterm>

      <para>Voor fijnere controle over de opstartquota zijn extra
	instellingsvariabelen beschikbaar.  Normaalgesproken wordt de
	integriteit van de quota van elk bestandssysteem tijdens het
	opstarten door &man.quotacheck.8; gecontroleerd.
	&man.quotacheck.8; verzekert dat de gegevens in de
	quotadatabase een juiste afspiegeling vormen van de gegevens op
	het bestandssysteem.  Dit proces neemt erg veel tijd in beslag
	en beïnvloedt de tijd die een systeem nodig heeft om op te
	starten significant.  Om deze stap over te slaan, bestaat een
	variabele in <filename>/etc/rc.conf</filename>:</para>

      <programlisting>check_quotas="NO"</programlisting>

      <para>Als laatste dient <filename>/etc/fstab</filename> bewerkt
	te worden om schijfquota per bestandssysteem aan te zetten.
	Hier kunnen gebruiker- of groepquota of beide worden aangezet
	voor alle bestandssystemen.</para>

      <para>Om quota per gebruiker op een bestandssysteem aan te
	zetten, dient de optie <option>userquota</option> aan het
	optieveld toegevoegd te worden aan de regel in
	<filename>/etc/fstab</filename> voor het bestandssysteem waar
	quota worden aangezet.  Bijvoorbeeld:</para>

      <programlisting>/dev/da1s2g   /home    ufs rw,userquota 1 2</programlisting>

      <para>Analoog, om groepquota aan te zetten, dient de optie
	<option>groupquota</option> in plaats van
	<option>userquota</option> gebruikt te worden.  Om zowel
	gebruikers- als groepsquota aan te zetten, dient de regel als
	volgt veranderd te worden:</para>

      <programlisting>/dev/da1s2g   /home    ufs rw,userquota,groupquota 1 2</programlisting>

      <para>Standaard worden de quotabestanden opgeslagen in de
	hoofdmap van het bestandssysteem onder de namen
	<filename>quota.user</filename> en
	<filename>quota.group</filename> voor respectievelijk
	gebruikers- en groepsquota.  Meer informatie staat in
	&man.fstab.5;.  Alhoewel de hulppagina &man.fstab.5; vermeld
	dat een alternatieve plaats voor de quotabestanden
	gespecificeerd kan worden, wordt dit niet aangeraden omdat de
	verschillende quotagereedschappen dit niet juist schijnen af te
	handelen.</para>

      <para>Hier aangekomen dient het systeem opnieuw opgestart te
	worden met de nieuwe kernel.  <filename>/etc/rc</filename>
	voert automatisch de juiste commando's uit om de initiële
	quotabestanden aan te maken voor alle quota die in
	<filename>/etc/fstab</filename> zijn aangezet.  Het is dus niet
	nodig om handmatig quotabestanden met lengte nul aan te
	maken.</para>

      <para>Tijdens normale bewerkingen moet het niet nodig zijn om de
	commando's &man.quotacheck.8;, &man.quotaon.8; of
	&man.quotaoff.8; handmatig te draaien.  Lees wel de betreffende
	hulppagina's om bekend te raken met de werking ervan.</para>
    </sect2>

    <sect2>
      <title>Quotalimieten instellen</title>

      <indexterm>
	<primary>schijfquota</primary>

	<secondary>limieten</secondary>
      </indexterm>

      <para>Indien het systeem ingesteld voor gebruik van quota,
	controleer dan of ze echt aanstaan.  Een eenvoudige
	manier om dit te doen is de volgende:</para>

      <screen>&prompt.root; <userinput>quota -v</userinput></screen>

      <para>Er hoort een eenregelige samenvatting te verschijnen over
	het schijfgebruik en de huidige quotalimieten voor elk
	bestandssysteem waarop quota aanstaan.</para>

      <para>Nu kunnen quotalimieten toegewezen worden met
	&man.edquota.8;.</para>

      <para>Er zijn verschillende opties om grenzen te stellen aan de
	hoeveelheid schijfruimte die een gebruiker of groep mag
	toewijzen en het aantal bestanden dat ze mogen aanmaken.
	Toewijzingen kunnen begrensd worden met betrekking tot
	schijfruimte (blokquota) of het aantal bestanden (inode-quota)
	of een combinatie van beide.  Elk van deze limieten is op zijn
	beurt weer opgesplitst in twee categoriën: harde en zachte
	limieten.</para>

      <indexterm><primary>harde limiet</primary></indexterm>

      <para>Een harde limiet mag niet overschreden worden.  Indien een
	gebruiker de harde limiet bereikt, mag deze geen verdere
	toewijzingen maken op het betreffende bestandssysteem.  Indien
	een gebruiker bijvoorbeeld een harde limiet heeft van 500 kB
	op een bestandssysteem en er 490&nbsp;kB van gebruikt, kan deze
	nog slechts 10&nbsp;kB toewijzen.  Een poging om 11&nbsp;kB toe
	te wijzen zal mislukken.</para>

      <indexterm><primary>zachte limiet</primary></indexterm>

      <para>Zachte limieten kunnen voor een beperkte tijd overschreden
	worden.  Deze periode staat bekend als de gratieperiode, die
	standaard een week bedraagt.  Als een gebruiker de zachte
	limiet langer dan de gratieperiode overschrijdt, verandert de
	zachte limiet in een harde limiet en zijn er geen verdere
	toewijzingen toegestaan.  Als de gebruiker onder de zachte
	limiet komt, wordt de gratieperiode opnieuw ingesteld.</para>

      <para>Het volgende is een voorbeeld van een mogelijk gebruik van
	&man.edquota.8;.  Als het commando &man.edquota.8; gestart
	wordt, wordt de tekstverwerker opgestart die door de
	omgevingsvariabele <envar>EDITOR</envar> gespecificeerd is, of
	de tekstverwerker <application>vi</application> als de
	variabele <envar>EDITOR</envar> niet is ingesteld.  Nu kunnen
	de quotalimieten bewerkt worden.</para>

      <screen>&prompt.root; <userinput>edquota -u test</userinput></screen>

      <programlisting>Quotas for user test:
/usr: kbytes in use: 65, limits (soft = 50, hard = 75)
        inodes in use: 7, limits (soft = 50, hard = 60)
/usr/var: kbytes in use: 0, limits (soft = 50, hard = 75)
        inodes in use: 0, limits (soft = 50, hard = 60)</programlisting>

      <para>Normaalgesproken worden er twee regels weergegeven voor elk
	bestandssysteem waarvoor quota gelden: één regel
	voor de bloklimieten, en één voor de
	inode-limieten.  Om de quotalimieten te veranderen dient de
	waarde ervan veranderd te worden.  Om bijvoorbeeld de
	bloklimiet van een gebruiker te veranderen van een zachte
	limiet van 50 en een harde limiet van 75 in een zachte limiet
	van 500 en een harde limiet van 600, dient het volgende
	veranderd te worden:</para>

      <programlisting>/usr: kbytes in use: 65, limits (soft = 50, hard = 75)</programlisting>

      <para>In:</para>

      <programlisting>/usr: kbytes in use: 65, limits (soft = 500, hard = 600)</programlisting>

      <para>De nieuwe quotalimieten gelden zodra de tekstverwerker
	verlaten wordt.</para>

      <para>Soms is het gewenst om quotalimieten in te stellen op een
	aantal UID's.  Dit kan gedaan worden door de optie
	<option>-p</option> van &man.edquota.8; te gebruiken.  Wijs
	eerst de gewenste quotalimiet aan een gebruiker toe en draai
	daarna <command>edquota -p protogebruiker
	  beginuid-einduid</command>.  Indien bijvoorbeeld gebruiker
	<systemitem class="username">test</systemitem> de gewenste quotalimieten heeft, kan
	het volgende commando gebruikt worden om deze quotalimieten te
	dupliceren voor UID's 10.000 tot en met 19.999:</para>

      <screen>&prompt.root; <userinput>edquota -p test 10000-19999</userinput></screen>

      <para>Meer informatie staat in de hulppagina voor
	&man.edquota.8;.</para>
    </sect2>

    <sect2>
      <title>Quotalimieten en schijfgebruik controleren</title>

      <indexterm>
	<primary>schijfquota</primary>

	<secondary>controleren</secondary>
      </indexterm>

      <para>Zowel &man.quota.1; als &man.repquota.8; kunnen gebruikt
	worden om de quotalimieten en het schijfgebruik te controleren.
	Het commando &man.quota.1; kan gebruikt worden om de quota van
	zowel individuele gebruikers als groepen en het schijfgebruik
	te controleren.  Een gebruiker mag alleen de eigen quota en de
	quota van een groep waarvan deze lid is controleren.  Alleen de
	beheerder mag alle gebruikers- en groepsquota bekijken.  Het
	commando &man.repquota.8; kan gebruikt worden om een overzicht
	te krijgen van alle quota en gebruik van bestandssystemen
	waarvan quota aanstaan.</para>

      <para>Het volgende is een mogelijke uitvoer van het commando
	<command>quota -v</command> voor een gebruiker die
	quotalimieten heeft op twee bestandssystemen.</para>

      <programlisting>Disk quotas for user test (uid 1002):
     Filesystem  usage    quota   limit   grace   files   quota   limit   grace
           /usr      65*     50      75   5days       7      50      60
       /usr/var       0      50      75               0      50      60</programlisting>

      <indexterm><primary>gratieperiode</primary></indexterm>

      <para>Voor het bestandssysteem <filename>/usr</filename> in
	bovenstaand voorbeeld overschrijdt deze gebruiker de zachte
	limiet van 50&nbsp;kB momenteel met 15&nbsp;kB en heeft deze 5
	dagen van de gratieperiode over.  De asterisk,
	<literal>*</literal> geeft aan dat de gebruiker momenteel de
	quotalimiet overschrijdt.</para>

      <para>Normaalgesproken worden bestandssystemen waarvan de
	gebruiker geen schijfruimte gebruikt niet weergegeven in de
	uitvoer van &man.quota.1;, zelfs niet als er de gebruiker een
	quotalimiet heeft voor dat bestandssysteem.  De optie
	<option>-v</option> geeft deze bestandssystemen weer, zoals het
	bestandssysteem <filename>/usr/var</filename> in bovenstaand
	voorbeeld.</para>
    </sect2>

    <sect2>
      <title>Quota over NFS</title>

      <indexterm><primary>NFS</primary></indexterm>

      <para>Quota worden afgedwongen door het quota-subsysteem op de
	NFS-server.  De daemon &man.rpc.rquotad.8; stelt
	quota-informatie beschikbaar aan het commando &man.quota.1; op
	de NFS-cliënts, wat de gebruikers op deze machines in
	staat stelt hun quota-statistieken in te zien.</para>

      <para><command>rpc.rquotad</command> dient als volgt in
	<filename>/etc/inetd.conf</filename> aangezet te worden:</para>

      <programlisting>rquotad/1      dgram rpc/udp wait root /usr/libexec/rpc.rquotad rpc.rquotad</programlisting>

      <para>Vervolgens dient <command>inetd</command> opnieuw gestart
	te worden:</para>

      <screen>&prompt.root; <userinput>service inetd restart</userinput></screen>
    </sect2>
  </sect1>

  <sect1 xml:id="disks-encrypting">
    <info><title>Schijfpartities versleutelen</title>
      <authorgroup>
	<author><personname><firstname>Lucky</firstname><surname>Green</surname></personname><contrib>Bijgedragen door </contrib><affiliation>
	    <address>
	      <email>shamrock@cypherpunks.to</email>
	    </address>
	  </affiliation></author>
      </authorgroup>
      
    </info>

    

    <indexterm>
      <primary>schijven</primary>

      <secondary>versleutelen</secondary>
    </indexterm>

    <para>&os; biedt uitstekende on-line bescherming tegen onbevoegde
      gegevenstoegang.  Bestandsrechten en Mandatory Access Control
      (MAC) (zie <xref linkend="mac"/>) helpen voorkomen dat onbevoegde
      derde partijen toegang tot de gegevens krijgen als het
      besturingssysteem actief is en de computer aanstaat.  De door het
      besturingssysteem afgedwongen rechten zijn echter niet relevant
      als een aanvaller fysieke toegang tot een computer heeft en deze
      de harde schijf van de computer in een ander systeem kan plaatsen
      om de gevoelige gegevens te kopiëren en te
      analyseren.</para>

    <para>Afgezien van hoe een aanvaller in het bezit van een harde
      schijf of een uitgezette computer gekomen is, kan
      <application>GEOM Based Disk Encryption (gbde)</application> de
      gegevens op het bestandssysteem van de computer zelfs tegen
      hooggemotiveerde aanvallers met aanzienlijke middelen beschermen.
      In tegenstelling tot lastige versleutelmethoden die alleen losse
      bestanden versleutelen, versleutelt
      <application>gbde</application> gehele bestandssystemen op een
      transparante manier.  De harde schijf komt nooit in aanraking met
      klare tekst.</para>
    <para>Los van hoe een aanvaller in het bezit van een harde schijf
      of een uitgezette computer gekomen is, kunnen de cryptografische
      subsystemen <application>GEOM Based Disk Encryption
	(gbde)</application> en <command>geli</command> in &os;
      gegevens op bestandssystemen van een computer beschermen tegen
      zelfs de meer gemotiveerde belagers die ook nog eens adequate
      middelen hebben.  Anders dan met lastige versleutelingsmethoden
      die alleen individuele bestanden versleutelen, versleutelen
      <command>gbde</command> en <command>geli</command> transparant
      complete bestandssystemen.  Er komt nooit platte tekst op een
      harde schijf.</para>

    <sect2>
      <title>Schijven versleutelen met
	<application>gbde</application></title>

      <procedure>
	<step>
	  <title>Word <systemitem class="username">root</systemitem></title>

	  <para>Het instellen van <application>gbde</application>
	    vereist beheerdersrechten.</para>

	  <screen>&prompt.user; <userinput>su -</userinput>
Password:</screen>
	</step>

	<step>
	  <title>Voeg ondersteuning voor &man.gbde.4; aan het
	    kernelinstellingenbestand toe</title>

	  <para>Voeg de volgende regel toe aan het
	    kernelinstellingenbestand:</para>

	  <para><literal>options GEOM_BDE</literal></para>

	  <para>Herbouw de kernel opnieuw zoals beschreven in <xref linkend="kernelconfig"/>.</para>

	  <para>Start op met de nieuwe kernel.</para>
	</step>

	<step>
	  <para>Een alternatief voor het hercompileren van de kernel
	    is door gebruik te maken van &man.kldload.8; om
	    &man.gbde.4; te laden:</para>

	  <screen>&prompt.root; <userinput>kldload geom_bde</userinput></screen>
	</step>
      </procedure>

      <sect3>
	<title>Versleutelde harde schijf voorbereiden</title>

	<para>In het volgende voorbeeld wordt aangenomen dat er een
	  nieuwe harde schijf aan het systeem wordt toegevoegd die een
	  enkele versleutelde partitie zal bevatten.  Deze partitie
	  wordt aangekoppeld als <filename>/private</filename>.
	  <application>gbde</application> kan ook gebruikt worden om
	  <filename>/home</filename> en <filename>/var/mail</filename>
	  te versleutelen, maar daarvoor zijn complexere instructies
	  nodig die buiten het bereik van deze inleiding vallen.</para>

	<procedure>
	  <step>
	    <title>Voeg een nieuwe harde schijf toe</title>

	    <para>Voeg de nieuwe harde schijf toe zoals beschreven in
	      <xref linkend="disks-adding"/>.  In dit voorbeeld is een
	      nieuwe harde schijfpartitie toegevoegd als
	      <filename>/dev/ad4s1c</filename>.  De apparaten
	      <filename>/dev/ad0s1*</filename>
	      stellen bestaande standaard &os; partities van het
	      voorbeeldsysteem voor.</para>

	    <screen>&prompt.root; <userinput>ls /dev/ad*</userinput>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4</screen>
	  </step>

	  <step>
	    <title>Maak een map aan voor gbde lockbestanden</title>

	    <screen>&prompt.root; <userinput>mkdir /etc/gbde</userinput></screen>

	    <para>Het lockbestand voor <application>gbde</application>
	      bevat informatie die <application>gbde</application>
	      nodig heeft om toegang te krijgen tot versleutelde
	      partities.  Zonder toegang tot de lockbestand is
	      <application>gbde</application> niet in staat om de
	      gegevens die op de versleutelde partitie staan te
	      ontsleutelen zonder aanzienlijke handmatige tussenkomst die
	      niet door de software ondersteund wordt.  Elke versleutelde
	      partitie gebruikt een ander lockbestand.</para>
	  </step>

	  <step>
	    <title>Initialiseer de gbde-partitie</title>

	    <para>Een <application>gbde</application>-partitie dient
	      geïnitialiseerd te worden voordat deze kan worden
	      gebruikt.  Deze initialisatie dient slechts eenmalig
	      uitgevoerd te worden:</para>

	    <screen>&prompt.root; <userinput>gbde init /dev/ad4s1c -i -L /etc/gbde/ad4s1c.lock</userinput></screen>

	    <para>&man.gbde.8; opent een tekstverwerker om verschillende
	      instellingen in een sjabloon te kunnen instellen.  Stel de
	      sector_size in op 2048 als UFS of UFS2 wordt
	      gebruikt:</para>

	    <programlisting># &dollar;FreeBSD: src/sbin/gbde/template.txt,v 1.1 2002/10/20 11:16:13 phk Exp $
#
# Sector size is the smallest unit of data which can be read or written.
# Making it too small decreases performance and decreases available space.
# Making it too large may prevent filesystems from working.  512 is the
# minimum and always safe.  For UFS, use the fragment size
#
sector_size	=	2048
[...]</programlisting>

	    <para>&man.gbde.8; vraagt twee keer om de wachtwoordzin
	      voor het beveiligen van de gegevens.  De wachtwoordzin
	      dient beide keren hetzelfde te zijn.  De mogelijkheid van
	      <application>gbde</application> om de gegevens te
	      beveiligen is geheel afhankelijk de gekozen
	      wachtwoordzin.
	      <footnote>
		<para>Tips met betrekking tot het kiezen van veilige
		  wachtwoordzinnen die gemakkelijk te onthouden zijn
		  staan op de website <link xlink:href="http://world.std.com/~reinhold/diceware.html">
		    Diceware Passphrase</link>.</para></footnote></para>

	    <para>Het commando <command>gbde init</command> maakt een
	      lockbestand aan voor de
	      <application>gbde</application>-partitie die in dit
	      voorbeeld is opgeslagen als
	      <filename>/etc/gbde/ad4s1c.lock</filename>.
	      <application>gdbde</application> slotbestanden moeten
	      eindigen op <quote>.lock</quote> om correct door het
	      opstartscript <filename>/etc/rc.d/gbde</filename>
	      gedetecteerd te worden.</para>

	    <caution>
	      <para><application>gbde</application> lockbestanden
		<emphasis>moeten</emphasis> samen met de inhoud van
		versleutelde partities geback-upped worden.  Hoewel het
		verwijderen van een lockbestand op zich een gedreven
		aanvaller er niet van weerhoudt een
		<application>gbde</application> partitie te
		ontsleutelen, is de wettige eigenaar zonder het
		lockbestand niet in staat om de gegevens op de
		versleutelde partitie te benaderen zonder een
		aanzienlijke hoeveelheid werk die in het geheel niet
		ondersteund wordt door &man.gbde.8; of de ontwerper
		ervan.</para>
	    </caution>
	  </step>

	  <step>
	    <title>Koppel de versleutelde partitie aan de kernel</title>

	    <screen>&prompt.root; <userinput>gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c.lock</userinput></screen>

	    <para>Er wordt om de wachtwoordzin gevraagd die gekozen is
	      tijdens de initialisatie van de versleutelde partitie.  Het
	      nieuwe versleutelde apparaat verschijnt in
	      <filename>/dev</filename> als
	      <filename>/dev/apparaatnaam.bde</filename>:</para>

	    <screen>&prompt.root; <userinput>ls /dev/ad*</userinput>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4        /dev/ad4s1c.bde</screen>
	  </step>

	  <step>
	    <title>Maak een bestandssysteem op het versleutelde
	      apparaat</title>

	    <para>Nu het versleutelde apparaat aan de kernel gekoppeld
	      is, kan een bestandssysteem op het apparaat aangemaakt
	      worden.  Met &man.newfs.8; kan een bestandssysteem op het
	      versleutelde apparaat aangemaakt wordne.  Aangezien het
	      veel sneller is om een nieuw UFS2 bestandssysteem te
	      initialiseren dan om een oud UFS1 bestandssysteem te
	      initialiseren, is het aan te raden om &man.newfs.8; met de
	      optie <option>-O2</option> te gebruiken.</para>

	    <screen>&prompt.root; <userinput>newfs -U -O2 /dev/ad4s1c.bde</userinput></screen>

	    <note>
	      <para>Voer &man.newfs.8; uit op een aangekoppelde
		<application>gbde</application>-partitie die
		geïndificeerd wordt door de uitbreiding
		<filename>*.bde</filename> op
		de apparaatnaam.</para>
	    </note>
	  </step>

	  <step>
	    <title>Mount de versleutelde partitie</title>

	    <para>Maak een koppelpunt voor het versleutelde
	      bestandssysteem aan:</para>

	    <screen>&prompt.root; <userinput>mkdir /private</userinput></screen>

	    <para>Mount het versleutelde bestandssysteem:</para>

	    <screen>&prompt.root; <userinput>mount /dev/ad4s1c.bde /private</userinput></screen>
	  </step>

	  <step>
	    <title>Controleer of het versleutelde bestandssysteem
	      beschikbaar is</title>

	    <para>Het versleutelde bestandssysteem is nu zichtbaar
	      met &man.df.1; en gebruiksklaar:</para>

	    <screen>&prompt.user; <userinput>df -H</userinput>
Filesystem        Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a      1037M    72M   883M     8%    /
/devfs            1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f       8.1G    55K   7.5G     0%    /home
/dev/ad0s1e      1037M   1.1M   953M     0%    /tmp
/dev/ad0s1d       6.1G   1.9G   3.7G    35%    /usr
/dev/ad4s1c.bde   150G   4.1K   138G     0%    /private</screen>
	  </step>
	</procedure>
      </sect3>

      <sect3>
	<title>Bestaande versleutelde bestandssystemen aankoppelen</title>

	<para>Elke keer nadat het systeem is opgestart dient elk
	  versleuteld bestandssysteem opnieuw aan de kernel gekoppeld
	  te worden, op fouten gecontroleerd te worden, en aangekoppeld
	  te worden voordat de bestandssystemen gebruikt kunnen worden.
	  De benodigde commando's dienen als de gebruiker
	  <systemitem class="username">root</systemitem> uitgevoerd te worden.</para>

	<procedure>
	  <step>
	    <title>Koppel de gbde-partitie aan de kernel</title>

	    <screen>&prompt.root; <userinput>gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c.lock</userinput></screen>

	    <para>Er wordt om de wachtwoordzin gevraagd die gekozen is
	      tijdens de initialisatie van de versleutelde
	      <application>gbde</application>-partitie.</para>
	  </step>

	  <step>
	    <title>Controleer het bestandssysteem op fouten</title>

	    <para>Aangezien het nog niet mogelijk is om versleutelde
	      bestandssystemen op te nemen in
	      <filename>/etc/fstab</filename> voor automatische controle,
	      dienen de bestandssystemen voordat ze aangekoppeld worden
	      handmatig op fouten gecontroleerd te worden door
	      &man.fsck.8; uit te voeren:</para>

	    <screen>&prompt.root; <userinput>fsck -p -t ffs /dev/ad4s1c.bde</userinput></screen>
	  </step>

	  <step>
	    <title>Mount het versleutelde bestandssysteem</title>

	    <screen>&prompt.root; <userinput>mount /dev/ad4s1c.bde /private</userinput></screen>

	    <para>Het versleutelde bestandssysteem is nu klaar voor
	      gebruik.</para>
	  </step>
	</procedure>

	<sect4>
	  <title>Versleutelde partities automatisch aankoppelen</title>

	  <para>Het is mogelijk om een script aan te maken om
	    automatisch een versleutelde partitie aan te koppelen, op
	    fouten te controleren en aan te koppelen, maar vanwege
	    veiligheidsredenen dient het script niet het wachtwoord
	    voor &man.gbde.8; te bevatten.  In plaats hiervan wordt het
	    aangeraden om zulke scripts handmatig uit te voeren en het
	    wachtwoord via de console of &man.ssh.1; te geven.</para>

	  <para>Als alternatief, wordt er een <filename>rc.d</filename>
	    script bijgeleverd.  De argumenten kunnen via &man.rc.conf.5;
	    doorgegeven worden.  Bijvoorbeeld:</para>

	  <programlisting>gbde_autoattach_all="YES"
gbde_devices="ad4s1c"
gbde_lockdir="/etc/gbde"</programlisting>

	  <para>Hierdoor is het noodzakelijk dat de wachtwoordzin voor
	    <application>gbde</application> bij het starten wordt
	    ingegeven.  Na het invoeren van de juiste wachtwoordzin
	    wordt de met <application>gbde</application> versleutelde
	    partitie automatisch aangekoppeld.  Dit kan erg handig zijn
	    bij het gebruik van <application>gbde</application> op
	    notebooks.</para>
	</sect4>
      </sect3>

      <sect3>
	<title>Door gbde gebruikte cryptografische
	  beschermingen</title>

	<para>&man.gbde.8; versleutelt de sectorlading door gebruik te
	  maken van 128-bit AES in CBC-modus.  Elke sector op de schijf
	  wordt met een andere AES-sleutel versleuteld.  Meer
	  informatie over het cryptografische ontwerp van
	  <application>gbde</application>, inclusief de methode die
	  gebruikt wordt om de sectorsleutels van de door de gebruiker
	  gegeven wachtwoordzin af te leiden, staan in
	  &man.gbde.4;.</para>
      </sect3>

      <sect3>
	<title>Compatibiliteitspunten</title>

	<para>&man.sysinstall.8; is niet compatibel met apparaten die
	  met <application>gbde</application> versleuteld zijn.  Alle
	  <filename>*.bde</filename>
	  apparaten moeten van de kernel ontkoppeld worden voordat
	  &man.sysinstall.8; gebruikt wordt om te voorkomen dat het
	  crasht tijdens het initiële zoeken naar apparaten.  Om
	  het versleutelde apparaat dat in dit voorbeeld gebruikt wordt
	  te ontkoppelen:</para>

	<screen>&prompt.root; <userinput>gbde detach /dev/ad4s1c</userinput></screen>
      </sect3>
    </sect2>

    <sect2>
      <info><title>Schijfversleuteling met <command>geli</command></title>
	<authorgroup>
	  <author><personname><firstname>Daniel</firstname><surname>Gerzo</surname></personname><contrib>Bijgedragen door </contrib></author>
	</authorgroup>
	
      </info>

      

      <para>Een alternatieve cryptografische GEOM klassie is beschikbaar
	- <command>geli</command>.  Deze wordt
	op het moment ontwikkeld door &a.pjd.email;.  <command>geli</command>
	verschilt van <command>gbde</command> in de mogelijkheden en in
	het gebruik van een andere methode voor het
	versleutelen.</para>

      <para>De meest belangrijke mogelijkheden van &man.geli.8;
	zijn:</para>

      <itemizedlist>
	<listitem>
	  <para>Gebruikt het &man.crypto.9; framework;  als
	    cryptografische hardware aanwezig is, gebruikt
	    <command>geli</command> die automatisch;</para>
	</listitem>

	<listitem>
	  <para>Ondersteunt meedere cryptografische algoritmen.  Op dit
	    moment AES, Blowfish en 3DES;</para>
	</listitem>

	<listitem>
	  <para>Staat toe dat de root-partitie wordt versleuteld.  De
	    wachtwoordzin die wordt gebruikt om de root-partitie te
	    versleutelen wordt opgevraagd tijdens het starten van een
	    systeem;</para>
	</listitem>

	<listitem>
	  <para>Staat het gebruik van twee onafhankelijke sleutels toe,
	    bijvoorbeeld een <quote>sleutel</quote> en een
	    <quote>bedrijfssleutel</quote>);</para>
	</listitem>

	<listitem>
	  <para><command>geli</command> is snel;  het werkt met
	    sector-naar-sector versleuteling;</para>
	</listitem>

	<listitem>
	  <para>Ondersteunt back-up en restore van Master Keys.  Als
	    een gebruiker sleutels moet vernietigen, is het mogelijk
	    weer toegang te krijgen tot de gegevens door sleutels uit
	    een back-up te halen;</para>
	</listitem>

	<listitem>
	  <para>Ondersteunt het koppelen van een schijf met een
	    willekeurige, eenmalige sleutel.  Handig voor
	    swap-partities en tijdelijke bestandssystemen.</para>
	</listitem>
      </itemizedlist>

      <para>Meer mogelijkheden van <command>geli</command> staan
	beschreven in de handleiding van &man.geli.8;.</para>

      <para>De volgende stappen beschrijven hoe ondersteuning voor
	<command>geli</command> in de &os;-kernel ingeschakeld kan
	worden en hoe een nieuwe <command>geli</command>
	versleutelingsvoorziening gemaakt kan worden.</para>

      <para>Het is noodzakelijk super-user rechten te hebben omdat
	de kernel wordt aangepast.</para>

      <procedure>
	<step>
	  <title>Toevoegen van <command>geli</command>-ondersteuning</title>

	  <para>Voeg de volgende regels toe aan het bestand met
	    kernelinstellingen:</para>

	  <programlisting>options GEOM_ELI
device crypto</programlisting>

	  <para>Herbouw de kernel zoals beschreven is in <xref linkend="kernelconfig"/>.</para>

	  <para>De <command>geli</command>-module kan ook bij het
	    opstarten geladen worden.  Voeg de volgende regel toe aan
	    <filename>/boot/loader.conf</filename>:</para>

	  <programlisting>geom_eli_load="YES"</programlisting>

	  <para>Nu hoort &man.geli.8; door de kernel ondersteund te
	    worden.</para>
	</step>

	<step>
	  <title>Een Master Key genereren</title>

	  <para>Het volgende voorbeeld beschrijft hoe een
	    sleutelbestand te maken, dat wordt gebruikt als onderdeel
	    van de Master Key voor de versleutelde dienst die wordt
	    aangekoppeld onder <filename>/private</filename>.  Het sleutelbestand
	    zorgt voor wat willekeurige gegevens die worden gebruikt
	    om de Master Key te versleutelen.  De Master Key wordt ook
	    door een wachtwoordzin beschermd.  De sectorgrootte van de
	    dienst wordt 4&nbsp;kB.  Ook wordt beschreven hoe de
	    <command>geli</command>-dienst te koppelen, er een
	    bestandsysteem op te maken, dat aan te koppelen, hoe ermee
	    te werken en tenslotte hoe te ontkoppelen.</para>

	  <para>Het wordt aangeraden een grotere sectorgrootte in te
	    stellen (zoals 4&nbsp;kB) voor betere prestaties.</para>

	  <para>De Master Key wordt beschermd door een wachtwoordzin en
	    de gegevensbron voor het sleutelbestand wordt
	    <filename>/dev/random</filename>.  De sectorgrootte van
	    <filename>/dev/da2.eli</filename>, die als dienst wordt
	    aangeduid, wordt 4&nbsp;kB.</para>

	  <screen>&prompt.root; <userinput>dd if=/dev/random of=/root/da2.key bs=64 count=1</userinput>
&prompt.root; <userinput>geli init -s 4096 -K /root/da2.key /dev/da2</userinput>
Enter new passphrase:
Reenter new passphrase:</screen>

	  <para>Het is niet verplicht om zowel een wachtwoordzijn als
	    een sleutelbestand te gebruiken.  De methodes kunnen
	    onafhankelijk van elkaar gebruikt worden.</para>

	  <para>Als een sleutelbestand wordt opgegeven als
	    <quote>-</quote>, wordt de standaardinvoer gebruikt.  In
	    het onderstaande voorbeeld wordt aangegeven hoe meer dan
	    een sleutelbestand kan worden gebruikt.</para>

	  <screen>&prompt.root; <userinput>cat sleutelbestand1 sleutelbestand2 sleutelbestand3 | geli init -K - /dev/da2</userinput></screen>
	</step>

	<step>
	  <title>De dienst koppelen met de gemaakte sleutel</title>

	  <screen>&prompt.root; <userinput>geli attach -k /root/da2.key /dev/da2</userinput>
Enter passphrase:</screen>

	  <para>Het nieuwe platte tekst-apparaat wordt
	    <filename>/dev/da2.eli</filename>
	    genoemd.</para>

	  <screen>&prompt.root; <userinput>ls /dev/da2*</userinput>
/dev/da2  /dev/da2.eli</screen>
	</step>

	<step>
	  <title>Het nieuwe bestandssysteem maken</title>

	  <screen>&prompt.root; <userinput>dd if=/dev/random of=/dev/da2.eli bs=1m</userinput>
&prompt.root; <userinput>newfs /dev/da2.eli</userinput>
&prompt.root; <userinput>mount /dev/da2.eli /private</userinput></screen>

	  <para>Het versleutelde bestandssysteem moet nu zichtbaar zijn
	    voor &man.df.1; en beschikbaar zijn voor gebruik:</para>

	  <screen>&prompt.root; <userinput>df -H</userinput>
Filesystem     Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a    248M    89M   139M    38%    /
/devfs         1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f    7.7G   2.3G   4.9G    32%    /usr
/dev/ad0s1d    989M   1.5M   909M     0%    /tmp
/dev/ad0s1e    3.9G   1.3G   2.3G    35%    /var
/dev/da2.eli   150G   4.1K   138G     0%    /private</screen>
	</step>

	<step>
	  <title>De dienst afkoppelen</title>

	  <para>Als het werk met de versleutelde partitie is
	    afgehandeld en de <filename>/private</filename>-partitie niet langer
	    nodig is, dan is het verstandig te overwegen de met
	    <command>geli</command> versleutelde partitie af te koppelen
	    van het bestandssysteem en de kernel.</para>

	  <screen>&prompt.root; <userinput>umount /private</userinput>
&prompt.root; <userinput>geli detach da2.eli</userinput></screen>
	</step>
      </procedure>

      <para>Meer informatie over &man.geli.8; staat in de
	handleiding.</para>

      <sect3>
	<title>Gebruik maken van het <filename>geli</filename>
	  <filename>rc.d</filename> script.</title>

	<para>Bij <command>geli</command> hoort een <filename>rc.d</filename>
	  script dat gebruikt kan worden om het gebruik van
	  <command>geli</command> te vereenvoudigen.  Een voorbeeld van
	  hoe <command>geli</command> met &man.rc.conf.5; ingesteld
	  kan worden volgt:</para>

	<programlisting>geli_devices="da2"
geli_da2_flags="-p -k /root/da2.key"</programlisting>

	<para>Hiermee wordt <filename>/dev/da2</filename> ingesteld als
	  <command>geli</command>-dienst met Master Key-bestand
	  <filename>/root/da2.key</filename> en <command>geli</command>
	  gebruikt geen wachtwoordzin als de dienst wordt gekoppeld
	  (dit kan alleen gebruikt worden als <option>-P</option> is meegegeven
	  tijdens de <literal>geli init</literal> fase van
	  <command>geli</command>).  Een systeem ontkoppelt de
	  <command>geli</command>-dienst van de kernel voordat het
	  afsluit.</para>

	<para>Meer informatie over het instellen van rc.d staat in
	  het onderdeel over <link linkend="configtuning-rcd">rc.d</link>.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 xml:id="swap-encrypting">
    <info><title>Het versleutelen van de wisselbestand ruimte</title>
      <authorgroup>
	<author><personname><firstname>Christian</firstname><surname>Brüffer</surname></personname><contrib>Geschreven door </contrib></author>
      </authorgroup>
      <authorgroup>
	<author><personname><firstname>Remko</firstname><surname>Lodder</surname></personname><contrib>Vertaald door </contrib></author>
      </authorgroup>
    </info>

    

    <indexterm>
      <primary>swap</primary>
      <secondary>encrypting</secondary>
    </indexterm>

    <para>Het versleutelen van de wisselbestand ruimte is gemakkelijk
      met &os; te configureren.
      Afhankelijk van welke versie er gebruikt wordt zijn er verschillende
      configuratie opties en instellingen mogelijk.  De &man.gbde.8; en
      &man.geli.8; programma's kunnen gebruikt worden voor het versleutelen
      van het wisselbestand.  Beide systemen maken gebruik van het
      <filename>encswap</filename>
      <link linkend="configtuning-rcd">rc.d</link> script.</para>

    <para>De vorige sectie, <link linkend="disks-encrypting">Schijfpartities
	versleutelen</link>, biedt een korte discussie over de verschillende
      versleutel systemen.</para>

    <sect2>
      <title>Waarom moet het wisselbestand versleuteld worden?</title>

      <para>Net als met het versleutelen van harde schijven, wordt het
	versleutelen van het wisselbestand gebruikt om gevoelige data
	te beschermen.  Stelt u eens een applicatie voor dat omgaat het
	wachtwoorden.  Zolang deze wachtwoorden in het fysieke geheugen
	blijven is er niets aan de hand.  Echter zodra deze verplaatst
	worden naar het wisselbestand om ruimte te maken voor andere
	applicaties, kan het gebeuren dat de wachtwoorden onbeschermd
	op de harde schijf geschreven worden, waardoor het makkelijk
	te achterhalen is voor iemand die kwaad wilt.  Het versleutelen
	van het wisselbestand biedt hierin een mogelijke uitkomst.</para>
    </sect2>

    <sect2>
      <title>Voorbereiding</title>

      <note>
	<para>Tot het einde van deze sectie zal <filename>ad0s1b</filename>
	  het wisselbestand bevatten.</para>
      </note>

      <para>Tot op dit moment is het wisselbestand niet versleuteld.  Het
	is mogelijk dat er reeds wachtwoorden of andere gevoelige data
	onbeschermd op de harde schijf geschreven zijn.  Om dit te
	corrigeren, moet de data op de swap partitie overschreven worden
	met willekeurige data:</para>

      <screen>&prompt.root; <userinput>dd if=/dev/random of=/dev/ad0s1b bs=1m</userinput></screen>
    </sect2>

    <sect2>
      <title>Versleutelen van het wisselbestand met &man.gbde.8;</title>

      <para>Er moet gebruik gemaakt worden van het <literal>.bde</literal>
	achtervoegsel aan het apparaat in de respectievelijke
	<filename>/etc/fstab</filename>-regel betreffende het
	wisselbestand:</para>

      <programlisting># Device		Mountpoint	FStype	Options		Dump	Pass#
/dev/ad0s1b.bde		none		swap	sw		0	0</programlisting>
    </sect2>

    <sect2>
      <title>Versleutelen van het wisselbestand met &man.geli.8;</title>

      <para>Het opzetten van &man.geli.8; voor het versleutelen van het
	wisselbestand is hetzelfde als dat van &man.gbde.8;.  Hier moet
	echter gebruik gemaakt worden van het <literal>.eli</literal>
	achtervoegsel aan het apparaat in de respectievelijke
	<filename>/etc/fstab</filename> wisselbestand regel:</para>

      <programlisting># Device		Mountpoint	FStype	Options		Dump	Pass#
/dev/ad0s1b.eli		none		swap	sw		0	0</programlisting>

      <para>&man.geli.8; maakt standaard gebruik van het <acronym>AES</acronym>
	algoritme met een sleutellengte van 128 bits.</para>

      <para>Optioneel kunnen deze standaardwaarden worden aangepast door
	gebruik te maken van de <literal>geli_swap_flags</literal> optie
	in <filename>/etc/rc.conf</filename>.  De volgende regel verteld
	het <filename>encswap</filename> rc.d bestand om een &man.geli.8;
	wisselbestand te maken met het Blowfish algoritme met een sleutel
	lengte van 128 bit, een sectorgrootte van 4 kilobytes en met de
	optie <quote>ontkoppelen nadat de laatste afsluiting</quote>
	gezet:</para>

      <programlisting>geli_swap_flags="-e blowfish -l 128 -s 4096 -d"</programlisting>

      <para>Zie de uitleg over het <command>onetime</command> commando in
	de &man.geli.8; handleiding voor een lijst van mogelijke opties.</para>
    </sect2>

    <sect2>
      <title>Controleren of het werkt</title>

      <para>Zodra het systeem opnieuw opgestart is kan gekeken worden
	of alles nog goed werkt door gebruik te maken van het
	<command>swapinfo</command> commando.</para>

      <para>Als gebruik gemaakt wordt van &man.gbde.8;:</para>

      <screen>&prompt.user; <userinput>swapinfo</userinput>
Device          1K-blocks     Used    Avail Capacity
/dev/ad0s1b.bde    542720        0   542720     0%</screen>

      <para>Als gebruik gemaakt wordt van &man.geli.8;:</para>

      <screen>&prompt.user; <userinput>swapinfo</userinput>
Device          1K-blocks     Used    Avail Capacity
/dev/ad0s1b.eli    542720        0   542720     0%</screen>
    </sect2>
  </sect1>

  <sect1 xml:id="disks-hast">
    <info><title>Highly Available Storage (HAST)</title>
      <authorgroup>
	<author><personname><firstname>Daniel</firstname><surname>Gerzo</surname></personname><contrib>Bijgedragen door </contrib></author>
      </authorgroup>
      <authorgroup>
	<author><personname><firstname>Freddie</firstname><surname>Cash</surname></personname><contrib>Met informatie van </contrib></author>
	<author><personname><firstname>Pawel Jakub</firstname><surname>Dawidek</surname></personname></author>
	<author><personname><firstname>Michael W.</firstname><surname>Lucas</surname></personname></author>
	<author><personname><firstname>Viktor</firstname><surname>Petersson</surname></personname></author>
      </authorgroup>
      
    </info>

    

    <indexterm>
      <primary>HAST</primary>

      <secondary>hoge beschikbaarheid</secondary>
    </indexterm>

    <sect2>
      <title>Overzicht</title>

      <para>Hoge beschikbaarheid is een van de hoofdzaken in serieuze zakelijke
	toepassingen en hoog beschikbare opslag is een sleutelonderdeel in zulke
	omgevingen.  Hoog beschikbare opslag, of <acronym>HAST<remark role="acronym">Highly Available STorage</remark></acronym>, werd
	ontwikkeld door &a.pjd.email; als een raamwerk dat transparante opslag van
	dezelfde gegevens toestaat over fysiek gescheiden machines die verbonden
	zijn door een TCP/IP-netwerk.  <acronym>HAST</acronym> kan gezien worden
	als een netwerkgebaseerde RAID1 (spiegel) en is vergelijkbaar met het
	DRBD&reg; opslagsysteem bekend van het GNU/&linux; platform.  In
	combinatie met andere eigenschappen voor hoge beschikbaarheid van &os;
	zoals <acronym>CARP</acronym> maakt <acronym>HAST</acronym> het mogelijk
	om een opslagcluster met hoge beschikbaarheid te bouwen dat resistent is
	tegen falende hardware.</para>

      <para>Na het lezen van deze sectie weet u:</para>

      <itemizedlist>
	<listitem>
	  <para>Wat <acronym>HAST</acronym> is, hoe het werkt en welke
	    mogelijkheden het biedt.</para>
	</listitem>

	<listitem>
	  <para>Hoe <acronym>HAST</acronym> op &os; te op te zetten en te
	    gebruiken.</para>
	</listitem>

	<listitem>
	  <para>Hoe <acronym>CARP</acronym> en &man.devd.8; te integreren om een
	    robuust opslagsysteem te bouwen.</para>
	</listitem>
      </itemizedlist>

      <para>Voor het lezen van deze sectie dient u:</para>

      <itemizedlist>
	<listitem>
	  <para>De beginselen van &unix; en &os; te begrijpen (<xref linkend="basics"/>).</para>
	</listitem>

	<listitem>
	  <para>Te weten hoe de netwerkinterfaces en andere kerndeelsystemen van
	    &os; in te stellen (<xref linkend="config-tuning"/>).</para>
	</listitem>

	<listitem>
	  <para>Netwerken op &os; goed te begrijpen (<xref linkend="network-communication"/>).</para>
	</listitem>

	<listitem>
	  <para>&os;&nbsp;8.1-RELEASE of nieuwer te gebruiken.</para>
	</listitem>
      </itemizedlist>

      <para>Het <acronym>HAST</acronym>-project werd gesponsord door The &os;
	Foundation met ondersteuning van <link xlink:href="http://www.omc.net/">
	  OMCnet Internet Service GmbH</link> en <link xlink:href="http://www.transip.nl/">TransIP BV</link>.</para>
    </sect2>

    <sect2>
      <title>Eigenschappen van HAST</title>

      <para>De belangrijkste eigenschappen van <acronym>HAST</acronym>
	zijn:</para>

      <itemizedlist>
	<listitem>
	  <para>Het kan gebruikt worden om I/O-fouten op lokale harde schijven
	    te maskeren.</para>
	</listitem>

	<listitem>
	  <para>Agnostisch qua bestandssysteem, dus het werkt met elk
	    bestandssysteem dat door &os; wordt ondersteund.</para>
	</listitem>

	<listitem>
	  <para>Efficiënte en snelle hersynchronisatie, alleen de blokken
	    die zijn veranderd toen een knooppunt uitstond worden
	    gesynchroniseerd.</para>
	</listitem>

	<!--
	<listitem>
	  <para>Het heeft verschillende synchronisatiemodi die een snelle
	    failover mogelijk maken.</para>
	</listitem>
	-->

	<listitem>
	  <para>Het kan gebruikt worden in reeds uitgerolde omgevingen om
	    aanvullende redundantie toe te voegen.</para>
	</listitem>

	<listitem>
	  <para>Samen met <acronym>CARP</acronym>,
	    <application>Heartbeat</application> of andere gereedschappen kan
	    het worden gebruikt om een robuust en duurzaam opslagsysteem te
	    bouwen.</para>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2>
      <title>Werking van HAST</title>

      <para>Omdat <acronym>HAST</acronym> synchrone replicatie op blokniveau
	van elk opslagmedium naar verscheidene machines biedt, heeft het
	tenminste twee knooppunten (fysieke machines) nodig &mdash; het
	<literal>primaire</literal> (ook bekend als <literal>meester</literal>)
	knooppunt en het <literal>secundaire</literal>
	(<literal>slaaf</literal>) knooppunt.  Tezamen worden deze twee
	machines een cluster genoemd.</para>

      <note>
	<para>HAST is momenteel beperkt tot een totaal van twee
	  clusterknooppunten.</para>
      </note>

      <para>Aangezien <acronym>HAST</acronym> in een primaire-secundaire
	configuratie werkt, kan er op elk moment slechts één van
	de clusterknooppunten actief zijn.  Het <literal>primaire</literal>
	knooppunt, ookwel <literal>actief</literal>, is degene die alle
	I/O-verzoeken aan apparaten die door <acronym>HAST</acronym> worden
	beheerd afhandelt.  Het <literal>secundaire</literal> knooppunt wordt
	dan automatisch gesynchroniseerd vanuit het <literal>primaire</literal>
	knooppunt.</para>

      <para>De fysieke componenten van het <acronym>HAST</acronym>-systeem
	zijn:</para>

      <itemizedlist>
	<listitem>
	  <para>lokale schijf (op primair knooppunt)</para>
	</listitem>

	<listitem>
	  <para>schijf op verre machine (secundair knooppunt)</para>
	</listitem>
      </itemizedlist>

      <para><acronym>HAST</acronym> werkt synchroon op blokniveau, wat het
	transparant maakt voor bestandssystemen en toepassingen.
	<acronym>HAST</acronym> biedt reguliere GEOM-aanbieders aan in <filename>/dev/hast/</filename> voor zowel andere
	gereedschappen als toepassingen, er is dus geen verschil tussen het
	gebruik van apparaten die door <acronym>HAST</acronym> worden geleverd
	en rauwe schijven, partities, etc.</para>

      <para>Elke bewerking met betrekking tot schrijven, verwijderen of spoelen
	wordt naar de plaatselijke schijf en over TCP/IP naar de verre schijf
	gestuurd.  Elke leesbewerking wordt gedaan door de plaatselijke schijf,
	tenzij de plaatselijke schijf niet actueel is of er een I/O-fout
	optreed.  In zulke gevallen wordt de leesbewerking naar het secundaire
	knooppunt gestuurd.</para>

      <sect3>
	<title>Synchronisatie- en replicatiemodi</title>

	<para><acronym>HAST</acronym> probeert om een snel herstel van fouten
	  te leveren.  Om deze reden is het heel belangrijk om de
	  synchronisatietijd te verkorten nadat een knooppunt is hersteld van
	  een uitval.  Om een snelle synchronisatie te leveren, beheert
	  <acronym>HAST</acronym> op de schijf een bitmap van gebruikte extents
	  en synchroniseert het die alleen tijdens een reguliere synchronisatie
	  (met uitzondering van de initiëe synchronisatie).</para>

	<para>Er zijn vele manieren om synchronisatie af te handelen.
	  <acronym>HAST</acronym> implementeert meerdere replicatiemodi om
	  verschillende synchronisatiemethodes af te handelen:</para>

	<itemizedlist>
	  <listitem>
	    <para><emphasis>memsync</emphasis>: rapporteer een schrijfbewerking
	      als voltooid wanneer de plaatselijke schrijfbewerking klaar is en
	      wanneer het verre knooppunt de gegevensaankomst bevestigt, maar
	      voordat het de gegevens daadwerkelijk heeft opgeslagen.  De
	      gegevens op het verre knooppunt zullen meteen na het versturen van
	      de bevestiging worden opgeslagen.  Deze modus is bedoeld om
	      latency te verminderen en nog steeds een zeer goede
	      betrouwbaarheid te bieden.  De replicatiemodus
	      <emphasis>memsync</emphasis> is momenteel niet
	      geïmplementeerd.</para>
	  </listitem>

	  <listitem>
	    <para><emphasis>fullsync</emphasis>: rapporteer een schrijfbewerking
	      als voltooid wanneer zowel de plaatselijke en de verre
	      schrijfbewerking voltooid zijn.  Dit is de veiligste en traagste
	      replicatiemodus.  Dit is de standaardmodus.</para>
	  </listitem>

	  <listitem>
	    <para><emphasis>async</emphasis>: rapporteer de schrijfbewerking als
	      voltooid wanneer de plaatselijke schrijfbewerking klaar is.  Dit
	      is de snelste en gevaarlijkste replicatiemodus.  Het dient
	      gebruikt te worden wanneer er naar een ver knooppunt wordt
	      gerepliceerd en de latency te hoog is voor andere modi.  De
	      replicatiemodus <emphasis>async</emphasis> is momenteel niet
	      geïmplementeerd.</para>
	  </listitem>
	</itemizedlist>

	<warning>
	  <para>Momenteel wordt alleen de replicatiemodus
	    <emphasis>fullsync</emphasis> ondersteund.</para>
	</warning>
      </sect3>
    </sect2>

    <sect2>
      <title>HAST-configuratie</title>

      <para><acronym>HAST</acronym> heeft ondersteuning voor
	<literal>GEOM_GATE</literal> nodig om te kunnen functioneren.  De kernel
	<literal>GENERIC</literal> bevat standaard <emphasis>geen</emphasis>
	<literal>GEOM_GATE</literal>, de laadbare module
	<filename>geom_gate.ko</filename> is echter beschikbaar in de
	standaardinstallatie van &os;.  Zorg ervoor dat deze module beschikbaar
	is voor afgeslankte systemen.  Het is ook mogelijk om ondersteuning voor
	<literal>GEOM_GATE</literal> statisch in de kernel te bouwen, door deze
	regel aan het kernelconfiguratiebestand toe te voegen:</para>

      <programlisting>options	GEOM_GATE</programlisting>

      <para>Het <acronym>HAST</acronym>-raamwerk bestaat vanuit het
	besturingssysteem gezien uit verschillende delen:</para>

      <itemizedlist>
	<listitem>
	  <para>het daemon &man.hastd.8; dat verantwoordelijk is voor de
	    gegevenssynchronisatie,</para>
	</listitem>

	<listitem>
	  <para>het beheerprogramma &man.hastctl.8; voor de gebruikers,</para>
	</listitem>

	<listitem>
	  <para>het configuratiebestand &man.hast.conf.5;.</para>
	</listitem>
      </itemizedlist>

      <para>Het volgende voorbeeld beschrijft hoe twee knooppunten in een
	<literal>meester</literal>-<literal>slaaf</literal> /
	<literal>primaire</literal>-<literal>secundaire</literal> opstelling te
	configureren door <acronym>HAST</acronym> te gebruiken om de gegevens
	tussen de twee te repliceren.  De knooppunten worden
	<literal>hasta</literal> met IP-adres
	<replaceable>172.16.0.1</replaceable> en
	<literal>hastb</literal> met IP-adres
	<replaceable>172.16.0.2</replaceable> genoemd.  Beide knooppunten hebben
	een toegewijde harde schijf
	<filename>/dev/ad6</filename> van
	dezelfde grootte om met <acronym>HAST</acronym> te werken.  De
	<acronym>HAST</acronym>-pool (soms ook een hulpbron genoemd, i.e., de
	GEOM-aanbieder in <filename>/dev/hast/</filename>)
	wordt <filename>test</filename>
	genoemd.</para>

      <para>Het bestand <filename>/etc/hast.conf</filename> regelt de
	configuratie van <acronym>HAST</acronym>.  Dit bestand dient hetzelfde
	te zijn op beide knooppunten.  Het volgende is de eenvoudigste
	configuratie die mogelijk is:</para>

      <programlisting>resource test {
	on hasta {
		local /dev/ad6
		remote 172.16.0.2
	}
	on hastb {
		local /dev/ad6
		remote 172.16.0.1
	}
}</programlisting>

      <para>Raadpleeg voor geavanceerdere configuraties de handleidingpagina
	&man.hast.conf.5;.</para>

      <tip>
	<para>Het is ook mogelijk om hostnamen in de regels met
	  <literal>remote</literal> te gebruiken.  Zorg er in dat geval voor dat
	  deze hosts vindbaar zijn, bijvoorbeeld doordat ze zijn gedefinieerd in
	  het bestand <filename>/etc/hosts</filename> of anders in het
	  plaatselijke <acronym>DNS</acronym>.</para>
      </tip>

      <para>Nu de configuratie op beide knooppunten aanwezig is, kan de
	<acronym>HAST</acronym>-pool aangemaakt worden .  Voer deze commando's
	op beide knooppunten uit om de initiële metagegevens op de
	plaatselijke schijf te plaatsen en het &man.hastd.8;-daemon te
	starten:</para>

      <screen>&prompt.root; <userinput>hastctl create test</userinput>
&prompt.root; <userinput>service hastd onestart</userinput></screen>

      <note>
	<para>Het is <emphasis>niet</emphasis> mogelijk om GEOM-aanbieders met
	  een bestaand bestandssysteem te gebruiken (i.e., een bestaande opslag
	  omzetten naar een door <acronym>HAST</acronym> beheerde pool), omdat
	  deze procedure wat metagegevens op de aanbieder moet opslaan en er
	  daarvoor niet genoeg beschikbare ruimte is.</para>
      </note>

      <para>De rol van een HAST-knooppunt (<literal>primair</literal> of
	<literal>secundair</literal>) wordt uitgekozen door een beheerder of
	software zoals <application>Heartbeat</application> dat het gereedschap
	&man.hastctl.8; gebruikt.  Voer het volgende commando uit op het
	primaire knooppunt (
	<literal>hasta</literal>):</para>

      <screen>&prompt.root; <userinput>hastctl role primary test</userinput></screen>

      <para>Voer dit soortgelijke commando uit op het secundaire knooppunt (
	<literal>hastb</literal>):</para>

      <screen>&prompt.root; <userinput>hastctl role secondary test</userinput></screen>

      <caution>
	<para>De situatie dat de knooppunten niet met elkaar kunnen
	  communiceren en beide geconfigureerd zijn als primaire knooppunten;
	  wordt <literal>split-brain</literal> genoemd.  Volg de stappen zoals
	  beschreven in <xref linkend="disks-hast-sb"/> om deze situatie op te
	  lossen.</para>
      </caution>

      <para>Verifieer met het gereedschap &man.hastctl.8; het resultaat
	op elk knooppunt:</para>

      <screen>&prompt.root; <userinput>hastctl status test</userinput></screen>

      <para>De belangrijke tekst is de regel met <literal>status</literal> dat
	voor alle knooppunten <literal>complete</literal> dient te bevatten.
	Als het <literal>degraded</literal> bevat, is er iets verkeerd gegaan.
	Op dat moment is de synchronisatie tussen de knooppunten al begonnen.
	De synchronisatie is compleet wanneer <command>hastctl status</command>
	0 bytes aan <literal>dirty</literal> extents rapporteert.</para>

      <para>De volgende stap is het aanmaken van een bestandssysteem op de
	GEOM-aanbieder
	<filename>/dev/hast/test</filename> en
	het aan te koppelen.  Dit moet op het <literal>primaire</literal>
	knooppunt gebeuren, aangezien
	<filename>/dev/hast/test</filename> alleen
	op het <literal>primaire</literal> knooppunt verschijnt.  Het aanmaken
	van het bestandssysteem kan afhankelijk van de grootte van de harde
	schijf enkele minuten duren:</para>

      <screen>&prompt.root; <userinput>newfs -U /dev/hast/test</userinput>
&prompt.root; <userinput>mkdir /hast/test</userinput>
&prompt.root; <userinput>mount /dev/hast/test /hast/test</userinput></screen>

      <para>Wanneer het <acronym>HAST</acronym>-raamwerk correct is
	geconfigureerd, betreft de laatste stap het ervoor zorgen dat
	<acronym>HAST</acronym> automatisch tijdens het opstarten wordt gestart.
	Voeg deze regel toe aan het bestand
	<filename>/etc/rc.conf</filename>:</para>

      <programlisting>hastd_enable="YES"</programlisting>

      <sect3>
	<title>Failover-configuratie</title>

	<para>Het doel van dit voorbeeld is om een robuust opslagsysteem te
	  bouwen dat resistent is tegen het falen van alle knooppunten.  Het
	  scenario is dat een <literal>primair</literal> knooppunt van het
	  cluster faalt.  Als dit gebeurt, dan neemt het
	  <literal>secundaire</literal> knooppunt het feilloos over, controleert
	  het het bestandssysteem en koppelt het het bestandssysteem aan, en
	  gaat het verder zonder dat er een bit aan gegevens ontbreekt.</para>

	<para>Om dit voor elkaar te krijgen, is er een andere eigenschap die
	  beschikbaar is op &os; dat voorziet in automatische failover van de
	  IP-laag &mdash; <acronym>CARP</acronym>.
	  <acronym>CARP</acronym> (Common Address Redundancy Protocol)
	  maakt het mogelijk dat meerdere hosts in hetzelfde netwerksegment
	  een IP-adres delen.  Stel <acronym>CARP</acronym> in op beide
	  knooppunten van het cluster volgens de documentatie die beschikbaar is
	  in <xref linkend="carp"/>.  Nadat de opzet voltooid is, heeft elk
	  knooppunt een eigen interface <filename>carp0</filename> met een
	  gedeeld IP-adres <replaceable>172.16.0.254</replaceable>.  Het
	  primaire <acronym>HAST</acronym>-knooppunt van het
	  cluster moet het meester-<acronym>CARP</acronym>-knooppunt
	  zijn.</para>

	<para>De <acronym>HAST</acronym>-pool die in de vorige sectie is gemaakt
	  is nu klaar om geëxporteerd te worden naar de andere hosts op het
	  netwerk.  Dit kan gedaan worden door het te exporteren over
	  <acronym>NFS</acronym>, <application>Samba</application>, etc., door
	  gebruik te maken van het gedeelde IP-adres
	  <replaceable>172.16.0.254</replaceable>.  Het enige overgebleven
	  probleem is een automatische failover in het geval dat het primaire
	  knooppunt het begeeft.</para>

	<para>Als een <acronym>CARP</acronym>-interface aan- of uitgaat,
	  genereert &os; een &man.devd.8;-gebeurtenis, wat het mogelijk maakt om
	  toestandsveranderingen op de <acronym>CARP</acronym>-interfaces in de
	  gaten te houden.  Een toestandsverandering op het
	  <acronym>CARP</acronym>-interface geeft aan dat een van de knooppunten
	  het begaf of weer online kwam.  Deze toestandsveranderingen maken het
	  mogelijk om een script te draaien dat automatisch de HAST-failover
	  afhandelt.</para>

	<para>Voeg, om toestandsverandering op de
	  <acronym>CARP</acronym>-interfaces af te vangen, het volgende
	  toe aan het bestand
	  <filename>/etc/devd.conf</filename> op elk knooppunt:</para>

	<programlisting>notify 30 {
	match "system" "IFNET";
	match "subsystem" "carp0";
	match "type" "LINK_UP";
	action "/usr/local/sbin/carp-hast-switch master";
};

notify 30 {
	match "system" "IFNET";
	match "subsystem" "carp0";
	match "type" "LINK_DOWN";
	action "/usr/local/sbin/carp-hast-switch slave";
};</programlisting>

	<para>Herstart &man.devd.8; op beide knooppunten om de nieuwe
	  configuratie te laten gelden:</para>

	<screen>&prompt.root; <userinput>service devd restart</userinput></screen>

	<para>Als het interface <filename>carp0</filename> aan of uit gaat
	  (i.e., de toestand van het interface verandert), genereert het systeem
	  een notificatie wat het subsysteem &man.devd.8; in staat stelt om een
	  willekeurig script te draaien, in dit geval
	  <filename>/usr/local/sbin/carp-hast-switch</filename>.  Dit is het
	  script dat de automatische failover afhandelt.  Raadpleeg de
	  handleidingpagina &man.devd.conf.5; voor verdere uitleg over de
	  bovenstaande configuratie van &man.devd.8;.</para>

	<para>Dit zou een voorbeeld van zo'n script kunnen zijn:</para>

	<programlisting>#!/bin/sh
# Origineel script door Freddie Cash &lt;fjwcash@gmail.com&gt;
# Gewijzigd door Michael W. Lucas &lt;mwlucas@BlackHelicopters.org&gt;
# en Viktor Petersson &lt;vpetersson@wireload.net&gt;

# De namen van de HAST-hulpbronnen, zoals vermeld in /etc/hast.conf
resources="test"

# vertraging voor het aankoppelen van de HAST-hulpbron na het worden van meester
# doe een gok
delay=3

# logging
log="local0.debug"
name="carp-hast"

# einde van gebruiker-instelbare dingen

case "$1" in
	master)
		logger -p $log -t $name "Omschakelen naar primaire aanbieder voor ${resources}."
		sleep ${delay}

		# Wacht totdat de "hastd secondary" processen zijn gestopt
		for disk in ${resources}; do
			while $( pgrep -lf "hastd: ${disk} \(secondary\)" &gt; /dev/null 2&gt;&amp;1 ); do
				sleep 1
			done

			# Verwissel de rol voor elke schijf
			hastctl role primary ${disk}
			if [ $? -ne 0 ]; then
				logger -p $log -t $name "Omschakelen van rol naar primair voor hulpbron ${disk} mislukt."
				exit 1
			fi
		done

		# Wacht totdat de apparaten /dev/hast/* verschijnen
		for disk in ${resources}; do
			for I in $( jot 60 ); do
				[ -c "/dev/hast/${disk}" ] &amp;&amp; break
				sleep 0.5
			done

			if [ ! -c "/dev/hast/${disk}" ]; then
				logger -p $log -t $name "GEOM-aanbieder /dev/hast/${disk} is niet verschenen."
				exit 1
			fi
		done

		logger -p $log -t $name "Rollen van HAST-hulpbronnen ${resources} omgeschakeld naar primair."


		logger -p $log -t $name "Schijven aankoppelen."
		for disk in ${resources}; do
			mkdir -p /hast/${disk}
			fsck -p -y -t ufs /dev/hast/${disk}
			mount /dev/hast/${disk} /hast/${disk}
		done

	;;

	slave)
		logger -p $log -t $name "Omschakelen naar secundaire aanbieder voor ${resources}."

		# Schakel de rollen van de HAST-hulpbronnen om
		for disk in ${resources}; do
			if ! mount | grep -q "^/dev/hast/${disk} on "
			then
			else
				umount -f /hast/${disk}
			fi
			sleep $delay
			hastctl role secondary ${disk} 2&gt;&amp;1
			if [ $? -ne 0 ]; then
				logger -p $log -t $name "Omschakelen van rol naar secundair voor hulpbron ${disk} mislukt."
				exit 1
			fi
			logger -p $log -t $name "Rol van hulpbron ${disk} omgeschakeld naar secundair."
		done
	;;
esac</programlisting>

	<para>In een notendop neemt het script deze acties wanneer een knooppunt
	  <literal>meester</literal> / <literal>primair</literal> wordt:</para>

	<itemizedlist>
	  <listitem>
	    <para>De <acronym>HAST</acronym>-pools opwaarderen naar primair op
	      een gegeven knooppunt.</para>
	  </listitem>

	  <listitem>
	    <para>Het bestandssysteem onder de <acronym>HAST</acronym>-pool
	      controleren.</para>
	  </listitem>

	  <listitem>
	    <para>De pools op een juiste plaats aankoppelen.</para>
	  </listitem>
	</itemizedlist>

	<para>Wanneer een knooppunt <literal>back-up</literal> /
	  <literal>secundair</literal> wordt:</para>

	<itemizedlist>
	  <listitem>
	    <para>De <acronym>HAST</acronym>-pools afkoppelen.</para>
	  </listitem>

	  <listitem>
	    <para>De <acronym>HAST</acronym>-pools degraderen naar
	      secundair.</para>
	  </listitem>
	</itemizedlist>

	<caution>
	  <para>Houd in gedachte dat dit slechts een voorbeeldscript is om aan
	    te tonen dat alles werkt.  Het behandeld niet alle mogelijke
	    situaties en kan op elke manier worden uitgebreid of veranderd, het
	    kan bijvoorbeeld benodigde diensten starten en stoppen.</para>
	</caution>

	<tip>
	  <para>Voor dit voorbeeld hebben we een standaard UFS-bestandssysteem
	    gebruikt.  Om de tijd die nodig is voor herstel te verkorten, kan
	    een bestandssysteem met UFS-journalling of ZFS worden
	    gebruikt.</para>
	</tip>

	<para>Meer gedetailleerde informatie met aanvullende voorbeelden kunnen
	  gevonden worden op de <link xlink:href="http://wiki.FreeBSD.org/HAST">HAST Wiki</link>-pagina.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Problemen oplossen</title>

      <sect3>
	<title>Algemene tips om problemen op te lossen</title>

	<para><acronym>HAST</acronym> zou over het algemeen zonder problemen
	  moeten werken.  Net als met elk ander software-product zijn er
	  momenten waarop het anders werkt dan het zou moeten.  De oorzaken van
	  de problemen kunnen verschillen, maar de vuistregel is om ervoor te
	  zorgen dat de klokken zijn gesynchroniseerd op alle knooppunten in het
	  cluster.</para>

	<para>Wanneer problemen met <acronym>HAST</acronym> worden verholpen,
	  dient het debug-niveau van &man.hastd.8; verhoogd te worden door het
	  daemon &man.hastd.8; met het argument <literal>-d</literal> op te
	  starten.  Merk op dat dit argument meerdere malen kan worden opgegeven
	  om het debug-niveau nog verder op te hogen.  Op deze manier kan veel
	  nuttige informatie worden vergaard.  Overweeg ook om het argument
	  <literal>-F</literal> te gebruiken, dat het daemon &man.hastd.8; in
	  de voorgrond zal starten.</para>
      </sect3>

      <sect3 xml:id="disks-hast-sb">
	<title>Herstellen van de Split-brain-conditie</title>

	<para><literal>Split-brain</literal> treedt op waneer de knooppunten van
	  het cluster niet met elkaar kunnen communiceren, en beide als primair
	  zijn geconfigureerd.  Dit is een gevaarlijke situatie omdat het beide
	  knooppunten in staat stelt om incompatibele veranderingen aan de
	  gegevens te maken.  Dit probleem dient handmatig door de
	  systeembeheerder te worden gecorrigeerd.</para>

	<para>De beheerder moet besluiten welk knooppunt de belangrijkere
	  veranderingen bevat (of ze handmatig samenvoegen) en
	  <acronym>HAST</acronym> een volledige synchronisatie op het knooppunt
	  dat de kapotte gegevens heeft laten uitvoeren.  Voer hiervoor deze
	  commando's uit op het knooppunt dat opnieuw gesynchroniseerd moet
	  worden:</para>

	<screen>&prompt.root; <userinput>hastctl role init &lt;resource&gt;</userinput>
&prompt.root; <userinput>hastctl create &lt;resource&gt;</userinput>
&prompt.root; <userinput>hastctl role secondary &lt;resource&gt;</userinput></screen>
      </sect3>
    </sect2>
  </sect1>
</chapter>

<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->

<chapter id="disks">
  <title>Almacenamiento</title>

  <sect1 id="disks-synopsis">
    <title>Sinopsis</title>


    <para>Este cap&iacute;tulo trata sobre el uso de discos en &os;.  
      Esto incluye discos basados en memoria, discos conectados 
      a trav&eacute;s de la red, dispositivos de almacenamiento SCSI/IDE 
      est&aacute;ndar y dispositivos que utilizan el interfaz 
      USB.</para>

    <para>Tras leer este cap&iacute;tulo:</para>
    <itemizedlist>
      <listitem><para>Conocer&aacute; la terminolog&iacute;a que se usa en 
        &os; para describir la organizaci&oacute;n de datos en un disco 
        f&iacute;sico (particiones y porciones).</para>
      </listitem>
      <listitem><para>Sabr&aacute; c&oacute;mo a&ntilde;adir discos duros 
        a su sistema.</para>
      </listitem>
      <listitem>
        <para>Sabr&aacute; c&oacute;mo configurar &os; para utilizar 
          dispositivos de almacenamiento USB.</para>
      </listitem>
      <listitem><para>Sabr&aacute; c&oacute;mo configurar sistemas virtuales 
        de ficheros, como los discos de memoria.
        </para></listitem>
      <listitem>
        <para>Sabr&aacute; c&oacute;mo usar cuotas para limitar el uso del 
          espacio en disco.</para>
      </listitem>
      <listitem>
        <para>Sabr&aacute; c&oacute;mo cifrar discos para hacerlos m&aacute;s 
          seguros ante un atacante.</para>
      </listitem>
      <listitem>
        <para>Sabr&aacute; c&oacute;mo se crean y graban los CD y DVD en 
          &os;.</para>
      </listitem>
      <listitem>
        <para>Conocer&aacute; diversas opciones de almacenamiento de copias 
          de seguridad.</para>
      </listitem>
      <listitem>
        <para>Sabr&aacute; c&oacute;mo usar diversos programas de respaldo 
          que pueden utilizarse en &os;.</para>
      </listitem>
      <listitem>
        <para>Sabr&aacute; c&oacute;mo hacer copias de seguridad utilizando 
          disquetes (floppy).</para>
      </listitem>
      <listitem>
        <para>Sabr&aacute; en qu&eacute; consiste una instant&aacute;nea 
          (<quote>snapshot</quote>) y c&oacute;mo utilizarla 
          de forma eficiente.</para>
      </listitem>
    </itemizedlist>

    <para>Antes de leer este cap&iacute;tulo:</para>

    <itemizedlist>
      <listitem>
        <para>Debe saber c&oacute;mo configurar e instalar un nuevo kernel 
          en &os; (<xref linkend="kernelconfig">).</para>
      </listitem>
    </itemizedlist>

  </sect1>

  <sect1 id="disks-naming">
    <title>Nombres de dispositivo</title>

    <para>A continuaci&oacute;n le mostraremos una lista de dispositivos 
      de f&iacute;sicos almacenamiento soportados por &os; 
      y los nombres de dispositivo asociados con ellos.</para>

    <table id="disk-naming-physical-table" frame="none">
      <title>Convenciones para nombrar discos f&iacute;sicos</title>

      <tgroup cols="2">
	<thead>
	  <row>
	    <entry>Tipo de unidad</entry>
	    <entry>Nombre de dispositivo de la unidad</entry>
	  </row>
	</thead>
	<tbody>
	  <row>
	    <entry>Discos duros IDE</entry>
	    <entry><literal>ad</literal></entry>
	  </row>
	  <row>
	    <entry>Unidades CDROM IDE</entry>
	    <entry><literal>acd</literal></entry>
	  </row>
	  <row>
	    <entry>Discos duros SCSI y dispositivos de almacenamiento masivo 
              USB</entry>
	    <entry><literal>da</literal></entry>
	  </row>
	  <row>
	    <entry>Unidades CDROM SCSI</entry>
	    <entry><literal>cd</literal></entry>
	  </row>
	  <row>
	    <entry>Diferentes tipos de unidades CDROM no est&aacute;ndares</entry>
	    <entry><literal>mcd</literal> para CD-ROM Mitsumi, 
	      <literal>scd</literal> para CD-ROM Sony, 
	      <literal>matcd</literal> para CD-ROM Matsushita/Panasonic 
		<footnote>
                  <para>El controlador &man.matcd.4; ha sido eliminado 
                    de la rama FreeBSD&nbsp;4.X el 5 de octubre 
                    de 2002 y no existe en FreeBSD&nbsp;5.0 y 
                    versiones posteriores.</para>
		</footnote>
	    </entry>
	  </row>
	  <row>
	    <entry>Unidades de disquete (floppy)</entry>
	    <entry><literal>fd</literal></entry>
	  </row>
	  <row>
	    <entry>Unidades de cinta SCSI</entry>
	    <entry><literal>sa</literal></entry>
            </row>
	  <row>
	    <entry>Unidades de cinta IDE</entry>
	    <entry><literal>ast</literal></entry>
	  </row>
	  <row>
	    <entry>Unidades Flash</entry>
	    <entry><literal>fla</literal> para dispositivos &diskonchip;</entry>
	  </row>
	  <row>
	    <entry>Unidades RAID</entry>
	    <entry><literal>aacd</literal> para &adaptec; AdvancedRAID,
	      <literal>mlxd</literal> y <literal>mlyd</literal>
	      para &mylex;,
	      <literal>amrd</literal> para AMI &megaraid;,
	      <literal>idad</literal> para Compaq Smart RAID,
	      <literal>twed</literal> para &tm.3ware; RAID.</entry>
	  </row>
	</tbody>
      </tgroup>
    </table>
  </sect1>

  <sect1 id="disks-adding">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>David</firstname>
	  <surname>O'Brien</surname>
	  <contrib>Texto original de </contrib>
	</author>
      </authorgroup>
      <!-- 26 Apr 1998 -->
    </sect1info>

    <title>A&ntilde;adir discos</title>

    <indexterm>
      <primary>discos</primary>
      <secondary>a&ntilde;adir</secondary>
    </indexterm>

    <para>Digamos que queremos a&ntilde;adir un nuevo disco SCSI a una 
      m&aacute;quina que solo tiene un disco.  Comience por apagar el 
      sistema e instale el disco siguiendo las instrucciones del fabricante 
      de la computadora, del disco y de la controladora.  Debido a la gran 
      variedad de procedimientos posibles los detalles est&aacute;n m&aacute;s 
      all&aacute; del alcance de este texto.</para>

    <para>Entre como usuario <username>root</username>.  Una vez instalado el 
      disco inspeccione <filename>/var/run/dmesg.boot</filename>
      para asegurarse de que el sistema encontr&oacute; el nuevo disco.  
      Continuando con nuestro ejemplo, el disco reci&eacute;n a&ntilde;adido 
      ser&aacute;
      <devicename>da1</devicename> y queremos montarlo en
      <filename>/1</filename> (si est&aacute; a&ntilde;adiendo un disco IDE, 
      el nombre de dispositivo ser&aacute; 
      <devicename>wd1</devicename> en sistemas anteriores a 4.0, y 
      <devicename>ad1</devicename> en sistemas 4.X y 5.X).</para>

    <indexterm><primary>particiones</primary></indexterm>
    <indexterm><primary>slices</primary></indexterm>
    <indexterm>
      <primary><command>fdisk</command></primary>
    </indexterm>

    <para>&os; funciona en computadoras IBM-PC y compatibles, por lo tanto 
      tendr&aacute; en cuenta las particiones de la BIOS del PC, que son 
      diferentes del tipo de partici&oacute;n que se ha venido usando en 
      BSD.  Un disco para PC puede contener hasta cuatro entradas de 
      particiones BIOS.  Si el disco va a utilizarse &iacute;ntegramente 
      con &os; puede usar el modo  
      <emphasis>dedicado</emphasis>.  Si no, &os; tendr&aacute; que 
      instalarse dentro de una las particiones BIOS.  En &os; se llama 
      slices (<quote>porciones</quote> o <quote>rebanadas</quote>) a las 
      particiones de PC BIOS para no confundirlas con las particiones BSD.  
      Tambi&eacute;n puede utilizar slices en un disco dedicado a 
      &os; pero que se est&aacute; usando en un sistema que tambi&eacute;n 
      tiene otro sistema operativo instalado.  
      Esta es una buena manera de evitar confundir la versi&oacute;n de 
      <command>fdisk</command> de otros sistemas operativos.</para>

    <para>Desde el punto de vista de las slices el disco se 
      a&ntilde;adir&aacute; como <filename>/dev/da1s1e</filename>.  
      Se interpreta del siguiente modo: disco SCSI, unidad 
      n&uacute;mero 1 (segundo disco SCSI), slice 1 (partici&oacute;n 1
      de PC BIOS), y partici&oacute;n BSD <filename>e</filename>.  
      Si es un disco dedicado, el disco se a&ntilde;adir&aacute; como 
      <filename>/dev/da1e</filename>.</para>

    
    <para>Debido al uso de enteros de 32-bits para almacenar el n&uacute;mero 
      de sectores, &man.bsdlabel.8; (llamado &man.disklabel.8; en 
      &os;&nbsp;4.X) est&aacute; limitado a 2^32-1 sectores por disco 
      &oacute; 2TB (en la mayor&iacute; de los casos).  El formato de 
      &man.fdisk.8; permite un sector de arranque de un m&aacute;ximo de 
      m&aacute;s de 2^32-1 y no m&aacute;s de 2^32-1 de longitud, limitando 
      limitando las particiones a 2TB y los discos a 4TB (tambi&eacute;n en 
      la mayor&iacute;a de los casos).  El formato &man.sunlabel.8; tiene 
      una limitaci&oacute;n de 2^32-1 sectores por partici&oacute;n y 8 
      particiones en un espacio m&aacute;ximo de 16TB.  Si va a usar discos 
      mayores puede usar particiones &man.gpt.8;.</para>

    <sect2>
      <title>Uso de &man.sysinstall.8;</title>
      <indexterm>
        <primary><application>sysinstall</application></primary>
        <secondary>a&ntilde;adir discos</secondary>
      </indexterm>
      <indexterm>
	<primary>su</primary>
      </indexterm>
      <procedure>
	<step>
	  <title>Navegar en <application>Sysinstall</application></title>


          <para>Puede utilizar <command>sysinstall</command>
            (<command>/stand/sysinstall</command> en versiones de &os; 
            anteriores a 5.2) para particionar y etiquetar un 
            disco nuevo usando sus intuitivos men&uacute;s.  
            Entre como el usuario <username>root</username> o utilice 
            <command>su</command>.  Ejecute 
            <command>sysinstall</command> y entre al men&uacute; 
            <literal>Configure</literal>.  Dentro de 
            <literal>FreeBSD Configuration Menu</literal>, descienda 
            y seleccione la opci&oacute;n <literal>Fdisk</literal>.</para>
	</step>

	<step>
	  <title>Editor de particiones <application>fdisk</application></title>

          <para>Una vez dentro de <application>fdisk</application>, 
            tecl&eacute;e <userinput>A</userinput> si quiere usar el 
            disco entero con &os;  Cuando se le pregunte 
            <quote>remain cooperative with any future 
            possible operating systems</quote>
            <footnote><para>
            Mantener el disco accesible a sistemas operativos que pudieran 
            necesitar acceder al mismo en alg&uacute;n momento.
            </para></footnote>, responda <literal>YES</literal>.  
            Escriba los cambios al disco pulsando <userinput>W</userinput>.  
            Salga del editor FDISK pulsando <userinput>q</userinput>.  
            A continuaci&oacute;n se le preguntar&aacute; sobre el 
            <quote>Master Boot Record</quote>.  Debido a que est&aacute; 
            a&ntilde;adiendo un nuevo disco a un sistema que ya est&aacute; 
            instalado, tendr&aacute; que seleccionar 
            <literal>None</literal>.</para>
	</step>

	<step>
	  <title>Editor de etiquetas de disco</title>

	  <indexterm><primary>particiones BSD</primary></indexterm>

          <para>A continuaci&oacute;n, debe salir de 
            <application>sysinstall</application> e iniciarlo de nuevo.  
            Siga las instrucciones arriba expuestas, pero esta vez elija la 
            opci&oacute;n <literal>Label</literal>.  De este modo 
            acceder&aacute; al 
            <literal>editor de etiquetas de disco</literal>.  
            En &eacute;l  crear&aacute; las particiones BSD 
            tradicionales.  Un disco puede tener hasta ocho particiones, 
            etiquetadas desde la <literal>a</literal> a la 
            <literal>h</literal>.  
            Algunas de las etiquetas de las particiones tienen 
            usos especiales.  La partici&oacute;n <literal>a</literal> 
            se utiliza para la partici&oacute;n ra&iacute;z 
            (<filename>/</filename>), por lo tanto s&oacute;lo su disco 
            de sistema (esto es, el disco desde el cual arranca) 
            tendr&aacute; una partici&oacute;n <literal>a</literal>.  
            La partici&oacute;n <literal>b</literal> se usa como 
            partici&oacute;n swap; puede tener m&aacute;s de una 
            partici&oacute;n swap y puede alojarlas en m&aacute;s de un 
            disco.  La partici&oacute;n <literal>c</literal>
            hace referencia al disco entero en modo dedicado, o a 
            la slice de &os; completa en modo slice.  Las dem&aacute;s 
            particiones son para el resto de los usos t&iacute;picos.</para>

          <para>El editor de etiquetas de 
            <application>sysinstall</application>
            crear&aacute; la partici&oacute;n <literal>e</literal> como 
            partici&oacute;n <quote>ni ra&iacute;z, ni swap</quote>.  
            En el editor de etiquetas cr&eacute;e un solo sistema de 
            ficheros tecleando <userinput>C</userinput>.  Cuando se 
            le pregunte si debe etiquetarse como FS (sistema de ficheros) o 
            swap, elija <literal>FS</literal> y tecl&eacute;e un punto de 
            montaje (por ejemplo <filename>/mnt</filename>).  Al 
            a&ntilde;adir un disco en modo 
            <quote>post-instalaci&oacute;n</quote> 
            <application>sysinstall</application> no crear&aacute; 
            autom&aacute;ticamente las entradas correspondientes en 
            <filename>/etc/fstab</filename>, por lo que el punto de 
            montaje que usted especifique no tiene importancia.</para>

          <para>Ahora puede escribir la nueva etiqueta al disco y 
            crear un sistema de ficheros en &eacute;l tecleando 
            <userinput>W</userinput>.  Ignore cualquier error que 
            pudiera generar <application>sysinstall</application> acerca 
            de dificultades para montar la nueva partici&oacute;n.  Salga del 
            editor de etiquetas y de <application>sysinstall</application>.
            </para>
	</step>

	<step>
	  <title>Terminar</title>

          <para>El &uacute;ltimo paso es editar 
            <filename>/etc/fstab</filename>
            y a&ntilde;adir una entrada para su nuevo disco.</para>
	</step>
      </procedure>
    </sect2>

    <sect2>
      <title>Uso de utilidades de l&iacute;nea de comandos</title>

      <sect3>
	<title>Uso de slices</title>

        <para>Esta configuraci&oacute;n le permitir&aacute; a su 
          disco convivir sin sobresaltos con otro sistema operativo 
          que pueda estar instalado en su sistema y no 
          confundir&aacute; a las utilidades <command>fdisk</command> de 
          esos otros sistemas operativos.  Se recomienda utilizar este 
          m&eacute;todo para instalar discos nuevos.  
          <emphasis>Utilice el modo dedicado s&oacute;lamente si tiene 
          un buen motivo para hacerlo</emphasis>.</para>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=/dev/da1 bs=1k count=1</userinput>
&prompt.root; <userinput>fdisk -BI da1</userinput> #Initialice el nuevo disco.
&prompt.root; <userinput>disklabel -B -w -r da1s1 auto</userinput> #Etiqu&eacute;telo.
&prompt.root; <userinput>disklabel -e da1s1</userinput> # Edite la etiqueta de disco que acaba de crear y a&ntilde;ada particiones.  
&prompt.root; <userinput>mkdir -p /1</userinput>
&prompt.root; <userinput>newfs /dev/da1s1e</userinput> # Repita este paso por cada partici&oacute;n que cr&eacute;e.  
&prompt.root; <userinput>mount /dev/da1s1e /1</userinput> # Monte la partici&oacute;n o particiones.  
&prompt.root; <userinput>vi /etc/fstab</userinput> # A&ntilde;ada la/s entrada/s apropiadas en <filename>/etc/fstab</filename>.</screen>

        <para>Si tiene un disco IDE, sustituya <filename>ad</filename>
          por <filename>da</filename>.  En sistemas anteriores a 4.X 
          utilice <filename>wd</filename>.</para>
      </sect3>

      <sect3>
	<title>Dedicado</title>
	<indexterm><primary>OS/2</primary></indexterm>

        <para>Si no va a compartir el nuevo disco con otro sistema 
          operativo puede utilizar el modo <literal>dedicado</literal>.  
          Recuerde que este modo puede confundir a los sistemas operativos 
          de Microsoft, aunque no podr&aacute;n da&ntilde;ar por ello el 
          disco o su contenido.  Tenga en cuenta que &os; (de IBM) 
          se <quote>apropiar&aacute;</quote> de cualquier partici&oacute;n 
          que encuentre y no entienda.</para>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=/dev/da1 bs=1k count=1</userinput>
&prompt.root; <userinput>disklabel -Brw da1 auto</userinput>
&prompt.root; <userinput>disklabel -e da1</userinput>				# crear partici&oacute;n `e'
&prompt.root; <userinput>newfs -d0 /dev/da1e</userinput>
&prompt.root; <userinput>mkdir -p /1</userinput>
&prompt.root; <userinput>vi /etc/fstab</userinput>				# agregar una entrada para /dev/da1e
&prompt.root; <userinput>mount /1</userinput></screen>

        <para>Una forma alternativa de hacerlo ser&iacute;a:</para>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=/dev/da1 count=2</userinput>
&prompt.root; <userinput>disklabel /dev/da1 | disklabel -BrR da1 /dev/stdin</userinput>
&prompt.root; <userinput>newfs /dev/da1e</userinput>
&prompt.root; <userinput>mkdir -p /1</userinput>
&prompt.root; <userinput>vi /etc/fstab</userinput>					# a&ntilde;adir una entrada para /dev/da1e
&prompt.root; <userinput>mount /1</userinput></screen>

        <note><para>A partir de &os;&nbsp;5.1-RELEASE, la utilidad 
          &man.bsdlabel.8; reemplaz&oacute; al antiguo programa 
          &man.disklabel.8;.  En &man.bsdlabel.8; se han eliminado muchos 
          par&aacute;metros y opciones obsoletas;  
          en los ejemplos de arriba la opci&oacute;n <option>-r</option> 
          debe eliminarse si se usa &man.bsdlabel.8;.  Para m&aacute;s 
          informaci&oacute;n dir&iacute;jase al manual 
          de &man.bsdlabel.8;.</para></note>
      </sect3>
    </sect2>
  </sect1>

  <sect1 id="raid">
    <title>RAID</title>

    <sect2 id="raid-soft">
      <title>Software RAID</title>

      <sect3 id="ccd">
	<sect3info>
	  <authorgroup>
	    <author>
	      <firstname>Christopher</firstname>
	      <surname>Shumway</surname>
	      <contrib>Texto original de </contrib>
	    </author>
	  </authorgroup>
	  <authorgroup>
	    <author>
	      <firstname>Jim</firstname>
	      <surname>Brown</surname>
	      <contrib>Revisado por </contrib>
	    </author>
	  </authorgroup>
	</sect3info>

<indexterm><primary>RAID</primary><secondary>software</secondary></indexterm>
<indexterm>
  <primary>RAID</primary><secondary>CCD</secondary>
</indexterm>

	<title>Configuraci&oacute;n de controlador de disco 
          concatenado (CCD)</title>

        <para>Al escoger una soluci&oacute;n de almacenamiento masivo 
          los factores m&aacute;s importantes a considerar son velocidad, 
          fiabilidad y coste.  Es raro tener los tres por igual; 
          normalmente un dispositivo de almacenamiento masivo veloz y 
          fiable es caro, y para recortar los costes suele sacrificarse 
          la velocidad o la fiabilidad.</para>

        <para>Al dise&ntilde;ar el sistema descrito m&aacute;s adelante se 
          eligi&oacute; el coste como el factor m&aacute;s importante, 
          seguido de la velocidad, y luego la fiabilidad.  
          La velocidad de transferencia de datos para este sistema est&aacute;,
          en &uacute;ltima instancia, limitada por la red.  Y mientras que la 
          confiabilidad es muy importante, el controlador CCD descrito 
          m&aacute;s adelante sirve datos que est&aacute;n respaldados 
          en CD-R y pueden ser reemplazados sin dificultad.</para>

        <para>Al escoger una soluci&oacute;n de almacenamiento masivo el 
          primer paso es definir sus necesidades.  Si prefiere velocidad o 
          fiabilidad por encima del coste, el resultado ser&aacute; 
          distinto del que vamos a describir en esta secci&oacute;n.
          </para>


	<sect4 id="ccd-installhw">
	  <title>Instalaci&oacute;n del hardware</title>

          <para>Adem&aacute;s del disco IDE, el n&uacute;cleo del 
            disco CCD est&aacute; compuesto por tres discos IDE 
            discos IDE Western Digital de 30GB y 5400 RPM, que 
            ofrecen aproximadamente 90GB de almacenamiento.  
            Lo ideal ser&iacute;a que cada disco IDE tuviera 
            su propio cable y controlador, pero para minimizar 
            costes no se utilizaron controladores IDE adicionales.  
            En lugar de eso se configuraron los discos 
            con <quote>jumpers</quote> para que cada controlador IDE 
            tuviera un maestro y un esclavo.</para>

          <para>Despues de reiniciar la BIOS se configur&oacute; 
            para que detectara autom&aacute;ticamente los discos 
            conectados.  
            &os; los detect&oacute; al reiniciar:</para>

	  <programlisting>ad0: 19574MB &lt;WDC WD205BA&gt; [39770/16/63] at ata0-master UDMA33
ad1: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata0-slave UDMA33
ad2: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata1-master UDMA33
ad3: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata1-slave UDMA33</programlisting>

          <note><para>Si &os; no detecta todos los discos 
            aseg&uacute;rese de que ha colocado correctamente los 
            <quote>jumpers</quote>.  La mayor&iacute;a de los discos IDE 
            tienen  un <quote>jumper</quote> <quote>Cable Select</quote>.  
            Este <emphasis>no</emphasis> es el 
            <quote>jumper</quote> que define la relaci&oacute;n 
            maestro/esclavo.  Consulte la documentaci&oacute;n 
            del disco para identificar el <quote>jumper</quote> 
            correcto.</para></note>

          <para>El siguiente paso es estudiar c&oacute;mo conectarlos 
            para que formen parte del sistema de ficheros.  Investigue 
            Debe investigar &man.vinum.8; 
            (<xref linkend="vinum-vinum">) y &man.ccd.4;. Nosotros 
            elegimos &man.ccd.4; para nuestra 
            configuraci&oacute;n.</para>
	</sect4>

	<sect4 id="ccd-setup">
	  <title>Configuraci&oacute;n de CCD</title>

          <para>El controlador &man.ccd.4; le permite tomar 
            varios discos id&eacute;nticos y concatenarlos 
            en un solo sistema l&oacute;gico de ficheros.  
            Para poder usar &man.ccd.4; necesita un
            kernel compilado con soporte de &man.ccd.4;.  
            A&ntilde;ada esta l&iacute;nea al fichero de 
            configuraci&oacute;n de su kernel, recompile y 
            reinstale su kernel:</para>

	  <programlisting>pseudo-device   ccd     4</programlisting>

          <para>En sistemas 5.X, use la siguiente l&iacute;nea:</para>

	  <programlisting>device   ccd</programlisting>

          <note><para>En FreeBSD&nbsp;5.X no es necesario especificar 
            un n&uacute;mero de dispositivos &man.ccd.4;, ya que el controlador 
            de dispositivo &man.ccd.4; es capaz de clonarse a s&iacute; 
            mismo (se crear&aacute;n nuevas instancias de dispositivo 
            autom&aacute;ticamente seg&uacute;n vayan haciendo falta).
            </para></note>

          <para>El soporte de &man.ccd.4; tambi&eacute;n puede 
            cargarse como m&oacute;dulo en &os; 3.0 y 
            posteriores.</para>

          <para>Para configurar &man.ccd.4; tendr&aacute; que 
            usar &man.disklabel.8; para etiquetar los 
            discos:</para>

	  <programlisting>disklabel -r -w ad1 auto
disklabel -r -w ad2 auto
disklabel -r -w ad3 auto</programlisting>

          <para>Esto crea una etiqueta de disco para 
            <devicename>ad1c</devicename>, 
            <devicename>ad2c</devicename> y 
            <devicename>ad3c</devicename> que abarcan 
            el disco completo.</para>

        <note><para>A partir de &os;&nbsp;5.1-RELEASE 
          &man.bsdlabel.8; reemplaz&oacute; al antiguo programa
          &man.disklabel.8;.  En &man.bsdlabel.8; se eliminaron muchas 
          opciones y par&aacute;metros obsoletos; 
          en los ejemplos de arriba la opci&oacute;n <option>-r</option>
          deben obviarse.  Para m&aacute;s informaci&oacute;n consulte 
          &man.bsdlabel.8;.</para></note>

          <para>El siguiente paso es cambiar el tipo de etiqueta
            de disco.  Edite los discos con &man.disklabel.8;:
            </para>

	  <programlisting>disklabel -e ad1
disklabel -e ad2
disklabel -e ad3</programlisting>

          <para>Esto abre la etiqueta de disco de cada disco 
            con el editor declarado en la variable de 
            entorno <envar>EDITOR</envar>, por defecto &man.vi.1;.</para>

          <para>Esta es una etiqueta de disco sin modificar:</para>

	  <programlisting>8 partitions:
#        size   offset    fstype   [fsize bsize bps/cpg]
  c: 60074784        0    unused        0     0     0   # (Cyl.    0 - 59597)</programlisting>

          <para>&man.ccd.4; necesita que a&ntilde;ada una nueva 
            partici&oacute;n <literal>e</literal>.  Puede copiarla desde la 
            partici&oacute;n <literal>c</literal>, pero el tipo de sistema de 
            ficheros (la opci&oacute;n <option>fstype</option>) debe ser 
            <userinput>4.2BSD</userinput>.  La etiqueta del disco 
            deber&iacute;a tener este aspecto:</para>

	  <programlisting>8 partitions:
#        size   offset    fstype   [fsize bsize bps/cpg]
  c: 60074784        0    unused        0     0     0   # (Cyl.    0 - 59597)
  e: 60074784        0    4.2BSD        0     0     0   # (Cyl.    0 - 59597)</programlisting>

	</sect4>

	<sect4 id="ccd-buildingfs">
	  <title>Contrucci&oacute;n del sistema de ficheros</title>

            <para>Puede que todav&iacute;a no exista el 
              nodo de dispositivo para <devicename>ccd0c</devicename>.  
              Si es as&iacute;, ejecute lo siguiente:
              </para>

	  <programlisting>cd /dev
sh MAKEDEV ccd0</programlisting>

          <note><para>En FreeBSD 5.0 &man.devfs.5; administrar&aacute; 
            autom&aacute;ticamente los nodos de dispositivos en 
            <filename>/dev</filename>, as&iacute; que no tendr&aacute; que 
            usar <command>MAKEDEV</command>.</para></note>

          <para>Una vez etiquetados todos los discos construya 
            el &man.ccd.4;. Utilice 
            &man.ccdconfig.8; con opciones similares a las siguientes:</para>

	    <programlisting>ccdconfig ccd0<co id="co-ccd-dev"> 32<co id="co-ccd-interleave"> 0<co id="co-ccd-flags"> /dev/ad1e<co id="co-ccd-devs"> /dev/ad2e /dev/ad3e</programlisting>

          <para>El uso y el significado de cada una de las opciones se 
            muestra m&aacute;s abajo:</para>

          <calloutlist>
            <callout arearefs="co-ccd-dev">
            <para>El primer argumento es el dispositivo a configurar, en este 
              caso <filename>/dev/ccd0c</filename>.  La parte 
              <filename>/dev/</filename> es opcional.</para>
            </callout>

            <callout arearefs="co-ccd-interleave">

            <para>El intervalo para el sistema de ficheros.  El intervalo 
              define el tama&ntilde;o de una banda en bloques de disco, 
              normalmente 512 bytes.  Por lo tanto, un intervalo 
              de 32 equivaldr&iacute;a 16.384 bytes.</para>
            </callout>

            <callout arearefs="co-ccd-flags">
            <para>Banderas para &man.ccdconfig.8;. Si desea disponer 
              sus discos en espejo use aqu&iacute; una bandera.  
              Esta configuraci&oacute;n no necesita discos en espejo, 
              por lo que est&aacute; dispuesta a 0 (cero).</para>
            </callout>

            <callout arearefs="co-ccd-devs">
            <para>Los &uacute;ltimos argumentos de &man.ccdconfig.8; 
              son los dispositivos a colocar en el array.  Utilice 
              la ruta completa para cada dispositivo.</para>
            </callout>
          </calloutlist>


          <para>Despues de ejecutar &man.ccdconfig.8; el &man.ccd.4;
            estar&aacute; configurado y podr&aacute; instalar un sistema 
            de ficheros.  Consulte las opciones de &man.newfs.8; y 
            ejecute:</para>

	  <programlisting>newfs /dev/ccd0c</programlisting>


	</sect4>

	<sect4 id="ccd-auto">
	  <title>Automatizaci&oacute;n</title>

          <para>Seguramente querr&aacute; que 
            &man.ccd.4; est&eacute; dispuesto tras cada reinicio.  Para 
            ello, debe configurarlo.  Guarde su configuraci&oacute;n 
            en <filename>/etc/ccd.conf</filename> mediante lo 
            siguiente:</para>

	  <programlisting>ccdconfig -g &gt; /etc/ccd.conf</programlisting>

          <para>Durante el reinicio, el <quote>script</quote> 
            <command>/etc/rc</command> 
            ejecuta <command>ccdconfig -C</command> si encuentra 
            el fichero <filename>/etc/ccd.conf</filename>.  De este modo 
            &man.ccd.4; queda configurado autom&aacute;ticamente para que 
            pueda montarse.</para>

          <note><para>Si ha arrancando en modo mono usuario necesita 
            ejecutar el siguiente comando antes de que pueda montar 
            el &man.ccd.4; para configurar el array:</para>

	  <programlisting>ccdconfig -C</programlisting>
          </note>

          <para>Para montar automaticamente el &man.ccd.4; 
            coloque una entrada para &man.ccd.4; en
            <filename>/etc/fstab</filename> para que se monte 
            durante el arranque:</para>

	  <programlisting>/dev/ccd0c              /media       ufs     rw      2       2</programlisting>
	</sect4>
      </sect3>

      <sect3 id="vinum">
	<title>El administrador de vol&uacute;menes Vinum</title>

<indexterm><primary>RAID</primary><secondary>software</secondary></indexterm>
<indexterm>
  <primary>RAID</primary>
  <secondary>Vinum</secondary>
</indexterm>

        <para>El administrador de vol&uacute;menes Vinum es un 
          controlador de dispositivos de bloque que implementa 
          unidades de disco virtuales.  A&iacute;sla los discos hardware de 
          la interfaz de dispositivos de bloque y mapea datos de 
          modo que revierta en un incremento de flexibilidad, 
          rendimiento y fiabilidad comparados con el sistema de slices 
          de almacenamiento de disco tradicional.  
          &man.vinum.8; implementa los modelos RAID-0, RAID-1 y
          RAID-5, individualmente o combinados.</para>

	<para>Consulte el <xref linkend="vinum-vinum"> para mayor
          informaci&oacute;n sobre &man.vinum.8;.</para>
      </sect3>
    </sect2>

    <sect2 id="raid-hard">
      <title>RAID por Hardware</title>

      <indexterm>
	<primary>RAID</primary>
	<secondary>hardware</secondary>
      </indexterm>

      <para>FreeBSD admite una gran variedad de controladores 
        <acronym>RAID</acronym> por hardware.  Estos dispositivos 
        controlan un subsistema <acronym>RAID</acronym> sin necesidad 
        de software espec&iacute;fico para &os; que administre el 
        array.</para>

      <para>Puede controlar la mayor&iacute;a de las operaciones de disco con 
        una tarjeta que incorpore <acronym>BIOS</acronym>.  
        El siguiente texto es una breve
        descripci&oacute;n de configuraci&oacute;n utilizando una 
        controladora Promise <acronym>RAID</acronym> <acronym>IDE</acronym>.  
        Cuando se instala esta tarjeta e inicia el sistema despliega 
        un <quote>prompt</quote> pidiendo informaci&oacute;n.  Siga las 
        instrucciones para entrar a la pantalla de configuraci&oacute;n de la 
        tarjeta.  Ah&iacute; tendr&aacute; posibilidad de combinar todos los 
        discos que haya conectado.  Hecho esto el disco (o discos) 
        aparecer&aacute;n como una sola unidad en &os;.  Pueden configurarse 
        otros niveles de 
        <acronym>RAID</acronym>.</para>
    </sect2>

    <sect2>
      <title>Reconstrucci&oacute;n de arrays ATA RAID1</title>

      <para>&os; le permite reemplazar en caliente un disco da&ntilde;ado.  
        Esto requiere que lo intercepte antes de reiniciar.</para>

      <para>Probablemente vea algo como lo siguiente en
        <filename>/var/log/messages</filename> o en la salida de 
        &man.dmesg.8;:</para>        

      <programlisting>ad6 on monster1 suffered a hard error.
ad6: READ command timeout tag=0 serv=0 - resetting
ad6: trying fallback to PIO mode
ata3: resetting devices .. done
ad6: hard error reading fsbn 1116119 of 0-7 (ad6 bn 1116119; cn 1107 tn 4 sn 11)\\
status=59 error=40
ar0: WARNING - mirror lost</programlisting>

      <para>Consulte &man.atacontrol.8; para m&aacute;s 
        informaci&oacute;n:</para>

      <screen>&prompt.root; <userinput>atacontrol list</userinput>
ATA channel 0:
	Master:      no device present
	Slave:   acd0 &lt;HL-DT-ST CD-ROM GCR-8520B/1.00&gt; ATA/ATAPI rev 0

ATA channel 1:
	Master:      no device present
	Slave:       no device present

ATA channel 2:
	Master:  ad4 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
	Slave:       no device present

ATA channel 3:
	Master:  ad6 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
	Slave:       no device present

&prompt.root; <userinput>atacontrol status ar0</userinput>
ar0: ATA RAID1 subdisks: ad4 ad6 status: DEGRADED</screen>

      <procedure>
	<step>
          <para>Primero debe desconectar el disco del array para
            que pueda retirarlo con seguridad:</para>

	  <screen>&prompt.root; <userinput>atacontrol detach 3</userinput></screen>
	</step>

	<step>
	  <para>Reemplace el disco.</para>
	</step>

	<step>
	  <para>Conecte el disco de repuesto:</para>

	  <screen>&prompt.root; <userinput>atacontrol attach 3</userinput>
Master:  ad6 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
Slave:   no device present</screen>
	</step>

	<step>
	  <para>Reconstruya el array:</para>

	  <screen>&prompt.root; <userinput>atacontrol rebuild ar0</userinput></screen>
	</step>

	<step>

          <para>El comando de reconstrucci&oacute;n no responder&aacute; hasta 
            que termine la tarea.  Puede abrir otra terminal (mediante 
            <keycombo action="simul"><keycap>Alt</keycap> <keycap>F<replaceable>n</replaceable></keycap></keycombo>)
            y revisar el progreso ejecutando lo siguiente:</para>

	  <screen>&prompt.root; <userinput>dmesg | tail -10</userinput>
[texto eliminado]
ad6: removed from configuration
ad6: deleted from ar0 disk1
ad6: inserted into ar0 disk1 as spare

&prompt.root; <userinput>atacontrol status ar0</userinput>
ar0: ATA RAID1 subdisks: ad4 ad6 status: REBUILDING 0% completed</screen>
	</step>

	<step>
          <para>Espere hasta que termine la operaci&oacute;n.</para>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 id="usb-disks">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Marc</firstname>
	  <surname>Fonvieille</surname>
	  <contrib>Texto de </contrib>
	</author>
      </authorgroup>
      <!-- Jul 2004 -->
    </sect1info>

    <title>Dispositivos de almacenamiento USB</title>
    <indexterm>
      <primary>USB</primary>
      <secondary>discos</secondary>
    </indexterm>

    <para>Hoy d&iacute;a hay una enorme cantidad de soluciones de 
      almacenamiento externoque usan el bus serie universal (USB): 
      discos duros, <quote>mecheros</quote> (o 
      <quote>l&aacute;pices</quote>) USB, grabadoras de 
      CD-R, etc. &os; puede usar estos dispositivos.</para>

    <sect2>
      <title>Configuraci&oacute;n</title>

      <para>El controlador de dispositivos de almacenamiento masivo 
        USB, &man.umass.4;, ofrece soporte para dispositivos de 
        almacenamiento USB.  Si usa el kernel <filename>GENERIC</filename> 
        no necesita cambiar nada en su configuraci&oacute;n.  Si 
        utiliza un kernel personalizado aseg&uacute;rese de que su 
        fichero de configuraci&oacute;n del kernel contiene las 
        siguientes l&iacute;neas:</para>

      <programlisting>device scbus
device da
device pass
device uhci
device ohci
device usb
device umass</programlisting>

      <para>El controlador &man.umass.4; usa el subsistema SCSI para 
        acceder a los dispositivos de almacenamiento USB y su 
        dispositivo USB aparecer&aacute; en el sistema como 
        dispositivo SCSI.  Dependiendo del chipset USB de su 
        placa base s&oacute;lamente necesitar&aacute; 
        <literal>device uhci</literal> o 
        <literal>device ohci</literal>;  en cualquier caso tener 
        los dos en el fichero de configuraci&oacute;n del kernel 
        no provocar&aacute; ning&uacute;n da&ntilde;o.  No olvide 
        compilar e instalar el nuevo kernel si hizo alguna 
        modificaci&oacute;n.</para>
        
      <note>
        <para>Si su dispositivo USB es una grabadora CD-R o DVD el 
          controlador SCSI CD-ROM, &man.cd.4;, debe ser a&ntilde;adirse al 
          kernel mediante la siguiente l&iacute;nea:</para>

	<programlisting>device cd</programlisting>

        <para>Dado que la grabadora aparece como una unidad 
          SCSI no tiene que usar el controlador &man.atapicam.4; 
          en la configuraci&oacute;n del kernel.</para>
      </note>

      <para>En &os;&nbsp;5.X y en la rama 4.X desde &os;&nbsp;4.10-RELEASE 
        el soporte para controladores USB 2.0 se incorpora al sistema del 
        siguiente modo:</para>

      <programlisting>device ehci</programlisting>

      <para>Tenga en cuenta que &man.uhci.4; y 
        &man.ohci.4; siguen siendo necesarios si quiere disponer de 
        soporte para USB 1.X.</para>

      <note>
        <para>En &os;&nbsp;4.X, El d&aelig;mon USB (&man.usbd.8;) debe
          ejecutarse para poder ver ciertos tipos de dispositivo USB.  
          Para habilitarlo, a&ntilde;ada 
          <literal>usbd_enable="YES"</literal> en 
          <filename>/etc/rc.conf</filename> y reinicie la
          m&aacute;quina.</para>
      </note>
    </sect2>

    <sect2>
      <title>Prueba de la configuraci&oacute;n</title>

      <para>La configuraci&oacute;n est&aacute; lista para probarse:  
        conecte su dispositivo USB; en el b&uacute;fer de mensajes del 
        sistema (&man.dmesg.8;), la unidad debe aparecer como algo 
        similar a esto:</para>

      <screen>umass0: USB Solid state disk, rev 1.10/1.00, addr 2
GEOM: create disk da0 dp=0xc2d74850
da0 at umass-sim0 bus 0 target 0 lun 0
da0: &lt;Generic Traveling Disk 1.11&gt; Removable Direct Access SCSI-2 device
da0: 1.000MB/s transfers
da0: 126MB (258048 512 byte sectors: 64H 32S/T 126C)</screen>

      <para>Obviamente la marca, el nodo de dispositivo 
        (<devicename>da0</devicename>) y otros detalles 
        pueden diferir dependiendo de su hardware.</para>

      <para>Ya que el dispositivo USB aparece como uno SCSI, 
        puede usar <command>camcontrol</command> para ver una lista 
        de dispositivos USB conectados al 
        sistema:</para>

      <screen>&prompt.root; <userinput>camcontrol devlist</userinput>
&lt;Generic Traveling Disk 1.11&gt;      at scbus0 target 0 lun 0 (da0,pass0)</screen>

      <para>Si la unidad tiene un sistema de ficheros puede montarla.  
        La <xref linkend="disks-adding"> contiene informaci&oacute;n que 
        le resultar&aacute; muy &uacute;til para formatear y crear 
        particiones en el disco USB en caso de necesitarlo.</para>

      <para>Si desconecta el dispositivo (el disco debe desmontarse 
        previamente), deber&iacute;a ver en el b&uacute;fer de mensajes 
        del sistema algo parecido a esto:</para>

      <screen>umass0: at uhub0 port 1 (addr 2) disconnected
(da0:umass-sim0:0:0:0): lost device
(da0:umass-sim0:0:0:0): removing device entry
GEOM: destroy disk da0 dp=0xc2d74850
umass0: detached</screen>
    </sect2>

    <sect2>
      <title>Lecturas recomendadas</title>

      <para>Ademas de las secciones
        <link linkend="disks-adding">C&oacute;mo a&ntilde;adir discos</link> 
        y <link linkend="mount-unmount">Montado y desmontado de sistemas 
        ficheros</link>, consulte las siguientes p&aacute;ginas man:
        &man.umass.4;, &man.camcontrol.8; y 
        &man.usbdevs.8;.</para>
    </sect2>
  </sect1>

  <sect1 id="creating-cds">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Mike</firstname>
	  <surname>Meyer</surname>
	  <contrib>Texto de </contrib>
	  <!-- mwm@mired.org -->
	</author>
      </authorgroup>
      <!-- Apr 2001 -->
    </sect1info>

    <title>Creaci&oacute;n y uso de medios &oacute;pticos (CD)</title>
    <indexterm>
      <primary>CDROM</primary>
      <secondary>creaci&oacute;n</secondary>
    </indexterm>

    <sect2>
      <title>Introducci&oacute;n</title>

      <para>Los CD tienen muchas opciones que los hacen distintos de 
        los discos convencionales.  Al principio los usuarios no 
        pod&iacute;an escribirlos.  Su dise&ntilde;o permite que leamos 
        en ellos sin el retardo del movimiento de una cabeza lectora 
        de una pista a otra.  
        Tambi&eacute;n son mucho m&aacute;s f&aacute;ciles de transportar 
        de un sistema a otro que muchos otros soportes de 
        informaci&oacute;n.</para>

      <para>Los CD tienen pistas, pero son una secci&oacute;n de los 
        que permiten lectura cont&iacute;nua, no una propiedad 
        f&iacute;sica del disco.  Para crear un CD en &os; debe 
        preparar los ficheros de datos que van a constituir las pistas 
        del CD y luego escribir las pistas al CD.</para>

      <indexterm><primary>ISO 9660</primary></indexterm>
      <indexterm>
        <primary>sistema de ficheros</primary>
        <secondary>ISO 9660</secondary>
      </indexterm>
      <para>El sistema de ficheros ISO 9660 se dise&ntilde;&oacute; 
        para gestionar estas diferencias.  Por desgracia implementa 
        l&iacute;mites de sistema de ficheros que eran comunes en la 
        &eacute;poca en que se dise&ntilde;&oacute;.  
        Por suerte tambi&eacute;n proporciona un mecanismo de extensiones 
        que permite que CD escritos excediendo dichos l&iacute;mites 
        funcionen en sistemas que no soportan esas extensiones.</para>

      <indexterm>
        <primary><filename role="package">sysutils/cdrtools</filename></primary>
      </indexterm>
      <para>El port <filename role="package">sysutils/cdrtools</filename> 
        incluye &man.mkisofs.8;, un programa que le permitir&aacute; 
        crear un fichero de datos que contenga un sistema de 
        ficheros ISO 9660.  Incorpora opciones que soportan varias 
        extensiones.  Se describe m&aacute;s adelante.</para>

      <indexterm>
        <primary>grabadora de CD</primary>
        <secondary>ATAPI</secondary>
      </indexterm>
      <para>Qu&eacute; herramienta usar para grabar el CD depende de si 
        su grabadora es ATAPI o no.  Las grabadoras de CD ATAPI usan el 
        programa <command><link linkend="burncd">burncd</link></command>, 
        que forma parte del sistema base.  Las grabadoras SCSI y USB usan 
        <command><link linkend="cdrecord">cdrecord</link></command>, del 
        port <filename role="package">sysutils/cdrtools</filename>.</para>

      <para><command>burncd</command> no soporta cualquier unidad de 
        grabaci&oacute;n.  Para saber si una unidad est&aacute; 
        soportada consulte la siguiente lista de 
        <ulink url="http://www.freebsd.dk/ata/">unidades CD-R/RW soportadas</ulink>.</para>

      <note>
      <indexterm>
	<primary>grabadora de CD</primary>
	<secondary>controlador ATAPI/CAM</secondary>
      </indexterm>
        <para>Si utiliza &os;&nbsp;5.X, &os;&nbsp;4.8-RELEASE
          o posteriores, puede utilizar 
          <command><link linkend="cdrecord">cdrecord</link></command> y
          otras herramientas para unidades SCSI en hardware ATAPI con
          el <link linkend="atapicam">m&oacute;dulo ATAPI/CAM</link>.</para>
      </note>

      <para>Si quiere usar un interfaz gr&aacute;fico con su software 
        de grabaci&oacute;n de CD quiz&aacute;s le guste 
        <application>X-CD-Roast</application> o 
        <application>K3b</application>.  Puede instalar estas herramientas 
        como paquetes o desde los ports 
        <filename role="package">sysutils/xcdroast</filename> y
        <filename role="package">sysutils/k3b</filename>, respectivamente.  
        <application>X-CD-Roast</application> y 
        <application>K3b</application> requieren el 
        <link linkend="atapicam">m&oacute;dulo ATAPI/CAM</link> 
        si usa hardware ATAPI.</para>
    </sect2>

    <sect2 id="mkisofs">
      <title>mkisofs</title>

      <para>El programa &man.mkisofs.8; (que forma parte del 
        port <filename role="package">sysutils/cdrtools</filename>) 
        genera un sistema de ficheros ISO 9660 que es una imagen 
        de un &aacute;rbol de directorios en el espacio de nombres 
        del sistema de ficheros &unix;.  Esta es la forma m&aacute;s simple 
        de usarlo:</para>

      <screen>&prompt.root; <userinput>mkisofs -o <replaceable>ficherodeimagen.iso</replaceable> <replaceable>/ruta/del/&aacute;rbol</replaceable></userinput></screen>

      <indexterm>
        <primary>sistemas de ficheros</primary>
        <secondary>ISO 9660</secondary>
      </indexterm>
      <para>Este comando crear&aacute; un 
        <replaceable>ficherodeimagen.iso</replaceable> 
        que contenga un sistema de ficheros ISO 9660 que es una copia del 
        &aacute;rbol ubicado en 
        <replaceable>/ruta/al/&aacute;rbol</replaceable>. En el
        proceso, mapear&aacute; los nombres de fichero a nombres que 
        se ajusten a las limitaciones del est&aacute;ndar del sistema 
        de ficheros ISO 9660, y excluir&aacute; ficheros que posean 
        nombres no caracter&iacute;sticos de sistemas de ficheros 
        ISO.</para>

      <indexterm>
        <primary>sistemas de ficheros</primary>
        <secondary>HFS</secondary>
      </indexterm>
      <indexterm>
        <primary>sistemas de ficheros</primary>
        <secondary>Joliet</secondary>
      </indexterm>
      
      <para>Existe gran cantidad de opciones que permiten superar 
        esas restricciones.  En particular, <option>-R</option> 
        habilita las extensiones Rock Ridge comunes para sistemas 
        &unix;, <option>-J</option> habilita las extensiones Joliet 
        usadas por sistemas Microsoft y <option>-hfs</option> puede 
        usarse para crear sistemas de ficheros utilizados por 
        &macos;.</para>

      <para>Puede utilizar <option>-U</option> para deshabilitar 
        todas las restricciones de nombres de fichero si quiere crear un 
        CD que se vaya a usar exclusivamente en sistemas &os;.  Cuando se 
        usa con <option>-R</option> produce una imagen de sistema 
        de ficheros que es id&eacute;ntica al &aacute;rbol &os; 
        origen, aunque puede violar el est&aacute;ndar ISO 9660 
        de m&uacute;ltiples formas.</para>

      <indexterm>
        <primary>CDROMs</primary>
        <secondary>creaci&oacute;n cd CD arrancables</secondary>
      </indexterm>
      <para>La &uacute;ltima opci&oacute;n de uso general es 
        <option>-b</option>.  Se usa para configurar la ubicaci&oacute;n 
        de la imagen de arranque que se usar&aacute; al crear un CD 
        arrancable <quote>El Torito</quote>.  
        Esta opci&oacute;n usa como argumento la ruta a la imagen de 
        arranque desde la ra&iacute;z del &aacute;rbol de directorios que 
        se va a escribir en el CD.  Por defecto &man.mkisofs.8; 
        crea una imagen ISO en un modo llamado <quote>de emulaci&oacute;n 
        de disquete (floppy)</quote>, y por lo tanto espera que 
        la imagen de arranque sea exactamente de 1.200, 1.440 o 
        2880&nbsp;KB de tama&ntilde;o.  Algunos cargadores de arranque, 
        como el que se usa en los discos de la distribuci&oacute;n &os;, 
        no utilizan modo de emulaci&oacute;n: se usa la opci&oacute;n 
        <option>-no-emul-boot</option>.  Por tanto, si 
        <filename>/tmp/miarranque</filename> tiene un sistema &os; 
        arrancable con la imagen de arranque en 
        <filename>/tmp/miarranque/boot/cdboot</filename> podr&iacute;a 
        crear la imagen en un sistema de ficheros ISO 9660 en 
        <filename>/tmp/arrancable.iso</filename> de la siguiente manera:</para>

      <screen>&prompt.root; <userinput>mkisofs -R -no-emul-boot -b boot/cdboot -o /tmp/arrancable.iso /tmp/miarranque</userinput></screen>

      <para>Hecho esto, si tiene <devicename>vn</devicename> 
        (FreeBSD&nbsp;4.X), o <devicename>md</devicename> 
        (FreeBSD&nbsp;5.X) 
        configurado en su kernel, puede montar el sistema de 
        ficheros del siguiente modo:</para>

      <screen>&prompt.root; <userinput>vnconfig -e vn0c /tmp/arrancable.iso</userinput>
&prompt.root; <userinput>mount -t cd9660 /dev/vn0c /mnt</userinput></screen>

      <para>En FreeBSD&nbsp;4.X y FreeBSD&nbsp;5.X proceda del siguiente 
        modo:</para>

      <screen>&prompt.root; <userinput>mdconfig -a -t vnode -f /tmp/arrancable.iso -u 0</userinput>
&prompt.root; <userinput>mount -t cd9660 /dev/md0 /mnt</userinput></screen>

      <para>Ahora puede verificar que <filename>/mnt</filename>
        y <filename>/tmp/miarranque</filename> sean id&eacute;nticos.</para>

      <para>Existen muchas otras opciones que puede usar para depurar el 
        comportamiento de &man.mkisofs.8;, sobre todo en lo que se refiere 
        al esquema ISO 9660 y la creaci&oacute;n de discos Joliet y HFS.  
        Consulte el manual de &man.mkisofs.8;.</para>
    </sect2>

    <sect2 id="burncd">
      <title>burncd</title>
      <indexterm>
        <primary>CDROM</primary>
        <secondary>grabar</secondary>
      </indexterm>
      <para>Si tiene una grabadora ATAPI puede usar 
        <command>burncd</command> para grabar una imagen ISO en un 
        CD.  <command>burncd</command> forma parte del sistema base, y 
        est&aacute; en <filename>/usr/sbin/burncd</filename>.  Su uso 
        es muy sencillo, ya que tiene pocas opciones:</para>

      <screen>&prompt.root; <userinput>burncd -f <replaceable>unidaddecd</replaceable> data <replaceable>ficheroimagen.iso</replaceable> fixate</userinput></screen>

      <para>Esto grabar&aacute; una copia de <replaceable>ficheroimagen.iso</replaceable>
        en <replaceable>unidadcd</replaceable>.  El dispositivo por 
        defecto es <filename>/dev/acd0</filename> 
        (o <filename>/dev/acd0c</filename> en &os;&nbsp;4.X).  
        Consulte &man.burncd.8; para ver las opciones de configuraci&oacute;n 
        de velocidad de escritura, expulsi&oacute;n de CD una vez grabado, y 
        escritura de datos de audio.</para>
    </sect2>

    <sect2 id="cdrecord">
      <title>cdrecord</title>

      <para>Si no dispone de una grabadora ATAPI de CD, tendr&aacute; que 
        usar <command>cdrecord</command> para grabar sus CD.  
        <command>cdrecord</command> no forma parte del sistema 
        base; inst&aacute;lelo  desde el port 
        <filename role="package">sysutils/cdrtools</filename> o 
        como paquete.  Los cambios en el sistema base pueden 
        hacer que las versiones binarias del programa fallen.  
        Tendr&aacute; que actualizar el port cuando actualice su sistema 
        o, si est&aacute; 
        <link linkend="stable">siguiendo la rama -STABLE</link>, 
        actualizar el port cuando haya una nueva versi&oacute;n 
        disponible.</para>

      <para>Aunque <command>cdrecord</command> tiene muchas opciones, el 
        uso b&aacute;sico es incluso m&aacute;s simple que 
        el de <command>burncd</command>.  As&iacute; se graba una imagen 
        ISO 9660:</para>

      <screen>&prompt.root; <userinput>cdrecord dev=<replaceable>dispositivo</replaceable> <replaceable>ficheroimagen.iso</replaceable></userinput></screen>

      <para>La parte complicada de utilizar <command>cdrecord</command> es 
        encontrar qu&eacute; <option>dev</option> usar.  Utilice la 
        bandera <option>-scanbus</option> para dar con la 
        configuraci&oacute;n apropiada.  La salida ser&aacute; parecida a 
        la siguiente:</para>
      <indexterm>
        <primary>CDROMs</primary>
        <secondary>grabar</secondary>
      </indexterm>
      <screen>&prompt.root; <userinput>cdrecord -scanbus</userinput>
Cdrecord 1.9 (i386-unknown-freebsd4.2) Copyright (C) 1995-2000 J&ouml;rg Schilling
Using libscg version 'schily-0.1'
scsibus0:
        0,0,0     0) 'SEAGATE ' 'ST39236LW       ' '0004' Disk
        0,1,0     1) 'SEAGATE ' 'ST39173W        ' '5958' Disk
        0,2,0     2) *
        0,3,0     3) 'iomega  ' 'jaz 1GB         ' 'J.86' Removable Disk
        0,4,0     4) 'NEC     ' 'CD-ROM DRIVE:466' '1.26' Removable CD-ROM
        0,5,0     5) *
        0,6,0     6) *
        0,7,0     7) *
scsibus1:
        1,0,0   100) *
        1,1,0   101) *
        1,2,0   102) *
        1,3,0   103) *
        1,4,0   104) *
        1,5,0   105) 'YAMAHA  ' 'CRW4260         ' '1.0q' Removable CD-ROM
        1,6,0   106) 'ARTEC   ' 'AM12S           ' '1.06' Scanner
        1,7,0   107) *</screen>

      <para>Esta lista muestra los valores <option>dev</option> apropiados para 
        los dispositivos de la lista.  Localice su grabadora de CD y 
        utilice los tres n&uacute;meros separados por comas como valor 
        para <option>dev</option>.  En este caso, el dispositivo CDW 
        es 1,5,0 y por tanto la entrada apropiada ser&iacute;a 
        <option>dev=1,5,0</option>.  Hay modos m&aacute;s 
        f&aacute;ciles de especificar este valor; consulte &man.cdrecord.1; 
        para m&aacute;s detalles.  Tambi&eacute;n es el lugar donde buscar 
        informaci&oacute;n sobre la escritura de pistas de audio, 
        controlar la velocidad de escritura y muchas m&aacute;s cosas.</para> 
    </sect2>

    <sect2 id="duplicating-audiocds">
      <title>Copiar CD de audio</title>

      <para>Puede duplicar un CD de audio extrayendo los datos de audio del 
        CD a ficheros y escribir estos ficheros en un CD virgen.  
        El proceso es ligeramente diferente en unidades ATAPI y 
        SCSI.</para>

      <procedure>
	<title>Unidades SCSI</title>

	<step>
          <para>Use <command>cdda2wav</command> para extraer el audio.</para>

	  <screen>&prompt.user; <userinput>cdda2wav -v255 -D2,0 -B -Owav</userinput></screen>
	</step>

	<step>
          <para>Use <command>cdrecord</command> para escribir 
            los ficheros <filename>.wav</filename>.</para>

	  <screen>&prompt.user; <userinput>cdrecord -v dev=<replaceable>2,0</replaceable> -dao -useinfo  *.wav</userinput></screen>

          <para>Aseg&uacute;rese de que <replaceable>2,0</replaceable> 
            este configurado apropiadamente, como se describe en la 
            <xref linkend="cdrecord">.</para>
	</step>
      </procedure>

      <procedure>
	<title>Unidades ATAPI</title>

	<step>
          <para>El controlador de CD ATAPI hace que cada pista sea 
            accesible como 
            <filename>/dev/acd<replaceable>d</replaceable>t<replaceable>nn</replaceable></filename>,
            donde <replaceable>d</replaceable> es el n&uacute;mero 
            de unidad y <replaceable>nn</replaceable> es el 
            n&uacute;mero de pista expresado con dos d&iacute;gitos 
            decimales, precedido por un cero si es necesario.  
            La primera pista del primer disco es 
            <filename>/dev/acd0t01</filename>, la segunda es 
            <filename>/dev/acd0t02</filename>, la tercera es 
            <filename>/dev/acd0t03</filename> y as&iacute; 
            sucesivamente.</para>

          <para>Aseg&uacute;rese de que existen los ficheros apropiados 
            en <filename>/dev</filename>.</para>

	  <screen>&prompt.root; <userinput>cd /dev</userinput>
&prompt.root; <userinput>sh MAKEDEV acd0t99</userinput></screen>

          <note><para>En FreeBSD 5.0 &man.devfs.5; crear&aacute; 
            y gestionar&aacute; autom&aacute;ticamente las entradas 
            necesarias en <filename>/dev</filename>, as&iacute; que 
            no ser&aacute; necesario usar 
            <command>MAKEDEV</command>.</para></note>
	</step>

	<step>
          <para>Extraer cada pista con &man.dd.1;.  Tambi&eacute;n 
            deber&aacute; declarar un tama&ntilde;o espec&iacute;fico de 
            bloque al extraer los ficheros.</para>

	  <screen>&prompt.root; <userinput>dd if=/dev/acd0t01 of=pista1.cdr bs=2352</userinput>
&prompt.root; <userinput>dd if=/dev/acd0t02 of=pista2.cdr bs=2352</userinput>
...
</screen>
	</step>

	<step>
          <para>Grabar los ficheros extra&iacute;dos a disco con 
            <command>burncd</command>.  Debe declarar que son 
            ficheros de audio y que <command>burncd</command> debe cerrar 
            (<quote>fixate</quote>) el disco al terminar la 
            grabaci&oacute;n.</para>

	  <screen>&prompt.root; <userinput>burncd -f <replaceable>/dev/acd0</replaceable> audio pista1.cdr pista2.cdr <replaceable>...</replaceable> fixate</userinput></screen>
	</step>
      </procedure>
    </sect2>

    <sect2 id="imaging-cd">
      <title>Duplicar CDs de datos</title>

      <para>Puede copiar un CD de datos a un fichero de 
        imagen que ser&aacute; funcionalmente equivalente al fichero 
        de imagen creado con &man.mkisofs.8;, y puede usarlo
        para duplicar cualquier CD de datos.  El ejemplo dado
        aqu&iacute; asume que su dispositivo CDROM es 
        <devicename>acd0</devicename>.  Sustit&uacute;yalo por el 
        dispositivo CDROM correcto para su configuraci&oacute;n.  
        Bajo &os;&nbsp;4.X, se debe a&ntilde;adir una 
        <literal>c</literal> al final del nombre del dispositivo para 
        indicar la partici&oacute;n entera o, en el caso de los CDROM, 
        el disco entero.</para>

      <screen>&prompt.root; <userinput>dd if=/dev/acd0 of=fichero.iso bs=2048</userinput></screen>

      <para>Hecha la imagen puede garbarla en un CD como se 
        describi&oacute; anteriormente.</para>
    </sect2>

    <sect2 id="mounting-cd">
      <title>Uso de CD de datos</title>

      <para>Ahora que ha creado un CDROM de datos est&aacute;ndar 
        tal vez quiera montarlo y leer los datos que contiene.  Por 
        defecto &man.mount.8; asume que los sistemas de ficheros 
        son de tipo <literal>ufs</literal>.  Si trata de
        hacer algo como</para>

      <screen>&prompt.root; <userinput>mount /dev/cd0 /mnt</userinput></screen>

      <para>recibir&aacute; un error como este: 
        <errorname>Incorrect super block</errorname> y no se 
        montar&aacute;.  Un CDROM no es un sistema de ficheros 
        <literal>UFS</literal> as&iacute; que los intentos de montarlo 
        como tal fallar&aacute;n. Tendr&aacute; que decirle a &man.mount.8; 
        que el sistema de ficheros es de tipo <literal>ISO9660</literal> 
        y funcionar&aacute;.  Puede hacerlo mediante la 
        opci&oacute;n <option>-t cd9660</option>.  
        Por ejemplo, si quiere montar el dispositivo CDROM 
        <filename>/dev/cd0</filename>  en 
        <filename>/mnt</filename> ejecute:</para>

          <screen>&prompt.root; <userinput>mount -t cd9660 /dev/cd0 /mnt</userinput></screen>

      <para>Tenga en cuenta que el nombre de su dispositivo 
        (<filename>/dev/cd0</filename> en este ejemplo) puede 
        ser diferente, dependiendo de la interfaz que su CDROM 
        utilice.  Adem&aacute;s la opci&oacute;n <option>-t cd9660</option> 
        s&oacute;lo ejecuta &man.mount.cd9660.8;.  El ejemplo de arriba 
        puede resumirse del siguiente modo:</para>

<screen>&prompt.root; <userinput>mount_cd9660 /dev/cd0 /mnt</userinput></screen>

      <para>En general puede usar CDROM de datos de cualquier 
        fabricante, aunque los discos con ciertas extensiones 
        ISO 9660 pueden mostrar un comportamiento extra&ntilde;o.  
        Por ejemplo, los discos Joliet almacenan todos los nombres 
        de fichero en caracteres unicode de dos-bytes.  El kernel 
        de &os; no comprende unicode 
        (<emphasis>todav&iacute;a</emphasis>) as&iacute; que 
        los caracteres que no est&aacute;n en ingl&eacute;s aparecen 
        como signos de interrogaci&oacute;n.  (Si utiliza &os; 4.3 
        o alguna versi&oacute;n posterior, el controlador CD9660 incluye 
        unas estructuras llamadas <quote>ganchos</quote>, que le 
        permitir&aacute;n cargar una tabla de conversi&oacute;n unicode 
        apropiada cuando haga falta.  Hay m&oacute;dulos para algunas 
        de las codificaciones m&aacute;s comunes en el port 
        <filename role="package">sysutils/cd9660_unicode</filename>.)</para>

      <para>Es posible que reciba un error <errorname>Device not 
        configured</errorname> al tratar de montar un CDROM.  
        Generalmente esto significa que la unidad de CDROM piensa que no 
        hay disco en la bandeja, o que la unidad no es visible 
        en el bus.  Puede llevar un par de segundos el que una 
        unidad de CDROM se d&eacute; cuenta de que ha sido alimentada, 
        por lo tanto sea paciente.</para>

      <para>Algunas veces un CDROM SCSI puede <quote>perdido</quote> debido 
        a que no tuvo tiempo suficiente para responder al reset del 
        bus.  Si tiene un CDROM SCSI a&ntilde;ada la siguiente opci&oacute;n 
        a su fichero de  configuraci&oacute;n del kernel y 
        <link linkend="kernelconfig-building">recompile su kernel</link>.</para>

      <programlisting>options SCSI_DELAY=15000</programlisting>

      <para>Esto le indica a su bus SCSI que haga una pausa de 15 
        segundos durante el arranque para darle ocasi&oacute;n 
        a su unidad de CDROM de responder al reset del bus.</para>
    </sect2>

    <sect2 id="rawdata-cd">
      <title>Grabar CD de datos <quote>crudos</quote> (Raw)</title>

      <para>Puede guardar un fichero directamente a CD 
        sin crear un sistema de ficheros ISO 9660.  Algunas 
        personas hacen esto al crear respaldos.  Es un proceso 
        m&aacute;s r&aacute;pido que grabar un CD 
        est&aacute;ndar:</para>

      <screen>&prompt.root; <userinput>burncd -f /dev/acd1 -s 12 data fichero.tar.gz fixate</userinput></screen>

      <para>Para recuperar los datos guardardados de este modo en un CD, 
        debe leer los datos desde el nodo de dispositivo 
        <quote>crudo</quote>:</para>

      <screen>&prompt.root; <userinput>tar xzvf /dev/acd1</userinput></screen>

      <para>No puede montar este disco como lo har&iacute;a con un 
        CDROM normal.  Estos CDROM no pueden leerse en ning&uacute;n 
        sistema operativo que no sea &os;.  Si quiere montar el CD 
        o compartir los datos con otro sistema operativo debe utilizar 
        &man.mkisofs.8; como se describi&oacute; previamente.</para>
    </sect2>

    <sect2 id="atapicam">
      <sect2info>
	<authorgroup>
	  <author>
	    <firstname>Marc</firstname>
	    <surname>Fonvieille</surname>
	    <contrib>Original de </contrib>
	  </author>
	</authorgroup>
      </sect2info>

      <indexterm>
	<primary>Grabadora de CD</primary>
	<secondary>controlador ATAPI/CAM</secondary>
      </indexterm>
      <title>Uso del controlador ATAPI/CAM</title>

      <para>Este controlador permite que dispositivos ATAPI 
        (CD-ROM, CD-RW, unidades DVD, etc) sean accesibles  a trav&eacute;s 
        del subsistema SCSI y por lo tanto permite el uso de 
        aplicaciones como 
        <filename role="package">sysutils/cdrdao</filename> o 
	&man.cdrecord.1;.</para>

      <para>Para usar este controlador necesitar&aacute; a&ntilde;adir 
        la siguiente l&iacute;nea al fichero de configuraci&oacute;n 
        de su kernel:</para>

      <programlisting>device atapicam</programlisting>

      <para>Es posible que necesite tambi&eacute;n las siguientes 
        l&iacute;neas en el fichero de configuraci&oacute;n 
        de su kernel:</para>

      <programlisting>device ata
device scbus
device cd
device pass</programlisting>

      <para>(que, por otra parte, ya deber&iacute;n estar presentes).</para>

      <para>Recompile, instale su nuevo kernel y reinicie 
        su m&aacute;quina.  Durante el proceso de arranque su 
        grabadora debe ser detectada; veamos un ejemplo:</para>

      <screen>acd0: CD-RW &lt;MATSHITA CD-RW/DVD-ROM UJDA740&gt; at ata1-master PIO4
cd0 at ata1 bus 0 target 0 lun 0
cd0: &lt;MATSHITA CDRW/DVD UJDA740 1.00&gt; Removable CD-ROM SCSI-0 device
cd0: 16.000MB/s transfers
cd0: Attempt to query device size failed: NOT READY, Medium not present - tray closed</screen>

      <para>Puede acceder a la unidad a trav&eacute;s del 
        del nombre de dispositivo <filename>/dev/cd0</filename>; 
        por ejemplo, para montar un CDROM en <filename>/mnt</filename>, 
        tecl&eacute;e lo siguiente:</para>

      <screen>&prompt.root; <userinput>mount -t cd9660 <replaceable>/dev/cd0</replaceable> /mnt</userinput></screen>

      <para>Como <username>root</username>, puede ejecutar el 
        siguiente comando para obtener las direcciones SCSI 
        del dispositivo:</para>

      <screen>&prompt.root; <userinput>camcontrol devlist</userinput>
&lt;MATSHITA CDRW/DVD UJDA740 1.00&gt;   at scbus1 target 0 lun 0 (pass0,cd0)</screen>

      <para>Seg&uacute;n esto, <literal>1,0,0</literal> ser&aacute; la 
        direcci&oacute;n SCSI a utilizar con &man.cdrecord.1; 
        y otras aplicaciones SCSI.</para>

      <para>Para mayor informaci&oacute;n sobre sistemas 
        ATAPI/CAM y SCSI, dir&iacute;jase a las p&aacute;ginas 
        de manual &man.atapicam.4; y &man.cam.4;.</para>
    </sect2>
  </sect1>

  <sect1 id="creating-dvds">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Marc</firstname>
	  <surname>Fonvieille</surname>
	  <contrib>Texto de </contrib>
	</author>
      </authorgroup>
      <authorgroup>
	<author>
	  <firstname>Andy</firstname>
	  <surname>Polyakov</surname>
	  <contrib>Con colaboraciones de </contrib>
	</author>
      </authorgroup>
      <!-- Feb 2004 -->
    </sect1info>

    <title>Crear y utilizar medios &oacute;pticos (DVDs)</title>
    <indexterm>
      <primary>DVD</primary>
      <secondary>grabar</secondary>
    </indexterm>

    <sect2>
      <title>Introducci&oacute;n</title>

      <para>Comparado con el CD, el DVD es la nueva generaci&oacute;n 
        de tecnolog&iacute;a de almacenamiento en medios &oacute;pticos.  
        El DVD puede almacenar m&aacute;s datos que cualquier CD y 
        hoy d&iacute;a es el est&aacute;ndar para publicaci&oacute;n
        de v&iacute;deo.</para>

      <para>Se pueden definir cinco formatos de grabaci&oacute;n para
        lo que llamamos un DVD grabable:</para>

      <itemizedlist>
	<listitem>
          <para>DVD-R: Este fu&eacute; el primer formato de grabaci&oacute;n 
            de DVD.  El DVD-R est&aacute;ndar fu&eacute; definido por el
            <ulink url="http://www.dvdforum.com/forum.shtml">DVD Forum</ulink>.
            Este formato es de una sola escritura.</para>
	</listitem>

	<listitem>
          <para>DVD-RW: Esta es la versi&oacute;n reescribible 
            del DVD-R est&aacute;ndar.  Un DVD-RW puede reescribirse  
            unas 1.000 veces.</para>
	</listitem>

	<listitem>
          <para>DVD-RAM: Este es tambi&eacute;n un formato 
            reescribible soportado por el DVD Forum.  Un 
            DVD-RAM puede verse como un disco duro extra&iacute;ble.  
            Este medio no es compatible con la 
            mayor&iacute;a de las unidades DVD-ROM y reproductores 
            de video DVD; hay muy pocas grabadoras de DVD que soporten 
            el formato DVD-RAM.</para>
	</listitem>

	<listitem>
          <para>DVD+RW: Este es un formato reescribible definido 
            por la 
            <ulink url="http://www.dvdrw.com/">DVD+RW Alliance</ulink>.  
            Un DVD+RW puede reescribirse unas 1000 veces.</para>
	</listitem>

	<listitem>
          <para>DVD+R: Este un formato es la versi&oacute;n 
            de una sola escritura del formato DVD+RW.</para>
	</listitem>
      </itemizedlist>

      <para>Un DVD grabable de una capa puede almacenar hasta
        4.700.000.000&nbsp;bytes, es decir, 4'38&nbsp;GB o 
        4485&nbsp;MB (1 kilobyte son 1.024 bytes).</para>

      <note>
        <para>Debemos hacer una distinci&oacute;n entre medio f&iacute;sico 
          y aplicaci&oacute;n.  Un DVD de v&iacute;deo es una estructura 
          de fichero espec&iacute;fica que puede escribirse en cualquier 
          medio f&iacute;sico consistente en un DVD grabable: DVD-R, DVD+R, 
          DVD-RW, etc.  Antes de elegir el tipo de medio, debe 
          asegurarse que la grabadora y el reproductor de DVD de 
          v&iacute;deo (un reproductor independiente o una unidad DVD-ROM 
          en una computadora) son compatibles con el medio que 
          pretende utilizar.</para></note>
    </sect2>

    <sect2>
      <title>Configuraci&oacute;n</title>

      <para>Utilice &man.growisofs.1; para grabar el DVD.  Forma parte 
        de las herramientas <application>dvd+rw-tools</application> 
        (<filename role="package">sysutils/dvd+rw-tools</filename>).  
        Las <application>dvd+rw-tools</application> permiten usar todos 
        los tipos de DVD.</para>

      <para>Estas herramientas utilizan el subsistema SCSI para 
        acceder a los dispositivos, por lo tanto el 
        <link linkend="atapicam">soporte ATAPI/CAM</link> debe estar 
        presente en su kernel.  Si su grabadora usa el interfaz 
        USB no tendr&aacute; que hacerlo, pero tendr&aacute; que leer 
        la 
        <xref linkend="usb-disks"> para m&aacute;s informaci&oacute;n sobre 
        la configuraci&oacute;n de dispositivos USB.</para>

      <para>Tambi&eacute;n debe que habilitar el acceso DMA para 
        dispositivos ATAPI. Para ello a&ntilde;ada la siguiente 
        l&iacute;nea a 
        <filename>/boot/loader.conf</filename>:</para>

      <programlisting>hw.ata.atapi_dma="1"</programlisting>

      <para>Antes de intentar utilizar 
        <application>dvd+rw-tools</application> debe consultar las 
        <ulink url="http://fy.chalmers.se/~appro/linux/DVD+RW/hcn.html">notas 
        de compatibilidad de hardware de dvd+rw-tools</ulink> por si 
        apareciera cualquier informaci&oacute;n relacionada con su 
        grabadora de DVD.</para>

      <note>
        <para>Si desea un interfaz gr&aacute;fico deber&iacute;a 
          echar un vistazo a <application>K3b</application> 
          (<filename role="package">sysutils/k3b</filename>),  que ofrece 
          un interfaz de usuario amigable para &man.growisofs.1; 
          y muchas otras herramientas de grabaci&oacute;n.</para>
      </note>
    </sect2>

    <sect2>
      <title>Quemado de DVD de datos</title>

      <para>&man.growisofs.1; es un <quote>frontend</quote> de 
        <link linkend="mkisofs">mkisofs</link>, invocar&aacute; 
        a &man.mkisofs.8; para crear una estructura de sistema de 
        ficheros y realizar&aacute; la escritura del DVD.  
        Esto significa que no necesita crear una imagen de los 
        datos antes del proceso de escritura.</para>

      <para>La grabaci&oacute;n en DVD+R o DVD-R de los datos del 
        directorio <filename class="directory">/ruta/a/los/datos</filename>, 
        se hace del siguiente modo:</para>

      <screen>&prompt.root; <userinput>growisofs -dvd-compat -Z <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/ruta/a/los/datos</replaceable></userinput></screen>

      <para>Las opciones <option>-J -R</option> se suministran a 
        &man.mkisofs.8; para la creaci&oacute;n del sistema de 
        ficheros (en este caso: un sistema de ficheros ISO 9660 
        con extensiones Joliet y Rock Ridge).  Consulte la 
        p&aacute;gina de manual &man.mkisofs.8; para m&aacute;s 
        detalles.</para>

      <para>La opci&oacute;n <option>-Z</option> se usa 
        la sesi&oacute;n inicial de grabaci&oacute;n en todos los casos, 
        sesiones m&uacute;ltiples o no. El dispositivo DVD del 
        ejemplo,
        <replaceable>/dev/cd0</replaceable>, debe ajustarse de 
        acuerdo a la configuraci&oacute;n de su sistema.  El par&aacute;mero 
        <option>-dvd-compat</option> cerrar&acute; el disco (no 
        se podr&aacute; a&ntilde;adir nada a la grabaci&oacute;n).  
        Por contra, esto le brindar&aacute; una mejor compatibilidad del 
        medio con unidades DVD-ROM.</para>

      <para>Tambi&eacute;n es posible grabar una imagen pre-masterizada, 
        por ejemplo para guardar la imagen 
        <replaceable>ficheroimagen.iso</replaceable>:</para>

      <screen>&prompt.root; <userinput>growisofs -dvd-compat -Z <replaceable>/dev/cd0</replaceable>=<replaceable>ficheroimagen.iso</replaceable></userinput></screen>

      <para>La velocidad de escritura se detecta y configura 
        autom&aacute;ticamente seg&uacute;n el medio y la unidad que 
        se est&eacute; utilizando.  Si quiere forzar la velocidad de 
        escritura utilice el 
        par&aacute;metro <option>-speed=</option>.  Para m&aacute;s 
        informaci&oacute;n consulte la p&aacute;gina de manual
        &man.growisofs.1;.</para>
    </sect2>

    <indexterm>
      <primary>DVD</primary>
      <secondary>DVD-Video</secondary>
    </indexterm>

    <sect2>
      <title>Grabaci&oacute;n de un DVD de v&iacute;deo</title>

      <para>Un DVD de v&iacute;deo es una estructura de ficheros 
        espec&iacute;fica basada en las especificiones ISO 9660 y 
        micro-UDF (M-UDF).  El DVD de v&iacute;deo tambi&eacute;n 
        dispone de una jerarqu&iacute;a de estructura de datos 
        espec&iacute;fica; por esta raz&oacute;n es necesario un 
        programa especializado para crear tal DVD: 
        <filename role="package">multimedia/dvdauthor</filename>.
        </para>

      <para>Si ya tiene una imagen de un sistema de ficheros de DVD
        de v&iacute;deo gr&aacute;belo de la misma manera que cualquier 
        otra imagen; consulte la secci&oacute;n previa para ver un 
        ejemplo.  Si ha creado el DVD y el resultado est&aacute; en, 
        por ejemplo, el directorio 
        <filename class="directory">/ruta/al/v&iacute;deo</filename>, use 
        el siguiente comando para grabar el DVD de v&iacute;deo:</para>

      <screen>&prompt.root; <userinput>growisofs -Z <replaceable>/dev/cd0</replaceable> -dvd-video <replaceable>/ruta/al/v&iacute;deo</replaceable></userinput></screen>

      <para>La opci&oacute;n <option>-dvd-video</option> 
        de &man.mkisofs.8; har&aacute; posible la creaci&oacute;n  
        de una estructura de sistema de ficheros de DVD de v&iacute;deo.  
        Adem&aacute;s, la opci&oacute;n <option>-dvd-video</option> 
        implica la opci&oacute;n 
        <option>-dvd-compat</option> de &man.growisofs.1;.</para>
    </sect2>

    <indexterm>
      <primary>DVD</primary>
      <secondary>DVD+RW</secondary>
    </indexterm>

    <sect2>
      <title>Uso de un DVD+RW</title>

      <para>A diferencia de un CD-RW, un DVD+RW virgen necesita ser 
        formateado antes de usarse por primera vez.  El programa 
        &man.growisofs.1; se encargar&aacute; de ello autom&aacute;ticamente 
        cuando sea necesario, lo cual es el m&eacute;todo 
        <emphasis>recomendado</emphasis>. De todas formas puede usted 
        usar el comando <command>dvd+rw-format</command> para 
        formatear el DVD+RW:</para>

      <screen>&prompt.root; <userinput>dvd+rw-format <replaceable>/dev/cd0</replaceable></userinput></screen>

      <para>Necesita ejecutar esta operaci&oacute;n solamente una vez, 
        recuerde que s&oacute;lo los DVD+RW v&iacute;rgenes necesitan 
        ser formateados.  Hecho eso ya puede usar el DVD+RW de la 
        forma expuesta en las secciones previas.</para>

      <para>Si desea guardar nuevos datos (grabar un sistema de 
        ficheros totalmente nuevo, no a&ntilde;adir m&aacute;s datos) en 
        un DVD+RW no necesita borrarlo, s&oacute;lo tiene que escribir 
        sobre la grabaci&oacute;n anterior (realizando una 
        nueva sesi&oacute;n inicial):</para>

      <screen>&prompt.root; <userinput>growisofs -Z <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/ruta/alos/datosnuevos</replaceable></userinput></screen>

      <para>El formato DVD+RW ofrece la posibilidad de a&ntilde;adir 
        datos f&aacute;cilmente a una grabaci&oacute;n previa.  
        La operaci&oacute;n consiste en fusionar una nueva sesi&oacute;n 
        a la existente, no es escritura multisesi&oacute;n; 
        &man.growisofs.1; <emphasis>har&aacute; crecer</emphasis> el 
        sistema de ficheros ISO 9660 presente en el medio.</para>

      <para>Si, por ejemplo, a&ntilde;adir datos al DVD+RW del ejemplo 
        anterior tenemos que usar lo siguiente:</para>

      <screen>&prompt.root; <userinput>growisofs -M <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/ruta/alos/datosnuevos</replaceable></userinput></screen>

      <para>Las mismas opciones de &man.mkisofs.8; que utilizamos
        para quemar la sesi&oacute;n inicial pueden usarse en 
        ulteriores escritura.</para>

      <note>
        <para>Puede usar la opci&oacute;n <option>-dvd-compat</option> 
          si desea mejor la compatibilidad de medios con unidades 
          DVD-ROM.  Si la usa en un DVD+RW no evitar&aacute; que 
          pueda a&ntilde;adir m&aacute;s datos.</para>
      </note>

      <para>Si por alguna raz&oacute;n desea borrar el contenido del 
        medio, haga lo siguiente:</para>

      <screen>&prompt.root; <userinput>growisofs -Z <replaceable>/dev/cd0</replaceable>=<replaceable>/dev/zero</replaceable></userinput></screen>
    </sect2>

    <indexterm>
      <primary>DVD</primary>
      <secondary>DVD-RW</secondary>
    </indexterm>

    <sect2>
      <title>Uso de un DVD-RW</title>

      <para>Un DVD-RW acepta dos formatos de disco: el incremental 
        secuencial y el de sobreescritura restringida.  Por defecto 
        los discos DVD-RW est&aacute;n en formato secuencial.
        </para>

      <para>Un DVD-RW virgen puede utilizarse directamente sin 
        necesidad de formateo, sin embargo un DVD-RW no virgen en 
        formato secuencial necesita ser borrado antes de poder guardar 
        una nueva sesi&oacute;n inicial.</para>

      <para>Para borrar un DVD-RW en modo secuencial, ejecute:</para>

      <screen>&prompt.root; <userinput>dvd+rw-format -blank=full <replaceable>/dev/cd0</replaceable></userinput></screen>

      <note>
        <para>Un borrado total (<option>-blank=full</option>) tardar&aacute; 
          aproximadamente una hora en un medio 1x.  Un borrado r&aacute;pido
          puede realizarse con la opci&oacute;n <option>-blank</option> 
          si el DVD-RW fu&eacute; grabado en modo Disk-At-Once (DAO).  
          Para grabar el DVD-RW en modo DAO use el comando:</para>

	<screen>&prompt.root; <userinput>growisofs -use-the-force-luke=dao -Z <replaceable>/dev/cd0</replaceable>=<replaceable>ficheroimagen.iso</replaceable></userinput></screen>

        <para>La opci&oacute;n <option>-use-the-force-luke=dao</option>
          no es imprescindible, ya que &man.growisofs.1; trata 
          de detectar el medio (borrado r&aacute;pido) y entrar en 
          escritura DAO.</para>

        <para>Deber&iacute;a usarse el modo de reescritura restringida 
          en los DVD-RW, pues este formato es m&aacute;s flexible que el 
          formato de incremento secuencial, el formato por defecto.</para>
      </note>

      <para>Para escribir datos en un DVD-RW secuencial proceda del 
         mismo modo que con los dem&aacute;s formatos de DVD:</para>

      <screen>&prompt.root; <userinput>growisofs -Z <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/ruta/alos/datos</replaceable></userinput></screen>

      <para>Si desea a&ntilde;adir datos a una grabaci&oacute;n 
        previa tendr&aacute; que usar la opci&oacute;n 
        <option>-M</option> de &man.growisofs.1;.  
        si a&ntilde;ade datos a un DVD-RW en modo incremental secuencial 
        se crear&aacute; en el disco una nueva sesi&oacute;n 
        y el resultado ser&aacute; un disco multisesi&oacute;n.</para>

      <para>Un DVD-RW en formato de sobreescritura restringido no 
        necesita ser borrado antes de una nueva sesi&oacute;n 
        inicial, s&oacute;lo tiene que sobreescribir el disco con la 
        opci&oacute;n <option>-Z</option>.  esto es similar al 
        caso DVD+RW.  Tambi&eacute;n es posible ampliar un sistema 
        de ficheros ISO 9660 ya existente y escrito en el disco del 
        mismo modo que para un DVD+RW con la opci&oacute;n 
        <option>-M</option>.  El resultado ser&aacute; un DVD 
        de una sesi&oacute;n.</para>

      <para>Para poner un DVD-RW en el formato de sobreescritura 
        restringido haga lo siguiente:</para>

      <screen>&prompt.root; <userinput>dvd+rw-format <replaceable>/dev/cd0</replaceable></userinput></screen>

      <para>Para devolverlo al formato secuencial use:</para>

      <screen>&prompt.root; <userinput>dvd+rw-format -blank=full <replaceable>/dev/cd0</replaceable></userinput></screen>
    </sect2>

    <sect2>
      <title>Multisesi&oacute;n</title>

      <para>Muy pocas unidades DVD-ROM soportan
        DVDs multisesi&oacute;n.  La mayor&iacute;a de las veces (y 
        si tiene suerte) solamente leer&aacute;n la primera 
        sesi&oacute;n.  Los DVD+R, DVD-R y DVD-RW en formato secuencial 
        pueden aceptar multisesiones.  El concepto de multisesi&oacute;n 
        no existe en los formatos de sobreescritura restringida 
        de DVD+RW y DVD-RW.</para>

      <para>Usando el siguiente comando despues de una sesi&oacute;n
        inicial (no-cerrada) en un DVD+R, DVD-R o DVD-RW en formato
        secuencial a&ntilde;adir&aacute; una nueva sesi&oacute;n
        al disco:</para>

      <screen>&prompt.root; <userinput>growisofs -M <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/ruta/alos/nuevosdatos</replaceable></userinput></screen>

      <para>Usando este comando con un DVD+RW o un DVD-RW en modo 
        de sobreescritura restringida, agregar&aacute; datos 
        fusionando la nueva sesi&oacute;n a la ya existente.  El 
        resultado ser&aacute; un disco de una sola sesi&oacute;n.  
        Este es el procedimiento habitual para a&ntilde;adir 
        datos tras la escritura inicial.</para>

      <note>
        <para>Una cierta cantidad de espacio en el medio se usa en 
          cada sesi&oacute;n al finalizar e iniciar sesiones;  
          por tanto, se deben a&ntilde;adir sesiones con grandes 
          cantidades de datos para optimizar el espacio del DVD.  
          El n&uacute;mero de sesiones est&aacute; limitado a 
          154 para un DVD+R, aproximadamente 2.000 para un DVD-R y 
          127 para un DVD+R de doble capa.</para>
      </note>
    </sect2>

    <sect2>
      <title>Para mayor informaci&oacute;n</title>

      <para>Para m&aacute;s informaci&oacute;n sobre 
        un DVD,puede ejecutar el comando 
        <command>dvd+rw-mediainfo <replaceable>/dev/cd0</replaceable></command>
        con el disco en la unidad.</para>

      <para>Tiene m&aacute;s informaci&oacute;n sobre
        <application>dvd+rw-tools</application> en la 
        manual &man.growisofs.1;, en el 
        <ulink url="http://fy.chalmers.se/~appro/linux/DVD+RW/">sitio 
        web de dvd+rw-tools</ulink> y en los archivos de la 
        <ulink url="http://lists.debian.org/cdwrite/">lista de correos 
        de cdwrite</ulink>.</para>

      <note>
        <para>Si va a enviar un informe de problemas es imperativo que 
          adjunte la salida que <command>dvd+rw-mediainfo</command> produjo 
          al grabar (o no grabar) el medio.  Sin esta salida ser&aacute; 
          pr&aacute;cticamente imposible ayudarle.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 id="floppies">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Julio</firstname>
	  <surname>Merino</surname>
	  <contrib>Texto original de </contrib>
	</author>
      </authorgroup>
      <!-- 24 Dec 2001 -->
      <authorgroup>
	<author>
	  <firstname>Martin</firstname>
	  <surname>Karlsson</surname>
	  <contrib>Reescrito por </contrib>
	</author>
      </authorgroup>
      <!-- 27 Apr 2003 -->
    </sect1info>

    <title>Creaci&oacute;n y uso de disquetes (floppies)</title>

    <para>Poder almacenar datos en discos flexibles es &uacute;til algunas 
      veces, por ejemplo cuando no se tiene cualquier otro 
      medio de almacenamiento extraible o cuando se necesita transferir
      una cantidad peque&ntilde;a de datos a otro sistema.</para>

    <para>Esta secci&oacute;n explicar&aacute; c&oacute;mo usar 
      disquetes en &os;.  Cubrir&aacute; principalmente el
      formateo y utilizaci&oacute;n de disquetes DOS 
      de 3.5 pulgadas, pero los conceptos son similares en 
      otros formatos de disquete.</para>

    <sect2>
      <title>Formateo de disquetes</title>

      <sect3>
	<title>El dispositivo</title>

        <para>El acceso a los disquetes se efect&uacute;a a trav&eacute;s 
          de entradas en <filename>/dev</filename>, igual que en 
          otros dispositivos.  Para acceder al disquete 
          <quote>crudo</quote> (raw) en versiones 4.X y anteriores, se usa 
          <filename>/dev/fd<replaceable>N</replaceable></filename>, 
          donde <replaceable>N</replaceable> representa el 
          n&uacute;mero de unidad, generalmente 0, o
          <filename>/dev/fd<replaceable>NX</replaceable></filename>, 
          donde <replaceable>X</replaceable> representa una 
          letra.</para> 

        <para>En versiones 5.0 o posteriores, simplemente use 
          <filename>/dev/fd<replaceable>N</replaceable></filename>.</para>

	<sect4>
	  <title>El tama&ntilde;o de disco en versiones 4.X y anteriores</title>

          <para>Tambi&eacute;n existen dispositivos 
            <filename>/dev/fd<replaceable>N</replaceable>.<replaceable>tama&ntilde;o</replaceable></filename>,
            donde <replaceable>tama&ntilde;o</replaceable> es el 
            tama&ntilde;o del disquete en kilobytes.  Estas entradas se 
            usan durante el formateo a bajo nivel para determinar el 
            tama&ntilde;o del disco.  En los siguientes ejemplos se 
            usar&aacute; el tama&ntilde;o de 1440kB.</para>

          <para>Algunas veces las entradas bajo <filename>/dev</filename> 
            tendr&aacute;n que ser (re)creadas.  Para ello, ejecute:</para>

	  <screen>&prompt.root; <userinput>cd /dev && ./MAKEDEV "fd*"</userinput></screen>
	</sect4>

	<sect4>
	  <title>El tama&ntilde;o de disco en versiones 5.0 y 
            posteriores</title>

          <para>En 5.0, &man.devfs.5; administrar&aacute; 
            autom&aacute;ticamente los nodos de dispositivo en 
            <filename>/dev</filename>, as&iacute; que el uso de 
            <command>MAKEDEV</command> no es necesario.</para>

          <para>El tama&ntilde;o de disco deseado se pasa a &man.fdformat.1; 
            mediante la bandera <option>-f</option>.  Los 
            tama&ntilde;os soportados aparecen en 
            &man.fdcontrol.8;, pero tenga muy en cuenta que 
            1440kB es el que funciona mejor.</para>
	</sect4>
      </sect3>

      <sect3>
	<title>Formatear</title>

        <para>Un disquete necesita ser formateado a bajo nivel 
          antes de poder usarse.  Esto suele hacerlo el fabricante, 
          pero el formateo es una buena manera de revisar 
          la integridad del medio.  Aunque es posible forzar 
          tama&ntilde;os de disco m&aacute;s grandes (o peque&ntilde;os), 
          1440kB es para lo que la mayor&iacute;a de los disquetes 
          est&aacute;n dise&ntilde;ados.</para>

        <para>Para formatear un disquete a bajo nivel debe usar 
          &man.fdformat.1;.  Esta utilidad espera el nombre del 
          dispositivo como argumento.</para>

         <para>Tome nota de cualquier mensaje de error, ya que 
           &eacute;stos pueden ayudarle a determinar si el disco est&aacute; 
           bien o mal.</para>

	<sect4>
	  <title>Formateo en versiones 4.X y anteriores</title>

          <para>Use el dispositivo
            <filename>/dev/fd<replaceable>N</replaceable>.<replaceable>tama&ntilde;o</replaceable></filename>
            para formatear el disquete.  Inserte un disco de 
            3'5 pulgadas en su unidad y ejecute:</para>

	  <screen>&prompt.root; <userinput>/usr/sbin/fdformat /dev/fd0.1440</userinput></screen>

	</sect4>

	<sect4>
	  <title>Formateo en versiones 5.0 y posteriores</title>

          <para>Use el dispositivo
            <filename>/dev/fd<replaceable>N</replaceable></filename>
            para formatear el disquete.  Inserte un disco de 
            3'5 pulgadas en su unidad y ejecute:</para>

	  <screen>&prompt.root; <userinput>/usr/sbin/fdformat -f 1440 /dev/fd0</userinput></screen>

	</sect4>
      </sect3>
    </sect2>



    <sect2>
      <title>La etiqueta de disco</title>

      <para>Tras un formato del disco a bajo nivel necesitar&aacute; 
        colocar una etiqueta de disco en &eacute;l.  Esta etiqueta 
        de disco ser&aacute; destruida m&aacute;s tarde, pero es 
        necesaria para que el sistema determine el tama&ntilde;o del 
        disco y su geometr&iacute;a.</para> 

      <para>La nueva etiqueta de disco ocupar&aacute; todo 
        el disco, y contendr&aacute; toda la informaci&oacute;n 
        apropiada sobre la geometr&iacute;a del disquete.  
        Los valores de geometr&iacute;a para la etiqueta de disco 
        est&aacute;n en 
	<filename>/etc/disktab</filename>.</para>

      <para>Ejecute &man.disklabel.8; as&iacute;:</para>

      <screen>&prompt.root; <userinput>/sbin/disklabel -B -r -w /dev/fd0 fd1440</userinput></screen>

      <note><para>Desde &os;&nbsp;5.1-RELEASE 
        &man.bsdlabel.8; reemplaz&oacute; al viejo programa 
        &man.disklabel.8;.  En &man.bsdlabel.8; se eliminaron muchas 
        opciones y par&aacute;metros obsoletos; en el ejemplo de arriba 
        la opci&oacute;n <option>-r</option> no debe usarse.  
        Para mayor informaci&oacute;n consulte la p&aacute;gina de 
        manual de &man.bsdlabel.8;.</para></note> 

    </sect2>

    <sect2>
      <title>El sistema de ficheros</title>

      <para>Ahora el disquete est&aacute; listo para ser formateado 
        a alto nivel.  Esto colocar&aacute; un sistema de ficheros 
        nuevo en el disco y permitir&aacute; a &os; leer y escribir en 
        el disco.  Despu&eacute;s de crear el sistema de ficheros 
        se destruye la etiqueta de disco, as&iacute; que si desea
        reformatearlo, tendr&aacute; que recrear la etiqueta
        de disco.</para>

      <para>El sistema de ficheros del disquete puede ser UFS o 
        o FAT.  FAT suele ser una mejor opci&oacute;n para 
        disquetes.</para>

      <para>Para formatear un disquete ejecute:</para>

      <screen>&prompt.root; <userinput>/sbin/newfs_msdos /dev/fd0</userinput></screen>

      <para>El disco est&aacute; para su uso.</para>
    </sect2>


    <sect2>
      <title>Uso de un disquete</title>


      <para>Para usar el disquete m&oacute;ntelo con &man.mount.msdos.8; 
        (en versiones 4.X y anteriores) o con &man.mount.msdosfs.8; 
        (en versiones 5.X o posteriores).  Tambi&eacute;n se puede 
        usar <filename role="package">emulators/mtools</filename>.
        </para>
    </sect2>
  </sect1>

  <sect1 id="backups-tapebackups">
    <title>Creaci&oacute;n y uso de cintas de datos</title>

    <indexterm><primary>medios de cinta</primary></indexterm>

    <para>Los principales medios de cinta son 4mm, 8mm, QIC, mini-cartridge
      y DLT.</para>

    <sect2 id="backups-tapebackups-4mm">
      <title>4mm (DDS: Digital Data Storage)</title>

      <indexterm>
        <primary>medios de cinta</primary>
	<secondary>cintas DDS (4mm)</secondary>
      </indexterm>
      <indexterm>
        <primary>medios de cinta</primary>
	<secondary>cintas QIC</secondary>
      </indexterm>
      <para>Las cintas de 4mm est&aacute;n reemplazando a las QIC como los 
        medios de respaldo m&aacute;s frecuentes en estaciones de trabajo.  
        Esta tendencia se aceler&oacute; en gran medida cuando Conner 
        adquiri&oacute; Archive, un fabricante l&iacute;der de unidades 
        QIC, y abandon&oacute; la producci&oacute;n de unidades QIC.  
        Las unidades de 4mm son peque&ntilde;as y silenciosas pero no tienen 
        la reputaci&oacute;n de fiabilidad de la que disfrutan las 
        unidades de 8mm.  Los cartuchos son m&aacute;s baratos  y m&aacute;s 
        peque&ntilde;os (3 x 2 x 0.5 pulgadas, 76 x 51 x 12 mm) que los 
        cartuchos de 8mm. En el caso de las cintas de 4mm, igual que las 
        de  8mm, tienen un cabezal con una vida comparativamente m&aacute;s 
        corta.  Ambos utilizan el escaneado en espiral.</para> 


      <para>El ancho de datos de estas unidades comienza por aprox. 
        150&nbsp;kB/s,  con un pico de aprox. ~500&nbsp;kB/s.  
        La capacidad de datos va de los 
        1'3&nbsp;GB a 2'0&nbsp;GB.  La compresi&oacute;n 
        por hardware, disponible con la mayor&iacute;a de estas unidades, 
        dobla aproximadamente la capacidad.  Existen unidades de biblioteca 
        de cinta multi-unidad con 6 unidades en un solo armario y 
        cambio de cinta autom&aacute;tico.  Las capacidades de estas 
        bibliotecas alcanzan los 240&nbsp;GB.</para>  

      <para>El est&aacute;ndar DDS-3 soporta capacidades de cinta 
        de hasta 12&nbsp;GB (o 24&nbsp;GB con compresi&oacute;n).</para>

      <para>Las unidades de 4mm, igual que las unidades de 8mm, utilizan 
        escaneo en espiral.  Tanto unas como otras tienen las mismas 
        ventajas y desventajas.</para>

      <para>Las cintas deben renovarse por otras despu&eacute;s de 2,000 
        pasadas &oacute; 100 respaldos completos.</para>
    </sect2>

    <sect2 id="backups-tapebackups-8mm">
      <title>8mm (Exabyte)</title>
      <indexterm>
        <primary>medios de cinta</primary>
	<secondary>cintas Exabyte (8mm)</secondary>
      </indexterm>

      <para>Las cintas de 8mm son las unidades de cinta SCSI m&aacute;s comunes;
        son la mejor opci&oacute;n de cintas reemplazables y eso hace que 
        las unidades de cinta Exabyte 8mm de 2&nbsp;GB sean casi 
        omnipresentes.  Las unidades de 8mm son fiables, pr&aacute;cticas y 
        silenciosas.  Los cartuchos son baratos y bastante peque&ntilde;os 
        (4.8 x 3.3 x 0.6 pulgadas; 122 x 84 x 15 mm).  Una desventaja de las 
        cintas de 8mm es la vida relativamente corta del cabezal y de la 
        propia cinta debido a la alta tasa de movimiento relativo de la cinta 
        por los cabezales.</para>

      <para>El ancho de datos var&iacute;a de aprox. 250&nbsp;kB/s  
        hasta los 500&nbsp;kB/s.  La capacidad va desde los 
        300&nbsp;MB hasta los 7&nbsp;GB.  La compresi&oacute;n por 
        hardware, disponible con la mayor&iacute;a de estas unidades, 
        dobla aproximadamente la capacidad.  Estas unidades est&aacute;n 
        disponibles como unidades solas o como unidades de biblioteca 
        de cinta multi-unidad con 6 unidades y 120 cintas en un solo
        armario.  Las cintas las cambia autom&aacute;ticamente la unidad.  
        La capacidad de dichas bibliotecas alcanza los 840+&nbsp;GB.</para>

      <para>El modelo Exabyte <quote>Mammoth</quote> soporta 12&nbsp;GB en 
        una cinta (24&nbsp;GB con compresi&oacute;n) y cuesta aproximadamente 
        el doble que las unidades de cinta convencionales.</para>

      <para>Los datos se graban en cinta utilizando escaneo en espiral.  
        Las cabezas se posicionan en &aacute;ngulo en relaci&oacute;n al
        medio (6 grados aproximadamente).  La cinta se envuelve cerca de 270 
        grados en el cilindro que soporta las cabezas.  El cilindro gira 
        mientras la cinta se desliza sobre el cilindro.  El resultado es 
        una alta densidad de datos y pistas almacenadas muy pegadas, 
        dispuestas en &aacute;ngulo a trav&eacute;s de la cinta de un 
        extremo al otro.</para>
    </sect2>

    <sect2 id="backups-tapebackups-qic">
      <title>QIC</title>
      <indexterm>
        <primary>medios de cinta</primary>
	<secondary>QIC-150</secondary>
      </indexterm>

      <para>Las cintas y unidades QIC-150 son, quiz&aacute;s, las unidades y 
        medios de cinta m&aacute;s comunes.  Las unidades de cinta QIC son 
        las unidades de respaldo <quote>serias</quote> menos caras.  
        La desventaja es el coste del medio.  Las cintas QIC son caras 
        comparadas con las cintas de 8mm o de 4mm, hasta 5 veces el precio de
        almacenamiento de datos por GB.  No obstante, si sus necesidades 
        pueden satisfacerse con media docena de cintas, QIC tal vez sea la 
        decisi&oacute;n correcta.  QIC es la unidad de cinta 
        <emphasis>m&aacute;s</emphasis>  com&uacute;n.  Casi en todas partes 
        tienen una unidad QIC de una u otra densidad.  Y ese es el problema, 
        QIC ofrece un enorme n&uacute;mero de densidades en cintas 
        f&iacute;sicamente similares (algunas veces id&eacute;nticas).  
        Las unidades QIC son cualquier cosa menos silenciosas.  
        Hacen bastante ruido antes de iniciar la grabaci&oacute;n de datos 
        y son claramente audibles siempre que leen, escriben o hacen una 
        b&uacute;squeda.  Las cintas QIC miden 6 x 4 x 0.7 pulgadas;
        152 x 102 x 17 mm.</para>

      <para>El ancho de datos var&iacute;a de aprox. 150&nbsp;kB/s a aprox. 
        500&nbsp;kB/s.  La capacidad de datos var&iacute;a de 40&nbsp;MB 
        a 15&nbsp;GB. La compresi&oacute;n por hardware existe en muchas de 
        las nuevas unidades QIC.  Las unidades QIC se ven con menos 
        frecuencia y adem&aacute;s est&aacute;n siendo suplantadas por 
        unidades DAT.</para>
      
      <para>Los datos se graban en la cinta en pistas.  Las pistas 
        discurren a lo largo del extenso eje de la cinta de un extremo 
        al otro.  El n&uacute;mero de pistas, y por lo tanto el ancho de 
        una pista var&iacute;a seg&uacute;n la capacidad de la cinta.  
        La mayor&iacute;a, si no todas las unidades nuevas, ofrecen 
        compatibilidad con modelos anteriores al menos para lectura 
        (y tambi&eacute;n en muchos casos de escritura).  QIC tiene 
        buena reputaci&oacute;n en cuanto a seguridad de los datos 
        (las piezas mec&aacute;nicas son m&aacute;s simples y 
        m&aacute;s robustas que en las unidades de b&uacute;squeda
        en espiral).</para>

      <para>Las cintas deben ser sustituirse por otras despu&eacute;s de 
        5,000 respaldos.</para>
    </sect2>

    <sect2 id="backups-tapebackups-dlt">
      <title>DLT</title>
      <indexterm>
        <primary>medios de cinta</primary>
	<secondary>DLT</secondary>
      </indexterm>

      <para>DLT tiene la tasa de transferencia de datos m&aacute;s
        r&aacute;pida de todos los tipos de unidades mostradas aqu&iacute;.  
        La cinta de 1/2" (12'5mm) est&aacute; alojada en un cartucho 
        de un solo cilindro (4 x 4 x 1 pulgadas; 100 x 100 x 25 mm).  
        El cartucho tiene una puerta giratoria a lo largo de todo un 
        lado del cartucho.  El mecanismo de la unidad abre esta puerta 
        para extraer el <quote>l&iacute;der</quote>.  El <quote>lider</quote> 
        de la cinta tiene un agujero oval que la unidad utiliza para 
        <quote>enganchar</quote> la cinta.  El cilindro de levantamiento 
        est&aacute; dentro de la unidad de cinta.  Los dem&aacute;s 
        cartuchos descritos en este texto  (los cartuchos de 9 
        pistas son la &uacute;nica excepci&oacute;n) tienen el cilindro 
        proveedor alojados dentro del propio cartucho de cinta.</para>

      <para>El ancho de datos es aproximadamente de 1'5&nbsp;MB/s, tres veces 
        el ancho de unidades de cinta de 4mm, de 8mm o QIC.  Las capacidades 
        de datos var&iacute;an entre 10&nbsp;GB y 20&nbsp;GB en una sola 
        unidad.  Hay unidades multicinta y con cargadores multi-cinta, 
        y bibliotecas multiunidad que pueden albergar de 5 a 900 cintas 
        con una a 20 unidades, con lo que pueden alcanzar desde 
        50&nbsp;GB hasta 9&nbsp;TB de almacenamiento.</para>

      <para>Con compresi&oacute;n, el formato DLT Type IV soporta hasta 
        70&nbsp;GB de capacidad.</para>

      <para>Los datos se almacenan en cinta en pistas paralelas a la 
        direcci&oacute;n del movimiento de la cinta (como en las cintas 
        QIC).  Se escriben dos pistas al mismo tiempo.  El tiempo de vida 
        de lectura/escritura es relativamente largo.  Una vez que la cinta 
        no hay movimiento relativo entre las cabezas y la cinta.</para>
    </sect2>

    <sect2>
      <title id="backups-tapebackups-ait">AIT</title>
      <indexterm>
        <primary>medios de cinta</primary>
	<secondary>AIT</secondary>
      </indexterm>

      <para>AIT es un nuevo formato de Sony, y puede almacenar hasta 
        50&nbsp;GB (con compresi&oacute;n) por cinta.  Las cintas contienen 
        chips de memoria que retienen un &iacute;ndice de los 
        contenidos de la cinta.  Este &iacute;ndice puede ser leido 
        r&aacute;pidamente para determinar la posici&oacute;n 
        de los ficheros en la cinta, en lugar de los varios minutos que 
        requerir&iacute;a el proceso con otras cintas.  
        <application>SAMS:Alexandria</application> puede gestionar 
        m&aacute;s de 40 bibliotecas de cinta AIT, comunic&aacute;ndose 
        directamente con el chip de memoria de la cinta para desplegar 
        el contenido en pantalla, determinar qu&eacute; ficheros fueron 
        respaldados a qu&eacute; cinta, ubicar la cinta correcta, cargarla 
        y restaurar los datos desde la cinta.</para>

      <para>Las bibliotecas como &eacute;sta cuestan alrededor de 20.000 
        d&oacute;lares, lo que las aleja bastante del alcance de los 
        aficionados.</para>
    </sect2>

    <sect2>
      <title>Estreno de una cinta</title>

      <para>La primera vez que trate de leer o escribir una 
        cinta nueva, completamente en blanco, la operaci&oacute;n 
        fallar&aacute;.  El mensaje de la consola se parecer&aacute; 
        al siguiente:</para>

      <screen>sa0(ncr1:4:0): NOT READY asc:4,1
sa0(ncr1:4:0):  Logical unit is in process of becoming ready</screen>

      <para>La cinta no contiene un bloque identificador (bloque n&uacute;mero 
        0).  Todas las unidades de cinta QIC desde la adopci&oacute;n del 
        est&aacute;ndar QIC-525 escriben un bloque identificador en la 
        cinta.  Existen dos soluciones:</para>

      <itemizedlist>
	<listitem>
          <para><command>mt fsf 1</command> hace que la unidad de cinta 
            escriba un bloque identificador a la cinta.</para>
	</listitem>

	<listitem>
          <para>Use el bot&oacute;n del panel frontal para expulsar 
            la cinta.</para>

          <para>Inserte nuevamente la cinta y haga un <command>dump</command> 
            de datos a la cinta.</para>

          <para><command>dump</command> devolver&aacute; 
            <errorname>DUMP: End of tape detected</errorname> y la consola 
            mostrar&aacute; 
            <errorname>HARDWARE FAILURE info:280 asc:80,96</errorname>.</para>

          <para>Rebobine la cinta usando: <command>mt rewind</command>.</para>

          <para>A partir de ese momento podr&aacute; utilizar la cinta.</para>
	</listitem>
      </itemizedlist>

    </sect2>
  </sect1>

  <sect1 id="backups-floppybackups">
    <title>Respaldos en disquetes</title>

    <sect2 id="floppies-using">
      <title>&iquest;Puedo utilizar disquetes para respaldar mis datos?</title>
      <indexterm><primary>respaldo en discos flexibles</primary></indexterm>
      <indexterm><primary>discos flexibles</primary></indexterm>

      <para>Los disquetes no son realmente el medio ideal 
        para hacer respaldos debido a que:</para>

      <itemizedlist>
	<listitem>
          <para>El medio no es fiable, especialmente despu&eacute;s de 
            largos periodos de tiempo.</para>
	</listitem>

	<listitem>
          <para>El respaldo y la restauraci&oacute;n es muy lento.</para>
	</listitem>

	<listitem>
          <para>Tienen una capacidad muy limitada (los d&iacute;s de 
            respaldar un disco duro entero en una docena de disquetes 
            pasaron hace mucho).</para>
	</listitem>
      </itemizedlist>

      <para>De todas maneras, si no tiene otro m&eacute;todo para respaldar
        sus datos los disquetes son una mejor soluci&oacute;n que no tener 
        ning&uacute;n respaldo.</para>

      <para>Si tiene que utilizar disquetes aseg&uacute;rese de usar 
        discos de buena calidad.  Los disquetes que han estado 
        almacenados en la oficina durante un par de a&ntilde;os son una 
        mala elecci&oacute;n.  Lo mejor ser&iacute;a que utilizara discos 
        nuevos de un fabricante respetado.</para>
    </sect2>

    <sect2 id="floppies-creating">
      <title>&iquest;C&oacute;mo respaldo mis datos a discos flexibles?</title>

      <para>La mejor manera de respaldar a un disquete 
        es usar &man.tar.1; con la opci&oacute;n <option>-M</option> 
        (multi volumen), que permite que el respaldo se guarde en 
        varios disquetes.</para>

      <para>Para respaldar todos los ficheros en el directorio actual y 
        sus subdirectorios use esto (como <username>root</username>):</para>

      <screen>&prompt.root; <userinput>tar Mcvf /dev/fd0 *</userinput></screen>

      <para>Cuando el primer disquete est&eacute; lleno 
        &man.tar.1; le solicitar&aacute; que inserte el siguiente 
        volumen (debido a que &man.tar.1; es independiente del medio 
        se refiere a vol&uacute;menes; en &eacute;ste contexto se refiere a 
        disquetes).</para>

      <screen>Prepare volume #2 for /dev/fd0 and hit return:</screen>

      <para>Esto se repite (con el n&uacute;mero de volumen incrementando)
        hasta que todos los ficheros especificados hayan sido archivados.</para>
    </sect2>

    <sect2 id="floppies-compress">

      <title>&iquest;Puedo comprimir mis respaldos?</title>
      <indexterm>
        <primary><command>tar</command></primary>
      </indexterm>
      <indexterm>
        <primary><command>gzip</command></primary>
      </indexterm>
      <indexterm><primary>compresi&oacute;n</primary></indexterm>

      <para>Desafortunadamente, &man.tar.1; no permite 
        el uso de la opci&oacute;n <option>-z</option> para archivos 
        multi-volumen.  Puede, por supuesto, hacer un &man.gzip.1; 
        a todos los ficheros, mandarlos con &man.tar.1; a los 
        disquetes, <emphasis>y despu&eacute;s hacer &man.gunzip.1; 
        a los archivos</emphasis></para> 
    </sect2>

    <sect2 id="floppies-restoring">

      <title>&iquest;C&oacute;mo recupero mis respaldos?</title>

      <para>Para restaurar el archivo completo use:</para>

      <screen>&prompt.root; <userinput>tar Mxvf /dev/fd0</userinput></screen>

      <para>Hay dos maneras que puede usar para restaurar 
        ficheros espec&iacute;ficos.  La primera, puede comenzar por el 
        primer disco flexible y usar:</para>

      <screen>&prompt.root; <userinput>tar Mxvf /dev/fd0 <replaceable>nombredefichero</replaceable></userinput></screen>

      <para>La utilidad &man.tar.1; le pedir&aacute; que inserte el resto de 
        disquetes hasta que encuentre el fichero requerido.</para>

      <para>La segunda manera es: si sabe en qu&eacute; disco se encuentra 
        el fichero puede insertar ese disco y usar el comando expuesto 
        arriba.  Tenga en cuenta que si el primer fichero en el disquete 
        es la continuaci&oacute;n del anterior 
        &man.tar.1; le advertir&aacute; que no puede restaurarlo 
        <emphasis>incluso si no se lo ha solicitado</emphasis></para>
    </sect2>
  </sect1>

  <sect1 id="backup-basics">
    <title>Bases para respaldos</title>

    <para>Los tres principales programas para respaldos son
      &man.dump.8;, &man.tar.1; y &man.cpio.1;.</para> 

    <sect2>
      <title>Dump y Restore</title>
      <indexterm>
        <primary>backup software</primary>
	<secondary>dump / restore</secondary>
      </indexterm>
      <indexterm><primary><command>dump</command></primary></indexterm>
      <indexterm><primary><command>restore</command></primary></indexterm>

      <para>Los programas &unix; que se han usado durante muchos 
        a&ntilde;os para hacer copias de seguridad son 
        <command>dump</command> y <command>restore</command>.  
        Operan en las unidades como una colecci&oacute;n de bloques de 
        disco, bajo la abstracci&oacute;n de ficheros, los enlaces y 
        directorios creados por el sistema de ficheros.  
        <command>dump</command> respalda un sistema de ficheros completo 
        en un dispositivo.  No es capaz de respaldar solamente parte 
        de un sistema de ficheros o un &aacute;rbol de directorios 
        que se extienda por m&aacute;s de un sistema de ficheros.  
        <command>dump</command> no escribe ficheros y directorios a 
        cinta, escribe los bloques de datos <quote>crudos</quote> (raw) 
        que conforman los ficheros y directorios.</para>

      <note><para>Si utiliza <command>dump</command> en su directorio 
        ra&iacute;z, no respaldar&aacute; 
        <filename>/home</filename>, <filename>/usr</filename> ni 
        muchos otros directorios, ya que suelen ser puntos de montaje 
        de otros sistemas de ficheros o enlaces simb&oacute;licos hacia 
        dichos sistemas de ficheros.</para></note>

      <para><command>dump</command> tiene peculiaridades que se mantienen 
        desde sus primeros d&iacute;as en la Version 6 de AT&amp;T UNIX 
        (alrededor de 1975).  Los par&aacute;metros por defecto 
        son los adecuados para cintas de 9 pistas (6250 bpi), pero no para 
        los medios de alta densidad disponibles hoy en d&iacute;a 
        (hasta 62,182 ftpi).  Estos valores por defecto deben 
        obviarse en la l&iacute;nea de comandos para aprovechar la 
        capacidad de las unidades de cinta actuales.</para>

      <indexterm><primary><filename>.rhosts</filename></primary></indexterm>

      <para>Tambi&eacute;n es posible respaldar datos a trav&eacute;s de 
        la red a una unidad de cinta conectada a otra computadora con 
        <command>rdump</command> y <command>rrestore</command>.  Ambos 
        programas dependen de &man.rcmd.3; y &man.ruserok.3; para 
        acceder a la unidad de cinta remota.  Por consiguiente, el usuario 
        que realiza el respaldo debe estar listado en el fichero 
        <filename>.rhosts</filename> de la computadora remota.  Los 
        argumentos para <command>rdump</command> y <command>rrestore</command> 
        deben ser adecuados para usarse en la computadora remota.  
        Cuando realice un <command>rdump</command> desde &os; 
        a una unidad de cinta Exabyte conectada a una Sun llamada 
        <hostid>komodo</hostid>, use:</para>        

      <screen>&prompt.root; <userinput>/sbin/rdump 0dsbfu 54000 13000 126 komodo:/dev/nsa8 /dev/da0a 2>&amp;1</userinput></screen>

      <para>Advertencia: existen implicaciones de seguridad al 
        permitir autentificaci&oacute;n mediante 
        <filename>.rhosts</filename>.  Le recomendamos que 
        eval&uacute;e la situaci&oacute;n cuidadosamente.</para>

      <para>Tambi&eacute;n es posible usar <command>dump</command> y 
        <command>restore</command> de una forma m&aacute;s segura 
        a trav&eacute;s de <command>ssh</command>.</para>

      <example>
	<title>Utilizando <command>dump</command> a trav&eacute;s de 
          <application>ssh</application></title>

	<screen>&prompt.root; <userinput>/sbin/dump -0uan -f - /usr | gzip -2 | ssh -c blowfish \
          usuario@maquinaobjetivo.ejemplo.com dd of=/misficherosgrandes/dump-usr-l0.gz</userinput></screen>

      </example>

      <para>Uso del m&eacute;todo integrado de <command>dump</command>, 
        configurando la variable de ambiente <envar>RSH</envar>:</para>

      <example>
	<title>Uso de <command>dump</command> a trav&eacute;s de 
           <application>ssh</application> con <envar>RSH</envar> 
           configurada</title>

	<screen>&prompt.root; <userinput>RSH=/usr/bin/ssh /sbin/dump -0uan -f usuario@maquinaobjetivo.ejemplo.com:/dev/sa0 /usr</userinput></screen>

      </example>

    </sect2>

    <sect2>
      <title><command>tar</command></title>
      <indexterm>
        <primary>software de respaldo</primary>
        <secondary><command>tar</command></secondary>
      </indexterm>

      <para>&man.tar.1; tambi&eacute;n es de la &eacute;poca de 
        la Version 6 de AT&amp;T UNIX (alrededor de 1975).  
        <command>tar</command> trabaja en cooperaci&oacute;n con el 
        sistema de ficheros; escribe ficheros y directorios a 
        cinta.  <command>tar</command> no soporta el rango completo 
        de opciones que ofrece &man.cpio.1;, pero no requiere el 
        inusual comando de pipeline que utiliza 
        <command>cpio</command>.</para>

      <indexterm><primary><command>tar</command></primary></indexterm>

      <para>En FreeBSD 5.3 y posteriores, tiene a su disposici&oacute;n 
        GNU <command>tar</command> 
        y el comando por defecto <command>bsdtar</command>.  
        La versi&oacute;n GNU puede ser invocada mediante 
        <command>gtar</command>.  Soporta dispositivos remotos mediante 
        la misma sintaxis que <command>rdump</command>.  Para hacer un 
        <command>tar</command> a una unidad de cinta conectada a una 
        Sun llamada <hostid>komodo</hostid>, use:</para>

      <screen>&prompt.root; <userinput>/usr/bin/gtar cf komodo:/dev/nsa8 . 2>&amp;1</userinput></screen>

      <para>Puede hacer lo mismo con o con 
        <command>bsdtar</command> usando un <quote>pipe</quote> y 
        <command>rsh</command> para mandar los datos a una unidad 
        de cinta remota.</para>

      <screen>&prompt.root; <userinput>tar cf - . | rsh <replaceable>nombredemaquina</replaceable> dd of=<replaceable>dispositivo-de-cinta</replaceable> obs=20b</userinput></screen>

      <para>Si le preocupa la seguridad del proceso de hacer un  
        respaldo a trav&eacute;s de una red debe usar 
        <command>ssh</command> en lugar de <command>rsh</command>.
        </para>
    </sect2>

    <sect2>
      <title><command>cpio</command></title>
      <indexterm>
        <primary>software de respaldo</primary>
        <secondary><command>cpio</command></secondary>
      </indexterm>

      <para>&man.cpio.1; es el programa de intercambio de archivos de 
        cinta para medios magn&eacute;ticos.  <command>cpio</command> 
        tiene opciones (entre muchas otras) para realizar intercambio de 
        bytes, escribir un n&uacute;mero diferente de formatos de 
        archivo y hacer <quote>pipe</quote> de datos hacia otros programas.  
        Esta &uacute;ltima opci&oacute;n hace de <command>cpio</command> 
        una elecci&oacute;n excelente para medios de instalaci&oacute;n.  
        <command>cpio</command> no sabe c&oacute;mo recorrer el &aacute;rbol 
        de directorios, as&iacute; que debe facilitarle una lista de 
        directorios a trav&eacute;s de 
        <filename>stdin</filename>.</para>

      <indexterm><primary><command>cpio</command></primary></indexterm>

      <para><command>cpio</command> no permite respaldos a trav&eacute;s 
        de la red.  Puede usar un pipe y <command>rsh</command> 
        para mandar los datos a una unidad de cinta remota.</para>

      <screen>&prompt.root; <userinput>for f in <replaceable>lista_directorios; do</replaceable></userinput>
<userinput>find $f >> backup.list</userinput>
<userinput>done</userinput>
&prompt.root; <userinput>cpio -v -o --format=newc < backup.list | ssh <replaceable>usuario</replaceable>@<replaceable>m&aacute;quina</replaceable> "cat > <replaceable>dispositivo_de_respaldo</replaceable>"</userinput></screen>

      <para>Donde <replaceable>lista_directorios</replaceable> es la lista de 
        directorios que desea respaldar, 
        <replaceable>usuario</replaceable>@<replaceable>m&aacute;quina</replaceable>
        es la combinaci&oacute;n  usuario/nombre de equipo que realizar&aacute; 
        el respaldo y <replaceable>dispositivo_de_respaldo</replaceable> 
        es donde el respaldo se escribir&aacute; efectivamente (por ejemplo 
        <filename>/dev/nsa0</filename>).</para>
    </sect2>

    <sect2>
      <title><command>pax</command></title>
      <indexterm>
        <primary>software de respaldo</primary>
        <secondary><command>pax</command></secondary>
      </indexterm>
      <indexterm><primary><command>pax</command></primary></indexterm>
      <indexterm><primary>POSIX</primary></indexterm>
      <indexterm><primary>IEEE</primary></indexterm>

      <para>&man.pax.1; es la respuesta IEEE/&posix; a 
        <command>tar</command> y <command>cpio</command>.  
        A trav&eacute;s de los a&ntilde;os las diversas versiones 
        de <command>tar</command> y <command>cpio</command> se han
        vuelto ligeramente incompatibles, as&iacute; que en lugar
        de pelear por hacerlo completamente est&aacute;ndar, 
        &posix; cre&oacute; una nueva utilidad de archivado.  
        <command>pax</command> trata de leer y escribir muchos de 
        los diversos formatos de <command>cpio</command> y 
        <command>tar</command>, adem&aacute;s de nuevos formatos 
        propios.  Su conjunto de comandos se parece m&aacute;s a 
        <command>cpio</command> que a 
	<command>tar</command>.</para>
    </sect2>

    <sect2 id="backups-programs-amanda">

      <title><application>Amanda</application></title>

      <indexterm>
        <primary>software de respaldo</primary>
        <secondary><application>Amanda</application></secondary>
      </indexterm>

      <indexterm><primary><application>Amanda</application></primary></indexterm>

      <!-- Remove link until <port> tag is available -->
      
      <para><application>Amanda</application> (Advanced Maryland 
        Network Disk Archiver) es un sistema de respaldos cliente/servidor, 
        en lugar de un solo programa.  Un servidor 
        <application>Amanda</application> 
        respaldar&aacute; a una sola unidad de cinta cualquier cantidad de 
        computadoras que tengan clientes <application>Amanda</application> 
        y una conexi&oacute;n de red al servidor 
        <application>Amanda</application>.  
        Un problema com&uacute;n en sitios con gran cantidad de discos 
        grandes es que la cantidad de tiempo requerida para respaldar los 
        datos directamente a cinta excede la cantidad de tiempo disponible 
        para la tarea.  <application>Amanda</application> resuelve este 
        problema.  <application>Amanda</application> puede usar un 
        <quote>disco intermedio</quote> para respaldar varios sistemas de 
        ficheros al mismo tiempo.  
        <application>Amanda</application> crea 
        <quote>conjuntos de archivo</quote>, esto es, un grupo de cintas 
        usadas durante un periodo de tiempo para crear respaldos completos 
        de todos los sistemas de ficheros listados en el fichero de 
        configuraci&oacute;n de <application>Amanda</application>.  
        El <quote>conjunto de archivo</quote> tambi&eacute;n contiene 
        respaldos incrementales nocturnos (o diferenciales) de todos los 
        sistemas de ficheros.  Para restaurar un sistema de ficheros 
        da&ntilde;ado hace falta el respaldo completo m&aacute;s reciente 
        y los respaldos incrementales.</para>
      
     <para>El fichero de configuraci&oacute;n ofrece un control 
       exhaustivo de los respaldos y del tr&aacute;fico de red que 
       <application>Amanda</application> genera.  
       <application>Amanda</application> usar&aacute; cualquiera de 
       los programas de respaldo mencionados arriba para escribir los 
       datos a cinta.  Puede instalar <application>Amanda</application> 
       como paquete y como port.  No forma parte del sistema base.</para>
      </sect2>

    <sect2>
      <title>No hacer nada</title>

      <para><quote>No hacer nada</quote> no es un programa, pero 
        es la estrategia de respaldo m&aacute;s extendida.  No tiene 
        coste.  No hay un calendario de respaldos a seguir.  Simplemente 
        hay que decir <emphasis>que no</emphasis>.  Si algo le sucediera a 
        sus datos <emphasis>sonr&iacute;a y acost&uacute;mbrese a su nueva 
        situaci&oacute;n</emphasis>.</para>

      <para>Si su tiempo y sus datos valen poco o nada, entonces 
        <quote>no hacer nada</quote> es el programa de respaldo m&aacute;s
        adecuado para usted.  Pero cuidado, &unix; es una herramienta 
        muy poderosa y puede suceder que dentro de seis meses 
        tenga un mont&oacute;n de ficheros que sean valiosos para 
        usted.</para>

      <para><quote>No hacer nada</quote> es el m&eacute;todo correcto de 
        respaldo para <filename>/usr/obj</filename> y otros &aacute;rboles 
        de directorios que pueden ser f&aacute;cilmente recreados por su 
        computadora.  Un ejemplo son los archivos que forman la 
        versi&oacute;n HTML o &postscript; de este manual.  
        Estos documentos han sido generados desde ficheros SGML.  
        Crear respaldos de los archivos HTML o &postscript; no es 
        necesario dado que los ficheros SGML se respaldan regularmente.
        </para>
    </sect2>

    <sect2>
      <title>&iquest;Cu&aacute;l es el mejor programa de respaldos?</title>
      <indexterm>
        <primary>LISA</primary>
      </indexterm>

      <para>&man.dump.8;.   
        <emphasis>Y no hay m&aacute;s que hablar.</emphasis> 
        Elizabeth D. Zwicky realiz&oacute; pruebas de estr&eacute;s a 
        a todos los programas de copia de seguridad aqu&iacute; 
        expuestos.  La elecci&oacute;n clar&iacute;sima para preservar 
        todos sus datos y todas las peculiaridades de sus sistemas de 
        ficheros &unix; es <command>dump</command>.  
        Elizabeth cre&oacute; sistemas de ficheros conteniendo una gran 
        variedad de condiciones inusuales (y algunos no tan inusuales) 
        y prob&oacute; cada programa haciendo un respaldo y restaurando 
        esos sistemas de ficheros.  Esas peculiaridades inclu&iacute;an:  
        ficheros con y un bloque nulo, ficheros con caracteres 
        extra&ntilde;os en sus nombres, ficheros que no se pod&iacute;an 
        leer ni escribir, dispositivos, ficheros que cambiaban de 
        tama&ntilde;o durante el respaldo, ficheros que eran creados/borrados 
        durante el respaldo y cosas as&iacute;.  Elizabeth present&oacute; los 
        resultados en LISA V en octubre de 1991.  
        Consulte <ulink url="http://berdmann.dyndns.org/zwicky/testdump.doc.html">torture-testing
        Backup and Archive Programs</ulink>.</para>
    </sect2>

    <sect2>
      <title>Procedimiento de restauraci&oacute;n de emergencia</title>

      <sect3>
	<title>Antes del desastre</title>

        <para>Solamente existen cuatro pasos que debe realizar 
          en preparaci&oacute;n de cualquier desastre que pudiera 
          ocurrir.</para>
	<indexterm>
    <primary><command>disklabel</command></primary>
  </indexterm>

        <para>Primero, imprima la etiqueta de disco de cada uno 
          de sus discos (<command>disklabel da0 | lpr</command>), 
          su tabla de sistemas de ficheros 
          (<filename>/etc/fstab</filename>) y todos los mensajes de 
          arranque, dos copias de cada uno.</para>

	<indexterm><primary>fix-it floppies</primary></indexterm>
        <para>Segundo, aseg&uacute;rese que los disquetes de rescate 
          (<filename>boot.flp</filename> y <filename>fixit.flp</filename>)
          tienen todos sus dispositivos.  La manera m&aacute;s f&aacute;cil 
          de revisarlo es reiniciar su m&aacute;quina con el disquete 
          en la unidad y revisar los mensajes de arranque.  Si todos sus 
          dispositivos aparecen en la lista y funcionan, pase al tercer 
          paso.</para>

        <para>Si ha habido alg&uacute;n problema tiene que crear dos 
          disquetes de arranque personalizados, que deben tener un 
          kernel que pueda montar todos sus discos y acceder a su 
          unidad de cinta.  Estos discos deben contener: 
          <command>fdisk</command>, <command>disklabel</command>, 
          <command>newfs</command>, <command>mount</command> y 
          cualquier programa de respaldo que utilice.  Estos 
          programas deben estar enlazados est&aacute;ticamente.  Si 
          usa <command>dump</command>, el disquete debe 
          contener <command>restore</command>.</para>

        <para>Tercero, use cintas de respaldo regularmente.  Cualquier 
          cambio que haga despu&eacute;s de su &uacute;ltimo respaldo puede 
          perderse irremediablemente.  Proteja contra escritura las cintas 
          de respaldo.</para>

        <para>Cuarto, pruebe los disquetes (ya sea <filename>boot.flp</filename>
          y <filename>fixit.flp</filename> o los dos discos personalizados 
          que cre&oacute; en el segundo paso) y las cintas de respaldo.  
          Documente el procedimiento.  Almacene estas notas con los 
          discos de arranque, las impresiones y las cintas de respaldo.  
          Estar&aacute; tan perturbado cuando restaure su sistema  que las 
          notas pueden pueden evitar que destruya sus cintas de respaldo.  
          (&iquest;Como? en lugar de <command>tar xvf /dev/sa0</command>, 
          puede teclear accidentalmente <command>tar cvf /dev/sa0</command> 
          y sobreescribir su cinta).</para>  

        <para>Como medida adicional de seguridad haga discos de inicio 
          y dos cintas de respaldo cada vez.  Almacene una de cada 
          en una ubicaci&oacute;n remota.  Una ubicaci&oacute;n remota 
          <emphasis>NO</emphasis> es el s&oacute;tano del mismo edificio.  
          Muchas firmas alojadas en el World Trade Center aprendieron esta 
          lecc&oacute;n de la manera m&aacute;s dif&iacute;cil.  Esa 
          ubicaci&oacute;n remota debe estar separada f&iacute;sicamente 
          de sus computadoras y unidades de disco por una distancia 
          significativa.</para>

	<example>
	  <title>Un <quote>script</quote> para la creaci&oacute;n de discos 
            flexibles de arranque</title>

	<programlisting><![ CDATA [#!/bin/sh
#
# create a restore floppy
#
# format the floppy
#
PATH=/bin:/sbin:/usr/sbin:/usr/bin

fdformat -q fd0
if [ $? -ne 0 ]
then
	 echo "Bad floppy, please use a new one"
	 exit 1
fi

# place boot blocks on the floppy
#
disklabel -w -B /dev/fd0c fd1440

#
# newfs the one and only partition
#
newfs -t 2 -u 18 -l 1 -c 40 -i 5120 -m 5 -o space /dev/fd0a

#
# mount the new floppy
#
mount /dev/fd0a /mnt

#
# create required directories
#
mkdir /mnt/dev
mkdir /mnt/bin
mkdir /mnt/sbin
mkdir /mnt/etc
mkdir /mnt/root
mkdir /mnt/mnt			# for the root partition
mkdir /mnt/tmp
mkdir /mnt/var

#
# populate the directories
#
if [ ! -x /sys/compile/MINI/kernel ]
then
	 cat << EOM
The MINI kernel does not exist, please create one.
Here is an example config file:
#
# MINI -- A kernel to get FreeBSD onto a disk.
#
machine         "i386"
cpu             "I486_CPU"
ident           MINI
maxusers        5

options         INET                    # needed for _tcp _icmpstat _ipstat
                                        #            _udpstat _tcpstat _udb
options         FFS                     #Berkeley Fast File System
options         FAT_CURSOR              #block cursor in syscons or pccons
options         SCSI_DELAY=15           #Be pessimistic about Joe SCSI device
options         NCONS=2                 #1 virtual consoles
options         USERCONFIG              #Allow user configuration with -c XXX

config          kernel	root on da0 swap on da0 and da1 dumps on da0

device          isa0
device          pci0

device          fdc0	at isa? port "IO_FD1" bio irq 6 drq 2 vector fdintr
device          fd0	at fdc0 drive 0

device          ncr0

device          scbus0

device          sc0	at isa? port "IO_KBD" tty irq 1 vector scintr
device          npx0	at isa? port "IO_NPX" irq 13 vector npxintr

device          da0
device          da1
device          da2

device          sa0

pseudo-device   loop            # required by INET
pseudo-device   gzip            # Exec gzipped a.out's
EOM
	 exit 1
fi

cp -f /sys/compile/MINI/kernel /mnt

gzip -c -best /sbin/init > /mnt/sbin/init
gzip -c -best /sbin/fsck > /mnt/sbin/fsck
gzip -c -best /sbin/mount > /mnt/sbin/mount
gzip -c -best /sbin/halt > /mnt/sbin/halt
gzip -c -best /sbin/restore > /mnt/sbin/restore

gzip -c -best /bin/sh > /mnt/bin/sh
gzip -c -best /bin/sync > /mnt/bin/sync

cp /root/.profile /mnt/root

cp -f /dev/MAKEDEV /mnt/dev
chmod 755 /mnt/dev/MAKEDEV

chmod 500 /mnt/sbin/init
chmod 555 /mnt/sbin/fsck /mnt/sbin/mount /mnt/sbin/halt
chmod 555 /mnt/bin/sh /mnt/bin/sync
chmod 6555 /mnt/sbin/restore

#
# create the devices nodes
#
cd /mnt/dev
./MAKEDEV std
./MAKEDEV da0
./MAKEDEV da1
./MAKEDEV da2
./MAKEDEV sa0
./MAKEDEV pty0
cd /

#
# create minimum file system table
#
cat > /mnt/etc/fstab <<EOM
/dev/fd0a    /    ufs    rw  1  1
EOM

#
# create minimum passwd file
#
cat > /mnt/etc/passwd <<EOM
root:*:0:0:Charlie &:/root:/bin/sh
EOM

cat > /mnt/etc/master.passwd <<EOM
root::0:0::0:0:Charlie &:/root:/bin/sh
EOM

chmod 600 /mnt/etc/master.passwd
chmod 644 /mnt/etc/passwd
/usr/sbin/pwd_mkdb -d/mnt/etc /mnt/etc/master.passwd

#
# umount the floppy and inform the user
#
/sbin/umount /mnt
echo "The floppy has been unmounted and is now ready."]]></programlisting>

        </example>

      </sect3>

      <sect3>
	<title>Despu&eacute;s del desastre</title>

        <para>La pregunta clave es: &iquest;sobrevivi&oacute; su hardware?  
          Ha estado haciendo respaldos regularmente, as&iacute; que no hay 
          necesidad de preocuparse por el software.</para>

        <para>Si el hardware ha sufrido da&ntilde;os los componentes deben 
          reemplazarse antes de intentar de usar su sistema.</para>

        <para>Si su hardware est&aacute; bien revise sus discos de arranque.  
          Si usa disquetes de arranque personalizados arranque en modo 
          monousuario (tecl&eacute;e <literal>-s</literal> en el 
          en el <quote>prompt</quote> de arranque <prompt>boot:</prompt>).  
          S&aacute;ltese el siguiente p&aacute;rrafo.</para>

        <para>Si utiliza usando los discos <filename>boot.flp</filename> 
          y <filename>fixit.flp</filename>, siga leyendo.  Inserte el disco 
          <filename>boot.flp</filename> en la primera unidad de disquete 
          y arranque la m&aacute;quina.  El men&uacute; de instalaci&oacute;n 
          original se desplegar&aacute; en pantalla.  Seleccione la 
          opci&oacute;n <literal>Fixit--Repair mode with CDROM or 
          floppy.</literal>.  Inserte el disco <filename>fixit.flp</filename> 
          cuando se le pida.  Tanto <command>restore</command> como los 
          dem&aacute;s programas que necesitar&aacute; est&aacute;n en 
          <filename class="directory">/mnt2/rescue</filename> 
          (<filename class="directory">/mnt2/stand</filename> para versiones 
          de &os; anteriores a 5.2).</para>

	<para>Recupere cada sistema de ficheros por separado.</para>

	<indexterm>
    <primary><command>mount</command></primary>
  </indexterm>
	<indexterm><primary>partici&oacute;n ra&iacute;z</primary></indexterm>
	<indexterm>
    <primary><command>disklabel</command></primary>
  </indexterm>
	<indexterm>
    <primary><command>newfs</command></primary>
  </indexterm>
        <para>Trate de montar (por ejemplo 
          <command>mount /dev/da0a /mnt</command>) la partici&oacute;n 
          ra&iacute;z de su primer disco.  Si la etiqueta del disco 
          ha sufrido da&ntilde;os use <command>disklabel</command> 
          para reparticionar y etiquetar el disco de forma que coincida con 
          la etiqueta que imprimi&oacute; y guard&oacute; previamente.   Use 
          <command>newfs</command> para crear de nuevo sus sistemas de 
          ficheros.  Monte de nuevo la partici&oacute;n ra&iacute;z del 
          disquete en modo lectura/escritura 
          (<command>mount -u -o rw /mnt</command>).  Ejecute su programa de 
          respaldo y utilice las cintas de respaldo para restaurar sus datos 
          en este sistema de ficheros 
          (<command>restore vrf /dev/sa0</command>).  
          Desmonte el sistema de ficheros (<command>umount /mnt</command>).  
          Repita el proceso con cada sistema de ficheros que sufri&oacute; 
          da&ntilde;os.</para>

        <para>Una vez que su sistema est&eacute; en marcha respalde sus 
          datos en cintas nuevas.  Cualquiera que haya sido la causa de 
          la ca&iacute;da o p&eacute;rdida de datos puede suceder de nuevo.  
          Una hora m&aacute;s que gaste ahora puede ahorrarle mucho 
          sufrimiento m&aacute;s adelante.</para>
      </sect3>

<![ %not.published; [

      <sect3>
        <title>* No tom&eacute; medidas antes del desastre 
          &iquest;Y ahora qu&eacute;?</title>

	<para></para>
      </sect3>
]]>

    </sect2>
  </sect1>

  <sect1 id="disks-virtual">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Marc</firstname>
	  <surname>Fonvieille</surname>
	  <contrib>Reorganizado y mejorado por </contrib>
	</author>
      </authorgroup>
    </sect1info>

    <title>Sistemas de ficheros en red, memoria y respaldados en fichero</title>

    <indexterm><primary>discos virtuales</primary></indexterm>
    <indexterm>
      <primary>discos</primary>
      <secondary>virtuales</secondary>
    </indexterm>

    <para>Adem&aacute;s de los discos que conecta f&iacute;sicamente en 
      su m&aacute;quina (discos flexibles, CDs, discos duros, etc.) 
      &os; permite usar otro tipo de discos: 
      <firstterm>los discos virtuales</firstterm>.</para>

    <indexterm><primary>NFS</primary></indexterm>
    <indexterm><primary>Coda</primary></indexterm>
    <indexterm>
      <primary>discos</primary>
      <secondary>memoria</secondary>
    </indexterm>
    <para>Esto incluye sistemas de ficheros en red como 
      <link linkend="network-nfs">NFS</link> y Coda, sistemas de 
      ficheros basados en memoria y sistemas de ficheros basados en
      fichero.</para>

    <para>Seg&uacute;n la versi&oacute;n de &os; que utilice tendr&aacute; 
      que utilizar diferentes herramientas para la creaci&oacute;n y 
      uso de sistemas de ficheros en memoria y sistemas de ficheros 
      basados en fichero.</para>

    <note>
      <para>Los usuarios de FreeBSD&nbsp;4.X tendr&aacute;n que usar 
        &man.MAKEDEV.8; para crear los dispositivos requeridos.  
        FreeBSD&nbsp;5.0 y posteriores usan &man.devfs.5; para 
        gestionar los nodos de dispositivo correspondientes de forma 
        transparente para el usuario.</para>
    </note>

    <sect2 id="disks-vnconfig">

      <title>Sistema de ficheros basado en fichero en FreeBSD&nbsp;4.X</title>
      <indexterm>
        <primary>discos</primary>
        <secondary>file-backed (4.X)</secondary>
      </indexterm>

      <para>La utilidad &man.vnconfig.8; configura y habilita vnodes 
        de dispositivos de pseudodisco.  Un <firstterm>vnode</firstterm> 
        es una representaci&oacute;n de un fichero y es el enfoque de 
        la actividad de fichero.  Esto significa que &man.vnconfig.8; 
        utiliza ficheros para crear y operar un sistema de ficheros.
        Un uso posible es el montaje de im&aacute;genes de disquetes o CD 
        almacenadas como ficheros.</para>

      <para>Para poder usar &man.vnconfig.8; necesitar&aacute; tener 
        &man.vn.4; en el fichero de configuraci&oacute;n de su 
        kernel:</para>

      <programlisting>pseudo-device vn</programlisting>

      <para>Para montar una imagen de un sistema de ficheros:</para>

      <example>
	<title>Uso de vnconfig para montar una imagen de un sistema de 
          ficheros bajo &os;&nbsp;4.X</title>

	<screen>&prompt.root; <userinput>vnconfig vn<replaceable>0</replaceable> <replaceable>imagendedisco</replaceable></userinput>
&prompt.root; <userinput>mount /dev/vn<replaceable>0</replaceable>c <replaceable>/mnt</replaceable></userinput></screen>
      </example>

      <para>Para crear una nueva imagen de un sistema de ficheros con 
        &man.vnconfig.8;:</para>

      <example>
	<title>Creaci&oacute;n de una imagen nueva de un sistema de ficheros 
          respaldado en un archivo con <command>vnconfig</command></title>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=<replaceable>nuevaimagen</replaceable> bs=1k count=<replaceable>5</replaceable>k</userinput>
5120+0 records in
5120+0 records out
&prompt.root; <userinput>vnconfig -s labels -c vn<replaceable>0</replaceable> <replaceable>nuevaimagen</replaceable></userinput>
&prompt.root; <userinput>disklabel -r -w vn<replaceable>0</replaceable> auto</userinput>
&prompt.root; <userinput>newfs vn<replaceable>0</replaceable>c</userinput>
Warning: 2048 sector(s) in last cylinder unallocated
/dev/vn0c:     10240 sectors in 3 cylinders of 1 tracks, 4096 sectors
        5.0MB in 1 cyl groups (16 c/g, 32.00MB/g, 1280 i/g)
super-block backups (for fsck -b #) at:
 32
&prompt.root; <userinput>mount /dev/vn<replaceable>0</replaceable>c <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem  1K-blocks     Used    Avail Capacity  Mounted on
/dev/vn0c        4927        1     4532     0%    /mnt</screen>
      </example>
    </sect2>

    <sect2 id="disks-mdconfig">
      <title>Sistemas de ficheros basados en fichero en 
        FreeBSD&nbsp;5.X</title>
      <indexterm>
        <primary>discos</primary>
        <secondary>file-backed (5.X)</secondary>
      </indexterm>

      <para>&man.mdconfig.8; se usa para configurar y habilitar discos 
        habilitar discos de memoria, &man.md.4;, en FreeBSD&nbsp;5.X.  
        Para usar &man.mdconfig.8;, tendr&aacute; que cargar el m&oacute;dulo 
        &man.md.4; o a&ntilde;adir soporte para el mismo el el fichero de 
        configuraci&oacute;n del kernel:</para>

      <programlisting>device md</programlisting>

      <para>&man.mdconfig.8; soporta tres tipos de discos virtuales 
        en memoria: discos de memoria asignados mediante 
        &man.malloc.9;, discos de memoria usando un fichero o 
        espacio de swap como respaldo.  Un uso posible es 
        montar im&aacute;genes de disquetes o CD archivadas.
        </para>

      <para>Para montar una imagen de un sistema de ficheros:</para>

      <example>
	<title>Uso de <command>mdconfig</command> para montar una imagen 
          de un sistema de ficheros en &os;&nbsp;5.X</title>

	<screen>&prompt.root; <userinput>mdconfig -a -t vnode -f <replaceable>imagendedisco</replaceable> -u <replaceable>0</replaceable></userinput>
&prompt.root; <userinput>mount /dev/md<replaceable>0</replaceable> <replaceable>/mnt</replaceable></userinput></screen>
      </example>

      <para>Para crear una imagen nueva de un sistema de ficheros 
        con &man.mdconfig.8;:</para>

      <example>
	<title>Creaci&oacute;n de un disco respaldado en fichero 
          con <command>mdconfig</command></title>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=<replaceable>nuevaimagen</replaceable> bs=1k count=<replaceable>5</replaceable>k</userinput>
5120+0 records in
5120+0 records out
&prompt.root; <userinput>mdconfig -a -t vnode -f <replaceable>nuevaimagen</replaceable> -u <replaceable>0</replaceable></userinput>
&prompt.root; <userinput>disklabel -r -w md<replaceable>0</replaceable> auto</userinput>
&prompt.root; <userinput>newfs md<replaceable>0</replaceable>c</userinput>
/dev/md0c: 5.0MB (10240 sectors) block size 16384, fragment size 2048
	using 4 cylinder groups of 1.27MB, 81 blks, 256 inodes.
super-block backups (for fsck -b #) at:
 32, 2624, 5216, 7808
&prompt.root; <userinput>mount /dev/md<replaceable>0</replaceable>c <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem  1K-blocks     Used    Avail Capacity  Mounted on
/dev/md0c        4846        2     4458     0%    /mnt</screen>
      </example>

      <para>Si no especifica el n&uacute;mero de unidad con la 
        opci&oacute;n <option>-u</option> &man.mdconfig.8; 
        usar&aacute; la designaci&oacute;n autom&aacute;tica de 
        &man.md.4; para seleccionar un dispositivo sin usar.  
        El nombre de la unidad designada se enviar&aacute; a la salida 
        es&aacute;ndar como <devicename>md4</devicename>.  Para m&aacute;s 
        informaci&oacute;n sobre &man.mdconfig.8; consulte su p&aacute;gina 
        de manual.</para>

      <note><para>A partir de &os;&nbsp;5.1-RELEASE 
        &man.bsdlabel.8; reemplaz&oacute; a 
        &man.disklabel.8;.  En &man.bsdlabel.8; se eliminaron muchas 
        opciones y par&aacute;metros obsoletos.  En el ejemplo de 
        arriba ignore la opci&oacute;n <option>-r</option>.  
        Para m&aacute;s informaci&oacute;n consulte la p&aacute;gina 
        de manual de &man.bsdlabel.8;.</para></note> 

      <para>&man.mdconfig.8; es muy &uacute;til, aunque requiere 
        muchas l&iacute;neas de comando para crear un sistema de ficheros 
        basado en un fichero.  FreeBSD&nbsp;5.0 incorpora &man.mdmfs.8;, 
        que configura un disco &man.md.4; utilizando 
        &man.mdconfig.8;, pone un sistema de ficheros UFS en &eacute;l 
        mediante &man.newfs.8; y lo monta usando &man.mount.8;.  
        Por ejemplo, si desea crear y montar la misma imagen de 
        sistema de ficheros de arriba, simplemente tecl&eacute;e
        lo siguiente:</para>

      <example>
        <title>Configurar y montar un disco basado en un fichero con 
          <command>mdmfs</command></title> 

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=<replaceable>nuevaimagen</replaceable> bs=1k count=<replaceable>5</replaceable>k</userinput>
5120+0 records in
5120+0 records out
&prompt.root; <userinput>mdmfs -F <replaceable>newimage</replaceable> -s <replaceable>5</replaceable>m md<replaceable>0</replaceable> <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0        4846    2  4458     0%    /mnt</screen>
      </example>

      <para>Si utiliza la opci&oacute;n <option>md</option> sin 
        n&uacute;mero de unidad, &man.mdmfs.8; usar&aacute; la 
        opci&oacute;n de auto unidad de &man.md.4; para 
        selecionar autom&aacute;ticamente un dispositivo sin usar.  Para 
        m&aacute;s informaci&oacute;n sobre &man.mdmfs.8; 
        dir&iacute;jase a la p&aacute;gina de manual.</para>

    </sect2>

    <sect2 id="disks-md-freebsd4">

      <title>Sistemas de ficheros basados en memoria en FreeBSD&nbsp;4.X</title>

      <indexterm>
        <primary>discos</primary>
        <secondary>sistemas de ficheros en memoria (4.X)</secondary>
      </indexterm>

      <para>El controlador &man.md.4; es un modo sencillo y eficiente de 
        crear sistemas de ficheros basados en memoria en FreeBSD&nbsp;4.X.  
        &man.malloc.9; se usa para ubicar la memoria.</para>

      <para>Sencillamete toma un sistema de ficheros que usted ha 
        preparado con, por ejemplo, &man.vnconfig.8;, y:</para>

      <example>
	<title>Disco de memoria md en FreeBSD&nbsp;4.X</title>

	<screen>&prompt.root; <userinput>dd if=<replaceable>nuevaimagen</replaceable> of=/dev/md<replaceable>0</replaceable></userinput>
5120+0 records in
5120+0 records out
&prompt.root; <userinput>mount /dev/md<replaceable>0c</replaceable> <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem  1K-blocks     Used    Avail Capacity  Mounted on
/dev/md0c        4927        1     4532     0%    /mnt</screen>
      </example>

      <para>Para m&aacute;s informaci&oacute;n por favor consulte 
        la p&aacute;gina de manual de &man.md.4;.</para>
    </sect2>

    <sect2 id="disks-md-freebsd5">
      <title>sistemas de ficheros basados en memoria en 
        FreeBSD&nbsp;5.X</title>
      <indexterm>
        <primary>discos</primary>
        <secondary>sistemas de ficheros en memoria (5.X)</secondary>
      </indexterm>

      <para>Se usan las mismas herramientas para tratar con sistemas 
        de ficheros basados en memoria o en ficheros: 
        &man.mdconfig.8; o &man.mdmfs.8;.  El almacenamiento de 
        sistemas de ficheros basados en memoria requiere el uso de 
	&man.malloc.9;.</para>

      <example>
	<title>Creaci&oacute;n de un nuevo disco basado en memoria con 
	  <command>mdconfig</command></title>

	<screen>&prompt.root; <userinput>mdconfig -a -t malloc -s <replaceable>5</replaceable>m -u <replaceable>1</replaceable></userinput>
&prompt.root; <userinput>newfs -U md<replaceable>1</replaceable></userinput>
/dev/md1: 5.0MB (10240 sectors) block size 16384, fragment size 2048
	using 4 cylinder groups of 1.27MB, 81 blks, 256 inodes.
	with soft updates
super-block backups (for fsck -b #) at:
 32, 2624, 5216, 7808
&prompt.root; <userinput>mount /dev/md<replaceable>1</replaceable> <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md1        4846    2  4458     0%    /mnt</screen>
      </example>

      <example>
	<title>Creaci&oacute;n de un nuevo disco basado en memoria con
	  <command>mdmfs</command></title>
	<screen>&prompt.root; <userinput>mdmfs -M -s <replaceable>5</replaceable>m md<replaceable>2</replaceable> <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md2        4846    2  4458     0%    /mnt</screen>
      </example>

      <para>En lugar de usar un sistema de ficheros respaldado en 
        &man.malloc.9;, es posible utilizar swap; lo &uacute;nico que 
        debe hacer es sustituir <option>malloc</option> por 
        <option>swap</option> en la l&iacute;nea de comando de 
        &man.mdconfig.8;.  &man.mdmfs.8; por defecto 
        (sin <option>-M</option>) crea un disco basado en swap).  Para 
        m&aacute;s informaci&oacute;n, consulte las 
        p&aacute;ginas de manual de &man.mdconfig.8; y de 
        &man.mdmfs.8;.</para>
    </sect2>

    <sect2>
      <title>Desconexi&oacute;n del sistema de un disco de memoria</title>
      <indexterm>
        <primary>discos</primary>
        <secondary>desconectar un disco de memoria</secondary>
      </indexterm>

      <para>Cuando un sistema de ficheros basado en memoria o 
        basado en fichero no se usa puede liberar recursos del sistema.  
        Lo primero es desmontar el sistema de ficheros: use 
        &man.mdconfig.8; para desconectar el disco del sistema y liberar 
        dichos recursos.</para>
         
      <para>Por ejemplo, para desconectar y liberar todos los
        recursos usados por <filename>/dev/md4</filename>:</para>

      <screen>&prompt.root; <userinput>mdconfig -d -u <replaceable>4</replaceable></userinput></screen>

      <para>Es posible listar informaci&oacute;n sobre dispositivos
        &man.md.4; configurados en el sistema mediante 
        <command>mdconfig -l</command>.</para>

      <para>En FreeBSD&nbsp;4.X se usa &man.vnconfig.8; para desconectar 
        el dispositivo.  Por ejemplo, para desconectar y
        liberar todos los recursos usados por
        <filename>/dev/vn4</filename>:</para>

      <screen>&prompt.root; <userinput>vnconfig -u vn<replaceable>4</replaceable></userinput></screen>


    </sect2>
  </sect1>

  <sect1 id="snapshots">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Tom</firstname>
	  <surname>Rhodes</surname>
	  <contrib>Escrito por </contrib>
	</author>
      </authorgroup>
      <!-- 15 JUL 2002 -->
    </sect1info>

    <title>Instant&aacute;neas (<quote>snapshots</quote>) de sistemas 
      de ficheros</title>

    <indexterm>
      <primary>sistemas de ficheros</primary>
      <secondary>snapshots</secondary>
    </indexterm>

      <para>FreeBSD&nbsp;5.0 ofrece una caracter&iacute;stica relacionada 
        con  
        <link linkend="soft-updates">Soft Updates</link>: las 
        instant&aacute;neas del sistema de ficheros.</para>

      <para>Las instant&aacute;neas permiten a un usuario crear 
        im&aacute;genes de uno o m&aacute;s sistemas de ficheros dados, y 
        tratarlas como un fichero.  Los ficheros de instant&aacute;nea 
        deben crearse en el sistema de ficheros en el que se realiza la 
        acci&oacute;n, y un usuario puede crear hasta 20 (veinte) 
        instant&aacute;neas por sistema de ficheros.  Las 
        instant&aacute;neas activas se graban en el superbloque, lo que 
        hace que sigan ah&iacute; independientemente de montajes, 
        remontajes y reinicios del sistema.  Cuando ya no necesite 
        una instant&aacute;nea puede borrarla con &man.rm.1;.  
        Las instant&aacute;neas pueden borrarse en cualquier orden pero 
        puede que no pueda recuperar todo el espacio debido a que otra 
        instant&aacute;nea puede reclamar algunos bloques liberados.</para>

      <para>La bandera inalterable de fichero <option>snapshot</option> 
        se activa con &man.mksnap.ffs.8; despu&eacute;s de la creaci&oacute;n 
        inicial de un fichero de instant&aacute;nea.  &man.unlink.1; 
        hace una excepci&oacute;n con los ficheros de instant&aacute;nea, 
        ya que permite que se les borre.</para>

      <para>Las instant&aacute;neas se crean con &man.mount.8;.  
        Veamos un ejemplo.  Vamos a colocar una instant&aacute;nea de 
        <filename>/var</filename> en 
        <filename>/var/snapshot/snap</filename>:</para>

<screen>&prompt.root; <userinput>mount -u -o snapshot /var/snapshot/snap /var</userinput></screen>

      <para>Tambi&eacute;n puede usar &man.mksnap.ffs.8; para 
        crear una instant&aacute;nea:</para>

<screen>&prompt.root; <userinput>mksnap_ffs /var /var/snapshot/snap</userinput></screen>

      <para>Si busca ficheros de instant&aacute;nea en un sistema de 
        de ficheros (por ejemplo <filename>/var</filename>) puede usar 
        &man.find.1;:</para>

<screen>&prompt.root; <userinput>find /var -flags snapshot</userinput></screen>

      <para>Una instant&aacute;nea tiene distintos usos:</para>

      <itemizedlist>
	<listitem>
          <para>Algunos administradores usan un fichero de 
            instant&aacute;nea como respaldo, puesto que la instant&aacute;nea 
            puede guardarse en CD o cinta.</para>
	</listitem>

	<listitem>
          <para>Integridad de ficheros; &man.fsck.8; puede ejecutarse 
            en una instant&aacute;nea.  Asumiendo que el sistema de 
            ficheros estuviera limpio cuando se mont&oacute; se debe 
            obtener un resultado limpio (e intacto).  En esencia el 
            proceso &man.fsck.8; hace esto mismo en segundo plano.</para>
	</listitem>

	<listitem>
          <para>Ejecuci&oacute;n de &man.dump.8; en la instant&aacute;nea.  
            Se obtendr&aacute; un dump consistente con el sistema de 
            ficheros y los sellos de hora de la instant&aacute;nea.  
            &man.dump.8; tambi&eacute;n puede leer una instant&aacute;nea, 
            crear una imagen dump y eliminar la instant&aacute;nea en 
            un comando usando la opci&oacute;n 
            <option>-L</option>.</para>
	</listitem>

	<listitem>
          <para>Ejecutar un &man.mount.8; contra la instant&aacute;nea 
            como una imagen congelada del sistema de ficheros.  
            Para montar la instant&aacute;nea 
            <filename>/var/snapshot/snap</filename> ejecute:</para>

<screen>&prompt.root; <userinput>mdconfig -a -t vnode -f /var/snapshot/snap -u 4</userinput>
&prompt.root; <userinput>mount -r /dev/md4 /mnt</userinput></screen>

	</listitem>
      </itemizedlist>

      <para>Podr&aacute; recorrer la jerarqu&iacute;a de su sistema de 
        ficheros <filename>/var</filename> congelado montado en 
        <filename>/mnt</filename>.  Todo estar&aacute; en el mismo estado 
        en el que estaba cuando cre&oacute; la instant&aacute;nea.  
        La &uacute;nica excepci&oacute;n es que cualquier 
        instant&aacute;nea anterior aparecer&aacute; como un fichero 
        de longitud cero.  Cuando haya acabado de usar una 
        instant&aacute;nea puede desmontarla con:</para>
        
<screen>&prompt.root; <userinput>umount /mnt</userinput>
&prompt.root; <userinput>mdconfig -d -u 4</userinput></screen>

      <para>Para m&aacute;s informaci&oacute;n sobre 
        <option>softupdates</option> e instant&aacute;neas de sistemas 
        ficheros, incluyendo textos t&eacute;cnicos, visite el sitio 
        web de Marshall Kirk McKusick: 
	<ulink url="http://www.mckusick.com/"></ulink>.</para>
  </sect1>

  <sect1 id="quotas">
    <title>Cuotas en sistemas de ficheros</title>
    <indexterm>
      <primary>contabilidad</primary>
      <secondary>espacio en disco</secondary>
    </indexterm>
    <indexterm><primary>cuotas de disco</primary></indexterm>

    <para>Las cuotas son una opci&oacute;n del sistema 
      operativo que le permite limitar la cantidad de espacio en 
      disco y/o el n&uacute;mero de fichero que un usuario o 
      miembros de un grupo pueden crear en el sistema, pudiendo 
      adem&aacute;s hacerlo de forma independiente en cada sistema de 
      ficheros.  
      Suele usarse principalmente en sistemas de tiempo compartido, 
      donde se busca limitar la cantidad de recursos que cualquier 
      usuario o grupo pueden utilizar.  
      Esto evitar&aacute; que un usuario o un grupo de usuarios 
      consuma todos el espacio disponible en disco.</para>

    <sect2>
      <title>Configuraci&oacute;n del sistema para habilitar 
       cuotas de disco</title>

      <para>Antes de intentar configurar el uso de cuotas de disco 
        hay que asegurarse de que las cuotas est&aacute;n activadas en el 
        kernel.  La siguiente l&iacute;nea debe estar en el fichero de 
        de configuraci&oacute;n del kernel:</para>

      <programlisting>options QUOTA</programlisting>

      <para>El kernel <filename>GENERIC</filename> no lo tiene activado 
        por defecto, as&iacute; que tendr&aacute; que configurar, 
        compilar e instalar un kernel personalizado para 
        poder usar cuotas de disco.  Por favor, consulte el 
        <xref linkend="kernelconfig"> para m&aacute;s informaci&oacute;n 
        sobre la configuraci&oacute;n del kernel.</para>

      <para>A continuaci&oacute;n tendr&aacute; que habilitar 
        las cuotas de disco en <filename>/etc/rc.conf</filename>.  
        A&ntilde;adale la siguiente l&iacute;nea:</para>

      <programlisting>enable_quotas="YES"</programlisting>
      <indexterm>
        <primary>cuotas de disco</primary>
        <secondary>revisi&oacute;n</secondary>
      </indexterm>

      <para>Hay una variable que le permitir&aacute; efectuar un 
        control m&aacute;s exhaustivo sobre el arranque de cuotas.  
        Normalmente se revisa la integridad de cuotas de cada sistema 
        de ficheros en el arranque; el responsable es 
        &man.quotacheck.8;.  &man.quotacheck.8; se asegura de que los 
        datos que hay en su base de datos de cuotas reflejen 
        realmente los datos del sistema de ficheros.  Es un proceso 
        que lleva mucho tiempo y que afectar&aacute; significativamente 
        al tiempo que tardar&aacute; su sistema en arrancar.  Si desea 
        saltarse ese paso puede usar una variable al efecto en 
        <filename>/etc/rc.conf</filename>:</para>

      <programlisting>check_quotas="NO"</programlisting>

      <para>Para concluir tendr&aacute; que editar 
        <filename>/etc/fstab</filename> para habilitar las cuotas de disco 
        para cada sistema de ficheros.  Es aqu&iacute; donde podr&aacute; 
        habilitar cuotas por usuario, por grupo, o ambos en todos sus 
        sistemas de ficheros.</para>

      <para>Para habilitar cuotas por usuario en un sistema de
        ficheros a&ntilde;ada la opci&oacute;n <option>userquota</option> al 
        campo de opciones en la entrada de <filename>/etc/fstab</filename> 
        que corresponda al sistema de ficheros en el que quiere habilitar 
        las cuotas.  Veamos un ejemplo:</para>

      <programlisting>/dev/da1s2g   /home    ufs rw,userquota 1 2</programlisting>

      <para>En el caso de las cuotas de grupo es muy similar.  
        Use la opci&oacute;n <option>groupquota</option> en lugar 
        de <option>userquota</option>.  Para habilitar 
        cuotas por usuario y por grupo modifique la entrada 
        de este modo:</para>

      <programlisting>/dev/da1s2g    /home    ufs rw,userquota,groupquota 1 2</programlisting>

      <para>Por defecto los ficheros de cuota se guardan en 
        el directorio ra&iacute;z del sistema de ficheros con los 
        nombres <filename>quota.user</filename> y 
        <filename>quota.group</filename> 
        para cuotas de usuario y grupo respectivamente.  
        Consulte &man.fstab.5; para m&aacute;s informaci&oacute;n.  
        Aunque la p&aacute;gina de manual de &man.fstab.5; diga que puede 
        especificar otra ubicaci&oacute;n para los ficheros de 
        cuota, no se recomienda hacerlo debido a que las diversas herramientas 
        de gesti&oacute; cuotas no parecen sobrellevar esto 
        adecuadamente.</para>

      <para>Hecho todo esto puede reiniciar su sistema con el nuevo 
        kernel.  <filename>/etc/rc</filename> ejecutar&aacute; 
        autom&aacute;ticamente los comandos apropiados para crear los 
        ficheros de cuota iniciales que requieran todas las entradas en 
        en <filename>/etc/fstab</filename>, as&iacute; que no hay
        necesidad de crear ficheros de cuota de longitud cero.</para> 

      <para>En el curso normal de operaciones no se le deber&iacute;a 
        pedir que ejecute &man.quotacheck.8;, &man.quotaon.8; o 
        &man.quotaoff.8; manualmente.  Sin embargo, tal vez quiera leer 
        sus p&aacute;ginas de manual para familiarizarse con su 
        funcionamiento.</para> 
    </sect2>

    <sect2>
      <title>Configuraci&oacute;n de l&iacute;mites de cuota</title>
      <indexterm>
        <primary>cuotas de disco</primary>
        <secondary>l&iacute;mites</secondary>
      </indexterm>

      <para>Una vez que tenga configurado su sistema para usar cuotas 
        verifique que en realidad est&eacute;n habilitadas.  Una manera 
        sencilla de hacer esto es ejecutar:</para>

      <screen>&prompt.root; <userinput>quota -v</userinput></screen>

      <para>Debe ver un resumen de una sola l&iacute;nea de uso del 
        disco y los l&iacute;mites de cuota actuales para cada sistema 
        de ficheros donde est&eacute;n habilitadas las cuotas.</para>

      <para>Ahora puede iniciar la asignaci&oacute;n 
        de l&iacute;mites de cuota con &man.edquota.8;.</para>

      <para>Tiene varias opciones para imponer l&iacute;mites en el 
        espacio de disco que un usuario o grupo puede ocupar, y 
        cu&aacute;ntos ficheros pueden crear.  Puede limitar el uso de 
        disco bas&aacute;ndose en el espacio en disco (cuotas de bloque) o 
        en el n&uacute;mero de ficheros (cuotas de inodo) o una 
        combinaci&oacute;n de ambas.  Cada uno de estos l&iacute;mites 
        a su vez se divide en dos categor&iacute;as: l&iacute;mites
        duros y suaves.</para>

      <indexterm><primary>l&iacute;mite duro</primary></indexterm>
      <para>Un l&iacute;mite duro no puede ser excedido.  Una vez que 
        un usuario alcanza su l&iacute;mite duro no puede realizar 
        m&aacute;s ubicaciones en el sistema de ficheros en cuesti&oacute;n.  
        Por ejemplo, si el usuario tiene un l&iacute;mite duro de 
        500 kbytes en un sistema de ficheros y est&aacute; utilizando 
        490 kbytes, el usuario solo puede ocupar 
        otros 10 kbytes.  Un intento de ocupar 11 kbytes m&aacute;s 
        fallar&aacute;.</para>

      <indexterm><primary>l&iacute;mite suave</primary></indexterm>
      <para>Los l&iacute;mites suaves pueden excederse por un periodo 
        Este periodo de tiempo recibe el nombre de periodo de gracia, que 
        por defecto es una semana.  Si un usuario sobrepasa su periodo de 
        gracia el l&iacute;mite suave se convertir&aacute; en 
        un l&iacute;mite duro y no se permitir&acute;n usos de disco 
        adicionales.  Cuando el usuario devuelve su cuota de uso de 
        recursos a un punto por debajo de su l&iacute;mite suave 
        el periodo de gracia se reinicia.</para>

      <para>Veamos un ejemplo de uso de &man.edquota.8;.  
        Si se usa &man.edquota.8; se entra en el el editor declarado en 
        la variable de entorno 
        <envar>EDITOR</envar>, o en el editor <application>vi</application> 
        si no ha modificado el valor por defecto de la variable 
        <envar>EDITOR</envar>, para que pueda editar los 
        l&iacute;mites de cuota.</para>

      <screen>&prompt.root; <userinput>edquota -u test</userinput></screen>

      <programlisting>Quotas for user test:
/usr: kbytes in use: 65, limits (soft = 50, hard = 75)
        inodes in use: 7, limits (soft = 50, hard = 60)
/usr/var: kbytes in use: 0, limits (soft = 50, hard = 75)
        inodes in use: 0, limits (soft = 50, hard = 60)</programlisting>

      <para>Deber&iacute;a ver dos l&iacute;neas por cada sistema 
        de ficheros que tenga habilitadas las cuotas.  Una l&iacute;nea 
        para los l&iacute;mites de bloque y una l&iacute;nea para 
        l&iacute;mites de inodo. Por ejemplo, para elevar los l&iacute;mites 
        de este usuario de un l&iacute;mite suave de 50 y un l&iacute;mite 
        duro de 75 a un l&iacute;mite suave de 500 y un l&iacute;mite 
        duro de 600, cambie:</para>

      <programlisting>/usr: kbytes in use: 65, limits (soft = 50, hard = 75)</programlisting>

      <para>por:</para>

      <programlisting>/usr: kbytes in use: 65, limits (soft = 500, hard = 600)</programlisting>

      <para>Los nuevos l&iacute;mites de cuota se aplicar&aacute;n en 
        cuanto salga del editor.</para>

      <para>Algunas veces se quieren activar l&iacute;mites de cuota 
        en un rango de UIDs. Esto puede realizarse con la opci&oacute;n
        <option>-p</option> de &man.edquota.8;. Primero asigne el 
        l&iacute;mite de cuota deseado a un usuario y luego 
        ejecute 
        <command>edquota -p protouser startuid-enduid</command>.  Por 
        ejemplo, si el usuario <username>test</username> tiene el 
        l&iacute;mite de cuota deseado, el siguiente comando puede 
        usarse para duplicar esos l&iacute;mites de cuota para los 
        UIDs de 10,000 hasta 19,999:</para>

      <screen>&prompt.root; <userinput>edquota -p test 10000-19999</userinput></screen>

      <para>Para m&aacute;s informaci&oacute;n consulte la p&aacute;gina de 
        manual &man.edquota.8;.</para>
    </sect2>

    <sect2>
      <title>Revisi&oacute;n de los l&iacute;mites de cuota y 
        uso de disco</title>
      <indexterm>
        <primary>cuotas de disco</primary>
        <secondary>revisando</secondary>
      </indexterm>

      <para>Puede usar &man.quota.1; o 
        &man.repquota.8; para revisar los l&iacute;mites de
        cuota y uso del disco.  El comando &man.quota.1; 
        le permitir&aacute; revisar cuotas individuales de 
        usuario o grupo y uso del disco.  Un usuario puede 
        s&oacute;lamente examinar su propia cuota y la cuota de un 
        grupo al que pertenezca.  S&oacute;lamente el superusuario 
        puede ver las cuotas de todos los usuarios y grupos.  
        &man.repquota.8; permite obtener 
        un resumen de todas las cuotas y uso del disco de todos los 
        sistemas de ficheros con cuotas habilitadas.</para>

      <para>En el siguiente ejemplo vemos la salida de 
        <command>quota -v</command> para un usuario 
        que tiene l&iacute;mites de cuota en dos sistemas 
        de ficheros.</para>

      <programlisting>Disk quotas for user test (uid 1002):
     Filesystem  usage    quota   limit   grace   files   quota   limit   grace
           /usr      65*     50      75   5days       7      50      60
       /usr/var       0      50      75               0      50      60</programlisting>

      <indexterm><primary>periodo de gracia</primary></indexterm>
      <para>En el sistema de ficheros <filename>/usr</filename> del 
        ejemplo este usuario est&aacute; actualmente 
        15 kbytes sobre su l&iacute;mite suave de 50 kbytes y le quedan 5 
        d&iacute;as de su periodo de gracia.  Observe el asterisco, 
        <literal>*</literal> que indica que el usuario est&aacute; 
        actualmente por encima de su l&iacute;mite de cuota.</para>

      <para>Normalmente los sistemas de ficheros en los que el usuario 
        no est&eacute; utilizando espacio en disco no se mostrar&aacute;n 
        en la salida del comando &man.quota.1;, incluso si tiene 
        un l&iacute;mite de cuota asignado para esos sistemas 
        de fichero.  La opci&oacute;n <option>-v</option>
        desplegar&aacute; esos sistemas de ficheros, en nuestro ejemplo  
        el sistema de ficheros <filename>/usr/var</filename>.</para>
    </sect2>

    <sect2>
      <title>Cuotas en NFS</title>
      <indexterm><primary>NFS</primary></indexterm>

      <para>Las cuotas son impuestas por el subsistema de cuotas en el 
        servidor NFS.  El d&aelig;mon &man.rpc.rquotad.8; facilita la 
        informaci&oacute;n a &man.quota.1; en los clientes 
        NFS, permiti&eacute;ndoles a los usuarios de esas m&aacute;quinas 
        ver sus estad&iacute;sticas de cuota.</para>

      <para>Habilite  <command>rpc.rquotad</command> en 
	<filename>/etc/inetd.conf</filename> del siguiente modo:</para>

      <programlisting>rquotad/1      dgram rpc/udp wait root /usr/libexec/rpc.rquotad rpc.rquotad</programlisting>

      <para>Y reinicie <command>inetd</command>:</para>

      <screen>&prompt.root; <userinput>kill -HUP `cat /var/run/inetd.pid`</userinput></screen>
    </sect2>
  </sect1>


  <sect1 id="disks-encrypting">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Lucky</firstname>
	  <surname>Green</surname>
	  <contrib>Escrito por </contrib>
	  <affiliation>
	    <address><email>shamrock@cypherpunks.to</email></address>
	  </affiliation>
	</author>
      </authorgroup>
      <!-- 11 MARCH 2003 -->
    </sect1info>

    <title>Cifrado de particiones de disco</title>
    <indexterm>
      <primary>discos</primary>
      <secondary>cifrado</secondary></indexterm>

    <para>&os; ofrece un alto grado de protecci&oacute;n 
      contra el acceso no autorizado a los datos.  Los Permisos de fichero 
      y MAC (Mandatory Access Control, controles de acceso obligatorio, 
      consulte el <xref linkend="mac">) ayudan a evitar que otros 
      tengan acceso no autorizado a los datos mientras el sistema 
      operativo est&aacute; funcionando y la computadora est&aacute;
      encendida.  Sin embargo los permisos impuestos por el 
      sistema operativo son irrelevantes si un atacante tiene acceso 
      f&iacute;sico al sistema y puede simplemente mover el disco 
      duro de la computadora a otro sistema para copiar 
      y analizar datos sensibles.</para>

    <para>Independientemente de c&oacute;mo un atacante pueda 
      conseguir acceso a un disco duro a a un sistema apagado, 
      <application>el cifrado de disco basado en GEOM 
      (GEOM Based Disk Encryption, gbde)</application> puede proteger 
      los datos de los sistemas de ficheros del sistema incluso 
      contra atacantes muy decididos y con recursos adecuados a 
      su disposici&oacute;n.   A diferencia de otros m&eacute;todos de 
      cifrado m&aacute;s dif&iacute;ciles de usar, que cifran 
      &uacute;nicamente ficheos individuales, 
      <application>gbde</application> cifra sistemas de ficheros 
      completos de forma transparente.  Ni un solo texto en limpio 
      llega a tocar el disco duro.</para>

    <sect2>
      <title>Habilitar gbde en el kernel</title>

      <procedure>
	<step>
	  <title>Convi&eacute;rtase en <username>root</username></title>

          <para>La configuraci&oacute;n de <application>gbde</application>
            requiere privilegios de superusuario.</para>

	  <screen>&prompt.user; <userinput>su -</userinput>
Password:</screen>
	</step>

	<step>
          <title>Verifique la versi&oacute;n del sistema operativo</title>

	  <para>&man.gbde.4; requiere FreeBSD 5.0 o posterior.</para>

	  <screen>&prompt.root; <userinput>uname -r</userinput>
5.0-RELEASE</screen>
	</step>

	<step>
          <title>A&ntilde;ada soporte de &man.gbde.4; al fichero de 
            configuraci&oacute;n de su kernel</title>

          <para>A&ntilde;ada la siguiente l&iacute;nea al fichero de 
            configuraci&oacute;n de su kernel con el editor que 
            prefiera:</para>

	  <para><literal>options GEOM_BDE</literal></para>

          <para>Configure, recompile e instale el kernel de &os;.  
            Este proceso se detalla en el 
            <xref linkend="kernelconfig">.</para>

	  <para>Reinicie con el nuevo kernel.</para>
	</step>
      </procedure>
    </sect2>


    <sect2>
      <title>Preparaci&oacute;n del disco duro cifrado</title>

      <para>El siguiente ejemplo asume que a&ntilde;ade a su sistema 
        un disco duro nuevo que contendr&aacute; una sola 
        partici&oacute;n cifrada.  Esta partici&oacute;n se 
        montar&aacute; como <filename>/private</filename>.  
        <application>gbde</application> puede usarse tambi&eacute;n 
        para cifrar <filename>/home</filename> y 
        <filename>/var/mail</filename>, 
        pero esto requerir&iacute;a instrucciones m&aacute;s complejas que 
        las que se pretenden dar en esta introducci&oacute;n.</para>
     
      <procedure>
	<step>
	  <title>A&ntilde;ada el nuevo disco</title>

          <para>Instale el nuevo disco en el sistema como se explic&oacute; 
            en la <xref linkend="disks-adding">.  En nuestro ejemplo hemos 
            a&ntilde;adido una nueva partici&oacute;n de disco como 
            <filename>/dev/ad4s1c</filename>.  Los dispositivos 
            <filename>/dev/ad0s1<replaceable>*</replaceable></filename> 
            representan particiones &os; est&aacute;ndar que i
            exist&iacute;an previamente en el sistema.</para>
           
	  <screen>&prompt.root; <userinput>ls /dev/ad*</userinput>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4</screen>
	</step>

	<step>
          <title>Cr&eacute;e un directorio para los ficheros 
            <quote>lock</quote> de gbde</title>

	  <screen>&prompt.root; <userinput>mkdir /etc/gbde</userinput></screen>

          <para>Los ficheros <quote>lock</quote> de 
            <application>gbde</application> 
            contienen informaci&oacute;n que <application>gbde</application> 
            requiere para acceder a las particiones cifradas.   Sin el 
            acceso a los ficheros <quote>lock</quote> 
            <application>gbde</application> no podr&aacute; descifrar los 
            datos alojados en la partici&oacute;n cifrada sin una cantidad 
            significativa de trabajo, tarea para la que adem&aacute;s 
            no le resultar&aacute; de ayuda este software.  Cada 
            partici&oacute;n cifrada utiliza un fichero 
            <quote>lock</quote> separado.</para>
	</step>

	<step>
	  <title>Inicialice la partici&oacute;n gbde</title>

          <para>Una partici&oacute;n <application>gbde</application> 
            debe inicializarse antes de que pueda utilizarse.  
            Esta inicializaci&oacute;n s&oacute;lo debe hacerse 
            una vez:</para>

	  <screen>&prompt.root; <userinput>gbde init /dev/ad4s1c -i -L /etc/gbde/ad4s1c</userinput></screen>

          <para>&man.gbde.8; abrir&aacute; su editor para que pueda 
            configurar las opciones de configuraci&oacute;n que se 
            le presentar&aacute;n en una plantilla.  
            Para utilizar UFS1 o UFS2, ponga el sector_size a 2048:</para>

	  <programlisting>$<!-- This is not the space you are looking
for-->FreeBSD: src/sbin/gbde/template.txt,v 1.1 2002/10/20 11:16:13 phk Exp $
#
# El tama&ntilde;o de sector (sector size) es la unidad de datos m&aacute;s 
# peque&ntilde;a que podr&aacute; leer o escribir.  Si la elige demasiado 
# peque&ntilde;a reducir&aacute; el rendimiento y la cantidad de espacio 
# &uacute;til.  Si la elige demasiado grande puede hacer que los sistemas 
# de ficheros no funcionen.  512 es el tama&ntilde;o m&iacute;nimo y 
# siempre funciona.  Si va a usar UFS utilice
#
sector_size     =       2048
[...]
</programlisting>

          <para>&man.gbde.8; le pedir&aacute; dos veces que escriba la 
            contrase&ntilde;a que debe usarse para asegurar los datos.  
            La contrase&ntilde;a debe ser la misma las dos veces.  La 
            capacidad de <application>gbde</application> de proteger sus 
            datos depende &iacute;ntegramente de la calidad de la 
            contrase&ntilde;a que elija.
	  <footnote>
          <para>Si quiere ayuda para seleccionar una contrase&ntilde;a 
            segura que adem&aacute;s sea f&aacute;cil de recordar visite 
            el sitio web 
            <ulink url="http://world.std.com/~reinhold/diceware.html">Diceware
            Passphrase</ulink>.</para></footnote></para>

          <para>El fichero <command>gbde init</command> crea un fichero 
            <quote>lock</quote> para su partici&oacute;n 
            <application>gbde</application>, que en nuestro ejemplo 
            est&aacute; en 
	    <filename>/etc/gbde/ad4s1c</filename>.</para>

	  <caution>
            <para>Es imprescindible que los ficheros <quote>lock</quote> 
              de <application>gbde</application> 
              <emphasis>deben</emphasis> respaldarse junto con 
              el contenido de cualquier partici&oacute;n cifrada.  
              Aunque la sola acci&oacute; de borrar 
              un fichero <quote>lock</quote> no puede evitar que un atacante 
              motivado descifre una partici&oacute;n 
              <application>gbde</application> sin el fichero 
              <quote>lock</quote>, el propietario leg&iacute;timo 
              no podr&aacute; acceder a los datos en la partici&oacute;n 
              cifrada sin una cantidad notable de trabajo, que es 
              necesario se&ntilde;alar que no entra dentro de las funciones 
              de &man.gbde.8; ni de su dise&ntilde;ador.</para> 
	  </caution>
	</step>

	<step>
          <title>Conecte al kernel la partici&oacute;n cifrada</title>

	  <screen>&prompt.root; <userinput>gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c</userinput></screen>

          <para>Se le pedir&aacute; la contrase&ntilde;a que eliji&oacute; 
            al inicializar la partici&oacute;n cifrada.  El 
            nuevo dispositivo cifrado aparecer&aacute; en 
            <filename>/dev</filename> como 
	    <filename>/dev/nombre_de_dispositivo.bde</filename>:</para>

	  <screen>&prompt.root; <userinput>ls /dev/ad*</userinput>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4        /dev/ad4s1c.bde</screen>
	</step>

	<step>
          <title>Cr&eacute;e un sistema de ficheros en el dispositivo 
            cifrado</title>

          <para>Una vez el dispositivo cifrado est&aacute; conectado 
            al kernel puede crear un sistema de ficheros en el 
            dispositivo con &man.newfs.8;.  Dado que es m&aacute;s 
            r&aacute;pido inicializar un sistema de ficheros del 
            nuevo UFS2 que un sistema de ficheros del tradicional
            UFS1, le recomendamos encarecidamente usar 
            &man.newfs.8; con la opci&oacute;n 
            <option>-O2</option>.</para>

          <note><para>La opci&oacute;n <option>-O2</option> es el 
            valor por defecto en &os;&nbsp;5.1-RELEASE 
            y siguientes.</para></note>

	  <screen>&prompt.root; <userinput>newfs -U -O2 /dev/ad4s1c.bde</userinput></screen>

	  <note>
            <para>&man.newfs.8; debe ejecutarse en una 
              partici&oacute;n <application>gbde</application> 
              conectada, que podr&aacute; identificar por la extensi&oacute;n 
	      <filename><replaceable>*</replaceable>.bde</filename> 
              del nombre del dispositivo.</para>
	  </note>
	</step>

	<step>
          <title>Montar la partici&oacute;n cifrada</title>

          <para>Cr&eacute;e un punto de montaje para el sistema cifrado 
            de ficheros.</para>

	  <screen>&prompt.root; <userinput>mkdir /private</userinput></screen>

          <para>Montar el sistema cifrado de ficheros.</para>

	  <screen>&prompt.root; <userinput>mount /dev/ad4s1c.bde /private</userinput></screen>
	</step>

	<step>
          <title>Verificar que el sistema cifrado de ficheros est&eacute; 
            disponible</title>

          <para>el sistema cifrado de ficheros deber&iacute;a ser visible 
            para &man.df.1; y estar listo para su uso.</para>

	  <screen>&prompt.user; <userinput>df -H</userinput>
Filesystem        Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a      1037M    72M   883M     8%    /
/devfs            1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f       8.1G    55K   7.5G     0%    /home
/dev/ad0s1e      1037M   1.1M   953M     0%    /tmp
/dev/ad0s1d       6.1G   1.9G   3.7G    35%    /usr
/dev/ad4s1c.bde   150G   4.1K   138G     0%    /private</screen>
	</step>
      </procedure>
    </sect2>

    <sect2>
      <title>Montaje de sistemas cifrados de ficheros</title>

      <para>Todos los sistemas cifrados de ficheros deben reconectarse al 
        kernel despu&eacute;s de cada arranque.  Adem&aacute;s, antes de 
        poder utilizarlo debe revisarlo por si contuviera errores y montarlo.  
        Todo el proceso debe ser ejecutado por el usuario 
        <username>root</username>.</para>

      <procedure>
	<step>
          <title>Conectar la partici&oacute;n gbde al kernel</title>

	  <screen>&prompt.root; <userinput>gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c</userinput></screen>

          <para>Se le pedir&aacute; la contrase&ntilde;a que 
            eliji&oacute; en la inicializaci&oacute;n 
            de la partici&oacute;n cifrada gbde.</para>
	</step>

	<step>
          <title>Revisi&oacute;n de errores en el sistema de ficheros</title>

          <para>Como que los sistemas cifrados de ficheros no pueden 
            aparecer en <filename>/etc/fstab</filename> (lo que har&iacute;a 
            que fueran montados autom&aacute;ticamente), los sistemas 
            de ficheros deben revisarse manualmente mediante &man.fsck.8; 
            antes de montarlos.</para>

	  <screen>&prompt.root; <userinput>fsck -p -t ffs /dev/ad4s1c.bde</userinput></screen>
	</step>

	<step>
          <title>Montar los sistemas cifrados de ficheros</title>

	  <screen>&prompt.root; <userinput>mount /dev/ad4s1c.bde /private</userinput></screen>

          <para>El sistema cifrado de ficheros est&aacute; listo para su 
            uso.</para>
	</step>
      </procedure>

      <sect3>
        <title>Montar autom&aacute;ticamente particiones cifradas</title>

        <para>Es posible usar un <quote>script</quote> para automatizar 
          la conexi&oacute;n, revisi&oacute;n y el montaje de una 
          partici&oacute;n cifrada, pero por razones de seguridad el 
          <quote>script</quote> no debe contener la 
          contrase&ntilde;a de &man.gbde.8;.  Se recomienda 
          ejecutar esos <quote>scripts</quote> se ejecuten de forma manual 
          proporcionando la contrase&ntilde;a v&iacute;a consola o 
          &man.ssh.1;.</para>
      </sect3>
    </sect2>

      <sect2>
        <title>Protecci&oacute;n criptogr&aacute;fica que usa gbde</title>

        <para>&man.gbde.8; cifra el XXX sector payload usando AES de 128 bits 
          en modo CBC.  Cada sector en el disco se cifra con una clave 
          AES diferente.  Para m&aacute;s informaci&oacute;n sobre el 
          dise&ntilde;o criptogr&aacute;fico de 
          <application>gbde</application>, incluyendo c&oacute;mo se 
          derivan las claves de sector a partir de la contrase&ntilde;a 
          consulte &man.gbde.4;.</para>
      </sect2>

      <sect2>
        <title>Problemas de compatibilidad</title>

        <para>&man.sysinstall.8; es incompatible con dispositivos 
          <application>gbde</application> cifrados.  Todos los 
          dispositivos <devicename><replaceable>*</replaceable>.bde</devicename>
          deben desconectarse del kernel antes de iniciar 
          &man.sysinstall.8; o se <quote>congelar&aacute;</quote> durante 
          la prueba inicial de dispositivos.  Para desconectar el 
          el dispositivo cifrado de nuestro ejemplo haga lo siguiente:
          </para>

	<screen>&prompt.root; <userinput>gbde detach /dev/ad4s1c</userinput></screen>

      <para>Tenga en cuenta tambi&eacute;n que, como &man.vinum.4; no 
        utiliza el subsistema &man.geom.4;, no es posible usar 
        <application>gbde</application> en vol&uacute;menes 
	<application>vinum</application>.</para>
      </sect2>

  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->

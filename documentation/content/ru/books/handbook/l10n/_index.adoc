---
title: Глава 20. Локализация - использование и настройка i18n/L10n
part: Часть III. Системное администрирование
prev: books/handbook/filesystems
next: books/handbook/cutting-edge
---

[[l10n]]
= Локализация - использование и настройка i18n/L10n
:doctype: book
:toc: macro
:toclevels: 1
:icons: font
:sectnums:
:sectnumlevels: 6
:source-highlighter: rouge
:experimental:
:skip-front-matter:
:toc-title: Содержание
:table-caption: Таблица
:figure-caption: Рисунок
:example-caption: Пример
:xrefstyle: basic
:relfileprefix: ../
:outfilesuffix:
:sectnumoffset: 20

ifeval::["{backend}" == "html5"]
:imagesdir: ../../../images/books/handbook/l10n/
endif::[]

ifeval::["{backend}" == "pdf"]
:imagesdir: ../../../../static/images/books/handbook/l10n/
endif::[]

ifeval::["{backend}" == "epub3"]
:imagesdir: ../../../../static/images/books/handbook/l10n/
endif::[]

include::shared/authors.adoc[]
include::shared/releases.adoc[]
include::shared/ru/mailing-lists.adoc[]
include::shared/ru/teams.adoc[]
include::shared/ru/urls.adoc[]

toc::[]

[[l10n-synopsis]]
== Краткий обзор

FreeBSD - это распределенный проект, пользователи и контрибьюторы которого находятся в самых разных частях света. Поэтому FreeBSD поддерживает локализацию на многие языки, что позволяет просматривать, вводить и обрабатывать данные на языках, отличных от английского. Можно выбрать среди большинства основных языков, в том числе: китайский, немецкий, японский, корейский, французский, русский и вьетнамский.

Термин интернационализация (`internationalization`) сокращают до i18n, по числу символов в английском слове. Сокращение L10n аналогично получается от слова `localization`. i18n/L10n методы, протоколы и приложения позволяют пользователям использовать языки по своему выбору.

В этой главе обсуждаются особенности интернационализации и локализации FreeBSD, включая следующие темы:

* Схема именования локалей.
* Установка региональных настроек для оболочки.
* Локализация консоли.
* Локализация Xorg.
* Поиск i18n-совместимых приложений.
* Информация по настройке для некоторых языков.

Перед чтением этой главы вам следует знать:

* Как crossref:ports[ports,установить дополнительные приложения сторонних разработчиков].

[[using-localization]]
== Использование локализации

Настройки локализации состоят из трёх компонентов: код языка, код страны и кодировка. Из этих частей формируются названия локалей:

[.programlisting]
....
КодЯзыка_КодСтраны.Кодировка
....

_КодЯзыка_ и _КодСтраны_ используются для определения страны и конкретного диалекта языка. <<locale-lang-country>> содержит некоторые примеры пар __КодЯзыка_КодСтраны__:

[[locale-lang-country]]
.Основные коды языка и страны
[cols="1,1", frame="none", options="header"]
|===
| КодЯзыка_КодСтраны
| Описание

|en_US
|Английский, Соединенные Штаты

|ru_RU
|Русский, Россия

|zh_TW
|Традиционный китайский, Тайвань
|===

Полный список локалей доступен по команде:

[source,bash]
....
% locale -a | more
....

Чтобы определить текущую локаль:

[source,bash]
....
% locale
....

Специфичные для языков наборы символов ISO8859-1, ISO8859-15, KOI8-R, CP437 описаны в man:multibyte[3]. Актуальный список наборов символов находится на сайте http://www.iana.org/assignments/character-sets[IANA Registry].

Некоторые языки, такие как китайский или японский, не могут быть представлены с использованием символов ASCII, и для них требуется дополненная языковая кодировка с использованием расширенного или многобайтового представления символов. Такими кодировками являются EUC и Big5. Старые приложения могут ошибочно принимать символы в таких кодировках за управляющие, в то время как новые обычно их распознают. В зависимости от реализации, пользователю может потребоваться компиляция приложения с поддержкой расширенного или многобайтового представления символов или правильная его настройка.

[NOTE]
====
Во FreeBSD используются Xorg-совместимые кодировки.
====

В продолжении этого раздела рассматриваются различные способы настройки локализации в системе FreeBSD. В следующем разделе выносятся соображения по поиску и компиляции приложений с поддержкой i18n.

[[setting-locale]]
=== Настройка локализации для оболочки

Для настроек локализации используется пользовательский [.filename]#~/.login_conf# или инициализационый файл пользовательской оболочки: [.filename]#~/.profile#, [.filename]#~/.bashrc# или [.filename]#~/.cshrc#.

Следует задать две переменные окружения:

* `LANG` задаёт локаль
*
+ 
`MM_CHARSET` задаёт набор символов MIME для приложений

В дополнение к настройкам пользовательской оболочки эти переменные также следует задать в конфигурации конкретного приложения и в конфигурации Xorg.

Существует два способа выполнить необходимые присвоения переменным: <<login-class,класс логина>>, который является рекомендуемым, и <<startup-file,файл инициализации>>. В следующих двух разделах будет показано, как использовать оба способа.

[[login-class]]
==== Настройка через классы логина

Первый способ является рекомендуемым, поскольку в нём необходимые для выбора локализации и набора символов MIME значения переменных окружения присваиваются для всех оболочек. Эту процедуру может выполнить пользователь для себя, а также это может сделать в виде настройки суперпользователь для всех пользователей системы.

В этом минимальном примере обе переменные задаются для кодировки Latin-1 в [.filename]#.login_conf# домашнего каталога отдельного пользователя:

[.programlisting]
....
me:\
	:charset=ISO-8859-1:\
	:lang=de_DE.ISO8859-1:
....

Ниже дан [.filename]#~/.login_conf#, в котором переменные заданы для традиционного китайского в кодировке BIG-5. Здесь нужно больше переменных, потому что некоторые программы некорректно воспринимают переменные окружения локализации для Китая, Японии и Кореи:

[.programlisting]
....
#Пользователи, которые не хотят использовать денежные единицы
#и форматы времени Тайваня, могут вручную изменить каждую переменную
me:\
	:lang=zh_TW.Big5:\
	:setenv=LC_ALL=zh_TW.Big5,LC_COLLATE=zh_TW.Big5,LC_CTYPE=zh_TW.Big5,LC_MESSAGES=zh_TW.Big5,LC_MONETARY=zh_TW.Big5,LC_NUMERIC=zh_TW.Big5,LC_TIME=zh_TW.Big5:\
	:charset=big5:\
	:xmodifiers="@im=gcin": #Set gcin as the XIM Input Server
....

Как вариант, суперпользователь может настроить локализацию для всех пользователей системы. Следующие переменные в [.filename]#/etc/login.conf# используются для установки локализации и набора символов MIME:

[.programlisting]
....
название_языка|подробное описание:\
	:charset=кодировка_MIME:\
	:lang=название_локализации:\
	:tc=default:
....

Таким образом, на предыдущем примере с Latin-1 это бы выглядело так:

[.programlisting]
....
german|German Users Accounts:\
	:charset=ISO-8859-1:\
	:lang=de_DE.ISO8859-1:\
	:tc=default:
....

За информацией по этим переменным обращайтесь к man:login.conf[5]. Отметим, что там уже присутствует класс _russian_.

После каждого изменения [.filename]#/etc/login.conf# не забывайте выполнить команду для обновления базы данных:

[source,bash]
....
# cap_mkdb /etc/login.conf
....

===== Утилиты для смены класса логина

В дополнение к ручному редактированию [.filename]#/etc/login.conf# имеется несколько утилит, которые позволяют задать локаль при создании новых пользователей:

Если для добавлении новых пользователей используется `vipw`, то чтобы задать локаль, укажите _язык_:

[.programlisting]
....
user:password:1111:11:язык:0:0:User Name:/home/user:/bin/sh
....

Если для добавления новых пользователей используется `adduser`, то язык по умолчанию можно предварительно выбрать для всех новых пользователей или указать его для отдельного пользователя.

Если все новые пользователи используют общий язык, задайте `defaultclass=_язык_` в [.filename]#/etc/adduser.conf#.

Чтобы переопределить эту настройку при создании пользователя, введите требуемую локаль в запросе командной строки:

[source,bash]
....
Enter login class: default []: 
....

или укажите её в команде man:adduser[8]:

[source,bash]
....
# adduser -class язык
....

Если для добавления новых пользователей используется `pw`, укажите локаль так:

[source,bash]
....
# pw useradd имя_пользователя -L язык
....

Изменить класс логина у существующего пользователя можно с помощью `chpass`, передав имя пользователя через параметр:

[source,bash]
....
# chpass имя_пользователя
....

[[startup-file]]
==== Файл инициализации оболочки

Второй способ не рекомендуется, поскольку для каждой используемой оболочки требуется ручная конфигурация, при этом в каждой оболочке используется собственный файл конфигурации и разный синтаксис. Например, чтобы задать немецкий язык в оболочке `sh`, эти строчки можно было бы добавить в [.filename]#~/.profile# для настройки оболочки отдельного пользователя. Также их можно было бы добавить в [.filename]#/etc/profile# или [.filename]#/usr/shared/skel/dot.profile#, чтобы применить ко всем пользователям:

[.programlisting]
....
LANG=de_DE.ISO8859-1; export LANG
MM_CHARSET=ISO-8859-1; export MM_CHARSET
....

Тем не менее, путь к файлу конфигурации и используемый синтаксис отличаются в оболочке `csh`. Следующие настройки можно одинаково успешно задать в [.filename]#~/.csh.login#, [.filename]#/etc/csh.login# и [.filename]#/usr/shared/skel/dot.login#:

[.programlisting]
....
setenv LANG de_DE.ISO8859-1
setenv MM_CHARSET ISO-8859-1
....

Используемый в [.filename]#~/.xinitrc# синтаксис для настройки Xorg также зависит от оболочки. Первый пример для оболочки `sh`, и второй для `csh`:

[.programlisting]
....
LANG=de_DE.ISO8859-1; export LANG
....

[.programlisting]
....
setenv LANG de_DE.ISO8859-1
....

[[setting-console]]
=== Настройка консоли

Для консоли имеется несколько локализованных шрифтов. Для их просмотра наберите `ls /usr/shared/syscons/fonts`. Чтобы настроить консольный шрифт, укажите в [.filename]#/etc/rc.conf#_имя_шрифта_ без расширения [.filename]#.fnt#:

[.programlisting]
....
font8x16=имя_шрифта
font8x14=имя_шрифта
font8x8=имя_шрифта
....

Значения keymap и screenmap можно задать в [.filename]#/etc/rc.conf#:

[.programlisting]
....
scrnmap=название_screenmap
keymap=название_keymap
keychange="последовательность fkey_number"
....

Чтобы просмотреть доступные таблицы screenmap, наберите `ls /usr/shared/syscons/scrnmaps`. Значение _screenmap_ указывается без расширения [.filename]#.scm#. Таблица screenmap с соответствующим шрифтом обычно используется в качестве обходного пути для расширения 8 бит до 9 бит в матрице символов шрифта адаптора VGA. Это будет приводить к вынесению букв за границы псевдографической области, если используется 8-битный шрифт.

Чтобы просмотреть доступные таблицы keymap, наберите `ls /usr/shared/syscons/keymaps`. Значение _keymap_ указывается без расширения [.filename]#.kbd#. Чтобы проверить keymap без перезагрузки системы, используйте man:kbdmap[1].

Запись `keychange` обычно нужна для сопоставления функциональных клавиш выбранному типу терминала, поскольку последовательности функциональных клавиш не могут быть определены в keymap.

После этого задайте правильный консольный тип терминала в [.filename]#/etc/ttys# для всех виртуальных терминалов. <<locale-charset>> содержит доступные типы терминалов:
[[locale-charset]]
.Типы терминалов для набора символов
[cols="1,1", frame="none", options="header"]
|===
| Набор символов
| Тип терминала

|ISO8859-1 or ISO8859-15
|`cons25l1`

|ISO8859-2
|`cons25l2`

|ISO8859-7
|`cons25l7`

|KOI8-R
|`cons25r`

|KOI8-U
|`cons25u`

|CP437 (VGA default)
|`cons25`

|US-ASCII
|`cons25w`
|===

Для языков с расширенной или многобайтовой кодировкой установите консоль для данного языка из Коллекции Портов FreeBSD. <<locale-console>> содержит доступные порты. После установки смотрите [.filename]#pkg-message# или страницы Справочника по конфигурации и использованию данного порта.
[[locale-console]]
.Доступные консоли из Коллекции Портов
[cols="1,1", frame="none", options="header"]
|===
| Язык
| Расположение порта

|Традиционный китайский (BIG-5)
|package:chinese/big5con[]

|Chinese/Japanese/Korean
|package:chinese/cce[]

|Chinese/Japanese/Korean
|package:chinese/zhcon[]

|Japanese
|package:chinese/kon2[]

|Japanese
|package:japanese/kon2-14dot[]

|Japanese
|package:japanese/kon2-16dot[]
|===

Если moused включен в [.filename]#/etc/rc.conf#, может потребоваться дополнительная настройка. По умолчанию драйвер man:syscons[4] выделяет для курсора мыши в таблице символов диапазон `0xd0`-`0xd3`. Если в языке этот диапазон используется, переместите диапазон курсора посредством добавления следующей строки в [.filename]#/etc/rc.conf#:

[.programlisting]
....
mousechar_start=3
....

=== Настройка Xorg

crossref:x11[x11, X Window System] описывает процедуру установки и настройки Xorg. Для настройки локализации Xorg в Коллекции Портов FreeBSD имеются дополнительные шрифты и методы ввода. Настройки i18n для отдельных приложений, такие как шрифты и меню, можно внести в [.filename]#~/.Xresources#, чтобы меню в графических приложениях отображались на выбранном языке.

Протокол X Input Method (XIM) - это стандарт Xorg для ввода неанглийских символов. <<locale-xim>> описывает приложения для методов ввода, которые содержатся в Коллекции Портов FreeBSD. Также доступны дополнительные приложения Fcitx и Uim.
[[locale-xim]]
.Доступные метода ввода
[cols="1,1", frame="none", options="header"]
|===
| Язык
| Метод ввода

|китайский
|package:chinese/gcin[]

|китайский
|package:chinese/ibus-chewing[]

|китайский
|package:chinese/ibus-pinyin[]

|китайский
|package:chinese/oxim[]

|китайский
|package:chinese/scim-fcitx[]

|китайский
|package:chinese/scim-pinyin[]

|китайский
|package:chinese/scim-tables[]

|японский
|package:japanese/ibus-anthy[]

|японский
|package:japanese/ibus-mozc[]

|японский
|package:japanese/ibus-skk[]

|японский
|package:japanese/im-ja[]

|японский
|package:japanese/kinput2[]

|японский
|package:japanese/scim-anthy[]

|японский
|package:japanese/scim-canna[]

|японский
|package:japanese/scim-honoka[]

|японский
|package:japanese/scim-honoka-plugin-romkan[]

|японский
|package:japanese/scim-honoka-plugin-wnn[]

|японский
|package:japanese/scim-prime[]

|японский
|package:japanese/scim-skk[]

|японский
|package:japanese/scim-tables[]

|японский
|package:japanese/scim-tomoe[]

|японский
|package:japanese/scim-uim[]

|японский
|package:japanese/skkinput[]

|японский
|package:japanese/skkinput3[]

|японский
|package:japanese/uim-anthy[]

|корейский
|package:korean/ibus-hangul[]

|корейский
|package:korean/imhangul[]

|корейский
|package:korean/nabi[]

|корейский
|package:korean/scim-hangul[]

|корейский
|package:korean/scim-tables[]

|вьетнамский
|package:vietnamese/xvnkb[]

|вьетнамский
|package:vietnamese/x-unikey[]
|===

[[l10n-compiling]]
== Поиск приложений i18n

i18n приложения пишутся с применением набора i18n в библиотеках. Это позволяет разработчикам писать простые файлы и переводить отображаемые меню и надписи на любые языки.

В link:https://www.FreeBSD.org/ru/ports/[Коллекции портов FreeBSD] содержится множество приложений со встроенной поддержкой символов с расширенным и многобайтовым представлением для нескольких языков. Чтобы упростить поиск таких приложений, в их названии содержится аббревиатура `i18n`. Тем не менее, они не всегда поддерживают нужный язык.

Некоторые приложения могут быть собраны с конкретной кодировкой. Обычно это делается через [.filename]#Makefile# порта или передачей параметра configure. Для получения этой информации смотрите документацию i18n для соответствующего порта FreeBSD.

[[lang-setup]]
== Настройка локализации для некоторых языков

В этом разделе приведены примеры локализации системы FreeBSD на русский язык. В завершение приводится дополнительная информация для локализации на другие языки.

[[ru-localize]]
=== Русский язык (кодировка KOI8-R)

В этом разделе приведены настройки, специфичные для локализации системы FreeBSD на русский язык. Для более полного описания каждой из настроек обращайтесь к разделу <<using-localization,Использование локализации>>.

Чтобы задать эту локаль для программной оболочки, добавьте в [.filename]#~/.login_conf# каждого пользователя следующие строки:

[.programlisting]
....
me:My Account:\
	:charset=KOI8-R:\
	:lang=ru_RU.KOI8-R:
....

Чтобы настроить консоль, добавьте в [.filename]#/etc/rc.conf# такие строки:

[.programlisting]
....
keymap="ru.utf-8"
scrnmap="utf-82cp866"
font8x16="cp866b-8x16"
font8x14="cp866-8x14"
font8x8="cp866-8x8"
mousechar_start=3
....

Для каждой записи `ttyv` в [.filename]#/etc/ttys# используйте `cons25r` в качестве типа терминала.

Чтобы настроить печать, требуется специальный выходной фильтр для перекодировки из KOI8-R в CP866, поскольку большинство принтеров для России поставляются с аппаратной кодовой страницей CP866. Для этой цели в состав FreeBSD включён фильтр по умолчанию [.filename]#/usr/libexec/lpr/ru/koi2alt#. Для его использования добавьте в [.filename]#/etc/printcap# такую запись:

[.programlisting]
....
lp|Russian local line printer:\
	:sh:of=/usr/libexec/lpr/ru/koi2alt:\
	:lp=/dev/lpt0:sd=/var/spool/output/lpd:lf=/var/log/lpd-errs:
....

Обратитесь к man:printcap[5] за более подробным разъяснением.

Чтобы настроить поддержку русских названий имён файлов при монтировании файловых систем MS-DOS(R), включите в добавляемую в [.filename]#/etc/fstab# запись `-L` с названием локали:

[.programlisting]
....
/dev/ad0s2      /dos/c  msdos   rw,-Lru_RU.KOI8-R 0 0
....

За дополнительной информацией обращайтесь к странице справочника man:mount_msdosfs[8].

Чтобы настроить русские шрифты в Xorg, установите пакет package:x11-fonts/xorg-fonts-cyrillic[]. Затем проверьте раздел `"Files"` в [.filename]#/etc/X11/xorg.conf#. _Перед_ всеми записями `FontPath` должна быть добавлена следующая строка:

[.programlisting]
....
FontPath   "/usr/local/lib/X11/fonts/cyrillic"
....

Дополнительные кириллические шрифты доступны в Коллекции Портов.

Для настройки ввода на русском языке добавьте следующие строки в [.filename]#/etc/xorg.conf#, раздел `"Keyboard"`:

[.programlisting]
....
Option "XkbLayout"   "us,ru"
Option "XkbOptions"  "grp:toggle"
....

Убедитесь, что в этом файле закомментирован `XkbDisable`.

Для `grp:toggle` используйте kbd:[Right Alt], для `grp:ctrl_shift_toggle` - kbd:[Ctrl+Shift]. Для `grp:caps_toggle` используйте kbd:[CapsLock]. Прежняя функция kbd:[CapsLock] всё ещё доступна в режиме LAT с использованием kbd:[Shift+CapsLock]. `grp:caps_toggle` по неустановленной причине не работает в Xorg.

Если на клавиатуре есть клавиши "Windows(R)" и некоторые неалфавитные клавиши работают неправильно, добавьте в [.filename]#/etc/xorg.conf# следующую строку:

[.programlisting]
....
Option "XkbVariant" ",winkeys"
....

[NOTE]
====
Ввод с клавиатуры XKB на русском может не работать с нелокализованными приложениями. Минимально локализованные приложения должны в начале программы вызывать функцию `XtSetLanguageProc (NULL, NULL, NULL);`.
====

За дальнейшими инструкциями по локализации приложений Xorg обращайтесь к странице http://koi8.pp.ru/xwin.html[http://koi8.pp.ru/xwin.html]. Для получения более общей информации по KOI8-R смотрите http://koi8.pp.ru/[http://koi8.pp.ru/].

=== Информация для других языков

В этом разделе приводится дополнительная информация по настройке других локалей.

Традиционный китайский для Тайваня::
У проекта FreeBSD-Taiwan есть http://netlab.cse.yzu.edu.tw/\~statue/freebsd/zh-tut/[FreeBSD Chinese HOWTO].

Локализация на греческий язык::
Исчерпывающая статья по поддержке греческого во FreeBSD есть в официальной греческой документации https://www.FreeBSD.org/doc/el/articles/greek-language-support/[здесь].

Локализация на японский и корейский языки::
Для японского обратитесь к http://www.jp.FreeBSD.org/[http://www.jp.FreeBSD.org/], а для корейского к http://www.kr.FreeBSD.org/[http://www.kr.FreeBSD.org/].

Неанглоязычная документация FreeBSD::
Контрибьюторы FreeBSD перевели отдельные части документации FreeBSD на другие языки. Эти переводы доступны по ссылкам на link:https://www.FreeBSD.org/[сайте FreeBSD] или из каталога [.filename]#/usr/shared/doc#.

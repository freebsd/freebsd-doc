---
title: Глава 13. Процесс загрузки FreeBSD
part: Часть III. Системное администрирование
prev: books/handbook/config
next: books/handbook/security
---

[[boot]]
= Процесс загрузки FreeBSD
:doctype: book
:toc: macro
:toclevels: 1
:icons: font
:sectnums:
:sectnumlevels: 6
:source-highlighter: rouge
:experimental:
:skip-front-matter:
:toc-title: Содержание
:table-caption: Таблица
:figure-caption: Рисунок
:example-caption: Пример
:xrefstyle: basic
:relfileprefix: ../
:outfilesuffix:
:sectnumoffset: 13

ifeval::["{backend}" == "html5"]
:imagesdir: ../../../images/books/handbook/boot/
endif::[]

ifeval::["{backend}" == "pdf"]
:imagesdir: ../../../../static/images/books/handbook/boot/
endif::[]

ifeval::["{backend}" == "epub3"]
:imagesdir: ../../../../static/images/books/handbook/boot/
endif::[]

include::shared/authors.adoc[]
include::shared/releases.adoc[]
include::shared/ru/mailing-lists.adoc[]
include::shared/ru/teams.adoc[]
include::shared/ru/urls.adoc[]

toc::[]

[[boot-synopsis]]
== Описание

Процесс включения компьютера и загрузки операционной системы называется "процессом первоначальной загрузки", или просто "загрузкой". Процесс загрузки FreeBSD предоставляет большие возможности по гибкой настройке того, что происходит при запуске системы, позволяя вам выбирать из различных операционных систем, установленных на одном и том же компьютере, или даже из различных версий той же самой операционной системы или установленного ядра.

Эта глава подробно описывает параметры, которые вы можете изменить для настройки процесса загрузки FreeBSD. Под этим подразумевается все, что происходит до начала работы ядра FreeBSD, обнаружения устройств и запуска man:init[8]. Если вы не совсем уверены, то это происходит, когда выводимый текст меняет цвет с ярко-белого на серый.

После чтения этой главы вы будете знать:

* Из каких частей состоит система начальной загрузки FreeBSD, и как эти части взаимодействуют.
* Параметры, которые вы можете передать компонентам начальной загрузки FreeBSD для управления этим процессом.
* Основы работы man:device.hints[5]

[NOTE]
.Только для x86
====
Эта глава описывает процесс загрузки FreeBSD только для систем на основе архитектуры Intel x86.
====

[[boot-introduction]]
== Проблема загрузки

Включение компьютера и запуск операционной системы приводят к интересной дилемме. По определению до запуска операционной системы компьютер не умеет ничего. В том числе и не знает, как запускать программы с диска. Так что компьютер не может запустить программу с диска без операционной системы, но программы операционной системы находятся на диске, но как запустить операционную систему?

Эта проблема имеет параллели с одной проблемой из книги Приключения барона Мюнхгаузена. Герой провалился в болото, и вытащил сам себя, ухватив за волосы и потянув. В эпоху начала компьютеризации термин _начальная загрузка_ применялся к механизму, используемому для загрузки операционной системы, и затем был сокращен до просто "загрузки".

На оборудовании архитектуры x86 за загрузку операционной системы отвечает BIOS (Basic Input/Output System). Для этого BIOS ищет на жестком диске MBR (Master Boot Record), которая должна располагаться в определенном месте на диске. BIOS может загрузить и запустить MBR, и предполагается, что MBR может взять на себя остальную работу, связанную с загрузкой операционной системы.

Выполняемую часть MBR обычно называют _менеджером загрузки (boot manager)_, в особенности если она взаимодействует с пользователем. В этом случае менеджер загрузки, как правило, занимает большее пространство на первом _треке_ диска или внутри файловой системы ОС. (Менеджер загрузки иногда называют _загрузчиком (boot loader)_, но во FreeBSD этот термин используется для описания более поздней фазы загрузки). Среди популярных менеджеров загрузки стоит отметить boot0 (он же Boot Easy, стандартный менеджер загрузки FreeBSD), Grub, GAG и LILO. Из перечисленных менеджеров загрузки в MBR помещается только boot0.

Если на вашем диске установлена только одна операционная система, то стандартной MBR будет достаточно. Такая MBR выполняет поиск на диске первого загрузочного (активного) слайса, после чего запускает с этого слайса код загрузки оставшейся части операционной системы. Утилита man:fdisk[8] по умолчанию устанавливает именно такую MBR, на основе файла [.filename]#/boot/mbr#.

Если на ваших дисках установлено несколько операционных систем, то вы можете установить другой менеджер загрузки, который может выдать список различных операционных систем и позволит вам выбрать одну из них для загрузки. Два варианта менеджеров загрузки будут описаны чуть ниже.

Оставшаяся часть системы начальной загрузки FreeBSD разделяется на три этапа. Первый этап запускается из MBR, и он знает достаточно для перевода компьютера в особое состояние и загрузки второго этапа. Второй этап может делать несколько больше до запуска третьего этапа. Третий этап заканчивает работу по загрузке операционной системы. Работа разделена на эти три этапа, потому что стандарты ПК ограничивают размеры программ, которые могут быть запущены на первом и втором этапах. Последовательное выполнение работ позволяет FreeBSD получить более гибкий загрузчик.

Затем стартует ядро, которое начинает опознавать устройства и выполняет их инициализацию. После завершения процесса своей загрузки, ядро передает управление пользовательскому процессу с именем man:init[8], который выполняет проверку дисков на возможность использования. Затем man:init[8] запускает пользовательский процесс настройки ресурсов, который монтирует файловые системы, выполняет настройку сетевых адаптеров для работы в сети и вообще осуществляет запуск всех процессов, обычно выполняемых в системе FreeBSD при загрузке.

[[boot-blocks]]
== Менеджер загрузки и этапы загрузки

[[boot-boot0]]
=== Менеджер загрузки

Код MBR или менеджера загрузки время от времени называют _нулевой стадией_ процесса загрузки. В этом разделе мы обсудим два из упомянутых ранее менеджеров загрузки: boot0 и LILO.

MBR для FreeBSD находится в [.filename]#/boot/boot0#. Это _копия_ MBR, так как настоящая MBR должна располагаться в специальном месте диска, вне области FreeBSD.

[.filename]#boot0# очень прост, так как программа в  может иметь размер, не превышающий 512 байт. Если вы установили MBR FreeBSD и несколько операционных систем на ваш жесткий диск, то во время загрузки вы увидите нечто похожее на следующее:

*Менеджер загрузки boot0:* MBR, устанавливаемый программой установки FreeBSD или утилитой man:boot0cfg[8], основан на [.filename]#/boot/boot0#. ([.filename]#boot0# очень прост, так как программа в  может иметь размер, не превышающий 446 байт, так как часть первого сектора диска занята таблицей слайсов и сигнатурой `0x55AA`). Если вы установили boot0 и несколько операционных систем на ваш жесткий диск, то во время загрузки вы увидите нечто похожее на следующее:

[[boot-boot0-example]]
.Образец экрана [.filename]#boot0#
[example]
====

[source,bash]
....
F1 DOS
F2 FreeBSD
F3 Linux
F4 ??
F5 Drive 1

Default: F2
....

====

Известно, что другие операционные системы, в частности, Windows(R) 95, записывают поверх существующей MBR свою собственную. Если так случилось в вашем случае, или же вы хотите заменить существующую MBR на MBR от FreeBSD, то воспользуйтесь следующей командой:

[source,bash]
....
# fdisk -B -b /boot/boot0 device
....

Здесь _device_ является устройством, с которого вы загружаетесь, таким, как [.filename]#ad0# в случае первого диска IDE, [.filename]#ad2# в случае первого диска IDE на втором контроллере IDE, [.filename]#da0# для первого диска SCSI и так далее. Если вы используете MBR нестандартного вида, воспользуйтесь man:boot0cfg[8].

*Менеджер загрузки LILO:* Для того, чтобы этот менеджер загрузки мог загружать FreeBSD, загрузите Linux и добавьте к существующему файлу конфигурации [.filename]#/etc/lilo.conf# такие строки:

[.programlisting]
....
other=/dev/hdXY
table=/dev/hdb
loader=/boot/chain.b
label=FreeBSD
....

Укажите диск с основным разделом FreeBSD в терминах Linux, заменив _X_ буквой диска, используемой в Linux, а _Y_ - номером основного раздела. Если вы используете диски SCSI, замените _/dev/hd_ на _/dev/sd_. Строка `loader=/boot/chain.b` может быть опущена, если обе операционные системы находятся на одном диске. Теперь запустите `/sbin/lilo -v` для того, чтобы ваши изменения были восприняты системой, что должно быть подтверждено сообщениями на экране.

[[boot-boot1]]
=== Этап первый, [.filename]#/boot/boot1#, и этап второй, [.filename]#/boot/boot2#

Концептуально первый и второй этапы загрузки являются частями одной и той же программы, в одной области диска. Из-за ограничений на объем дискового пространства они были разделены на две, но вы всегда должны устанавливать их вместе. Они копируются инсталлятором или утилитой bsdlabel (см. ниже) из общего файла [.filename]#/boot/boot#.

Они располагаются вне файловых систем, на первом треке загрузочного слайса, то есть там, где <<boot-boot0,boot0>> или любой другой менеджер загрузки ожидает найти программу, которую следует запустить для продолжение процесса загрузки. Количество используемых секторов легко может быть вычислено из размера файла [.filename]#/boot/boot#.

[.filename]#boot1# очень прост, так как он не может иметь размер, превышающий 512 байт, и знает лишь о _метке диска_ FreeBSD, хранящей информацию о слайсе, для того, чтобы найти и запустить [.filename]#boot2#.

[.filename]#boot2# устроен несколько более сложно, и умеет работать с файловой системой FreeBSD в объёме, достаточном для нахождения в ней файлов, и может предоставлять простой интерфейс для выбора и передачи управления ядру или загрузчику.

Так как <<boot-loader,загрузчик>> устроен гораздо более сложно, и дает удобный и простой способ настройки процесса загрузки, [.filename]#boot2# обычно запускает его, однако раньше его задачей был запуск непосредственно самого ядра.

[[boot-boot2-example]]
.Образец экрана [.filename]#boot2#
[example]
====

[source,bash]
....
>> FreeBSD/i386 BOOT
Default: 0:ad(0,a)/boot/loader
boot:
....

====

Если вам когда-либо понадобится заменить установленные [.filename]#boot1# и [.filename]#boot2#, то используйте утилиту man:bsdlabel[8]:

[source,bash]
....
# bsdlabel -B diskslice
....

Здесь _diskslice_ являются диском и слайсом, с которых вы загружаетесь, например, [.filename]#ad0s1# в случае первого слайса на первом диске IDE.

[WARNING]
.Режим Dangerously Dedicated
====
Если вы используете только имя диска, к примеру, [.filename]#ad0#, в команде man:bsdlabel[8] вы создадите диск в режиме эксклюзивного использования, без слайсов. Это, скорее всего, вовсе не то, что вы хотите сделать, так что дважды проверьте параметры команды man:bsdlabel[8], прежде, чем нажать kbd:[Return].
====

[[boot-loader]]
=== Третий этап, [.filename]#/boot/loader#

Передача управления загрузчику является последним, третьим этапом в процессе начальной загрузки, а сам загрузчик находится в файловой системе, обычно как [.filename]#/boot/loader#.

Загрузчик являет собой удобный в использовании инструмент для настройки при помощи простого набора команд, управляемого более мощным интерпретатором с более сложным набором команд.

[[boot-loader-flow]]
==== Процесс работы загрузчика

Во время инициализации загрузчик пытается произвести поиск консоли, дисков и определить, с какого диска он был запущен. Соответствующим образом он задаёт значения переменных и запускает интерпретатор, которому могут передаваться пользовательские команды как из скрипта, так и в интерактивном режиме.

Затем загрузчик читает файл [.filename]#/boot/loader.rc#, который по умолчанию использует файл [.filename]#/boot/defaults/loader.conf#, устанавливающий подходящие значения по умолчанию для переменных и читает файл [.filename]#/boot/loader.conf# для изменения в этих переменных. Затем с этими переменными работает [.filename]#loader.rc#, загружающий выбранные модули и ядро.

И наконец, по умолчанию загрузчик выдерживает 10-секундную паузу, ожидая нажатия клавиши, и загружает ядро, если этого не произошло. Если ожидание было прервано, пользователю выдается приглашение, которое воспринимает простой набор команд, с помощью которых пользователь может изменить значения переменных, выгрузить все модули, загрузить модули и окончательно продолжить процесс загрузки или перезагрузить машину.

[[boot-loader-commands]]
==== Встроенные команды загрузчика

Далее следуют наиболее часто используемые команды загрузчика. Полное описание всех имеющихся команд можно найти на странице справки о команде man:loader[8].

autoboot _секунды_::
Продолжает загрузку ядра, если не будет прерван в течение указанного в секундах промежутка времени. Он выводит счетчик, и по умолчанию выдерживается интервал в 10 секунд.

boot [-параметры] [имя ядра]::
Продолжить процесс загрузки указанного ядра, если оно было указано, и с указанными параметрами, если они были указаны. Загрузка и использование указанного ядра возможны лишь после выгрузки текущего ядра, а выгрузка текущего ядра производится командой _unload_.

boot-conf::
Повторно провести тот же самый процесс автоматической настройки модулей на основе переменных, что был произведен при загрузке. Это имеет смысл, если до этого вы выполнили команду `unload`, изменили некоторые переменные, например, наиболее часто меняемую `kernel`.

help [тема]::
Вывод сообщений подсказки из файла [.filename]#/boot/loader.help#. Если в качестве темы указано слово `index`, то выводится список имеющихся тем.

include _имя файла_ ...::
Выполнить файл с указанным именем. Файл считывается и его содержимое интерпретируется строчка за строчкой. Ошибка приводит к немедленному прекращению выполнения команды include.

load [-t тип] имя файла::
Загружает ядро, модуль ядра или файл указанного типа с указанным именем. Все аргументы после имени файла передаются в файл.

ls [-l] [маршрут]::
Выводит список файлов по указанному маршруту или в корневом каталоге, если маршрут не был указан. Если указан параметр `-l`, будут выводиться и размеры файлов.

lsdev [-v]::
Выводится список всех устройств, с которых могут быть загружены модули. Если указан параметр `-v`, выводится дополнительная информация.

lsmod [-v]::
Выводит список загруженных модулей. Если указан параметр `-v`, то выводится дополнительная информация.

more _имя файла_::
Вывод указанного файла с паузой при выводе каждой строки `LINES`.

reboot::
Выполнить немедленную перезагрузку машины.

set _переменная_::
Задает значения переменных окружения загрузчика.

unload::
Удаление из памяти всех загруженных модулей.

[[boot-loader-examples]]
==== Примеры использования загрузчика

Вот несколько примеров практического использования загрузчика:

* Чтобы просто загрузить ваше ядро обычным образом, но в однопользовательском режиме:
+
[source,bash]
....
 boot -s
....

* Для выгрузки обычных ядра и модулей, а потом просто загрузить ваше старое (или другое) ядро:
+
[source,bash]
....
unload
load kernel.old
....
+ 
Вы можете использовать [.filename]#kernel.GENERIC# для обозначения стандартного ядра, поставляемого на установочном диске, или [.filename]#kernel.old# для обращения к ранее установленному ядру (после того, как, например, вы обновили или отконфигурировали новое ядро).
+
[NOTE]
====
Для загрузки ваших обычных модулей с другим ядром используйте такие команды:

[source,bash]
....
unload
set kernel="kernel.old"
boot-conf
....

====

* Для загрузки скрипта конфигурации ядра (автоматизированный скрипт, который выполняет то, что вы обычно делаете в конфигураторе ядра во время загрузки):
+
[source,bash]
....
 load -t userconfig_script /boot/kernel.conf
....

[[boot-splash]]
==== Загрузочные экранные заставки

Заставка создает более привлекательный вид процесса загрузки по сравнению с традиционными сообщениями загрузки. Изображение заставки будет отображаться до тех пор, пока не придет очередь приглашения ввода логина на консоли или в менеджере дисплеев.

Есть два базовых окружения во FreeBSD. Первое - это окружение командной строки текстовой виртуальной консоли. По завершении загрузки системы вам предоставляется консольное приглашение ввода логина. Второе окружение - это графическое окружение рабочего стола X11. После установки crossref:x11[x-install,X11] и одной из графических оболочек, таких как GNOME, KDE или XFce, становится возможным запуск рабочего стола Х11 командой `startx`.

Некоторые пользователи предпочитают графический интерфейс входа традиционному текстовому приглашению ввода логина. Менеджеры экранов, наподобие XDM для Xorg, gdm для GNOME, kdm для KDE (а также другие, доступные из коллекции портов), изначально предоставляют графический интерфейс входа. После успешного входа в систему они запускают соответствующий оконный менеджер.

В текстовом окружении экранная заставка скрывает все подробности процесса загрузки и сообщения стартовых скриптов до момента выдачи приглашения ввода логина. Если используется экранная заставка перед входом в графическое окружение, то пользователи получают визуально более чистый старт системы, чем-то напоминающий опыт работы с Microsoft(R) Windows(R) или с иной не unix-подобной системой.

[[boot-splash-function]]
===== Экранная заставка в действии

В качестве заставки можно использовать лишь содержащие 256 цветов изображения формата BMP ([.filename]#.bmp#) или изображения формата PCX ([.filename]#.pcx#) от ZSoft. К тому же, для вывода на стандартный VGA адаптер, файл изображения заставки должен иметь разрешение не более 320 на 200 пикселей.

Чтобы можно было использовать изображения большего размера, вплоть до максимального 1024 на 768, активируйте поддержку VESA. Активация может быть осуществлена либо подключением модуля VESA во время загрузки системы, либо сборкой специализированного ядра с добавленной опцией `VESA` (смотрите crossref:kernelconfig[kernelconfig, Настройка ядра FreeBSD]). Поддержка режима VESA дает пользователям возможность отображать заставку, перекрывающую всю видимую область экрана.

Отображаемая во время загрузки заставка может быть убрана нажатием любой клавиши на клавиатуре.

С настройками по умолчанию заставка также становится хранителем экрана в консольном окружении. После некоторого бездействия экран сменится заставкой, яркость которой будет периодически изменяться от её максимального значения к минимальному и обратно. Подобное поведение заставки может быть переопределено добавлением строки `saver=` в [.filename]#/etc/rc.conf#. В качестве значения опции `saver=` можно выбрать одно из встроенных имен хранителей экранов, а с полным перечнем можно ознакомиться на странице справочника man:splash[4]. Хранитель экрана, используемый по умолчанию, называется "warp". Заметьте, что установка опции `saver=` в [.filename]#/etc/rc.conf# воздействует исключительно на текстовые виртуальные консоли. Она не влияет на менеджеры экранов X11.

Несколько сообщений загрузчика, включая меню загрузки и счетчик, отображаются во время загрузки, даже если экран-заставка активирован.

Файлы-примеры с изображениями для заставок могут быть скачаны из галереи по адресу http://artwork.freebsdgr.org/node/3/[http://artwork.freebsdgr.org]. Установив порт package:sysutils/bsd-splash-changer[], между загрузками вы получите автоматическую смену случайно выбираемых изображений заставок.

[[boot-splash-enable]]
===== Активация экранной заставки

Файл изображения для заставки ([.filename]#.bmp# или [.filename]#.pcx#) следует разместить в корневой файловой системе, например в каталоге [.filename]#/boot#.

Для работы заставки с разрешением, доступным при загрузке (256 цветов и не более 320х200 точек), отредактируйте [.filename]#/boot/loader.conf#, добавив в него следующие строки:

[.programlisting]
....
splash_bmp_load="YES"
bitmap_load="YES"
bitmap_name="/boot/splash.bmp"
....

Для получения больших разрешений видео режима (вплоть до максимального 1024x768), внесите в [.filename]#/boot/loader.conf# следующие записи:

[.programlisting]
....
vesa_load="YES"
splash_bmp_load="YES"
bitmap_load="YES"
bitmap_name="/boot/splash.bmp"
....

Вышеприведённый пример подразумевает, что файл [.filename]#/boot/splash.bmp# содержит изображение заставки. Если же требуется выводить файл формата PCX, то используйте следующие строки (в зависимости от необходимого разрешения может также потребоваться строка `vesa_load="YES"`):

[.programlisting]
....
splash_pcx_load="YES"
bitmap_load="YES"
bitmap_name="/boot/splash.pcx"
....

Возможное имя файла не ограничено одним лишь словом "splash". Оно может выбираться произвольно, например: [.filename]#splash_640x400.bmp# или [.filename]#blue_wave.pcx#. Важен лишь тип файла: он должен быть либо BMP, либо PCX.

Далее приведены еще две полезные опции [.filename]#loader.conf#:

`beastie_disable="YES"`::
Эта опция отключит меню загрузчика, но приглашение с обратным отсчетом останется. Даже при не отображаемом меню во время отсчета возможен выбор номера варианта загрузки.

`loader_logo="beastie"`::
Эта установка заменит слова "FreeBSD", которые отображаются справа от меню загрузчика, цветным логотипом демона, который занимал это место в предыдущих релизах FreeBSD.

За более детальной информацией обратитесь к следующим страницам справочника: man:splash[4], man:loader.conf[5] и man:vga[4].

[[boot-kernel]]
== Взаимодействие с ядром во время загрузки

Как только ядро окажется загруженным при помощи <<boot-loader,загрузчика>> (обычный способ) или <<boot-boot1,boot2>> (минуя загрузчик), оно проверяет флаги загрузки, если они есть, и действует соответствующим образом.

[[boot-kernel-bootflags]]
=== Флаги загрузки ядра

Вот наиболее часто используемые флаги загрузки:

`-a`::
во время инициализации ядра запрашивать устройство для его монтирования в качестве корневой файловой системы.

`-C`::
загрузка с компакт-диска.

`-c`::
запустить UserConfig для конфигурации ядра во время загрузки

`-s`::
после загрузки перейти в однопользовательский режим

`-v`::
во время запуска ядра выводить более подробную информацию

[NOTE]
====
Есть и другие флаги загрузки, обратитесь к странице справочника по man:boot[8] для выяснения подробной информации по ним.
====

[[device-hints]]
== Хинты устройств

Во время начального запуска системы загрузчик man:loader[8] производит чтение файла man:device.hints[5]. В этом файле хранится необходимая для загрузки ядра информация, задаваемая в виде переменных, которую иногда называют хинтами для устройств ("device hints"). Эти "хинты устройств" используются драйверами устройств для их конфигурации.

Хинты для устройств могут быть также заданы в приглашении <<boot-loader,начального загрузчика Стадии 3>>. Переменные могут быть добавлены при помощи команды `set`, удалены посредством `unset` и просмотрены командой `show`. В этот момент могут быть также переопределены переменные, заданные в файле [.filename]#/boot/device.hints#. Хинты для устройств, введённые в начальном загрузчике, не сохраняются, и при следующей перезагрузке будут утеряны.

После загрузки системы для выдачи значений всех переменных можно воспользоваться командой man:kenv[1].

Синтаксически в файле [.filename]#/boot/device.hints# в каждой строке определяется по одной переменной, в качестве метки начала комментария используется стандартный символ "#". Строки строятся следующим образом:

[source,bash]
....
 hint.driver.unit.keyword="value"
....

Синтаксис для начального загрузчика Стадии 3 таков:

[source,bash]
....
 set hint.driver.unit.keyword=value
....

`driver` определяет имя драйвера устройства, `unit` соответствует порядковому номеру модуля устройства, а `keyword` является ключевым словом хинта. В качестве ключевых слов могут применяться следующие опции:

* `at`: задаёт шину, к которой подключено устройство.
* `port`: задаёт начальный адрес используемого диапазона ввода/вывода (I/O).
* `irq`: задаёт используемый номер запроса на прерывание.
* `drq`: задаёт номер канала DMA.
* `maddr`: задаёт физический адрес памяти, занимаемый устройством.
* `flags`: устанавливает различные битовые флаги для устройства.
* `disabled`: если установлено в значение "1", то устройство не используется.

Драйверы устройств могут поддерживать (и даже требовать) другие хинты, здесь не перечисленные, поэтому рекомендуется просматривать справочные страницы по этим драйверам. Для получения дополнительной информации обратитесь к страницам справки по man:device.hints[5], man:kenv[1], man:loader.conf[5] и man:loader[8].

[[boot-init]]
== Init: инициализация управления процессами

После того, как ядро завершит загрузку, оно передает управление пользовательскому процессу man:init[8], который расположен в файле [.filename]#/sbin/init# или в файле, маршрут к которому указан в переменной `init_path загрузчика`.

[[boot-autoreboot]]
=== Процесс автоматической перезагрузки

Процесс автоматической перезагрузки проверяет целостность имеющихся файловых систем. Если это не так, и утилита man:fsck[8] не может исправить положение, то man:init[8] переводит систему в <<boot-singleuser,однопользовательский режим>> для того, чтобы системный администратор сам разобрался с возникающими проблемами.

[[boot-singleuser]]
=== Однопользовательский режим

В этот режим можно перейти во время <<boot-autoreboot,процесса автоматической перезагрузки>>, при ручной загрузке с параметром `-s` или заданием переменной `boot_single` для программы `loader`.

Этот режим может быть также вызван запуском программы man:shutdown[8] без параметров перезагрузки (`-r`) или останова (`-h`) из <<boot-multiuser,многопользовательского режима>>.

Если режим доступа к системной консоли `console` установлен в файле [.filename]#/etc/ttys# в `insecure`, то система выведет запрос на ввод пароля пользователя `root` перед переходом в однопользовательский режим.

[[boot-insecure-console]]
.Незащищённая консоль в [.filename]#/etc/ttys#
[example]
====
[.programlisting]
....
# name	getty				type	status		comments
#
# Если консоль помечена как "insecure", то init будет запрашивать пароль
# пользователя root при переходе в однопользовательский режим.
console none                            unknown off insecure
....

====

[NOTE]
====
Обозначение консоли как `insecure` означает, что вы считаете физический доступ к консоли незащищённым, и хотите, чтобы только тот, кто знает пароль пользователя `root`, мог воспользоваться однопользовательским режимом, но это не значит, что вы хотите работать с консолью небезопасным способом. Таким образом, если вы хотите добиться защищённости, указывайте `insecure`, а не `secure`.
====

[[boot-multiuser]]
=== Многопользовательский режим

Если man:init[8] определит, что ваши файловые системы находятся в полном порядке, или после того, как пользователь выйдет из <<boot-singleuser,однопользовательского режима>>, система перейдет в многопользовательский режим, работа в котором начинается с настройки ресурсов системы.

[[boot-rc]]
==== Настройка ресурсов (rc)

Система настройки ресурсов считывает настройки, применяемые по умолчанию, из файла [.filename]#/etc/defaults/rc.conf#, а настройки, специфичные для конкретной системы, из [.filename]#/etc/rc.conf#, после чего осуществляется монтирование файловых систем, перечисленных в файле [.filename]#/etc/fstab#, запуск сетевых служб, различных системных даемонов и, наконец, выполнение скриптов запуска дополнительно установленных пакетов.

Страница справочника по man:rc[8] является хорошим источником информации о системе настройки ресурсов, так же, как и самостоятельное изучение скриптов.

[[boot-shutdown]]
== Процесс остановки системы

Во время контролируемого процесса остановки системы через утилиту man:shutdown[8] программа man:init[8] будет пытаться запустить скрипт [.filename]#/etc/rc.shutdown#, после чего будет посылать всем процессам сигнал `TERM`, а затем и `KILL` тем процессам, которые ещё не завершили свою работу.

Для выключения машины с FreeBSD на аппаратных платформах и системах, которые поддерживают управление электропитанием, просто воспользуйтесь командой `shutdown -p now` для немедленного отключения электропитания. Чтобы просто перезагрузить систему FreeBSD, воспользуйтесь командой `shutdown -r now`. Для запуска команды man:shutdown[8] вам необходимо быть пользователем `root` или членом группы `operator`. Кроме того, можно также воспользоваться командами man:halt[8] и man:reboot[8], пожалуйста, обратитесь к соответствующим страницам справки и справочной странице по команде man:shutdown[8] для получения дополнительной информации.

[NOTE]
====
Для управления электропитанием требуется наличие поддержки man:acpi[4] в ядре или в виде загруженного модуля.
====

---
title: Capítulo 28. Correio Eletrônico
part: Parte IV. Comunicação de rede
prev: books/handbook/ppp-and-slip
next: books/handbook/network-servers
---

[[mail]]
= Correio Eletrônico
:doctype: book
:toc: macro
:toclevels: 1
:icons: font
:sectnums:
:sectnumlevels: 6
:source-highlighter: rouge
:experimental:
:skip-front-matter:
:toc-title: Índice
:table-caption: Tabela
:figure-caption: Figura
:example-caption: Exemplo
:xrefstyle: basic
:relfileprefix: ../
:outfilesuffix:
:sectnumoffset: 28

ifeval::["{backend}" == "html5"]
:imagesdir: ../../../../images/books/handbook/mail/
endif::[]

ifeval::["{backend}" == "pdf"]
:imagesdir: ../../../../static/images/books/handbook/mail/
endif::[]

ifeval::["{backend}" == "epub3"]
:imagesdir: ../../../../static/images/books/handbook/mail/
endif::[]

include::shared/authors.adoc[]
include::shared/releases.adoc[]
include::shared/pt-br/mailing-lists.adoc[]
include::shared/pt-br/teams.adoc[]
include::shared/pt-br/urls.adoc[]

toc::[]

[[mail-synopsis]]
== Sinopse

O "Electronic Mail", mais conhecido como email, é uma das formas de comunicação mais utilizadas atualmente. Este capítulo fornece uma introdução básica à execução de um servidor de email no FreeBSD, bem como uma introdução ao envio e recebimento de email usando o FreeBSD. Para uma cobertura mais completa deste assunto, consulte os livros listados em crossref:bibliography[bibliography, Bibliografia].

Depois de ler este capítulo, você saberá:

* Quais softwares estão envolvidos no envio e recebimento de mensagens de email.
* Onde os arquivos básicos de configuração do Sendmail estão localizados no FreeBSD.
* A diferença entre caixas de correio remotas e locais.
* Como bloquear spammers de utilizar ilegalmente um servidor de email como relay.
* Como instalar e configurar um Mail Transfer Agent, substituindo o Sendmail.
* Como solucionar problemas comuns de servidor de email.
* Como configurar o sistema para apenas enviar email.
* Como usar email com uma conexão discada.
* Como configurar a autenticação SMTP para segurança adicional.
* Como instalar e usar um Mail User Agent, como o mutt, para enviar e receber email.
* Como baixar emails de um servidor remoto utilizando POP ou IMAP.
* Como aplicar automaticamente filtros e regras ao email recebido.

Antes de ler este capítulo, você deve:

* Configurar corretamente uma conexão de rede (crossref:advanced-networking[advanced-networking, Rede Avançada]).
* Configure corretamente as informações de DNS para um host de email (crossref:network-servers[network-servers, Servidores de Rede]).
* Saber como instalar software adicional de terceiros (crossref:ports[ports, Instalando Aplicativos. Pacotes e Ports]).

[[mail-using]]
== Componentes de Email

Há cinco partes principais envolvidas em uma troca de email: o Mail User Agent (MUA), o Mail Transfer Agent (MTA), um host de email, uma caixa de correio remota ou local e DNS. Esta seção fornece uma visão geral desses componentes.

Mail User Agent (MUA)::
O Mail User Agent (MUA) é um aplicativo que é usado para redigir, enviar e receber emails. Este aplicativo pode ser um programa de linha de comando, como o utilitário `mail` interno ou um aplicativo de terceiros da Coleção de Ports, como mutt, alpine ou elm. Dezenas de programas gráficos também estão disponíveis na Coleção de Ports, incluindo o Claws Mail, Evolution e Thunderbird. Algumas organizações fornecem um programa web de email que pode ser acessado por meio de um navegador. Mais informações sobre como instalar e usar um MUA no FreeBSD podem ser encontradas em <<mail-agents>>.

Mail Transfer Agent (MTA)::
O Mail Transfer Agent (MTA) é responsável por receber emails de entrada e entregar emails de saída. O FreeBSD vem com o Sendmail como o MTA padrão, mas também suporta vários outros daemons de servidor de email, incluindo Exim, Postfix e qmail. A configuração do Sendmail é descrita em <<sendmail>>. Se outro MTA estiver instalado usando a Coleção de Ports, consulte sua mensagem de pós-instalação para detalhes de configuração específicos do FreeBSD e o site do aplicativo para obter instruções de configuração mais completas.

Servidor de Email e Caixas de Correio::
O servidor de email é um servidor responsável por entregar e receber emails para um host ou uma rede. O servidor de email coleta todas as mensagens enviadas para o domínio e as armazena no [.filename]#mbox# padrão ou no formato alternativo Maildir, dependendo da configuração. Uma vez que o email foi armazenado, ele pode ser lido localmente usando um MUA ou acessado e coletado remotamente usando protocolos como POP ou IMAP. Se o email for lido localmente, não é necessário instalar um servidor POP ou IMAP.
+
Para acessar as caixas de email remotamente, é necessário um servidor POP ou IMAP, pois esses protocolos permitem que os usuários se conectem a suas caixas de correio de locais remotos. O IMAP oferece várias vantagens sobre o POP. Isso inclui a capacidade de armazenar uma cópia de mensagens em um servidor remoto após o download e atualizações simultâneas. O IMAP pode ser útil em links de baixa velocidade, pois permite aos usuários buscar a estrutura das mensagens sem baixá-las. Ele também pode executar tarefas como pesquisas no servidor para minimizar a transferência de dados entre clientes e servidores.
+
Vários servidores POP e IMAP estão disponíveis na Coleção de Ports. Estes incluem o package:mail/qpopper[], package:mail/imap-uw[], package:mail/courier-imap[] e package:mail/dovecot2[] .
+
[WARNING]
====

Deve-se notar que o POP e o IMAP transmitem informações, incluindo nome de usuário e senha, em texto não criptografado. Para garantir a segurança na transmissão de informações entre esses protocolos, considere a utilização de túneis seguros com man:ssh[1] (crossref:security[security-ssh-tunneling,Tunelamento SSH]) ou utilize SSL (crossref:security[openssl,OpenSSL]).
====

Sistema de Nomes de Domínio (DNS)::
O Sistema de Nomes de Domínio (DNS) e seu daemon `named` desempenham um grande papel na entrega de email. Para enviar emails de um site para outro, o MTA procurará o site remoto por DNS para determinar qual host receberá os emails para o destino. Esse processo também ocorre quando o email é enviado de um host remoto para o MTA.
+
Além de mapear nomes de hosts para endereços de IP, o DNS é responsável por armazenar informações específicas da entrega de emails, conhecidas como Mail eXchanger MX. O registro MX especifica quais hosts receberão mensagens de um domínio em particular.
+
Para visualizar os registros MX de um domínio, especifique o tipo de registro. Consulte man:host[1], para mais detalhes sobre este comando:
+
[source,bash]
....
% host -t mx FreeBSD.org
FreeBSD.org mail is handled by 10 mx1.FreeBSD.org
....
+
Consulte crossref:network-servers[network-dns,Sistema de Nomes de Domínio (DNS)] para mais informações sobre DNS e sua configuração.

[[sendmail]]
== Arquivos de Configuração do Sendmail

Sendmail é o MTA padrão instalado com o FreeBSD. Ele aceita emails de MUAs e os entrega ao host de email apropriado, conforme definido por sua configuração. O Sendmail também pode aceitar conexões de rede e enviar mensagens para caixas de correio locais ou para outro programa.

Os arquivos de configuração do Sendmail estão localizados em [.filename]#/etc/mail#. Esta seção descreve esses arquivos em mais detalhes.

[.filename]#/etc/mail/access#::
Este arquivo de acesso define quais hosts ou endereços de IP têm acesso ao servidor de email local e que tipo de acesso eles possuem. Os hosts listados como `OK`, que é a opção padrão, têm permissão para enviar emails para esse host, desde que o destino final do email seja a máquina local. Os hosts listados como `REJECT` são rejeitados para todas as conexões de email. Os hosts listados como `RELAY` têm permissão para enviar emails para qualquer destino usando este servidor de email. Os hosts listados como `ERROR` terão seus emails retornados com o erro de email especificado. Se um host estiver listado como `SKIP`, o Sendmail interromperá a pesquisa atual por esta entrada sem aceitar ou rejeitar o email. Os hosts listados como `QUARANTINE` terão suas mensagens retidas e receberão o texto especificado como o motivo da retenção.
+
Exemplos de uso destas opções para endereços IPv4 e IPv6 podem ser encontrados na configuração de exemplo do FreeBSD, [.filename]#/etc/mail/access.sample#:
+
[.programlisting]
....
# $FreeBSD: head/pt_BR.ISO8859-1/books/handbook/book.xml 53984 2020-03-15 16:03:31Z dbaio $
#
# Mail relay access control list.  Default is to reject mail unless the
# destination is local, or listed in /etc/mail/local-host-names
#
## Examples (commented out for safety)
#From:cyberspammer.com          ERROR:"550 We don't accept mail from spammers"
#From:okay.cyberspammer.com     OK
#Connect:sendmail.org           RELAY
#To:sendmail.org                RELAY
#Connect:128.32                 RELAY
#Connect:128.32.2               SKIP
#Connect:IPv6:1:2:3:4:5:6:7     RELAY
#Connect:suspicious.example.com QUARANTINE:Mail from suspicious host
#Connect:[127.0.0.3]            OK
#Connect:[IPv6:1:2:3:4:5:6:7:8] OK
....
+
Para configurar o arquivo de acesso, use o formato mostrado no exemplo para adicionar entradas em [.filename]#/etc/mail/access#, mas não coloque um símbolo de comentário (`#`) na frente das entradas. Crie uma entrada para cada host ou rede cujo acesso deve ser configurado. Os remetentes de email que correspondem ao lado esquerdo da tabela são afetados pela ação no lado direito da tabela.
+
Sempre que este arquivo for atualizado, atualize seu banco de dados e reinicie o Sendmail:
+
[source,bash]
....
# makemap hash /etc/mail/access < /etc/mail/access
# service sendmail restart
....

[.filename]#/etc/mail/aliases#::
Este arquivo aliases contém uma lista de caixas de correio virtuais que são expandidas para usuários, arquivos, programas ou outros aliases. Aqui estão algumas entradas para ilustrar o formato do arquivo:
+
[.programlisting]
....
root: localuser
ftp-bugs: joe,eric,paul
bit.bucket:  /dev/null
procmail: "|/usr/local/bin/procmail"
....
+
O nome da caixa de correio no lado esquerdo dos dois pontos é expandido para o(s) alvo(s) à direita. A primeira entrada expande a caixa de correio `root` para a caixa de correio `localuser`, que é então pesquisada no [.filename]#/etc/mail/aliases#. Se nenhuma correspondência for encontrada, a mensagem será entregue para `localuser`. A segunda entrada mostra uma lista de email. Um email para `ftp-bugs` é expandido para as três caixas de correio locais `joe`, `eric` e `paul`. Uma caixa de correio remota pode ser especificada como _user@example.com_. A terceira entrada mostra como escrever mensagens em um arquivo, neste caso, [.filename]#/dev/null#. A última entrada demonstra como enviar email para um programa, [.filename]#/usr/local/bin/procmail#, através de um pipe UNIX(TM). Consulte man:aliases[5] para obter mais informações sobre o formato desse arquivo.
+
Sempre que este arquivo for atualizado, execute `newaliases` para atualizar e inicializar o banco de dados de aliases.

[.filename]#/etc/mail/sendmail.cf#::
Este é o arquivo de configuração principal do Sendmail. Ele controla o comportamento geral do Sendmail, incluindo tudo desde a tradução de endereços de email até a impressão de mensagens de rejeição para servidores de email remotos. Assim, este arquivo de configuração é bastante complexo. Felizmente, esse arquivo raramente precisa ser alterado para servidores de email padrão.
+
O arquivo de configuração master do Sendmail pode ser criado a partir de macros man:m4[1] que definem os recursos e o comportamento do Sendmail. Consulte [.filename]#/usr/src/contrib/sendmail/cf/README# para mais detalhes.
+
Sempre que alterações nesse arquivo são feitas, o Sendmail precisa ser reiniciado para que as alterações entrem em vigor.

[.filename]#/etc/mail/virtusertable#::
Esse arquivo mapeia endereços de email de domínios virtuais para caixas de correio usuários reais. Essas caixas de correio podem ser locais, remotas, aliases definidas em [.filename]#/etc/mail/aliases# ou arquivos. Isso permite que vários domínios virtuais sejam hospedados em uma máquina.
+
O FreeBSD fornece um exemplo de arquivo de configuração em [.filename]#/etc/mail/virtusertable.sample# para demonstrar ainda mais seu formato. O exemplo a seguir demonstra como criar entradas personalizadas usando esse formato:
+
[.programlisting]
....
root@example.com                root
postmaster@example.com          postmaster@noc.example.net
@example.com                    joe
....
+
Este arquivo é processado pela primeira entrada que for correspondida. Quando um endereço de email corresponde ao endereço à esquerda, ele é mapeado para a caixa de correio local listada à direita. O formato da primeira entrada neste exemplo mapeia um endereço de email específico para uma caixa de correio local, enquanto o formato da segunda entrada mapeia um endereço de email específico para uma caixa de correio remota. Por fim, qualquer endereço de email de `example.com` que não correspondeu a nenhuma das entradas anteriores corresponderá ao último mapeamento e será enviado para a caixa de correio local `joe`. Ao criar entradas personalizadas, use este formato e adicione-as ao [.filename]#/etc/mail/virtusertable#. Sempre que este arquivo for editado, atualize seu banco de dados e reinicie o Sendmail:
+
[source,bash]
....
# makemap hash /etc/mail/virtusertable < /etc/mail/virtusertable
# service sendmail restart
....

[.filename]#/etc/mail/relay-domains#::
Em uma instalação padrão do FreeBSD, o Sendmail é configurado para enviar apenas mensagens provenientes do host em que está sendo executado. Por exemplo, se um servidor POP estiver disponível, os usuários poderão verificar os emails de locais remotos, mas não poderão enviar emails de domínios externos. Normalmente, após alguns momentos da tentativa, um email será enviado de `MAILER-DAEMON` com uma mensagem `5.7 Relaying Denied`.
+
A solução mais simples é adicionar o FQDN do ISP ao [.filename]#/etc/mail/relay-domains#. Se vários endereços forem necessários, adicione-os um por linha:
+
[.programlisting]
....
your.isp.example.com
other.isp.example.net
users-isp.example.org
www.example.org
....
+
Depois de criar ou editar este arquivo, reinicie o Sendmail com `service sendmail restart`.
+
Agora, qualquer mensagem enviada pelo sistema por qualquer domínio dessa lista, desde que o usuário tenha uma conta no sistema, será aceita. Isso permite que os usuários enviem emails de domínios remotos do sistema sem precisar liberar acesso externo ao sistema, evitando SPAM da Internet.

[[mail-changingmta]]
== Alterando o Mail Transfer Agent

O FreeBSD vem com o Sendmail já instalado como MTA, que é responsável pelos emails enviados e recebidos. No entanto, o administrador do sistema pode alterar o MTA do sistema. Uma ampla lista de alternativas de MTAs está disponível na categoria `mail` da Coleção de Ports do FreeBSD.

Uma vez que um novo MTA esteja instalado, configure e teste o novo software antes de substituir o Sendmail. Consulte a documentação do novo MTA para obter informações sobre como configurar o software.

Uma vez que o novo MTA estiver funcionando, use as instruções nesta seção para desativar o Sendmail e configurar o FreeBSD para usar o MTA substituto.

[[mail-disable-sendmail]]
=== Desativar o Sendmail

[WARNING]
====

Se o serviço de email de saída do Sendmail estiver desabilitado, é importante que ele seja substituído por um sistema de entrega de email alternativo. Caso contrário, as funções do sistema, como man:periodic[8], não poderão entregar seus resultados por email. Muitas partes do sistema esperam um MTA funcional. Se os aplicativos continuarem a usar os binários do Sendmail para tentar enviar emails depois que eles forem desativados, o email poderá entrar em uma fila inativa do Sendmail e nunca será entregue.
====

Para desabilitar completamente o Sendmail, adicione ou edite as seguintes linhas no [.filename]#/etc/rc.conf#:

[.programlisting]
....
sendmail_enable="NO"
sendmail_submit_enable="NO"
sendmail_outbound_enable="NO"
sendmail_msp_queue_enable="NO"
....

Para desabilitar somente o serviço de email de entrada do Sendmail, use apenas esta entrada no [.filename]#/etc/rc.conf#:

[.programlisting]
....
sendmail_enable="NO"
....

Mais informações sobre as opções de inicialização do Sendmail estão disponíveis em man:rc.sendmail[8].

=== Substitua o  MTA Padrão

Quando um novo MTA é instalado usando a Coleção de Ports, seu script de inicialização também é instalado e as instruções de inicialização são mencionadas em sua mensagem de pacote. Antes de iniciar o novo MTA, pare os processos do Sendmail em execução. Este exemplo interrompe todos esses serviços e em seguida, inicia o serviço Postfix:

[source,bash]
....
# service sendmail stop
# service postfix start
....

Para configurar a substituição MTA na inicialização do sistema, adicione sua linha de configuração ao [.filename]#/etc/rc.conf#. Esta entrada habilita o MTA Postfix:

[.programlisting]
....
postfix_enable="YES"
....

Algumas configurações adicionais são necessárias, pois o Sendmail é tão onipresente que alguns softwares assumem que ele já está instalado e configurado. Verifique o [.filename]#/etc/periodic.conf# e certifique-se de que esses valores estejam configurados como `NO`. Se este arquivo não existir, crie-o com estas entradas:

[.programlisting]
....
daily_clean_hoststat_enable="NO"
daily_status_mail_rejects_enable="NO"
daily_status_include_submit_mailq="NO"
daily_submit_queuerun="NO"
....

Alguns MTAs alternativos fornecem suas próprias implementações compatíveis de linha de comando do Sendmail para facilitar o uso delas como substitutos para o Sendmail. No entanto, alguns MUAs podem tentar executar binários padrão do Sendmail em vez dos binários do novo MTA. O FreeBSD usa o [.filename]#/etc/mail/mailer.conf# para mapear os binários esperados do Sendmail para o local dos novos binários. Mais informações sobre esse mapeamento podem ser encontradas em man:mailwrapper[8].

O [.filename]#/etc/mail/mailer.conf# padrão se parece com isto:

[.programlisting]
....
# $FreeBSD: head/pt_BR.ISO8859-1/books/handbook/book.xml 53984 2020-03-15 16:03:31Z dbaio $
#
# Execute the "real" sendmail program, named /usr/libexec/sendmail/sendmail
#
sendmail        /usr/libexec/sendmail/sendmail
send-mail       /usr/libexec/sendmail/sendmail
mailq           /usr/libexec/sendmail/sendmail
newaliases      /usr/libexec/sendmail/sendmail
hoststat        /usr/libexec/sendmail/sendmail
purgestat       /usr/libexec/sendmail/sendmail
....

Quando qualquer um dos comandos listados à esquerda é executado, o sistema na verdade executa o comando associado mostrado à direita. Esse sistema facilita a alteração de quais binários são executados quando esses binários padrões são chamados.

Alguns MTAs, quando instalados usando a Coleção de Ports, solicitarão a atualização deste arquivo para os novos binários. Por exemplo, o Postfix atualizará o arquivo da seguinte forma:

[.programlisting]
....
#
# Execute the Postfix sendmail program, named /usr/local/sbin/sendmail
#
sendmail        /usr/local/sbin/sendmail
send-mail       /usr/local/sbin/sendmail
mailq           /usr/local/sbin/sendmail
newaliases      /usr/local/sbin/sendmail
....

Se a instalação do MTA não atualizar automaticamente o [.filename]#/etc/mail/mailer.conf#, edite esse arquivo em um editor de texto para que ele aponte para os novos binários. Este exemplo aponta para os binários instalados pelo package:mail/ssmtp[]:

[.programlisting]
....
sendmail        /usr/local/sbin/ssmtp
send-mail       /usr/local/sbin/ssmtp
mailq           /usr/local/sbin/ssmtp
newaliases      /usr/local/sbin/ssmtp
hoststat        /usr/bin/true
purgestat       /usr/bin/true
....

Depois que tudo estiver configurado, é recomendável reinicializar o sistema. A reinicialização oferece a oportunidade de garantir que o sistema esteja configurado corretamente para iniciar o novo MTA automaticamente no boot.

[[mail-trouble]]
== Solução de problemas

=== Por que preciso usar o FQDN para hosts no meu site?

O host pode, na verdade, estar em um domínio diferente. Por exemplo, para um host em `foo.bar.edu` se conectar a um host chamado `mumble` no domínio `bar.edu`, faça a referência pelo Nome de Domínio Totalmente Qualificado (Fully-Qualified Domain Name) FQDN, `mumble.bar.edu`, em vez de apenas `mumble`.

Isso ocorre porque a versão do BIND que vem com o FreeBSD não fornece mais abreviações padrão para não-FQDNs que não sejam o domínio local. Um host não qualificado como `mumble` deve ser encontrado como `mumble.foo.bar.edu`, ou ele será procurado no domínio raiz.

Nas versões mais antigas do BIND, a pesquisa continuava em `mumble.bar.edu` e `mumble.edu`. A RFC 1535 detalha por que isso é considerado uma má prática ou até mesmo uma falha de segurança.

Como uma boa solução, coloque a linha:

[.programlisting]
....
search foo.bar.edu bar.edu
....

em vez do anterior:

[.programlisting]
....
domain foo.bar.edu
....

no [.filename]#/etc/resolv.conf#. No entanto, certifique-se de que a ordem de pesquisa não ultrapasse o limite "entre administração local e pública", como a RFC 1535 a chama.

=== Como posso executar um servidor de email em um host PPP dial-up?

Conecte-se a um gateway de email FreeBSD na LAN. A conexão PPP não é dedicada.

Uma maneira de fazer isso é obter um servidor de Internet em tempo integral para fornecer serviços MX secundários para o domínio. Neste exemplo, o domínio é `example.com` e o ISP configurou `example.net` para fornecer o serviço de MX secundário para o domínio:

[.programlisting]
....
example.com.          MX        10      example.com.
                      MX        20      example.net.
....

Apenas um host deve ser especificado como o destinatário final. Para Sendmail, adicione `Cw example.com` em [.filename]#/etc/mail/sendmail.cf# em `example.com`.

Quando o MTA de envio tentar entregar o email, ele tentará conectar ao sistema, `example.com`, através do link PPP. Isso expirará se o destino estiver offline. O MTA irá entregá-lo automaticamente ao site MX secundário no Provedor de Serviços de Internet (ISP), `example.net`. O site secundário de MX tentará conectar-se periodicamente ao host primário MX, `example.com`.

Use algo assim como um script de login:

[.programlisting]
....
#!/bin/sh
# Put me in /usr/local/bin/pppmyisp
( sleep 60 ; /usr/sbin/sendmail -q ) &
/usr/sbin/ppp -direct pppmyisp
....

Ao criar um script de login separado para usuários, use `sendmail -qRexample.com` no script acima. Isso forçará todos os emails na fila para que `example.com` sejam processados imediatamente.

Um refinamento adicional da situação pode ser visto neste exemplo na lista de discussão http://lists.FreeBSD.org/mailman/listinfo/freebsd-isp[Lista de discussão de provedor de serviços de Internet do FreeBSD]:

[.programlisting]
....
> we provide the secondary MX for a customer. The customer connects to
> our services several times a day automatically to get the mails to
> his primary MX (We do not call his site when a mail for his domains
> arrived). Our sendmail sends the mailqueue every 30 minutes. At the
> moment he has to stay 30 minutes online to be sure that all mail is
> gone to the primary MX.
>
> Is there a command that would initiate sendmail to send all the mails
> now? The user has not root-privileges on our machine of course.

In the privacy flags section of sendmail.cf, there is a
definition Opgoaway,restrictqrun

Remove restrictqrun to allow non-root users to start the queue processing.
You might also like to rearrange the MXs. We are the 1st MX for our
customers like this, and we have defined:

# If we are the best MX for a host, try directly instead of generating
# local config error.
OwTrue

That way a remote site will deliver straight to you, without trying
the customer connection.  You then send to your customer.  Only works for
hosts, so you need to get your customer to name their mail
machine customer.com as well as
hostname.customer.com in the DNS.  Just put an A record in
the DNS for customer.com.
....

[[mail-advanced]]
== Tópicos Avançados

Esta seção aborda tópicos mais envolvidos, como configuração de email e configuração de email para um domínio inteiro.

[[mail-config]]
=== Configuração básica

Fora da caixa, pode-se enviar email para hosts externos desde que [.filename]#/etc/resolv.conf# esteja configurado ou a rede tenha acesso a um servidor DNS. Para ter um email entregue ao MTA em um host FreeBSD, siga um destes procedimentos:

* Execute um servidor DNS para o domínio.
* Tenha o email entregue diretamente para o FQDN para a máquina.

Para que o email seja entregue diretamente a um host, ele deve ter um endereço IP estático permanente, não um endereço IP dinâmico. Se o sistema estiver protegido por um firewall, ele deverá ser configurado para permitir o tráfego SMTP. Para receber mensagens diretamente em um host, um desses dois deve ser configurado:

* Certifique-se de que o registro MX de menor numeração no DNS aponte para o endereço IP estático do host.
* Certifique-se de que não exista nenhuma entrada MX no DNS para o host.

Qualquer um dos itens acima permitirá que o correio seja recebido diretamente no host.

Tente isto:

[source,bash]
....
# hostname
example.FreeBSD.org
# host example.FreeBSD.org
example.FreeBSD.org has address 204.216.27.XX
....

Neste exemplo, as mensagens enviadas diretamente para mailto:yourlogin@exemplo.FreeBSD.org[yourlogin@exemplo.FreeBSD.org] devem funcionar sem problemas, supondo que o Sendmail esteja sendo executado corretamente em `example.FreeBSD.org`.

Para este exemplo:

[source,bash]
....
# host example.FreeBSD.org
example.FreeBSD.org has address 204.216.27.XX
example.FreeBSD.org mail is handled (pri=10) by nevdull.FreeBSD.org
....

Todas as mensagens enviadas para `exemple.FreeBSD.org` serão coletadas no `hub` sob o mesmo nome de usuário, em vez de serem enviadas diretamente para o seu host.

As informações acima são tratadas pelo servidor DNS. O registro DNS que possui as informações de roteamento de email é a entrada MX. Se não existir nenhum registro MX, os emails serão entregues diretamente ao host por meio de seu endereço IP.

A entrada MX de `freefall.FreeBSD.org` uma vez foi assim:

[.programlisting]
....
freefall		MX	30	mail.crl.net
freefall		MX	40	agora.rdrop.com
freefall		MX	10	freefall.FreeBSD.org
freefall		MX	20	who.cdrom.com
....

`freefall` teve muitas entradas MX. O menor número MX é o host que recebe email diretamente, se disponível. Se não for acessível por algum motivo, o próximo host de número mais baixo aceitará as mensagens temporariamente e as transmitirá quando um host de número inferior for disponibilizado.

Sites alternativos de MX devem ter conexões de Internet separadas para serem mais úteis. Seu ISP pode fornecer este serviço.

[[mail-domain]]
=== Email para um Domínio

Ao configurar um MTA para uma rede, qualquer mensagem enviada para hosts em seu domínio deve ser desviada para o MTA para que os usuários possam receber seus emails no servidor de email principal.

Para tornar a vida mais fácil, uma conta de usuário com o mesmo _username_ deve existir tanto no MTA como no sistema com o MUA. Use man:adduser[8] para criar as contas de usuário.

O MTA deve ser o servidor de mensagens designado para cada estação de trabalho na rede. Isso é feito na configuração DNS com um registro MX:

[.programlisting]
....
example.FreeBSD.org	A	204.216.27.XX		; Workstation
			MX	10 nevdull.FreeBSD.org	; Mailhost
....

Isso redirecionará o email para a estação de trabalho para o MTA, não importa onde o registro A aponta. O email é enviado para o host MX.

Isso deve ser configurado em um servidor DNS. Se a rede não executar seu próprio servidor DNS, fale com o ISP ou provedor DNS.

A seguir, um exemplo de hospedagem de email virtual. Considere um cliente com o domínio `customer1.org`, onde todas as mensagens para `customer1.org` devem ser enviadas para `mail.myhost.com`. A entrada DNS deve ficar assim:

[.programlisting]
....
customer1.org		MX	10	mail.myhost.com
....

Um registro `A`> _não_ é necessário em `customer1.org` para que seja enviado emails para esse domínio. No entanto, um `ping` em `customer1.org` não funcionará, a menos que exista um registro `A` para ele.

Diga ao MTA quais domínios e/ou nomes de host que ele deve aceitar emails. Qualquer um dos itens a seguir funcionará para o Sendmail:

* Adicione os hosts ao [.filename]#/etc/mail/local-host-names# ao usar `FEATURE (use_cw_file)`.
* Adicione uma linha `Cwyour.host.com` em [.filename]#/etc/sendmail.cf#.

[[outgoing-only]]
== Configurando Apenas Envio

Há muitos casos em que muitas instâncias podem querer enviar email através de um relay. Alguns exemplos são:

* O computador é uma máquina desktop que precisa usar programas como man:mail[1], usando o relay de email do ISP.
* O computador é um servidor que não manipula emails localmente, mas precisa passar todos os emails para um relay para processamento.

Embora qualquer MTA seja capaz de preencher esse nicho específico, pode ser difícil configurar adequadamente um MTA com todos os recursos apenas para lidar com o descarregamento de email. Programas como Sendmail e Postfix são um exagero para esse uso.

Além disso, um acordo típico de serviço de acesso à Internet pode proibir a execução de um "servidor de email".

A maneira mais fácil de atender a essas necessidades é instalar o port package:mail/ssmtp[]:

[source,bash]
....
# cd /usr/ports/mail/ssmtp
# make install replace clean
....

Uma vez instalado, o package:mail/ssmtp[] pode ser configurado em [.filename]#/usr/local/etc/ssmtp/ssmtp.conf#:

[.programlisting]
....
root=yourrealemail@example.com
mailhub=mail.example.com
rewriteDomain=example.com
hostname=_HOSTNAME_
....

Use o endereço de email real para `root`. Insira a retransmissão de mensagens de saída do ISP no lugar de `mail.example.com`. Alguns ISPs chamam isso de "servidor de email de saída" ou "servidor SMTP".

Certifique-se de desativar o Sendmail, incluindo o serviço de envio de mensagens. Veja <<mail-disable-sendmail>> para detalhes.

package:mail/ssmtp[] tem algumas outras opções disponíveis. Consulte os exemplos em [.filename]#/usr/local/etc/ssmtp# ou na página de manual do ssmtp para obter mais informações.

A configuração do ssmtp dessa maneira permite que qualquer software no computador que precise enviar mensagens funcione corretamente, sem violar a política de uso dos ISPs ou permitindo que o computador seja sequestrado para envio de spam.

[[SMTP-dialup]]
== Usando Email com uma Conexão Dialup

Ao usar um endereço IP estático, não é necessário ajustar a configuração padrão. Configure o nome do host para o nome da Internet designado e o Sendmail fará o resto.

Ao usar um endereço IP atribuído dinamicamente e uma conexão PPP de discagem à Internet, geralmente há uma caixa de correio no servidor de email do ISP. Neste exemplo, o domínio do ISP é `example.net`, o nome de usuário é `user`, o nome do host é `bsd.home`, e o ISP permitiu `relay.example.net` como um relay de email.

Para baixar emails da caixa de correio do ISP, instale um agente pela coleção de ports. O package:mail/fetchmail[] é uma boa escolha, pois suporta muitos protocolos diferentes. Normalmente, o ISP fornecerá POP. Ao usar o usuário PPP, o email pode ser baixado automaticamente quando uma conexão com a Internet é estabelecida com a seguinte entrada em [.filename]#/etc/ppp/ppp.linkup#:

[.programlisting]
....
MYADDR:
!bg su user -c fetchmail
....

Ao usar o Sendmail para entregar emails em contas não locais, configure o Sendmail para processar a fila de mensagens assim que a conexão com a Internet for estabelecida. Para fazer isso, adicione esta linha após a entrada `fetchmail` acima em [.filename]#/etc/ppp/ppp.linkup#:

[.programlisting]
....
  !bg su user -c "sendmail -q"
....

Neste exemplo, há uma conta para `user` em `bsd.home`. No diretório home de `user` em `bsd.home`, crie um [.filename]#.fetchmailrc# que contenha esta linha :

[.programlisting]
....
poll example.net protocol pop3 fetchall pass MySecret
....

Este arquivo não deve ter permissão de leitura para ninguém, exceto pelo `user`, pois contém a senha `MySecret`.

Para enviar emails com o cabeçalho correto `from:`, configure o Sendmail para usar mailto:user@example.net[user@example.net] em vez de mailto:user@bsd.home[user@bsd.home] e para enviar todos os emails através de `relay.example.net`, permitindo uma transmissão de email mais rápida.

O seguinte [.filename]#.mc# deve ser suficiente:

[.programlisting]
....
VERSIONID(`bsd.home.mc version 1.0')
OSTYPE(bsd4.4)dnl
FEATURE(nouucp)dnl
MAILER(local)dnl
MAILER(smtp)dnl
Cwlocalhost
Cwbsd.home
MASQUERADE_AS(`example.net')dnl
FEATURE(allmasquerade)dnl
FEATURE(masquerade_envelope)dnl
FEATURE(nocanonify)dnl
FEATURE(nodns)dnl
define(`SMART_HOST', `relay.example.net')
Dmbsd.home
define(`confDOMAIN_NAME',`bsd.home')dnl
define(`confDELIVERY_MODE',`deferred')dnl
....

Consulte a seção anterior para obter detalhes sobre como converter esse arquivo no formato [.filename]#sendmail.cf#. Não esqueça de reiniciar o Sendmail após atualizar o [.filename]#sendmail.cf#.

[[SMTP-Auth]]
== Autenticação SMTP

Configurar a autenticação SMTP no MTA oferece vários benefícios. A autenticação SMTP adiciona uma camada de segurança ao Sendmail e fornece aos usuários móveis que alternam os hosts a capacidade de usar o mesmo MTA sem a necessidade de reconfigurar as configurações de seus clientes de email a cada vez.

[.procedure]
====

. Instale o package:security/cyrus-sasl2[] da Coleção de Ports. Este port suporta várias opções de tempo de compilação. Para o método de autenticação SMTP demonstrado neste exemplo, certifique-se de que `LOGIN` não esteja desabilitado.
. Depois de instalar o package:security/cyrus-sasl2[], edite o [.filename]#/usr/local/lib/sasl2/Sendmail.conf#, ou crie-o se ele não existir, e adicione a seguinte linha :
+
[.programlisting]
....
pwcheck_method: saslauthd
....
+
. Em seguida, instale o package:security/cyrus-sasl2-saslauthd[] e adicione a seguinte linha ao [.filename]#/etc/rc.conf#:
+
[.programlisting]
....
saslauthd_enable="YES"
....
+ 
Finalmente, inicie o daemon saslauthd:
+
[source,bash]
....
# service saslauthd start
....
+ 
Este daemon serve como um intermediário para o Sendmail autenticar no banco de dados do FreeBSD o man:passwd[5]. Isso evita o trabalho de criar um novo conjunto de nomes de usuário e senhas para cada usuário que precise usar a autenticação SMTP e mantém a senha de login e email igual.
. Em seguida, edite o [.filename]#/etc/make.conf# e adicione as seguintes linhas:
+
[.programlisting]
....
SENDMAIL_CFLAGS=-I/usr/local/include/sasl -DSASL
SENDMAIL_LDFLAGS=-L/usr/local/lib
SENDMAIL_LDADD=-lsasl2
....
+ 
Essas linhas fornecem ao Sendmail as opções de configuração apropriadas para vincular ao package:cyrus-sasl2[] em tempo de compilação. Certifique-se de que o package:cyrus-sasl2[] tenha sido instalado antes de recompilar o Sendmail.
. Recompile o Sendmail executando os seguintes comandos:
+
[source,bash]
....
# cd /usr/src/lib/libsmutil
# make cleandir && make obj && make
# cd /usr/src/lib/libsm
# make cleandir && make obj && make
# cd /usr/src/usr.sbin/sendmail
# make cleandir && make obj && make && make install
....
+ 
Esta compilação não deve ter nenhum problema se o [.filename]#/usr/src# não foi alterado extensivamente e as bibliotecas compartilhadas necessárias estiverem disponíveis.
. Depois que o Sendmail tenha sido compilado e reinstalado, edite o [.filename]#/etc/mail/freebsd.mc# ou o arquivo local [.filename]#.mc#. Muitos administradores optam por usar a saída de man:hostname[1] como o nome de [.filename]#.mc# para exclusividade. Adicione estas linhas:
+
[.programlisting]
....
dnl set SASL options
TRUST_AUTH_MECH(`GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN')dnl
define(`confAUTH_MECHANISMS', `GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN')dnl
....
+ 
Essas opções configuram os diferentes métodos disponíveis para que o Sendmail autentique usuários. Para usar um método diferente de pwcheck, consulte a documentação do Sendmail.
. Finalmente, execute man:make[1] enquanto estiver em [.filename]#/etc/mail#. Isso executará o novo [.filename]#.mc# e criará um [.filename]#.cf# chamado [.filename]#freebsd.cf# ou o nome usado para o arquivo local [.filename]#.mc#. Em seguida, execute `make install restart`, que copiará o arquivo para o [.filename]#sendmail.cf#, e reinicie corretamente o Sendmail. Para mais informações sobre este processo, consulte [.filename]#/etc/mail/Makefile#.
====

Para testar a configuração, use um MUA para enviar uma mensagem de teste. Para investigações posteriores, defina o `LogLevel` do Sendmail como `13` e verifique o [.filename]#/var/log/maillog# para quaisquer erros.

Para mais informações, consulte http://www.sendmail.org/~ca/email/auth.html[autenticação SMTP].

[[mail-agents]]
== Mail User Agents

Um MUA é um aplicativo usado para enviar e receber emails. À medida que o email "evolui" e se torna mais complexo, os MUAs estão se tornando cada vez mais poderosos e fornecem aos usuários maior funcionalidade e flexibilidade. A categoria `mail` da Coleção de Ports do FreeBSD contém numerosos MUAs. Eles incluem clientes de email gráficos como Evolution ou Balsa e clientes baseados em console, como mutt ou alpine.

[[mail-command]]
=== `mail`

man:mail[1] é o MUA padrão instalado com o FreeBSD. É um MUA baseado em console que oferece a funcionalidade básica necessária para enviar e receber email em texto. Ele fornece suporte limitado a anexos e só pode acessar caixas de correio locais.

Embora o `mail` não suporte nativamente a interação com os servidores POP ou IMAP, essas caixas de correio podem ser baixadas para um arquivo [.filename]#mbox# local usando um aplicativo como fetchmail.

Para enviar e receber email, execute `mail`:

[source,bash]
....
% mail
....

O conteúdo da caixa de correio do usuário em [.filename]#/var/mail# é lido automaticamente pelo `mail`. Se a caixa de correio estiver vazia, o utilitário sairá com uma mensagem indicando que nenhum email foi encontrado. Se o email existir, a interface do aplicativo será iniciada e uma lista de mensagens será exibida. As mensagens são numeradas automaticamente, como pode ser visto no exemplo a seguir:

[source,bash]
....
Mail version 8.1 6/6/93.  Type ? for help.
"/var/mail/marcs": 3 messages 3 new
>N  1 root@localhost        Mon Mar  8 14:05  14/510   "test"
 N  2 root@localhost        Mon Mar  8 14:05  14/509   "user account"
 N  3 root@localhost        Mon Mar  8 14:05  14/509   "sample"
....

Agora as mensagens podem ser lidas digitando kbd:[t] seguido pelo número da mensagem. Este exemplo lê o primeiro email:

[source,bash]
....
& t 1
Message 1:
From root@localhost  Mon Mar  8 14:05:52 2004
X-Original-To: marcs@localhost
Delivered-To: marcs@localhost
To: marcs@localhost
Subject: test
Date: Mon,  8 Mar 2004 14:05:52 +0200 (SAST)
From: root@localhost (Charlie Root)

This is a test message, please reply if you receive it.
....

Como visto neste exemplo, a mensagem será exibida com cabeçalhos completos. Para exibir novamente a lista de mensagens, pressione kbd:[h].

Se o email exigir uma resposta, pressione as teclas kbd:[R] ou kbd:[r] no `mail`. kbd:[R] instrui o `mail` a responder apenas ao remetente do email, enquanto kbd:[r] responde a todos os outros destinatários da mensagem. Esses comandos podem ser sufixados com o número do email. Depois de digitar a resposta, o final da mensagem deve ser marcado por um único kbd:[.] em sua própria linha. Um exemplo pode ser visto abaixo:

[source,bash]
....
& R 1
To: root@localhost
Subject: Re: test

Thank you, I did get your email.
.
EOT
....

Para enviar um novo email, pressione kbd:[m], seguido pelo endereço de email do destinatário. Vários destinatários podem ser especificados separando cada endereço com o delimitador kbd:[,]. O assunto da mensagem pode então ser inserido, seguido pelo conteúdo da mensagem. O final da mensagem deve ser especificado colocando um único kbd:[.] em sua própria linha.

[source,bash]
....
& mail root@localhost
Subject: I mastered mail

Now I can send and receive email using mail ... :)
.
EOT
....

Enquanto estiver usando o `mail`, pressione kbd:[?] para exibir a ajuda a qualquer momento. Consulte man:mail[1] para obter mais detalhes sobre como usar o `mail`.

[NOTE]
====
O man:mail[1] não foi projetado para manipular anexos e, portanto, lida mal com eles. Novos MUAs lidam com anexos de uma maneira mais inteligente. Usuários que preferem usar `mail` podem preferir o port package:converters/mpack[].
====

[[mutt-command]]
=== mutt

O mutt é um poderoso MUA, com muitos recursos, incluindo:

* A capacidade de enviar mensagens.
* Suporte PGP para assinatura digital e criptografia de email.
* Suporte MIME.
* Suporte Maildir.
* Altamente personalizável.

Consulte http://www.mutt.org[http://www.mutt.org] para mais informações sobre o mutt.

O mutt pode ser instalado usando o port package:mail/mutt[]. Após o port ter sido instalado, o mutt pode ser iniciado com o seguinte comando:

[source,bash]
....
% mutt
....

O mutt irá automaticamente ler o conteúdo da caixa de correio do usuário em [.filename]#/var/mail#. Se nenhum email for encontrado, o mutt aguardará os comandos do usuário. O exemplo abaixo mostra o mutt exibindo uma lista de mensagens:

image::mutt1.png[]

Para ler um email, selecione-o usando as teclas de cursor e pressione kbd:[Enter]. Um exemplo de email exibido pelo mutt pode ser visto abaixo:

image::mutt2.png[]

Semelhante ao man:mail[1], o mutt pode ser usado para responder apenas ao remetente da mensagem, bem como para todos os destinatários. Para responder apenas ao remetente do email, pressione kbd:[r]. Para enviar uma resposta de grupo ao remetente original e a todos os destinatários da mensagem, pressione kbd:[g].

[NOTE]
====
Por padrão, o mutt usa o editor man:vi[1] para criar e responder emails. Cada usuário pode personalizar isso criando ou editando o [.filename]#.muttrc# em seu diretório home e configurando a variável `editor` ou definindo a variável de ambiente `EDITOR`. Consulte http://www.mutt.org/[http://www.mutt.org/] para obter mais informações sobre como configurar o mutt.
====

Para escrever uma nova mensagem de email, pressione kbd:[m]. Depois que um assunto válido foi dado, mutt iniciará o man:vi[1] para que o email possa ser escrito. Quando o conteúdo do email estiver completo, salve e saia do `vi`. O mutt será retomado, exibindo uma tela de resumo do email que será enviado. Para enviar o email, pressione kbd:[y]. Um exemplo da tela de resumo pode ser visto abaixo:

image::mutt3.png[]

O mutt contém manuais extensos que podem ser acessados pela maioria dos menus pressionando kbd:[?]. A linha superior também exibe os atalhos de teclado, quando apropriado.

[[alpine-command]]
=== alpine

O alpine é destinado a um usuário iniciante, mas também inclui alguns recursos avançados.

[WARNING]
====

O alpine teve várias vulnerabilidades remotas descobertas no passado, que permitiam que atacantes remotos executassem código arbitrário como usuários no sistema local, pela ação de enviar um email especialmente preparado. Enquanto problemas _conhecidos_ foram corrigidos, o código alpine foi escrito em um estilo inseguro e o FreeBSD Security Officer acredita que provavelmente há outras vulnerabilidades não descobertas. Os usuários instalam o alpine por sua conta e risco.
====

A versão atual do alpine pode ser instalada usando o port package:mail/alpine[]. Após a instalação do port, o alpine pode ser iniciado executando o seguinte comando:

[source,bash]
....
% alpine
....

A primeira vez que o alpine é executado, ele exibe uma página de saudação com uma breve introdução, bem como uma solicitação da equipe de desenvolvimento do alpine para enviar uma mensagem de email anônima para que eles saibam quantos usuários estão usando o seu cliente. Para enviar esta mensagem anônima, pressione kbd:[Enter]. Como alternativa, pressione kbd:[E] para sair da saudação sem enviar uma mensagem anônima. Um exemplo da página de saudação é mostrado abaixo:

image::pine1.png[]

O menu principal é então apresentado, o qual pode ser navegado usando as teclas de cursor. Esse menu principal fornece atalhos para a composição de novos emails, navegação em diretórios de email e administração de entradas do catálogo de endereços. Abaixo do menu principal, são mostrados os atalhos de teclado relevantes para executar funções específicas da tarefa em questão.

O diretório padrão aberto pelo alpine é o [.filename]#inbox#. Para visualizar o índice da mensagem, pressione kbd:[I] ou selecione a opção [.guimenuitem]#MESSAGE INDEX# mostrada abaixo:

image::pine2.png[]

O índice de mensagens mostra mensagens no diretório atual e pode ser navegado usando as teclas de cursor. As mensagens destacadas podem ser lidas pressionando kbd:[Enter].

image::pine3.png[]

Na captura de tela abaixo, uma mensagem de exemplo é exibida pelo alpine. Atalhos de teclado contextuais são exibidos na parte inferior da tela. Um exemplo de um atalho é kbd:[r], que diz ao MUA para responder à mensagem atual sendo exibida.

image::pine4.png[]

A resposta de um email pelo alpine é feita usando o editor pico, que é instalado por padrão com o alpine. O pico facilita a navegação na mensagem e é mais fácil de ser usado por usuários iniciantes do que o man:vi[1] ou man:mail[1]. Quando a resposta estiver completa, a mensagem pode ser enviada pressionando kbd:[Ctrl+X]. O alpine solicitará confirmação antes de enviar a mensagem.

image::pine5.png[]

O alpine pode ser personalizado usando a opção [.guimenuitem]#SETUP# no menu principal. Consulte http://www.washington.edu/alpine/[http://www.washington.edu/alpine/] para mais informações.

[[mail-fetchmail]]
== Usando o fetchmail

O fetchmail é um cliente IMAP e POP completo. Ele permite que os usuários baixem automaticamente emails de servidores IMAP e POP remotos e os salvem em caixas de correio locais, onde podem ser acessados mais facilmente. O fetchmail pode ser instalado usando o port package:mail/fetchmail[] e oferece vários recursos, incluindo:

* Suporte para os protocolos POP3, o APOP, o KPOP, o IMAP, o ETRN e o ODMR.
* Capacidade de encaminhar emails usando SMTP, que permite que a filtragem, o encaminhamento e aliases funcionem normalmente.
* Pode ser executado no modo daemon para verificar periodicamente novas mensagens.
* Pode buscar várias caixas de correio e encaminhá-las, com base na configuração, para diferentes usuários locais.

Esta seção explica alguns dos recursos básicos do fetchmail. Este utilitário requer uma configuração [.filename]#.fetchmailrc# no diretório pessoal do usuário para que seja executado corretamente. Este arquivo inclui informações do servidor, bem como credenciais de login. Devido à natureza sensível do conteúdo deste arquivo, é aconselhável torná-lo legível apenas pelo usuário, com o seguinte comando:

[source,bash]
....
% chmod 600 .fetchmailrc
....

O seguinte [.filename]#.fetchmailrc# serve como um exemplo para fazer o download de uma única caixa de correio de usuário usando POP. Ele diz ao fetchmail para se conectar ao `example.com` usando um nome de usuário `joesoap` e uma senha de `XXX`. Este exemplo pressupõe que o usuário `joesoap` exista no sistema local.

[.programlisting]
....
poll example.com protocol pop3 username "joesoap" password "XXX"
....

O próximo exemplo conecta-se a vários servidores POP e IMAP e redireciona para diferentes nomes de usuários locais quando aplicável:

[.programlisting]
....
poll example.com proto pop3:
user "joesoap", with password "XXX", is "jsoap" here;
user "andrea", with password "XXXX";
poll example2.net proto imap:
user "john", with password "XXXXX", is "myth" here;
....

fetchmail pode ser executado no modo daemon executando-o com `-d`, seguido pelo intervalo (em segundos) que o fetchmail deve pesquisar servidores listados em [.filename]#.fetchmailrc#. O exemplo a seguir configura o fetchmail para pesquisar a cada 600 segundos:

[source,bash]
....
% fetchmail -d 600
....

Mais informações sobre o fetchmail podem ser encontradas em http://www.fetchmail.info/[http://www.fetchmail.info/].

[[mail-procmail]]
== Usando o procmail

O procmail é um poderoso aplicativo usado para filtrar mensagens recebidas. Ele permite que os usuários definam "regras" que podem ser correspondidas aos emails recebidos para executar funções específicas ou para redirecionar o email para caixas de correio alternativas ou endereços de email. O procmail pode ser instalado usando o port package:mail/procmail[]. Uma vez instalado, ele pode ser diretamente integrado na maioria dos MTAs. Consulte a documentação do MTA para mais informações. Alternativamente, procmail pode ser integrado adicionando a seguinte linha a um [.filename]#.forward# no diretório pessoal do usuário:

[.programlisting]
....
"|exec /usr/local/bin/procmail || exit 75"
....

A seção a seguir exibe algumas regras básicas do procmail, além de breves descrições do que elas fazem. As regras devem ser inseridas em um [.filename]#.procmailrc#, que deve residir no diretório pessoal do usuário.

A maioria dessas regras pode ser encontrada em man:procmailex[5].

Para encaminhar todos os emails de mailto:user@example.com[user@example.com] para um endereço externo de mailto:goodmail@example2.com[goodmail@example2.com]:

[.programlisting]
....
:0
* ^From.*user@example.com
! goodmail@example2.com
....

Para encaminhar todos os emails com menos de 1000 bytes para um endereço externo de mailto:goodmail@example2.com[goodmail@example2.com]:

[.programlisting]
....
:0
* < 1000
! goodmail@example2.com
....

Para enviar todas as mensagens enviadas para mailto:alternate@example.com[alternate@example.com] para uma caixa de correio chamada [.filename]#alternate#:

[.programlisting]
....
:0
* ^TOalternate@example.com
alternate
....

Para enviar todas as mensagens com um assunto de "Spam" para [.filename]#/dev/null#:

[.programlisting]
....
:0
^Subject:.*Spam
/dev/null
....

Uma receita útil que analisa listas de discussão `do FreeBSD.org` e coloca cada lista em sua própria caixa de correio:

[.programlisting]
....
:0
* ^Sender:.owner-freebsd-\/[^@]+@FreeBSD.ORG
{
	LISTNAME=${MATCH}
	:0
	* LISTNAME??^\/[^@]+
	FreeBSD-${MATCH}
}
....

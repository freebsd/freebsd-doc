---
title: Бүлэг 22. Vinum Эзлэхүүн Менежер
part: хэсэг III. Системийн Удирдлага
prev: books/handbook/filesystems
next: books/handbook/virtualization
showBookMenu: true
weight: 26
path: "/books/handbook/vinum/"
---

[[vinum-vinum]]
= Vinum Эзлэхүүн Менежер
:doctype: book
:toc: macro
:toclevels: 1
:icons: font
:sectnums:
:sectnumlevels: 6
:sectnumoffset: 22
:partnums:
:source-highlighter: rouge
:experimental:
:images-path: books/handbook/vinum/

ifdef::env-beastie[]
ifdef::backend-html5[]
:imagesdir: ../../../../images/{images-path}
endif::[]
ifndef::book[]
include::shared/authors.adoc[]
include::shared/mirrors.adoc[]
include::shared/releases.adoc[]
include::shared/attributes/attributes-{{% lang %}}.adoc[]
include::shared/{{% lang %}}/teams.adoc[]
include::shared/{{% lang %}}/mailing-lists.adoc[]
include::shared/{{% lang %}}/urls.adoc[]
toc::[]
endif::[]
ifdef::backend-pdf,backend-epub3[]
include::../../../../../shared/asciidoctor.adoc[]
endif::[]
endif::[]

ifndef::env-beastie[]
toc::[]
include::../../../../../shared/asciidoctor.adoc[]
endif::[]

[[vinum-synopsis]]
== Ерөнхий агуулга

Та ямар ч дискнүүдтэй байсан гэсэн үргэлж ямар нэгэн болзошгүй асуудлууд байсаар байдаг:

* Тэдгээр дискнүүд нь хэтэрхий жижиг байж болох юм.
* Тэдгээр дискнүүд нь хэтэрхий удаан байж болох юм.
* Тэдгээр дискнүүд нь хэтэрхий найдваргүй байж болох юм.

Эдгээр асуудлуудыг шийдэх төрөл бүрийн шийдлүүд санал болгогдсон бөгөөд хийж гүйцэтгэгдсэн болно. Иймэрхүү асуудлууд гаргахгүйгээр зарим хэрэглэгчдийн өөрсдийгээ хамгаалах нэг арга нь олон болон нөөц дискнүүдийг заримдаа ашиглах явдал юм. Үндсэн FreeBSD систем нь тоног төхөөрөмжөөр дэмжигдсэн RAID системүүдэд зориулсан төрөл бүрийн картууд болон хянагчуудыг дэмжихээс гадна виртуал диск хөтчүүдийг хийдэг блок төхөөрөмжийн драйвер Vinum Эзлэхүүн Менежерийг агуулдаг. _Vinum_ нь эдгээр гурван асуудлыг шийддэг _Эзлэхүүн Менежер_ гэж нэрлэгддэг виртуал дискний драйвер юм. Vinum нь уян хатан чанар, ажиллагаа болон найдвартай байдлыг уламжлалт диск хадгалалтаас илүүтэй хангадаг бөгөөд RAID-0, RAID-1 болон RAID-5 загваруудыг дангаар нь болон хослолынх нь хувьд шийддэг.

Энэ бүлэг нь уламжлалт диск хадгалалтын болзошгүй асуудлуудыг тоймлон өгүүлэх бөгөөд Vinum Эзлэхүүн Менежерийн талаар танилцуулах болно.

[NOTE]
====
FreeBSD 5-аас эхлэн Vinum-ийг GEOM архитектурт (crossref:geom[geom,GEOM. Модульчлагдсан Диск Хувиргах Тогтолцоо]) тааруулан оруулахын тулд анхдагч санаанууд, нэр томъёо болон диск дээрх мета өгөгдлийг нь хадгалан дахин бичсэн юм. Энэхүү дахин бичилт нь _gvinum_ (_GEOM vinum_-д зориулсан) гэгддэг. Дараах баримт нь шийдлийн хувилбаруудаас үл хамааран _Vinum_-ийг хийсвэр нэр маягаар ихэвчлэн хэрэглэх болно. Ямар ч тушаалыг одоо ажиллуулахдаа `gvinum` тушаалыг ашиглах ёстой бөгөөд цөмийн модулийн нэр нь [.filename]#vinum.ko# [.filename]#geom_vinum.ko# болж өөрчлөгдсөнөөс гадна төхөөрөмжийн бүх цэгүүд [.filename]#/dev/vinum# дотор биш [.filename]#/dev/gvinum# дотор байрласан байгаа. FreeBSD 6-аас эхлэн хуучин Vinum шийдэл нь үндсэн кодонд байхаа аль хэдийн больсон байна. 
====

[[vinum-intro]]
== Дискнүүд хэтэрхий жижиг

Дискнүүд нь хэмжээний хувьд улам томорсоор байгаагийн адил бас өгөгдлийн хадгалалтын шаардлагууд ч бас тийм болсоор байна. Ихэнх тохиолдолд танд өөрт чинь байгаа дискнүүдээс илүү том файлын систем хэрэгтэй болж магадгүй юм. Энэ асуудал нь арван жилийн өмнөх шиг тийм хурц асуудал биш болсон боловч одоо болтол байгааг нь хүлээн зөвшөөрөхөөс өөр аргагүй юм. Зарим системүүд нь үүнийг өөрийнхөө өгөгдлийг хэд хэдэн дискнүүд дээр хадгалах хийсвэр төхөөрөмж үүсгэн шийддэг байна.

[[vinum-access-bottlenecks]]
== Хандалтын тагларалтууд

Орчин үеийн системүүдэд маш өндөр зэрэгцээ хандлагаар өгөгдөлд хандах хэрэгцээ байнга гардаг. Жишээ нь том FTP эсвэл HTTP серверүүд нь олон мянган зэрэгцээ сессүүдтэй ажиллаж чаддаг ба ихэнх дискнүүдийн тогтвортой дамжуулах түвшингээс хавьгүй илүү гарсан гадагшаа ертөнц уруу холбогдсон олон 100 Mbit/s-ийн холболтуудтай байдаг.

Одоогийн диск хөтчүүд өгөгдлийг цуваагаар 70 MB/s хүртэл дамжуулж чаддаг боловч энэ утга нь бие биенээсээ хамааралгүй олон чөлөөтэй процессууд хөтчид ханддаг тийм орчинд тийм ч чухал биш юм. Тийм орчинд процессууд нь тэдгээр утгуудын зөвхөн бутархайгаар хэмжигдэх тооны хурдад хүрч магадгүй юм. Ийм тохиолдлуудад асуудлыг дискний дэд системийн үүднээс харвал илүү сонирхолтой байх болно: энд чухал параметр нь дэд системд үзүүлж байгаа дамжуулалтын ачаалал бөгөөд өөрөөр хэлбэл дамжуулалтад оролцож байгаа хөтчүүдийг эзэлж байгаа дамжуулалтын тэр хугацаа юм.

Аль ч дискний дамжуулалтын үед хөтөч нь толгойнуудаа эхлээд байрлуулж унших толгойн доор эхний сектор шалгагдан өнгөрөхийг хүлээж дараа нь дамжуулалтыг гүйцэтгэх ёстой. Эдгээр үйлдлүүд нь atomic буюу хуваагдашгүй, салгагдашгүй үйлдлүүд гэж ойлгогддог: тэдгээрийг тасалдуулах нь ямар ч утгагүй юм.

[[vinum-latency]] Ердийн 10 kB-ийн дамжуулалтыг авч үзье: өндөр ажиллагаатай одоо үеийн дискнүүд нь толгойнуудаа дунджаар 3.5 ms-д байрлуулж чаддаг. Хамгийн хурдан хөтчүүд 15,000 rpm хурдаар эргэдэг, тийм болохоор дундаж эргэх хожимдол нь (хувьсгалын хагас) 2 ms болох юм. 70 MB/s үед дамжуулалт нь өөрөө 150 μs болох бөгөөд байрлуулах хугацаатай харьцуулахад бараг юу ч биш юм. Ийм тохиолдолд үр дүнтэй дамжуулах түвшин нь 1 MB/s-с бага зэрэг илүү түвшин уруу буурах бөгөөд мэдээж энэ нь дамжуулах хэмжээнээс ихээхэн хамааралтай байна.

Энэ асуудлын уламжлалт, мэдээжийн шийдэл нь "илүү ээрүүлүүд" юм: нэг том диск ашиглахын оронд энэ нь нийт хадгалалтын хэмжээ нь адилхан хэд хэдэн арай жижиг дискнүүдийг ашиглах явдал юм. Диск бүр нь тус тусдаа байрлуулах болон дамжуулах үйлдлийг хийж чадах бөгөөд ингэснээр үр дүнтэй дамжуулах чанар нь ашигласан дискний тоотой ойролцоо хүчин зүйлээр нэмэгдэх болно. 

Дамжуулалтын чанарын яг тодорхой сайжруулалт нь мэдээж оролцсон дискнүүдийн тооноос бага байна: хөтөч бүр нь зэрэгцээ дамжуулж чадах боловч хүсэлтүүд нь хөтчүүдийн дагуу тэнцүү түгээгдэхийг батлах аргагүй юм. Нэг хөтөч дээрх ачаалал нь нөгөө дээрхээс илүү өндөр байх нь зайлшгүй юм.

Дискнүүд дээрх ачааллын тэнцүү байдал нь хөтчүүдийн дагуу өгөгдлүүд хуваалцдаг арга замаас маш ихээр хамаардаг. Дараах хэлэлцүүлэг дээр дискний хадгалалтыг номны хуудас шигээр дугаараар нь хандаж болох маш олон тооны өгөгдлийн секторууд гэж ойлгох нь тохиромжтой юм. Хамгийн мэдээжийн арга бол том номыг аваад жижиг хэсгүүд болгон урахын оронд виртуал дискийг физик дискнүүдийн хэмжээтэйгээр дараалсан секторуудын бүлгүүд болгон хувааж энэ маягаар тэдгээрийг хадгалах явдал юм. Энэ аргыг _concatenation буюу нийлүүлэлт_ гэж нэрлэдэг бөгөөд дискнүүд нь ямар нэгэн тусгайлсан хэмжээний харилцаанууд шаарддаггүйгээрээ давуу талтай юм. Виртуал диск дэх хандалт өөрийн хаягийн талбараар тэнцүү тархсан үед энэ нь сайн ажилладаг. Хандалт нь жижиг талбарт төвлөрсөн үед сайжруулалт тийм ч сайн мэдэгддэггүй. <<vinum-concat>> нь хадгалалтын нэгжүүд нийлүүлэгдсэн зохион байгуулалтад хуваарилагдаж байгаа дарааллыг үзүүлж байна.

[[vinum-concat]]
.Нийлүүлэгдсэн зохион байгуулалт
image::vinum-concat.png[]

Өөр нэг тааруулалт нь хаягийн талбарыг арай жижиг, тэнцүү хэмжээтэй бүрэлдэхүүн хэсэгт хувааж тэдгээрийг цуваагаар өөр төхөөрөмжүүд дээр хадгалах явдал юм. Жишээ нь эхний 256 сектор эхний диск дээр, дараагийн 256 сектор нь дараагийн диск дээр гэх мэтчилэн байх юм. Сүүлийн дискэнд хүрсний дараа процесс дискнүүдийг дүүртэл давтагдана. Энэ тааруулалтыг _striping буюу судал үүсгэх_ эсвэл RAID-0 гэж нэрлэдэг. . Судал үүсгэх нь зарим талаараа өгөгдлийг олохын тулд илүү чармайлт шаарддаг бөгөөд олон дискнүүдийн дагуу тархсан дамжуулалтад нэмэлт I/O ачаалал үүсгэж болох боловч энэ нь бас тогтмол ачааллыг илүүтэйгээр дискнүүдийн дагуу хангаж өгдөг. <<vinum-striped>> нь хадгалалтын нэгжүүд судалчлагдсан зохион байгуулалтад хуваарилагдаж байгаа дарааллыг үзүүлж байна.

[[vinum-striped]]
.Судалчлагдсан зохион байгуулалт
image::vinum-striped.png[]

[[vinum-data-integrity]]
== Өгөгдлийн бүрэн бүтэн байдал

Одоогийн дискнүүд дэх сүүлийн асуудал нь найдваргүй байдал юм. Диск хөтчүүдийн найдвартай байдал сүүлийн хэдэн жилийн дотор асар ихээр нэмэгдсэн боловч тэдгээр нь сервер унах гол шалтгааны нэг бүрэлдэхүүн хэсэг хэвээр байсаар байна. Ингэсэн тохиолдолд гарах үр дүн нь сүйрлийн байж болох юм: ажиллагаагүй болсон дискний хөтчийг сольж шинэ диск уруугаа өгөгдлийг сэргээх нь хэдэн өдөр болж болох юм.

Уламжлалт замаар энэ асуудлыг _толин тусгал үүсгэх_ аргаар өгөгдлийн хоёр хуулбарыг өөр физик тоног төхөөрөмж дээр хадгалж шийддэг. RAID түвшингүүд бий болсноор энэ техник нь бас RAID түвшин 1 буюу RAID-1 гэж нэрлэгддэг. Эзлэхүүн уруу хийгдэх бичилт хоёр байрлал уруу хийгддэг; уншилт нь алинаас нь ч хийгдсэн болдог, хэрэв нэг хөтөч нь ажиллахгүй болбол өгөгдөл нөгөө хөтөч дээр бас байж байх юм.

Толин тусгал үүсгэх нь хоёр асуудалтай байдаг:

* Үнэ. Энэ нь нөөцгүй шийдлийн нэгэн адил хоёр дахин их дискний хадгалалт шаарддаг.
* Ажиллагааны нөлөөлөл. Бичилтүүд нь хоёр хөтчүүдэд хоёуланд нь хийгддэг, тиймээс тэдгээр нь толин тусгал хийгдээгүй эзлэхүүний зурвасын өргөнөөс хоёр дахин ихийг эзэлдэг. Уншилтууд нь харин ажиллагааны хувьд асуудалгүй байдаг: тэд илүү хурдан юм шиг харагддаг.

Өөр нэг шийдэл нь RAID түвшингүүд 2, 3, 4 болон 5-д хийгдсэн _parity_ юм. Эдгээрээс RAID-5 нь хамгийн сонирхолтой байдаг. Энэ нь Vinum-д хийгдсэн бөгөөд судал бүрийн нэг блокийг өөр блокуудын parity-д зориулдаг судалчлагдсан зохион байгуулалтын нэг хувилбар юм. RAID-5 plex нь Vinum-д хийгдсэн бөгөөд судалчлагдсан plex-ийн нэгэн адил боловч энэ нь судал бүр дэх parity блокуудыг оруулан RAID-5-г шийдвэрлэдэг. RAID-5-ийн шаарддагаар энэ parity блокийн байрлал нь нэг судлаас дараагийнх уруу өөрчлөгддөг. Өгөгдлийн блокууд дахь тоонууд нь блокийн харьцангуй дугааруудыг илэрхийлдэг.

[[vinum-raid5-org]]
.RAID-5 зохион байгуулалт
image::vinum-raid5-org.png[]

Толин тусгал үүсгэхтэй харьцуулахад RAID-5 нь хамаагүй бага хадгалалтын зай шаарддагаараа давуу талтай юм. Унших хандалт нь судалчлагдсан зохион байгуулалтуудын адил байдаг боловч бичих хандалт нь хамаагүй удаан ойролцоогоор унших хурдны 25% байдаг. Хэрэв нэг хөтөч ажиллагаагүй болбол массив нь доройтсон горимд үргэлжлэн ажиллах болно: үлдсэн хандаж болох хөтчүүдийн аль нэгнээс уншилт хэвийн үргэлжлэх боловч ажиллагаагүй болсон хөтчөөс хийгдэх уншилт бүх үлдсэн хөтчүүдийн харгалзах блокоос дахин тооцоологдох болно. 

[[vinum-objects]]
== Vinum обьектууд

Эдгээр асуудлуудыг шийдэхийн тулд Vinum нь обьектийн дөрвөн түвшний шатлалыг шийддэг:

* Хамгийн харагддаг обьект нь _volume буюу эзлэхүүн_ гэгддэг виртуал диск юм. Эзлэхүүнүүд нь гол нь UNIX(R) диск хөтчүүдийн нэгэн адил өмчүүдтэй боловч зарим нэг жижиг ялгаанууд байдаг. Тэдэнд хэмжээний хязгаарлалтууд байхгүй.
* Эзлэхүүнүүд нь тус бүр нь эзлэхүүний нийт хаягийн талбарыг илэрхийлдэг __plex-үүд__ээс бүрддэг. Тиймээс шатлал дахь энэ түвшин нь нөөцийг хангадаг. Plex-үүдийг толин тусгал хийгдсэн массив дахь тус бүртээ ижил өгөгдлийг агуулсан дискнүүд гэж бодох хэрэгтэй.
* Vinum нь UNIX(R) диск хадгалалтын тогтолцоонд оршдог болохоор UNIX(R) хуваалтуудыг олон диск бүхий plex-үүдийн хувьд бүтээх блок болгон ашиглах боломжтой, гэхдээ жинхэнэдээ энэ нь хэтэрхий уян хатан биш болж болох юм: UNIX(R) дискнүүд нь зөвхөн хязгаарлагдмал тооны хуваалтуудтай байдаг. Ингэхийн оронд харин Vinum нь ганц UNIX(R) хуваалтыг (_хөтөч_) _subdisks буюу дэд дискнүүд_ гэгддэг үргэлжлэн нийлсэн талбаруудад хуваадаг бөгөөд эдгээр дэд дискнүүдийг plex-үүдэд зориулж бүтээх блок болгон ашигладаг.
* Дэд дискнүүд нь Vinum _хөтчүүд_ дээр, одоогоор UNIX(R) хуваалтууд дээр оршдог. Vinum хөтчүүд нь дурын тооны дэд дискнүүдийг агуулж болно. Хөтчийн эхлэл дэх тохиргоо болон төлвийн мэдээллийг хадгалах зориулалттай жижиг талбараас бусад хөтчийн бүх хэсэг өгөгдлийн хадгалалтанд зориулагдана.

Дараах хэсгүүд нь эдгээр обектуудын Vinum-ийн шаарддаг ажиллагааг хангах аргыг тайлбарлах болно.

=== Эзлэхүүний хэмжээний саналууд

Plex-үүд нь Vinum тохиргоонд бүх хөтчүүд дээгүүр тархсан олон дэд дискнүүдийг агуулж болно. Үүний үр дүнд хөтөч бүрийн хэмжээ нь plex-ийн хэмжээг хязгаарлахгүй, тиймээс эзлэхүүний хэмжээг бас хязгаарлахгүй юм.

=== Өгөгдлийн нөөц хадгалалт

Vinum нь олон plex-үүдийг эзлэхүүнд хавсран толин тусгал үүсгэлтийг хийж гүйцэтгэдэг. Plex бүр эзлэхүүн дэх өгөгдлийн дүрслэл юм. Эзлэхүүн нь нэгээс найман plex-ийг агуулж болно.

Plex нь эзлэхүүний бүх өгөгдлийг илэрхийлдэг боловч илэрхийллүүдийн хэсгүүд нь хийгдсэн аргаасаа (plex-ийн хэсгүүдийн хувьд дэд дискнүүдийг тодорхойлоогүйгээс) болоод эсвэл тохиолдлоор (хөтөч ажиллагаагүй болсноос болоод) бодитоор байхгүй байх боломжтой юм. Эзлэхүүний хаягийн бүрэн талбарын хүрээний хувьд хамгийн багаар бодоход нэг plex өгөгдлийг хангаж чаддаг байхад эзлэхүүн нь бүрэн ажиллагаатай байх юм.

=== Ажиллагааны асуудлууд

Vinum нь нийлүүлэлт болон судалчлалыг plex түвшинд хийж гүйцэтгэдэг:

* _Нийлүүлэгдсэн plex_ нь харин дэд диск бүрийн хаягийн талбарыг ашигладаг.
* _Судалчлагдсан plex_ нь дэд диск бүрийн дагуу өгөгдлийг судалчилдаг. Дэд диск бүр бүгд адил хэмжээтэй байх ёстой бөгөөд нийлүүлэгдсэн plex-ээс ялгахын тулд хамгийн багаар бодоход хоёр дэд диск байх шаардлагатай.

=== Аль Plex зохион байгуулалт вэ?

FreeBSD {rel120-current}-тэй цуг ирдэг Vinum-ийн хувилбар нь хоёр төрлийн plex-ийг хийж гүйцэтгэдэг:

* Нийлүүлэгдсэн plex-үүд нь хамгийн уян хатан байдаг: тэдгээр нь ямар ч тооны дэд дискнүүдийг агуулж болох бөгөөд дэд дискнүүд нь өөр өөр урттай байж болно. Plex-ийг нэмэлт дэд дискнүүд нэмж өргөтгөж болох юм. Тэдгээр нь судалчлагдсан plex-үүдээс CPU-ийн хугацааны хувьд багыг шаарддаг, гэхдээ CPU дээрх нэмэлт ачааллын ялгаа нь хэмжигдэхээр тийм их биш юм. Нөгөө талаас авч үзэх юм бол тэдгээр нь ганц диск их идэвхитэй бөгөөд бусад нь сул зогсож байдаг халуун цэгүүдэд хамгийн мэдрэмтгий байдаг.
* Судалчлагдсан (RAID-0) plex-үүдийн хамгийн агуу давуу тал нь тэдгээр plex-үүд нь халуун цэгүүдийг багасгадаг явдал юм: хамгийн тохиромжтой (256 kB орчим) хэмжээтэйгээр судлыг сонгосноор та бүрэлдэхүүний хөтчүүд дээрх ачааллыг тэнцүүлж болох юм. Энэ хандлагын сул талууд нь (бутархайгаар хэмжигдэх) илүү төвөгтэй код болон дэд дискнүүд дээрх хязгаарлалтууд юм: тэдгээр нь бүгд ижил хэмжээтэй байх ёстой бөгөөд шинэ дэд дискнүүд нэмж plex-ийг өргөтгөх нь асар хэцүү учир Vinum нь үүнийг одоогоор хийж гүйцэтгэдэггүй юм. Vinum нь нэмэлт, амархан хязгаарлалтыг тохоож өгдөг: судалчлагдсан plex нь хамгийн багаар бодоход хоёр дэд дисктэй байх ёстой, тэгэхгүй бол үүнийг нийлүүлэгдсэн plex-ээс ялгах боломжгүй юм.

<<vinum-comparison>> нь plex зохион байгуулалт бүрийн давуу болон сул талуудыг дүгнэн харуулж байна.

[[vinum-comparison]]
.Vinum Plex зохион байгуулалтууд
[cols="1,1,1,1,1", frame="none", options="header"]
|===
| Plex төрөл
| Хамгийн бага дэд дискнүүд
| Дэд дискнүүд нэмж болох эсэх
| Адил хэмжээтэй байх ёстой
| Хэрэглээ

|нийлүүлэгдсэн
|1
|тийм
|үгүй
|Байрлуулах хамгийн их уян хатан чанар ба боломжийн ажиллагаатай их хэмжээний өгөгдлийн хадгалалт

|судалчлагдсан
|2
|үгүй
|тийм
|Маш өндөр зэрэгцээ хандалттай цуг өндөр хурдтай ажиллагаа
|===

[[vinum-examples]]
== Зарим жишээнүүд

Vinum нь хувь системүүдэд мэдэгддэг обьектуудыг тайлбарладаг __тохиргооны мэдээллийн бааз__ын ажиллагааг хангаж байдаг. Эхлээд хэрэглэгч нэг буюу эсвэл хэд хэдэн тохиргооны файлуудаас тохиргооны мэдээллийн баазыг man:diskinfo[8] хэрэгсэл програмын тусламжтайгаар үүсгэдэг. Vinum нь өөрийн тохиргооны мэдээллийн баазын хуулбарыг диск зүсмэл (Vinum үүнийг _төхөөрөмж_ гэдэг) бүр дээр өөрийн хяналтын доор хадгалдаг. Дахин эхлүүлэлт нь зөвөөр Vinum обьект бүрийн төлвийг сэргээдэг байлгахын тулд төлөв өөрчлөгдөх болгонд энэхүү мэдээллийн бааз нь шинэчлэгддэг.

=== Тохиргооны файл

Тохиргооны файл нь Vinum обьектуудыг тайлбарладаг. Энгийн эзлэхүүний тодорхойлолт ийм байж болох юм:

[.programlisting]
....

    drive a device /dev/da3h
    volume myvol
      plex org concat
        sd length 512m drive a
....

Энэ файл нь дөрвөн Vinum обьектийг тайлбарладаг:

* _drive_ мөр нь дискний хуваалтыг (_хөтөч_) тайлбарлах бөгөөд үүний байрлал нь түүн доор орших тоног төхөөрөмжтэй харьцангуй байна. Үүнд _a_ гэж симбол нэр өгсөн байгаа. Ингэж симбол нэрсийг төхөөрөмжийн нэрсээс тусад нь салгах нь дискнүүдийг нэг байрлалаас нөгөө уруу эргэлзээгүйгээр шилжүүлэх боломжийг олгодог.
* _volume_ мөр нь эзлэхүүнийг тайлбарлана. Цорын ганц шаардлагатай шинж чанар нь нэр бөгөөд энэ тохиолдолд _myvol_ байна.
* _plex_ мөр нь plex-ийг тодорхойлдог. Цорын ганц шаардлагатай параметр нь зохион байгуулалт бөгөөд энэ тохиолдолд _concat_ болно. Ямар ч нэр хэрэггүй: систем автоматаар эзлэхүүний нэрэн дээр _.px_ дагавар залгаж үүсгэдэг бөгөөд _x_ нь эзлэхүүн дэх plex-ийн дугаар юм. Тиймээс энэ plex нь _myvol.p0_ гэж нэрлэгдэнэ.
* _sd_ мөр нь дэд дискийг тайлбарлана. Хамгийн бага тодорхойлолтууд нь үүнийг хадгалах хөтчийн нэр болон дэд дискний урт юм. Plex-үүдтэй адил нэр хэрэггүй: систем автоматаар plex-ийн нэрэн дээр _.sx_ дагавар залгаж үүсгэдэг бөгөөд _x_ нь plex дэх дэд дискний дугаар юм. Тиймээс Vinum нь энэ дэд дискэнд _myvol.p0.s0_ гэж нэр өгдөг.

Энэ файлыг процесс хийсний дараа man:diskinfo[8] дараах үр дүнг гаргана:

[.programlisting]
....

      #  gvinum -> create config1
      Configuration summary
      Drives:         1 (4 configured)
      Volumes:        1 (4 configured)
      Plexes:         1 (8 configured)
      Subdisks:       1 (16 configured)

	D a                     State: up       Device /dev/da3h        Avail: 2061/2573 MB (80%)

	V myvol                 State: up       Plexes:       1 Size:        512 MB

	P myvol.p0            C State: up       Subdisks:     1 Size:        512 MB

	S myvol.p0.s0           State: up       PO:        0  B Size:        512 MB
....

Энэ гаралт нь man:diskinfo[8]-ийн хэлбэршүүлэлтийн товч жагсаалтыг харуулж байна. Энэ нь графикаар <<vinum-simple-vol>> зурагт дүрслэгдсэн байна.

[[vinum-simple-vol]]
.Энгийн Vinum эзлэхүүн
image::vinum-simple-vol.png[]

Энэ зураг болон дараагийн зураг нь дэд дискнүүд агуулсан plex-үүдийг агуулсан эзлэхүүнийг харуулж байна. Энэ хялбар жишээн дээр эзлэхүүн нь нэг plex-ийг агуулах бөгөөд plex нь нэг дэд дискийг агуулж байна.

Энэхүү эзлэхүүн нь хэвшмэл дискний хуваалттай харьцуулахад ямар нэг тухайлсан давуу чанаргүй юм. Энэ нь ганц plex-ийг агуулах учраас нөөц биш юм. Plex нь ганц дэд дискнээс тогтох учраас хэвшмэл дискний хуваалттай харьцуулахад хадгалалт хуваарилалтын хувьд ямар ч ялгаагүй юм. Дараах хэсгүүд нь төрөл бүрийн илүү сонирхолтой тохиргооны аргуудыг харуулах болно.

=== Нэмэгдсэн уян хатан чанар: Толин тусгал үүсгэх

Эзлэхүүний уян хатан чанарыг толин тусгал үүсгэж ихэсгэж болно. Толин тусгал хийсэн эзлэхүүнийг байрлуулахдаа хөтчийн сүйрэл plex бүрийг унагахгүй байлгахын тулд plex бүр дэх дэд дискнүүд нь өөр өөр хөтчүүд дээр байгаа эсэхийг шалгах нь чухал юм. Дараах тохиргоо нь эзлэхүүнийг толин тусгал хийж байна:

[.programlisting]
....

	drive b device /dev/da4h
	volume mirror
      plex org concat
        sd length 512m drive a
	  plex org concat
	    sd length 512m drive b
....

Vinum нь өөрийн тохиргооны мэдээллийн бааз дахь бүх обьектуудыг хянаж байдаг болохоор _a_ хөтчийн тодорхойлолтыг энэ жишээн дээр дахин зааж өгөх шаардлагагүй юм. Энэ тодорхойлолтыг процесс хийсний дараа тохиргоо иймэрхүү харагдана:

[.programlisting]
....

	Drives:         2 (4 configured)
	Volumes:        2 (4 configured)
	Plexes:         3 (8 configured)
	Subdisks:       3 (16 configured)

	D a                     State: up       Device /dev/da3h        Avail: 1549/2573 MB (60%)
	D b                     State: up       Device /dev/da4h        Avail: 2061/2573 MB (80%)

    V myvol                 State: up       Plexes:       1 Size:        512 MB
    V mirror                State: up       Plexes:       2 Size:        512 MB

    P myvol.p0            C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p0           C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p1           C State: initializing     Subdisks:     1 Size:        512 MB

    S myvol.p0.s0           State: up       PO:        0  B Size:        512 MB
	S mirror.p0.s0          State: up       PO:        0  B Size:        512 MB
	S mirror.p1.s0          State: empty    PO:        0  B Size:        512 MB
....

<<vinum-mirrored-vol>> зураг нь бүтцийг графикаар харуулж байна.

[[vinum-mirrored-vol]]
.Толин тусгал хийгдсэн Vinum эзлэхүүн
image::vinum-mirrored-vol.png[]

Энэ жишээн дээр plex бүр бүрэн 512 MB хаягийн талбарыг агуулж байна. Өмнөх жишээн дээрх шиг plex бүр зөвхөн ганц дэд дискийг агуулна.

=== Ажиллагааг оновчтой болгох

Өмнөх жишээн дээрх толин тусгал хийгдсэн эзлэхүүн нь толин тусгал хийгдээгүй эзлэхүүнээс илүү сүйрэлд тэсвэртэй боловч ажиллагааны хувьд дутмаг байдаг: эзлэхүүн уруу хийгдэх бичилт бүр нь нийт дискний зурвасын өргөнөөс илүүтэйгээр ашиглан хоёр хөтөч хоёулан уруу нь бичилт хийхийг шаарддаг. Ажиллагааны тооцоонууд нь өөр хандлагыг шаарддаг: толин тусгал үүсгэхийн оронд өгөгдөл нь аль болох олон диск хөтчүүдийн дагуу судалчлагддаг. Дараах тохиргоо нь дөрвөн дискний хөтчүүдийн дагуу судалчлагдсан plex бүхий эзлэхүүнийг харуулж байна:

[.programlisting]
....

	drive c device /dev/da5h
	drive d device /dev/da6h
	volume stripe
	plex org striped 512k
	  sd length 128m drive a
	  sd length 128m drive b
	  sd length 128m drive c
	  sd length 128m drive d
....

Өмнөхийн адил Vinum-д мэдэгдэж байгаа хөтчүүдийг тодорхойлох хэрэггүй юм. Энэ тодорхойлолтыг процесс хийсний дараа тохиргоо иймэрхүү байна:

[.programlisting]
....

	Drives:         4 (4 configured)
	Volumes:        3 (4 configured)
	Plexes:         4 (8 configured)
	Subdisks:       7 (16 configured)

    D a                     State: up       Device /dev/da3h        Avail: 1421/2573 MB (55%)
    D b                     State: up       Device /dev/da4h        Avail: 1933/2573 MB (75%)
    D c                     State: up       Device /dev/da5h        Avail: 2445/2573 MB (95%)
    D d                     State: up       Device /dev/da6h        Avail: 2445/2573 MB (95%)

    V myvol                 State: up       Plexes:       1 Size:        512 MB
    V mirror                State: up       Plexes:       2 Size:        512 MB
    V striped               State: up       Plexes:       1 Size:        512 MB

    P myvol.p0            C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p0           C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p1           C State: initializing     Subdisks:     1 Size:        512 MB
    P striped.p1            State: up       Subdisks:     1 Size:        512 MB

    S myvol.p0.s0           State: up       PO:        0  B Size:        512 MB
    S mirror.p0.s0          State: up       PO:        0  B Size:        512 MB
    S mirror.p1.s0          State: empty    PO:        0  B Size:        512 MB
    S striped.p0.s0         State: up       PO:        0  B Size:        128 MB
    S striped.p0.s1         State: up       PO:      512 kB Size:        128 MB
    S striped.p0.s2         State: up       PO:     1024 kB Size:        128 MB
    S striped.p0.s3         State: up       PO:     1536 kB Size:        128 MB
....

[[vinum-striped-vol]]
.Судалчлагдсан Vinum эзлэхүүн
image::vinum-striped-vol.png[]

Энэ эзлэхүүн нь <<vinum-striped-vol>> зурагт үзүүлэгдсэн байгаа. Судлуудын харанхуй байдал plex-ийн хаягийн талбар дахь байрлалыг илэрхийлнэ: хамгийн цайвар судлууд нь эхлээд байх бөгөөд хамгийн харанхуйнууд нь сүүлд байна.

=== Уян хатан чанар ба ажиллагаа

[[vinum-resilience]]Хангалттай тоног төхөөрөмжийн тусламжтайгаар стандарт UNIX(R) хуваалтуудтай харьцуулах юм бол нэмэгдсэн уян хатан чанар болон нэмэгдсэн ажиллагаа аль алиныг нь үзүүлдэг эзлэхүүнүүдийг бүтээх боломжтой юм. Нийтлэг тохиргооны файл иймэрхүү байж болох юм:

[.programlisting]
....

	volume raid10
      plex org striped 512k
        sd length 102480k drive a
        sd length 102480k drive b
        sd length 102480k drive c
        sd length 102480k drive d
        sd length 102480k drive e
      plex org striped 512k
        sd length 102480k drive c
        sd length 102480k drive d
        sd length 102480k drive e
        sd length 102480k drive a
        sd length 102480k drive b
....

Хоёр дахь plex-ийн дэд дискнүүд нь эхний plex дэхээс хоёр хөтчөөр ялгаатай: дамжуулалт хоёр хөтчөөр дамжин хийгдсэн ч гэсэн бичилтүүд адил дэд дискнүүд уруугаа хийгдэхгүй байхыг энэ нь баталгаажуулж өгдөг.

<<vinum-raid10-vol>> нь энэ эзлэхүүний бүтцийг илэрхийлж байна.

[[vinum-raid10-vol]]
.Толин тусгал хийгдсэн, судалчлагдсан Vinum эзлэхүүн
image::vinum-raid10-vol.png[]

[[vinum-object-naming]]
== Обьектийн нэрлэлт

Дээд дурдсаны дагуу Vinum нь анхдагч нэрсийг plex-үүд болон дэд дискнүүдэд өгдөг боловч тэдгээр нь дарагдан өөрчлөгдөж болох юм. Анхдагч нэрсийг дарж өөрчлөхийг зөвлөдөггүй: обьектуудыг дурын нэрээр солихыг зөвшөөрдөг VERITAS эзлэхүүн менежерээс харах юм бол энэ уян хатан чанар нь мэдэгдэхүйц давуу талыг авч ирдэггүй бөгөөд эндүүрэл үүсгэж болох юм.

Нэрс нь дурын хоосон биш тэмдэгтийг агуулж болох бөгөөд тэмдэгтүүдийг үсэг, тоо болон доогуур зураас байлгаж хязгаарлахыг зөвлөдөг. Эзлэхүүнүүд, plex-үүд болон дэд дискнүүд нь 64 тэмдэгт хүртэл урттай байж болох бөгөөд хөтчүүдийн нэрс 32 тэмдэгт хүртэл урттай байж болно.

Vinum обьектууд нь [.filename]#/dev/gvinum# шатлалд төхөөрөмжийн цэгүүдийг өгдөг. Дээр үзүүлсэн тохиргоо нь Vinum-ийг дараах төхөөрөмжийн цэгүүдийг үүсгэхэд хүргэнэ:

* Эзлэхүүн бүрийн төхөөрөмжийн оруулгууд. Эдгээр нь Vinum-ийн ашигладаг гол төхөөрөмжүүд юм. Тэгэхээр дээрх тохиргоо нь [.filename]#/dev/gvinum/myvol#, [.filename]#/dev/gvinum/mirror#, [.filename]#/dev/gvinum/striped#, [.filename]#/dev/gvinum/raid5# болон [.filename]#/dev/gvinum/raid10# төхөөрөмжүүдийг агуулах болно.
* Бүх эзлэхүүнүүд нь [.filename]#/dev/gvinum/# дотор шууд оруулгуудыг авна.
* Plex болон дэд диск бүрийн төхөөрөмжийн цэгүүдийг агуулдаг харгалзах [.filename]#/dev/gvinum/plex# болон [.filename]#/dev/gvinum/sd# сангууд.

Жишээ нь дараах тохиргооны файл байлаа гэж үзье:

[.programlisting]
....

	drive drive1 device /dev/sd1h
	drive drive2 device /dev/sd2h
	drive drive3 device /dev/sd3h
	drive drive4 device /dev/sd4h
    volume s64 setupstate
      plex org striped 64k
        sd length 100m drive drive1
        sd length 100m drive drive2
        sd length 100m drive drive3
        sd length 100m drive drive4
....

Энэ файлыг процесс хийсний дараа man:diskinfo[8] нь [.filename]#/dev/gvinum# файлд дараах бүтцийг үүсгэдэг:

[.programlisting]
....

	drwxr-xr-x  2 root  wheel       512 Apr 13 16:46 plex
	crwxr-xr--  1 root  wheel   91,   2 Apr 13 16:46 s64
	drwxr-xr-x  2 root  wheel       512 Apr 13 16:46 sd

    /dev/vinum/plex:
    total 0
    crwxr-xr--  1 root  wheel   25, 0x10000002 Apr 13 16:46 s64.p0

    /dev/vinum/sd:
    total 0
    crwxr-xr--  1 root  wheel   91, 0x20000002 Apr 13 16:46 s64.p0.s0
    crwxr-xr--  1 root  wheel   91, 0x20100002 Apr 13 16:46 s64.p0.s1
    crwxr-xr--  1 root  wheel   91, 0x20200002 Apr 13 16:46 s64.p0.s2
    crwxr-xr--  1 root  wheel   91, 0x20300002 Apr 13 16:46 s64.p0.s3
....

Plex-үүд болон дэд дискнүүд нь тусгайлсан нэрсийг хуваарилах ёсгүй гэж зөвлөдөг боловч Vinum хөтчүүд нь нэрлэгдсэн байх ёстой. Энэ нь хөтчийг өөр байрлал уруу зөөж автоматаар таньсан хэвээр байх боломжийг бүрдүүлдэг. Хөтчийн нэрс 32 тэмдэгт хүртэл урттай байж болно.

=== Файлын системүүд үүсгэх нь

Эзлэхүүнүүд нь нэг зүйлээс бусдаараа дискнүүдэд ижил юм шиг системд харагддаг. UNIX(R) хөтчүүдээс ялгаатай нь Vinum эзлэхүүнүүдийг хуваадаггүй, тиймээс хуваалтын хүснэгтийг агуулдаггүй. Энэ нь зарим нэг дискний хэрэгслүүдэд ялангуяа man:newfs[8]-д өөрчлөлт хийхийг шаарддаг. Урьд нь man:newfs[8] Vinum-ийн эзлэхүүний нэрийн сүүлийн үсгийг хуваалт таниулагч гэж тайлбарлахыг оролддог байсан байна. Жишээ нь дискний хөтөч [.filename]#/dev/ad0a# эсвэл [.filename]#/dev/da2h# гэсэн нэртэй байж болох юм. Эдгээр нэрс нь эхний (0) IDE диск дээрх эхний хуваалт ([.filename]#a#) болон гурав дахь (3) SCSI диск дэх найм дахь хуваалтыг ([.filename]#h#) илэрхийлдэг. Ялгаатай тал нь Vinum эзлэхүүн нь хуваалтын нэртэй ямар ч холбоогүй нэрээр магадгүй [.filename]#/dev/gvinum/concat# гэж нэрлэгдэж болох юм.

Энэ эзлэхүүн дээр файлын систем үүсгэхийн тулд man:newfs[8]-г ашиглана:

[source,shell]
....
# newfs /dev/gvinum/concat
....

[[vinum-config]]
== Vinum тохируулах нь

[.filename]#GENERIC# цөм Vinum-ийг агуулдаггүй. Vinum оруулсан тусгай цөм бүтээх боломжтой боловч ингэхийг зөвлөдөггүй. Vinum-ийг эхлүүлэх стандарт арга нь цөмийн модуль (kld) юм. Та бүр Vinum-д зориулж man:kldload[8]-г ч ашиглах хэрэггүй: man:diskinfo[8]-г эхлүүлэхэд энэ нь модуль ачаалагдсан эсэхийг шалгаад хэрэв үгүй бол түүнийг автоматаар ачаалдаг.

=== Эхлүүлэлт

Vinum нь тохиргооны мэдээллийг гол нь тохиргооны файлуудад байдаг яг тэр хэлбэрээр дискний зүсмэлүүд дээр хадгалдаг. Тохиргооны мэдээллийн баазаас унших үед Vinum тохиргооны файлуудад зөвшөөрөгдөөгүй хэд хэдэн түлхүүр үгнүүдийг таньдаг. Жишээ нь дискний тохиргоо дараах текстийг агуулж болох юм:

[.programlisting]
....
volume myvol state up
volume bigraid state down
plex name myvol.p0 state up org concat vol myvol
plex name myvol.p1 state up org concat vol myvol
plex name myvol.p2 state init org striped 512b vol myvol
plex name bigraid.p0 state initializing org raid5 512b vol bigraid
sd name myvol.p0.s0 drive a plex myvol.p0 state up len 1048576b driveoffset 265b plexoffset 0b
sd name myvol.p0.s1 drive b plex myvol.p0 state up len 1048576b driveoffset 265b plexoffset 1048576b
sd name myvol.p1.s0 drive c plex myvol.p1 state up len 1048576b driveoffset 265b plexoffset 0b
sd name myvol.p1.s1 drive d plex myvol.p1 state up len 1048576b driveoffset 265b plexoffset 1048576b
sd name myvol.p2.s0 drive a plex myvol.p2 state init len 524288b driveoffset 1048841b plexoffset 0b
sd name myvol.p2.s1 drive b plex myvol.p2 state init len 524288b driveoffset 1048841b plexoffset 524288b
sd name myvol.p2.s2 drive c plex myvol.p2 state init len 524288b driveoffset 1048841b plexoffset 1048576b
sd name myvol.p2.s3 drive d plex myvol.p2 state init len 524288b driveoffset 1048841b plexoffset 1572864b
sd name bigraid.p0.s0 drive a plex bigraid.p0 state initializing len 4194304b driveoff set 1573129b plexoffset 0b
sd name bigraid.p0.s1 drive b plex bigraid.p0 state initializing len 4194304b driveoff set 1573129b plexoffset 4194304b
sd name bigraid.p0.s2 drive c plex bigraid.p0 state initializing len 4194304b driveoff set 1573129b plexoffset 8388608b
sd name bigraid.p0.s3 drive d plex bigraid.p0 state initializing len 4194304b driveoff set 1573129b plexoffset 12582912b
sd name bigraid.p0.s4 drive e plex bigraid.p0 state initializing len 4194304b driveoff set 1573129b plexoffset 16777216b
....

Эндэх мэдээжийн ялгаанууд нь байрлалын тодорхой мэдээлэл болон нэрлэлт (тэдгээрийн хоёул бас зөвшөөрөгдсөн боловч хэрэглэгчид ашиглахыг хориглосон) болон түвшингүүд дэх мэдээлэл (хэрэглэгчид байдаггүй) байгаа явдал юм. Vinum нь тохиргооны мэдээлэл дэх хөтчүүдийн тухай мэдээллийг хадгалдаггүй: энэ нь Vinum шошготой хуваалтуудын хувьд тохируулагдсан дискний хөтчүүдийг скан хийн хөтчүүдийг олдог. Энэ нь тэдгээр хөтчүүдэд өөр төрлийн UNIX(R) хөтчийн ID өгсөн байсан ч Vinum-д хөтчүүдийг зөвөөр таних боломжийг олгодог.

[[vinum-rc-startup]]
==== Автомат эхлүүлэлт

_Gvinum_ нь man:loader.conf[5]-ийн тусламжтай цөмийн модуль ачаалагдсаны дараа автоматаар эхлүүлэгддэг боломжийг үргэлж агуулсан байна. _Gvinum_ модулийг ачаалалтын үед дуудахын тулд [.filename]#/boot/loader.conf# файлд `geom_vinum_load="YES"` мөрийг нэмэх хэрэгтэй.

`gvinum start` тушаалаар Vinum-ийг эхлүүлэхэд Vinum нь аль нэг Vinum хөтчөөс тохиргооны мэдээллийн баазыг уншдаг. Ердийн тохиолдолд хөтөч бүр тохиргооны мэдээллийн баазын адил хуулбарыг агуулдаг учир аль хөтөч уншигдах нь хамаагүй юм. Гэхдээ сүйрлийн дараа Vinum нь аль хөтөч хамгийн сүүлд шинэчлэгдсэнийг тодорхойлж тэр хөтчөөс тохиргоог унших ёстой. Дараа нь тэр хэрэв шаардлагатай бол хуучин хөтчүүдээс тохиргоог шинэчилдэг.

[[vinum-root]]
== Root файлын системийн хувьд Vinum-ийг ашиглах нь

Vinum ашиглан бүрэн толин тусгал хийгдсэн файлын системүүд бүхий машины хувьд root файлын системийг бас толин тусгал хийх нь зүйтэй. Ингэж тохируулах нь дурын файлын системийг толин тусгал хийхээс амаргүй юм, учир нь:

* root файлын систем нь ачаалах процессийн нэлээн эхэн үед бэлэн байж байх шаардлагатай учраас Vinum дэд бүтэц нь энэ үед аль хэдийн бэлэн болсон байх шаардлагатай.
* root файлын системийг агуулсан эзлэхүүн нь бас системийг эхлүүлэх код болон цөмийг агуулдаг бөгөөд цөм нь хост системийн эх хэрэгслүүд (өөрөөр хэлбэл PC ангиллын машинууд дээр BIOS) ашиглан уншигдах ёстой. Эдгээр хост системийн эх хэрэгслүүдэд Vinum-ийн талаар дэлгэрэнгүйг мэдүүлэх ихэвчлэн боломжгүй байдаг.

Дараах хэсгүүдэд "root эзлэхүүн" гэсэн ойлголт root файлын системийг агуулдаг Vinum эзлэхүүнийг тайлбарлахад голчлон ашиглагдана. Энэ эзлэхүүний хувьд `"root"` гэсэн нэрийг ашиглах нь зүйтэй санаа боловч энэ нь аль ч талаараа заавал шаардлагатай биш юм. Дараах хэсгүүд дэх бүх тушаалын жишээнүүд нь энэ нэрийг ашиглах болно.

=== root файлын системийн хувьд Vinum-ийг аль болох эрт эхлүүлэх нь

Ингэхийн тулд хэд хэдэн арга хэмжээнүүдийг авах хэрэгтэй:

* Vinum нь ачаалах үед цөмд бэлэн байх ёстой. Тиймээс <<vinum-rc-startup>>-д тайлбарласан Vinum-ийг автоматаар эхлүүлэх арга нь энэ асуудлыг шийдэхэд хэрэглэх боломжгүй бөгөөд `start_vinum` параметрийг дараах тохиргоог зохион байгуулсан тохиолдолд тохируулах ёсгүй. Эхний тохируулга нь Vinum-ийг статикаар цөмд эмхэтгэх тохируулга байх юм. Тэгэхээр энэ боломж нь үргэлж бэлэн байх боловч ихэнх тохиолдолд хүсмээр зүйл биш байдаг. [.filename]#/boot/loader# (crossref:boot[boot-loader,Гуравдугаар шат /boot/loader])-аар цөмийг эхлэхээс өмнө vinum цөмийн модулийг эрт ачаалахаар тохируулах өөр бас нэг тохируулга байдаг. Ингэхийн тулд дараах мөрийг:
+
[.programlisting]
....
geom_vinum_load="YES"
....
+ 
[.filename]#/boot/loader.conf# файл уруу оруулж хийж болно.

* _Gvinum_-ийн хувьд бүх эхлүүлэлт нь цөмийн модуль ачаалагдсаны дараа автоматаар хийгддэг учраас дээр тайлбарласан процедур байхад л хангалттай.

=== Vinum дээр тулгуурласан root эзлэхүүнийг эхлүүлэх кодонд хандах боломжтой болгох нь

Одоогийн FreeBSD эхлүүлэгч нь зөвхөн 7.5KB код байдаг бөгөөд энэ нь UFS файлын системээс файлуудыг ([.filename]#/boot/loader# зэрэг) уншдагаар хийгдсэн байдаг болохоор Vinum-ийн тохиргооны мэдээллийг боловсруулж эхлэх эзлэхүүний өөрийнх нь элементүүдийг таньж Vinum-ийн дотоод бүтцүүдийг түүнд мэдүүлэх нь илт боломжгүй юм. Тиймээс root файлын системийг агуулдаг стандарт `"a"` хуваалтын хуурамч үзэгдлээр эхлүүлэгч кодыг хангах зарим нэгэн заль мэх шаардлагатай байдаг.

Ингэхийн тулд root эзлэхүүний хувьд дараах шаардлагуудыг хангасан байх ёстой:

* root эзлэхүүн нь судал хийгдээгүй эсвэл RAID-5 хийгдээгүй байх ёстой.
* root эзлэхүүн нь нэг plex-ийн хувьд нэгээс илүү нийлүүлэгдсэн дэд дисктэй байх ёсгүй.

Тус бүрдээ root файлын системийн нэг хуулбарыг агуулсан олон plex байлгах боломжтой бөгөөд ингэх сонирхолтой байдгийг санаарай. Гэхдээ эхлүүлэгч процесс нь эдгээр хуулбаруудын зөвхөн нэгийг эхлүүлэгч болон бүх файлуудыг олохын тулд цөм root файлын системийг өөрийг нь холбох хүртэл хэрэглэдэг. Дараа нь харгалзах төхөөрөмжийг эхлүүлэх боломжтой болгохын тулд эдгээр plex-үүдийн доторх ганц дэд диск бүрт өөрсдийн `"a"` хуваалтын хуурамч үзэгдэл хэрэгтэй болдог. Эдгээр хуурсан `"a"` хуваалт бүр өөрийн төхөөрөмжийн дотор адил офсетэд байрлах нь root эзлэхүүний plex-үүдийг агуулдаг бусад төхөөрөмжүүдтэй харьцуулах юм бол заавал хэрэгтэй байдаггүй. Гэхдээ Vinum эзлэхүүнүүдийг толин тусгал хийгдсэн төхөөрөмжүүд нь тэгш хэмт байхаар эндүүрлээс хамгаалж үүсгэх нь магадгүй зүйтэй санаа байх юм.

Эдгээр `"a"` хуваалтуудыг root эзлэхүүний хэсгийг агуулсан төхөөрөмж бүрийн хувьд тохируулахын тулд доор дурдсаныг хийх хэрэгтэй:

[.procedure]
====

. Энэ төхөөрөмжийн root эзлэхүүний хэсэг болох дэд дискний байрлал (төхөөрөмжийн эхэн хэсгээс тодорхой офсетэд) болон хэмжээг дараах тушаалыг ашиглаж шалгах хэрэгтэй:
+
[source,shell]
....
# gvinum l -rv root
....
+ 
Vinum офсетүүд болон хэмжээнүүд нь байтаар хэмжигддэг болохыг санаарай. `bsdlabel` тушаалд хэрэглэгддэг блок дугааруудыг олж авахын тулд тэдгээр нь 512-т хуваагдах ёстой.
. Дараах тушаалыг:
+
[source,shell]
....
# bsdlabel -e devname
....
+ 
гэж root эзлэхүүнд оролцож байгаа төхөөрөмж бүрийн хувьд ажиллуулна. _devname_ нь зүсмэлийн хүснэгтгүй дискнүүдийн дискний нэр ([.filename]#da0# гэх зэрэг) эсвэл зүсмэлийн нэр ([.filename]#ad0s1# гэх зэрэг) байх ёстой.
+ 
Хэрэв төхөөрөмж дээр `"a"` хуваалт (Vinum-ийн өмнөх root файлын системийг агуулсан) байх юм бол энэ нь хандахад боломжтой хэвээр (зөвхөн энэ тохиолдолд) байхын тулд өөр нэрээр нэрлэгдэх шаардлагатай. Гэхдээ анхдагчаар системийг эхлүүлэхэд хэрэглэгдэхээ болих юм. Идэвхтэй хуваалтуудын (одоогоор холбогдсон root файлын систем зэрэг) нэрийг өөрчилж болохгүй, тийм болохоор үүнийг "Fixit" зөөвөрлөгчөөс эхлүүлэх үед эсвэл (толин тусгал хийгдсэн нөхцөлд) ачаалаагүй байгаа дискийг эхлээд удирдах хоёр алхамтай процессийн үед ажиллуулах ёстойг санаарай.
+ 
Дараа нь энэ төхөөрөмж дээрх Vinum хуваалтын офсет нь энэ төхөөрөмжийн харгалзах root эзлэхүүний дэд дискний офсетэд нэмэгдэх ёстой. Үр дүнд нь гарах утга нь шинэ `"a"` хуваалтын хувьд `"offset" буюу офсет` утга болно. Энэ хуваалтын хувьд `"size" буюу хэмжээ` утгыг дээрх тооцооллоос үгчлэн авч болно. `"fstype"` нь `4.2BSD` байх ёстой. `"fsize"`, `"bsize"`, болон `"cpg"` утгууд нь байгаа файлын системтэй таарахаар сонгогдсон байх хэрэгтэй, гэхдээ тэдгээр нь энэ сэдэвт бараг л чухал биш юм.
+ 
Ийм замаар шинэ `"a"` хуваалт нь энэ төхөөрөмж дээрх Vinum хуваалтыг дарж байгуулагдана. Хэрэв Vinum хуваалт нь `"vinum"` fstype-г ашиглан зөвөөр тэмдэглэгдсэн бол `bsdlabel` тушаал нь зөвхөн энэ даралтыг зөвшөөрөх болно.
. Ингээд боллоо! root эзлэхүүний нэг хуулбартай төхөөрөмж бүр дээр хуурсан `"a"` хуваалт одоо бий боллоо. Үр дүнг дараах тушаалтай төстэй тушаал ашиглан дахин шалгахыг зөвлөдөг:
+
[source,shell]
....
# fsck -n /dev/devnamea
....
====

Шинэ Vinum root эзлэхүүнийг тохируулах үед идэвхтэй байгаа root файлын системтэй таардаггүй учир хяналтын мэдээлэл агуулсан бүх файлууд нь Vinum эзлэхүүн дэх root файлын системд харьцангуй байх ёстойг санах хэрэгтэй. Тэгэхээр ялангуяа [.filename]#/etc/fstab# болон [.filename]#/boot/loader.conf# файлуудыг бодолцох хэрэгтэй юм.

Дараагийн дахин ачаалалтын дараа эхлүүлэгч нь шинэ Vinum дээр тулгуурласан root файлын системээс тохирох хяналтын мэдээллийг олж түүний дагуу ажиллах ёстой. Цөмийн эхлүүлэх процессийн төгсгөлд бүх төхөөрөмжүүд зарлагдсаны дараа энэ тохиргоог амжилттай болсныг харуулсан алдартай мэдэгдэл иймэрхүү байдлаар харуулагдана:

[source,shell]
....
Mounting root from ufs:/dev/gvinum/root
....

=== Vinum дээр тулгуурласан root тохиргооны жишээ

Vinum root эзлэхүүн тохируулагдсаны дараа `gvinum l -rv root` тушаалын үр дүн иймэрхүү харагдана:

[source,shell]
....
...
Subdisk root.p0.s0:
		Size:        125829120 bytes (120 MB)
		State: up
		Plex root.p0 at offset 0 (0  B)
		Drive disk0 (/dev/da0h) at offset 135680 (132 kB)

Subdisk root.p1.s0:
		Size:        125829120 bytes (120 MB)
		State: up
		Plex root.p1 at offset 0 (0  B)
		Drive disk1 (/dev/da1h) at offset 135680 (132 kB)

....

Тэмдэглэх ёстой утгууд нь офсетийн ([.filename]#/dev/da0h# хуваалтын хувьд харьцангуй байна) хувьд `135680` байна. Энэ нь `bsdlabel`-ийн ойлголтод 265 ширхэг 512 байт диск блок уруу хөрвүүлнэ. Үүнтэй адилаар энэ root эзлэхүүний хэмжээ нь 245760 512 байт блок юм. Энэ root эзлэхүүний хоёр дахь хуулбарыг агуулсан [.filename]#/dev/da1h# нь тэгш хэмтэй тохиргоотой байна.

Эдгээр төхөөрөмжийн хувьд bsdlabel нь иймэрхүү харагдана:

[source,shell]
....
...
8 partitions:
#        size   offset    fstype   [fsize bsize bps/cpg]
  a:   245760      281    4.2BSD     2048 16384     0   # (Cyl.    0*- 15*)
  c: 71771688        0    unused        0     0         # (Cyl.    0 - 4467*)
  h: 71771672       16     vinum                        # (Cyl.    0*- 4467*)
....

Хуурсан `"a"` хуваалтын `"size"` параметр нь дээр харуулсан утгатай таардаг бол харин `"offset"` параметр нь Vinum хуваалт `"h"` доторх офсет болон төхөөрөмж (эсвэл зүсмэл) дэх энэ хуваалтын офсетийн нийлбэр болохыг эндээс харж болно. Энэ нь <<vinum-root-panic>>-д тайлбарласан асуудлыг тойрон гарахад шаардлагатай ердийн тохиргоо юм. Мөн бүхэл `"a"` хуваалт нь энэ төхөөрөмжийн хувьд бүх л Vinum өгөгдлийг агуулан бүтнээрээ `"h"` дотор байхыг эндээс бас харж болно.

Дээрх жишээн дээр бүхэл төхөөрөмж нь Vinum-д зориулагдсан бөгөөд зөвхөн Vinum тохиргооны хэсэг болохоор зориулагдсан дискний шинэ тохиргоо учраас Vinum-аас өмнөх root хуваалтын үлдэгдэл байхгүй болохыг санах хэрэгтэй.

=== Алдааг олж засварлах нь

Хэрэв ямар нэгэн зүйл болохоо байвал энэ тохиолдолд сэргээх арга хэрэгтэй. Дараах жагсаалт нь тохиолддог цөөн хэдэн асуудлууд болон шийдлүүдийг харуулж байна.

==== Системийн эхлүүлэгч ачаалах боловч систем эхлэхгүй байх

Ямар нэг шалтгаанаар систем нь ачаалахгүй бол эхлүүлэгчийг 10 секундын анхааруулга дээр kbd:[space] товчлуур дарж тасалдуулж болно. Дуудагчийн хувьсагчуудыг (`vinum.autostart` зэрэг) `show` тушаал ашиглан шалгаж болох бөгөөд `set` эсвэл `unset` тушаалуудыг ашиглан тохируулж болно.

Хэрэв цөмийн Vinum модуль нь автоматаар дуудагддаг модулиудын жагсаалтад орж амжаагүй байх юм бол ердийн `load geom_vinum` тушаал туслана.

Бэлэн болсныхоо дараа ачаалах процессийг `boot -as` тушаалаар үргэлжлүүлж болно. `-as` тохируулгууд нь root файлын системийг холбохыг (`-a`) асуудаг бөгөөд ачаалах процессийг root файлын системийг зөвхөн унших эрхээр холбосон ганц-хэрэглэгчийн горимд (`-s`) зогсоохыг цөмөөс хүсдэг. Ийм замаар олон-plex эзлэхүүний зөвхөн нэг plex холбогдсон байхад plex-үүд хоорондын өгөгдлийн бүрэн бүтэн бус байдлын эрсдэл гардаггүй.

root файлын системийг холбохыг асуух мөрөн дээр зөв root файлын системтэй дурын төхөөрөмжийг оруулж болно. Хэрэв [.filename]#/etc/fstab# зөв тохируулагдсан бол анхдагч нь `ufs:/dev/gvinum/root` мөртэй төсөөтэй байх ёстой. Ердийн өөр нэг сонголт нь `ufs:da0d` зэрэг Vinum-аас өмнөх root файлын системийг агуулдаг таамаглал хуваалт байж болох юм. Энд жинхэнэдээ толин тусгал үүсгэгдсэн тохируулгаас болоод Vinum root төхөөрөмжийн дэд дискнүүд уруу заасан аль нэг хуулбар `"a"` хуваалтыг оруулсан бол болгоомжтой байх хэрэгтэй бөгөөд энэ нь толин тусгал хийгдсэн root төхөөрөмжийн зөвхөн нэгийг холбох болно. Хэрэв энэ файлын систем нь дараа нь унших бичих эрхтэйгээр холбогдох бол Vinum root эзлэхүүний бусад plex-(үүд)ийг арилгах шаардлагатай. Учир нь эдгээр plex-үүд нь бүрэн бүтэн бус өгөгдлийг зөөвөрлөх болно.

==== Зөвхөн анхдагч эхлүүлэгч дуудах

Хэрэв [.filename]#/boot/loader# дуудагдахгүй байгаа боловч анхдагч эхлүүлэгч дуудагдаж байвал (ачаалах процесс эхэлсний дараа дэлгэцийн зүүн багана дээр ганц зураас харагддаг) энэ үед анхдагч эхлүүлэгчийг тасалдуулах оролдлогыг kbd:[space] товчлуур ашиглан хийж болно. Энэ нь эхлүүлэгчийг хоёрдугаар алхам дээр зогсоох бөгөөд crossref:boot[boot-boot1,Нэгдүгээр шат /boot/boot1 болон Хоёрдугаар шат /boot/boot2]-с үзнэ үү. Энд `"a"`-с дээр шилжүүлэгдсэн өмнөх root файлын системийг агуулсан өөр хуваалтаас ачаалах оролдлого хийж болох юм.

[[vinum-root-panic]]
==== Юу ч ачаалахгүй болж эхлүүлэгч сүйрэх

Энэ тохиолдол нь хэрэв эхлүүлэгчийг Vinum суулгацаар устгасан бол тохиолддог. Харамсалтай нь одоогоор Vinum нь санамсаргүйгээр зөвхөн 4 KB хэмжээг чөлөөтэйгөөр өөрийн хуваалтын эхэнд өөрийн Vinum толгойн мэдээллийг бичиж эхлэхээсээ өмнө үлдээдэг. Гэхдээ нэгдүгээр алхам ба хоёрдугаар эхлүүлэгчид, тэдгээрийн хооронд суулгагдсан bsdlabel нь одоогоор 8 KB-г шаарддаг. Хэрэв Vinum хуваалт нь ачаалагдах боломжтой гэгдэж байгаа зүсмэл эсвэл диск дотор 0 офсетэд эхэлсэн бол Vinum нь эхлүүлэгчийг устгана.

Үүнтэй адилаар хэрэв дээрх тохиолдол сэргээгдсэн бол, жишээ нь "Fixit" зөөвөрлөгчөөс ачаалагдаж эхлүүлэгч нь crossref:boot[boot-boot1,Нэгдүгээр шат /boot/boot1 болон Хоёрдугаар шат /boot/boot2]-д тайлбарласны дагуу дахин суулгагдсан бол эхлүүлэгч нь Vinum толгойг устгах бөгөөд Vinum нь өөрийн диск(үүд)ийг дахиж олохгүй байх болно. Яг жинхэнэдээ Vinum-ийн тохиргооны өгөгдөл эсвэл Vinum-ийн эзлэхүүнүүд дэх өгөгдөл нь энэ үед устгагддаггүй бөгөөд бүх өгөгдлийг яг адилхан Vinum тохиргооны өгөгдлийг дахин оруулснаар сэрээх боломжтой боловч ийм тохиолдлыг засварлах нь их хэцүү байдаг. Vinum толгой болон системийн эхлүүлэгчийг давхцуулахгүй байлгахын тулд бүхэл Vinum хуваалтыг хамгийн багаар бодоход 4 KB-аар шилжүүлэх хэрэгтэй болно.

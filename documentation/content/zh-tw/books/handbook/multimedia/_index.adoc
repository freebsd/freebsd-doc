---
title: 章 7. 多媒體
part: 部 II. 一般作業
prev: books/handbook/desktop
next: books/handbook/kernelconfig
showBookMenu: true
weight: 10
path: "/books/handbook/multimedia/"
---

[[multimedia]]
= Multimedia
:doctype: book
:toc: macro
:toclevels: 1
:icons: font
:sectnums:
:sectnumlevels: 6
:sectnumoffset: 7
:partnums:
:source-highlighter: rouge
:experimental:
:images-path: books/handbook/multimedia/

ifdef::env-beastie[]
ifdef::backend-html5[]
:imagesdir: ../../../../images/{images-path}
endif::[]
ifndef::book[]
include::shared/authors.adoc[]
include::shared/mirrors.adoc[]
include::shared/releases.adoc[]
include::shared/attributes/attributes-{{% lang %}}.adoc[]
include::shared/{{% lang %}}/teams.adoc[]
include::shared/{{% lang %}}/mailing-lists.adoc[]
include::shared/{{% lang %}}/urls.adoc[]
toc::[]
endif::[]
ifdef::backend-pdf,backend-epub3[]
include::../../../../../shared/asciidoctor.adoc[]
endif::[]
endif::[]

ifndef::env-beastie[]
toc::[]
include::../../../../../shared/asciidoctor.adoc[]
endif::[]


[[multimedia-synopsis]]
== 概述

此章節提供了 FreeBSD 對於多媒體支援的概述。
多媒體應用程式和技術已成為現今電腦的不可或缺的部分，而 FreeBSD 提供了廣泛且可靠的多媒體硬體和軟體支援。
此章節涵蓋了各種多媒體元件，如音訊、視頻和影像處理。
同時也討論了各種媒體格式和編解碼器，以及用於多媒體創作和播放的工具和應用程式。
此外，該章節還介紹了多媒體系統的配置、故障排除和優化。
無論你是多媒體愛好者還是專業內容創作者，FreeBSD 都為多媒體工作提供了一個強大的平台。本章旨在幫助你充分利用 FreeBSD 的多媒體功能，提供有用的信息和實用的範例來幫助你入門。

[[sound-setup]]
== 設定音效卡

預設情況下，FreeBSD 會自動偵測系統所使用的音效卡。
FreeBSD 支援各式各樣的音效卡。
支援的音效卡清單可以參考 man:sound[4]。

[NOTE]
====
只有在 FreeBSD 未正確偵測到音效卡模組時，才需要載入音效卡模組。
====

如果不知道系統使用哪一塊音效卡或哪一個模組，可以執行下列指令載入 metadriver `snd_driver` ：

[source,shell]
....
# kldload snd_driver
....

另外，若要在開機時以模組方式載入驅動程式，請在 [.filename]#/boot/loader.conf# 中加入：

[.programlisting]
....
snd_driver_load="YES"
....

[[sound-testing]]
=== 測試音效

若要確認偵測到音效卡，可執行下列指令：

[source,shell]
....
% dmesg | grep pcm
....

輸出應與下列內容相似：

[.programlisting]
....
pcm0: <Conexant CX20561 (Hermosa) (Analog 2.0+HP/2.0)> at nid 26,22 and 24 on hdaa0
pcm1: <Conexant CX20561 (Hermosa) (Internal Analog Mic)> at nid 29 on hdaa0
....

也可以使用此指令檢查音效卡的狀態：

[source,shell]
....
# cat /dev/sndstat
....

輸出應與下列內容相似：

[.programlisting]
....
Installed devices:
pcm0: <Conexant CX20561 (Hermosa) (Analog 2.0+HP/2.0)> (play/rec) default
pcm1: <Conexant CX20561 (Hermosa) (Internal Analog Mic)> (rec)
....

如果沒有列出 `pcm` 裝置，請再次檢查是否載入了正確的裝置驅動程式。
如果一切順利，音效卡就可以在 FreeBSD 運作了。

man:beep[1] 可以用來產生一些聲音，確認音效卡正在運作：

[source,shell]
....
% beep
....

[[sound-mixer]]
=== 混音器

FreeBSD 在音效系統上建立了不同的方式來設定和顯示音效卡混音器的值：

.支援的混音器套件
[options="header", cols="1,1,1,1"]
|===
| Name | License | Package | Toolkit

| man:mixer[8]
| BSD-2
| Included in base system
| CLI

| dsbmixer
| BSD-2
| package:audio/dsbmixer[]
| Qt

| KDE Plasma audio widget
| GPL 2.0
| package:audio/plasma5-plasma-pa[]
| Qt

| mixertui
| BSD-2
| package:audio/mixertui[]
| TUI

|===

[[graphics-card-sound]]
=== 顯示卡音效

顯示卡通常會附帶內建的音效設備，有時可能無法確定哪一個被設定為預設設備。要確認這一點，可以執行 dmesg 命令，並查看 pcm 項目，以暸解系統如何列出輸出設備。執行以下指令：

[source,shell]
....
% dmesg | grep pcm
....

輸出應與下列內容相似：

[.programlisting]
....
pcm0: <HDA NVIDIA (Unknown) PCM #0 DisplayPort> at cad 0 nid 1 on hdac0
pcm1: <HDA NVIDIA (Unknown) PCM #0 DisplayPort> at cad 1 nid 1 on hdac0
pcm2: <HDA NVIDIA (Unknown) PCM #0 DisplayPort> at cad 2 nid 1 on hdac0
pcm3: <HDA NVIDIA (Unknown) PCM #0 DisplayPort> at cad 3 nid 1 on hdac0
hdac1: HDA Codec #2: Realtek ALC889
pcm4: <HDA Realtek ALC889 PCM #0 Analog> at cad 2 nid 1 on hdac1
pcm5: <HDA Realtek ALC889 PCM #1 Analog> at cad 2 nid 1 on hdac1
pcm6: <HDA Realtek ALC889 PCM #2 Digital> at cad 2 nid 1 on hdac1
pcm7: <HDA Realtek ALC889 PCM #3 Digital> at cad 2 nid 1 on hdac1
....

顯示卡（NVIDIA(R)）已在音效卡（Realtek(R)）之前列出，音效卡顯示為「pcm4」。
您可以執行下列指令，將系統設定為以音效卡為預設裝置：

[source,shell]
....
# sysctl hw.snd.default_unit=4
....

若要將此變更永久化，請在 [.filename]#/etc/sysctl.conf# 中加入：

[.programlisting]
....
hw.snd.default_unit=4
....

[[automatically-switching-headphones]]
=== 自動切換至耳機
有些系統在切換音訊輸出時可能會很麻煩，幸好 FreeBSD 允許在 [.filename]#device.hints# 中設定自動切換。

藉由執行下列指令來辨識系統如何列出音訊輸出：

[source,shell]
....
% dmesg | grep pcm
....

輸出應與下列內容相似：

[.programlisting]
....
pcm0: <Realtek ALC892 Analog> at nid 23 and 26 on hdaa0
pcm1: <Realtek ALC892 Right Analog Headphones> at nid 22 on hdaa0
....

在 [.filename]#/boot/device.hints# 中加入以下幾行：

[.programlisting]
....
hint.hdac.0.cad0.nid22.config="as=1 seq=15 device=Headphones" 
hint.hdac.0.cad0.nid26.config="as=2 seq=0 device=speakers"
....

[NOTE]
====
請記住，這些訊息是針對上述範例而言。
它們可能會因系統而異。
====

[[troubleshooting-sound]]
=== 音效疑難排解

一些常見的錯誤訊息及其解決方案：

[[multimedia-sound-common-error-messages]]
.常見錯誤訊息
[cols="1,1", frame="none", options="header"]
|===
| Error
| Solution

|`xxx: can't open /dev/dsp!`
|輸入 `fstat \| grep dsp` 來檢查是否有其他應用程式佔用了該設備。需要注意的潛在問題來源包括 esound 和 KDE 的音效支援。
|===

使用 package:audio/pulseaudio[] 的程式可能需要重新啟動 package:audio/pulseaudio[] 的常駐程式，才能讓 `hw.snd.default_unit` 中的變更生效。 
另外，package:audio/pulseaudio[] 的設定也可以即時變更。
man:pacmd[1] 會開啟與 package:audio/pulseaudio[] 常駐程式的命令列連線：

[source,shell]
....
# pacmd
Welcome to PulseAudio 14.2! Use "help" for usage information.
>>>
....

以下指令將預設的音效輸出設備更改為編號 4 的卡片，如前面的範例所示

[.programlisting]
....
set-default-sink 4
....

[WARNING]
====
請勿使用 `exit` 指令離開指令列介面。這會終止 package:audio/pulseaudio[] 的常駐程式。請改用 kbd:[Ctrl+D]。
====

[[audio-ports]]
== 音訊播放器

本節將介紹 FreeBSD Ports Collection 中一些可用於音訊播放的軟體。

.音訊播放器套件
[options="header", cols="1,1,1,1"]
|===
| Name | License | Package | Toolkit

| Elisa
| LGPL 3.0
| package:audio/elisa[]
| Qt

| GNOME Music
| GPL 2.0
| package:audio/gnome-music[]
| GTK+

| Audacious
| BSD-2
| package:multimedia/audacious[]
| Qt

| MOC (music on console)
| GPL 2.0
| package:audio/moc[]
| TUI

|===

[[elisa]]
=== Elisa

Elisa 是 KDE 社群開發的音樂播放器，力求簡單好用。

要安裝 Elisa，請執行

[source,shell]
....
# pkg install elisa
....

[[gnome-music]]
=== GNOME Music

GNOME Music 是全新的 GNOME 音樂播放應用程式。
它的目標是結合沈浸式的體驗與簡潔明瞭的控制。

要安裝 GNOME 音樂，請執行

[source,shell]
....
# pkg install gnome-music
....

[[audacious]]
=== Audacious

Audacious 是一款開放原始碼的音訊播放器。
Audacious 是 XMMS 的後代，它能以你想要的方式播放音樂，而不會從其他任務中搶走電腦資源。

要安裝 Audacious，請執行

[source,shell]
....
# pkg install audacious-qt6 audacious-plugins-qt6
....

[NOTE]
====
Audacious 原生支援 OSS，但必須在 Audio tab 中設定。
====

[[moc-music-on-console]]
=== MOC (music on console)


MOC（Music on Console）是一款設計為功能強大且易於使用的控制台音頻播放器。

MOC 可以在不受系統或 I/O 負載影響的情況下平穩播放，因為它在單獨的線程中處理輸出緩衝區。
播放文件之間不會出現間隙，因為在播放當前文件的同時，下一個文件已經預先緩存好。

若要安裝 MOC (控制台音樂)，請執行：

[source,shell]
....
# pkg install moc
....

[[video-ports]]
== 影片播放器

本節將介紹 FreeBSD Ports Collection 中一些可用於播放影片的軟體。

.影片播放器套件
[options="header", cols="1,1,1,1"]
|===
| Name | License | Package | Toolkit

| MPlayer
| GPL 2.0
| package:multimedia/mplayer[]
| CLI

| SMPlayer
| GPL 2.0
| package:multimedia/smplayer[]
| Qt

| VLC media player
| GPL 2.0
| package:multimedia/vlc[]
| Qt

| Kodi (XBMC) 
| GPL 2.0
| package:multimedia/kodi[]
| X11

|===

[[mplayer]]
=== MPlayer

MPlayer 是多媒體播放器和編碼套件，可在多種平台上執行，並可在命令列上運作。
它可播放大量不同的檔案格式和編解碼器，包括流行的 DivX、XviD、H.264 串流、DVD 和 SVCD，以及許多常見的音訊編解碼器。

要安裝 MPlayer，請執行：

[source,shell]
....
# pkg install mplayer
....

有關 MPlayer 如何運作的範例，請參閱 man:mplayer[1]。

[[smplayer]]
=== SMPlayer

SMPlayer 是 MPlayer 的完整前端，提供從播放影片、DVD 和 VCD 等基本功能到支持 MPlayer 過濾器等更高級功能。

要安裝 SMPlayer，請執行：

[source,shell]
....
# pkg install smplayer
....

[[vlc]]
=== VLC media player

VLC 媒體播放器是一款高度便攜的多媒體播放器，支持各種音訊和影片格式（如 MPEG-1、MPEG-2、MPEG-4、DivX、mp3、ogg 等）以及 DVD、VCD 和各種串流協議。
它也可以作為伺服器，在高頻寬網路中以 IPv4 或 IPv6 單播或多播方式串流
VLC 也具備即時轉碼功能，可以用於即時串流媒體或將其保存到磁碟中。

要安裝 VLC，請執行：

[source,shell]
....
# pkg install vlc
....

[[kodi]]
=== Kodi (XBMC)

Kodi (以前稱為 XBMC) 是免費的開放原始碼跨平台媒體播放器和娛樂中心。
它允許使用者從本機、網路儲存媒體和網際網路播放和觀看大部分影片、音樂、podcast 和其他數位媒體檔案。

若要安裝 Kodi，請執行：

[source,shell]
....
# pkg install kodi
....

[[conferencing-meetings]]
== 視訊會議

FreeBSD 桌面環境可以用來加入視訊會議。
本章節將介紹如何設定網路攝影機，以及 FreeBSD 支援哪些視訊會議應用程式。

[[webcam-setup]]
=== 設定網路攝影機

為了允許 FreeBSD 存取網路攝影機並執行其設定，必須安裝某些工具：

* package:multimedia/webcamd[] 是一個 常駐程式，可以使用數百種不同的 USB 網路攝影機和 DVB USB 裝置。
* package:multimedia/pwcview[] 是一個應用程式，可用於觀看網路攝影機的串流影片。

若要安裝所需的程式，請執行

[source,shell]
....
# pkg install webcamd pwcview
....

在 `/etc/rc.conf` 中啟用 man:webcamd[8] 服務，以便在系統啟動時啟動它：

[source,shell]
....
# sysrc webcamd_enable="YES"
....

該使用者必須屬於 `webcamd` 群組。
要將使用者加入 `webcamd` 群組，請執行下列指令：

[source,shell]
....
# pw groupmod webcamd -m username
....

由於 package:multimedia/webcamd[] 需要 man:cuse[3] 模組，因此必須執行下列指令才能載入此模組：

[source,shell]
....
# kldload cuse
....

若要在系統啟動時載入 man:cuse[3]，請執行指令：

[source,shell]
....
# sysrc kld_list += "cuse"
....

一旦安裝完該程式後，可用的網路攝影機可以用 man:webcamd[8] 列出：

[source,shell]
....
# webcamd -l
....

輸出應與下列內容相似：

[.programlisting]
....
webcamd [-d ugen0.2] -N SunplusIT-Inc-HP-TrueVision-HD-Camera -S unknown -M 0 <.>
webcamd [-d ugen1.3] -N Realtek-802-11n-WLAN-Adapter -S 00e04c000001 -M 0
....
<.> 可用的網路攝影機

執行下列指令設定可用的網路攝影機：

[source,shell]
....
# sysrc webcamd_0_flags="-d ugen0.2" <.>
....

[NOTE]
====
請注意，如果這是隨插即用的 USB 網路攝影機，變更 USB 連接埠就會改變 `webcamd -l` 的輸出，而且 rc.conf 中的項目可能需要更新。
對於使用 USB 整合式網路攝影機的筆記型電腦，這應該不是問題。
====

必須執行下列指令來啟動 man:webcamd[8] 服務：

[source,shell]
....
# service webcamd start
....

輸出應與下列內容相似：

[.programlisting]
....
Starting webcamd.
webcamd 1616 - - Attached to ugen0.2[0]
....

package:multimedia/pwcview[] 可用於檢查網路攝影機是否正常運作。
下列指令可用於執行 package:multimedia/pwcview[]：

[source,shell]
....
% pwcview -f 30 -s vga
....

然後 package:multimedia/pwcview[] 就會顯示網路攝影機：

image::pwcview.png[pwcview showing Absolute FreeBSD 3rd edition as an example]

[[meetings-software-status]]
=== 會議軟體

FreeBSD 目前支援下列用於執行視訊會議的工具。

.會議軟體
[options="header", cols="1,1,1,1"]
|===
| Name | Firefox status | Chromium status | Website

| Microsoft Teams
| Does not work
| Works
| link:https://teams.live.com[]

| Google Meet
| Does not work
| Works
| link:https://meet.google.com/[]

| Zoom
| Works
| Works
| link:https://zoom.us[]

| Jitsi
| Does not work
| Works
| link:https://meet.jit.si/[]

| BigBlueButton
| Does not work
| Works
| link:https://bigbluebutton.org/[]

|===

[[scanners]]
== 影像掃描器

在 FreeBSD 中， 存取影像掃描器是由 link:http://www.sane-project.org[SANE (Scanner Access Now Easy)]提供的， 它可以在 FreeBSD Ports Collection 中找到。

[[scanners-kernel-usb]]
=== 檢查掃瞄器

在嘗試任何設定之前，請務必檢查掃瞄器是否被 SANE 支援。

連接掃瞄器後，執行下列指令以取得所有已連接的 USB 裝置：

[source,shell]
....
# usbconfig list
....

輸出應與下列內容相似：

[.programlisting]
....
ugen4.2: <LITE-ON Technology USB NetVista Full Width Keyboard.> at usbus4, cfg=0 md=HOST spd=LOW (1.5Mbps) pwr=ON (70mA)
ugen4.3: <Logitech USB Optical Mouse> at usbus4, cfg=0 md=HOST spd=LOW (1.5Mbps) pwr=ON (100mA)
ugen3.2: <HP Deskjet 1050 J410 series> at usbus3, cfg=0 md=HOST spd=HIGH (480Mbps) pwr=ON (2mA)
....

執行下列指令以取得 `idVendor` 和 `idProduct` ：

[source,shell]
....
# usbconfig -d 3.2 dump_device_desc
....

[NOTE]
====
請注意，掃瞄器是隨插即用的裝置，變更連接的 USB 連接埠將改變來自 `usbconfig list` 的輸出。
====

輸出應與下列內容相似：

[.programlisting]
....
ugen3.2: <HP Deskjet 1050 J410 series> at usbus3, cfg=0 md=HOST spd=HIGH (480Mbps) pwr=ON (2mA)

bLength = 0x0012
bDescriptorType = 0x0001
bcdUSB = 0x0200
bDeviceClass = 0x0000  <Probed by interface class>
bDeviceSubClass = 0x0000
bDeviceProtocol = 0x0000
bMaxPacketSize0 = 0x0040
idVendor = 0x03f0
idProduct = 0x8911
bcdDevice = 0x0100
iManufacturer = 0x0001  <HP>
iProduct = 0x0002  <Deskjet 1050 J410 series>
bNumConfigurations = 0x0001
....

一旦取得 `idVendor` 和 `idProduct` 之後，就必須在 link:http://www.sane-project.org/lists/sane-mfgs-cvs.html[SANE支援的裝置清單] 中，透過idProduct過濾，檢查掃瞄器是否被支援。

[[_sane_configuration]]
=== SANE Configuration

SANE 透過後端提供掃描器的存取。
若要使用 FreeBSD 掃描，必須執行下列指令來安裝 package:graphics/sane-backends[] 套件：

[source,shell]
....
# pkg install sane-backends
....

[TIP]
====
有些 USB 掃瞄器需要載入韌體。
就像上面範例中使用的 HP 掃瞄器，需要安裝 package:print/hplip[] 套件。
====

安裝必要的套件之後 man:devd[8] 必須設定為允許 FreeBSD 存取掃描器。

在 [.filename]#/usr/local/etc/devd/saned.conf# 中加入 `saned.conf` 檔案，內容如下：

[.programlisting]
....
notify 100 {
        match "system" "USB";
        match "subsystem" "INTERFACE";
        match "type" "ATTACH";
        match "cdev" "ugen[0-9].[0-9]";
        match "vendor" "0x03f0"; <.>
        match "product" "0x8911"; <.>
        action "chown -L cups:saned /dev/\$cdev && chmod -L 660 /dev/\$cdev";
};
....

<.> `vendor`: 是之前執行 `usbconfig -d 3.2 dump_device_desc` 指令取得的 idVendor。
<.> `product`: 是之前透過執行 `usbconfig -d 3.2 dump_device_desc` 指令取得的 idProduct。

之後，必須執行下列指令重新啟動 man:devd[8]：

[source,shell]
....
# service devd restart
....

SANE 後端包含 man:scanimage[1]，可用來列出裝置並執行影像擷取。

使用 `-L` 參數執行 man:scanimage[1]，以列出掃瞄器裝置：

[source,shell]
....
# scanimage -L
....

輸出應與下列內容相似：

[.programlisting]
....
device `hpaio:/usb/Deskjet_1050_J410_series?serial=XXXXXXXXXXXXXX' is a Hewlett-Packard Deskjet_1050_J410_series all-in-one
....

如果 man:scanimage[1] 無法識別掃瞄器，則會顯示此訊息：

[.programlisting]
....
No scanners were identified. If you were expecting something different,
check that the scanner is plugged in, turned on and detected by the
sane-find-scanner tool (if appropriate). Please read the documentation
which came with this software (README, FAQ, manpages).
....

一旦 man:scanimage[1] 看到掃瞄器，設定就完成了，可以立即使用掃瞄器。

若要啟動服務並讓它在開機時執行，請執行下列指令：

[source,shell]
....
# sysrc saned_enable="YES"
....

雖然 man:scanimage[1] 可以在命令列執行影像擷取，但最好還是使用圖形介面來執行影像掃描。

.圖形掃描器程式
[options="header", cols="1,1,1"]
|===
| Name | License | Package

| skanlite
| GPL 2.0
| graphics/skanlite

| GNOME Simple Scan
| GPL 3.0
| graphics/simple-scan

| XSANE
| GPL 2.0
| graphics/xsane

|===

<!--
     The FreeBSD Documentation Project
     The FreeBSD French Documentation Project

     $FreeBSD$
     Original revision: 1.97
-->

<chapter id="mail">
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Bill</firstname>
	<surname>Lloyd</surname>
	<contrib>Contribution originale de </contrib>
      </author>
    </authorgroup>
    <authorgroup>
      <author>
	<firstname>Jim</firstname>
	<surname>Mock</surname>
	<contrib>R&eacute;&eacute;crit par </contrib>
	<!-- 2 Dec 1999 -->
      </author>
    </authorgroup>
  </chapterinfo>

  <title>Courrier &eacute;lectronique</title>
  &trans.a.fonvieille;

  <sect1 id="mail-synopsis">
    <title>Synopsis</title>
    <indexterm><primary>email</primary></indexterm>
    <indexterm><primary>courrier &eacute;lectronique</primary></indexterm>

    <para>Le &ldquo;courrier &eacute;lectronique&rdquo;, plus connu sous le nom d'email,
      est une des formes de communication les plus utilis&eacute;es
      aujourd'hui.  Ce chapitre fournit une introduction sur comment
      faire fonctionner un serveur de courrier &eacute;lectronique sous
      FreeBSD.  Cependant, cela n'est pas un document de
      r&eacute;f&eacute;rence, en fait de nombreux
      &eacute;l&eacute;ments importants ont &eacute;t&eacute; omis.
      Pour une couverture plus compl&egrave;te du sujet, le lecteur doit
      se r&eacute;f&eacute;rer aux nombreux ouvrages excellents
      list&eacute;s dans la <xref linkend="bibliography">.</para>

    <para>Apr&egrave;s la lecture de ce chapitre, vous
      conna&icirc;trez:</para>
    <itemizedlist>
      <listitem><para>Quels composants logiciel sont impliqu&eacute;s dans
	l'envoi et la r&eacute;ception du courrier &eacute;lectronique.</para>
      </listitem>
      <listitem><para>O&ugrave; se trouvent sous FreeBSD les fichiers
	de configuration de base de
	<application>sendmail</application>.</para>
      </listitem>
      <listitem><para>Comment emp&ecirc;cher les personnes &agrave;
	l'origine de courriers non sollicit&eacute;s (spam) d'utiliser
	votre serveur de courrier comme relais.</para>
      </listitem>
      <listitem><para>Comment installer et configurer un agent de
	transfert de courrier alternatif sur votre syst&egrave;me,
	en remplacement de <application>sendmail</application>.</para>
      </listitem>
      <listitem><para>Comment d&eacute;panner les probl&egrave;mes
	courants des serveurs de courrier
	&eacute;lectronique.</para></listitem>
      <listitem>
	<para>Comment utiliser le protocole SMTP avec UUCP.</para>
      </listitem>
      <listitem>
	<para>Comment utiliser le courrier &eacute;lectronique avec
	  une connexion temporaire.</para>
      </listitem>
      <listitem>
	<para>Comment configurer l'authentification SMTP pour une
	  s&eacute;curit&eacute; accrue.</para>
      </listitem>
    </itemizedlist>

    <para>Avant de lire ce chapitre, vous devrez:</para>

    <itemizedlist>
      <listitem><para>Configurer correctement votre connexion r&eacute;seau
	(<xref linkend="advanced-networking">).</para>
      </listitem>
      <listitem><para>Configurer correctement les informations DNS
	pour votre serveur de courrier (<xref
	linkend="advanced-networking">).</para>
      </listitem>
      <listitem><para>Savoir comment installer des logiciels tiers
	(<xref linkend="ports">).</para></listitem>
    </itemizedlist>
  </sect1>

  <sect1 id="mail-using">
    <title>Utilisation du courrier &eacute;lectronique</title>
    <indexterm><primary>POP</primary></indexterm>
    <indexterm><primary>IMAP</primary></indexterm>
    <indexterm><primary>DNS</primary></indexterm>

    <para>Il y a cinq &eacute;l&eacute;ments majeurs impliqu&eacute;s
      dans un &eacute;change de courrier.  Ce sont:
      <link linkend="mail-mua">le programme utilisateur</link>,
      <link linkend="mail-mta">le &ldquo;daemon&rdquo; serveur de
      courrier</link>, <link linkend="mail-dns">le serveur DNS</link>,
      <link linkend="mail-receive">un serveur POP ou IMAP</link>, et
      bien s&ucirc;r le <link linkend="mail-host">le serveur
      de courrier lui-m&ecirc;me </link>.</para>

    <sect2 id="mail-mua">
      <title>Le programme utilisateur</title>

      <para>Cela inclut des programmes en ligne de commande comme
	<application>mutt</application>, <application>pine</application>,
	<application>elm</application>, et
	<application>mail</application>, et des programmes graphiques
	comme <application>balsa</application>,
	<application>xfmail</application> pour juste en nommer
	quelques-uns, ou quelque chose de plus
	<quote>sophisticated</quote> comme un navigateur WWW.  Ces
	programmes transmettent simplement toutes les transactions
	concernant le courrier &eacute;lectronique au <link
	linkend="mail-host">serveur de courrier local</link>, soit en
	invoquant un des <link
	linkend="mail-mta">&ldquo;daemons&rdquo; serveurs</link>
	(Agents de transfert de courrier) disponibles, soit via
	TCP.</para>
    </sect2>

    <sect2 id="mail-mta">
      <title>Le &ldquo;daemon&rdquo; serveur de courrier</title>
      <indexterm>
        <primary>daemons serveurs de courrier</primary>
        <secondary><application>sendmail</application></secondary>
      </indexterm>
      <indexterm>
        <primary>daemons serveurs de courrier</primary>
        <secondary><application>postfix</application></secondary>
      </indexterm>
      <indexterm>
        <primary>daemons serveurs de courrier</primary>
        <secondary><application>qmail</application></secondary>
      </indexterm>
      <indexterm>
        <primary>daemons serveurs de courrier</primary>
        <secondary><application>exim</application></secondary>
      </indexterm>

      <para>C'est g&eacute;n&eacute;ralement <application>sendmail</application>
	(par d&eacute;faut sous FreeBSD) ou un des autres
	&ldquo;daemons&rdquo; serveurs de courrier comme
	<application>qmail</application>,
	<application>postfix</application>, ou
	<application>exim</application>.  Il y en a d'autres, mais ces
	derniers sont les plus largement utilis&eacute;s.</para>

      <para>Le serveur a g&eacute;n&eacute;ralement deux
	fonctions&mdash;recevoir et
	envoyer du courrier.  Il ne vous permet pas de vous y
	connecter par l'interm&eacute;diaire de POP ou IMAP pour lire votre
	courrier.  Vous avez besoin d'un <link
	linkend="mail-receive">&ldquo;daemon&rdquo;</link>
	suppl&eacute;mentaire pour cela.</para>

      <para>Soyez conscient que certaines vieilles versions de
	<application>sendmail</application> ont de s&eacute;rieux
	probl&egrave;mes de s&eacute;curit&eacute;, cependant tant que vous
	utilisez une version actuelle vous ne devriez pas avoir de
	probl&egrave;me.  Comme toujours, c'est une bonne id&eacute;e de
	maintenir &agrave; jour les logiciels que vous utilisez.</para>
    </sect2>

    <sect2 id="mail-dns">
      <title>Courrier &eacute;lectronique et DNS</title>

      <para>Le syst&egrave;me de noms de domaines (DNS) et son
	&ldquo;daemon&rdquo; <command>named</command> jouent un r&ocirc;le
	important dans la transmission du courrier &eacute;lectronique.
	Afin de d&eacute;livrer du courrier de votre site &agrave; un autre,
	le serveur recherchera le site dans la base de donn&eacute;es DNS
	pour d&eacute;terminer la machine de destination qui recevra le
	courrier.</para>

      <para>Cela fonctionne de la m&ecirc;me mani&egrave;re
	lorsque l'on vous envoie du courrier.  Le DNS contient la base
	de donn&eacute;es qui fait correspondre nom de machine et adresse IP,
	et nom de machine et serveur de courrier.  L'adresse IP est
	d&eacute;finie par un enregistrement A.  L'enregistrement MX (Mail
	eXchanger) d&eacute;finit le serveur qui recevra votre courrier.
	Si vous n'avez pas d'enregistrement MX associ&eacute; &agrave; votre
	machine, le courrier sera d&eacute;livr&eacute; directement &agrave;
	votre machine.</para>
    </sect2>

    <sect2 id="mail-receive">
      <title>R&eacute;ception de courrier</title>
      <indexterm>
        <primary>courrier &eacute;lectronique</primary>
        <secondary>r&eacute;ception</secondary>
      </indexterm>

      <para>La r&eacute;ception du courrier pour votre domaine se fait par le
	serveur de courrier.  Il collectera le courrier qui vous est
	envoy&eacute; et le stockera pour lecture ou r&eacute;cup&eacute;ration.
	Afin de r&eacute;cup&eacute;rer le courrier stock&eacute;, vous devez
	vous connecter au serveur de courrier.  Cela se fait soit en
	utilisant POP soit IMAP.  Si vous voulez lire directement le
	courrier sur le serveur de courrier, alors un serveur POP ou
	IMAP n'est pas n&eacute;cessaire.</para>

      <indexterm><primary>POP</primary></indexterm>
      <indexterm><primary>IMAP</primary></indexterm>
      <para>Si vous voulez faire tourner un serveur POP ou IMAP, vous
	devez faire deux choses:</para>

      <procedure>
        <step>
	  <para>R&eacute;cup&eacute;rez un &ldquo;daemon&rdquo; POP ou
	    IMAP depuis le <ulink url="../../../../ports/mail.html">catalogue
	    des logiciels port&eacute;s</ulink> et installez-le sur
	    votre syst&egrave;me.</para>
	</step>

	<step>
	  <para>Modifiez <filename>/etc/inetd.conf</filename> pour charger
	    le serveur POP ou IMAP.</para>
	</step>
      </procedure>
    </sect2>

    <sect2 id="mail-host">
      <title>Le serveur de courrier</title>
      <indexterm><primary>serveur de courrier</primary></indexterm>

      <para>Le serveur de courrier est le nom donn&eacute; au
	serveur qui est responsable de la transmission et la
	r&eacute;ception du courrier pour votre machine, et
	probablement votre r&eacute;seau.</para>
    </sect2>
  </sect1>

  <sect1 id="sendmail">
    <sect1info>
      <authorgroup>
        <author>
          <firstname>Christopher</firstname>
          <surname>Shumway</surname>
          <contrib>Contribution de </contrib>
        </author>
      </authorgroup>
    </sect1info>
    <title>Configuration de <application>sendmail</application></title>

    <indexterm>
      <primary><application>sendmail</application></primary>
    </indexterm>

    <para>&man.sendmail.8; est l'agent de transfert de courrier (Mail
      Transfert Agent - MTA) par d&eacute;faut sous FreeBSD.  Le r&ocirc;le
      de <application>sendmail</application> est d'accepter le
      courrier en provenance des agents de courrier utilisateur (Mail
      User Agents - MUA) et de d&eacute;livrer le courrier aux programmes de
      gestion du courrier d&eacute;finis dans son fichier de configuration.
      <application>sendmail</application> peut &eacute;galement accepter
      les connexions r&eacute;seau et d&eacute;livrer le courrier dans des
      bo&icirc;tes aux lettres locales ou le transmettre &agrave; un autre
      programme.</para>

    <para><application>sendmail</application> utilise les fichiers de
      configuration suivants:</para>

    <indexterm>
      <primary><filename>/etc/mail/access</filename></primary>
    </indexterm>
    <indexterm>
      <primary><filename>/etc/mail/aliases</filename></primary>
    </indexterm>
    <indexterm>
      <primary><filename>/etc/mail/local-host-names</filename></primary>
    </indexterm>
    <indexterm>
      <primary><filename>/etc/mail/mailer.conf</filename></primary>
    </indexterm>
    <indexterm>
      <primary><filename>/etc/mail/mailertable</filename></primary>
    </indexterm>
    <indexterm>
      <primary><filename>/etc/mail/sendmail.cf</filename></primary>
    </indexterm>
    <indexterm>
      <primary><filename>/etc/mail/virtusertable</filename></primary>
    </indexterm>
    <informaltable>
      <tgroup cols="2">
	<thead>
	  <row>
	    <entry>Fichier</entry>
	    <entry>Fonction</entry>
	  </row>
	</thead>
	<tbody>
	  <row>
	    <entry>
	      <filename>/etc/mail/access</filename>
	    </entry>
	    <entry>Fichier de la base de donn&eacute;es d'acc&egrave;s
	      de <application>sendmail</application></entry>
	  </row>
	  <row>
	    <entry>
	      <filename>/etc/mail/aliases</filename>
	    </entry>
	    <entry>Alias de bo&icirc;te aux lettres</entry>
	  </row>
	  <row>
	    <entry>
	      <filename>/etc/mail/local-host-names</filename>
	    </entry>
	    <entry>Liste des machines pour lesquelles
	      <application>sendmail</application> accepte du
	      courrier</entry>
	  </row>
	  <row>
	    <entry>
	      <filename>/etc/mail/mailer.conf</filename>
	    </entry>
	    <entry>Configuration du programme de gestion du
	      courrier</entry>
	  </row>
	  <row>
	    <entry>
	      <filename>/etc/mail/mailertable</filename>
	    </entry>
	    <entry>Table de livraison du courrier</entry>
	  </row>
	  <row>
	    <entry>
	      <filename>/etc/mail/sendmail.cf</filename>
	    </entry>
	    <entry>Fichier de configuration principal
	      de <application>sendmail</application></entry>
	  </row>
	  <row>
	    <entry>
	      <filename>/etc/mail/virtusertable</filename>
	    </entry>
	    <entry>Table des domaines et utilisateurs virtuels</entry>
	  </row>
	</tbody>
      </tgroup>
    </informaltable>

  <sect2>
    <title><filename>/etc/mail/access</filename></title>

    <para>La base de donn&eacute;es d'acc&egrave;s d&eacute;finit
      quelle(s) machine(s) ou adresses IP ont acc&egrave;s au serveur de
      courrier local et quel type d'acc&egrave;s ils ont.
      Les machines peuvent &ecirc;tre list&eacute;es avec <option>OK</option>,
      <option>REJECT</option>, <option>RELAY</option> ou simplement
      transf&eacute;r&eacute;es &agrave; la routine de gestion des erreurs
      <application>sendmail</application> avec une erreur donn&eacute;e.
      Les machines qui sont list&eacute;es avec <option>OK</option>, qui est le
      comportement par d&eacute;faut, sont autoris&eacute;es &agrave; envoyer du
      courrier &agrave; cette machinee d&egrave;s que la destination finale
      du courrier est la machine locale.  Les machines list&eacute;es avec
      <option>REJECT</option> se verront rejeter pour toute connexion
      au serveur.  Les machines pr&eacute;sentes avec l'option
      <option>RELAY</option> sont autoris&eacute;es &agrave; envoyer du
      courrier &agrave; n'importe quelle destination par
      l'interm&eacute;diaire de ce serveur de courrier.</para>

      <example>
	<title>Configuration de la base de donn&eacute;es d'acc&egrave;s
	de <application>sendmail</application>

    <programlisting>cyberspammer.com                550 We don't accept mail from spammers
FREE.STEALTH.MAILER@            550 We don't accept mail from spammers
another.source.of.spam          REJECT
okay.cyberspammer.com           OK
128.32                          RELAY</programlisting>
      </example>

   <para>Dans cet exemple nous avons cinq entr&eacute;es.
     Les &eacute;metteurs de courrier qui correspondent &agrave; la partie
     gauche de la table sont affect&eacute;s par l'action donn&eacute;e
     sur la partie droite de la table.  Les deux premiers
     exemples donnent un code d'erreur &agrave; la routine de gestion
     d'erreur de <application>sendmail</application>.
     Le message est affich&eacute; sur la machine distante quand un courrier
     &eacute;lectronique correspond &agrave; la partie gauche de la table.
     L'entr&eacute;e suivante rejette le courrier en provenance
     d'une machine pr&eacute;cise de l'Internet,
     <hostid>another.source.of.spam</hostid>.  L'entr&eacute;e suivante
     accepte les connexions &agrave; partir de la machine
     <hostid role="fqdn">okay.cyberspammer.com</hostid>, qui est plus pr&eacute;cis
     que le <hostid role="domainname">cyberspammer.com</hostid> de la ligne
     pr&eacute;c&eacute;dente.  Les correspondances plus sp&eacute;cifiques
     priment sur les moins pr&eacute;cises.  La derni&egrave;re
     entr&eacute;e autorise le relais du courrier &eacute;lectronique en
     provenance de machines avec une adresse IP qui commence par
     <hostid>128.32</hostid>.  Ces machines seront en mesure
     d'envoyer du courrier destin&eacute; &agrave; d'autres
     serveurs de courrier par l'interm&eacute;diaire de ce serveur de
     courrier.</para>

   <para>Quand ce fichier est mis &agrave; jour, vous devez ex&eacute;cuter
     la commande <command>make</command> dans
     <filename>/etc/mail/</filename> pour mettre &agrave; jour la base
     de donn&eacute;es.</para>

  </sect2>
  <sect2>
    <title><filename>/etc/mail/aliases</filename></title>

    <para>La base de donn&eacute;es d'alias contient une liste
      de bo&icirc;tes aux lettres virtuelles dont le contenu sera transmis
      &agrave; d'autres utilisateurs, fichiers, programmes ou d'autres
      alias.  Voici quelques exemples qui peuvent &ecirc;tre
      utilis&eacute;s dans <filename>/etc/mail/aliases</filename>:</para>

      <example>
	<title>Exemple de base de donn&eacute;es d'alias</title>
    <programlisting>root: localuser
ftp-bugs: joe,eric,paul
bit.bucket:  /dev/null
procmail: "|/usr/local/bin/procmail"</programlisting>
      </example>

    <para>Le format du fichier est simple; le nom de la bo&icirc;te
      aux lettres &agrave; gauche et la cible sur la droite.
      Le premier exemple transf&egrave;re la bo&icirc;te aux lettres
      <username>root</username> vers la bo&icirc;te aux lettres
      <username>localuser</username>, qui est ensuite recherch&eacute;e
      dans la base de donn&eacute;es d'alias.  Si aucune correspondance n'est
      trouv&eacute;e alors le message est d&eacute;livr&eacute; &agrave;
      l'utilisateur locale
      <username>localuser</username>.  L'exemple suivant montre une
      liste de correspondance.  Un courrier envoy&eacute; &agrave; la
      bo&icirc;te aux lettres <username>ftp-bugs</username> sera
      d&eacute;livr&eacute; aux trois boites locales <username>joe</username>,
      <username>eric</username>, et <username>paul</username>.  Notez
      qu'une bo&icirc;te aux lettres distante comme <literal>user@exemple.com</literal>/procmail
      pourra
      &ecirc;tre sp&eacute;cifi&eacute;e.  L'exemple suivant montre comment
      transf&eacute;rer le courrier dans un fichier, dans notre cas
      <filename>/dev/null</filename>.  Le dernier exemple montre
      l'envoi du courrier &agrave; un programme, dans le cas pr&eacute;sent
      le message est &eacute;crit sur l'entr&eacute;e standard de
      <filename>/usr/local/bin/procmail</filename> par
      l'interm&eacute;diaire d'un tube &unix;.</para>

    <para>Quand ce fichier est mis &agrave; jour, vous devez
      ex&eacute;cuter la commande <command>make</command> dans
      <filename>/etc/mail/</filename> pour mettre &agrave; jour
      la base de donn&eacute;es.</para>
  </sect2>
  <sect2>
    <title><filename>/etc/mail/local-host-names</filename></title>

    <para>C'est la liste des machines pour lesquelles &man.sendmail.8;
      accepte du courrier comme s'il &eacute;tait destin&eacute;
      &agrave; la machine locale.
      Placez-y tous les domaines ou machines pour lesquels
      <application>sendmail</application> doit recevoir du courrier.
      Par exemple, si le serveur de courrier devait accepter du
      courrier pour le domaine <hostid
      role="domainname">exemple.com</hostid> et la machine
      <hostid role="domainname">mail.exemple.com</hostid>, sont
      <filename>local-host-names</filename> ressemblera &agrave; quelque
      chose comme ceci:</para>

    <programlisting>exemple.com
mail.exemple.com</programlisting>

    <para>Quand ce fichier est mis &agrave; jour, &man.sendmail.8; doit
      &ecirc;tre relanc&eacute; pour lire les changements.</para>

  </sect2>

  <sect2>
    <title><filename>/etc/mail/sendmail.cf</filename></title>

    <para>Fichier principal de configuration de
      <application>sendmail</application>,
      <filename>sendmail.cf</filename> contr&ocirc;le le comportement
      g&eacute;n&eacute;ral de <application>sendmail</application>,
      y compris tout depuis la r&eacute;&eacute;criture des adresses
      de courrier jusqu'&agrave; l'envoi de message de rejet aux
      serveurs de courrier distants.  Naturellement, avec tant de
      diff&eacute;rentes activit&eacute;s, ce fichier de configuration
      est relativement complexe et son &eacute;tude d&eacute;taill&eacute;e
      n'est pas le but de cette section.  Heureusement, ce fichier a
      rarement besoin d'&ecirc;tre modifi&eacute; pour les serveurs de courrier
      standards.</para>

    <para>Le fichier de configuration principal de
      <application>sendmail</application> peut &ecirc;tre
      cr&eacute;&eacute; &agrave; partir de macros &man.m4.1; qui
      d&eacute;finissent les fonctions
      et le comportement de <application>sendmail</application>.
      Veuillez consulter
      <filename>/usr/src/contrib/sendmail/cf/README</filename> pour
      plus de d&eacute;tails.</para>

    <para>Quand des modifications &agrave; ce fichier sont apport&eacute;es,
      <application>sendmail</application> doit &ecirc;tre
      red&eacute;marr&eacute; pour que les changements prennent effet.</para>

  </sect2>
  <sect2>
    <title><filename>/etc/mail/virtusertable</filename></title>

    <para>La table <filename>virtusertable</filename> fait
      correspondre les adresses de courrier &eacute;lectronique pour des
      domaines virtuels et les bo&icirc;tes aux lettres avec des
      bo&icirc;tes aux lettres r&eacute;elles.  Ces bo&icirc;tes aux lettres
      peuvent &ecirc;tre locales, distantes, des alias d&eacute;finis dans
      <filename>/etc/mail/aliases</filename> ou des fichiers.</para>

    <example>
      <title>Exemple de correspondance de domaine virtuel de
	courrier</title>

    <programlisting>root@exemple.com                root
postmaster@exemple.com          postmaster@noc.exemple.net
@exemple.com                    joe</programlisting>
      </example>

    <para>Dans l'exemple ci-dessus, nous avons une correspondance pour
      un domaine <hostid role="domainname">exemple.com</hostid>.  Ce fichier est trait&eacute;
      jusqu'&agrave; trouver la premi&egrave;re correspondance.
      Le premier &eacute;l&eacute;ment fait correspondre <literal>root@exemple.com</literal>
      &agrave; la bo&icirc;te aux lettres root locale.  L'entr&eacute;e
      suivante fait correspondre <literal>postmaster@exemple.com</literal> &agrave; la
      bo&icirc;te aux lettres postmaster sur la machine <hostid role="fqdn">noc.exemple.net</hostid>.
      Et enfin, si un courrier en provenance de <hostid role="domainname">exemple.com</hostid> n'a pas
      trouv&eacute; de correspondance, il correspondra &agrave; la
      derni&egrave;re ligne, qui regira tous les autres messages
      adress&eacute;s &agrave;
      quelqu'un du domaine <hostid role="domainname">exemple.com</hostid>.
      La correspondance sera la bo&icirc;te aux lettres locale
      <username>joe</username>.</para>

  </sect2>
  </sect1>

  <sect1 id="mail-changingmta">
    <sect1info>
      <authorgroup>
        <author>
          <firstname>Andrew</firstname>
          <surname>Boothman</surname>
          <contrib>Ecrit par </contrib>
        </author>
      </authorgroup>
      <authorgroup>
        <author>
          <firstname>Gregory</firstname>
          <surname>Neil Shapiro</surname>
          <contrib>Information provenant de courriers &eacute;lectroniques
	    &eacute;crit par </contrib>
        </author>
      </authorgroup>
    </sect1info>
    <title>Changer votre agent de transfert de courrier</title>
    <indexterm>
      <primary>courrier &eacute;lectronique</primary>
      <secondary>changer d'agent de transfert de courrier</secondary>
    </indexterm>

    <para>Comme mentionn&eacute; pr&eacute;c&eacute;demment,
      FreeBSD est fournit avec <application>sendmail</application>
      comme agent de transfert du courrier (MTA - Mail Transfert
      Agent).  Il est donc par d&eacute;faut
      en charge de votre courrier sortant et entrant.</para>

    <para>Cependant, pour une vari&eacute;t&eacute; de raison,
      certains administrateurs syst&egrave;me d&eacute;sirent
      changer le MTA de leur syst&egrave;me.  Ces raisons vont de la
      simple envie d'essayer un autre agent au besoin d'une fonction
      ou ensemble sp&eacute;cifique qui d&eacute;pend d'un autre gestionnaire de
      courrier.  Heureusement, quelle qu'en soit la raison, FreeBSD
      rend le changement ais&eacute;.</para>

    <sect2>
      <title>Installer un nouveau MTA</title>

      <para>Vous avez un vaste choix d'agent disponible.  Un bon
	point de d&eacute;part est le <link linkend="ports">catalogue des
	logiciels port&eacute;s de FreeBSD</link> o&ugrave; vous pourrez
	en trouver un grand nombre.
	Bien &eacute;videmment vous &ecirc;tes libres
	d'utiliser n'importe quel agent de n'importe quelle origine,
	d&egrave;s que vous pouvez le faire fonctionner sous FreeBSD.</para>

      <para>Commencez par installer votre nouvel agent.  Une fois ce
	dernier install&eacute;, il vous donne une chance de d&eacute;cider s'il
	remplit vraiment vos besoins, et vous donne l'opportunit&eacute;
	de configurer votre nouveau logiciel avant de remplacer
	<application>sendmail</application>.  Quand vous faites cela,
	vous devez &ecirc;tre s&ucirc;r que l'installation du nouveau
	logiciel ne tentera pas de remplacer des binaires du syst&egrave;me
	comme <filename>/usr/bin/sendmail</filename>.  Sinon, votre
	nouveau logiciel sera mis en service avant d'avoir pu
	le configurer.</para>

      <para>Veuillez vous r&eacute;f&eacute;rer &agrave; la documentation de l'agent choisi
	pour de l'information sur comment configurer le logiciel que
	vous avez choisi.</para>
    </sect2>

    <sect2>
      <title>D&eacute;sactiver <application>sendmail</application></title>

      <para>La proc&eacute;dure utilis&eacute;e pour lancer
	<application>sendmail</application> a chang&eacute; de fa&ccedil;on
	significative entre la 4.5-RELEASE et la 4.6-RELEASE.
	Par cons&eacute;quent, la proc&eacute;dure utilis&eacute;e pour
	la d&eacute;sactiver est l&eacute;g&egrave;rement
	diff&eacute;rente.</para>

      <sect3>
	<title>FreeBSD 4.5-STABLE d'avant le 2002/4/4 et plus ancienne
	  (y compris 4.5-RELEASE et pr&eacute;c&eacute;dentes)</title>

	<para>Ajoutez:</para>

	  <programlisting>sendmail_enable="NO"</programlisting>

	  <para>dans <filename>/etc/rc.conf</filename>.  Cela
	    d&eacute;sactivera le service de courrier entrant de
	    <application>sendmail</application> mais si
	    <filename>/etc/mail/mailer.conf</filename> (voir plus bas)
	    n'est pas modifi&eacute;, <application>sendmail</application>
	    sera toujours utilis&eacute; pour envoyer du courrier
	    &eacute;lectronique.</para>
      </sect3>

      <sect3>
	<title>FreeBSD 4.5-STABLE d'apr&egrave;s le 2002/4/4
	  (y compris 4.6-RELEASE et suivantes)</title>

	<para>Afin de compl&egrave;tement d&eacute;sactiver
	  <application>sendmail</application> vous devez utiliser</para>

	  <programlisting>sendmail_enable="NONE"</programlisting>

	  <para>dans <filename>/etc/rc.conf.</filename></para>

	<warning>
	  <para>Si vous d&eacute;sactivez le service d'envoi de courrier de
	    <application>sendmail</application> de cette mani&egrave;re, il
	    est important que vous le remplaciez par un syst&egrave;me de
	    courrier alternatif fonctionnant parfaitement.  Si vous
	    choisissez de ne pas le faire, des fonctions du syst&egrave;me
	    comme &man.periodic.8; ne seront pas en mesure de d&eacute;livrer
	    leur r&eacute;sultat par courrier &eacute;lectronique comme elles
	    s'attendent normalement &agrave; le faire.  De nombreux
	    composants de votre syst&egrave;me s'attendent &agrave;
	    avoir un syst&egrave;me
	    compatible &agrave; <application>sendmail</application> en
	    fonctionnement.  Si des applications continuent &agrave; utiliser
	    les binaires de <application>sendmail</application> pour
	    essayer d'envoyer du courrier &eacute;lectronique apr&egrave;s la
	    d&eacute;sactivation, le courrier pourra aller dans une file
	    d'attente inactive, et pourra n'&ecirc;tre jamais
	    livr&eacute;.</para>
	</warning>

	<para>Si vous voulez uniquement d&eacute;sactiver le service de
	  r&eacute;ception de courrier de <application>sendmail</application>
	  vous devriez fixer</para>

	  <programlisting>sendmail_enable="NO"</programlisting>

	<para>dans <filename>/etc/rc.conf</filename>.  Plus
	  d'information sur les options de d&eacute;marrage de
	  <application>sendmail</application> est disponible &agrave; partir
	  de la page de manuel de &man.rc.sendmail.8;.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Lancement de votre nouvel agent au d&eacute;marrage</title>

      <para>Vous pourrez avoir le choix entre deux m&eacute;thodes pour
	lancer votre nouvel agent au d&eacute;marrage, encore une fois en
	fonction de la version de FreeBSD dont vous disposez.</para>

      <sect3>
	<title>FreeBSD 4.5-STABLE d'avant le 2002/4/11
	  (y compris 4.5-RELEASE et pr&eacute;c&eacute;dentes)</title>

	<para>Ajouter une proc&eacute;dure dans
	  <filename>/usr/local/etc/rc.d/</filename> qui
	  se termine en <filename>.sh</filename> et qui est
	  ex&eacute;cutable par <username>root</username>.  La
	  proc&eacute;dure devrait accepter les param&egrave;tres
	  <literal>start</literal> et <literal>stop</literal>.
	  Au moment du d&eacute;marrage les proc&eacute;dures
	  syst&egrave;me ex&eacute;cuteront la commande</para>

	<programlisting>/usr/local/etc/rc.d/supermailer.sh start</programlisting>

	<para>que vous pouvez &eacute;galement utiliser pour d&eacute;marrer le
	  serveur.  Au moment de l'arr&ecirc;t du syst&egrave;me, les
	  proc&eacute;dures syst&egrave;me utiliseront l'option
	  <literal>stop</literal> en ex&eacute;cutant la commande</para>

	<programlisting>/usr/local/etc/rc.d/supermailer.sh stop</programlisting>

	<para>que vous pouvez &eacute;galement utiliser manuellement pour
	  arr&ecirc;ter le serveur quand le syst&egrave;me est en
	  fonctionnement.</para>

      </sect3>

      <sect3>
	<title>FreeBSD 4.5-STABLE d'apr&egrave;s le 2002/4/11
	  (y compris 4.6-RELEASE et suivantes)</title>

	<para>Avec les versions suivantes de FreeBSD, vous pouvez
	  utiliser la m&eacute;thode ci-dessus ou fixer</para>

	<programlisting>mta_start_script="nomfichier"</programlisting>

	<para>dans <filename>/etc/rc.conf</filename>, o&ugrave;
	  <replaceable>nomfichier</replaceable> est le nom
	  d'une proc&eacute;dure que vous voulez ex&eacute;cuter
	  au d&eacute;marrage pour lancer votre agent.</para>
      </sect3>

    </sect2>

    <sect2>
      <title>Remplacer <application>sendmail</application> comme
	gestionnaire du courrier du syst&egrave;me par
	d&eacute;faut</title>

      <para>Le programme <application>sendmail</application> est tellement
	omnipr&eacute;sent comme logiciel standard sur les
	syst&egrave;mes &unix; que certains programmes supposent qu'il est tout
	simplement d&eacute;j&agrave; install&eacute; et configur&eacute;.
	Pour cette raison, de nombreux agents alternatifs fournissent
	leur propre impl&eacute;mentation compatible avec l'interface en
	ligne de commande de <application>sendmail</application>;
	cela facilite leur utilisation comme rempla&ccedil;ant pour
	<application>sendmail</application>.</para>

      <para>Donc, si vous utilisez un programme alternatif, vous
	devrez v&eacute;rifier que le logiciel essayant d'ex&eacute;cuter
	les binaires standards de <application>sendmail</application>
	comme <filename>/usr/bin/sendmail</filename> ex&eacute;cute
	r&eacute;ellement l'agent que vous avez choisi &agrave; la place.
	Heureusement, FreeBSD fournit un syst&egrave;me appel&eacute;
	&man.mailwrapper.8; qui remplit ce travail pour vous.</para>

      <para>Quand <application>sendmail</application> fonctionne tel
	qu'il a &eacute;t&eacute; install&eacute;, vous
	trouverez quelque chose comme ce qui suit dans
	<filename>/etc/mail/mailer.conf</filename>:</para>

<programlisting>sendmail	 /usr/libexec/sendmail/sendmail
send-mail	/usr/libexec/sendmail/sendmail
mailq		/usr/libexec/sendmail/sendmail
newaliases	/usr/libexec/sendmail/sendmail
hoststat	/usr/libexec/sendmail/sendmail
purgestat	/usr/libexec/sendmail/sendmail</programlisting>

      <para>Cela signifie que lorsque l'une des commandes courantes
	(comme <filename>sendmail</filename> lui-m&ecirc;me) est
	lanc&eacute;e, le syst&egrave;me invoque en fait une copie de
	&ldquo;mailwrapper&rdquo; appel&eacute;e
	<filename>sendmail</filename>, qui lit
	<filename>mailer.conf</filename> et
	ex&eacute;cute <filename>/usr/libexec/sendmail/sendmail</filename>
	&agrave; la place.  Ce syst&egrave;me rend ais&eacute; le changement
	des binaires qui sont r&eacute;ellement ex&eacute;cut&eacute;s
	quand les fonctions de <filename>sendmail</filename> par
	d&eacute;faut sont invoqu&eacute;es.</para>

      <para>Donc si vous avez voulu que
	<filename>/usr/local/supermailer/bin/sendmail-compat</filename>
	soit lanc&eacute; en place de <application>sendmail</application>,
	vous pourrez modifier <filename>/etc/mail/mailer.conf</filename>
	de cette fa&ccedil;on:</para>

<programlisting>sendmail	 /usr/local/supermailer/bin/sendmail-compat
send-mail	/usr/local/supermailer/bin/sendmail-compat
mailq		/usr/local/supermailer/bin/mailq-compat
newaliases	/usr/local/supermailer/bin/newaliases-compat
hoststat	/usr/local/supermailer/bin/hoststat-compat
purgestat	/usr/local/supermailer/bin/purgestat-compat</programlisting>

      </sect2>

      <sect2>
	<title>Pour en terminer</title>

	<para>Une fois que vous avez tout configur&eacute; de la fa&ccedil;on
	  dont vous le d&eacute;sirez, vous devriez soit tuer les processus de
	  <application>sendmail</application> dont vous n'avez plus
	  besoin et lancer les processus appartenant &agrave; votre
	  nouveau logiciel, ou tout simplement red&eacute;marrer.  Le
	  red&eacute;marrage vous donnera l'opportunit&eacute; de vous assurer
	  que vous avez correctement configur&eacute; votre syst&egrave;me
	  pour le lancement automatique de votre nouvel agent au
	  d&eacute;marrage.</para>

      </sect2>
    </sect1>

  <sect1 id="mail-trouble">
    <title>D&eacute;pannage</title>
    <indexterm>
      <primary>courrier &eacute;lectronique</primary>
      <secondary>d&eacute;pannage</secondary>
    </indexterm>

    <qandaset>
      <qandaentry>
        <question>
	<para>Pourquoi faut-il que j'utilise le FQDN (&ldquo;Fully
	  Qualified Domain Name&rdquo; - nom complet de machine) pour
	  les machines de mon site?</para>
	</question>

	<answer>
	<para>Vous vous rendrez probablement compte que la machine est
	  en fait dans un domaine diff&eacute;rent; par exemple, si vous
	  &ecirc;tes dans le domaine <hostid role="fqdn">foo.bar.edu</hostid>
	  et que vous voulez atteindre la machine <hostid>mumble</hostid>
	  du domaine <hostid role="domainname">bar.edu</hostid>,
	  vous devrez utiliser son nom de machine complet,
	  <hostid role="fqdn">mumble.bar.edu</hostid>, au lieu de
	  juste <hostid>mumble</hostid>.</para>

	<indexterm><primary>BIND</primary></indexterm>
	<para>C'&eacute;tait traditionnellement autoris&eacute; par les
	  r&eacute;solveurs <application>BIND</application> BSD.
	  N&eacute;anmoins, la version de <application>BIND</application>
	  qui est maintenant livr&eacute;e avec FreeBSD ne sait pas
	  compl&eacute;ter les noms de machines abr&eacute;g&eacute;s autrement
	  qu'avec le nom de votre domaine.  Donc le nom non
	  qualifi&eacute; <hostid>mumble</hostid> doit correspondre
	  &agrave; <hostid role="fqdn">mumble.foo.bar.edu</hostid>,
	  sans quoi il sera recherch&eacute; dans le domaine racine.</para>

	<para>Cela diff&egrave;re du comportement pr&eacute;c&eacute;dent,
	  o&ugrave; la recherche se prolongeait &agrave;
	  <hostid role="domainname">mumble.bar.edu</hostid>, puis
	  <hostid role="domainname">mumble.edu</hostid>.
	  Consultez la RFC 1535 pour savoir pourquoi cela &eacute;tait
	  consid&eacute;r&eacute; comme une mauvaise pratique, voire
	  m&ecirc;me un trou de s&eacute;curit&eacute;.</para>

	<para>Comme solution, vous pouvez mettre la ligne:

	  <programlisting>search foo.bar.edu bar.edu</programlisting>

	  &agrave; la place de:

	  <programlisting>domain foo.bar.edu</programlisting>

	  dans votre fichier <filename>/etc/resolv.conf</filename>.
	  Cependant, assurez-vous que la recherche ne franchit pas la
	  &ldquo;limite entre l'administration locale et
	  publique&rdquo;, selon l'expression de la RFC 1535.</para>
	</answer>
      </qandaentry>

      <qandaentry>
	<question>
	<para><application>sendmail</application> affiche le message
	  <errorname>mail loops back to myself</errorname></para>
	</question>

	<answer>
	<para>La r&eacute;ponse donn&eacute;e dans la FAQ de
	  <application>sendmail</application> est la suivante:</para>

        <programlisting>J'ai des messages &ldquo;Local configuration
	  error&rdquo;, du style:

553 relay.domain.net config error: mail loops back to myself
554 &lt;user@domain.net&gt;... Local configuration error

Comment puis-je r&eacute;soudre ce probl&egrave;me?

Vous avez demand&eacute; que le courrier pour un domaine (e.g., domain.net)
soit transmis &agrave; une machine donn&eacute;e (dans ce cas pr&eacute;cis, relay.domain.net)
en utilisant un enregistrement MX, mais la machine relais ne se
conna&icirc;t pas elle-m&ecirc;me comme domain.net.  Ajoutez domain.net &agrave;
/etc/mail/local-host-names (si vous utilisez FEATURE(use_cw_file))
ou ajoutez &ldquo;Cw domain.net&rdquo; &agrave;
/etc/mail/sendmail.cf.</programlisting>

        <para>La FAQ de <application>sendmail</application> peut &ecirc;tre trouv&eacute;e
	  &agrave; l'adresse <ulink url="http://www.sendmail.org/faq/"></ulink> et
	  sa lecture est recommand&eacute;e si vous voulez
	  &ldquo;bidouiller&rdquo; votre configuration du courrier
	  &eacute;lectronique.</para>
	</answer>
      </qandaentry>

      <indexterm><primary>PPP</primary></indexterm>
      <qandaentry>
        <question>
	<para>Comment puis-je faire tourner un serveur de courrier
	  &eacute;lectronique avec une connexion
	  t&eacute;l&eacute;phonique PPP</para>
	</question>

	<answer>
	<para>Vous voulez connecter une machine FreeBSD du r&eacute;seau
	  local &agrave; l'Internet.  Cette machine servira de passerelle de
	  courrier &eacute;lectronique pour le r&eacute;seau local.
	  La connexion PPP n'est pas d&eacute;di&eacute;e.</para>

	<indexterm><primary>UUCP</primary></indexterm>

	<para>Il y a au moins deux fa&ccedil;on de faire.  L'une d'elle
	  est d'utiliser UUCP.</para>

	<para>L'autre m&eacute;thode &eacute;tant d'obtenir un serveur Internet
	  constamment connect&eacute; pour qu'il vous fournisse les services
	  MX pour votre domaine.  Par exemple, si le domaine de votre
	  compagnie est <hostid role="domainname">exemple.com</hostid> et votre
	  fournisseur d'acc&egrave;s a configur&eacute;
	  <hostid role="domainname">exemple.net</hostid> pour fournir un MX secondaire
	  pour votre domaine:</para>

	<programlisting>exemple.com.            MX        10      exemple.com.
                      MX        20      exemple.net.</programlisting>

	<para>Une seule machine devrait &ecirc;tre
	  sp&eacute;cifi&eacute;e comme destinataire final (ajoutez
	  <literal>Cw exemple.com</literal> au fichier
	  <filename>/etc/mail/sendmail.cf</filename> de
	  <hostid role="domainname">exemple.com</hostid>).</para>

	<para>Quand le <command>sendmail</command> exp&eacute;diteur tente
	  de vous d&eacute;livrer du courrier, il essaiera de se connecter
	  &agrave; votre serveur (<hostid role="domainname">exemple.com</hostid>)
	  via votre liaison par modem.  Ce qui &eacute;chouera tr&egrave;s
	  probablement par d&eacute;passement de d&eacute;lai puisque
	  vous n'&ecirc;tes pas en ligne.  Le programme
	  <application>sendmail</application> enverra automatiquement
	  le courrier au site MX secondaire, i.e. votre fournisseur
	  d'acc&egrave;s (<hostid role="domainname">exemple.net</hostid>).
	  Le site MX secondaire essayera p&eacute;riodiquement de se
	  connecter &agrave; votre machine pour exp&eacute;dier le
	  courrier au site MX primaire (<hostid
	  role="domainname">exemple.com</hostid>).</para>

	<para>Vous pourrez vouloir utiliser quelque chose comme ceci
	  comme proc&eacute;dure de connexion:</para>

	<programlisting>#!/bin/sh
# Mettez-moi dans /usr/local/bin/pppmyisp
( sleep 60 ; /usr/sbin/sendmail -q ) &amp;
/usr/sbin/ppp -direct pppmyisp</programlisting>

	<para>Si vous avez l'intention de d&eacute;finir une
	  proc&eacute;dure de connexion particuli&egrave;re pour un
	  utilisateur, vous pourrez utiliser
	  <command>sendmail -qRexemple.com</command> &agrave; la place
	  de la proc&eacute;dure ci-dessus.  Cela forcera le traitement
	  imm&eacute;diat de tout le courrier dans votre file d'attente
	  pour <hostid role="domainname">exemple.com</hostid>.</para>

	<para>On peut encore affiner la configuration comme
	  suit:</para>

	<para>Message emprunt&eacute; &agrave; la &a.isp;.</para>

	<programlisting>&gt; Nous fournissons un MX secondaire &agrave; un
client.  Le client se connecte
&gt; &agrave; notre service automatiquement plusieurs fois par jour pour acheminer
&gt; le courrier sur son MX primaire (nous n'appelons pas son site lorsque
&gt; du courrier pour ses domaines arrive).  Notre sendmail envoie le courrier de la
&gt; file d'attente toutes les demi-heures.  Pour l'instant, il doit rester
&gt; une demi-heure en ligne pour &ecirc;tre s&ucirc;r que tout le courrier soit
&gt; arriv&eacute; au MX primaire.
&gt;
&gt; Y-a-t-il une commande qui permette de dire &agrave; sendmail d'envoyer
&gt; sur-le-champ tout le courrier? L'utilisateur n'a &eacute;videmment pas
&gt; les droits super-utilisateur sur la machine.

Dans la section &ldquo;privacy flags&rdquo; (indicateurs de
confidentialit&eacute;) de sendmail.cf, il y a la d&eacute;finition Opgoaway,restrictqrun

Supprimer restrictqrun permet &agrave; d'autres utilisateurs que le
super-utilisateur de lancer le traitement de la file d'attente.  Vous
pouvez aussi red&eacute;finir les MXs.  Nous sommes le premier MX pour les
utilisateurs de ce type, et nous avons d&eacute;fini:

# Si nous sommes le meilleur MX pour une machine, essayer directement
# au lieu d'&eacute;mettre des messages d'erreur de configuration locale.
OwTrue

De cette fa&ccedil;on, un site distant vous enverra directement le courrier,
sans essayer de se connecter chez votre client.  Vous le lui
transmettez ensuite.  Cela ne marche qu'avec les &ldquo;machines&rdquo;,
votre client doit nommer son serveur de courrier
&ldquo;client.com&rdquo; aussi bien que
&ldquo;machine.client.com&rdquo; dans le DNS.  Mettez seulement un
enregistrement A pour &ldquo;client.com&rdquo;.</programlisting>
        </answer>
      </qandaentry>

      <qandaentry>
        <question>
	  <para>Pourquoi j'obtiens le message d'erreur
	    <errorname>Relaying Denied</errorname> &agrave; chaque
	    fois que j'envoie du courrier &agrave; partir d'autres
	    machines?</para>
	</question>

	<answer>
	  <para>Dans l'installation par d&eacute;faut de FreeBSD,
	    <application>sendmail</application> est configur&eacute; pour
	    envoyer du courrier uniquement &agrave; partir de la machine
	    sur laquelle il tourne.  Par exemple, si un serveur POP3
	    est install&eacute;, alors les utilisateurs pourront retirer leur
	    courrier depuis l'&eacute;cole, le travail, ou toute autre
	    machine distante mais ils ne seront toujours pas en mesure
	    d'envoyer du courrier &eacute;lectronique &agrave; partir de machines
	    ext&eacute;rieures.  G&eacute;n&eacute;ralement, quelques
	    instants apr&egrave;s une tentative, un courrier
	    &eacute;lectronique sera envoy&eacute; par le
	    <application>MAILER-DAEMON</application> avec un message
	    <errorname>5.7 Relaying Denied</errorname>.</para>

	  <para>Il y a plusieurs fa&ccedil;ons d'y rem&eacute;dier.
	    La solution la plus directe est de mettre l'adresse
	    de votre fournisseur d'acc&egrave;s dans un fichier de domaine
	    &agrave; relayer <filename>/etc/mail/relay-domains</filename>.
	    Une fa&ccedil;on rapide de le faire serait:</para>

	  <screen>&prompt.root; <userinput>echo "votre.fai.exemple.com" &gt; /etc/mail/relay-domains</userinput></screen>

	  <para>Apr&egrave;s avoir cr&eacute;&eacute; ou &eacute;dit&eacute;
	    ce fichier vous devez
	    red&eacute;marrer <application>sendmail</application>.
	    Cela fonctionne parfaitement si vous &ecirc;tes
	    l'administrateur d'un serveur et vous ne d&eacute;sirez pas
	    envoyer de courrier localement, ou que vous d&eacute;siriez
	    utiliser un syst&egrave;me ou un client &ldquo;clic-bouton&rdquo;
	    sur une autre machine ou un autre FAI.  C'est &eacute;galement
	    tr&egrave;s utile si vous avez uniquement qu'un ou deux
	    comptes de courrier &eacute;lectronique configur&eacute;s.
	    S'il y a un grand nombre d'adresses &agrave; ajouter, vous
	    pouvez tout simplement ouvrir ce fichier dans votre
	    &eacute;diteur de texte favori et ensuite ajouter les domaines,
	    un par ligne:</para>

	  <programlisting>votre.fai.exemple.com
autre.fai.exemple.net
utilisateurs-fai.exemple.org
www.exemple.org</programlisting>

	  <para>D&eacute;sormais tout courrier envoy&eacute; vers votre
	    syst&egrave;me, par n'importe quelle machine de cette liste
	    (en supposant que l'utilisateur poss&egrave;de un compte sur
	    votre syst&egrave;me), sera accept&eacute;.  C'est un bon
	    moyen d'autoriser aux utilisateurs d'envoyer du courrier
	    &eacute;lectronique &agrave; distance depuis votre syst&egrave;me
	    sans autoriser l'utilisation de votre syst&egrave;me pour l'envoi de
	    courrier &eacute;lectronique non sollicit&eacute; (SPAM).</para>

	</answer>
      </qandaentry>
    </qandaset>
  </sect1>

  <sect1 id="mail-advanced">
    <title>Sujets avanc&eacute;s</title>

    <para>LA fonction suivante couvre des sujets plus avanc&eacute;s
      comme la configuration du courrier &eacute;lectronique pour
      l'int&eacute;gralit&eacute; de votre domaine.</para>

    <sect2 id="mail-config">
      <title>Basic Configuration</title>
      <indexterm>
        <primary>courrier &eacute;lectronique</primary>
        <secondary>configuration</secondary>
      </indexterm>

      <para>Sans aucune configuration, vous devrez &ecirc;tre en
	mesure d'envoyer du courrier &eacute;lectronique &agrave; des machines
	ext&eacute;rieures &agrave; partir du moment o&ugrave; vous avez
	configur&eacute; <filename>/etc/resolv.conf</filename> ou que
	vous avez votre propre serveur de noms.  Si vous d&eacute;sirez
	que le courrier pour votre machine soit d&eacute;livr&eacute; au
	serveur de courrier (e.g., <application>sendmail</application>) sur
	votre propre machine FreeBSD, il y a deux m&eacute;thodes:</para>

      <itemizedlist>
	<listitem>
          <para>Faites tourner votre propre serveur de noms et
	    poss&eacute;dez votre propre domaine.  Par exemple <hostid
	    role="domainname">FreeBSD.org</hostid></para>
	</listitem>

	<listitem>
          <para>Faire d&eacute;livrer le courrier directement sur votre
	    machine.  Cela est possible en d&eacute;livrant directement le
	    courrier &agrave; la machine sur lequel pointe le DNS pour le
	    courrier qui vous est destin&eacute;.  Par exemple <hostid
	    role="fqdn">exemple.FreeBSD.org</hostid>.</para>
	</listitem>
      </itemizedlist>

      <indexterm><primary>SMTP</primary></indexterm>
      <para>Ind&eacute;pendamment de la m&eacute;thode que vous choisissez, afin
	d'avoir le courrier d&eacute;livr&eacute; directement
	&agrave; votre machine, elle doit avoir une adresse IP statique
	permanente (et non pas une adresse dynamique, comme avec la
	plupart des connexions PPP par modem).  Si vous &ecirc;tes
	derri&egrave;re un coupe-feu, il doit autoriser le trafic SMTP en
	votre direction.  Si vous voulez recevoir directement le
	courrier sur votre machine, vous devez &ecirc;tre s&ucirc;rs
	de l'une de ces deux choses:</para>

      <itemizedlist>
        <indexterm><primary>enregistrement MX</primary></indexterm>
        <listitem>
          <para>Assurez-vous que l'enregistrement MX (le nombre le
	    plus bas) de votre DNS pointe sur l'adresse IP de votre
	    machine.</para>
        </listitem>

        <listitem>
          <para>Assurez-vous qu'il n'y a pas d'entr&eacute;e MX pour votre
	    machine dans votre DNS.</para>
        </listitem>
      </itemizedlist>

      <para>Une des deux conditions pr&eacute;c&eacute;dentes vous
	permettra de recevoir directement le courrier pour votre
	machine.</para>

      <para>Essayez:</para>

      <screen>&prompt.root; <userinput>hostname</userinput>
exemple.FreeBSD.org
&prompt.root; <userinput>host exemple.FreeBSD.org</userinput>
exemple.FreeBSD.org has address 204.216.27.XX</screen>

      <para>Si c'est la r&eacute;ponse que vous obtenez, le courrier
	adress&eacute; &agrave;
	<email>votreindentifiant@exemple.FreeBSD.org</email>
	arrivera sans probl&egrave;me (en supposant que
	<application>sendmail</application> fonctionne correctement
	sur <hostid role="fqdn">exemple.FreeBSD.org</hostid>).</para>

      <para>Si au lieu de cela vous obtenez quelque chose de similaire
	&agrave; ceci:</para>

      <screen>&prompt.root; <userinput>host exemple.FreeBSD.org</userinput>
exemple.FreeBSD.org has address 204.216.27.XX
exemple.FreeBSD.org mail is handled (pri=10) by hub.FreeBSD.org</screen>

      <para>Tout le courrier adress&eacute; &agrave; votre machine
	(<hostid role="fqdn">exemple.FreeBSD.org</hostid>)
	arrivera sur <hostid>hub</hostid> adress&eacute; au m&ecirc;me
	utilisateur au lieu d'&ecirc;tre directement
	envoy&eacute; &agrave; votre machine.</para>

      <para>L'information pr&eacute;c&eacute;dente est
	g&eacute;r&eacute;e par votre serveur DNS.  L'enregistrement du
	DNS qui contient l'information de routage de courrier est
	l'entr&eacute;e MX (<emphasis>M</emphasis>ail
	e<emphasis>X</emphasis>change).  S'il n'y pas d'enregistrement MX,
	le courrier sera directement envoy&eacute; &agrave; la machine
	en utilisant son adresse IP.</para>

      <para>Voici ce que fut &agrave; un moment donn&eacute;
	l'entr&eacute;e MX pour <hostid
	role="fqdn">freefall.FreeBSD.org</hostid>:</para>

      <programlisting>freefall		MX	30	mail.crl.net
freefall		MX	40	agora.rdrop.com
freefall		MX	10	freefall.FreeBSD.org
freefall		MX	20	who.cdrom.com</programlisting>

      <para>Comme vous pouvez le voir, <hostid>freefall</hostid>
	avait plusieurs entr&eacute;es MX.  L'entr&eacute;e MX dont le
	num&eacute;ro est le plus bas est la machine qui re&ccedil;oit
	directement le courrier si elle est disponible; si elle n'est
	pas accessible pour diverses raisons, les autres (parfois
	appel&eacute;es &ldquo;MX de secours&rdquo;) acceptent
	temporairement les messages, et les transmettent &agrave; une
	machine de num&eacute;ro plus faible quand elle devient
	disponible, et par la suite &agrave; la machine de num&eacute;ro le
	plus bas.</para>

      <para>Les sites MX alternatifs devraient avoir une connexion
	Internet s&eacute;par&eacute;e de la votre afin d'&ecirc;tre
	les plus utiles.  Votre fournisseur d'acc&egrave;s ou tout autre
	site amical ne devrait pas avoir de probl&egrave;me pour vous
	fournir ce service.</para>
    </sect2>

    <sect2 id="mail-domain">
      <title>Courrier pour votre domaine</title>

      <para>Pour configurer un serveur de courrier vous devez faire
	en sorte que tout le courrier &agrave; destination des diverses
	stations de travail lui soit envoy&eacute;.  Concr&egrave;tement,
	vous voulez &ldquo;revendiquer&rdquo; tout courrier pour
	n'importe quelle machine de votre domaine (dans ce cas
	<hostid role="fqdn">*.FreeBSD.org</hostid>) et le d&eacute;tourner
	vers votre serveur de courrier de sorte que vos utilisateurs
	puissent recevoir leur courrier sur le serveur de courrier
	principal.</para>

      <indexterm><primary>DNS</primary></indexterm>
      <para>Pour rendre les choses plus ais&eacute;es, un compte
	utilisateur avec le m&ecirc;me <emphasis>nom
	d'utilisateur</emphasis> devrait exister sur les deux
	machines.  Utilisez &man.adduser.8; pour ce
	faire.</para>

      <para>Le serveur de courrier que vous utiliserez sera
	d&eacute;fini comme &ldquo;mail exchanger&rdquo; pour chaque
	station de travail du r&eacute;seau.  Cela est fait dans votre
	configuration de DNS de cette mani&egrave;re:</para>

      <programlisting>exemple.FreeBSD.org	A	204.216.27.XX		; Station de travail
			MX	10 hub.FreeBSD.org	; Serveur de courrier</programlisting>

      <para>Cela redirigera le courrier pour votre station de travail
	au serveur de courrier quelque soit la machine sur laquelle
	pointe l'enregistrement A.  Le courrier est envoy&eacute; sur la
	machine MX.</para>

      <para>Vous ne pouvez le faire vous-m&ecirc;me que si vous
	g&eacute;rez un serveur de noms.  Si ce n'est pas le cas, ou que vous
	ne pouvez avoir votre propre serveur DNS, parlez-en &agrave;
	votre fournisseur d'acc&egrave;s ou &agrave; celui qui fournit
	votre DNS.</para>

      <para>Si vous faites de l'h&eacute;bergement virtuel du courrier
	&eacute;lectronique, l'information suivante sera utile.  Pour cet
	exemple, nous supposerons que vous avez un client qui poss&egrave;de
	son propre domaine, dans notre cas <hostid
	role="domainname">client1.org</hostid>, et vous voulez
	que tout le courrier pour <hostid
	role="domainname">client1.org</hostid> arrive sur votre
	serveur de courrier, <hostid role="fqdn">mail.mamachine.com</hostid>.
	L'entr&eacute;e dans votre DNS devrait ressembler &agrave; ceci:</para>

      <programlisting>client1.org		MX	10	mail.mamachine.com</programlisting>

      <para>Vous n'avez <emphasis>pas</emphasis> besoin d'un
	enregistrement A pour <hostid
	role="domainname">client1.org</hostid> si vous ne voulez
	g&eacute;rer que le courrier pour ce domaine.</para>

      <note>
	<para>Soyez conscient que &ldquo;pinger&rdquo;
	  <hostid role="domainname">client1.org</hostid> ne
	  fonctionnera pas &agrave; moins qu'un enregistrement A existe pour
	  cette machine.</para>
      </note>

      <para>La derni&egrave;re chose que vous devez faire est d'indiquer &agrave;
	<application>sendmail</application> sur le serveur de courrier
	quels sont les domaines et/ou machines pour lesquels il
	devrait accepter du courrier.  Il y a peu de fa&ccedil;ons
	diff&eacute;rentes de le faire.  L'une des deux m&eacute;thodes
	suivantes devrait fonctionner:</para>

      <itemizedlist>
	<listitem>
	  <para>Ajoutez les machines &agrave; votre fichier
	    <filename>/etc/mail/local-host-names</filename> si vous
	    utilisez la fonction <literal>FEATURE(use_cw_file)</literal>.
	    Si vous utilisez une version de
	    <application>sendmail</application> ant&eacute;rieure &agrave;
	    la version 8.10, le fichier sera
	    <filename>/etc/sendmail.cw</filename>.</para>
	</listitem>

	<listitem>
	  <para>Ajoutez une ligne <literal>Cwyour.host.com</literal>
	    &agrave; votre fichier
	    <filename>/etc/sendmail.cf</filename> ou
	    <filename>/etc/mail/sendmail.cf</filename> si vous utilisez
	    <application>sendmail</application> 8.10 ou sup&eacute;rieur.</para>
	</listitem>
      </itemizedlist>
    </sect2>
  </sect1>

  <sect1 id="SMTP-UUCP">
  <title>SMTP avec UUCP</title>

    <para>La configuration de <application>sendmail</application>
      fournie avec &os; est con&ccedil;ue pour les sites directement
      connect&eacute;s &agrave; l'Internet.  Les sites d&eacute;sirant
      &eacute;changer leur courrier &eacute;lectronique par
      l'interm&eacute;diaire d'UUCP doivent installer un autre fichier
      de configuration pour
      <application>sendmail</application>.</para>

    <para>Modifier manuellement le fichier
      <filename>/etc/mail/sendmail.cf</filename> est un sujet
      r&eacute;serv&eacute; aux sp&eacute;cialistes.  Dans version 8
      de <application>sendmail</application> la
      g&eacute;n&eacute;ration des fichiers de configuration se fait
      par l'interm&eacute;diaire du processeur &man.m4.1;, o&ugrave;
      la configuration se fait &agrave; un haut niveau d'abstraction.
      Les fichiers de configuration &man.m4.1; se trouvent dans le
      r&eacute;pertoire <filename
      role="directory">/usr/src/usr.sbin/sendmail/cf</filename>.</para>

    <para>Si vous n'avez pas install&eacute; toutes les sources du
      syst&egrave;me, l'ensemble des fichiers de configuration de
      <application>sendmail</application> a &eacute;t&eacute;
      regroup&eacute; dans une archive s&eacute;par&eacute;e des
      autres sources.  En supposant que vous avez mont&eacute; votre
      CDROM &os; contenant les sources, faites:</para>

    <screen>&prompt.root; <userinput>cd /cdrom/src</userinput>
&prompt.root; <userinput>cat scontrib.?? | tar xzf - -C /usr/src/contrib/sendmail</userinput></screen>

    <para>Cette extraction ne donne lieu qu'&agrave; une centaine de
      kilo-octets.  Le fichier <filename>README</filename> dans le
      r&eacute;pertoire <filename role="directory">cf</filename>
      pourra faire office d'une introduction &agrave; la configuration
      &man.m4.1;.</para>

    <para>La meilleure fa&ccedil;on d'ajouter le support UUCP est
      d'utiliser la fonctionnalit&eacute;
      <literal>mailertable</literal>.  Cela cr&eacute;&eacute; une
      base de donn&eacute;es que <application>sendmail</application>
      utilise pour d&eacute;cider de la mani&egrave;re dont il va
      router le courrier &eacute;lectronique.</para>

    <para>Tout d'abord, vous devez cr&eacute;er votre fichier
      <filename>.mc</filename>.  Le r&eacute;pertoire <filename
      role="directory">/usr/src/usr.sbin/sendmail/cf/cf</filename>
      contient quelques exemples.  En supposant que vous avez
      appel&eacute; votre fichier <filename>foo.mc</filename>, tout ce
      dont vous avez besoin de faire pour le convertir en un fichier
      <filename>sendmail.cf</filename> valide est:</para>

    <screen>&prompt.root; <userinput>cd /usr/src/usr.sbin/sendmail/cf/cf</userinput>
&prompt.root; <userinput>make foo.cf</userinput>
&prompt.root; <userinput>cp foo.cf /etc/mail/sendmail.cf</userinput></screen>

    <para>Un fichier <filename>.mc</filename> classique devrait
      ressembler &agrave; ceci:</para>

    <programlisting>VERSIONID(`<replaceable>Votre num&eacute;ro de version</replaceable>') OSTYPE(bsd4.4)

FEATURE(accept_unresolvable_domains)
FEATURE(nocanonify)
FEATURE(mailertable, `hash -o /etc/mail/mailertable')

define(`UUCP_RELAY', <replaceable>votre.relai.uucp</replaceable>)
define(`UUCP_MAX_SIZE', 200000)
define(`confDONT_PROBE_INTERFACES')

MAILER(local)
MAILER(smtp)
MAILER(uucp)

Cw    <replaceable>alias.de.votre.nom.de.machine</replaceable>
Cw    <replaceable>votrenomdenoeuduucp.UUCP</replaceable></programlisting>

    <para>Les lignes contenant les directives
      <literal>accept_unresolvable_domains</literal>,
      <literal>nocanonify</literal>, et
      <literal>confDONT_PROBE_INTERFACES</literal> emp&ecirc;cheront
      l'utilisation du DNS lors de l'envoi du courrier
      &eacute;lectronique.  La directive <literal>UUCP_RELAY</literal>
      est n&eacute;cessaire pour le support de l'UUCP.  Mettez juste
      un nom de machine Internet capable de g&eacute;rer des adresses
      d'un pseudo-domaine .UUCP; la plupart du temps, vous mettrez le
      nom du serveur de messagerie de votre fournisseur
      d'acc&egrave;s.</para>

    <para>Apr&egrave;s avoir d&eacute;fini tout ceci, vous avez besoin
      d'un fichier <filename>/etc/mail/mailertable</filename>.  Si
      vous n'avez qu'un seul lien avec l'ext&eacute;rieur qui est
      utilis&eacute; pour votre courrier &eacute;lectronique, le
      fichier suivant devrait suffire:</para>

    <programlisting>#
# makemap hash /etc/mail/mailertable.db &lt; /etc/mail/mailertable
.                             uucp-dom:<replaceable>your.uucp.relay</replaceable></programlisting>

    <para>Un exemple plus complexe ressemblerait &agrave; ceci:</para>

    <programlisting>#
# makemap hash /etc/mail/mailertable.db &lt; /etc/mail/mailertable
#
horus.interface-business.de   uucp-dom:horus
.interface-business.de        uucp-dom:if-bus
interface-business.de         uucp-dom:if-bus
.heep.sax.de                  smtp8:%1
horus.UUCP                    uucp-dom:horus
if-bus.UUCP                   uucp-dom:if-bus
.                             uucp-dom:</programlisting>


    <para>Les trois premi&egrave;res lignes g&egrave;rent les cas
      sp&eacute;cifiques o&ugrave; les courriers &eacute;lectroniques
      pour l'ext&eacute;rieur ne devraient pas &ecirc;tre
      envoy&eacute;s au serveur par d&eacute;faut, mais plut&ocirc;t
      &agrave; des serveurs UUCP voisins afin de
      &ldquo;raccourcir&rdquo; le chemin &agrave; parcourir.  La ligne
      suivante g&egrave;re le courrier &eacute;lectronique
      destin&eacute; au domaine Ethernet local et qui peut &ecirc;tre
      distribu&eacute; en utilisant le protocole SMTP.  Et enfin, les
      voisins UUCP sont mentionn&eacute;s dans la notation de
      pseudo-domaine UUCP, pour permettre &agrave; un courrier du type
      <literal><replaceable>voisin-uucp
      </replaceable>!<replaceable>destinataire</replaceable></literal>
      de passer outre les r&egrave;gles par d&eacute;faut.  La
      derni&egrave;re ligne doit toujours &ecirc;tre un point, ce qui
      correspond &agrave; tout le reste, avec la distribution UUCP
      vers un voisin UUCP qui sert de passerelle universelle de
      courrier &eacute;lectronique vers le reste du monde.  Tous les
      noms de noeuds plac&eacute;s apr&egrave;s le mot cl&eacute;
      <literal>uucp-dom:</literal> doivent &ecirc;tre des noms valides
      de voisins UUCP, que vous pouvez v&eacute;rifier en utilisant la
      commande <literal>uuname</literal>.</para>

    <para>Pour vous rappeler que ce fichier doit &ecirc;tre converti
      en un fichier de base de donn&eacute;es DBM avant d'&ecirc;tre
      utilisable.  La ligne de commande pour accomplir cette
      conversion est rappel&eacute;e dans les commentaires au
      d&eacute;but du fichier <filename>mailertable</filename>.  Vous
      devez lancer cette commande &agrave; chaque fois que vous
      modifiez votre fichier
      <filename>mailertable</filename>.</para>

    <para>Pour finir: si vous n'&ecirc;tes pas certain du bon
      fonctionnement de certaines configurations de routage du
      courrier &eacute;lectronique, rappellez-vous de l'option
      <option>-bt</option> de <application>sendmail</application>.
      Cela lance <application>sendmail</application> dans le
      <emphasis>mode test d'adresse</emphasis>; entrez simplement
      <literal>3,0</literal>, suivi de l'adresse que vous
      d&eacute;sirez tester.  La derni&egrave;re ligne vous indiquera
      le type d'agent utilis&eacute; pour l'envoi, la machine de
      destination &agrave; laquelle l'agent doit envoyer le message,
      et l'adresse (peut-&ecirc;tre traduite) &agrave; laquelle il
      l'enverra.  Pour quitter ce mode tapez <keycombo
      action="simul"><keycap>Ctrl</keycap><keycap>D</keycap></keycombo>.</para>

    <screen>&prompt.user; <userinput>sendmail -bt</userinput>
ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &lt;ruleset&gt; &lt;address&gt;
<prompt>&gt;</prompt> <userinput>3,0 foo@example.com</userinput>
canonify           input: foo @ example . com
...
parse            returns: $# uucp-dom $@ <replaceable>your.uucp.relay</replaceable> $: foo &lt; @ example . com . &gt;
<prompt>&gt;</prompt> <userinput>^D</userinput></screen>
  </sect1>

  <sect1 id="outgoing-only">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Bill</firstname>
	  <surname>Moran</surname>
	  <contrib>Contribution de </contrib>
	</author>
      </authorgroup>
    </sect1info>

    <title>Configuration pour l'envoi seul</title>

    <para>Il existe de nombreux cas o&ugrave; vous d&eacute;sirez
      &ecirc;tre capable d'uniquement envoyer du courrier
      &eacute;lectronique par l'interm&eacute;diaire d'un relais.
      Quelques exemples:</para>

    <itemizedlist>
      <listitem>
	<para>Votre ordinateur est une machine de bureau, mais vous
	  voulez utilisez des programmes comme &man.send-pr.1;.
	  Pour cela vous devez utiliser le relais de courrier
	  &eacute;lectronique de votre FAI.</para>
      </listitem>

      <listitem>
	<para>L'ordinateur est un serveur qui ne g&egrave;re pas le
	  courrier &eacute;lectronique localement, mais a besoin de
	  soumettre tout le courrier &agrave; un relais pour qu'il soit
	  transmis.</para>
      </listitem>
    </itemizedlist>

    <para>N'importe quel <acronym>MTA</acronym> est capable d'assurer
      cette fonction.  Malheureusement, il peut &ecirc;tre tr&egrave;s
      compliqu&eacute; de configurer correctement un
      <acronym>MTA</acronym> complet pour juste g&eacute;rer le
      courrier sortant.  Des logiciels comme
      <application>sendmail</application> et
      <application>postfix</application> sont largement
      surdimensionn&eacute;s pour cette utilisation.</para>

    <para>De plus, si vous utilisez un acc&egrave;s Internet
      classique, votre contrat peut vous interdire de faire tourner un
      &ldquo;serveur de courrier &eacute;lectronique&rdquo;.</para>

    <para>La mani&egrave;re la plus simple pour r&eacute;pondre
      &agrave; ce besoin est d'installer le logiciel port&eacute;
      <filename role="package">mail/ssmtp</filename>.  Ex&eacute;cutez
      les commandes suivantes en tant que
      <username>root</username>:</para>

    <screen>&prompt.root; <userinput>cd /usr/ports/mail/ssmtp</userinput>
&prompt.root; <userinput>make install replace clean</userinput></screen>

    <para>Une fois install&eacute;, <filename
      role="package">mail/ssmtp</filename> peut &ecirc;tre
      configur&eacute; avec un fichier de quatre lignes,
      <filename>/usr/local/etc/ssmtp/ssmtp.conf</filename>:</para>

    <programlisting>root=yourrealemail@example.com
mailhub=mail.example.com
rewriteDomain=example.com
hostname=_HOSTNAME_</programlisting>

    <para>Assurez-vous d'employer votre adresse &eacute;lectronique
      r&eacute;elle pour l'utilisateur <username>root</username>.
      Utilisez le relais de courrier &eacute;lectronique sortant de
      votre FAI &agrave; la place de <hostid
      role="fqdn">mail.example.com</hostid> (certains FAIs appellent
      cela le &ldquo;serveur de courrier sortant&rdquo; ou le
      &ldquo;serveur SMTP&rdquo;).</para>

    <para>Assurez-vous &eacute;galement d'avoir
      d&eacute;sactiv&eacute; <application>sendmail</application> en
      fixant <literal>sendmail_enable="NONE"</literal> dans le fichier
      <filename>/etc/rc.conf</filename>.</para>

    <para><filename role="package">mail/ssmtp</filename> dispose
      d'autres options.  Consultez le fichier de configuration
      d'exemple dans le r&eacute;pertoire <filename
      role="directory">/usr/local/etc/ssmtp</filename> ou la page de
      manuel de <application>ssmtp</application> pour quelques
      exemples et plus d'informations.</para>

    <para>Configurer <application>ssmtp</application> de cette
      mani&egrave;re permettra &agrave; toute application tournant sur
      votre ordinateur et ayant besoin d'envoyer un courrier
      &eacute;lectronique de fonctionner correctement, tout en
      n'outrepassant pas la politique de votre FAI ou en ne permettant
      pas l'utilisation de votre ordinateur comme base arri&egrave;re
      pour &ldquo;spammers&rdquo;.</para>
  </sect1>

  <sect1 id="SMTP-dialup">
    <title>Utiliser le courrier &eacute;lectronique avec une connexion
      temporaire</title>

    <para>Si vous disposez d'une adresse IP statique, vous ne devez
      rien changer du param&eacute;trage par d&eacute;faut.
      D&eacute;finissez votre nom de machine pour qu'il corresponde
      &agrave; celui qui vous a &eacute;t&eacute; assign&eacute; pour
      l'Internet et <application>sendmail</application> s'occupera du
      reste.</para>

    <para>Si votre adresse IP vous est attribu&eacute;e dynamiquement
      et que vous utilisez une connexion PPP par modem pour
      acc&egrave;der &agrave; l'Internet, vous disposez probablement
      d'une boite aux lettres chez votre fournisseur d'acc&egrave;s.
      Supposons que le domaine de votre fournisseur d'acc&egrave;s
      soit <hostid role="domainname">example.net</hostid>, que votre
      nom d'utilisateur soit <username>user</username>, que vous
      avez appel&eacute; votre machine <hostid
      role="fqdn">bsd.home</hostid>, et que votre fournisseur vous ait
      demand&eacute; d'utiliser la machine <hostid
      role="fqdn">relay.example.net</hostid> comme serveur relai de
      messagerie &eacute;lectronique.</para>

    <para>Pour pouvoir rapatrier votre courrier depuis votre boite aux
      lettres, vous devez installer un agent de rapatriement.
      L'utilitaire <application>fetchmail</application> est un bon
      choix car il supporte la plupart des protocoles de messagerie.
      Ce programme est disponible sous forme de paquetage ou &agrave;
      partir du catalogue des logiciels port&eacute;s (<filename
      role="package">mail/fetchmail</filename>).  La plupart du temps,
      votre fournisseur d'acc&egrave;s fournit l'acc&egrave;s aux
      boites aux lettre par le protocole POP3.  Si vous utilisez PPP
      en mode utilisateur, vous pouvez automatiquement
      r&eacute;cup&eacute;rer votre courrier quand une connexion
      Internet est &eacute;tablie avec l'entr&eacute;e suivante dans
      le fichier <filename>/etc/ppp/ppp.linkup</filename>:</para>

    <programlisting>MYADDR:
!bg su user -c fetchmail</programlisting>

    <para>Si vous utilisez <application>sendmail</application> (comme
      montr&eacute; ci-dessous) pour distribuer le courrier aux
      comptes non-locaux, vous voudrez probablement que
      <application>sendmail</application> s'occupe de transmettre les
      messages en attente d&egrave;s que votre connexion Internet est
      &eacute;tablie.  Pour cela, ajoutez la commande suivante
      apr&egrave;s la commande <command>fetchmail</command> dans le
      fichier <filename>/etc/ppp/ppp.linkup</filename>:</para>

    <programlisting>!bg su user -c "sendmail -q"</programlisting>

    <para>En supposant que vous avez un compte
      <username>user</username> sur <hostid
      role="fqdn">bsd.home</hostid>.  Dans le r&eacute;pertoire de
      l'utilisateur <username>user</username> sur <hostid
      role="fqdn">bsd.home</hostid>, cr&eacute;ez un fichier
      <filename>.fetchmailrc</filename> contenant:</para>

    <programlisting>poll example.net protocol pop3 fetchall pass MySecret</programlisting>

    <para>Ce fichier ne devrait &ecirc;tre lisible que par
      l'utilisateur <username>user</username> car il contient le mot
      de passe <literal>MySecret</literal>.</para>

    <para>Afin de pouvoir envoyer du courrier avec l'ent&ecirc;te
      <literal>from:</literal> correcte, vous devez configurer
      <application>sendmail</application> pour utiliser l'adresse
      <literal>user@example.net</literal> plut&ocirc;t que
      <literal>user@bsd.home</literal>.  Vous pouvez &eacute;galement
      dire &agrave; <application>sendmail</application> d'envoyer le
      courrier via le serveur <hostid
      role="fqdn">relay.example.net</hostid>, permettant une
      transmission du courrier plus rapide.</para>

    <para>Le fichier <filename>.mc</filename> suivant devrait
      suffire:</para>

    <programlisting>VERSIONID(`bsd.home.mc version 1.0')
OSTYPE(bsd4.4)dnl
FEATURE(nouucp)dnl
MAILER(local)dnl
MAILER(smtp)dnl
Cwlocalhost
Cwbsd.home
MASQUERADE_AS(`example.net')dnl
FEATURE(allmasquerade)dnl
FEATURE(masquerade_envelope)dnl
FEATURE(nocanonify)dnl
FEATURE(nodns)dnl
define(`SMART_HOST', `relay.example.net')
Dmbsd.home
define(`confDOMAIN_NAME',`bsd.home')dnl
define(`confDELIVERY_MODE',`deferred')dnl</programlisting>

    <para>R&eacute;f&eacute;rez-vous &agrave; la section
      pr&eacute;c&eacute;dente pour des d&eacute;tails sur la
      conversion de ce fichier <filename>.mc</filename> en un fichier
      <filename>sendmail.cf</filename>.  N'oubliez pas
      &eacute;galement de red&eacute;marrer
      <application>sendmail</application> apr&egrave;s la mise
      &agrave; jour du fichier
      <filename>sendmail.cf</filename>.</para>
  </sect1>

  <sect1 id="SMTP-Auth">
    <title>Authentification SMTP</title>

    <para>Disposer de l'authentification <acronym>SMTP</acronym>
      sur votre serveur de courrier pr&eacute;sente un certain
      nombre d'avantages.  L'authentification <acronym>SMTP</acronym>
      peut ajouter une autre couche de s&eacute;curit&eacute; &agrave;
      <application>sendmail</application>, et a l'avantage
      de donner aux utilisateurs mobiles la possibilit&eacute;
      d'utiliser le m&ecirc;me serveur de courrier sans avoir
      besoin de reconfigurer les param&egrave;tres de leur client
      courrier &agrave; chaque d&eacute;placement.</para>

    <procedure>
      <step>
	<para>Installez <filename
	  role="package">security/cyrus-sasl</filename> &agrave;
	  partir du catalogue des logiciels port&eacute;s.  Vous
	  pouvez trouver ce logiciel port&eacute; dans
	  <filename role="package">security/cyrus-sasl</filename>.
	  <filename role="package">security/cyrus-sasl</filename>
	  dispose de nombreuses options de compilation possibles,
	  pour la m&eacute;thode que nous allons utiliser ici,
	  assurez-vous de s&eacute;lectionner l'option
	  <option>pwcheck</option>.</para>
      </step>


      <step>
	<para>Apr&egrave;s avoir install&eacute;
	  <filename role="package">security/cyrus-sasl</filename>,
	  &eacute;ditez
	  <filename>/usr/local/lib/sasl/Sendmail.conf</filename>
	  (ou cr&eacute;ez-le s'il n'existe pas) et ajoutez la ligne
	  suivante:</para>

	<programlisting>pwcheck_method: passwd</programlisting>

	<para>Cette m&eacute;thode activera au niveau de
	  <application>sendmail</application> l'authentification par
	  l'interm&eacute;diaire de votre base de donn&eacute;es
	  FreeBSD <filename>passwd</filename>.  Cela nous &eacute;pargne
	  le probl&egrave;me de la cr&eacute;ation d'un nouvel ensemble
	  de nom d'utilisateur et de mot de passe pour chaque
	  utilisateur ayant besoin de recourir &agrave;
	  l'authentification <acronym>SMTP</acronym>, et conserve le
	  m&ecirc;me nom d'utilisateur et mot de passe pour le
	  courrier.</para>
      </step>

      <step>
	<para>Maintenant &eacute;ditez <filename>/etc/make.conf</filename>
	  et ajoutez les lignes suivantes:</para>

	<programlisting>SENDMAIL_CFLAGS=-I/usr/local/include/sasl1 -DSASL
SENDMAIL_LDFLAGS=-L/usr/local/lib
SENDMAIL_LDADD=-lsasl</programlisting>

	<para>Ces lignes passeront &agrave;
	<application>sendmail</application> les bonnes options de
	configuration au moment de la compilation pour lier
	<filename role="package">cyrus-sasl</filename>.
	Assurez-vous que <filename role="package">cyrus-sasl</filename>
	a &eacute;t&eacute; install&eacute; avant de recompiler
	<application>sendmail</application>.</para>
      </step>

      <step>
	<para>Recompilez <application>sendmail</application> en
	  lan&ccedil;ant les commandes suivantes:</para>

	<screen>&prompt.root; <userinput>cd /usr/src/usr.sbin/sendmail</userinput>
&prompt.root; <userinput>make cleandir</userinput>
&prompt.root; <userinput>make obj</userinput>
&prompt.root; <userinput>make</userinput>
&prompt.root; <userinput>make install</userinput></screen>

	<para>La compilation de <application>sendmail</application>
	  ne devrait pas pr&eacute;senter de probl&egrave;mes si le
	  r&eacute;pertoire <filename>/usr/src</filename> n'a pas subi
	  d'&eacute;normes changements et si les biblioth&egrave;ques
	  partag&eacute;s n&eacute;cessaires sont disponibles.</para>
      </step>

      <step>
	<para>Une fois que <application>sendmail</application> a
	  &eacute;t&eacute; compil&eacute; et r&eacute;install&eacute;,
	  &eacute;ditez votre fichier <filename>/etc/mail/freebsd.mc</filename>
	  (ou tout autre fichier que vous utilisez comme fichier
	  <filename>.mc</filename>.  De nombreux administrateurs
	  utilisent la sortie de &man.hostname.1; comme nom de fichier
	  <filename>.mc</filename> par unicit&eacute;).  Ajoutez-y les
	  lignes qui suivents:</para>

	<programlisting>dnl set SASL options
TRUST_AUTH_MECH(`GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN')dnl
define(`confAUTH_MECHANISMS', `GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN')dnl
define(`confDEF_AUTH_INFO', `/etc/mail/auth-info')dnl</programlisting>

	<para>Ces options configurent les diff&eacute;rentes m&eacute;thodes
	  disponibles pour <application>sendmail</application>
	  pour l'authentification des utilisateurs.  Si vous
	  d&eacute;sirez utiliser une m&eacute;thode autre que
	  <application>pwcheck</application>, veuillez consulter
	  la documentation fournie.</para>
      </step>

      <step>
	<para>Enfin, ex&eacute;cutez &man.make.1; quand vous &ecirc;tes
	  dans <filename>/etc/mail</filename>.  Cela prendra votre
	  nouveau fichier <filename>.mc</filename> et cr&eacute;era un
	  fichier <filename>.cf</filename> appel&eacute;
	  <filename>freebsd.cf</filename> (ou selon tout autre nom que
	  vous avez utilis&eacute; pour votre fichier
	  <filename>.mc</filename>).  Ensuite utilisez la commande
	  <command>make install restart</command>, qui copiera le
	  fichier en <filename>sendmail.cf</filename>, et
	  red&eacute;marrera proprement
	  <application>sendmail</application>.  Pour plus
	  d'informations sur ce processus, vous devriez vous
	  r&eacute;ferrer au fichier
	  <filename>/etc/mail/Makefile</filename>.</para>
      </step>
    </procedure>

    <para>Si tout s'est bien pass&eacute;, vous devriez &ecirc;tre
      en mesure d'entrer votre identifiant dans votre programme
      de courrier et d'envoyer un message de test.  Pour plus
      d'investigation, fixez le <option>LogLevel</option> de
      <application>sendmail</application> &agrave; 13 et scrutez
      <filename>/var/log/maillog</filename> &agrave; la recherche
      d'une erreur.</para>

    <para>Vous pourrez rajouter les lignes suivantes au fichier
      <filename>/etc/rc.conf</filename> afin de rendre ce service
      disponible apr&egrave;s chaque d&eacute;marrage du
      syst&egrave;me:</para>

    <programlisting>sasl_pwcheck_enable="YES"
sasl_pwcheck_program="/usr/local/sbin/pwcheck"</programlisting>

    <para>Cela assurera l'initialisation de
      <acronym>SMTP_AUTH</acronym>, l'authentification SMTP, au
      d&eacute;marrage du syst&egrave;me.</para>

    <para>Pour plus d'informations, veuillez consulter la page de la
      documentation de <application>sendmail</application> concernant
      <ulink url="http://www.sendmail.org/~ca/email/auth.html">
      l'authentification <acronym>SMTP</acronym></ulink>.</para>

  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->

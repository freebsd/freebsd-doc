<!--
     The FreeBSD Documentation Project
     The FreeBSD French Documentation Project

     $FreeBSD$
     Original revision: 1.190
-->

<chapter id="disks">
  <title>Stockage des donn&eacute;es</title>
  &trans.a.fonvieille;

  <sect1 id="disks-synopsis">
    <title>Synopsis</title>


    <para>Ce chapitre couvre l'utilisation des disques sous FreeBSD.
      Cela comprend les disques m&eacute;moire, les disques r&eacute;seau,
      et les p&eacute;riph&eacute;riques standards de stockage
      SCSI/IDE.</para>

    <para>Apr&egrave;s la lecture de ce chapitre, vous
      conna&icirc;trez:</para>
    <itemizedlist>
      <listitem>
	<para>La terminologie qu'utilise FreeBSD pour d&eacute;crire
	  l'organisation des donn&eacute;es sur un disque physique (les
	  partitions et les tranches).</para>
      </listitem>
      <listitem>
	<para>Comment ajouter des disques durs suppl&eacute;mentaires sur
	  votre syst&egrave;me.</para>
      </listitem>
      <listitem>
	<para>Comment configurer des syst&egrave;mes de fichiers virtuels,
	  comme les disques m&eacute;moires.</para>
      </listitem>
      <listitem>
	<para>Comment utiliser les quotas pour limiter l'usage de
	  l'espace disque.</para>
      </listitem>
      <listitem>
	<para>Comment chiffrer des disques pour les s&eacute;curiser
	  contre les attaques.</para>
      </listitem>
      <listitem>
	<para>Comment cr&eacute;er et graver des CDs et DVDs sous
	  FreeBSD.</para>
      </listitem>
      <listitem>
	<para>Les diff&eacute;rents supports disponibles pour les
	  sauvegardes.</para>
      </listitem>
      <listitem>
	<para>Comment utiliser les programmes de sauvegarde
	  disponibles sous FreeBSD.</para>
      </listitem>
      <listitem>
	<para>Comment faire des sauvegardes sur disquettes.</para>
      </listitem>
      <listitem>
	<para>Ce que sont les &ldquo;snapshots&rdquo; et comment
	  les utiliser efficacement.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 id="disks-naming">
    <title>Noms des p&eacute;riph&eacute;riques</title>

    <para>Ce qui suit est une liste des p&eacute;riph&eacute;riques
      de stockage physiques, et des noms de p&eacute;riph&eacute;riques
      associ&eacute;s.</para>

    <table id="disk-naming-physical-table">
      <title>Conventions de nom pour les disques physiques</title>

      <tgroup cols="2">
	<thead>
	  <row>
	    <entry>Type de disque</entry>
	    <entry>Nom du p&eacute;riph&eacute;rique</entry>
	  </row>
	</thead>
	<tbody>
	  <row>
	    <entry>Disques durs IDE</entry>
	    <entry><literal>ad</literal></entry>
	  </row>
	  <row>
	    <entry>Lecteurs de CDROMs IDE</entry>
	    <entry><literal>acd</literal></entry>
	  </row>
	  <row>
	    <entry>Disques durs SCSI et p&eacute;riph&eacute;riques de
	      stockage USB</entry>
	    <entry><literal>da</literal></entry>
	  </row>
	  <row>
	    <entry>Lecteurs de CDROMs SCSI</entry>
	    <entry><literal>cd</literal></entry>
	  </row>
	  <row>
	    <entry>Lecteurs de CDROMs non-standard divers</entry>
	    <entry><literal>mcd</literal> pour les CD-ROMs Mitsumi,
	      <literal>scd</literal> pour les CD-ROMs Sony,
	      <literal>matcd</literal> pour les CD-ROMs
	      Matsushita/Panasonic
		<footnote>
		  <para>Le pilote de p&eacute;riph&eacute;rique
		    &man.matcd.4; a &eacute;t&eacute; retir&eacute;
		    dans la branche FreeBSD&nbsp;4.X depuis le 5
		    Octobre 2002 et n'existe pas sous les versions
		    FreeBSD&nbsp;5.0 et 5.1.  Cependant ce pilote est
		    de retoure dans le branche &os;&nbsp;5.X depuis
		    le 16 juin 2003.</para>
		</footnote>
	    </entry>
	  </row>
	  <row>
	    <entry>Lecteurs de disquette</entry>
	    <entry><literal>fd</literal></entry>
	  </row>
	  <row>
	    <entry>Lecteurs de bande SCSI</entry>
	    <entry><literal>sa</literal></entry>
	  </row>
	  <row>
	    <entry>Lecteurs de bande IDE</entry>
	    <entry><literal>ast</literal></entry>
	  </row>
	  <row>
	    <entry>Disques flash</entry>
	    <entry><literal>fla</literal> pour les
	      p&eacute;riph&eacute;riques Flash &diskonchip;</entry>
	  </row>
	  <row>
	    <entry>Disques RAID</entry>
	    <entry><literal>aacd</literal> pour l'AdvancedRAID &adaptec;,
	      <literal>mlxd</literal> et <literal>mlyd</literal>
	      pour les &mylex;,
	      <literal>amrd</literal> le &megaraid; d'AMI,
	      <literal>idad</literal> pour le Smart RAID de Compaq,
	      <literal>twed</literal> pour le &tm.3ware; RAID.</entry>
	  </row>
	</tbody>
      </tgroup>
    </table>
  </sect1>

  <sect1 id="disks-adding">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>David</firstname>
	  <surname>O'Brien</surname>
	  <contrib>Contribution originale de </contrib>
	</author>
      </authorgroup>
      <!-- 26 Apr 1998 -->
    </sect1info>

    <title>Ajouter des disques</title>

    <indexterm>
      <primary>disques</primary>
      <secondary>ajout</secondary>
    </indexterm>

    <para>Supposons que nous voulions ajouter un second disque SCSI
      &agrave; une machine qui n'a pour l'instant qu'un seul disque.
      Commen&ccedil;ons par arr&ecirc;ter l'ordinateur et installer le disque
      en suivant les instructions donn&eacute;es par le constructeur de
      l'ordinateur, du contr&ocirc;leur et du disque.  Comme il y a de
      nombreuses fa&ccedil;on de proc&eacute;der, ces d&eacute;tails
      d&eacute;passent le cadre de ce document.</para>

    <para>Ouvrons maintenant une session sous le compte
      <username>root</username>.  Apr&egrave;s avoir install&eacute; le disque,
      consultez le fichier <filename>/var/run/dmesg.boot</filename>
      pour v&eacute;rifier que le nouveau disque a &eacute;t&eacute;
      reconnu.  Dans notre exemple, le disque que nous venons
      d'ajouter sera le p&eacute;riph&eacute;rique
      <devicename>da1</devicename> et nous le monterons sur le
      r&eacute;pertoire <filename>/1</filename> (si vous ajoutez
      un disque IDE, le nom de p&eacute;riph&eacute;rique sera
      <devicename>wd1</devicename> sur un syst&egrave;me pre-4.0 ou
      <devicename>ad1</devicename> sur les syst&egrave;mes 4.X et
      5.X).</para>

    <indexterm><primary>partitions</primary></indexterm>
    <indexterm><primary>tranches</primary></indexterm>
    <indexterm>
      <primary><command>fdisk</command></primary>
    </indexterm>

    <para>Comme FreeBSD tourne sur des ordinateurs compatibles IBM-PC,
      il doit tenir compte des partitions PC BIOS.  Ces derni&egrave;res
      sont diff&eacute;rentes des partitions BSD traditionnelles.
      Un disque PC peut avoir jusqu'&agrave; quatre partitions.  Si le
      disque va &ecirc;tre r&eacute;serv&eacute; uniquement &agrave; FreeBSD,
      vous pouvez utiliser le mode <emphasis>d&eacute;di&eacute;</emphasis>.
      Sinon, FreeBSD devra utiliser une des partitions PC BIOS.
      FreeBSD appelle les partitions PC BIOS
      <emphasis>tranches</emphasis> (&ldquo;slices&rdquo;) pour
      les distinguer des partitions BSD traditionnelles.
      Vous pouvez aussi des tranches sur un disque d&eacute;di&eacute;
      &agrave; FreeBSD, mais utilis&eacute; sur une machine o&ugrave;
      un autre syst&egrave;me d'exploitation est &eacute;galement
      install&eacute;.  Cela &eacute;vite de perturber l'utilitaire
      <command>fdisk</command> de l'autre syst&egrave;me
      d'exploitation.</para>

    <para>Dans le cas d'une tranche, le disque ajout&eacute; deviendra
      le p&eacute;riph&eacute;rique <filename>/dev/da1s1e</filename>.
      Ce qui se lit: disque SCSI, num&eacute;ro d'unit&eacute; 1 (second disque
      SCSI), tranche 1 (partition PC BIOS 1), et partition BSD
      <filename>e</filename>.  Dans le cas du mode d&eacute;di&eacute;,
      le disque sera ajout&eacute; en tant que
      <filename>/dev/da1e</filename>.</para>

    <sect2>
      <title>Utiliser &man.sysinstall.8;</title>
      <indexterm>
	<primary><application>sysinstall</application></primary>
	<secondary>ajout de disque</secondary>
      </indexterm>
      <indexterm>
	<primary>su</primary>
      </indexterm>
      <procedure>
	<step>
	  <title>Naviguer dans <application>sysinstall</application></title>

	  <para>Vous pouvez utiliser <command>/stand/sysinstall</command>
	    et ses menus simples d'emploi pour partitionner et
	    libeller le nouveau disque.  Ouvrez une session sous
	    le compte super-utilisateur <username>root</username> ou
	    utilisez la commande &man.su.1;.  Lancez
	    <command>/stand/sysinstall</command> et s&eacute;lectionnez
	    <guimenuitem>Configure</guimenuitem>.  A l'int&eacute;rieur
	    du menu <guimenuitem>FreeBSD Configuration
	    Menu</guimenuitem>, descendez et s&eacute;lectionnez l'option
	    <guimenuitem>Fdisk</guimenuitem>.</para>
	</step>

	<step>
	  <title>L'&eacute;diteur de partition
	    <application>fdisk</application></title>
	  <para>Une fois dans l'utilitaire <application>fdisk</application>,
	    nous pouvons taper <keycap>A</keycap> pour utiliser tout
	    le disque pour FreeBSD.  Lorsque l'on vous demande si vous
	    voulez garder la possibilit&eacute; de pouvoir coop&eacute;rer avec
	    d'autres syst&egrave;mes d'exploitation (&ldquo;remain
	    cooperative with any future possible operating
	    systems&rdquo;), r&eacute;pondez par l'affirmative
	    (<literal>YES</literal>).  Enregistrez les modifications
	    sur le disque avec <keycap>W</keycap>.  Quittez maintenant
	    l'&eacute;diteur <application>fdisk</application> en tapant
	    <keycap>q</keycap>.  La prochaine question concernera le
	    secteur de d&eacute;marrage (&ldquo;Master Boot Record&rdquo;).
	    Comme vous ajoutez un disque &agrave; un syst&egrave;me
	    d&eacute;j&agrave; op&eacute;rationnel, choisissez
	    <guibutton>None</guibutton>.</para>
	</step>

	<step>
	  <title>L'&eacute;diteur de label du disque</title>
	  <indexterm><primary>partitions BSD</primary></indexterm>

	  <para>Ensuite, vous devez quitter puis relancer
	    <application>sysinstall</application>.  Suivez les
	    instructions pr&eacute;c&eacute;dentes, en choisissant cette fois
	    l'option <guimenuitem>Label</guimenuitem>.  Vous entrerez
	    dans l'&eacute;diteur de label du disque (<literal>Disk Label
	    Editor</literal>).  C'est l&agrave; que vous allez cr&eacute;er
	    les partitions BSD traditionnelles.  Un disque peut avoir
	    jusqu'&agrave; huit partitions, libell&eacute;es de
	    <literal>a</literal> &agrave; <literal>h</literal>.  Certains
	    de ces labels ont des significations particuli&egrave;res.
	    La partition <literal>a</literal> est la partition racine
	    (<filename>/</filename>).  Seul votre disque syst&egrave;me
	    (e.g., celui &agrave; partir duquel vous d&eacute;marrez)
	    doit avoir une partition <literal>a</literal>.  La
	    partition <literal>b</literal> est utilis&eacute;e pour la
	    pagination, vous pouvez avoir plusieurs disques avec des
	    partitions de pagination.  La partition
	    <literal>c</literal> d&eacute;signe la totalit&eacute; du
	    disque en mode d&eacute;di&eacute;, ou toute la tranche
	    FreeBSD dans le cas contraire.  Les autres partitions sont
	    &agrave; usage g&eacute;n&eacute;ral.</para>

	  <para>L'&eacute;diteur de label de
	    <application>sysinstall</application> d&eacute;finit par
	    d&eacute;faut
	    la partition <literal>e</literal> comme premi&egrave;re partition
	    qui n'est ni racine, ni de pagination.  Dans l'&eacute;diteur
	    de label, cr&eacute;ez un seul syst&egrave;me de fichiers avec
	    l'option <keycap>C</keycap>.  Quand on vous demande si ce sera un
	    syst&egrave;me de fichiers (FS) ou une partition de pagination,
	    choisissez <literal>FS</literal> et indiquez un point de
	    montage (e.g., <filename>/mnt</filename>).  Lorsque vous
	    ajoutez un disque sur un syst&egrave;me d&eacute;j&agrave;
	    install&eacute;, <application>sysinstall</application> ne
	    cr&eacute;era
	    pas d'entr&eacute;es dans <filename>/etc/fstab</filename>, donc
	    le nom que vous donnez au point de montage n'a pas
	    d'importance.</para>

	  <para>Vous pouvez maintenant &eacute;crire le nouveau label sur
	    le disque et y cr&eacute;er un syst&egrave;me de fichiers.
	    Faites-le en tapant <keycap>W</keycap>.  Ignorez les
	    erreurs de <application>sysinstall</application>
	    disant que la nouvelle partition ne peut &ecirc;tre
	    mont&eacute;e.  Quittez maintenant l'&eacute;diteur de label et
	    <application>sysinstall</application>.</para>
	</step>

	<step>
	  <title>Derni&egrave;re &eacute;tape</title>

	  <para>La derni&egrave;re &eacute;tape consiste &agrave; &eacute;diter
	    le fichier <filename>/etc/fstab</filename> pour y
	    ajouter une entr&eacute;e pour votre nouveau disque.</para>
	</step>
      </procedure>
    </sect2>

    <sect2>
      <title>Utiliser les utilitaires en ligne de commande</title>

      <sect3>
	<title>Utiliser les tranches &mdash; &ldquo;slices&rdquo;</title>

	<para>Cette configuration permettra de faire fonctionner
	  correctement votre disque dure avec d'autres syst&egrave;mes
	  d'exploitation qui pourraient &ecirc;tre install&eacute;
	  sur votre machine, et ne perturbera pas les utilitaires
	  <command>fdisk</command> de ces autres syst&egrave;mes
	  d'exploitation.  C'est la m&eacute;thode recommand&eacute;e
	  pour l'installation de nouveau disques.  N'utilisez le mode
	  <emphasis>d&eacute;di&eacute;</emphasis> que si vous avez une bonne
	  raison de le faire!</para>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=/dev/da1 bs=1k count=1</userinput>
&prompt.root; <userinput>fdisk -BI da1</userinput> #Initialize your new disk
&prompt.root; <userinput>disklabel -B -w -r da1s1 auto</userinput> #Label it.
&prompt.root; <userinput>disklabel -e da1s1</userinput> # Edit the disklabel just created and add any partitions.
&prompt.root; <userinput>mkdir -p /1</userinput>
&prompt.root; <userinput>newfs /dev/da1s1e</userinput> # Repeat this for every partition you created.
&prompt.root; <userinput>mount /dev/da1s1e /1</userinput> # Mount the partition(s)
&prompt.root; <userinput>vi /etc/fstab</userinput> # Add the appropriate entry/entries to your <filename>/etc/fstab</filename>.</screen>

	<para>Si vous avez un disque IDE, remplacez <filename>da</filename>
	  par <filename>ad</filename>.  Sur les syst&egrave;mes pre-4.X
	  utilisez <filename>wd</filename>.</para>
      </sect3>

      <sect3>
	<title>Mode d&eacute;di&eacute;</title>
	<indexterm><primary>OS/2</primary></indexterm>

	<para>Si le nouveau disque n'est pas destin&eacute; a &ecirc;tre
	  partag&eacute; avec un autre syst&egrave;me d'exploitation, vous
	  pouvez utiliser le mode <emphasis>d&eacute;di&eacute;</emphasis>.
	  Rappelez-vous que ce mode peut perturber les syst&egrave;mes
	  d'exploitation Microsoft; cependant, ils ne toucheront pas
	  au disque.  &os2; d'IBM, au contraire,
	  &ldquo;s'approprie&rdquo; toute partition qu'il trouve et ne
	  reconna&icirc;t pas.</para>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=/dev/da1 bs=1k count=1</userinput>
&prompt.root; <userinput>disklabel -Brw da1 auto</userinput>
&prompt.root; <userinput>disklabel -e da1</userinput>				# create the `e' partition
&prompt.root; <userinput>newfs -d0 /dev/da1e</userinput>
&prompt.root; <userinput>mkdir -p /1</userinput>
&prompt.root; <userinput>vi /etc/fstab</userinput>				# add an entry for /dev/da1e
&prompt.root; <userinput>mount /1</userinput></screen>

	<para>Un autre m&eacute;thode est:</para>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=/dev/da1 count=2</userinput>
&prompt.root; <userinput>disklabel /dev/da1 | disklabel -BrR da1 /dev/stdin</userinput>
&prompt.root; <userinput>newfs /dev/da1e</userinput>
&prompt.root; <userinput>mkdir -p /1</userinput>
&prompt.root; <userinput>vi /etc/fstab</userinput>					# add an entry for /dev/da1e
&prompt.root; <userinput>mount /1</userinput></screen>

	<note><para>Depuis la version &os;&nbsp;5.1-RELEASE,
	  l'utilitaire &man.bsdlabel.8; remplace l'ancien programme
	  &man.disklabel.8;.  Avec &man.bsdlabel.8; de nombreuses
	  options et param&egrave;tres obsol&egrave;tes ont
	  &eacute;t&eacute; retir&eacute;s; dans les exemples ci-dessus,
	  l'option <option>-r</option> doit &ecirc;tre enlev&eacute;e.
	  Pour plus d'information, consultez la page de manuel
	  &man.bsdlabel.8;.</para></note>
      </sect3>
    </sect2>
  </sect1>

  <sect1 id="raid">
    <title>RAID</title>

    <sect2 id="raid-soft">
      <title>RAID logiciel</title>

      <sect3 id="ccd">
	<sect3info>
	  <authorgroup>
	    <author>
	      <firstname>Christopher</firstname>
	      <surname>Shumway</surname>
	      <contrib>Travail original de </contrib>
	    </author>
	  </authorgroup>
	  <authorgroup>
	    <author>
	      <firstname>Jim</firstname>
	      <surname>Brown</surname>
	      <contrib>R&eacute;vis&eacute; par </contrib>
	    </author>
	  </authorgroup>
	</sect3info>

<indexterm><primary>RAID</primary><secondary>Logiciel</secondary></indexterm>
<indexterm>
  <primary>RAID</primary><secondary>CCD</secondary>
</indexterm>

	<title>Configuration du pilote de disque concat&eacute;n&eacute;
	  (CCD &mdash; &ldquo;Concatenated Disk Driver&rdquo;)</title>
	<para>Quand il est question du choix d'une solution de
	  stockage de masse les crit&egrave;res de choix les plus
	  importants &agrave; consid&eacute;rer sont la vitesse, la
	  fiabilit&eacute;, et le
	  co&ucirc;t.  Il est plut&ocirc;t rare de pouvoir r&eacute;unir
	  ces trois crit&egrave;res; normalement un
	  p&eacute;riph&eacute;rique de stockage rapide et fiable est
	  co&ucirc;teux, et pour diminuer les co&ucirc;ts la
	  vitesse ou la fiabilit&eacute; doivent
	  &ecirc;tre sacrifi&eacute;es.</para>

	<para>A la conception du syst&egrave;me d&eacute;crit plus bas,
	  le co&ucirc;t a &eacute;t&eacute; choisi comme facteur
	  le plus important, suivi de la vitesse, et enfin
	  la fiabilit&eacute;.  La vitesse de transfert des donn&eacute;es
	  est limit&eacute;e par le r&eacute;seau.  Et tandis que la
	  fiabilit&eacute; est tr&egrave;s importante, le disque CCD
	  d&eacute;crit ci-dessous est destin&eacute; au stockage de
	  donn&eacute;es en ligne qui sont d&eacute;j&agrave;
	  compl&egrave;tement sauvegard&eacute;es sur CD-Rs et qui
	  peuvent &ecirc;tre facilement remplac&eacute;es.</para>

	<para>D&eacute;finir vos propres besoins est la premi&egrave;re
	  &eacute;tape dans le choix d'une solution de stockage
	  de masse.  Si vos crit&egrave;res de choix privil&eacute;gient
	  la vitesse ou la fiabilit&eacute; par rapport au co&ucirc;t,
	  votre solution dif&eacute;rera du syst&egrave;me d&eacute;crit dans
	  cette section.</para>

	<sect4 id="ccd-installhw">
	  <title>Installation du mat&eacute;riel</title>

	  <para>En plus du disque syst&egrave;me IDE, trois
	    disques Western Digital de 30GO, 5400 trs/min IDE
	    forment le coeur du disque CCD d&eacute;crit ci-dessous
	    donnant approximativement 90GO de stockage en ligne.
	    La solution id&eacute;ale serait d'avoir
	    pour chaque disque IDE son propre c&acirc;ble et
	    contr&ocirc;leur IDE, mais pour minimiser les co&ucirc;ts,
	    des contr&ocirc;leur IDE suppl&eacute;mentaires n'ont pas
	    &eacute;t&eacute; utilis&eacute;s.  Aussi, les disques ont
	    &eacute;t&eacute; configur&eacute; de telle fa&ccedil;on que chaque
	    contr&ocirc;leur IDE ait un disque ma&icirc;tre et un disque
	    esclave.</para>

	  <para>Au red&eacute;marrage, le BIOS a &eacute;t&eacute;
	    configur&eacute; pour d&eacute;tecter automatiquement
	    les disques attach&eacute;s.  FreeBSD les a d'ailleurs
	    d&eacute;tect&eacute;s au red&eacute;marrage:</para>

	  <programlisting>ad0: 19574MB &lt;WDC WD205BA&gt; [39770/16/63] at ata0-master UDMA33
ad1: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata0-slave UDMA33
ad2: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata1-master UDMA33
ad3: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata1-slave UDMA33</programlisting>

	  <note><para>Si FreeBSD ne d&eacute;tecte pas les disques,
	    assurez-vous que vous avez correctement plac&eacute; les
	    cavaliers.  La plupart des disques IDE disposent
	    &eacute;galement d'un cavalier &ldquo;Cable Select&rdquo;.
	    Ce n'est <emphasis>pas</emphasis> le cavalier de
	    configuration ma&icirc;tre/esclave.  Consultez la
	    documentation du disque pour identifier le cavalier
	    correct.</para></note>

	  <para>Ensuite, r&eacute;fl&eacute;chissez sur la mani&egrave;re
	    de les int&eacute;grer au syst&egrave;me de fichiers.
	    Vous devriez faire des recherches sur &man.vinum.8;
	    (<xref linkend="vinum-vinum">) et &man.ccd.4;.  Dans
	    cette configuration particuli&egrave;re, &man.ccd.4; a
	    &eacute;t&eacute; choisi.</para>
	</sect4>

	<sect4 id="ccd-setup">
	  <title>Configuration du CCD</title>

	  <para>Le pilote &man.ccd.4; vous permet de prendre
	    plusieurs disques identiques et les concat&eacute;ner
	    en un seul syst&egrave;me de fichiers logique.  Afin
	    d'utiliser &man.ccd.4;, vous avez besoin
	    d'un noyau avec le support &man.ccd.4;.
	    Ajoutez la ligne suivante &agrave; votre fichier de
	    configuration de noyau, recompilez, et installez
	    le noyau:</para>

	  <programlisting>pseudo-device   ccd     4</programlisting>

	  <para>Sur les syst&egrave;mes 5.X, vous devez utiliser la ligne
	    suivante &agrave; la place:</para>

	  <programlisting>device   ccd</programlisting>

	  <note><para>Sous FreeBSD 5.0, il n'est pas n&eacute;cessaire
	    de pr&eacute;ciser le nombre de p&eacute;riph&eacute;riques ccd,
	    &eacute;tant donn&eacute; que le pilote de
	    p&eacute;riph&eacute;rique ccd est d&eacute;sormais
	    auto-duplicable &mdash; les nouveaux
	    p&eacute;riph&eacute;riques seront automatiquement
	    cr&eacute;&eacute;s &agrave; la demande.</para></note>

	  <para>Le support <application>ccd</application> peut
	    &eacute;galement charg&eacute; sous la forme d'un module
	    noyau sous FreeBSD&nbsp;4.0 et suivantes.</para>

	  <para>Pour configurer <application>ccd</application>,
	    vous devez tout d'abord utiliser &man.disklabel.8;
	    pour lab&eacute;liser les disques:</para>

	  <programlisting>disklabel -r -w ad1 auto
disklabel -r -w ad2 auto
disklabel -r -w ad3 auto</programlisting>

	  <para>Cela a cr&eacute;&eacute; un label de disque
	    <devicename>ad1c</devicename>,
	    <devicename>ad2c</devicename> et
	    <devicename>ad3c</devicename> qui s'&eacute;tend sur
	    l'int&eacute;gralit&eacute; du disque.</para>

	  <note><para>Depuis la version &os;&nbsp;5.1-RELEASE,
	    l'utilitaire &man.bsdlabel.8; remplace l'ancien programme
	    &man.disklabel.8;.  Avec &man.bsdlabel.8; de nombreuses
	    options et param&egrave;tres obsol&egrave;tes ont
	    &eacute;t&eacute; retir&eacute;s; dans les exemples ci-dessus,
	    l'option <option>-r</option> doit &ecirc;tre enlev&eacute;e.
	    Pour plus d'information, consultez la page de manuel
	    &man.bsdlabel.8;.</para></note>

	  <para>L'&eacute;tape suivante est de modifier le type de label de
	    disque.  Vous pouvez utiliser &man.disklabel.8; pour
	    &eacute;diter les disques:</para>

	  <programlisting>disklabel -e ad1
disklabel -e ad2
disklabel -e ad3</programlisting>

	  <para>Cela ouvre le label de disque actuel de chaque
	    disque dans l'&eacute;diteur fix&eacute; par la variable
	    d'environnement <envar>EDITOR</envar>,
	    g&eacute;n&eacute;ralement, &man.vi.1;.</para>

	  <para>Un label de disque non modifi&eacute; ressemblera
	    &agrave; quelque chose comme ceci:</para>

	  <programlisting>8 partitions:
#        size   offset    fstype   [fsize bsize bps/cpg]
  c: 60074784        0    unused        0     0     0   # (Cyl.    0 - 59597)</programlisting>

	  <para>Ajoutez une nouvelle partition
	    <literal>e</literal> pour &ecirc;tre utilis&eacute; par
	    &man.ccd.4;.  Cela peut &ecirc;tre une copie de la
	    partition <literal>c</literal> mais le type de syst&egrave;me
	    de fichiers (<option>fstype</option>) doit &ecirc;tre
	    <userinput>4.2BSD</userinput>.  Le label de disque devait
	    ressembler &agrave;:</para>

	  <programlisting>8 partitions:
#        size   offset    fstype   [fsize bsize bps/cpg]
  c: 60074784        0    unused        0     0     0   # (Cyl.    0 - 59597)
  e: 60074784        0    4.2BSD        0     0     0   # (Cyl.    0 - 59597)</programlisting>

	</sect4>

	<sect4 id="ccd-buildingfs">
	  <title>Cr&eacute;ation du syst&egrave;me de fichiers</title>

	  <para>Le fichier sp&eacute;cial de p&eacute;riph&eacute;rique
	    pour <devicename>ccd0c</devicename> peut ne pas
	    exister encore, aussi pour le cr&eacute;er, lancez les
	    commandes suivantes:</para>

	  <programlisting>cd /dev
sh MAKEDEV ccd0</programlisting>

	  <note><para>Sous FreeBSD 5.0, &man.devfs.5; g&egrave;rera
	    automatiquement les fichiers sp&eacute;ciaux de
	    p&eacute;riph&eacute;rique dans <filename>/dev</filename>,
	    aussi l'utilisation de  <command>MAKEDEV</command>
	    n'est pas n&eacute;cessaire.</para></note>

	  <para>Maintenant que tous les disques sont lab&eacute;lis&eacute;s,
	    vous devez construire le &man.ccd.4;.  Pour cela,
	    utilisez &man.ccdconfig.8;, avec des options semblables
	    &agrave; ce qui suit:</para>

	    <programlisting>ccdconfig ccd0<co id="co-ccd-dev"> 32<co id="co-ccd-interleave"> 0<co id="co-ccd-flags"> /dev/ad1e<co id="co-ccd-devs"> /dev/ad2e /dev/ad3e</programlisting>

	  <para>L'utilisation et la signification de chaque option
	    est donn&eacute;es ci-dessous:</para>

          <calloutlist>
            <callout arearefs="co-ccd-dev">
	    <para>Le premier argument est le p&eacute;riph&eacute;rique
	      &agrave; configurer, dans ce cas,
	      <devicename>/dev/ccd0c</devicename>. La partie
	      <filename>/dev/</filename> est optionnelle.</para>
            </callout>

            <callout arearefs="co-ccd-interleave">

	    <para>L'entrelacement (&ldquo;interleave&rdquo;) du
	      syst&egrave;me de fichiers.  L'entrelacement d&eacute;finit
	      la taille d'une bande de blocs disque, de 512 octets
	      chacune normalement.  Donc un entrelacement de 32
	      serait d'une largeur de 16384 octets.</para>
            </callout>

            <callout arearefs="co-ccd-flags">
	    <para>Param&egrave;tres pour &man.ccdconfig.8;.  Si vous
	      d&eacute;sirez activer les miroirs disque, vous pouvez
	      sp&eacute;cifier un indicateur &agrave; cet endroit.  Cette
	      configuration ne fournit pas de miroir pour
	      &man.ccd.4;, aussi l'indicateur est a 0
	      (z&eacute;ro).</para>
            </callout>

            <callout arearefs="co-ccd-devs">
	    <para>Les derniers arguments de &man.ccdconfig.8;
	      sont les p&eacute;riph&eacute;riques &agrave; placer dans
	      le disque concat&eacute;n&eacute;.  Utilisez le chemin
	      complet pour chaque p&eacute;riph&eacute;rique.</para>
            </callout>
          </calloutlist>

	  <para>Apr&egrave;s avoir utilis&eacute; &man.ccdconfig.8; le
	    &man.ccd.4; est configur&eacute;.  Un syst&egrave;me de fichiers
	    peut &ecirc;tre cr&eacute;&eacute;.  Consultez la page de manuel de
	    &man.newfs.8; pour les options disponibles, ou lancez
	    simplement:</para>

	  <programlisting>newfs /dev/ccd0c</programlisting>

	</sect4>

	<sect4 id="ccd-auto">
	  <title>Automatiser la proc&eacute;dure</title>

	  <para>G&eacute;n&eacute;ralement, vous voudrez monter le
	    &man.ccd.4; &agrave; chaque red&eacute;marrage.  Pour cela,
	    vous devez le configurer avant toute chose.
	    Ecrivez votre configuration actuelle dans
	    <filename>/etc/ccd.conf</filename> en utilisant la
	    commande suivante:</para>

	  <programlisting>ccdconfig -g &gt; /etc/ccd.conf</programlisting>

	  <para>Lors du d&eacute;marrage, la proc&eacute;dure
	    <command>/etc/rc</command> ex&eacute;cute
	    <command>ccdconfig -C</command> si
	    <filename>/etc/ccd.conf</filename> existe.  Cela configure
	    automatiquement le &man.ccd.4; de fa&ccedil;on
	    &agrave; pouvoir &ecirc;tre mont&eacute;.</para>

	  <note><para>Si vous d&eacute;marrez en mode mono-utilisateur,
	    avant que vous ne puissiez monter le &man.ccd.4;, vous
	    devez utiliser la commande suivante pour configurer
	    l'unit&eacute;:</para>

	    <programlisting>ccdconfig -C</programlisting>
	  </note>

	  <para>Pour monter automatiquement le &man.ccd.4;
	    placez une entr&eacute;es pour le &man.ccd.4; dans
	    <filename>/etc/fstab</filename>, il sera ainsi mont&eacute;
	    au d&eacute;marrage:</para>

	  <programlisting>/dev/ccd0c              /media       ufs     rw      2       2</programlisting>
	</sect4>
      </sect3>

      <sect3 id="vinum">
	<title>Le gestionnaire de volume Vinum</title>

<indexterm><primary>RAID</primary><secondary>Logiciel</secondary></indexterm>
  <indexterm>
    <primary>RAID</primary>
    <secondary>Vinum</secondary>
</indexterm>

	<para>Le gestionnaire de volume Vinum est un pilote
	  de p&eacute;riph&eacute;rique de gestion de disques
	  virtuels.  Il s&eacute;pare le disque mat&eacute;riel de l'interface
	  de p&eacute;riph&eacute;rique bloc et organise les donn&eacute;es
	  de telle fa&ccedil;on qu'il en r&eacute;sulte une am&eacute;lioration
	  de la flexibilit&eacute;, des performances et de la
	  fiabilit&eacute;, compar&eacute; &agrave; la vision
	  traditionnelle sous forme partitionn&eacute;e du stockage
	  disque.  &man.vinum.8; impl&eacute;mente les mod&egrave;les
	  RAID-0, RAID-1 et RAID-5, individuellement ou
	  combin&eacute;s.</para>

	<para>Voir le <xref linkend="vinum-vinum"> pour plus
	  d'information au sujet de &man.vinum.8;.</para>
      </sect3>
    </sect2>

    <sect2 id="raid-hard">
      <title>RAID Mat&eacute;riel</title>

      <indexterm>
	<primary>RAID</primary>
	<secondary>Mat&eacute;riel</secondary>
      </indexterm>
      <para>FreeBSD supporte &eacute;galement de nombreux contr&ocirc;leurs
	<acronym>RAID</acronym>.  Ces p&eacute;riph&eacute;riques
	peuvent contr&ocirc;ler un syst&egrave;me <acronym>RAID</acronym>
	sans n&eacute;cessiter l'utilisation d'un logiciel sp&eacute;cifique
	pour &os; pour g&eacute;rer l'unit&eacute;.</para>

      <para>En utilisant son propre <acronym>BIOS</acronym>, la carte
	contr&ocirc;le la plupart des op&eacute;rations disque.  Ce qui
	suit est une description rapide d'une configuration utilisant
	un contr&ocirc;leur <acronym>Promise IDE RAID</acronym>.
	Quand cette carte est install&eacute;e et le syst&egrave;me
	red&eacute;marr&eacute;, une invite s'affichera posant quelques
	questions.  Suivez les instructions &agrave; l'&eacute;cran
	pour atteindre l'&eacute;cran de configuration de la carte.
	A partir de l&agrave;, vous avez la possibilit&eacute; de combiner
	tous les disques attach&eacute;s.  En faisant cela, les
	disques appara&icirc;tront sous la forme d'un unique disque
	sous FreeBSD.  D'autres niveaux <acronym>RAID</acronym>
	peuvent &ecirc;tre configur&eacute;s en cons&eacute;quence.</para>
    </sect2>

    <sect2>
      <title>Reconstruire une unit&eacute; ATA RAID1</title>

      <para>FreeBSD vous permet de remplacer &agrave; chaud
	un disque d&eacute;fectueux dans une unit&eacute;.  Cela doit
	&ecirc;tre fait avant red&eacute;marrage.</para>

      <para>Vous verrez probablement dans
	<filename>/var/log/messages</filename> ou dans la sortie de
	&man.dmesg.8; quelque chose comme:</para>

      <programlisting>ad6 on monster1 suffered a hard error.
ad6: READ command timeout tag=0 serv=0 - resetting
ad6: trying fallback to PIO mode
ata3: resetting devices .. done
ad6: hard error reading fsbn 1116119 of 0-7 (ad6 bn 1116119; cn 1107 tn 4 sn 11) status=59 error=40
ar0: WARNING - mirror lost</programlisting>

      <para>En utilisant &man.atacontrol.8;, recherchez
	de plus amples informations:</para>

      <screen>&prompt.root; <userinput>atacontrol list</userinput>
ATA channel 0:
	Master:      no device present
	Slave:   acd0 &lt;HL-DT-ST CD-ROM GCR-8520B/1.00&gt; ATA/ATAPI rev 0

ATA channel 1:
	Master:      no device present
	Slave:       no device present

ATA channel 2:
	Master:  ad4 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
	Slave:       no device present

ATA channel 3:
	Master:  ad6 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
	Slave:       no device present

&prompt.root; <userinput>atacontrol status ar0</userinput>
ar0: ATA RAID1 subdisks: ad4 ad6 status: DEGRADED</screen>

      <procedure>
	<step>
	  <para>Vous devrez d&eacute;tacher le disque de l'unit&eacute;
	    de fa&ccedil;on &agrave; pouvoir le retirer sans risque:</para>

	  <screen>&prompt.root; <userinput>atacontrol detach 3</userinput></screen>
	</step>

	<step>
	  <para>Remplacer le disque.</para>
	</step>

	<step>
	  <para>Rattacher le disque de rechange:</para>

	  <screen>&prompt.root; <userinput>atacontrol attach 3</userinput>
Master:  ad6 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
Slave:   no device present</screen>
	</step>

	<step>
	  <para>Recontruire l'unit&eacute;:</para>

	  <screen>&prompt.root; <userinput>atacontrol rebuild ar0</userinput></screen>
	</step>

	<step>
	  <para>La commande de reconstruction se bloque jusqu'&agrave;
	    accomplissement.  Cependant, il est possible d'ouvrir
	    un autre terminal (en utilisant <keycombo
	    action="simul"><keycap>Alt</keycap><keycap>F<replaceable>n</replaceable></keycap></keycombo>)
	    et contr&ocirc;ler l'avanc&eacute;e de la
	    proc&eacute;dure en utilisant la commande suivante:</para>

	  <screen>&prompt.root; <userinput>dmesg | tail -10</userinput>
[output removed]
ad6: removed from configuration
ad6: deleted from ar0 disk1
ad6: inserted into ar0 disk1 as spare

&prompt.root; <userinput>atacontrol status ar0</userinput>
ar0: ATA RAID1 subdisks: ad4 ad6 status: REBUILDING 0% completed</screen>
	</step>

	<step>
	  <para>Attendre jusqu'&agrave; la fin de cette op&eacute;ration.</para>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 id="creating-cds">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Mike</firstname>
	  <surname>Meyer</surname>
	  <contrib>Contribution de </contrib>
	  <!-- mwm@mired.org -->
	</author>
      </authorgroup>
      <!-- Apr 2001 -->
    </sect1info>

    <title>Cr&eacute;ation et utilisation de supports optiques (CDs
      &amp; DVDs)</title>
    <indexterm>
      <primary>CDROMs</primary>
      <secondary>cr&eacute;ation</secondary>
    </indexterm>

    <sect2>
      <title>Introduction</title>

      <para>Les CDs se diff&eacute;rencient des disques conventionnels
	par de nombreuses caract&eacute;ristiques.  Au d&eacute;part, ils
	n'&eacute;taient pas inscriptible par l'utilisateur.  Ils sont
	con&ccedil;u pour &ecirc;tre lut de fa&ccedil;on continue sans
	d&eacute;lai
	pour d&eacute;placer la t&ecirc;te de lecture entre les pistes.
	Ils sont &eacute;galement plus facile &agrave; d&eacute;placer
	entre syst&egrave;mes que les supports de m&ecirc;me taille
	&agrave; cette &eacute;poque.</para>

      <para>Les CDs poss&egrave;dent des pistes, mais cela fait
	r&eacute;f&eacute;rence &agrave; un ensemble de donn&eacute;es
	qui peuvent &ecirc;tre lues de fa&ccedil;on continue et non pas
	&agrave; une particularit&eacute; physique du disque.  Pour produire
	un CD sous FreeBSD, il faut pr&eacute;parer les fichiers
	de donn&eacute;es qui vont constituer les pistes sur le CD, puis
	&eacute;crire les pistes sur le CD.</para>

      <indexterm><primary>ISO 9660</primary></indexterm>
      <indexterm>
        <primary>syst&egrave;mes de fichiers</primary>
        <secondary>ISO 9660</secondary>
      </indexterm>
      <para>Le syst&egrave;me de fichiers ISO 9660 a &eacute;t&eacute;
	con&ccedil;u pour g&eacute;rer ces diff&eacute;rences.
	Malheureusement il incorpore
	des limites du syst&egrave;me de fichiers qui semblaient normale
	alors.  Mais heureusement, il fournit un m&eacute;canisme
	d'extension qui permet au CDs proprement grav&eacute;s de passer
	outre ces limites tout en restant lisibles par les syst&egrave;mes
	qui ne supportent pas ces extensions.</para>

      <indexterm>
        <primary><filename role="package">sysutils/mkisofs</filename></primary>
      </indexterm>
      <para>Le programme <filename role="package">sysutils/mkisofs</filename>
	est utilis&eacute; pour produire un fichier de donn&eacute;es
	contenant un syst&egrave;me de fichiers ISO 9660.  Il dispose
	d'options pour le support de diverses extensions, et est
	d&eacute;crit ci-dessous.  Vous pouvez l'installer par
	l'interm&eacute;diaire du logiciel port&eacute; <filename
	role="package">sysutils/mkisofs</filename>.</para>

      <indexterm>
        <primary>graveur de CD</primary>
        <secondary>ATAPI</secondary>
      </indexterm>
      <para>L'outil a utiliser pour graver un CD varie en fonction du
	type de graveur de CD: ATAPI ou autre.  Les graveurs ATAPI
	utilisent le programme <command><link
	linkend="burncd">burncd</link></command> qui fait partie
	du syst&egrave;me de base.  Les graveurs SCSI ou USB devraient
	utiliser l'utilitaire <command><link
	linkend="cdrecord">cdrecord</link></command> du logiciel port&eacute;
	<filename role="package">sysutils/cdrtools</filename> port.</para>

      <para><command>burncd</command> supporte un nombre limit&eacute;
	de graveurs.  Pour d&eacute;terminer si un graveur est support&eacute;,
	voir la liste des <ulink url="http://www.freebsd.dk/ata/">graveurs
	CD-R/RW support&eacute;s</ulink>.</para>

      <note>
      <indexterm>
	<primary>graveur de CD</primary>
	<secondary>pilote ATAPI/CAM</secondary>
      </indexterm>
	<para>Si vous utilisez &os;&nbsp;5.X, &os;&nbsp;4.8-RELEASE ou
	  une version suivante, il sera possible d'utiliser
	  <command><link linkend="cdrecord">cdrecord</link></command>
	  et d'autres outils pour lecteurs SCSI sur du mat&eacute;riel
	  ATAPI avec le <link linkend="atapicam">module
	  ATAPI/CAM</link>.</para>
      </note>
    </sect2>

    <sect2 id="mkisofs">
      <title>mkisofs</title>

      <para>L'utilitaire <filename role="package">sysutils/mkisofs</filename>
	produit un syst&egrave;me de fichiers ISO 9660 qui est une image de
	l'arborescence des r&eacute;pertoires dans un syst&egrave;me de fichiers
	&unix;.  L'utilisation la plus simple est:</para>

      <screen>&prompt.root; <userinput>mkisofs -o <replaceable>fichierimage.iso</replaceable> <replaceable>/chemin/vers/arborescence</replaceable></userinput></screen>

      <indexterm>
        <primary>syst&egrave;mes de fichiers</primary>
        <secondary>ISO 9660</secondary>
      </indexterm>
      <para>Cette commande cr&eacute;era un
	<replaceable>fichierimage.iso</replaceable> contenant un
	syst&egrave;me de fichiers ISO 9660 qui est une copie de
	l'arborescence
	<replaceable>/chemin/vers/arborescence</replaceable>.
	Durant le processus de cr&eacute;ation, les noms de fichiers
	seront modifi&eacute;s de fa&ccedil;on &agrave; respecter les
	limitations de la norme ISO 9660, et rejettera les fichiers ayant
	des noms non acceptables pour un syst&egrave;me de fichiers
	ISO.</para>

      <indexterm>
        <primary>syst&egrave;mes de fichiers</primary>
        <secondary>HFS</secondary>
      </indexterm>
      <indexterm>
        <primary>syst&egrave;mes de fichiers</primary>
        <secondary>Joliet</secondary>
      </indexterm>
      <para>De nombreuses options sont disponibles pour passer
	outre ces restrictions.  En particulier, <option>-R</option>
	qui autorise les extensions Rock Ridge communes aux syst&egrave;mes
	&unix;, <option>-J</option> qui active les extensions Joliet
	utilis&eacute;es par les syst&egrave;mes Microsoft, et
	<option>-hfs</option> peut &ecirc;tre utilis&eacute; pour cr&eacute;er
	des syst&egrave;mes de fichiers HFS utilis&eacute;s par &macos;.</para>

      <para>Pour des CDs qui sont destin&eacute;s &agrave; n'&ecirc;tre
	utilis&eacute; que sur des syst&egrave;mes &os;, l'option
	<option>-U</option> peut &ecirc;tre utilis&eacute;e pour
	d&eacute;sactiver toutes les restrictions au niveau des noms de
	fichiers.  Quand elle est utilis&eacute;e avec l'option
	<option>-R</option>, cela produit une image de syst&egrave;me de
	fichiers qui est identique &agrave; l'arborescence &os; d'origine,
	cependant ce syst&egrave;me de fichiers pourra violer la norme ISO
	9660 de nombreuses fa&ccedil;on.</para>

      <indexterm>
        <primary>CDROMs</primary>
        <secondary>cr&eacute;ation d'un CDROM bootable</secondary>
      </indexterm>
      <para>La derni&egrave;re option d'usage g&eacute;n&eacute;ral est l'option
	<option>-b</option>.  Elle est utilis&eacute;e pour indiquer
	l'emplacement de l'image de d&eacute;marrage &agrave; utiliser dans
	la cr&eacute;ation d'un CD d&eacute;marrable <quote>El Torito</quote>.
	Cette option prend en argument le chemin vers une image
	de d&eacute;marrage &agrave; partir de la racine de l'arborescence
	qui va &ecirc;tre copi&eacute;e sur le CD.  Aussi,
	&eacute;tant donn&eacute; que
	<filename>/tmp/monboot</filename> contient un syst&egrave;me &os;
	avec une image de d&eacute;marrage dans
	<filename>/tmp/monboot/boot/cdboot</filename>, vous pourrez
	produire l'image d'un syst&egrave;me de fichiers ISO 9660 dans
	<filename>/tmp/bootable.iso</filename> de cette fa&ccedil;on:</para>

      <screen>&prompt.root; <userinput>mkisofs -U -R -b boot/cdboot -o /tmp/bootable.iso /tmp/monboot</userinput></screen>

      <para>Cela &eacute;tant fait, si vous avez le pilote
	<devicename>vn</devicename> (FreeBSD&nbsp;4.X), ou
	<devicename>md</devicename> (FreeBSD&nbsp;5.X) configur&eacute;
	dans votre noyau, vous pouvez monter le syst&egrave;me de fichiers
	avec:</para>

      <screen>&prompt.root; <userinput>vnconfig -e vn0c /tmp/bootable.iso</userinput>
&prompt.root; <userinput>mount -t cd9660 /dev/vn0c /mnt</userinput></screen>

      <para>pour FreeBSD&nbsp;4.X, et pour FreeBSD&nbsp;5.X:</para>

      <screen>&prompt.root; <userinput>mdconfig -a -t vnode -f /tmp/bootable.iso -u 0</userinput>
&prompt.root; <userinput>mount -t cd9660 /dev/md0 /mnt</userinput></screen>

      <para>A ce moment vous pouvez v&eacute;rifier que
	<filename>/mnt</filename> et <filename>/tmp/monboot</filename>
	sont identique.</para>

      <para>Il existe de nombreuses autres options que vous pouvez
	utiliser avec <filename role="package">sysutils/mkisofs</filename>
	pour r&eacute;gler finement son comportement.  En particulier: les
	modifications d'une organisation ISO 9660 et la cr&eacute;ation de
	disques Joliet et HFS.  Voir la page de manuel &man.mkisofs.8;
	pour plus de d&eacute;tails.</para>
    </sect2>

    <sect2 id="burncd">
      <title>burncd</title>
      <indexterm>
        <primary>CDROMs</primary>
        <secondary>gravure</secondary>
      </indexterm>
      <para>Si vous disposez d'un graveur de CD ATAPI, vous pouvez
	utiliser la commande <command>burncd</command> pour graver
	une image ISO sur un CD.  <command>burncd</command> fait
	partie du syst&egrave;me de base, install&eacute; sous
	<filename>/usr/sbin/burncd</filename>.  Son utilisation est
	tr&egrave;s simple, car il dispose de peu d'options:</para>

      <screen>&prompt.root; <userinput>burncd -f <replaceable>cddevice</replaceable> data <replaceable>fichierimage.iso</replaceable> fixate</userinput></screen>

      <para>Gravera une copie de
	<replaceable>fichierimage.iso</replaceable> sur
	<replaceable>cddevice</replaceable>.  Le p&eacute;riph&eacute;rique par
	d&eacute;faut est <filename>/dev/acd0c</filename>.  Consultez
	&man.burncd.8; pour les options pour fixer la vitesse
	d'&eacute;criture, &eacute;jecter le CD apr&egrave;s gravure, et graver
	des donn&eacute;es audios.</para>
    </sect2>

    <sect2 id="cdrecord">
      <title>cdrecord</title>

      <para>Si vous n'avez pas de graveur de CD ATAPI, vous devrez
	utiliser <command>cdrecord</command> pour graver vos CDs.
	<command>cdrecord</command> ne fait pas partie du syst&egrave;me de
	base; vous devez l'installer soit &agrave; partir du logiciel
	port&eacute; <filename role="package">sysutils/cdrtools</filename>
	ou de la version pr&eacute;-compil&eacute;e appropri&eacute;e.
	Des modifications du syst&egrave;me de base peuvent provoquer
	le disfonctionnement des versions binaires de ce programme,
	et donner lieu &agrave; une production de &ldquo;dessous de
	bouteille&rdquo;.  Vous devrez par cons&eacute;quent soit
	mettre &agrave; jour le logiciel port&eacute; quand vous mettez
	&agrave; jour votre syst&egrave;me, soit si vous <link
	linkend="stable">suivez la branche -STABLE</link>, mettre
	&agrave; jour le logiciel port&eacute; lorsqu'une nouvelle
	version est disponible.</para>

      <para>Bien que <command>cdrecord</command> dispose de
	nombreuses options, l'usage de base est m&ecirc;me plus simple
	qu'avec <command>burncd</command>.  La gravure d'une image
	ISO 9660 se fait avec:</para>

      <screen>&prompt.root; <userinput>cdrecord dev=<replaceable>device</replaceable> <replaceable>fichierimage.iso</replaceable></userinput></screen>

      <para>La partie d&eacute;licate dans l'utilisation de
	<command>cdrecord</command> est la recherche de la valeur &agrave;
	utiliser pour l'option <option>dev</option>.  Pour d&eacute;terminer
	le bon param&egrave;tre &agrave; utiliser, utilisez l'indicateur
	<option>-scanbus</option> de <command>cdrecord</command>,
	qui produira des r&eacute;sultats du type:</para>
      <indexterm>
        <primary>CDROMs</primary>
        <secondary>gravure</secondary>
      </indexterm>
      <screen>&prompt.root; <userinput>cdrecord -scanbus</userinput>
Cdrecord 1.9 (i386-unknown-freebsd4.2) Copyright (C) 1995-2000 J&ouml;rg Schilling
Using libscg version 'schily-0.1'
scsibus0:
        0,0,0     0) 'SEAGATE ' 'ST39236LW       ' '0004' Disk
        0,1,0     1) 'SEAGATE ' 'ST39173W        ' '5958' Disk
        0,2,0     2) *
        0,3,0     3) 'iomega  ' 'jaz 1GB         ' 'J.86' Removable Disk
        0,4,0     4) 'NEC     ' 'CD-ROM DRIVE:466' '1.26' Removable CD-ROM
        0,5,0     5) *
        0,6,0     6) *
        0,7,0     7) *
scsibus1:
        1,0,0   100) *
        1,1,0   101) *
        1,2,0   102) *
        1,3,0   103) *
        1,4,0   104) *
        1,5,0   105) 'YAMAHA  ' 'CRW4260         ' '1.0q' Removable CD-ROM
        1,6,0   106) 'ARTEC   ' 'AM12S           ' '1.06' Scanner
        1,7,0   107) *</screen>

      <para>Cela donne la valeur <option>dev</option> appropri&eacute;e
	pour les p&eacute;riph&eacute;riques list&eacute;s.
	Recherchez votre graveur de
	CD dans la liste, et utilisez les trois chiffres s&eacute;par&eacute;s
	par une virgule comme valeur pour <option>dev</option>.
	Dans notre cas le p&eacute;riph&eacute;rique de gravure est 1,5,0, donc
	l'entr&eacute;e appropri&eacute;e serait <option>dev=1,5,0</option>.
	Il existe des mani&egrave;res plus simple de sp&eacute;cifier
	cette valeur, consultez la page de manuel &man.cdrecord.1;
	pour des d&eacute;tails.
	C'est &eacute;galement la documentation &agrave;
	consulter pour des informations sur la gravure de pistes
	audios, le contr&ocirc;le de la vitesse, et d'autres
	choses.</para>
    </sect2>

    <sect2 id="duplicating-audiocds">
      <title>Dupliquer des CDs Audio</title>

      <para>Vous pouvez dupliquer un CD audio en effectuant
	l'extraction des donn&eacute;es audio du CD vers un ensemble de
	fichiers, puis graver ces fichiers sur un CD vierge.  Le
	processus est l&eacute;g&egrave;rement diff&eacute;rent entre
	lecteurs ATAPI et SCSI.</para>

      <procedure>
	<title>Lecteurs SCSI</title>

	<step>
	  <para>Utiliser <command>cdda2wav</command> pour effectuer
	  l'extraction audio.</para>

	  <screen>&prompt.user; <userinput>cdda2wav -v255 -D2,0 -B -Owav</userinput></screen>
	</step>

	<step>
	  <para>Utiliser <command>cdrecord</command> pour graver les
	  fichiers <filename>.wav</filename>.</para>

	  <screen>&prompt.user; <userinput>cdrecord -v dev=<replaceable>2,0</replaceable> -dao -useinfo  *.wav</userinput></screen>

	  <para>Assurez-vous que <replaceable>2.0</replaceable> est
	    choisi correctement, comme d&eacute;crit dans
	    <xref linkend="cdrecord">.</para>
	</step>
      </procedure>

      <procedure>
	<title>Lecteurs ATAPI</title>

	<step>
	  <para>Le pilote CD ATAPI rend disponible chaque piste
	    sous la forme
	    <filename>/dev/acd<replaceable>d</replaceable>t<replaceable>nn</replaceable></filename>,
	    o&ugrave; <replaceable>d</replaceable> est le num&eacute;ro de
	    lecteur, et <replaceable>nn</replaceable> est le num&eacute;ro
	    de la piste &eacute;crit sur deux digits d&eacute;cimaux.
	    Donc la premi&egrave;re piste sur le premier
	    lecteur est <filename>/dev/acd0t01</filename>, la
	    seconde est <filename>/dev/acd0t02</filename>, la
	    troisi&egrave;me <filename>/dev/acd0t03</filename>, et
	    ainsi de suite.</para>

	  <para>Assurez-vous que les fichiers appropri&eacute;s existent
	    sous <filename>/dev</filename>.</para>

	  <screen>&prompt.root; <userinput>cd /dev</userinput>
&prompt.root; <userinput>sh MAKEDEV acd0t99</userinput></screen>

	  <note><para>Sous FreeBSD&nbsp;5.X, &man.devfs.5; cr&eacute;era
	    et g&egrave;rera automatiquement pour vous les entr&eacute;es
	    sous <filename>/dev</filename>, il n'est donc pas
	    n&eacute;cessaire d'utiliser
	    <command>MAKEDEV</command>.</para></note>
	</step>

	<step>
	  <para>Extraire chaque piste en utilisant &man.dd.1;.
	    Vous devez &eacute;galement pr&eacute;ciser une taille de
	    bloc durant l'extraction des fichiers.</para>

	  <screen>&prompt.root; <userinput>dd if=/dev/acd0t01 of=piste1.cdr bs=2352</userinput>
&prompt.root; <userinput>dd if=/dev/acd0t02 of=piste2.cdr bs=2352</userinput>
...
</screen>
	</step>

	<step>
	  <para>Graver les fichiers r&eacute;cup&eacute;r&eacute;s en utilisant
	    <command>burncd</command>.  Vous devez sp&eacute;cifier que ce
	    sont des fichiers audio, et que <command>burncd</command>
	    devra fermer le disque une fois termin&eacute;.</para>

	  <screen>&prompt.root; <userinput>burncd -f <replaceable>/dev/acd0c</replaceable> audio piste1.cdr piste2.cdr <replaceable>...</replaceable> fixate</userinput></screen>
	</step>
      </procedure>
    </sect2>

    <sect2 id="imaging-cd">
      <title>Dupliquer des CDs de donn&eacute;es</title>

      <para>vous pouvez copier un CD de donn&eacute;es vers un
	fichier image &eacute;quivalent au fichier cr&eacute;&eacute; avec
	<filename role="package">sysutils/mkisofs</filename>, et
	vous pouvez l'utiliser pour dupliquer n'importe quel CD de
	donn&eacute;es.  L'exemple pr&eacute;sent&eacute; ici suppose
	que votre lecteur de CDROM est les p&eacute;riph&eacute;rique
	<devicename>acd0</devicename>.  Remplacez-le avec le
	p&eacute;riph&eacute;rique correct.  Un <literal>c</literal> doit
	&ecirc;tre ajout&eacute; &agrave; la fin du nom du
	p&eacute;riph&eacute;rique
	pour indiquer l'int&eacute;gralit&eacute; de la partition, ou dans le
	cas de CDROMS, l'int&eacute;gralit&eacute; du disque.</para>

      <screen>&prompt.root; <userinput>dd if=/dev/acd0c of=fichier.iso bs=2048</userinput></screen>

      <para>Vous disposez maintenant d'une image, vous pouvez la
	graver comme d&eacute;crit plus haut.</para>
    </sect2>

    <sect2 id="mounting-cd">
      <title>Utiliser des CDs de donn&eacute;es</title>

      <para>Maintenant que vous avez cr&eacute;&eacute; une CDROM de
	donn&eacute;es standard, vous voulez probablement le monter et lire
	les donn&eacute;es pr&eacute;sentes.  Par d&eacute;faut,
	&man.mount.8; suppose que le syst&egrave;me de fichier &agrave;
	monter est de type <literal>UFS</literal>.  Si vous essayez
	quelque chose comme:</para>

      <screen>&prompt.root; <userinput>mount /dev/cd0c /mnt</userinput></screen>

      <para>vous obtiendrez une erreur du type <errorname>Incorrect
	super block</errorname>, et pas de montage.  Le CDROM n'est
	pas un syst&egrave;me de fichiers de type <literal>UFS</literal>,
	aussi toute tentative de montage de ce type &eacute;chouera.
	Vous devez juste pr&eacute;ciser &agrave; &man.mount.8; que le
	syst&egrave;me de fichiers est du type <literal>ISO9660</literal>, et
	tout fonctionnera.  Cela se fait en sp&eacute;cifiant l'option
	<option>-t cd9660</option> option &agrave; &man.mount.8;.
	Par exemple, si vous d&eacute;sirez monter un CDROM, contenu
	dans le lecteur <devicename>/dev/cd0c</devicename>, sous
	<filename>/mnt</filename>, vous devrez ex&eacute;cuter:</para>

          <screen>&prompt.root; <userinput>mount -t cd9660 /dev/cd0c /mnt</userinput></screen>

      <para>Notez que votre nom de lecteur
	(<devicename>/dev/cd0c</devicename> dans cet exemple) pourra
	&ecirc;tre diff&eacute;rent, en fonction de l'interface
	utilis&eacute;e par votre lecteur de CDROM.  De plus l'option
	<option>-t cd9660</option> ne fait qu'ex&eacute;cuter la commande
	&man.mount.cd9660.8;.  L'exemple pr&eacute;c&eacute;dent pourrait
	&ecirc;tre r&eacute;duit &agrave;:</para>

<screen>&prompt.root; <userinput>mount_cd9660 /dev/cd0c /mnt</userinput></screen>

      <para>Vous pouvez g&eacute;n&eacute;ralement utiliser
	des CDROMs de donn&eacute;es de n'importe quelle provenance de
	cette fa&ccedil;on.  Les disques avec certaines extensions
	ISO 9660 pourront se comporter de fa&ccedil;on &eacute;trange,
	cependant.  Par exemple, les disques Joliet conservent
	tous les noms de fichiers en utilisant des caract&egrave;res
	Unicodes sur 2 octets.  Le noyau &os; ne comprend pas
	l'Unicode (pas encore!), aussi les caract&egrave;res non-anglais
	appara&icirc;tront sous la forme de points d'interrogation.
	(Si vous utilisez &os;&nbsp;4.3 ou suivantes, le pilote
	CD9660 inclus la possibilit&eacute; de charger au vol la table
	de conversion Unicode appropri&eacute;e.  Les modules
	de certains des codages classiques sont disponibles
	via le logiciel port&eacute; <filename
	role="package">sysutils/cd9660_unicode</filename>.)</para>

      <para>Occasionnellement, vous pourrez obtenir le message
	<errorname>Device not configured</errorname>
	(p&eacute;riph&eacute;rique non configur&eacute;)
	lors d'une tentative de montage
	d'un CDROM.  Cela veut g&eacute;n&eacute;ralement dire que le
	lecteur de CDROM pense qu'il n'y a pas de disque dans le
	lecteur, ou que le lecteur n'est pas visible sur le bus.
	Cela peut demander plusieurs secondes &agrave; un lecteur de
	CDROM de s'apercevoir qu'il a &eacute;t&eacute; charg&eacute;,
	soyez donc patient.</para>

      <para>Parfois, un lecteur de CDROM SCSI peut &ecirc;tre manquant
	parce qu'il n'a pas eu suffisement de temps pour r&eacute;pondre
	&agrave; la r&eacute;initialisation du bus.  Si vous avez un lecteur
	de CDROM SCSI, veuillez ajouter l'option suivante &agrave;
	la configuration de votre noyau et <link
	linkend="kernelconfig-building">recompiler votre
	noyau</link>.</para>

      <programlisting>options SCSI_DELAY=15000</programlisting>

      <para>Ceci demande &agrave; votre bus SCSI une pause de 15 seconds
	au d&eacute;marrage, pour donner &agrave; votre lecteur de CDROM une chance
	de r&eacute;pondre la r&eacute;initialisation du bus.</para>
    </sect2>

    <sect2 id="rawdata-cd">
      <title>Graver des CDs de donn&eacute;es brutes</title>

      <para>Il est possible de graver directement un fichier sur CD,
	sans cr&eacute;er de syst&egrave;me de fichiers ISO 9660.
	Certaines personnes le font dans le cas de sauvegardes.
	Cela est beaucoup plus rapide que de graver un CD
	standard:</para>

      <screen>&prompt.root; <userinput>burncd -f /dev/acd1c -s 12 data archive.tar.gz fixate</userinput></screen>

      <para>Afin de r&eacute;cup&eacute;rer les donn&eacute;es grav&eacute;es
	sur un tel CD, vous devez lire les donn&eacute;es &agrave;
	partir du fichier sp&eacute;cial de p&eacute;riph&eacute;riques
	en mode caract&egrave;re:</para>

      <screen>&prompt.root; <userinput>tar xzvf /dev/acd1c</userinput></screen>

      <para>Vous ne pouvez monter ce disque comme vous le feriez avec
	un CDROM classique.  Un tel CDROM ne pourra &ecirc;tre lu
	sous un autre syst&egrave;me d'exploitation en dehors de &os;.
	Si vous voulez &ecirc;tre en mesure de monter le CD, ou
	d'en partager les donn&eacute;es avec un autre syst&egrave;me
	d'exploitation, vous devez utiliser
	<filename role="package">sysutils/mkisofs</filename> comme
	d&eacute;crit plus haut.</para>
    </sect2>

    <sect2 id="atapicam">
      <indexterm>
	<primary>graveur de CD</primary>
	<secondary>pilote ATAPI/CAM</secondary>
      </indexterm>
      <title>Utilisation du pilote de p&eacute;riph&eacute;rique
	ATAPI/CAM</title>

      <para>Ce pilote permet d'acc&eacute;der aux p&eacute;riph&eacute;riques
	ATAPI (lecteurs de CD-ROM, graveurs CD-RW, lecteur de DVD etc...)
	par l'interm&eacute;diaire du sous-syst&egrave;me SCSI, et
	autorise l'utilisation d'applications comme <filename
	role="package">sysutils/cdrdao</filename> ou
	&man.cdrecord.1;.</para>

      <para>Pour utiliser ce pilote, vous devrez ajouter les lignes
	suivantes &agrave; fichier de configuration du noyau:</para>

      <programlisting>device atapicam
device scbus
device cd
device pass</programlisting>

      <para>Vous avez &eacute;galement besoin des lignes suivantes dans
	votre fichier de configuration:</para>

      <programlisting>device ata
device atapicd</programlisting>

      <para>Ces deux lignes devraient &ecirc;tre d&eacute;j&agrave;
	pr&eacute;sentent.</para>

      <para>Puis recompilez, installez votre nouveau noyau, et
	red&eacute;marrez votre machine.  Lors du d&eacute;marrage, votre
	graveur devrait appara&icirc;tre, comme suit:</para>

      <screen>acd0: CD-RW &lt;MATSHITA CD-RW/DVD-ROM UJDA740&gt; at ata1-master PIO4
cd0 at ata1 bus 0 target 0 lun 0
cd0: &lt;MATSHITA CDRW/DVD UJDA740 1.00&gt; Removable CD-ROM SCSI-0 device
cd0: 16.000MB/s transfers
cd0: Attempt to query device size failed: NOT READY, Medium not present - tray closed</screen>

      <para>Le lecteur doit &ecirc;tre accessible via le nom de
	p&eacute;riph&eacute;rique <filename>/dev/cd0</filename>,
	par exemple pour monter un CD-ROM sous
	<filename>/mnt</filename>, tapez juste ce qui suit:</para>

      <screen>&prompt.root; <userinput>mount -t cd9660 <replaceable>/dev/cd0c</replaceable> /mnt</userinput></screen>

      <para>En tant que <username>root</username>, vous pouvez
	ex&eacute;cuter la commande suivante pour obtenir l'adresse SCSI du
	graveur:</para>

      <screen>&prompt.root; <userinput>camcontrol devlist</userinput>
&lt;MATSHITA CDRW/DVD UJDA740 1.00&gt;   at scbus1 target 0 lun 0 (pass0,cd0)</screen>

      <para>Donc <literal>1,0,0</literal> sera l'adresse SCSI &agrave;
	utiliser avec &man.cdrecord.1; et tout autre application
	SCSI.</para>

      <para>Pour plus d'information concernant ATAPI/CAM et le
	syst&egrave;me SCSI, consultez les pages de manuel
	&man.atapicam.4; et &man.cam.4;.</para>
    </sect2>
  </sect1>

  <sect1 id="floppies">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Julio</firstname>
	  <surname>Merino</surname>
	  <contrib>Travail original de </contrib>
	</author>
      </authorgroup>
      <!-- 24 Dec 2001 -->
      <authorgroup>
	<author>
	  <firstname>Martin</firstname>
	  <surname>Karlsson</surname>
	  <contrib>R&eacute;&eacute;crit par </contrib>
	</author>
      </authorgroup>
      <!-- 27 Apr 2003 -->
    </sect1info>

    <title>Cr&eacute;ation et utilisation de disquettes</title>

    <para>Sauvegarder des donn&eacute;es sur disquette est
      parfois utile, par exemple quand on a pas d'autre
      support de stockage amovible de disponible ou quand on
      doit transf&eacute;rer de petites quantit&eacute;s de
      donn&eacute;es sur un autre ordaniteur.</para>

    <para>Cette section expliquera comment utiliser des disquettes
      sous &os;.  Elle couvrira principalement le formatage et
      l'utilisation de disquettes DOS de 3.5pouces, mais les
      concepts expos&eacute;s sont identiques pour d'autres formats
      de disquettes.</para>

    <sect2>
      <title>Formater des disquettes</title>

      <sect3>
	<title>Le p&eacute;riph&eacute;rique</title>

	<para>On acc&egrave;de aux disquettes par l'interm&eacute;diaire
	  d'entr&eacute;es dans <filename>/dev</filename>, comme
	  pour tout autre p&eacute;riph&eacute;rique.  Pour
	  acc&eacute;der directement &agrave; la disquette sous les
	  versions 4.X et pr&eacute;c&eacute;dentes, on peut
	  utiliser <filename>/dev/fd<replaceable>N</replaceable></filename>,
	  o&ugrave; <replaceable>N</replaceable> repr&eacute;sente le
	  num&eacute;ro de lecteur, g&eacute;n&eacute;ralement 0, ou
	  <filename>/dev/fd<replaceable>NX</replaceable></filename>,
	  o&ugrave; <replaceable>X</replaceable> est une lettre.</para>

	<para>Sous les versions 5.0 et suivantes, utilisez
	  simplement
	  <filename>/dev/fd<replaceable>N</replaceable></filename>.</para>

	<sect4>
	  <title>La capacit&eacute; des disquettes sous les versions
	    4.X et pr&eacute;c&eacute;dentes</title>

	  <para>Les p&eacute;riph&eacute;riques importants
	    sont <filename>/dev/fd<replaceable>N</replaceable>.<replaceable>size</replaceable></filename>,
	    o&ugrave; <replaceable>size</replaceable> est la taille de la
	    disquette en kilo-octets.  Ces entr&eacute;es sont utilis&eacute;es
	    au moment du formatage bas niveau pour d&eacute;terminer
	    la capacit&eacute; du disque.  1440KO est la capacit&eacute;
	    qui sera utilis&eacute;e dans les exemples suivants.</para>

	  <para>Parfois les entr&eacute;es sous <filename>/dev</filename>
	    devront &ecirc;tre (re)cr&eacute;es.  Pour cela, tapez:</para>

	  <screen>&prompt.root; <userinput>cd /dev && ./MAKEDEV "fd*"</userinput></screen>
	</sect4>

	<sect4>
	  <title>La capacit&eacute; des disquettes sous les versions
	    5.0 et suivantes</title>

	  <para>Sous FreeBSD&nbsp;5.X, &man.devfs.5;
	    g&egrave;rera automatiquement les fichiers sp&eacute;ciaux
	    de p&eacute;riph&eacute;riques sous <filename>/dev</filename>,
	    aussi l'utilisation de <command>MAKEDEV</command> n'est
	    pas n&eacute;cessaire.</para>

	  <para>La capacit&eacute; d&eacute;sir&eacute;e est pass&eacute;e &agrave;
	    &man.fdformat.1; par l'interm&eacute;diaire de l'indicateur
	    <option>-f</option>.  Les capacit&eacute;s support&eacute;es
	    sont list&eacute;es dans la page de manuel
	    &man.fdcontrol.8;, mais soyez conscients que
	    1440KO est celle qui fonctionne le mieux.</para>
	</sect4>
      </sect3>

      <sect3>
	<title>Le formatage</title>

	<para>Une disquette doit subir un formatage bas niveau avant
	  d'&ecirc;tre utilisable.  Il est g&eacute;n&eacute;ralement
	  r&eacute;alis&eacute; par le constructeuri, mais le formatage est
	  une bonne mani&egrave;re de contr&ocirc;ler
	  l'int&eacute;grit&eacute; du support.  Bien qu'il soit possible de
	  forcer une plus grande (ou plus petite) capacit&eacute;,
	  1440KO est celle pour laquelle sont con&ccedil;ues la plupart
	  des disquettes.</para>

	<para>Pour effectuer un formatage bas niveau d'une disquette
	  vous devez utiliser &man.fdformat.1;.  L'utilitaire
	  attend le nom du p&eacute;riph&eacute;rique en argument.</para>

	<para>Notez tout message d'erreur, sachant que cela peut aider
	  &agrave; d&eacute;terminer si la disquette est bonne ou
	  deffectueuse.</para>

	<sect4>
	  <title>Formatage sous les versions 4.X et
	    pr&eacute;c&eacute;dentes</title>

	    <para>Utilisez un des p&eacute;riph&eacute;riques
	    <filename>/dev/fd<replaceable>N</replaceable>.<replaceable>size</replaceable></filename>,
	    pour formater la disquette.  Ins&eacute;rez une disquette
	    3.5pouces dans votre lecteur et tapez:</para>

	    <screen>&prompt.root; <userinput>/usr/sbin/fdformat /dev/fd0.1440</userinput></screen>

	</sect4>

	<sect4>
	  <title>Formatage sous les versions 5.0 et
	    suivantes</title>

	    <para>Utilisez un des p&eacute;riph&eacute;riques
	    <filename>/dev/fd<replaceable>N</replaceable>.<replaceable>size</replaceable></filename>,
	    pour formater la disquette.  Ins&eacute;rez une disquette
	    3.5pouces dans votre lecteur et tapez:</para>

	    <screen>&prompt.root; <userinput>/usr/sbin/fdformat -f 1440 /dev/fd0</userinput></screen>

	</sect4>
      </sect3>
    </sect2>

    <sect2>
      <title>Le label de disque</title>

      <para>Apr&egrave;s le formatage bas niveau du disque, vous
	devrez y placer un label de disque.  Ce label sera
	d&eacute;truit plus tard, mais il est n&eacute;cessaire au
	syst&egrave;me pour d&eacute;terminer par la suite la taille
	et la g&eacute;om&eacute;trie du disque.</para>

      <para>Le nouveau label de disque prendra l'int&eacute;gralit&eacute;
	du disque, et contiendra l'information correcte sur la
	g&eacute;om&eacute;trie de la disquette.
	Les diff&eacute;rentes g&eacute;om&eacute;tries possibles pour le label
	sont list&eacute;es dans
	<filename>/etc/disktab</filename>.</para>

      <para>Vous pouvez maintenant ex&eacute;cuter &man.disklabel.8;
        de la fa&ccedil;on suivante:</para>

      <screen>&prompt.root; <userinput>/sbin/disklabel -B -r -w /dev/fd0 fd1440</userinput></screen>

      <note><para>Depuis la version &os;&nbsp;5.1-RELEASE,
	l'utilitaire &man.bsdlabel.8; remplace l'ancien programme
	&man.disklabel.8;.  Avec &man.bsdlabel.8; de nombreuses
	options et param&egrave;tres obsol&egrave;tes ont
	&eacute;t&eacute; retir&eacute;s; dans l'exemple ci-dessus,
	l'option <option>-r</option> doit &ecirc;tre enlev&eacute;e.
	Pour plus d'information, consultez la page de manuel
	&man.bsdlabel.8;.</para></note>
    </sect2>

    <sect2>
      <title>Le syst&egrave;me de fichiers</title>

      <para>La disquette est maintenant fin pr&ecirc;te pour un
	formatage haut niveau.  Cette op&eacute;ration placera un nouveau
	syst&egrave;me de fichiers sur la disquette, qui permettra
	&agrave; &os; d'&eacute;crire et de lire sur le disque.
	Apr&egrave;s la cr&eacute;ation du nouveau syst&egrave;me
	de fichiers, le label disque est d&eacute;truit, aussi
	si vous d&eacute;sirez reformater le disque, vous devrez
	recr&eacute;er le label de disque &agrave; nouveau.</para>

      <para>Le syst&egrave;me de fichiers de la disquette peut
	soit &ecirc;tre de l'UFS soit utiliser le syst&egrave;me FAT.
	Le syst&egrave;me FAT est g&eacute;n&eacute;ralement un meilleur choix
	pour les disquettes.</para>

      <para>Pour placer un nouveau syst&egrave;me de fichier sur la
	disquette faites ceci:</para>

      <screen>&prompt.root; <userinput>/sbin/newfs_msdos /dev/fd0</userinput></screen>

      <para>La disquette est maintenant pr&ecirc;te &agrave;
	&ecirc;tre utilis&eacute;e.</para>
    </sect2>

    <sect2>
      <title>Utilisation de la disquette</title>

      <para>Pour utiliser la disquette, montez-la avec
	&man.mount.msdos.8; (sous 4.X et versions
	pr&eacute;c&eacute;dentes) ou &man.mount.msdosfs.8; (sous 5.0
	ou nouvelles versions).  On peut &eacute;galement utiliser
	<filename role="package">emulators/mtools</filename> du
	catalogue des logiciels port&eacute;s.</para>
    </sect2>
  </sect1>

  <sect1 id="backups-tapebackups">
    <title>Cr&eacute;er et utiliser les bandes magn&eacute;tiques</title>

    <indexterm><primary>bande magn&eacute;tique</primary></indexterm>
    <para>Les principaux types de bandes sont les 4mm, 8mm, QIC, les
      mini-cartouches et les DLTs.</para>

    <sect2 id="backups-tapebackups-4mm">
      <title>Bandes 4mm (DDS: &ldquo;Digital Data Storage&rdquo;)</title>

      <indexterm>
	<primary>bande magn&eacute;tique</primary>
	<secondary>bandes DDS (4mm)</secondary>
      </indexterm>
      <indexterm>
        <primary>bande magn&eacute;tique</primary>
	<secondary>bandes QIC</secondary>
      </indexterm>
      <para>Les bandes 4mm sont en train de remplacer les bandes QIC
	comme le format usuel de sauvegarde pour les stations de
	travail.  Cette tendance s'est acc&eacute;l&eacute;r&eacute;e
	quand Conner a rachet&eacute; Archive, un des leaders de la
	fabrication des lecteurs QIC, et a arr&ecirc;t&eacute; la
	production de ces derniers.  Les lecteurs 4mm sont petits et
	silencieux mais n'ont pas la r&eacute;putation de fiabilit&eacute; des
	lecteurs 8mm.  Les cartouches sont moins co&ucirc;teuse et plus
	petites (3 x 2 x 0.5 pouces, 76 x 51 x 12 mm) que les
	cartouches 8mm.  Les cartouches 4mm, tout comme les 8mm, ont
	une dur&eacute;e de vie faible car elles utilisent un
	proc&eacute;d&eacute; de lecture/&eacute;criture en
	h&eacute;lice.</para>

      <para>Le d&eacute;bit de ces lecteurs va de ~150&nbsp;kO/s
	&agrave; ~500&nbsp;kO/s au maximum.  Leur capacit&eacute; de varie de
	1.3&nbsp;GO &agrave; 2.0&nbsp;GO.  La compression mat&eacute;rielle,
	disponible sur la plupart des lecteurs, double
	approximativement leur capacit&eacute;.
	Les unit&eacute;s multi-lecteurs peuvent avoir jusqu'&agrave; 6 lecteurs
	dans une seule tour avec changement automatique de bande.  La
	capacit&eacute; totale atteint 240&nbsp;GO.</para>

      <para>Le standard DDS-3 supporte maintenant des capacit&eacute;s de
	bande jusqu'&agrave; 12&nbsp;GO (ou 24&nbsp;GO
	compress&eacute;s).</para>

      <para>Les lecteurs 4mm, comme les lecteurs 8mm, utilisent un
	proc&eacute;d&eacute; de lecture/&eacute;criture en h&eacute;lice.  Tous
	les avantages et les inconv&eacute;nients de ce proc&eacute;d&eacute;
	s'appliquent aux deux types de lecteurs.</para>

      <para>Les bandes doivent &ecirc;tre chang&eacute;es apr&egrave;s
	2000 utilisations ou 100 sauvegardes compl&egrave;tes.</para>
    </sect2>

    <sect2 id="backups-tapebackups-8mm">
      <title>Bandes 8mm (Exabyte)</title>
      <indexterm>
	<primary>bande magn&eacute;tique</primary>
	<secondary>Bandes Exabyte (8mm)</secondary>
      </indexterm>

      <para>Les unit&eacute;s de bandes 8mm sont les lecteurs de bandes
	SCSI les plus courant; c'est le meilleur choix de bandes
	amovibles.  Presque chaque site dispose d'une unit&eacute; Exabyte
	2&nbsp;GO 8mm.  Les lecteurs 8mm sont fiables, pratiques et
	silencieux.  Les cartouches sont bon march&eacute; et d'encombrement
	faible (4.8 x 3.3 x 0.6 pouces; 122 x 84 x 15 mm).  Un des
	inconv&eacute;nients de la bande 8mm est la dur&eacute;e de
	vie relativement courte des bandes et des t&ecirc;tes de lectures
	en raison de la grande vitesse de d&eacute;filement de la bande
	devant les t&ecirc;tes.</para>

      <para>Leur d&eacute;bit va de ~250&nbsp;kO/s &agrave; ~500&nbsp;kO/s.
	Leur capacit&eacute; commence &agrave; 300&nbsp;MO jusqu'&agrave;
	7&nbsp;GO.
	La compression mat&eacute;rielle, disponible sur la plupart des
	lecteurs, double approximativement la capacit&eacute;.  Ces lecteurs
	sont disponibles sous forme d'unit&eacute; simple ou multiple
	accueillant 6 lecteurs et 120 bandes.  Les bandes sont
	chang&eacute;es automatiquement par l'unit&eacute;.  Ils peuvent
	g&eacute;rer une capacit&eacute; de stockage de plus de
	840&nbsp;GO.</para>

      <para>Le lecteur Exabyte &ldquo;Mammoth&rdquo; supporte
	12&nbsp;GO sur une seule bande (24&nbsp;GO compress&eacute;)
	et co&ucirc;te approximativement le double d'un lecteur
	classique.</para>

      <para>L'enregistrement des donn&eacute;es sur la bande utilise
	un proc&eacute;d&eacute; en h&eacute;lice, les t&ecirc;tes
	sont positionn&eacute;es en biais par rapport &agrave; la bande
	(environ 6 degr&eacute;s).  La bande fait un angle de 270
	degr&eacute;s avec le cylindre sur lequel se trouvent les t&ecirc;tes.
	Ce cylindre tourne en m&ecirc;me temps que la bande d&eacute;file.  Il
	en r&eacute;sulte donc une grande densit&eacute; de donn&eacute;es
	et des pistes tr&egrave;s serr&eacute;es qui vont de biais
	d'un bord &agrave; l'autre de la bande.</para>
    </sect2>

    <sect2 id="backups-tapebackups-qic">
      <title>QIC</title>
      <indexterm>
        <primary>bande magn&eacute;tique</primary>
	<secondary>QIC-150</secondary>
      </indexterm>

      <para>Les bandes et les lecteurs QIC-150 sont, peut-&ecirc;tre, le
	format le plus courant.  Les lecteurs QIC sont les moins
	chers des supports de sauvegarde &ldquo;s&eacute;rieux&rdquo;.
	Leur inconv&eacute;nient par contre est le co&ucirc;t des bandes.
	Les bandes QIC sont ch&egrave;res compar&eacute;es aux bandes 8mm ou
	4mm, jusqu'&agrave; 5 fois le co&ucirc;t au GO.  Mais, si une
	demi-douzaine de bandes vous suffit, le format QIC peut
	&ecirc;tre le bon choix.  QIC est le format le
	<emphasis>plus</emphasis> r&eacute;pandu.  Chaque site dispose d'un
	lecteur QIC d'une densit&eacute; ou d'une autre.  C'est l&agrave;
	la difficult&eacute;, il existe de nombreuses densit&eacute;s pour
	des bandes physiquement semblables (parfois m&ecirc;me identiques).
	Les lecteurs QIC ne sont pas silencieux.  Ces lecteurs se
	positionnent bruyamment avant d'enregistrer des donn&eacute;es et
	ont les entend clairement lors de lecture, &eacute;criture ou
	recherche.  Les bandes QIC sont volumineuses (6 x 4 x 0.7
	pouces; 15.2 x 10.2 x 1.7 mm).  Les <link
	linkend="backups-tapebackups-mini">Mini-cartouches</link>, qui
	utilisent &eacute;galement des bandes 1/4" sont d&eacute;crites par
	ailleurs.  On ne trouve pas d'unit&eacute;s multi-bandes avec
	chargeurs.</para>

      <para>Leur d&eacute;bit va de ~150&nbsp;kO/s &agrave; ~500&nbsp;kO/s.
	Leur capacit&eacute; varie de 40&nbsp;MO &agrave; 15&nbsp;GO.  La
	compression mat&eacute;rielle est disponible sur de nombreux lecteurs
	r&eacute;cents.  Les lecteurs QIC sont de moins en moins utilis&eacute;s,
	ils sont supplant&eacute;s par les lecteurs DAT.</para>

      <para>Les donn&eacute;es sont enregistr&eacute;es sur des pistes
	sur la bande.
	Les pistes sont parall&egrave;les &agrave; la bande et vont d'une
	extr&eacute;mit&eacute; &agrave; l'autre.  Le nombre de piste, et
	par cons&eacute;quent la largeur des pistes, varie avec la
	capacit&eacute; de la bande.  La plupart des nouveaux lecteurs
	fournissent au moins une compatibilit&eacute; descendante en
	lecture (mais aussi en &eacute;criture).  Le format QIC a une
	bonne r&eacute;putation de s&eacute;curit&eacute; des donn&eacute;es
	(la m&eacute;canique est plus simple et plus robuste que les lecteurs
	&agrave; syst&egrave;me en h&eacute;lice).</para>

      <para>Les bandes devraient &ecirc;tre chang&eacute;e
	apr&egrave;s 5000 sauvegardes.</para>
    </sect2>

    <sect2 id="backups-tapebackups-mini">
      <title>XXX* Mini-Cartouches</title>

      <para></para>
    </sect2>

    <sect2 id="backups-tapebackups-dlt">
      <title>DLT</title>
      <indexterm>
	<primary>bande magn&eacute;tique</primary>
	<secondary>DLT</secondary>
      </indexterm>

      <para>Les DLT ont le taux de transfert le plus &eacute;lev&eacute;
	de tous les types de lecteurs d&eacute;crits ici.  La bande
	d'1/2" (12.5mm) est contenue dans une seule cartouche
	(4 x 4 x 1 pouces; 100 x 100 x 25 mm).  La cartouche est
	munie d'une trappe basculante le long d'un c&ocirc;t&eacute; de la
	cartouche.  Le lecteur ouvre cette trappe pour saisir l'amorce
	de la bande.  Cette amorce comporte une d&eacute;coupe ovale que le
	lecteur utilise pour &ldquo;crocheter&rdquo; la bande.
	La bobine d'entra&icirc;nement est situ&eacute;e dans le lecteur.
	Tous les autres types de cartouches d&eacute;crits ici (les bandes 9
	pistes sont la seule exception) ont les bobines
	de stockage et d'entra&icirc;nement dans la cartouche
	elle-m&ecirc;me.</para>

      <para>Leur d&eacute;bit est d'environ 1.5&nbsp;MO/s, trois fois celui
	des lecteurs 4mm, 8mm, ou QIC.  La capacit&eacute; d'une bande varie
	de 10&nbsp;GO &agrave; 20&nbsp;GO pour une unit&eacute; simple.  Les
	lecteurs sont disponibles en unit&eacute;s multi-bandes avec
	changeurs et multi-lecteurs contenant de 5 &agrave; 900 bandes et 1
	&agrave; 20 lecteurs, fournissant une capacit&eacute; de stockage
	allant de 50&nbsp;GO &agrave; 9&nbsp;TO.</para>

      <para>Avec la compression, le format DLT type IV supporte
	jusqu'&agrave; une capacit&eacute; de 70&nbsp;GO.</para>

      <para>Les donn&eacute;es sont enregistr&eacute;es sur la bande
	sur des pistes parall&egrave;les &agrave; la direction de
	d&eacute;filement (comme
	pour les bandes QIC).  Deux pistes sont &eacute;crites
	&agrave; la fois.  La dur&eacute;e de vie des t&ecirc;tes de
	lecture/&eacute;criture est relativement longue; une fois que la
	bande s'arr&ecirc;te, il n'y a pas de d&eacute;placement des
	t&ecirc;tes par rapport &agrave; la bande.</para>
    </sect2>

    <sect2>
      <title id="backups-tapebackups-ait">AIT</title>
      <indexterm>
	<primary>bande magn&eacute;tique</primary>
	<secondary>AIT</secondary>
      </indexterm>

      <para>AIT est le nouveau format de Sony, il peut supporter
	jusqu'&agrave; 50&nbsp;GO par bande (avec compression).  Les bandes
	contiennent un circuit m&eacute;moire qui contient un index du
	contenu de la bande.  Cet index peut &ecirc;tre lu rapidement par le
	lecteur pour d&eacute;terminer l'emplacement de fichiers sur la
	bande, au lieu des nombreuses minutes n&eacute;cessaires aux autres
	types de bande.  Des programmes comme
	<application>SAMS:Alexandria</application> peuvent
	contr&ocirc;ller quarante ou plus ensemble de bandes AIT,
	communiquant directement avec le circuit m&eacute;moire de la
	bande pour en afficher le contenu &agrave; l'&eacute;cran,
	d&eacute;terminer quels fichiers ont &eacute;t&eacute;
	sauvegard&eacute; sur quelle bande,
	localiser la bonne bande, la charger, et en restaurer les
	donn&eacute;es.</para>

      <para>Les ensembles de ce type reviennent aux alentour des 20000
	dollars, les rendant inaccessibles &agrave; l'amateur
	&eacute;clair&eacute;.</para>
    </sect2>

    <sect2>
      <title>Utiliser une bande neuve pour la premi&egrave;re fois</title>

      <para>La premi&egrave;re fois que vous essayez de lire ou d'&eacute;crire
	sur une bande vierge, l'op&eacute;ration &eacute;choue.  Les messages
	affich&eacute;s par la console devraient &ecirc;tre du type:</para>

      <screen>sa0(ncr1:4:0): NOT READY asc:4,1
sa0(ncr1:4:0):  Logical unit is in process of becoming ready</screen>

      <para>La bande ne contient pas de bloc d'identification (bloc
	num&eacute;ro 0).  Tous les lecteurs QIC depuis l'adoption du
	standard QIC-525 &eacute;crivent un bloc d'identification sur la
	bande.  Il y a alors deux solutions:</para>

      <itemizedlist>
	<listitem>
	  <para><command>mt fsf 1</command> fait &eacute;crire au lecteur un
	    bloc d'identification sur la bande.</para>
	</listitem>

	<listitem>
	  <para>Utiliser le bouton en face avant pour &eacute;jecter la
	    bande.</para>

	  <para>R&eacute;-ins&eacute;rer la bande et utiliser &man.dump.8; pour
	    &eacute;crire dessus.</para>

	  <para>&man.dump.8; produira l'erreur <errorname>DUMP: End of tape
	    detected</errorname> et la console affichera: <errorname>HARDWARE
	    FAILURE info:280 asc:80,96</errorname>.</para>

	  <para>Rembobiner la bande avec:
	    <command>mt rewind</command>.</para>

	  <para>Les manipulations ult&eacute;rieures sur la bande
	    fonctionneront.</para>
	</listitem>
      </itemizedlist>
    </sect2>
  </sect1>

  <sect1 id="backups-floppybackups">
    <title>Sauvegardes sur disquettes</title>

    <sect2 id="floppies-using">
      <title>Puis-je utiliser des disquettes pour la sauvegarde
	des mes donn&eacute;es?</title>
      <indexterm><primary>disquettes de sauvegarde</primary></indexterm>
      <indexterm><primary>disquettes</primary></indexterm>

      <para>Les disquettes ne sont pas des supports adapt&eacute;s &agrave; la
	r&eacute;alisation de sauvegardes &eacute;tant
	donn&eacute; que:</para>

      <itemizedlist>
	<listitem>
	  <para>Le support n'est pas fiable, sp&eacute;cialement
	    sur de longues p&eacute;riodes de temps.</para>
	</listitem>

	<listitem>
	  <para>Les op&eacute;rations de sauvegarde et de restauration
	    sont tr&egrave;s lentes.</para>
	</listitem>

	<listitem>
	  <para>Elles ont une capacit&eacute; tr&egrave;s
	    limit&eacute;e (le jour o&ugrave; l'on pourra sauvegarder
	    l'int&eacute;gralit&eacute; d'un disque dur sur une douzaine de
	    disquette n'est pas encore arriv&eacute;).</para>
	</listitem>
      </itemizedlist>

      <para>Cependant, si vous n'avez pas d'autres m&eacute;thodes
	pour sauvegarder vos donn&eacute;es alors les disquettes
	sont mieux que pas de sauvegardes du tout.</para>

      <para>Si vous devez utiliser les disquettes, alors assurez-vous
	que vous en utiliser des disquettes de bonne qualit&eacute;.
	Les disquettes qui tra&icirc;nent sur le bureau depuis quelques
	ann&eacute;es sont un mauvais choix.  Id&eacute;alement utilisez de
	des disquettes neuves en provenance d'un fabricant
	renomm&eacute;.</para>
    </sect2>

    <sect2 id="floppies-creating">
      <title>Alors, comment je sauvegarde mes donn&eacute;es
	sur disquettes?</title>

      <para>La meilleur fa&ccedil;on de sauvegarder sur disquette est
	d'utiliser la commande &man.tar.1; avec l'option
	<option>-M</option> (volume multiple), qui autorise
	la r&eacute;partition des sauvegardes sur plusieurs
	disquettes.</para>

      <para>Pour sauvegarder tous les fichiers du r&eacute;pertoire
	courant et des sous-r&eacute;pertoires (en tant que
	<username>root</username>):</para>

      <screen>&prompt.root; <userinput>tar Mcvf /dev/fd0 *</userinput></screen>

      <para>Quand la premi&egrave;re disquette est pleine &man.tar.1;
	vous r&eacute;clamera d'introduire le volume suivant (parce
	que &man.tar.1; est ind&eacute;pendant du support il parle en
	terme de volume; dans notre contexte cela signifie
	disquette).</para>

      <screen>Prepare volume #2 for /dev/fd0 and hit return:</screen>

      <para>Cette op&eacute;ration est r&eacute;p&eacute;t&eacute;e
	(avec incr&eacute;mentation du num&eacute;ro de volume)
	jusqu'&agrave; ce que les fichiers sp&eacute;cifi&eacute;s soient
	sauvegard&eacute;s.</para>
    </sect2>

    <sect2 id="floppies-compress">
      <title>Puis-je sauvegarder mes sauvegardes?</title>
      <indexterm>
	<primary><command>tar</command></primary>
      </indexterm>
      <indexterm>
	<primary><command>gzip</command></primary>
      </indexterm>
      <indexterm><primary>compression</primary></indexterm>

      <para>Malheureusement, &man.tar.1; ne permettra pas
	l'utilisation de l'option <option>-z</option> pour
	les archives multi-volumes.  Vous pourrez, bien s&ucirc;r,
	utiliser &man.gzip.1; sur tous les fichiers, les archiver
	avec &man.tar.1; sur disquettes, puis d&eacute;compresser les
	fichiers avec &man.gunzip.1;!</para>
    </sect2>

    <sect2 id="floppies-restoring">
      <title>Comment puis-je restaurer mes sauvegardes?</title>

      <para>Pour restaurer une archive compl&egrave;te utiliser:</para>

      <screen>&prompt.root; <userinput>tar Mxvf /dev/fd0</userinput></screen>

      <para>Vous pouvez utiliser deux mani&egrave;res pour restaurer
	uniquement certains fichiers.  Tout d'abord, vous pouvez
	commencer avec la premi&egrave;re disquette et utiliser:</para>

      <screen>&prompt.root; <userinput>tar Mxvf /dev/fd0 <replaceable>nomdufichier</replaceable></userinput></screen>

      <para>&man.tar.1; vous demandera d'ins&eacute;rer les disquettes
	suivantes jusqu'&agrave; trouver le fichier recherch&eacute;.</para>

      <para>Alternativement, si vous savez sur quelle disquette
	le fichier se trouve alors vous pouvez simplement ins&eacute;rer
	cette disquette et utiliser la commande pr&eacute;c&eacute;dente.
	Notez que si le premier fichier sur la disquette est la suite
	d'un fichier de la pr&eacute;c&eacute;dente disquette alors
	&man.tar.1; vous avertira qu'il ne peut le restaurer,
	m&ecirc;me si vous ne le voulez pas!</para>
    </sect2>
  </sect1>

  <sect1 id="backup-basics">
    <title>Sauvegardes</title>

    <para>Les trois principaux programmes de sauvegarde sont:
	&man.dump.8;, &man.tar.1;, et &man.cpio.1;.</para>

    <sect2>
      <title>Dump et Restore</title>
      <indexterm>
	<primary>programmes de sauvegarde</primary>
	<secondary>dump / restore</secondary>
      </indexterm>
      <indexterm><primary><command>dump</command></primary></indexterm>
      <indexterm><primary><command>restore</command></primary></indexterm>

      <para>&man.dump.8; et &man.restore.8; sont les programmes de
	sauvegarde traditionnels d'&unix;.  Ils op&egrave;rent sur le disque
	comme sur une suite de blocs disque, en dessous du niveau
	d'abstraction que constituent les fichiers, liens et
	r&eacute;pertoires cr&eacute;&eacute;s par les syst&egrave;mes de
	fichiers.  Le programme &man.dump.8; sauvegarde
	l'int&eacute;gralit&eacute; d'un syst&egrave;me de
	fichiers d'un p&eacute;riph&eacute;rique.  Il est incapable
	de sauvegarder seulement une partie d'un syst&egrave;me
	de fichiers ou une arborescence de r&eacute;pertoires
	s'&eacute;talant sur plus d'un syst&egrave;me de fichiers.
	Le programme &man.dump.8; n'&eacute;crit pas de fichiers ou
	des r&eacute;pertoires sur la bande, mais &eacute;crit
	plut&ocirc;t les blocs de donn&eacute;es brutes dont sont
	constitu&eacute;s les fichiers et les r&eacute;pertoires.</para>

      <note>
	<para>Si vous utilisez &man.dump.8; sur votre r&eacute;pertoire
	  racine, vous ne sauvegarderez pas
	  <filename>/home</filename>, <filename>/usr</filename> ou
	  beaucoup d'autres r&eacute;pertoires puisque que ces derniers
	  sont g&eacute;n&eacute;ralement des points de montages pour
	  d'autres syst&egrave;mes de fichiers ou des liens symboliques
	  vers ces syst&egrave;mes de fichiers.</para>
      </note>

      <para>L'utilitaire &man.dump.8; a quelques particularit&eacute;s
	datant de ses d&eacute;buts sous la version 6 d'AT&amp;T UNIX (circa
	1975).  Les param&egrave;tres par d&eacute;faut conviennent aux bandes
	9 pistes (6250&nbsp;bpi), et non aux supports &agrave; haute
	densit&eacute; d'aujourd'hui (jusqu'&agrave; 62182&nbsp;ftpi).
	Il faut surcharger ces valeurs par d&eacute;faut sur la ligne
	de commande pour utiliser la capacit&eacute; des bandes
	actuelles.</para>

      <indexterm><primary><filename>.rhosts</filename></primary></indexterm>
      <para>Il est &eacute;galement possible de sauvegarder les
	donn&eacute;es par l'interm&eacute;diaire d'un r&eacute;seau sur un
	lecteur de bande se trouvant sur une autre ordinateur
	&agrave; l'aide des commandes &man.rdump.8; et &man.rrestore.8;.
	Ces deux programmes utilisent &man.rcmd.3; et &man.ruserok.3;
	pour acc&eacute;der &agrave; l'unit&eacute; de bandes distante.
        Cependant, l'utilisateur effectuant une sauvegarde doit
	&ecirc;tre pr&eacute;sent dans le fichier <filename>.rhosts</filename>
	sur la machine distante.  Les arguments de &man.rdump.8; et
	&man.rrestore.8; doivent &ecirc;tre compatibles avec une
	utilisation sur la machine distante.  Quand on sauvegarde
	une machine FreeBSD sur un lecteur Exabyte install&eacute; sur
	un ordinateur Sun appel&eacute; <hostid>komodo</hostid>,
	utilisez:</para>

      <screen>&prompt.root; <userinput>/sbin/rdump 0dsbfu 54000 13000 126 komodo:/dev/nsa8 /dev/da0a 2>&amp;1</userinput></screen>

      <para>Attention: il y a des cons&eacute;quences pour la
	s&eacute;curit&eacute; &agrave; utiliser l'authentification
	<filename>.rhosts</filename>.  Evaluez soigneusement votre
	situation.</para>

      <para>Il est &eacute;galement possible d'utiliser &man.dump.8; et
	&man.restore.8; d'une fa&ccedil;on plus s&eacute;curis&eacute;e sur
	&man.ssh.1;.</para>

      <example>
	<title>Utiliser &man.dump.8; sur <application>ssh</application></title>

	<screen>&prompt.root; <userinput>/sbin/dump -0uan -f - /usr | gzip -2 | ssh1 -c blowfish \
          targetuser@targetmachine.example.com dd of=/mybigfiles/dump-usr-l0.gz</userinput></screen>

      </example>

      <para>Ou en utilisant une fonction interne de
	<command>dump</command>, positionner la variable
	d'environnement <envar>RSH</envar>:</para>

      <example>
	<title>Utiliser <command>dump</command> sur <application>ssh</application>
	avec la variable <envar>RSH</envar> positionn&eacute;e</title>

	<screen>&prompt.root; <userinput>RSH=/usr/bin/ssh /sbin/dump -0uan -f targetuser@targetmachine.example.com:/dev/sa0</userinput></screen>
      </example>
    </sect2>

    <sect2>
      <title><command>tar</command></title>
      <indexterm>
	<primary>programmes de sauvegarde</primary>
	<secondary><command>tar</command></secondary>
      </indexterm>

      <para>Le programme &man.tar.1; date aussi de la Version 6
	d'AT&amp;T UNIX (circa 1975).  &man.tar.1; travaille en
	coop&eacute;ration avec le syst&egrave;me de fichiers; &man.tar.1;
	&eacute;crit des fichiers et des r&eacute;pertoires sur la bande.
	&man.tar.1; ne supporte pas toutes les options permises
	par &man.cpio.1;, mais &man.tar.1; ne demande pas
	l'inahabituelle concat&eacute;nation de commandes qu'utilise
	&man.cpio.1;</para>

      <indexterm><primary><command>tar</command></primary></indexterm>
      <para>La plupart des versions de &man.tar.1; ne supportent
	pas les sauvegardes en r&eacute;seau.  La version GNU de &man.tar.1;,
	qu'utilise FreeBSD, supporte les p&eacute;riph&eacute;riques distants
	avec la m&ecirc;me syntaxe que &man.rdump.8;.  Pour sauvegarder avec
	&man.tar.1; sur une unit&eacute; Exabyte connect&eacute;e sur une machine
	Sun appel&eacute;e <hostid>komodo</hostid>, utilisez:</para>

      <screen>&prompt.root; <userinput>/usr/bin/tar cf komodo:/dev/nsa8 . 2>&amp;1</userinput></screen>

      <para>Pour les version sans support pour p&eacute;riph&eacute;riques
	distants, vous pouvez utiliser un tuyau et &man.rsh.1; pour
	envoyer les donn&eacute;es sur un lecteur de bande distant:</para>

      <screen>&prompt.root; <userinput>tar cf - . | rsh <replaceable>hostname</replaceable> dd of=<replaceable>tape-device</replaceable> obs=20b</userinput></screen>

      <para>Si vous &ecirc;tes inquiet au sujet de la s&eacute;curit&eacute;
	de sauvegardes par r&eacute;seau, vous devriez utiliser la
	commande &man.ssh.1; &agrave; la place de &man.rsh.1;.</para>
    </sect2>

    <sect2>
      <title><command>cpio</command></title>
      <indexterm>
	<primary>programmes de sauvegarde</primary>
	<secondary><command>cpio</command></secondary>
      </indexterm>

      <para>&man.cpio.1; est le programme &unix; original pour l'&eacute;change
	de fichiers par bandes magn&eacute;tiques.  &man.cpio.1; dispose
	d'options (parmi beaucoup d'autres) pour intervertir les
	octets, utiliser de nombreux diff&eacute;rents formats, et envoyer
	les donn&eacute;es &agrave; d'autres programmes.  Cette derni&egrave;re
	caract&eacute;ristique fait de &man.cpio.1; un excellent choix pour
	les supports d'installation.  &man.cpio.1; ne sait pas
	parcourir une arborescence de r&eacute;pertoires et il faut lui
	passer la liste des fichiers via
	<filename>stdin</filename>.</para>
      <indexterm><primary><command>cpio</command></primary></indexterm>

      <para>&man.cpio.1; ne supporte pas les sauvegardes par le
	r&eacute;seau.  Vous pouvez utiliser un tuyau et &man.rsh.1; pour
	envoyer les donn&eacute;es sur un lecteur de bande distant:</para>

      <screen>&prompt.root; <userinput>for f in <replaceable>directory_list; do</replaceable></userinput>
<userinput>find $f >> backup.list</userinput>
<userinput>done</userinput>
&prompt.root; <userinput>cpio -v -o --format=newc < backup.list | ssh <replaceable>user</replaceable>@<replaceable>host</replaceable> "cat > <replaceable>backup_device</replaceable>"</userinput></screen>

      <para>O&ugrave; <replaceable>directory_list</replaceable> est la liste
	des r&eacute;pertoires que vous d&eacute;sirez sauvegarder,
	<replaceable>user</replaceable>@<replaceable>host</replaceable>
	est l'ensemble utilisateur/nom de machine qui effectuera les
	sauvegardes, et <replaceable>backup_device</replaceable>
	repr&eacute;sente l'unit&eacute; o&ugrave; seront &eacute;crites les sauvegardes
	(e.g., <filename>/dev/nsa0</filename>).</para>
    </sect2>

    <sect2>
      <title><command>pax</command></title>
      <indexterm>
	<primary>programmes de sauvegarde</primary>
	<secondary><command>pax</command></secondary>
      </indexterm>
      <indexterm><primary><command>pax</command></primary></indexterm>
      <indexterm><primary>POSIX</primary></indexterm>
      <indexterm><primary>IEEE</primary></indexterm>

      <para>&man.pax.1; est la r&eacute;ponse IEEE/&posix; &agrave;
	&man.tar.1; et &man.cpio.1;.  Au fil des ans
	les diff&eacute;rentes versions de &man.tar.1; et &man.cpio.1;
	sont devenues l&eacute;g&egrave;rement incompatibles.  Aussi,
	plut&ocirc;t que de batailler pour les standardiser enti&egrave;rement,
	&posix; a d&eacute;fini un nouvel utilitaire d'archivage.  &man.pax.1;
	tente de lire et d'&eacute;crire nombre des divers formats
	&man.tar.1; et &man.cpio.1;, en plus de ses propres nouveaux
	formats.  Son ensemble de commandes ressemble plus &agrave; celui
	de &man.cpio.1; qu'&agrave; celui de &man.tar.1;.</para>
    </sect2>

    <sect2 id="backups-programs-amanda">
      <title><application>Amanda</application></title>
      <indexterm>
	<primary>programmes de sauvegarde</primary>
	<secondary><application>Amanda</application></secondary>
      </indexterm>
      <indexterm><primary><application>Amanda</application></primary></indexterm>

      <!-- Remove link until <port> tag is available -->
      <para><application>Amanda</application> (Advanced Maryland
	Network Disk Archiver&mdash;Syst&egrave;me Avanc&eacute; d'Archivage
	de Disques en R&eacute;seau du Maryland) est un syst&egrave;me
	d'archivage
	client/serveur plut&ocirc;t qu'un simple programme.  Un serveur
	<application>Amanda</application> archivera sur une seule
	unit&eacute; de bandes un nombre quelconque d'ordinateurs disposant
	de clients <application>Amanda</application> et un acc&egrave;s
	r&eacute;seau au serveur <application>Amanda</application>.
	Un probl&egrave;me classique sur les sites qui ont de nombreux
	disques volumineux est que le temps n&eacute;cessaire pour
	sauvegarder directement les donn&eacute;es sur la bande d&eacute;passe
	le temps allou&eacute; &agrave; cette t&acirc;che.
	<application>Amanda</application> r&eacute;sout ce probl&egrave;me.
	<application>Amanda</application> peut utiliser un
	&ldquo;disque interm&eacute;diaire&rdquo; pour sauvegarder plusieurs
	syst&egrave;mes de fichiers &agrave; la fois.
	<application>Amanda</application> des &ldquo;jeux
	d'archive&rdquo;: un ensemble de bandes utilis&eacute; pour une
	p&eacute;riode donn&eacute;e pour cr&eacute;er une sauvegarde
	compl&egrave;te de tous les syst&egrave;mes de fichiers list&eacute;
	dans le fichier de configuration d'<application>Amanda</application>.
	Le &ldquo;jeu d'archive&rdquo; contient &eacute;galement les
	sauvegardes nocturnes incr&eacute;mentales (ou
	diff&eacute;rentielles) de tous les syst&egrave;mes de fichiers.
	Pour restaurer une syst&egrave;me de fichiers endommag&eacute;,
	il faut la sauvegarde compl&egrave;te la plus r&eacute;cente et
	les sauvegardes incr&eacute;mentales.</para>

      <para>Le fichier de configuration permet un contr&ocirc;le en finesse
	des sauvegardes et du trafic r&eacute;seau
	qu'<application>Amanda</application> g&eacute;n&egrave;re.
	<application>Amanda</application> utilisera n'importe quel des
	programmes de sauvegarde d&eacute;crits plus haut pour &eacute;crire les
	donn&eacute;es sur bande.  <application>Amanda</application> est
	disponible sous forme de logiciel port&eacute; ou de logiciel
	pr&eacute;-compil&eacute;, il n'est pas install&eacute;
	par d&eacute;faut.</para>
      </sect2>

    <sect2>
      <title>Ne rien faire</title>

      <para>&ldquo;Ne rien faire&rdquo; n'est pas un logiciel, mais
	c'est la strat&eacute;gie de sauvegarde la plus utilis&eacute;e.
	Il n'y a aucun investissement initial.  Il n'y a pas de de
	planification des sauvegardes &agrave; suivre.  Juste dire non.  Si
	quelque chose arrive &agrave; vos donn&eacute;es, souriez et
	d&eacute;brouillez-vous!</para>

      <para>Si votre temps et vos donn&eacute;es ne valent pas grand chose,
	alors &ldquo;Ne rien faire&rdquo; est le programme de
	sauvegarde le mieux adapt&eacute; &agrave; votre ordinateur.
	Mais prenez garde, &unix; est un outil utile, et vous pouvez vous rendre
	compte au bout de six mois que vous disposez d'une collection
	de fichiers qui vous sont utiles.</para>

      <para>&ldquo;Ne rien faire&rdquo; est la bonne m&eacute;thode de
	sauvegarde pour <filename>/usr/obj</filename> et les autres
	r&eacute;pertoires qui peuvent facilement &ecirc;tre
	recr&eacute;&eacute;s par votre ordinateur.  Un exemple est les
	fichiers qui constituent la version HTML ou &postscript; de ce manuel.
	Ces fichiers ont &eacute;t&eacute; g&eacute;n&eacute;r&eacute;s
	&agrave; partir de fichiers SGML.
	Faire des sauvegardes des fichiers HTML ou &postscript; n'est
	pas n&eacute;cessaire.  Les fichiers source SGML sont
	sauvegard&eacute;s r&eacute;guli&egrave;rement.</para>
    </sect2>

    <sect2>
      <title>Quel est le meilleur programme de sauvegarde?</title>
      <indexterm>
        <primary>LISA</primary>
      </indexterm>

      <para>&man.dump.8; <emphasis>Point.</emphasis> Elizabeth D. Zwicky
	a soumis &agrave; rude &eacute;preuve tous les programmes de
	sauvegarde dont nous avons parl&eacute;.  Le choix de &man.dump.8;
	s'impose pour pr&eacute;server toutes vos donn&eacute;es et les
	particularit&eacute;s des syst&egrave;mes de fichiers &unix;.  Elizabeth
	a cr&eacute;&eacute; des syst&egrave;mes de fichiers avec une grande
	vari&eacute;t&eacute; de particularit&eacute;s inhabituelles (et
	quelques unes pas tellement inhabituelles) et a test&eacute; chacun des
	programmes en faisant une sauvegarde et une restauration de ces
	syst&egrave;mes de fichiers.  Parmi les sp&eacute;cificit&eacute;s
	test&eacute;es: fichiers avec des trous, fichiers avec des trous
	et des blocs de caract&egrave;res &ldquo;null&rdquo;, fichiers
	dont les noms comportent des caract&egrave;res inhabituels,
	les fichiers illisibles ou impossible &agrave; modifier, les
	p&eacute;riph&eacute;riques, fichiers dont la taille change pendant
	la sauvegarde, fichiers cr&eacute;&eacute;s ou d&eacute;truits en cours
	de sauvegarde et bien plus.  Elle a pr&eacute;sent&eacute; les
	r&eacute;sultats de ces tests au LISA V en Octobre 1991.
	Voir les <ulink
	url="http://berdmann.dyndns.org/zwicky/testdump.doc.html">tests
	d'endurance des programmes de sauvegarde et
	d'archivage</ulink>.</para>
    </sect2>

    <sect2>
      <title>Proc&eacute;dure de restauration d'urgence</title>

      <sect3>
	<title>Avant le d&eacute;sastre</title>

	<para>Il y a quatre &eacute;tapes &agrave; mettre en oeuvre en
	  pr&eacute;vision d'un d&eacute;sastre &eacute;ventuel.</para>
	<indexterm>
    <primary><command>disklabel</command></primary>
  </indexterm>

	<para>Tout d'abord, imprimez le label de chacun de vos disques
	  (<command>e.g. disklabel da0 | lpr</command>), votre table
	  des syst&egrave;mes de fichiers (<filename>/etc/fstab</filename>)
	  et tous les messages de d&eacute;marrage, en deux
	  exemplaires.</para>

	<indexterm><primary>disquette de reprise
	  d'urgence</primary></indexterm>
	<para>Deuxi&egrave;mement, v&eacute;rifiez que vos disquettes de
	  d&eacute;marrage et de reprise d'urgence
	  (<filename>boot.flp</filename> et <filename>fixit.flp</filename>)
	  incluent tous vos p&eacute;riph&eacute;riques.  La m&eacute;thode
	  la plus simple pour v&eacute;rifier est de red&eacute;marrer avec la
	  disquette de d&eacute;marrage dans le lecteur et contr&ocirc;ler
	  les messages de d&eacute;marrage.  Si tous vos
	  p&eacute;riph&eacute;riques
	  sont list&eacute;s et op&eacute;rationnels, passez &agrave; la
	  troisi&egrave;me &eacute;tape.</para>

	<para>Sinon, vous devez cr&eacute;er deux disquettes de d&eacute;marrage
	  sur-mesure avec un noyau qui puisse monter tous vos disques et
	  acc&eacute;der &agrave; votre unit&eacute; de bandes.  Ces disquettes
	  doivent contenir: &man.fdisk.8;, &man.disklabel.8;,
	  &man.newfs.8;, &man.mount.8;, et le programme de sauvegarde
	  que vous utilisez.  L'&eacute;dition de liens de ces programmes
	  doit &ecirc;tre statique.  Si vous utilisez &man.dump.8;, la
	  disquette doit contenir &man.restore.8;.</para>

	<para>Troisi&egrave;mement, faites r&eacute;guli&egrave;rement des
	  sauvegardes sur bandes.  Toutes les modifications
	  effectu&eacute;es apr&egrave;s votre derni&egrave;re sauvegarde
	  peuvent irr&eacute;m&eacute;diablement perdues.  Prot&eacute;gez
	  vos bandes de sauvegarde en &eacute;criture.</para>

	<para>Quatri&egrave;mement, testez les disquettes (soit
	  <filename>boot.flp</filename> et <filename>fixit.flp</filename>
	  soit les deux disquettes sur-mesure que vous avez
	  cr&eacute;&eacute;es &agrave; la seconde &eacute;tape) et vos
	  bandes de sauvegarde.  Prenez note de la proc&eacute;dure.
	  Conservez ces notes avec la disquette de d&eacute;marrage, les
	  impressions et les bandes de sauvegarde.  Vous serez si
	  pr&eacute;occup&eacute; quand vous devrez restaurer que ces notes
	  peuvent vous &eacute;viter de d&eacute;truire vos bandes de sauvegarde
	  (Comment?  Au lieu de <command>tar xvf /dev/sa0</command>,
	  vous pourriez taper accidentellement
	  <command>tar cvf /dev/sa0</command>, ce qui &eacute;craserait votre
	  bande de sauvegarde).</para>

	<para>Par mesure de s&eacute;curit&eacute;, cr&eacute;ez une
	  disquette de d&eacute;marrage et deux bandes de sauvegarde
	  &agrave; chaque fois.  Conservez-les dans un lieu
	  &eacute;loign&eacute;.  Un endroit &eacute;loign&eacute; n'est
	  PAS le sous-sol du
	  m&ecirc;me b&acirc;timent.  Un certain nombre de compagnies du World
	  Trade Center l'ont appris &agrave; leurs d&eacute;pends.  Un endroit
	  &eacute;loign&eacute; doit &ecirc;tre physiquement
	  s&eacute;par&eacute; de vos ordinateurs
	  et de vos disques par une distance significative.</para>

	<example>
	  <title>Proc&eacute;dure de cr&eacute;ation d'une disquette
	    de d&eacute;marrage</title>

	<programlisting><![ CDATA [#!/bin/sh
#
# create a restore floppy
#
# format the floppy
#
PATH=/bin:/sbin:/usr/sbin:/usr/bin

fdformat -q fd0
if [ $? -ne 0 ]
then
	 echo "Bad floppy, please use a new one"
	 exit 1
fi

# place boot blocks on the floppy
#
disklabel -w -B /dev/fd0c fd1440

#
# newfs the one and only partition
#
newfs -t 2 -u 18 -l 1 -c 40 -i 5120 -m 5 -o space /dev/fd0a

#
# mount the new floppy
#
mount /dev/fd0a /mnt

#
# create required directories
#
mkdir /mnt/dev
mkdir /mnt/bin
mkdir /mnt/sbin
mkdir /mnt/etc
mkdir /mnt/root
mkdir /mnt/mnt			# for the root partition
mkdir /mnt/tmp
mkdir /mnt/var

#
# populate the directories
#
if [ ! -x /sys/compile/MINI/kernel ]
then
	 cat << EOM
The MINI kernel does not exist, please create one.
Here is an example config file:
#
# MINI -- A kernel to get FreeBSD onto a disk.
#
machine         "i386"
cpu             "I486_CPU"
ident           MINI
maxusers        5

options         INET                    # needed for _tcp _icmpstat _ipstat
                                        #            _udpstat _tcpstat _udb
options         FFS                     #Berkeley Fast File System
options         FAT_CURSOR              #block cursor in syscons or pccons
options         SCSI_DELAY=15           #Be pessimistic about Joe SCSI device
options         NCONS=2                 #1 virtual consoles
options         USERCONFIG              #Allow user configuration with -c XXX

config          kernel	root on da0 swap on da0 and da1 dumps on da0

device          isa0
device          pci0

device          fdc0	at isa? port "IO_FD1" bio irq 6 drq 2 vector fdintr
device          fd0	at fdc0 drive 0

device          ncr0

device          scbus0

device          sc0	at isa? port "IO_KBD" tty irq 1 vector scintr
device          npx0	at isa? port "IO_NPX" irq 13 vector npxintr

device          da0
device          da1
device          da2

device          sa0

pseudo-device   loop            # required by INET
pseudo-device   gzip            # Exec gzipped a.out's
EOM
	 exit 1
fi

cp -f /sys/compile/MINI/kernel /mnt

gzip -c -best /sbin/init > /mnt/sbin/init
gzip -c -best /sbin/fsck > /mnt/sbin/fsck
gzip -c -best /sbin/mount > /mnt/sbin/mount
gzip -c -best /sbin/halt > /mnt/sbin/halt
gzip -c -best /sbin/restore > /mnt/sbin/restore

gzip -c -best /bin/sh > /mnt/bin/sh
gzip -c -best /bin/sync > /mnt/bin/sync

cp /root/.profile /mnt/root

cp -f /dev/MAKEDEV /mnt/dev
chmod 755 /mnt/dev/MAKEDEV

chmod 500 /mnt/sbin/init
chmod 555 /mnt/sbin/fsck /mnt/sbin/mount /mnt/sbin/halt
chmod 555 /mnt/bin/sh /mnt/bin/sync
chmod 6555 /mnt/sbin/restore

#
# create the devices nodes
#
cd /mnt/dev
./MAKEDEV std
./MAKEDEV da0
./MAKEDEV da1
./MAKEDEV da2
./MAKEDEV sa0
./MAKEDEV pty0
cd /

#
# create minimum file system table
#
cat > /mnt/etc/fstab <<EOM
/dev/fd0a    /    ufs    rw  1  1
EOM

#
# create minimum passwd file
#
cat > /mnt/etc/passwd <<EOM
root:*:0:0:Charlie &:/root:/bin/sh
EOM

cat > /mnt/etc/master.passwd <<EOM
root::0:0::0:0:Charlie &:/root:/bin/sh
EOM

chmod 600 /mnt/etc/master.passwd
chmod 644 /mnt/etc/passwd
/usr/sbin/pwd_mkdb -d/mnt/etc /mnt/etc/master.passwd

#
# umount the floppy and inform the user
#
/sbin/umount /mnt
echo "The floppy has been unmounted and is now ready."]]></programlisting>

        </example>

      </sect3>

      <sect3>
	<title>Apr&egrave;s le d&eacute;sastre</title>

	<para>La question cruciale est: votre mat&eacute;riel a-t-il
	  surv&eacute;cu?  Vous avez r&eacute;guli&egrave;rement fait des
	  sauvegardes, vous n'avez donc pas besoin de vous
	  inqui&eacute;ter pour les fichiers et les programmes.</para>

	<para>Si le mat&eacute;riel a subi des d&eacute;gats, remplacez
	  tout d'abord ce qui a &eacute;t&eacute; endommag&eacute;
	  avant de tenter d'utiliser l'ordinateur.</para>

	<para>Si votre mat&eacute;riel est en &eacute;tat, contr&ocirc;lez
	  vos disquettes.  Si vous utilisez une disquette de d&eacute;marrage
	  personnalis&eacute;e, d&eacute;marrez en mode mono-utilisateur (tapez
	  <literal>-s</literal> &agrave; l'invite <prompt>boot:</prompt>).
	  Sautez le paragraphe suivant.</para>

	<para>Si vous utilisez les disquettes <filename>boot.flp</filename>
	  et <filename>fixit.flp</filename>, continuez &agrave; lire.
	  Mettre la disquette <filename>boot.flp</filename> dans le
	  premier lecteur et d&eacute;marrez l'ordinateur.  Le menu
	  d'installation d'origine s'affiche &agrave; l'&eacute;cran.
	  Choisissez
	  l'option <guimenuitem>Fixit--Repair mode with CDROM or
	  floppy.</guimenuitem>.  Ins&eacute;rez la disquette
	  <filename>fixit.flp</filename> quand on vous la demande.
	  &man.restore.8; et les autres programmes dont vous avez
	  besoin sont situ&eacute;s dans le r&eacute;pertoire
	  <filename>/mnt2/stand</filename>.</para>

	<para>Restaurez chaque syst&egrave;me de fichiers
	  s&eacute;par&eacute;ment.</para>

	<indexterm>
    <primary><command>mount</command></primary>
  </indexterm>
	<indexterm><primary>partition racine</primary></indexterm>
	<indexterm>
    <primary><command>disklabel</command></primary>
  </indexterm>
	<indexterm>
    <primary><command>newfs</command></primary>
  </indexterm>
	<para>Essayez &man.mount.8; (e.g. <command>mount /dev/da0a
	  /mnt</command>) sur la partition racine de votre premier
	  disque.  Si le label du disque est endommag&eacute;, utilisez
	  &man.disklabel.8; pour repartitionner et libeller le disque
	  conform&eacute;ment au lable que vous avez imprim&eacute; et mis
	  de c&ocirc;t&eacute;.  Utilisez &man.newfs.8; pour recr&eacute;er
	  les syst&egrave;mes de fichiers.  Remontez la partition racine
	  de la disquette en lecture/&eacute;criture (<command>mount -u -o rw
	  /mnt</command>).  Utilisez votre programme de restauration
	  et vos bandes de sauvegardes pour restaurer les donn&eacute;es
	  de ce syst&egrave;me de fichiers (e.g. <command>restore vrf
	  /dev/sa0</command>).  D&eacute;montez le syst&egrave;me de fichiers
	  (e.g. <command>umount /mnt</command>).  R&eacute;p&eacute;tez
	  l'op&eacute;ration pour chacun des syst&egrave;mes de fichiers
	  endommag&eacute;s.</para>

	<para>Une fois que le syst&egrave;me fonctionne &agrave; nouveau,
	  faites une sauvegarde sur de nouvelles bandes.  Ce qui
	  a caus&eacute; la panne ou l perte de donn&eacute;es peut se
	  reproduire.  Une heure de perdue maintenant peut vous
	  &eacute;pargner d'autres ennuis plus tard.</para>
      </sect3>

<![ %not.published; [

      <sect3>
	<title>* Je ne me suis pas pr&eacute;par&eacute; au d&eacute;sastre,
	  que faire?</title>

	<para></para>
      </sect3>
]]>

    </sect2>
  </sect1>

  <sect1 id="disks-virtual">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Marc</firstname>
	  <surname>Fonvieille</surname>
	  <contrib>R&eacute;organis&eacute;e et augment&eacute;e par </contrib>
	</author>
      </authorgroup>
    </sect1info>
    <title>Syst&egrave;mes de fichiers r&eacute;seaux, en m&eacute;moire
      et sauvegard&eacute;s sur fichier</title>
    <indexterm><primary>disques virtuels</primary></indexterm>
    <indexterm>
      <primary>disques</primary>
      <secondary>virtuels</secondary>
    </indexterm>

    <para>En plus des disques que vous introduisez physiquement
      dans votre ordinateur: disquettes, CD, disques durs, et ainsi
      de suite; d'autres formes de disques sont g&eacute;r&eacute;es
      par &os; &mdash; les <firstterm>disques
      virtuels</firstterm>.</para>

    <indexterm><primary>NFS</primary></indexterm>
    <indexterm><primary>Coda</primary></indexterm>
    <indexterm>
      <primary>disques</primary>
      <secondary>m&eacute;moire</secondary>
    </indexterm>
    <para>Ceux-ci comprennent les syst&egrave;mes de fichiers
      r&eacute;seaux comme le <link linkend="network-nfs">NFS</link>
      et Coda, les syst&egrave;mes de fichiers en m&eacute;moire et
      les syst&egrave;mes de fichiers sauvegard&eacute; dans un
      fichier.</para>

    <para>En fonction de la version de &os; que vous utilisez,
      vous devrez utiliser des outils diff&eacute;rents pour la
      cr&eacute;ation et l'utilisation de syst&egrave;mes de fichiers
      en m&eacute;moire ou sauvegard&eacute; dans un
      fichier.</para>

    <note>
      <para>Les utilisateurs de FreeBSD&nbsp;4.X devront utiliser
	&man.MAKEDEV.8; pour cr&eacute;er les fichiers sp&eacute;ciaux
	de p&eacute;riph&eacute;riques requis.  FreeBSD&nbsp;5.0
	et versions suivantes utilisent &man.devfs.5; pour
	allouer de fa&ccedil;on transparente pour l'utilisateur
	les fichiers sp&eacute;ciaux de p&eacute;riph&eacute;riques.</para>
    </note>

    <sect2 id="disks-vnconfig">
      <title>Syst&egrave;me de fichiers sauvegard&eacute;s dans un fichier
	sous FreeBSD&nbsp;4.X</title>
      <indexterm>
	<primary>disques</primary>
	<secondary>syst&egrave;me de fichiers sauvegard&eacute; dans un
	  fichier (4.X)</secondary>
      </indexterm>

      <para>L'utilitaire &man.vnconfig.8; configure et active
	les pseudo-disques vnode.  Un <firstterm>vnode</firstterm>
	est une repr&eacute;sentation d'un fichier, et est le centre
	de l'activit&eacute; du fichier.  Cela signifie que
	&man.vnconfig.8; utilise des fichiers pour cr&eacute;er et
	faire fonctionner un syst&egrave;me de fichiers.  Une
	des utilisations possibles est de monter l'image d'une
	disquette ou d'un CD conserv&eacute;e sous la forme d'un
	fichier.</para>

      <para>Pour utiliser &man.vnconfig.8;, vous avez besoin du
	support &man.vn.4; dans votre fichier de configuration du
	noyau:</para>

      <programlisting>pseudo-device vn</programlisting>

      <para>Pour monter l'image d'un syst&egrave;me de fichiers:</para>

      <example>
	<title>Utilisation de vnconfig pour monter une image
	  de syst&egrave;mes de fichiers sous FreeBSD&nbsp;4.X</title>

	<screen>&prompt.root; <userinput>vnconfig vn<replaceable>0</replaceable> <replaceable>diskimage</replaceable></userinput>
&prompt.root; <userinput>mount /dev/vn<replaceable>0</replaceable>c <replaceable>/mnt</replaceable></userinput></screen>
      </example>

      <para>Pour cr&eacute;er l'image d'un nouveau syst&egrave;me de
	fichiers avec &man.vnconfig.8;:</para>

      <example>
	<title>Cr&eacute;ation d'un nouveau disque sauvegard&eacute; sur
	  fichier avec <command>vnconfig</command></title>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=<replaceable>newimage</replaceable> bs=1k count=<replaceable>5</replaceable>k</userinput>
5120+0 records in
5120+0 records out
&prompt.root; <userinput>vnconfig -s labels -c vn<replaceable>0</replaceable> <replaceable>newimage</replaceable></userinput>
&prompt.root; <userinput>disklabel -r -w vn<replaceable>0</replaceable> auto</userinput>
&prompt.root; <userinput>newfs vn<replaceable>0</replaceable>c</userinput>
Warning: 2048 sector(s) in last cylinder unallocated
/dev/vn0c:     10240 sectors in 3 cylinders of 1 tracks, 4096 sectors
        5.0MB in 1 cyl groups (16 c/g, 32.00MB/g, 1280 i/g)
super-block backups (for fsck -b #) at:
 32
&prompt.root; <userinput>mount /dev/vn<replaceable>0</replaceable>c <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem  1K-blocks     Used    Avail Capacity  Mounted on
/dev/vn0c        4927        1     4532     0%    /mnt</screen>
      </example>
    </sect2>

    <sect2 id="disks-mdconfig">
      <title>Syst&egrave;me de fichiers sauvegard&eacute; dans un fichier
	sous FreeBSD&nbsp;5.X</title>
      <indexterm>
	<primary>disques</primary>
	<secondary>syst&egrave;me de fichiers sauvegard&eacute; dans un
	  fichier (5.X)</secondary>
      </indexterm>

      <para>L'utilitaire &man.mdconfig.8; est utilis&eacute; pour
	configurer et activer les disques m&eacute;moires,
	&man.md.4;, sous FreeBSD&nbsp;5.X.  Pour utiliser
	&man.mdconfig.8;, vous devez charger le module &man.md.4;
	ou en ajouter le support dans votre fichier de configuration
	du noyau:</para>

      <programlisting>device md</programlisting>

      <para>La commande &man.mdconfig.8; supporte trois sortes
	de disques virtuels en m&eacute;moire: les disques m&eacute;moire
	allou&eacute;s avec &man.malloc.9;, les disques m&eacute;moires
	utilisant un fichier ou l'espace de pagination comme
	espace disque.  Une des utilisations possibles est
	le montage d'images de disquettes ou de CDs conserv&eacute;es
	sous forme de fichier.</para>

      <para>Pour monter l'image d'un syst&egrave;me de fichiers:</para>

      <example>
	<title>Utilisation de <command>mdconfig</command> pour monter
	  une image d'un syst&egrave;me de fichiers sous
	  FreeBSD&nbsp;5.X</title>

	<screen>&prompt.root; <userinput>mdconfig -a -t vnode -f <replaceable>diskimage</replaceable> -u <replaceable>0</replaceable></userinput>
&prompt.root; <userinput>mount /dev/md<replaceable>0</replaceable>c <replaceable>/mnt</replaceable></userinput></screen>
      </example>

      <para>Pour cr&eacute;er l'image d'un nouveau syst&egrave;me de
	fichiers avec &man.mdconfig.8;:</para>

      <example>
	<title>Cr&eacute;ation d'un nouveau disque sauvegard&eacute; sur
	  fichier avec <command>mdconfig</command></title>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=<replaceable>newimage</replaceable> bs=1k count=<replaceable>5</replaceable>k</userinput>
5120+0 records in
5120+0 records out
&prompt.root; <userinput>mdconfig -a -t vnode -f <replaceable>newimage</replaceable> -u <replaceable>0</replaceable></userinput>
&prompt.root; <userinput>disklabel -r -w md<replaceable>0</replaceable> auto</userinput>
&prompt.root; <userinput>newfs md<replaceable>0</replaceable>c</userinput>
/dev/md0c: 5.0MB (10240 sectors) block size 16384, fragment size 2048
	using 4 cylinder groups of 1.27MB, 81 blks, 256 inodes.
super-block backups (for fsck -b #) at:
 32, 2624, 5216, 7808
&prompt.root; <userinput>mount /dev/md<replaceable>0</replaceable>c <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem  1K-blocks     Used    Avail Capacity  Mounted on
/dev/md0c        4846        2     4458     0%    /mnt</screen>
      </example>

      <para>Si vous ne pr&eacute;ciser pas de num&eacute;ro d'unit&eacute;
	avec l'option <option>-u</option>, &man.mdconfig.8;
	utilisera le m&eacute;canisme d'allocation automatique
	de &man.md.4; pour s&eacute;lectionner un
	p&eacute;riph&eacute;rique libre.
	Le nom de l'unit&eacute; allou&eacute;e s'affichera sur
	la sortie standard comme par exemple
	<devicename>md4</devicename>.  Pour plus de d&eacute;tails concernant
	&man.mdconfig.8;, r&eacute;ferrez-vous &agrave; la page de
	manuel.</para>

      <note><para>Depuis la version &os;&nbsp;5.1-RELEASE,
	l'utilitaire &man.bsdlabel.8; remplace l'ancien programme
	&man.disklabel.8;.  Avec &man.bsdlabel.8; de nombreuses
	options et param&egrave;tres obsol&egrave;tes ont
	&eacute;t&eacute; retir&eacute;s; dans l'exemple ci-dessus,
	l'option <option>-r</option> doit &ecirc;tre enlev&eacute;e.
	Pour plus d'information, consultez la page de manuel
	&man.bsdlabel.8;.</para></note>

      <para>L'outil &man.mdconfig.8; est tr&egrave;s utile, cependant
	son utilisation demande de nombreuses lignes de commandes
	pour cr&eacute;er un syst&egrave;me de fichiers sauvegard&eacute;
	sur fichier.  FreeBSD&nbsp;5.0 vient avec un outil appel&eacute;
	&man.mdmfs.8;, ce programme configure un disque &man.md.4;
	en utilisant &man.mdconfig.8;, y ajoute dessus un
	syst&egrave;me de fichiers UFS en utilisant &man.newfs.8;, et le
	monte avec &man.mount.8;.  Par exemple, si vous d&eacute;sirez
	cr&eacute;er et monter la m&ecirc;me image de syst&egrave;me de
	fichiers que pr&eacute;c&eacute;demment, tapez simplement ce
	qui suit:</para>

      <example>
	<title>Cr&eacute;ation et montage d'un disque sauvegard&eacute;
	  sur fichier avec <command>mdmfs</command></title>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=<replaceable>newimage</replaceable> bs=1k count=<replaceable>5</replaceable>k</userinput>
5120+0 records in
5120+0 records out
&prompt.root; <userinput>mdmfs -F <replaceable>newimage</replaceable> -s <replaceable>5</replaceable>m md<replaceable>0</replaceable> <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0        4846    2  4458     0%    /mnt</screen>
      </example>

      <para>Si vous utilisez l'option <option>md</option> sans
	num&eacute;ro d'unit&eacute;, &man.mdmfs.8; utilisera la fonction
	automatique de s&eacute;lection d'unit&eacute; de &man.md.4; pour
	choisir un p&eacute;riph&eacute;rique non utilis&eacute;.  Pour
	plus de d&eacute;tails au sujet de &man.mdmfs.8;,
	r&eacute;ferrez-vous &agrave; la page de manuel.</para>

    </sect2>

    <sect2 id="disks-md-freebsd4">
      <title>Syst&egrave;me de fichiers en m&eacute;moire sous
	FreeBSD&nbsp;4.X</title>
      <indexterm>
	<primary>disques</primary>
	<secondary>syst&egrave;me de fichiers en m&eacute;moire
	  (4.X)</secondary>
      </indexterm>

      <para>Le pilote de p&eacute;riph&eacute;rique &man.md.4; est un
	moyen simple et efficace pour cr&eacute;er des syst&egrave;mes
	de fichiers en m&eacute;moire sous FreeBSD&nbsp;4.X.
	&man.malloc.9; est utilis&eacute; pour allouer la
	m&eacute;moire.</para>

      <para>Prenez simplement un syst&egrave;me de fichiers que
	vous avez pr&eacute;par&eacute; avec, par exemple, &man.vnconfig.8;,
	et:</para>

      <example>
	<title>Disque m&eacute;moire md sous FreeBSD&nbsp;4.X</title>

	<screen>&prompt.root; <userinput>dd if=<replaceable>newimage</replaceable> of=/dev/md<replaceable>0</replaceable></userinput>
5120+0 records in
5120+0 records out
&prompt.root; <userinput>mount /dev/md<replaceable>0c</replaceable> <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem  1K-blocks     Used    Avail Capacity  Mounted on
/dev/md0c        4927        1     4532     0%    /mnt</screen>
      </example>

      <para>Pour plus de d&eacute;tails, veuillez vous r&eacute;ferrer
	&agrave; la page de manuel &man.md.4;.</para>
    </sect2>

    <sect2 id="disks-md-freebsd5">
      <title>Syst&egrave;me de fichiers en m&eacute;moire sous
	FreeBSD&nbsp;5.X</title>
      <indexterm>
	<primary>disques</primary>
	<secondary>syst&egrave;me de fichiers en m&eacute;moire
	  (5.X)</secondary>
      </indexterm>

      <para>Les m&ecirc;mes outils sont utilis&eacute;s pour
	les syst&egrave;mes de fichiers en m&eacute;moire ou sauvegard&eacute;
	sur fichiers: &man.mdconfig.8; or &man.mdmfs.8;.  L'espace
	disque utilis&eacute; par le syst&egrave;me de fichiers
	m&eacute;moire est allou&eacute; avec &man.malloc.9;.</para>

      <example>
	<title>Cr&eacute;ation d'un disque m&eacute;moire avec
	  <command>mdconfig</command></title>

	<screen>&prompt.root; <userinput>mdconfig -a -t malloc -s <replaceable>5</replaceable>m -u <replaceable>1</replaceable></userinput>
&prompt.root; <userinput>newfs -U md<replaceable>1</replaceable></userinput>
/dev/md1: 5.0MB (10240 sectors) block size 16384, fragment size 2048
	using 4 cylinder groups of 1.27MB, 81 blks, 256 inodes.
	with soft updates
super-block backups (for fsck -b #) at:
 32, 2624, 5216, 7808
&prompt.root; <userinput>mount /dev/md<replaceable>1</replaceable> <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md1        4846    2  4458     0%    /mnt</screen>
      </example>

      <example>
	<title>Cr&eacute;ation d'un disque m&eacute;moire avec
	  <command>mdmfs</command></title>
	<screen>&prompt.root; <userinput>mdmfs -M -s <replaceable>5</replaceable>m md<replaceable>2</replaceable> <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md2        4846    2  4458     0%    /mnt</screen>
      </example>

      <para>Au lieu d'utiliser une syst&egrave;me de fichiers dont
	l'espace disque repose sur &man.malloc.9;, il est
	possible d'utiliser de l'espace de pagination, pour cela
	remplacez juste <option>malloc</option> avec
	<option>swap</option> dans la ligne de commande de
	&man.mdconfig.8;.  L'utilitaire &man.mdmfs.8; par
	d&eacute;faut (sans <option>-M</option>) cr&eacute;&eacute;
	un disque bas&eacute; sur l'espace de pagination.  Pour
	plus de d&eacute;tail, r&eacute;ferrez-vous aux pages de manuel
	&man.mdconfig.8; et &man.mdmfs.8;.</para>
    </sect2>

    <sect2>
      <title>D&eacute;tacher un disque m&eacute;moire du syst&egrave;me</title>
      <indexterm>
	<primary>disques</primary>
	<secondary>d&eacute;tacher un disque m&eacute;moire</secondary>
      </indexterm>

      <para>Quand un syst&egrave;me de fichiers en m&eacute;moire ou
	sauvegard&eacute; dans un fichier n'est pas utilis&eacute;,
	vous devriez rendre au syst&egrave;me toutes les ressources.
	La premi&egrave;re chose &agrave; faire est de d&eacute;monter le
	syst&egrave;me de fichiers, ensuite utiliser &man.mdconfig.8;
	pour d&eacute;tacher le disque du syst&egrave;me et rendre les
	ressources.</para>

      <para>Par exemple pour d&eacute;tacher et lib&eacute;rer
	toutes les ressources utilis&eacute;es par
	<filename>/dev/md4</filename>:</para>

      <screen>&prompt.root; <userinput>mdconfig -d -u <replaceable>4</replaceable></userinput></screen>

      <para>Il est possible d'afficher des informations
	sur les p&eacute;riph&eacute;riques &man.md.4; configur&eacute;s
	en utilisant la commande <command>mdconfig
	-l</command>.</para>

      <para>Sous FreeBSD&nbsp;4.X, &man.vnconfig.8; est utilis&eacute;
	pour d&eacute;tacher le p&eacute;riph&eacute;rique.  Par
	exemple pour d&eacute;tacher et lib&eacute;rer toutes les
	ressources utilis&eacute;es par
	<filename>/dev/vn4</filename>:</para>

      <screen>&prompt.root; <userinput>vnconfig -u vn<replaceable>4</replaceable></userinput></screen>


    </sect2>
  </sect1>

  <sect1 id="snapshots">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Tom</firstname>
	  <surname>Rhodes</surname>
	  <contrib>Contribution de </contrib>
	</author>
      </authorgroup>
      <!-- 15 JUL 2002 -->
    </sect1info>

    <title>Instantan&eacute; (&ldquo;Snapshot&rdquo;) d'un syst&egrave;me de fichiers</title>

    <indexterm>
      <primary>Instantan&eacute; de syst&egrave;me de fichiers</primary>
      <secondary>Snapshot</secondary>
    </indexterm>

      <para>FreeBSD&nbsp;5.0 en association avec les
	<link linkend="soft-updates">Soft Updates</link> offre une
	nouvelle caract&eacute;ristique: les instantan&eacute;s de
	syst&egrave;mes de fichiers (&ldquo;file system
	snapshots&rdquo;).</para>

      <para>Les instantan&eacute;s permettent &agrave; un utilisateur de
	cr&eacute;er des images d'un syst&egrave;me de fichiers
	pr&eacute;cis, et de les traiter comme un fichier.
	Les instantan&eacute;s doivent &ecirc;tre cr&eacute;&eacute;s
	dans le syst&egrave;me de fichiers sur lequel on veut effectuer
	l'op&eacute;ration, et un utilisateur ne pourra pas cr&eacute;er
	plus de 20 instantan&eacute;s par syst&egrave;me de fichiers.
	Les instantan&eacute;s actifs sont enregistr&eacute;s dans le
	superbloc, ils sont donc conserv&eacute;s durant les
	op&eacute;rations de d&eacute;montage et de remontage lors des
	red&eacute;marrages du syst&egrave;me.  Quand un instantan&eacute;
	n'est plus requis, il peut &ecirc;tre supprim&eacute; avec
	la commande standard &man.rm.1;.  Les instantan&eacute;s peuvent
	&ecirc;tre supprim&eacute;s dans n'importe quel ordre,
	cependant tout l'espace utilis&eacute; pourra ne pas
	&ecirc;tre &agrave; nouveau disponible car un autre instantan&eacute;
	r&eacute;clamera &eacute;ventuellement les blocs
	lib&eacute;r&eacute;s.</para>

      <para>Lors de la cr&eacute;ation initial, l'indicateur
	<option>schg</option> (voir la page de manuel &man.chflags.1;)
	est positionn&eacute; pour s'assurer que m&ecirc;me l'utilisateur
	<username>root</username> ne pourra pas &eacute;crire sur
	l'instantan&eacute;.  La commande &man.unlink.1; fait une
	exception pour les fichiers d'instantan&eacute;s puisque elle
	autorise leur suppression avec l'indicateur
	<option>schg</option> positionn&eacute;, il n'est donc pas
	n&eacute;cessaire de d&eacute;sactiver l'indicateur
	<option>schg</option> avant d'effacer un instantan&eacute;.</para>

      <para>Les instantan&eacute;s sont cr&eacute;&eacute;s avec la commande
	&man.mount.8;.  Pour placer un instantan&eacute; de
	<filename>/var</filename> dans le fichier
	<filename>/var/snapshot/snap</filename> utilisez la commande
	suivante:</para>

<screen>&prompt.root; <userinput>mount -u -o snapshot /var/snapshot/snap /var</userinput></screen>

      <para>Alternativement, vous pouvez utiliser &man.mksnap.ffs.8;
	pour cr&eacute;er un instantan&eacute;:

      <screen>&prompt.root; <userinput>mksnap_ffs /var /var/snapshot/snap</userinput></screen>

      <para>Une fois un instantan&eacute; cr&eacute;&eacute;, ce dernier
	pourra avoir de nombreux usages:</para>

      <itemizedlist>
	<listitem>
	  <para>Certains administrateurs utiliseront un instantan&eacute;
	    pour des besoins de sauvegarde, car l'instantan&eacute;
	    peut &ecirc;tre transf&eacute;r&eacute; sur CD ou bande.</para>
	</listitem>

	<listitem>
	  <para>Un contr&ocirc;le d'int&eacute;grit&eacute; des fichiers,
	    &man.fsck.8;, pourra &ecirc;tre effectu&eacute; sur
	    l'instantan&eacute;.  En supposant que le syst&egrave;me de
	    fichiers &eacute;tait propre quand il a &eacute;t&eacute;
	    mont&eacute;, vous devriez toujours obtenir un r&eacute;sultat
	    positif (et non diff&eacute;rent).  C'est essentiellement
	    que effectue le processus de &man.fsck.8; en t&acirc;che
	    de fond (&ldquo;background &man.fsck.8;&rdquo;).</para>
	</listitem>

	<listitem>
	  <para>Lancer l'utilitaire &man.dump.8; sur l'instantan&eacute;.
	    Une image coh&eacute;rente du syst&egrave;me de fichiers avec
	    les param&egrave;tres temporels de l'instantan&eacute;
	    sera produite.
	    &man.dump.8; peut &eacute;galement &agrave; partir d'un
	    instantan&eacute;, cr&eacute;er une image et puis supprimer
	    l'instantan&eacute; en une seule fois en utilisant l'indicateur
	    <option>-L</option> dans la ligne de commande.</para>
	</listitem>

	<listitem>
	  <para>Monter l'instantan&eacute; comme une image fig&eacute;e
	    du syst&egrave;me de fichiers.  Pour monter l'instantan&eacute;
	    <filename>/var/snapshot/snap</filename> lancer:</para>

<screen>&prompt.root; <userinput>mdconfig -a -t vnode -f /var/snapshot/snap -u 4</userinput></screen>
<screen>&prompt.root; <userinput>mount -r /dev/md4 /mnt</userinput></screen>

	</listitem>
      </itemizedlist>

      <para>Vous pouvez maintenant parcourir l'arborescence de
	votre syst&egrave;me de fichiers <filename>/var</filename>
	fig&eacute; monter sous <filename>/mnt</filename>.
	Tout sera dans le m&ecirc;me &eacute;tat que lors de la
	cr&eacute;ation de l'instantan&eacute;.  La seule exception est que les
	instantan&eacute;s ant&eacute;rieurs appara&icirc;tront
	sous la forme de fichiers vides.  Quand l'utilisation d'un
	instantan&eacute; est termin&eacute;e, il peut &ecirc;tre
	d&eacute;mont&eacute; avec:</para>

<screen>&prompt.root; <userinput>umount /mnt</userinput></screen>
<screen>&prompt.root; <userinput>mdconfig -d -u 4</userinput></screen>

      <para>Pour plus d'informations sur les
	<option>softupdates</option> et les instantan&eacute;s de
	syst&egrave;mes de fichiers, et &eacute;galement de la documentation
	technique, vous pouvez consulter le site Web de
	Marshall Kirk McKusick &agrave; l'adresse
	<ulink url="http://www.mckusick.com/">http://www.mckusick.com.</ulink></para>
  </sect1>

  <sect1 id="quotas">
    <title>Quotas d'utilisation des disques</title>
    <indexterm>
      <primary>accounting</primary>
      <secondary>espace disque</secondary>
    </indexterm>
    <indexterm><primary>quotas disque</primary></indexterm>

    <para>Les quotas sont une option du syst&egrave;me d'exploitation
      qui vous permet de limiter la quantit&eacute; d'espace disque
      et/ou le nombre de fichiers auxquels ont droit un utilisateur
      ou tous les utilisateurs d'un m&ecirc;me groupe, sur un syst&egrave;me
      de fichiers donn&eacute;.  On les utilise la plupart du temps
      sur les syst&egrave;mes en temps partag&eacute; o&ugrave; il est
      souhaitable de limiter la quantit&eacute; de ressources allou&eacute;e
      &agrave; un utilisateur ou &agrave; un groupe.  Cela &eacute;vitera qu'un
      utilisateur ou un groupe d'utilisateur consomme tout l'espace
      disque.</para>

    <sect2>
      <title>Configurer votre syst&egrave;me pour pouvoir utiliser
	les quotas d'utilisation des disques</title>

      <para>Avant d'essayer de mettre en place des quotas disque, il
	est n&eacute;cessaire de s'assurer que le noyau est configur&eacute;
	pour les quotas.  Cela se fait en ajoutant la ligne suivante
	dans votre fichier de configuration du noyau:</para>

      <programlisting>options QUOTA</programlisting>

      <para>Cette option n'est pas activ&eacute;e par d&eacute;faut dans le
	noyau <filename>GENERIC</filename> de base, vous devrez donc
	configurer, compiler et installer un noyau sur-mesure pour
	utiliser les quotas disque.  Reportez-vous au chapitre <xref
	linkend="kernelconfig"> pour plus d'informations sur la
	configuration du noyau.</para>

      <para>Ensuite vous devrez activer les quotas disques dans le
	fichier <filename>/etc/rc.conf</filename>.  Pour cela, ajoutez
	la ligne:</para>

      <programlisting>enable_quotas="YES"</programlisting>
      <indexterm>
        <primary>quotas disque</primary>
        <secondary>contr&ocirc;le</secondary>
      </indexterm>
      <para>Pour un contr&ocirc;le plus fin des quotas au d&eacute;marrage
	du syst&egrave;me, il existe une variable suppl&eacute;mentaire de
	configuration.  Normalement au d&eacute;marrage,
	l'int&eacute;grit&eacute; des quotas sur chaque syst&egrave;me de
	fichiers est v&eacute;rifi&eacute;e par le programme
	&man.quotacheck.8;.  Ce programme s'assure que les donn&eacute;es
	de la base de donn&eacute;es des quotas correspondent bien aux
	donn&eacute;es pr&eacute;sentes sur le syst&egrave;me de
	fichiers.  C'est un processus consommateur en temps qui
	affectera consid&eacute;rablement la dur&eacute;e de
	d&eacute;marrage du syst&egrave;me.  Si vous d&eacute;sirez passer
	cette &eacute;tape, une variable dans
	<filename>/etc/rc.conf</filename> est pr&eacute;vue &agrave; cet
	effet:</para>

      <programlisting>check_quotas="NO"</programlisting>

      <para>Si vous utilisez une version de FreeBSD ant&eacute;rieure &agrave;
	la 3.2-RELEASE, la configuration est plus simple, et ne
	consiste qu'en une seule variable.  Ajoutez la variable
	suivante dans votre fichier
	<filename>/etc/rc.conf</filename>:</para>

      <programlisting>check_quotas="YES"</programlisting>

      <para>Vous devez enfin &eacute;diter le fichier
	<filename>/etc/fstab</filename> pour activer les quotas
	syst&egrave;me de fichiers par syst&egrave;me de fichiers.  C'est
	l&agrave; que vous pouvez soit activer les quotas par utilisateur ou
	par groupe soit les pour les deux sur tous vos syst&egrave;mes
	de fichiers.</para>

      <para>Pour activer les quotas par utilisateur sur un syst&egrave;me
	de fichiers, ajouter l'option <option>userquota</option>
	dans le champ d'options sur l'entr&eacute;e de
	<filename>/etc/fstab</filename> pour le syst&egrave;me de fichiers
	sur lequel vous voulez activer les quotas.  Par
	exemple:</para>

      <programlisting>/dev/da1s2g   /home    ufs rw,userquota 1 2</programlisting>

      <para>De m&ecirc;me, pour activer les quotas par groupe, utilisez
	l'option <option>groupquota</option> &agrave; la place de
	<option>userquota</option>.  Pour activer &agrave; la fois les quotas
	par utilisateur et par groupe, modifiez l'entr&eacute;e de la
	fa&ccedil;on suivante:</para>

      <programlisting>/dev/da1s2g    /home    ufs rw,userquota,groupquota 1 2</programlisting>

      <para>Par d&eacute;faut, les fichiers o&ugrave; sont d&eacute;finis les
	quotas dans le r&eacute;pertoire racine du syst&egrave;me de fichiers
	sous les noms <filename>quota.user</filename> et
	<filename>quota.group</filename>, respectivement pour les
	quotas utilisateur et les quotas par groupe.  Consultez
	la page de manuel &man.fstab.5; pour plus d'information.
	Bien que la page de manuel &man.fstab.5; indique que vous
	pouvez sp&eacute;cifier un autre emplacement pour ces fichiers,
	cela n'est pas recommand&eacute; parce que les divers utilitaires
	qui g&egrave;rent les quotas ne semblent pas les prendre correctement
	en compte.</para>

      <para>A ce point vous devriez red&eacute;marrer votre syst&egrave;me
	avec votre nouveau noyau.  La proc&eacute;dure
	<filename>/etc/rc</filename> ex&eacute;cutera automatiquement les
	commandes n&eacute;cessaires pour cr&eacute;er les fichiers de quotas
	initiaux pour tous les quotas que vous avez d&eacute;finis
	dans <filename>/etc/fstab</filename>, vous n'avez donc pas
	besoin de cr&eacute;er &agrave; la main de fichiers de
	quotas vides.</para>

      <para>Vous ne devriez pas avoir &agrave; ex&eacute;cuter les
	commandes &man.quotacheck.8;, &man.quotaon.8;, ou
	&man.quotaoff.8; manuellement.  Cependant, vous pouvez lire
	leur page de manuel pour vous familiariser avec leur
	r&ocirc;le.</para>
    </sect2>

    <sect2>
      <title>D&eacute;finir les quotas</title>
      <indexterm>
	<primary>quotas disque</primary>
	<secondary>limites</secondary>
      </indexterm>

      <para>Une fois que vous avez activ&eacute; les quotas sur votre
	syst&egrave;me, assurez-vous que cela fonctionne correctement.
	Une mani&egrave;re simple de le faire est
	d'ex&eacute;cuter:</para>

      <screen>&prompt.root; <userinput>quota -v</userinput></screen>

      <para>Vous devriez obtenir une ligne r&eacute;sumant l'utilisation
	disque avec les quotas actuellement d&eacute;finis pour chaque
	syst&egrave;me de fichiers sur lesquels il y a des quotas.</para>

      <para>Vous &ecirc;tes maintenant pr&ecirc;t &agrave; d&eacute;finir les
	quotas avec la commande &man.edquota.8;.</para>

      <para>Vous disposez de diff&eacute;rentes options pour instaurer
	les quotas d'espace disque allou&eacute; &agrave; un utilisateur
	ou &agrave; un groupe, et le nombre de fichiers qu'ils peuvent
	cr&eacute;er.  Vous pouvez baser les limitations sur l'espace disque
	allou&eacute; (quotas en nombre de blocs) ou sur le nombre de
	fichiers (quotas en inode) ou les deux.  Ces options
	peuvent &ecirc;tre divis&eacute;es en deux cat&eacute;gories: les
	limites strictes ou souples.</para>

      <indexterm><primary>limite stricte</primary></indexterm>
      <para>Une limite stricte ne peut &ecirc;tre d&eacute;pass&eacute;e.
	Une fois qu'un utilisateur atteint sa limite stricte, il
	ne pourra plus rien allouer sur le syst&egrave;me de fichiers
	en question.  Par exemple, si l'utilisateur a droit &agrave; une
	limite stricte de 500 blocs sur un syst&egrave;me de fichiers et en
	utilise 490 blocs, il ne pourra allouer que 10 blocs
	suppl&eacute;mentaires.  Une tentative d'allouer 11 blocs
	&eacute;chouerait.</para>

      <indexterm><primary>limite souple</primary></indexterm>
      <para>Une limite souple peut &ecirc;tre d&eacute;pass&eacute;e
	pour une p&eacute;riode de temps restreinte.  C'est ce que l'on
	appelle le d&eacute;lai de gr&acirc;ce, qui est d'une semaine
	par d&eacute;faut.  Si un utilisateur d&eacute;passe cette limite
	au del&agrave; du d&eacute;lai de gr&acirc;ce, cette limite
	devient stricte, et plus aucune allocation ne sera possible.
	Quand l'utilisateur redescend en dessous de la limite souple,
	le d&eacute;lai de gr&acirc;ce est &agrave; nouveau
	r&eacute;accorder.</para>

      <para>Ce qui suit est un exemple de ce que vous pourrez voir
	en utilisant la commande &man.edquota.8;.  Quand vous invoquez
	la commande &man.edquota.8;, vous vous retrouvez dans
	l'&eacute;diteur d&eacute;fini par la variable d'environnement
	<envar>EDITOR</envar>, ou sous <application>vi</application>
	si la variable d'environnement <envar>EDITOR</envar> n'est
	pas positionn&eacute;e, ce qui vous permet d'&eacute;diter les
	quotas.</para>

      <screen>&prompt.root; <userinput>edquota -u test</userinput></screen>

      <programlisting>Quotas for user test:
/usr: blocks in use: 65, limits (soft = 50, hard = 75)
        inodes in use: 7, limits (soft = 50, hard = 60)
/usr/var: blocks in use: 0, limits (soft = 50, hard = 75)
        inodes in use: 0, limits (soft = 50, hard = 60)</programlisting>

      <para>vous verrez normalement deux lignes pour chaque syst&egrave;me
	de fichiers sur lequel il y a des quotas.  Une ligne pour
	les quotas de blocs, et une autre pour la limite d'inode.
	Modifiez simplement les valeurs que vous voulez mettre &agrave; jour.
	Par exemple, pour augmenter la limite de blocs accord&eacute;e
	&agrave; cet utilisateur de 50 pour la limite souple et de 75 pour la
	limite stricte &agrave; 500 pour la limite souple et 600 pour la
	limite stricte, modifiez:</para>

      <programlisting>/usr: blocks in use: 65, limits (soft = 50, hard = 75)</programlisting>

      <para>en:</para>

      <programlisting>/usr: blocks in use: 65, limits (soft = 500, hard = 600)</programlisting>

      <para>Les nouveaux quotas seront en service d&egrave;s que vous
	quitterez l'&eacute;diteur.</para>

      <para>Il est parfois souhaitable de d&eacute;finir des quotas
	pour une plage d'UIDs (identifiants utilisateur).  Cela
	peut &ecirc;tre r&eacute;alis&eacute; avec l'option
	<option>-p</option> de la commande &man.edquota.8;.
	D&eacute;finissez d'abord les quotas pour un seul utilisateur, et
	puis ex&eacute;cutez
	<command>edquota -p protouser startuid-enduid</command>.
	Par exemple, si l'utilisateur <username>test</username>
	dispose des quotas d&eacute;sir&eacute;s, la commande suivante peut
	&ecirc;tre utilis&eacute;e pour appliquer ces quotas pour les UIDs
	de 10000 &agrave; 19999:</para>

      <screen>&prompt.root; <userinput>edquota -p test 10000-19999</userinput></screen>

      <para>Pour plus d'informations consultez la page de manuel
	&man.edquota.8;.</para>
    </sect2>

    <sect2>
      <title>Consulter les quotas et l'utilisation des disques</title>
      <indexterm>
	<primary>quotas disque</primary>
	<secondary>contr&ocirc;le</secondary>
      </indexterm>

      <para>Vous pouvez soit utiliser la commande &man.quota.1;
	soit la commande &man.repquota.8; pour consulter les quotas
	et l'utilisation des disques.  La commande &man.quota.1;
	peut &ecirc;tre employ&eacute;e pour conna&icirc;tre
	les quotas et l'utilisation des disques pour un utilisateur et
	un groupe.  Un utilisateur ne peut consulter que ses propres
	quotas et ceux d'un groupe auquel il appartient.  Seul le
	super-utilisateur peut consulter les quotas et l'usage disque
	de tous les utilisateurs et groupes.  La commande
	&man.repquota.8; permet d'obtenir un r&eacute;sum&eacute; de tous
	les quotas et l'utilisation disque pour les syst&egrave;mes
	de fichiers sur lesquels il y a des quotas.</para>

      <para>Ce qui suit est un extrait de la sortie de la commande
	<command>quota -v</command> pour un utilisateur pour lequel
	on a d&eacute;fini des quotas sur deux syst&egrave;mes de
	fichiers.</para>

      <programlisting>Disk quotas for user test (uid 1002):
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
           /usr      65*     50      75   5days       7      50      60
       /usr/var       0      50      75               0      50      60</programlisting>

      <indexterm><primary>d&eacute;lai de gr&acirc;ce</primary></indexterm>
      <para>Sur le syst&egrave;me de fichiers <filename>/usr</filename>
	dans l'exemple ci-dessus, l'utilisateur occupe 15 blocs de
	plus que la limite de 50 blocs qui lui est allou&eacute;e et
	dispose d'un d&eacute;lai de gr&acirc;ce de 5 jours.  Notez
	l'ast&eacute;risque <literal>*</literal> qui indique que
	l'utilisateur d&eacute;passe actuellement son quota.</para>

      <para>Normalement les syst&egrave;mes de fichiers sur lesquels
	l'utilisateur n'occupe pas d'espace n'apparaissent pas
	dans la sortie de la commande &man.quota.1;, m&ecirc;me s'il a des
	quotas sur ces syst&egrave;mes de fichiers.  L'option
	<option>-v</option> listera ces syst&egrave;mes de fichiers, comme
	<filename>/usr/var</filename> dans l'exemple ci-dessus.</para>
    </sect2>

    <sect2>
      <title>Quotas avec NFS</title>
      <indexterm><primary>NFS</primary></indexterm>

      <para>Les quotas sont g&eacute;r&eacute;s par le sous-syst&egrave;me
	de gestion des quotas sur le serveur NFS.  Le d&eacute;mon
	&man.rpc.rquotad.8; fournit les informations sur les quotas
	&agrave; la commande &man.quota.1; des clients NFS, permettant
	aux utilisateurs sur ces machines de consulter l'utilisation
	des quotas qui leur sont allou&eacute;s.</para>

      <para>Activez <command>rpc.rquotad</command> dans
	<filename>/etc/inetd.conf</filename> de la fa&ccedil;on
	suivante:</para>

      <programlisting>rquotad/1      dgram rpc/udp wait root /usr/libexec/rpc.rquotad rpc.rquotad</programlisting>

      <para>Puis red&eacute;marrez <command>inetd</command>:</para>

      <screen>&prompt.root; <userinput>kill -HUP `cat /var/run/inetd.pid`</userinput></screen>
    </sect2>
  </sect1>

  <sect1 id="disks-encrypting">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Lucky</firstname>
	  <surname>Green</surname>
	  <contrib>Contribution de </contrib>
	  <affiliation>
	    <address><email>shamrock@cypherpunks.to</email></address>
	  </affiliation>
	</author>
      </authorgroup>
      <!-- 11 MARCH 2003 -->
    </sect1info>

    <title>Chiffrer les partitions d'un disque</title>
    <indexterm>
      <primary>disques</primary>
      <secondary>chiffrement</secondary></indexterm>

    <para>&os; offre d'excellentes protections contre un acc&egrave;s
      non autoris&eacute; aux donn&eacute;es par l'interm&eacute;diaire du
      r&eacute;seau.  Les permissions sur les fichiers et le contr&ocirc;le
      d'acc&egrave;s obligatoire &mdash; &ldquo;Mandatory Access
      Control&rdquo; (MAC) (voir <xref linkend="mac">) emp&ecirc;chent
      l'acc&egrave;s aux donn&eacute;es pour des tiers non autoris&eacute;s
      quand le syst&egrave;me d'exploitation est actif et l'ordinateur en
      fonctionnement.  Cependant, des permissions renforc&eacute;s
      sont inutiles si l'attaquant a un acc&egrave;s physique &agrave;
      un ordinateur et peut simplement d&eacute;placer le disque dur
      sur un autre syst&egrave;me pour copier et analyser les
      donn&eacute;es sensibles.</para>

    <para>Ind&eacute;pendament de la mani&egrave;re dont un attaquant s'est
      trouv&eacute; en possession d'un disque dur ou a arr&ecirc;t&eacute;
      un ordinateur, le <application>chiffrage de disque bas&eacute;
      sur GEOM (gbde)</application> (&ldquo;GEOM Based Disk
      Encryption&rdquo;) peut prot&eacute;ger les donn&eacute;es des
      syst&egrave;mes de fichiers contre des attaquants tr&egrave;s
      motiv&eacute;s et aux ressources importantes.  A la
      diff&eacute;rence des m&eacute;thodes de chiffrage lourdes qui
      chiffrent uniquement les fichiers individuels,
      <application>gbde</application> chiffre de mani&egrave;re
      transparente l'int&eacute;gralit&eacute; du syst&egrave;me de fichiers.
      Aucun texte en clair ne touche les plateaux du disque.</para>

    <sect2>
      <title>Activer le support gbde dans le noyau</title>

      <procedure>
	<step>
	  <title>Devenir <username>root</username></title>

	  <para>La configuration de <application>gbde</application>
	    requiert les privil&egrave;ges du super-utilisateur.</para>

	  <screen>&prompt.user; <userinput>su -</userinput>
Password:</screen>
	</step>

	<step>
	  <title>V&eacute;rifier la version du syst&egrave;me
	    d'exploitation</title>

	  <para>&man.gbde.4; demande FreeBSD 5.0 ou suivante.</para>

	  <screen>&prompt.root; <userinput>uname -r</userinput>
5.0-RELEASE</screen>
	</step>

	<step>
	  <title>Ajouter le support &man.gbde.4; au fichier de
	    configuration du noyau</title>

	  <para>En utilisant votre &eacute;diteur de texte favoris,
	    ajoutez la ligne suivnate &agrave; votre fichier de configuration
	    du noyau:</para>

	  <para><literal>options GEOM_BDE</literal></para>

	  <para>Configurez, recompilez, et installez le noyau &os;.
	    Ce processus est d&eacute;crit dans <xref
	    linkend="kernelconfig">.</para>

	  <para>Red&eacute;marrez avec le nouveau noyau.</para>
	</step>
      </procedure>
    </sect2>

    <sect2>
      <title>Pr&eacute;paration du disque dur chiffr&eacute;</title>

      <para>L'exemple suivant suppose que vous ajoutez un nouveau
	disque dur &agrave; votre syst&egrave;me et qui contiendra une
	seule partition chiffr&eacute;e.  Cette partition sera
	mont&eacute;e sous <filename>/private</filename>.
	<application>gbde</application> peut &eacute;galement &ecirc;tre
	utilis&eacute; pour chiffrer les r&eacute;pertoires
	<filename>/home</filename> et <filename>/var/mail</filename>,
	mais cela demande une configuration plus complexe qui
	d&eacute;passe le cadre de cette introduction.</para>

      <procedure>
	<step>
	  <title>Ajouter le nouveau disque</title>

	  <para>Installez le nouveau disque commen expliqu&eacute; dans
	    <xref linkend="disks-adding">.  Pour les besoins de cet
	    exemple, une nouvelle partition disque a &eacute;t&eacute;
	    ajout&eacute;e en tant que <devicename>/dev/ad4s1c</devicename>.
	    Les p&eacute;riph&eacute;riques du type
	    <devicename>/dev/ad0s1<replaceable>*</replaceable></devicename>
	    repr&eacute;sentent les partitions &os; standards sur le
	    syst&egrave;me exemple.</para>

	  <screen>&prompt.root; <userinput>ls /dev/ad*</userinput>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4</screen>
	</step>

	<step>
	  <title>Cr&eacute;er un r&eacute;pertoire pour h&eacute;berger
	    les fichiers de verrouillage de GBDE</title>

	  <screen>&prompt.root; <userinput>mkdir /etc/gbde</userinput></screen>

	  <para>Le fichier de verrouillage de
	    <application>gbde</application> contient l'information
	    n&eacute;cessaire &agrave; <application>gbde</application> pour
	    acc&eacute;der aux partitions chiffr&eacute;es.  Sans acc&egrave;s
	    au fichier de verrouillage,
	    <application>gbde</application> sera incapable de
	    d&eacute;chiffrer les donn&eacute;es contenues sur la partition
	    chiffr&eacute;e sans une aide manuelle significative ce
	    qui n'est pas support&eacute; par le logiciel.  Chaque
	    partition chiffr&eacute;e utilise un fichier de verrouillage
	    propre.</para>
	</step>

	<step>
	  <title>Initialiser la partition gbde</title>

	  <para>Une partition <application>gbde</application>
	    doit &ecirc;tre initialis&eacute;e avant d'&ecirc;tre utilisable.
	    Cette initialisation doit &ecirc;tre effectu&eacute;e une seule
	    fois:</para>

	  <screen>&prompt.root; <userinput>gbde init /dev/ad4s1c -i -L /etc/gbde/ad4s1c</userinput></screen>

	  <para>&man.gbde.8; lancera votre &eacute;diteur, vous permettant
	    de fixer diverses options de configuration dans un
	    gabarit.  Pour une utilisation de UFS1 ou UFS2, fixez
	    l'option <literal>sector_size</literal> &agrave;
	    2048:</para>

	  <programlisting>$<!-- This is not the space you are looking
for-->FreeBSD: src/sbin/gbde/template.txt,v 1.1 2002/10/20 11:16:13 phk Exp $
#
# La taille d'un secteur est la plus petite unit&eacute; de donn&eacute;e
# qui peut &ecirc;tre lue ou &eacute;crite.
# Une valeur trop petite diminue les performances et l'espace
# disponible.
# Une valeur trop grande peut emp&ecirc;cher des syst&egrave;mes de
# fichiers de fonctionner correctement.  512 est la valeur minimale
# et sans risque.  Pour l'UFS, utiliser la taille d'un fragment
#
sector_size     =       2048
[...]
</programlisting>

	  <para>&man.gbde.8; vous demandera de taper deux fois
	    la phrase d'authentification qui devra &ecirc;tre
	    utilis&eacute;e pour s&eacute;curiser les donn&eacute;es.  La
	    phrase d'authentification doit &ecirc;tre la m&ecirc;me
	    dans les deux cas.  La capacit&eacute; de
	    <application>gbde</application> &agrave; prot&eacute;ger
	    vos donn&eacute;es d&eacute;pend de la qualit&eacute; de la
	    phrase d'authentification que vous avez choisie.
	  <footnote>
          <para>Pour des conseils sur comment choisir une
	    phrase d'authentification s&eacute;curis&eacute;e et facile
	    &agrave; retenir, consultez le site Web <ulink
	    url="http://world.std.com/~reinhold/diceware.html">Diceware
	    Passphrase</ulink>.</para></footnote></para>

	  <para>La commande <command>gbde init</command> cr&eacute;e
	    un fichier de verrouillage pour votre partition
	    <application>gbde</application> qui dans cet exemple est
	    stock&eacute; sous <filename>/etc/gbde/ad4s1c</filename>.</para>

	  <caution>
	    <para>Les fichiers de verrouillage de
	      <application>gbde</application>
	      <emphasis>doivent</emphasis> &ecirc;tre conserv&eacute;s de
	      pair avec le contenu des partitions chiffr&eacute;es.
	      Alors que la suppression seule d'un fichier de
	      verrouillage ne peut emp&ecirc;cher une personne
	      d&eacute;termin&eacute;e de d&eacute;chiffrer une partition
	      <application>gbde</application>, sans le fichier
	      de verrouillage, le propri&eacute;taire l&eacute;gitime sera
	      incapable d'acc&egrave;der aux donn&eacute;es de la partition
	      chiffr&eacute;e sans beaucoup de travail ce qui est
	      totalement non support&eacute; par
	      &man.gbde.8; et son concepteur.</para>
	  </caution>
	</step>

	<step>
	  <title>Attacher la partition chiffr&eacute;e au noyau</title>

	  <screen>&prompt.root; <userinput>gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c</userinput></screen>

	  <para>On vous demandera de fournir la phrase
	    d'authentification que vous avez choisie lors de
	    l'initialisation de la partition chiffr&eacute;e.  Le
	    nouveau p&eacute;riph&eacute;rique chiffr&eacute; appara&icirc;tra
	    dans <filename>/dev</filename> en tant que
	    <filename>/dev/nom_p&eacute;riph&eacute;rique.bde</filename>:</para>

	  <screen>&prompt.root; <userinput>ls /dev/ad*</userinput>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4        /dev/ad4s1c.bde</screen>
	</step>

	<step>
	  <title>Cr&eacute;er un syst&egrave;me de fichiers
	    sur le p&eacute;riph&eacute;rique chiffr&eacute;</title>

	  <para>Une fois que le p&eacute;riph&eacute;rique chiffr&eacute;
	    a &eacute;t&eacute; attach&eacute; au noyau, vous pouvez cr&eacute;er
	    un syst&egrave;me de fichiers sur le p&eacute;riph&eacute;rique.
	    Pour cr&eacute;er un syst&egrave;me de fichiers sur le
	    p&eacute;riph&eacute;rique, utilisez &man.newfs.8;.
	    Puisqu'il est plus rapide d'initialiser un nouveau
	    syst&egrave;me de fichiers UFS2 qu'un nouveau syst&egrave;me
	    UFS1, l'utilisation de &man.newfs.8; avec l'option
	    <option>-O2</option> est recommand&eacute;.</para>

	  <note><para>L'option <option>-O2</option> est utilis&eacute;e
	    par d&eacute;faut avec &os;&nbsp;5.1-RELEASE et
	    suivante.</para></note>

	  <screen>&prompt.root; <userinput>newfs -U -O2 /dev/ad4s1c.bde</userinput></screen>

	  <note>
	    <para>La commande &man.newfs.8; peut &ecirc;tre effectu&eacute;e
	      sur une partition <application>gbde</application>
	      attach&eacute;e qui est identifi&eacute;e par une extension
	      <filename><replaceable>*</replaceable>.bde</filename>
	      au niveau du nom de p&eacute;riph&eacute;rique.</para>
	  </note>
	</step>

	<step>
	  <title>Monter la partition chiffr&eacute;e</title>

	  <para>Cr&eacute;ez un point de montage pour le syst&egrave;me
	    de fichiers chiffr&eacute;.</para>

	  <screen>&prompt.root; <userinput>mkdir /private</userinput></screen>

	  <para>Montez le syst&egrave;me de fichiers chiffr&eacute;.</para>

	  <screen>&prompt.root; <userinput>mount /dev/ad4s1c.bde /private</userinput></screen>
	</step>

	<step>
	  <title>V&eacute;rifiez que le syst&egrave;me de fichiers
	    chiffr&eacute; est disponible</title>

	  <para>Le syst&egrave;me de fichiers chiffr&eacute; devrait
	    &ecirc;tre visible par &man.df.1; et pr&ecirc;t &agrave;
	    &ecirc;tre utilis&eacute;:</para>

	  <screen>&prompt.user; <userinput>df -H</userinput>
Filesystem        Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a      1037M    72M   883M     8%    /
/devfs            1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f       8.1G    55K   7.5G     0%    /home
/dev/ad0s1e      1037M   1.1M   953M     0%    /tmp
/dev/ad0s1d       6.1G   1.9G   3.7G    35%    /usr
/dev/ad4s1c.bde   150G   4.1K   138G     0%    /private</screen>
	</step>
      </procedure>
    </sect2>

    <sect2>
      <title>Montage des syst&egrave;mes de fichiers chiffr&eacute;s</title>

      <para>Apr&egrave;s chaque d&eacute;marrage, tout syst&egrave;me
	de fichiers chiffr&eacute; doit &ecirc;tre rattach&eacute;
	au noyau, contr&ocirc;l&eacute; pour les erreurs, et mont&eacute;,
	avant que les syst&egrave;mes de fichiers ne puissent &ecirc;tre
	utilis&eacute;s.  Les commandes n&eacute;cessaires doivent &ecirc;tre
	ex&eacute;cut&eacute;es en tant que
	<username>root</username>.</para>

      <procedure>
	<step>
	  <title>Attacher la partition gdbe au noyau</title>

	  <screen>&prompt.root; <userinput>gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c</userinput></screen>

	  <para>On vous demandera de fournir la phrase
	    d'authentification que vous avez choisie lors de
	    l'initialisation de la partition gbde chiffr&eacute;e.</para>
	</step>

	<step>
	  <title>Contr&ocirc;ler les erreurs du syst&egrave;me de fichiers</title>

	  <para>Puisque les syst&egrave;mes de fichiers chiffr&eacute;s
	    ne peuvent &ecirc;tre encore list&eacute;s dans le fichier
	    <filename>/etc/fstab</filename> pour un montage
	    automatique, on doit donc contr&ocirc;ler les syst&egrave;mes de
	    fichiers pour d'&eacute;ventuelles erreurs en ex&eacute;cutant
	    manuellement &man.fsck.8; avant le montage.</para>

	  <screen>&prompt.root; <userinput>fsck -p -t ffs /dev/ad4s1c.bde</userinput></screen>
	</step>

	<step>
	  <title>Monter le syst&egrave;me de fichiers chiffr&eacute;</title>

	  <screen>&prompt.root; <userinput>mount /dev/ad4s1c.bde /private</userinput></screen>

	  <para>Le syst&egrave;me de fichiers est maintenant
	    disponible &agrave; l'utilisation.</para>
	</step>
      </procedure>

      <sect3>
	<title>Montage automatique de partitions chiffr&eacute;es</title>

	<para>Il est possible de cr&eacute;er une proc&eacute;dure pour
	  automatiquement attacher, contr&ocirc;ler, et monter une
	  partition chiffr&eacute;e, mais pour des raisons de
	  s&eacute;curit&eacute; la proc&eacute;dure ne devrait pas contenir le
	  mot de passe &man.gbde.8;.  A la place, il est recommand&eacute;
	  que de telles proc&eacute;dures soient ex&eacute;cut&eacute;es
	  manuellement tout en fournissant le mot de passe via la
	  console ou &man.ssh.1;.</para>
      </sect3>
    </sect2>

      <sect2>
	<title>Les protections cryptographiques utilis&eacute;es
	  par gbde</title>

	<para>&man.gbde.8; chiffre la partie utile des secteurs en
	  utilisant le chiffrage AES 128 bits en mode CBC.  Chaque
	  secteur sur le disque est chiffr&eacute; avec une cl&eacute; AES
	  diff&eacute;rente.  Pour plus d'informations sur l'architecture
	  cryptographique de <application>gbde</application>, y
	  compris comment les cl&eacute;s pour chaque secteur sont
	  des d&eacute;riv&eacute;s de la phrase d'authentification
	  donn&eacute;e par l'utilisateur, voir la page de manuel
	  &man.gbde.4;.</para>
      </sect2>

      <sect2>
	<title>Probl&egrave;mes de compatibilit&eacute;</title>

	<para>&man.sysinstall.8; est incompatible avec
	  les p&eacute;riph&eacute;riques
	  <application>gbde</application>-chiffr&eacute;s.  Tous les
	  p&eacute;riph&eacute;riques
	  <devicename><replaceable>*</replaceable>.bde</devicename>
	  doivent &ecirc;tre d&eacute;tach&eacute;s du noyau
	  avant de lancer &man.sysinstall.8; ou ce dernier plantera
	  durant son processus initial de recherche des
	  p&eacute;riph&eacute;riques.  Pour d&eacute;tacher le
	  p&eacute;riph&eacute;rique chiffr&eacute; utilis&eacute; dans notre
	  exemple, utilisez la commande suivante:</para>

	<screen>&prompt.root; <userinput>gbde detach /dev/ad4s1c</userinput></screen>

	<para>Notez &eacute;galement qu'&eacute;tant donn&eacute;
	  que &man.vinum.4; n'utilise pas le sous-syst&egrave;me
	  &man.geom.4;, vous ne pouvez utiliser
	  <application>gbde</application> avec des volumes
	  <application>vinum</application>.</para>
      </sect2>

  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->

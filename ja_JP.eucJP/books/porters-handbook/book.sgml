<!--
     The FreeBSD Documentation Project
     The FreeBSD Japanese Documentation Project

     Original revision: 1.304
     $FreeBSD$
-->

<!DOCTYPE BOOK PUBLIC "-//FreeBSD//DTD DocBook V4.1-Based Extension//EN" [
<!ENTITY % books.ent PUBLIC "-//FreeBSD//ENTITIES DocBook FreeBSD Books Entity Set//EN">
%books.ent;
]>

<book>
  <bookinfo>
    <title>FreeBSD port 作成者のためのハンドブック</title>

    <authorgroup>
      <corpauthor>FreeBSD ドキュメンテーションプロジェクト</corpauthor>
    </authorgroup>

    <pubdate>2000 年 4 月</pubdate>

    <copyright>
      <year>2000</year>
      <year>2001</year>
      <year>2002</year>
      <year>2003</year>
      <holder role="mailto:doc@FreeBSD.org">The FreeBSD Documentation
	Project</holder>
    </copyright>

    <abstract>
      <para>このハンドブックは FreeBSD の port 作成者 (porter) 向けに、
	具体的な port の作成方法や注意点などをまとめたものです。</para>

      <para>日本語版の作成は FreeBSD 日本語ドキュメンテーション
	プロジェクト (FreeBSD doc-jp) が行なっています。
	日本語訳および、日本語版のみに関することは FreeBSD &a.jp.doc-jp; に
	おいて日本語で議論されています。
      </para>

      <para>文書の日本語訳に関するお問い合わせや、
	文書の原文に関する問い合わせをしたいが英語が得意でないという方は、
	FreeBSD &a.jp.doc-jp; まで日本語でコメントをお寄せください。</para>
    </abstract>

    &bookinfo.legalnotice;
  </bookinfo>

  <chapter id="own-port">
    <title>自分で port を作成するには</title>

    <para>自分で port を作ることや、既存の port の
      更新作業に興味があるのですか。それはすばらしい!</para>

    <para>ここでは FreeBSD 用の port を作る際の
      ガイドラインをいくつか示します。
      既存の port を更新したいと考えている場合であっても、
      まずこの章を読んでから、次に
      <xref linkend="port-upgrading"> を読むようにしてください。</para>

    <para>この文書では充分に詳細がわからない場合には、
      <filename>/usr/ports/Mk/bsd.port.mk</filename> を参照してください。
      このファイルは、port の Makefile が例外なくインクルードしているものです。
      これには細かくコメントが書かれていますので、Makefile を読むのに
      あまり慣れていない人でも、たくさんの情報を得ることができるでしょう。
      それでも解決できないような質問は、&a.ports; にポストしてみるのも
      良いでしょう。</para>

    <note>
      <para>この文書では、上書き可能な
	変数 (<makevar><replaceable>VAR</replaceable></makevar>) のうち
	一部のものについてだけ述べています。
	(すべてでは無いかもしれませんが、) ほとんどの変数は
	<filename>bsd.port.mk</filename> の先頭部分に記述されています。
	なお、このファイルは非標準のタブ設定を使用しています。
	<application>Emacs</application> や <application>Vim</application> は、
	この設定をファイルの読み込み時に認識するはずです。
	<command>vi</command> と <command>ex</command> では、
	一旦ファイルを読み込んでから <command>:set tabstop=4</command> と
	タイプすることで、正しい値に設定することができます。</para>
    </note>
  </chapter>

  <chapter id="quick-porting">
    <title>3 分間 porting</title>

    <para>このセクションでは、簡単な port の作り方について説明します。
      多くの場合、これだけでは不充分ですが、
      まあ うまくいくかどうか試してみて損はないでしょう。</para>

    <para>まず、元の tar ファイルを
      <makevar>DISTDIR</makevar> に置きます。この変数の
      デフォルト値は <filename>/usr/ports/distfiles</filename> です。</para>

    <note>
      <para>以下の例では、そのソフトウェアが
	そのままコンパイル可能なものと仮定しています。
	つまり、FreeBSD マシンで動かすために、
	変更がまったく必要ないという意味です。
	もし何か変更が必要な場合には、次のセクションも
	参照する必要があるでしょう。</para>
    </note>

    <sect1 id="porting-makefile">
      <title><filename>Makefile</filename> の作成</title>

      <para>最小限の <filename>Makefile</filename> は
	次のようなものになります。</para>

      <programlisting># New ports collection makefile for:   oneko
# Date created:     5 December 1994
# Whom:             asami
#
# &dollar;FreeBSD&dollar;
#

PORTNAME=       oneko
PORTVERSION=    1.1b
CATEGORIES=     games
MASTER_SITES=   ftp://ftp.cs.columbia.edu/archives/X11R5/contrib/

MAINTAINER=     asami@FreeBSD.org
COMMENT=        A cat chasing a mouse all over the screen

MAN1=           oneko.1
MANCOMPRESSED=  yes
USE_IMAKE=      yes

.include &lt;bsd.port.mk&gt;</programlisting>

      <para>おわかりでしょうか。<literal>&dollar;FreeBSD&dollar;</literal> を
	含む行の内容については、気にする必要はありません。
	この行は、このファイルが FreeBSD の ports ツリーに
	取り込まれる際に、CVS によって自動的に書き込まれます。
	もっと詳しい例が見たい場合には、
	<link linkend="porting-samplem">Makefile のサンプル</link>の
	セクションをご覧ください。</para>
    </sect1>

    <sect1 id="porting-desc">
      <title>package 記述ファイルの作成</title>

      <para>package にするしないに関わらず、どのような port でも
	2 つの記述ファイルが必要です。それは
	<filename>pkg-descr</filename> と
	<filename>pkg-plist</filename> です。ファイル名が
	<filename>pkg-</filename> で始まっていることで
	他のファイルと区別できるようになっています。</para>

      <sect2>
	<title><filename>pkg-descr</filename></title>

	<para>このファイルには、その port についての少し長い説明を書きます。
	  その port が何をするのかについての、
	  数段落程度の簡潔な解説があれば充分です。</para>

	<note>
	  <para>これはマニュアルでもなければ、使用方法やコンパイル方法に
	    ついての細かい説明書でも<emphasis>ありません</emphasis>。
	    <emphasis><filename>README</filename> ファイルや
	    マニュアルを引用するつもりなら注意が必要です</emphasis>。
	    これらは多くの場合、その port の簡潔な説明になっていなかったり、
	    扱いにくい形式になっていたりします。
	    (マニュアルの場合、行を揃えるために空白が調整されていたりします。)
	    このソフトウェアに公式のウェブサイトがあるのなら、
	    ここに書いてください。その際自動化ツールが正しく動作するように、
	    ウェブサイトのうちの<emphasis>一つ</emphasis>には、
	    先頭に <literal>WWW:</literal> をつけておいてください。</para>
	</note>

	<para>このファイルの最後に、あなたの名前を書くことが推奨されています。
	  たとえば、こんな具合です。</para>

	<programlisting>This is a port of oneko, in which a cat chases a poor mouse all over
the screen.
 :
(うんぬん。)

WWW: http://www.oneko.org/

- Satoshi
asami@cs.berkeley.edu</programlisting>
      </sect2>

      <sect2>
	<title><filename>pkg-plist</filename></title>

	<para>このファイルには、その port によってインストールされる
	  すべてのファイルを列挙します。
	  このファイルは package を作る際のリストとして使われるため、
	  <quote>パッキングリスト (packing list)</quote> とも呼ばれます。
	  ここに書くパス名は、インストール時のプレフィックス
	  (通常 <filename>/usr/local</filename> または
	  <filename>/usr/X11R6</filename>) からの相対パスです。
	  <makevar>MAN<replaceable>n</replaceable></makevar> 変数を
	  使用している場合 (使用することが推奨されています)、このリストに
	  マニュアルは入れないようにしてください。</para>

	<para>簡単な例を載せておきましょう。</para>

	<programlisting>bin/oneko
lib/X11/app-defaults/Oneko
lib/X11/oneko/cat1.xpm
lib/X11/oneko/cat2.xpm
lib/X11/oneko/mouse.xpm
@dirrm lib/X11/oneko</programlisting>

	<para>パッキングリストの詳細については、
	  &man.pkg.create.1; のマニュアルを参照してください。</para>

	<note>
	  <para>このリストには、すべてのファイルを列挙しなければ
	    なりませんが、ディレクトリそのものは列挙する必要がありません。
	    また、この port がインストール時に独自のディレクトリを
	    作成する場合には、この port が削除されるときに
	    そのディレクトリも削除されるよう、<literal>@dirrm</literal> の行を
	    追加しておくのを忘れないでください。</para>

	  <para>このファイルでは、すべてのファイル名を
	    アルファベット順にソートしておくことを推奨します。
	    そうすることで、port を更新する際の
	    変更点の確認が楽になります。</para>

	  <para>パッキングリストを手作業で作成するのは、
	    時にとても退屈な作業になります。
	    その port が非常に多数のファイルをインストールするとしたら、
	    <link linkend="porting-autoplist"> パッキングリストの
	    自動生成</link>を行なえば、時間の節約になるかもしれません。</para>
	</note>
      </sect2>
    </sect1>

    <sect1 id="porting-checksum">
      <title>チェックサムファイルの作成</title>

      <para><command>make makesum</command> と入力するだけで、
	(訳注: <filename>bsd.port.mk</filename> に書かれている)
	port 生成ルールに従い、
	自動的に <filename>distinfo</filename> ファイルが生成されます。</para>
    </sect1>

    <sect1 id="porting-testing">
      <title>port のテスト</title>

      <para>package 化も含め、その port が思った通りに
	動くことを確認してください。
	確認の必要な重要ポイントは以下の通りです。</para>

      <itemizedlist>
	<listitem>
	  <para>その port がインストールしないものが
	    <filename>pkg-plist</filename> に含まれていないこと。</para>
	</listitem>

	<listitem>
	  <para>その port がインストールする、すべてのものが
	    <filename>pkg-plist</filename> に含まれていること。</para>
	</listitem>

	<listitem>
	  <para><maketarget>reinstall</maketarget>
	    ターゲットを使うことで、その port が
	    何度でもインストール可能なこと。</para>
	</listitem>

	<listitem>
	  <para>その port が deintall される際には
	    <link linkend="porting-cleaning">後片付け</link>をすること。</para>
	</listitem>
      </itemizedlist>

      <procedure>
	<title>推奨されるテストの手順</title>

	<step>
	  <para><command>make install</command></para>
	</step>

	<step>
	  <para><command>make package</command></para>
	</step>

	<step>
	  <para><command>make deinstall</command></para>
	</step>

	<step>
	  <para><command>pkg_add <replaceable>package 名</replaceable>
	    </command></para>
	</step>

	<step>
	  <para><command>make deinstall</command></para>
	</step>

	<step>
	  <para><command>make reinstall</command></para>
	</step>

	<step>
	  <para><command>make package</command></para>
	</step>
      </procedure>

      <para><maketarget>package</maketarget> および
	<maketarget>deinstall</maketarget> の段階で、
	どんな警告 (warning) も出力されないことを確認してください。
	ステップ 3 の後、(訳注: その port が作成した) すべての新しい
	ディレクトリが正しく消去されていることを確認してください。
	また、ステップ 4 の後にそのソフトウェアを使用してみて、
	package からインストールされた場合にも正しく動作することを
	確認してください。</para>
    </sect1>

    <sect1 id="porting-portlint">
      <title><command>portlint</command> によるチェック</title>

      <para><command>portlint</command> を使い、その port が FreeBSD の
	ガイドラインに沿っているかどうかを確認してください。
	<command>portlint</command> プログラムは ports collection に
	含まれています。
	特に、<link linkend="porting-samplem">Makefile</link> が
	正しい形式になっているか、
	<link linkend="porting-pkgname">package</link> の
	名前が正しいかどうかをチェックするのに良いでしょう。</para>
    </sect1>

    <sect1 id="porting-submitting">
      <title>port の提出</title>

      <para>まず、<link linkend="porting-dads"> やって良いこと悪いこと</link>の
	セクションを読んでください。</para>

      <para>さて、満足のいく port が完成したら、残るは
	それを FreeBSD のメインの ports ツリーに置いて、
	他の人にも使ってもらうだけです。
	<filename>work</filename> ディレクトリや
	<filename>pkgname.tgz</filename> といった package は
	必要ありませんから、まずこれらを消去してください。
	あとは <command>shar `find port_dir`</command> の出力を
	バグレポートに入れ、&man.send-pr.1; プログラムを使用して
	送ってください (&man.send-pr.1; についての詳細は<ulink
	url="../../articles/contributing/contrib-how.html#CONTRIB-GENERAL">
	バグ報告と一般的な論評</ulink>を参照してください)。
	もし、圧縮していない状態で 20KB 以上あるような port であれば、
	それを ひとつの tar ファイルにまとめて圧縮し、
	バグレポートに入れる前に &man.uuencode.1; を使用してください
	(20KB 以下のものを tar ファイルにして送っても良いのですが、
	あまり歓迎されません)。
	バクレポートの category は必ず <literal>ports</literal>,
	class は <literal>change-request</literal> としてください
	(レポートを <literal>confidential</literal> (機密) 指定には
	しないでください!)。
	また、port 化したプログラムの短い説明文を
	バグレポートの <quote>Description</quote> フィールドに追加して、
	<quote>Fix</quote> フィールドには shar したファイル、
	もしくは uuencode した tar ファイルを追加するようにしてください。
	後者は、ports 管理の作業をスクリプトで行なっている
	コミッターの助けとなります。</para>

      <para>もう一度、<emphasis>オリジナルのソースファイルや
	<filename>work</filename> ディレクトリ、
	<command>make package</command> で作成した package が
	含まれていないこと</emphasis>を確認してください。</para>

      <note>
	<para>以前には、新しい port を提出する際に FreeBSD の FTP サイト
	  (<hostid role="fqdn">ftp.FreeBSD.org</hostid>) に
	  アップロードするように お願いしていたことがあります。
	  現在このサイトの <filename>incoming</filename> ディレクトリは
	  読み出し不可になっており、アップロードは推奨されていません。
	  たくさんの海賊版ソフトウェアがそこに置かれたためです。</para>
      </note>

      <para>port を提出したら、辛抱強くお待ちください。時には、ある
	port が FreeBSD に取り込まれるまで、数日しかかかりそうもないの
	に、数ヶ月かかることもあります。<ulink
	url="http://www.FreeBSD.org/cgi/query-pr-summary.cgi?category=ports">
	FreeBSD へのコミット待ちの ports</ulink> の一覧が見られます。</para>

      <para>わたしたちがひとたびその port をチェックしたら、必要なら
	あなたに確認して、それをツリーへ置きます。
	あなたの名前は<ulink
	  url="../../articles/contributors/contrib-additional.html">その他の
	  FreeBSD への貢献者</ulink>の一覧やその他のファイルにも載るでしょう。
	う〜ん、素晴らしい。<!-- smiley -->:-)</para>
      <!-- kuriyama - should use link tag? -->

      <note>
	<para>わたしたちが作業しやすいように、
	  障害報告の概要 (synopsis) は適切に記述してください。
	  たとえば新しい port の提出なら
	  <quote>New port: &lt;port の簡単な説明&gt;</quote>、
	  port の更新なら
	  <quote>Update port: &lt;カテゴリ&gt;/&lt;port 名&gt; &lt;更新内容の簡単な説明&gt;</quote>
	  といった形式が歓迎されます。
	  こういう方法で報告するように心がけていれば、あなたの報告 (PR) が
	  すぐに誰かの目にとまる確率が ぐっと高くなるのです。</para>
      </note>
    </sect1>
  </chapter>

  <chapter id="slow">
    <title>本格的な port</title>

    <para>残念ながら移植がそう簡単ではなく、それを動かすために
      多少の変更が必要になる場合もあるでしょう。
      このセクションでは、模範的な ports の作法に従い、
      どのように変更を行なって動くようにするのかを
      順を追って説明します。</para>

    <sect1 id="slow-work">
      <title>port 構築の詳細</title>

      <para>まず、あなたが port のディレクトリで
	<command>make</command> と
	入力してから起こる一連の出来事について、
	順を追って説明します。
	ここを読むときには、別のウィンドウに
	<filename>bsd.port.mk</filename> を表示しておくと
	理解の助けになるかもしれません。</para>

      <para>しかし、<filename>bsd.port.mk</filename> が何をしているのか
	完全に理解できなくても 心配する必要はありません。
	それほど多くの人が理解している というわけでは ありませんから…。
	<!-- smiley --><emphasis>f(^_^;)</emphasis></para>

      <procedure>
	<step>
	  <para>まず、<maketarget>fetch</maketarget> という
	    ターゲットが実行されます。
	    この <maketarget>fetch</maketarget> ターゲットは、
	    配布ファイルがローカルの <makevar>DISTDIR</makevar> に
	    存在することを保証する役目を持っています。
	    もし必要なファイルが <makevar>DISTDIR</makevar> に
	    存在しなければ、<maketarget>fetch</maketarget> ターゲットは
	    <filename>Makefile</filename> で指定された
	    <makevar>MASTER_SITES</makevar> 中の URL や、
	    FreeBSD のメイン FTP サイト <ulink
	    url="ftp://ftp.FreeBSD.org/pub/FreeBSD/ports/distfiles/"></ulink>
	    (ここにはバックアップとして、われわれ ports 管理者が確認した
	    配布ファイルを置いてあります) を探しにいきます。
	    <command>make</command> を実行するマシンがインターネットに
	    接続されていて、目的のファイルを <makevar>FETCH</makevar> で
	    取ってこれた場合には、それを <makevar>DISTDIR</makevar> に
	    保存します。</para>
	</step>

	<step>
	  <para>次に <maketarget>extract</maketarget> ターゲットが実行されます。
	    このターゲットは <makevar>DISTDIR</makevar> から
	    配布ファイル (普通は gzip された tar ファイル) を読み込み、
	    その内容を作業ディレクトリ <makevar>WRKDIR</makevar>
	    (デフォルトでは <filename>work</filename>) に展開します。</para>
	</step>

	<step>
	  <para>次に <maketarget>patch</maketarget> ターゲットが実行されます。
	    まず、<makevar>PATCHFILES</makevar> にパッチファイルが
	    指定されていれば、そのパッチを適用します。

	    次に、<makevar>PATCHDIR</makevar> ディレクトリ
	    (デフォルトでは <filename>files</filename> サブディレクトリ) に
	    <filename>patch-<replaceable>*</replaceable></filename> という
	    名前のパッチファイルが存在すれば、
	    これらをアルファベット順に適用します。</para>
	</step>

	<step>
	  <para>次に <maketarget>configure</maketarget> ターゲットが
	    実行されます。
	    これには、いろいろな場合があります。</para>

	  <orderedlist>
	    <listitem>
	      <para><filename>scripts/configure</filename> が
		存在する場合には、そのスクリプトが実行されます。</para>
	    </listitem>

	    <listitem>
	      <para><makevar>HAS_CONFIGURE</makevar> または
		<makevar>GNU_CONFIGURE</makevar> がセットされていれば、
		<filename><makevar>WRKSRC</makevar>/configure</filename> が
		実行されます。</para>
	    </listitem>

	    <listitem>
	      <para><makevar>USE_IMAKE</makevar> がセットされていれば、
		<makevar>XMKMF</makevar>
		(デフォルトでは <command>xmkmf -a</command>) が
		実行されます。</para>
	    </listitem>
	  </orderedlist>
	</step>

	<step>
	  <para>最後に <maketarget>build</maketarget> ターゲットが実行されます。
	    これは作業ディレクトリ (<makevar>WRKSRC</makevar>) に降りていき、
	    ビルド (コンパイル) を実行するのが役目です。
	    <makevar>USE_GMAKE</makevar> がセットされていれば
	    GNU <command>make</command> が使用され、
	    セットされていなければ FreeBSD の <command>make</command> が
	    使用されます。</para>
	</step>
      </procedure>

      <para>上記はデフォルトの動作です。これに加えて
	<maketarget>pre-<replaceable> 何とか</replaceable></maketarget>や
	<maketarget>post-<replaceable> 何とか</replaceable></maketarget>という
	ターゲットを定義したり、そのような名前のスクリプトを
	<filename>scripts</filename> サブディレクトリに置くことも可能で、
	それぞれデフォルトの動作の前や後に実行されます。</para>

      <para>たとえば、<maketarget>post-extract</maketarget> ターゲットが
	<filename>Makefile</filename> に定義されていて、
	<filename>scripts</filename> サブディレクトリに
	<filename>pre-build</filename> というファイルが置かれている場合、
	<maketarget>post-extract</maketarget> ターゲットは
	通常の展開動作の後に呼び出され、
	<filename>pre-build</filename> スクリプトは
	デフォルトのコンパイル動作の前に実行されます。
	実行する動作が簡単であれば、スクリプトよりも
	<filename>Makefile</filename> のターゲットを使用することが
	推奨されています。
	なぜなら、その port では どのような非標準の動作が必要とされるのか、
	一箇所にまとめて書いてあった方が他の人に理解しやすいからです。</para>

      <para>デフォルトの動作は <filename>bsd.port.mk</filename> の
	<maketarget>do-<replaceable> 何とか</replaceable></maketarget>という
	ターゲットで実行されます。
	たとえば port を展開するコマンドは
	<maketarget>do-extract</maketarget> ターゲットに書かれています。
	もしデフォルトのターゲットに不満があれば、
	<filename>Makefile</filename> 中で
	<maketarget>do-<replaceable> 何とか</replaceable></maketarget>という
	ターゲットを再定義することにより、
	好きなように変更することができます。</para>

      <note>
	<para><quote>メイン</quote>のターゲット
	  (たとえば <maketarget>extract</maketarget>,
	  <maketarget>configure</maketarget>、その他) は、
	  すべての前段階が実行されていることを確認してから、
	  実際のターゲットやスクリプトを呼び出す以外のことは
	  行ないませんし、これらが変更されることも想定されていません。
	  もし展開の方法を変更したいときには
	  <maketarget>do-extract</maketarget> の変更によって実現し、
	  絶対に <maketarget>extract</maketarget> には
	  手を触れないでください。</para>
      </note>

      <para>これで、ユーザが <command>make</command> と
	入力したときに何が起こるのかが理解できたと思います。
	では、完璧な port を作成するための推奨手順を
	順に見ていきましょう。</para>
    </sect1>

    <sect1 id="slow-sources">
      <title>オリジナルのソースの入手</title>

      <para>(通常の場合、) 圧縮された tar ファイルの形
	(<filename><replaceable>foo</replaceable>.tar.gz</filename> あるいは
	<filename><replaceable>foo</replaceable>.tar.Z</filename>) で
	オリジナルのソースを入手して、
	それを <makevar>DISTDIR</makevar> にコピーします。
	できる限り、<emphasis>主流の</emphasis>ソースを
	使用するようにしてください。</para>

      <para>ネットワークへの接続の良好な FTP/HTTP サイトを
	見つけることができなかったり、頭にくるような非標準的な形式しか
	置いていないサイトしか見つけられないときには、
	自分の管理下にあり信頼できる FTP サーバや HTTP サーバ
	(たとえば、あなた自身のホームページ) に置くこともできます。
	あなたが選んだサーバが <makevar>MASTER_SITES</makevar> に
	正しく反映されていることを確認してください。</para>

      <para>そのような便利かつ信頼のおける置き場所が見つからない場合、
	我々が <hostid>ftp.FreeBSD.org</hostid> に
	<quote>置き場所</quote>を提供することもできます。
	配布ファイルは、誰かの <hostid>freefall</hostid> アカウントの
	<filename>~/public_distfiles/</filename> に置かれることでしょう。
	その port をコミットする人に、置いてもらえるように頼んでください。
	その人は配布ファイルを置いて、<makevar>MASTER_SITES</makevar> を
	<makevar>MASTER_SITE_LOCAL</makevar> にセットし、
	<makevar>MASTER_SITE_SUBDIR</makevar> には
	自分の <hostid>freefall</hostid> ユーザ名を
	入れておいてくれるでしょう。</para>

      <para>その port の配布ファイルが特に理由もなく
	しょっちゅう変わる場合には、その配布ファイルを
	あなたのホームページに置いて、<makevar>MASTER_SITES</makevar> の
	最初に指定することも考えてみてください。
	そうすれば、ユーザが <errorname>checksum mismatch</errorname> エラーに
	悩まされることもなくなりますし、FreeBSD の FTP サイトの
	保守担当者の負担も減らすこともできます。
	また、その port にマスターサイトが一つしか存在しない場合には、
	あなたのサイトにバックアップを置き、
	それを <makevar>MASTER_SITES</makevar> の 2 番目に
	指定すると良いでしょう。</para>

      <para>その port がインターネット上で入手できる追加パッチを
	必要とするのなら、それも取ってきて
	<makevar>DISTDIR</makevar> に置いてください。
	それらがメインのソースの tar ファイルとは別のサイトに
	あったとしても、心配する必要はありません。
	そのような状況にも ちゃんと対応できるようになっています
	(後述の <link linkend="porting-patchfiles">PATCHFILES の記述</link>を
	ご覧ください)。</para>
    </sect1>

    <sect1 id="slow-modifying">
      <title>port の修正</title>

      <para>作業用のディレクトリに tar ファイルを展開し、
	最新バージョンの FreeBSD 上で正しくコンパイルするために必要な、
	あらゆる変更を行ないます。
	この処理は最終的に自動化するわけですから、
	何を行なったかを<emphasis>注意深く記録しておきましょう</emphasis>。
	この port が完成した暁には、ファイルの削除、追加、
	修正を含むすべての処理が自動化されたスクリプトや
	パッチファイルで行なえるようになっていなければなりません。</para>

      <para>その port のコンパイルやインストールのために必要な手作業が
	あまりに多いようならば、Larry Wall の芸術的な
	<application>Configure</application> スクリプトを
	参考にしたほうが良いかもしれません。
	新しい ports collection は、エンドユーザにとって個々の port が
	可能な限り<quote>プラグ &amp; プレイ</quote>かつ
	最小のディスク消費で make できることを目指しています。</para>

      <note>
	<para>明示的に記述されている場合を除き、あなたが作成して
	  FreeBSD の ports collection に寄付したパッチファイル、
	  スクリプトおよびその他のファイルは、標準的な BSD の
	  著作権条件によりカバーされているものと見なされます。</para>
      </note>
    </sect1>

    <sect1 id="slow-patch">
      <title>パッチの適用</title>

      <para>port の準備段階で追加されたり変更されたりしたファイルは、
	再帰的 diff によりパッチファイル化することができます。
	パッチは適当にまとめて
	<filename>patch-<replaceable>*</replaceable></filename>
	という名前のファイルに入れてください。
	<filename><replaceable>*</replaceable></filename> は
	パッチが適用される順番を示します &mdash; これらは
	<emphasis>アルファベット順</emphasis>、
	つまり <literal>aa</literal> が最初、
	<literal>ab</literal> が その次といった順番で処理されます。
	お望みなら、<filename>patch-Imakefile</filename> とか
	<filename>patch-src-config.h</filename> のように、
	パッチ対象のファイルのパス名を示す名前を使うこともできます。
	これらのファイルは <makevar>PATCHDIR</makevar> に置いてください。
	そうすれば自動的に適用されるようになっています。
	すべてのパッチは <makevar>WRKSRC</makevar> からの相対パスにする
	べきです (通常、<makevar>WRKSRC</makevar> は port の tar ファイルが
	展開されるディレクトリで、make が実行されるところと同じです)。
	修正やアップグレードを容易にするため、複数のパッチで
	同じファイルを修正するのは避けてください
	(たとえば、<filename>patch-aa</filename> と
	<filename>patch-ab</filename> が共に
	<filename><makevar>WRKSRC</makevar>/foobar.c</filename> を
	修正するなど)。</para>

      <para>RCS にとって特別な意味を持つ文字列をパッチ内に入れないようにしてください。
	ファイルを私たちのソースツリーに入れる時、
	これらの文字列は CVS によって書き換えられてしまい、
	後でまたパッチを使おうとした時にうまくいかないことがあります。
	RCS 文字列はドル記号 (<literal>&dollar;</literal>)
	で囲まれており、
	<literal>&dollar;FreeBSD</literal> や
	<literal>&dollar;RCS</literal>
	などで始まります。</para>

      <para><command>diff</command> の再帰 (<option>-r</option>)
	フラグを使って再帰的なパッチを作るのは大変結構なのですが、
	でき上がったパッチは必ず目でチェックして余計なゴミが入っていないことを確認してください。
	よくあるのはバックアップファイル同士の変更点、あるいは
	<command>Imake</command> や
	GNU <command>configure</command>
	を使うソフトウェアの
	<filename>Makefile</filename>
	の変更点が入っている場合などです。
	また <filename>configure.in</filename> を編集して
	<command>autoconf</command> を使って
	<command>configure</command> を作り直すときには、
	<command>configure</command> の diff は含めずに
	(それらは良く数千行におよぶことがあります)、
	<literal>USE_AUTOCONF=yes</literal> を定義して
	<filename>configure.in</filename> の
	diff をとってください。</para>

      <para>ファイルをまるごと消す場合には、
	パッチを使わずに
	<maketarget>post-extract</maketarget>
	ターゲットで消す方が簡単です。
	できあがった差分に満足したら、
	それらをソースのファイルごとに別々のパッチファイルに分割してください。</para>
    </sect1>

    <sect1 id="slow-configure">
      <title>コンフィグレーション</title>

      <para>カスタマイズのために追加したいコマンドがあれば、
	<filename>configure</filename> という名前のスクリプトに入れて
	<filename>scripts</filename> サブディレクトリに置いてください。
	上で述べたように、<filename>pre-configure</filename>
	あるいは <filename>post-configure</filename> という
	<filename>Makefile</filename> ターゲットや、
	スクリプトで処理することもできます。</para>
    </sect1>

    <sect1 id="slow-user-input">
      <title>ユーザからの入力の扱い</title>

      <para>もし、その port がビルド、コンフィグレーション、または
	インストールの際にユーザからの入力を必要とするならば、
	<filename>Makefile</filename> 中で
	<makevar>IS_INTERACTIVE</makevar> をセットしてください。
	これにより、ユーザが環境変数 <envar>BATCH</envar> を
	セットしている場合には、この port の処理がスキップされるので
	<quote>夜間の無人ビルド</quote> が実行可能になります。
	(逆に環境変数 <envar>INTERACTIVE</envar> がセットされていると、
	ユーザからの入力を必要とする port <emphasis>だけ</emphasis>が
	コンパイルされます)。</para>

      <para>もし、適切なデフォルト設定が存在するのであれば、
	<makevar>PACKAGE_BUILDING</makevar> 変数をチェックして、
	それが設定されている場合には
	ユーザ入力のスクリプトを起動しないようにしてください。
	こうすることによって、我々 ports 管理者が
	CDROM や FTP に 置く package を作成することができます。
      </para>
    </sect1>
  </chapter>

  <chapter id="makefile">
    <title><filename>Makefile</filename> の作成</title>

    <para><filename>Makefile</filename> の作成は非常に単純です。
      繰り返しますが、始めるまえに既存の例を見ておくことを推奨します。
      また、このハンドブックには <link
      linkend="porting-samplem">Makefile のサンプル</link>があります。
      それを見て、Makefile 内の変数の順番や
      空行を入れるところなどの参考にしてください。
      そうすると他の人々にも読みやすいものとなります。</para>

    <para>では、<filename>Makefile</filename> を設計するときに
      問題となるところを順に追って見てみましょう。</para>

    <sect1 id="makefile-source">
      <title>オリジナルのソース</title>

      <para>ソースは <filename>foozolix-1.2.tar.gz</filename> といった名前の
	標準的な gzip された tar ファイルの形式で
	<makevar>DISTDIR</makevar> に置かれていますか?
	そうなっていれば、次のステップに進めます。
	異なっている場合には、変数 <makevar>DISTNAME</makevar>, 
	<makevar>EXTRACT_CMD</makevar>,
	<makevar>EXTRACT_BEFORE_ARGS</makevar>,
	<makevar>EXTRACT_AFTER_ARGS</makevar>,
	<makevar>EXTRACT_SUFX</makevar>,
	<makevar>DISTFILES</makevar> のうち
	いくつかを書き換える必要があります。
	どれだけ変更しないといけないかは、その port の配布ファイルが
	どの程度標準からかけはなれているかによります
	(最もよくあるのは gzip ではなく普通の compress コマンドで
	tar ファイルが圧縮されている場合で、そのときは
	<literal>EXTRACT_SUFX=.tar.Z</literal> とするだけです)。</para>

      <para>最悪の場合には、自分で
	<maketarget>do-extract</maketarget> ターゲットを作成して、
	デフォルトを上書きすることもできます。
	しかし、そこまでする必要があることはめったにないでしょう。</para>
    </sect1>

    <sect1 id="makefile-naming">
      <title>名前の付け方</title>

      <para>Port の <filename>Makefile</filename> のはじめの部分で port
      に名前をつけ、バージョン番号を記述し、適切なカテゴリに載せます。</para>

      <sect2>
      <title><makevar>PORTNAME</makevar> および
	<makevar>PORTVERSION</makevar></title>

      <para><makevar>PORTNAME</makevar> には
	port の名前の基幹部分を入れ、
	<makevar>PORTVERSION</makevar>
	には port のバージョン番号を入れます。</para>
      </sect2>

      <sect2>
      <title><makevar>PORTREVISION</makevar> および
	<makevar>PORTEPOCH</makevar></title>

	<sect3>
	<title><makevar>PORTREVISION</makevar></title>

	<para><makevar>PORTREVISION</makevar> 変数は単調増加する値です。
	  <makevar>PORTVERSION</makevar> が増加した時 (つまり、
	  新しいオフィシャルベンダーリリースが行なわれた時) には
	  いつでも 0 にリセットされます。
	  また、その値が 0 でない場合には package 名に追加されます。
	  その port から作られる package の内容や構造に
	  大きな影響を与える変更を行なった時には、
	  <makevar>PORTREVISION</makevar> を増やしてください。</para>

	<para>PORTREVISION を上げる必要がある変更の例:</para>

	<itemizedlist>
	  <listitem>
	    <para>セキュリティ上の脆弱性やバグを修正するため、または
	      その port に新しい機能性を追加するためのパッチの追加。</para>
	  </listitem>

	  <listitem>
	    <para>package のコンパイル時オプションの有効化や
	      無効化のための Makefile の変更。</para>
	  </listitem>

	  <listitem>
	    <para>パッキングリストの変更や、package のインストール時の
	      挙動の変更 (たとえば、ssh のホストキーのような package の
	      初期データを生成するスクリプトの変更など)。</para>
	  </listitem>

	  <listitem>
	    <para>その port が依存する共有ライブラリのバージョンを
	      上げる場合 (新しいバージョンの共有ライブラリが
	      インストールされた後に、そのライブラリに依存していた
	      古い package をインストールを試みる場合、
	      その package は新しい libfoo.(x+1) ではなく
	      古い libfoo.x を探そうとするため、インストールに失敗します。
	      (訳注: そのため、PORTREVISION を上げた package を
	      作成する必要があるわけです))。</para>
	  </listitem>

	  <listitem>
	    <para>ひそかに port 配布ファイルの変更が行なわれ、
	      その機能に大きな変化があった場合。
	      つまり、<filename>distinfo</filename> の修正を
	      必要とするような配布ファイルの変更が行なわれ、
	      新旧のバージョンの <command>diff -ru</command> を取ると
	      些細とは言えない変更が認められるにもかかわらず、
	      オリジナルのバージョン番号が変更されていないことから
	      <makevar>PORTVERSION</makevar> の変更は難しい場合。</para>
	  </listitem>
	</itemizedlist>

	<para>PORTREVISION を上げる必要の無い変更の例:</para>

	<itemizedlist>
	  <listitem>
	    <para>生成される package に機能の変化が起らないような
	      port スケルトンのスタイル変更。</para>
	  </listitem>

	  <listitem>
	    <para>生成される package に影響しないような
	      <makevar>MASTER_SITES</makevar> その他の
	      port に対する機能変更。</para>
	  </listitem>

	  <listitem>
	    <para>誤植の修正などの些細な変更で、その package のユーザが
	      アップグレードを必要とするほどには重要でないパッチ。</para>
	  </listitem>

	  <listitem>
	    <para>以前にはコンパイルが通らなかった package を
	      ビルド可能にするための修正 (その port が以前にビルド可能だった
	      プラットフォームにおいて、その変更により何らかの機能的な
	      違いが発生しない場合に限ります)。
	      <makevar>PORTREVISION</makevar> は package の内容を
	      反映したものなので、その package が以前にビルド可能でなければ
	      内容の変更も無いため、<makevar>PORTREVISION</makevar> を
	      増やす必要はありません。</para>
	  </listitem>
	</itemizedlist>

	<para>経験的な判断方法としては、ある port にコミットされた変更が
	  (それが強化や修正によるものであれ、新しい package による
	  実質的な効能であれ)、アップデートすることにより誰かがどこかで
	  利益を受けるような何か かどうか自問してみることです。

	  もし答がイエスであれば、新しい package が利用可能になった事実を
	  (例えば <command>pkg_version</command> 等の) 自動化ツールが
	  強調することができるように、<makevar>PORTREVISION</makevar> を
	  上げるべきでしょう。</para>
	</sect3>

	<sect3>
	<title><makevar>PORTEPOCH</makevar></title>

	<para>ソフトウェアのベンダや FreeBSD の port 作成者は、
	  以前のものよりも小さい数字のバージョン番号をつけたソフトウェアを
	  リリースするといった、何か馬鹿げたことをすることが時々あります。
	  例をあげると、ある port が foo-20000801 から foo-1.0 になる
	  といった具合です (数字として見ると 20000801 は 1 よりも大きいため、
	  間違って前者の方が新しいバージョンとして扱われてしまいます)。</para>

	<para>このような場合には <makevar>PORTEPOCH</makevar> バージョンを
	  増やしてください。
	  上のセクション 0 で説明したように、
	  <makevar>PORTEPOCH</makevar> がゼロでない場合には、
	  それがパッケージ名の後ろにつけられます。
	  <makevar>PORTEPOCH</makevar> は減らされたり、ゼロに
	  リセットされることはありません。
	  さもないと、以前に作成された package との比較に失敗する
	  (つまり、その package が古くなっていることがわからない) ためです:
	  新しいバージョン番号 (上の例では<literal>1.0,1</literal>) は
	  依然として前のバージョン番号 (20000801) よりも
	  数字としては小さいのですが、自動化ツールが
	  サフィックス <literal>,1</literal> を特別扱いすることで、
	  以前の package には明示されていないサフィックス
	  <literal>,0</literal> よりも新しいことがわかります。</para>

	<para>大多数の ports では、<makevar>PORTEPOCH</makevar> が
	  必要になることは まず無いものと考えられています。
	  また、注意深く <makevar>PORTVERSION</makevar> を使用することで、
	  そのソフトウェアの将来のリリースがバージョン構造を変更する必要が出てきた場合にも、
	  多くの場合前もって対応しておくことができるでしょう。
	  しかし、<quote>スナップショット</quote>リリースのように、
	  オフィシャルなバージョン番号を持たないベンダーリリースが行なわれた時には、
	  FreeBSD 版の port 作者によるケアが必要になります。
	  そういったリリースに対し、
	  リリース日付を使ったラベルを付けたいという誘惑にかられることがあるでしょうが、
	  そうすると新しい<quote>オフィシャル</quote>リリースが行なわれた時に、
	  上の例で示したような問題が起きることでしょう。</para>

	<para>例えば、あるソフトウェアのスナップショットリリースが
	  20000917 に行なわれ、以前のバージョン番号が 1.2 だったとすると、
	  そのスナップショットの <makevar>PORTVERSION</makevar> には
	  20000917 ではなく 1.2.20000917 か何か、そのような番号を
	  指定するのが良いでしょう。
	  そうしておけば、例えばバージョン番号 1.3 として後続のリリースが
	  行なわれた場合にも、大小関係が崩されずにすむわけです。</para>
	</sect3>

	<sect3>
	<title><makevar>PORTREVISION</makevar> と
	  <makevar>PORTEPOCH</makevar> の使い方の例</title>

	<para>gtkmumble の port, バージョン 0.10 が
	  ports collection にコミットされます。</para>

	<programlisting>PORTNAME=       gtkmumble
PORTVERSION=    0.10</programlisting>

	<para><makevar>PKGNAME</makevar> は
	  <literal>gtkmumble-0.10</literal> になります。</para>

	<para>ローカルな FreeBSD パッチを必要とする
	  セキュリティホールが発見されました。
	  それに合わせて <makevar>PORTREVISION</makevar> を増やします。</para>

	<programlisting>PORTNAME=       gtkmumble
PORTVERSION=    0.10
PORTREVISION=   1</programlisting>

	<para><makevar>PKGNAME</makevar> は
	  <literal>gtkmumble-0.10_1</literal> になります。</para>

	<para>ベンダから <literal>0.2</literal> という番号が振られた
	  新バージョンがリリースされます (これにより、
	  作者は <literal>0.10</literal> という番号を
	  <quote>0.9 の次という意味ではなく</quote>、
	  実際には <literal>0.1.0</literal> のつもりで
	  使用していたことがわかります - あらら、今さら遅すぎる)。
	  新しいマイナーバージョン <literal>2</literal>
	  は数字として以前のバージョン番号 <literal>10</literal>
	  より小さいので、強制的に新しい package
	  の方を<quote>より新しい</quote>と認識させるため
	  <makevar>PORTEPOCH</makevar> を増やす必要があります。
	  これは新しいベンダーリリースなので、
	  <makevar>PORTREVISION</makevar> は 0 にリセット
	  (または Makefile から削除) されます。</para>

	 <programlisting>PORTNAME=       gtkmumble
PORTVERSION=    0.2
PORTEPOCH=      1</programlisting>

	<para><makevar>PKGNAME</makevar> は
	  <literal>gtkmumble-0.2,1</literal> になります。</para>

	<para>次のリリースは 0.3 です。
	  <makevar>PORTEPOCH</makevar> は減少することが無いため、
	  今度のバージョン変数は次のようになります:</para>

	 <programlisting>PORTNAME=       gtkmumble
PORTVERSION=    0.3
PORTEPOCH=      1</programlisting>

	<para><makevar>PKGNAME</makevar> は
	  <literal>gtkmumble-0.3,1</literal> になります。</para>

	<note>
	  <para>もし、このアップグレードによって
	    <makevar>PORTEPOCH</makevar> が <literal>0</literal> に
	    リセットされたとすると、<literal>3</literal> は数字として
	    <literal>10</literal> よりも小さいため、
	    gtkmumble-0.10_1 の package をインストールした誰かは
	    gtkmumble-0.3 の package の方が新しいことに
	    気がつかないことになるでしょう。</para>
	</note>
	</sect3>
      </sect2>

      <sect2>
      <title><makevar>PKGNAMEPREFIX</makevar> および
	<makevar>PKGNAMESUFFIX</makevar></title>

      <para>二つのオプション変数 <makevar>PKGNAMEPREFIX</makevar> と
	<makevar>PKGNAMESUFFIX</makevar> は、
	<makevar>PORTNAME</makevar> および
	<makevar>PORTVERSION</makevar> と結合され、
	<makevar>PKGNAME</makevar> を
	<literal>${PKGNAMEPREFIX}${PORTNAME}${PKGNAMESUFFIX}-${PORTVERSION}</literal>
	として定義します。
	この時、<link linkend="porting-pkgname">適切な package 名を選ぶための
	ガイドライン</link>に沿っているかどうかを確認してください。
	特に、<makevar>PORTVERSION</makevar> 中に
	ハイフン (<literal>-</literal>) を使用することは禁止されています。
	また、package 名に
	<replaceable>language-</replaceable> もしくは
	<replaceable>compiled.specifics</replaceable> 部分が
	含まれる場合、それぞれ <makevar>PKGNAMEPREFIX</makevar> と
	<makevar>PKGNAMESUFFIX</makevar> を使用してください。
	これらを <makevar>PORTNAME</makevar> の一部としてはいけません。</para>
      </sect2>

      <sect2 id="porting-pkgname">
	<title>package 名についての規則</title>

	<para>package の名前は以下のルールにしたがってつけてください。
	  これは package のディレクトリを見やすくするためで、
	  無秩序な名前がたくさん並んでいるとユーザが使いづらくなるのではという心配からです
	  (FTP サイトなどにはたくさん package がありますからね)。</para>

	<para>package の名前は以下のようにしてください。
	  <filename><replaceable>言語-</replaceable>名前<replaceable>-オプション</replaceable><replaceable>バージョン.番号</replaceable></filename></para>

	<para>package 名は
	  <literal>${PKGNAMEPREFIX}${PORTNAME}${PKGNAMESUFFIX}-${PORTVERSION}</literal>
	  というように定義されています。
	  変数がこの書式と適合していることを確認してください。</para>

	<orderedlist>
	  <listitem>
	    <para>FreeBSD
	      はユーザの慣れ親しんだ言語のサポートに力を入れています。
	      特定の言語のための port の package 名には
	      <replaceable>言語-</replaceable> に ISO-639
	      で定義されている言語名の略称を入れてください。
	      たとえば日本語なら <literal>ja</literal>、
	      ロシア語なら <literal>ru</literal>、
	      ベトナム語なら <literal>vi</literal>、
	      中国語なら <literal>zh</literal>、
	      韓国語ならば <literal>ko</literal>、
	      ドイツ語なら <literal>de</literal>
	      といった具合です。</para>

	    <para>port がある言語地域に特化したものである場合には、
	      さらに二文字の国名コードを付加してください。
	      たとえば合衆国英語圏は <literal>en_US</literal> となり、
	      スイスのフランス語圏は <literal>fr_CH</literal> となります。</para>

	    <para><replaceable>言語-</replaceable> 部分は、
	      <makevar>PKGNAMEPREFIX</makevar> 変数に
	      定義されなければなりません。</para>
	  </listitem>

	  <listitem>
	    <para><filename>名前</filename>の部分の最初の文字は
	      小文字でなければなりません。
	      (名前の残りの部分は大文字を含んでいても構わないため、
	      大文字を含んだソフトウェア名を変換する際の規則は、
	      あなた自身の裁量に任されています。)

	      Perl 5 のモジュールでは先頭に
	      <literal>p5-</literal> を付け、
	      二重コロン (<literal>::</literal>)
	      のセパレータをハイフン
	      (<literal>-</literal>)
	      に置きかえる習慣になっています。
	      たとえば
	      <literal>Data::Dumper</literal> は
	      <literal>p5-Data-Dumper</literal> になります。
	      また、そのソフトウェアの名前として通常使われるものに番号、
	      ハイフン、あるいは下線が入っている場合には、
	      それらを使うことも構いません
	      (<literal>kinput2</literal>など)。</para>
	  </listitem>

	  <listitem>
	    <para>コンパイル時に環境変数や
	      <command>make</command> の引数などで<link linkend="porting-masterdir">ハードコードされたデフォルト</link>を変えてコンパイルできる場合、
	      <replaceable>-compiled.specifics</replaceable>
	      にそのコンパイル時のデフォルトを入れてください
	      (ハイフンはあってもなくてもかまいません)。
	      用紙のサイズ、あるいはフォントの解像度などがこれにあたります。</para>

	    <para><replaceable>compiled.specifics</replaceable> 部分は、
	      <makevar>PKGNAMESUFFIX</makevar> 変数に定義されなければなりません。</para>
	  </listitem>

	  <listitem>
	    <para>バージョン番号は数字とアルファベットからなり、
	      ピリオド (.) で区切ります。
	      アルファベットは二文字以上続けてはいけません。
	      唯一の例外は<quote>パッチレベル</quote>を意味する文字列
	      <literal>pl</literal> で、
	      それ以外にバージョン番号がまったくついていない場合にのみ使うことができます。
	      もしソフトウェアのバージョンに
	      <quote>alpha</quote>, <quote>beta</quote>, <quote>rc</quote>
	      や <quote>pre</quote> といった文字列が含まれるなら、
	      ピリオドの後に最初の一文字をとってください。
	      これらの後に、さらにバージョン文字列が続く場合には、
	      一文字のアルファベットの後にピリオドをつけずに番号を続けます。</para>

	    <para>この考え方は、
	      バージョン文字列を見て簡単に ports を並べられるようにするためのものです。
	      特に、バージョン番号の各部分が必ずピリオドで区切られていること、
	      また日付の部分がバージョン文字列の一部となっている場合には

	      <literal><replaceable>yyyy</replaceable>.<replaceable>mm</replaceable>.<replaceable>dd</replaceable></literal>

	      という書式を使っていることを確認してください。

	      <literal><replaceable>dd</replaceable>.<replaceable>mm</replaceable>.<replaceable>yyyy</replaceable></literal>

	      や、2000 年問題に対応していない

	      <literal><replaceable>yy</replaceable>.<replaceable>mm</replaceable>.<replaceable>dd</replaceable></literal>

	      という書式を使ってはいけません。</para>
	  </listitem>
	</orderedlist>

	<para>では、<makevar>DISTNAME</makevar>を正しい
	  <makevar>PKGNAME</makevar>
	  に直す例を見てみましょう:</para>

	<para>以下は、ソフトウェアの作者が決めた名前から
	  適切な package 名に変換する方法を示した (実際の) 例です。</para>

	<informaltable frame="none">
	  <tgroup cols="6">
	    <thead>
	      <row>
		<entry>配布名</entry>
		<entry><makevar>PKGNAMEPREFIX</makevar></entry>
		<entry><makevar>PORTNAME</makevar></entry>
		<entry><makevar>PKGNAMESUFFIX</makevar></entry>
		<entry><makevar>PORTVERSION</makevar></entry>
		<entry>理由</entry>
	      </row>
	    </thead>

	    <tbody>
	      <row>
		<entry>mule-2.2.2</entry>
		<entry>(空)</entry>
		<entry>mule</entry>
		<entry>(空)</entry>
		<entry>2.2.2</entry>
		<entry>変更の必要はありません</entry>
	      </row>

	      <row>
		<entry>XFree86-3.3.6</entry>
		<entry>(空)</entry>
		<entry>XFree86</entry>
		<entry>(空)</entry>
		<entry>3.3.6</entry>
		<entry>変更の必要はありません</entry>
	      </row>

	      <row>
		<entry>EmiClock-1.0.2</entry>
		<entry>(空)</entry>
		<entry>emiclock</entry>
		<entry>(空)</entry>
		<entry>1.0.2</entry>
		<entry>プログラム一つだけの時は小文字のみ</entry>
	      </row>

	      <row>
		<entry>rdist-1.3alpha</entry>
		<entry>(空)</entry>
		<entry>rdist</entry>
		<entry>(空)</entry>
		<entry>1.3.a</entry>
		<entry><literal>alpha</literal> のような文字列は使えない</entry>
	      </row>

	      <row>
		<entry>es-0.9-beta1</entry>
		<entry>(空)</entry>
		<entry>es</entry>
		<entry>(空)</entry>
		<entry>0.9.b1</entry>
		<entry><literal>alpha</literal> のような文字列は使えない</entry>
	      </row>

	      <row>
		<entry>mailman-2.0rc3</entry>
		<entry>(空)</entry>
		<entry>mailman</entry>
		<entry>(空)</entry>
		<entry>2.0.r3</entry>
		<entry><literal>rc</literal> のような文字列は使えない</entry>
	      </row>

	      <row>
		<entry>v3.3beta021.src</entry>
		<entry>(空)</entry>
		<entry>tiff</entry>
		<entry>(空)</entry>
		<entry>3.3</entry>
		<entry>なんなんでしょう ;)</entry>
	      </row>

	      <row>
		<entry>tvtwm</entry>
		<entry>(空)</entry>
		<entry>tvtwm</entry>
		<entry>(空)</entry>
		<entry>pl11</entry>
		<entry>バージョン番号は必ず必要</entry>
	      </row>

	      <row>
		<entry>piewm</entry>
		<entry>(空)</entry>
		<entry>piewm</entry>
		<entry>(空)</entry>
		<entry>1.0</entry>
		<entry>同上</entry>
	      </row>

	      <row>
		<entry>xvgr-2.10pl1</entry>
		<entry>(空)</entry>
		<entry>xvgr</entry>
		<entry>(空)</entry>
		<entry>2.10.1</entry>
		<entry><literal>pl</literal> が使えるのは、
		  他にメジャー/マイナーバージョン番号がない場合のみ</entry>
	      </row>

	      <row>
		<entry>gawk-2.15.6</entry>
		<entry>ja-</entry>
		<entry>gawk</entry>
		<entry>(空)</entry>
		<entry>2.15.6</entry>
		<entry>日本語バージョン</entry>
	      </row>

	      <row>
		<entry>psutils-1.13</entry>
		<entry>(空)</entry>
		<entry>psutils</entry>
		<entry>-letter</entry>
		<entry>1.13</entry>
		<entry>コンパイル時に用紙のサイズを指定</entry>
	      </row>

	      <row>
		<entry>pkfonts</entry>
		<entry>(空)</entry>
		<entry>pkfonts</entry>
		<entry>300</entry>
		<entry>1.0</entry>
		<entry>300dpiフォント用の package</entry>
	      </row>
	    </tbody>
	  </tgroup>
	</informaltable>

	<para>オリジナルのソースにまったくバージョン情報が見当たらず、
	  また原作者が新しいバージョンをリリースする可能性が低いときには、
	  バージョン番号として
	  <literal>1.0</literal> を使えばいいでしょう
	  (上記の piewm の例がこれにあたります)。
	  そうでない場合には原作者に聞くか、日付
	  (<literal><replaceable>yyyy</replaceable>.<replaceable>mm</replaceable>.<replaceable>dd</replaceable></literal>)
	  を使うなどしてください。</para>
      </sect2>
    </sect1>

    <sect1 id="makefile-categories">
      <title>カテゴリ分類</title>

      <sect2>
	<title><makevar>CATEGORIES</makevar></title>

	<para>パッケージが作成されると
	  <filename>/usr/ports/packages/All</filename> に置かれ、一つ以上の
	  <filename>/usr/ports/packages</filename>
	  のサブディレクトリからリンクが張られます。
	  これらのサブディレクトリの名称は、<makevar>CATEGORIES</makevar>
	  変数で指定されます。これは、ユーザが FTP サイトや CDROM
	  のパッケージの山から探し出すのを容易にするためのものです。
	  既存の<link
	    linkend="porting-categories">カテゴリ</link>を参照して、
	  あなたの port にふさわしいものを選んでください。</para>

	<para>また、このリストは、その port が
	  ports ツリーのどこにインポートされるかも決定します。
	  ここに複数のカテゴリを指定すると、port
	  のファイルは最初のカテゴリ名のサブディレクトリに置かれることになります。
	  適切なカテゴリの選択方法については<link
	    linkend="porting-categories">カテゴリ</link>節をご覧ください。</para>

	<para>あなたが作成した port
	  が、本当に既存のどのカテゴリにも当てはまらない場合には、
	  新たにカテゴリ名を作成することもできます。
	  その場合、新しいカテゴリを提案するメールを &a.ports;
	  宛に送ってください。</para>
      </sect2>

      <sect2 id="porting-categories">
	<title>現在のカテゴリのリスト</title>

	<para>まず、これが現在の port のカテゴリのリストです。
	  アスタリスク(<literal>*</literal>)
	  が付いているものは仮想 (<emphasis>virtual</emphasis>)
	  カテゴリです &mdash;
	  これらには対応するサブディレクトリが port ツリーにはありません。</para>
	<!-- kuriyama - don't use " - - " as literal -->

	<note>
	  <para>仮想カテゴリでないものは、
	  そのサブディレクトリ内の
	  <filename>pkg/COMMENT</filename>
	  に一行の記述があります
	  (例: <filename>archivers/pkg/COMMENT</filename>)。</para>
	</note>

	<informaltable frame="none">
	  <tgroup cols="2">
	    <thead>
	      <row>
		<entry>カテゴリ</entry>
		<entry>説明</entry>
	      </row>
	    </thead>

	    <tbody>
	      <row>
		<entry><filename>accessibility*</filename></entry>
		<entry>障害を持ったユーザの役に立つ ports</entry>
	      </row>

	      <row>
		<entry><filename>afterstep*</filename></entry>
		<entry>AfterStep ウィンドウマネージャをサポートする ports</entry>
	      </row>

	      <row>
		<entry><filename>archivers</filename></entry>
		<entry>アーカイブ用ツール</entry>
	      </row>

	      <row>
		<entry><filename>astro</filename></entry>
		<entry>天文学関連の ports</entry>
	      </row>

	      <row>
		<entry><filename>audio</filename></entry>
		<entry>サウンドをサポートする ports</entry>
	      </row>

	      <row>
		<entry><filename>benchmarks</filename></entry>
		<entry>ベンチマークユーティリティ</entry>
	      </row>

	      <row>
		<entry><filename>biology</filename></entry>
		<entry>生物学関連のソフトウェア</entry>
	      </row>

	      <row>
		<entry><filename>cad</filename></entry>
		<entry>CAD ツール</entry>
	      </row>

	      <row>
		<entry><filename>chinese</filename></entry>
		<entry>中国語サポート</entry>
	      </row>

	      <row>
		<entry><filename>comms</filename></entry>
		<entry>通信ソフトウェア。ほとんどはシリアルポート用です。</entry>
	      </row>

	      <row>
		<entry><filename>converters</filename></entry>
		<entry>文字コード変換</entry>
	      </row>

	      <row>
		<entry><filename>databases</filename></entry>
		<entry>データベース</entry>
	      </row>

	      <row>
		<entry><filename>deskutils</filename></entry>
		<entry>コンピュータが発明される以前に机上で使われていた道具
		  (訳注: いわゆるデスクトップユーティリティのこと)</entry>
	      </row>

	      <row>
		<entry><filename>devel</filename></entry>
		<entry>開発ユーティリティ。
		  どうしてもここに置かなければならない理由があるのでない限り、
		  ライブラリをここに含めないでください。</entry>
	      </row>

	      <row>
		<entry><filename>editors</filename></entry>
		<entry>一般的なエディタ。
		  特殊なエディタはそれぞれふさわしいセクションに入れます
		  (たとえば数式エディタは <filename>math</filename> です)。</entry>
	      </row>

	      <row>
		<entry><filename>elisp</filename></entry>
		<entry>Emacs-lisp の ports</entry>
	      </row>

	      <row>
		<entry><filename>emulators</filename></entry>
		<entry>他のオペレーティングシステムのエミュレータ。
		  端末エミュレータはここに含まれません &mdash;
		  X ベースのものは <filename>x11</filename> に、
		  テキストベースのものは機能によって
		  <filename>comms</filename> か
		  <filename>misc</filename> に分類されます。</entry>
	      </row>

 	      <row>
		<entry><filename>finance</filename></entry>
		<entry>金融や財務会計関連のアプリケーション。</entry>
	      </row>

	      <row>
		<entry><filename>french</filename></entry>
		<entry>フランス語サポート</entry>
	      </row>

	      <row>
		<entry><filename>ftp</filename></entry>
		<entry>FTP クライアントとサーバユーティリティ。
		  port が FTP と HTTP の両方をサポートしていれば、
		  <filename>ftp</filename>
		  に入れ、第二カテゴリを
		  <filename>www</filename> とします。</entry>
	      </row>

	      <row>
		<entry><filename>games</filename></entry>
		<entry>ゲーム</entry>
	      </row>

	      <row>
		<entry><filename>german</filename></entry>
		<entry>ドイツ語サポート</entry>
	      </row>

	      <row>
		<entry><filename>gnome*</filename></entry>
		<entry>GNU Object Model Environment (GNOME)
		  プロジェクトの ports</entry>
	      </row>

	      <row>
		<entry><filename>graphics</filename></entry>
		<entry>グラフィックユーティリティ</entry>
	      </row>

	      <row>
		<entry><filename>haskell*</filename></entry>
		<entry>Haskell 言語関連のソフトウェア。</entry>
              </row>

	      <row>
		<entry><filename>hebrew</filename></entry>
		<entry>ヘブライ語サポート</entry>
	      </row>

	      <row>
                <entry><filename>hungarian</filename></entry>
		<entry>ハンガリー語サポート</entry>
	      </row>

	      <row>
		<entry><filename>ipv6*</filename></entry>
		<entry>IPv6 関連のソフトウェア</entry>
	      </row>

	      <row>
		<entry><filename>irc</filename></entry>
		<entry>インターネットリレーチャット (IRC)
		  用ユーティリティ</entry>
	      </row>

	      <row>
		<entry><filename>japanese</filename></entry>
		<entry>日本語サポート</entry>
	      </row>

	      <row>
		<entry><filename>java</filename></entry>
		<entry>Java 言語関連のソフトウェア</entry>
	      </row>

	      <row>
		<entry><filename>kde*</filename></entry>
		<entry>K Desktop Environment (kde) の ports</entry>
	      </row>

	      <row>
		<entry><filename>korean</filename></entry>
		<entry>韓国語サポート</entry>
	      </row>

	      <row>
		<entry><filename>lang</filename></entry>
		<entry>プログラミング言語</entry>
	      </row>

	      <row>
		<entry><filename>linux*</filename></entry>
		<entry>Linux アプリケーションとサポートユーティリティ</entry>
	      </row>

	      <row>
		<entry><filename>mail</filename></entry>
		<entry>メールソフトウェア</entry>
	      </row>

	      <row>
		<entry><filename>math</filename></entry>
		<entry>数値計算ソフトウェアやその他の数学ソフトウェア</entry>
	      </row>

	      <row>
		<entry><filename>mbone</filename></entry>
		<entry>MBone アプリケーション</entry>
	      </row>

	      <row>
		<entry><filename>misc</filename></entry>
		<entry>種々のユーティリティ
		  &mdash;
		  基本的に他のカテゴリに属さないものです。
		  これは他の仮想でないカテゴリを伴わない、唯一のカテゴリです。
		  <literal>misc</literal> と他のカテゴリが
		  <makevar>CATEGORIES</makevar> 行に書かれている場合、
		  <literal>misc</literal>
		  を削除して他のサブディレクトリにおいて良いという意味になります。</entry>
	      </row>

	      <row>
		<entry><filename>multimedia</filename></entry>
		<entry>マルチメディアソフトウェア</entry>
	      </row>

	      <row>
		<entry><filename>net</filename></entry>
		<entry>種々のネットワークソフトウェア</entry>
	      </row>

	      <row>
		<entry><filename>news</filename></entry>
		<entry>USENET ニュースソフトウェア</entry>
	      </row>

	      <row>
		<entry><filename>offix*</filename></entry>
		<entry>OffiX suite の ports</entry>
	      </row>

	      <row>
		<entry><filename>palm</filename></entry>
		<entry>Palm(tm) シリーズをサポートするソフトウェア</entry>
	      </row>

	      <row>
		<entry><filename>parallel*</filename></entry>
		<entry>並列計算を行うアプリケーション</entry>
	      </row>

	      <row>
		<entry><filename>perl5*</filename></entry>
		<entry>実行に perl バージョン 5 を必要とする ports</entry>
	      </row>

	      <row>
		<entry><filename>picobsd</filename></entry>
		<entry>PicoBSD をサポートするための ports</entry>
	      </row>

	      <row>
		<entry><filename>plan9*</filename></entry>
		<entry>Plan9 に由来するさまざまなソフトウェア</entry>
	      </row>

	      <row>
		<entry><filename>portuguese</filename></entry>
		<entry>ポルトガル語サポート</entry>
	      </row>

	      <row>
		<entry><filename>print</filename></entry>
		<entry>印刷ソフトウェア。
		  DTP 用ツール (プレビュアなど) もここに分類されます。</entry>
	      </row>

	      <row>
		<entry><filename>python*</filename></entry>
		<entry>Python 言語関連のソフトウェア</entry>
	      </row>

	      <row>
		<entry><filename>ruby*</filename></entry>
		<entry>Ruby 言語関連のソフトウェア</entry>
	      </row>

	      <row>
		<entry><filename>russian</filename></entry>
		<entry>ロシア語サポート</entry>
	      </row>

	      <row>
		<entry><filename>science</filename></entry>
		<entry><filename>astro</filename> や
		  <filename>biology</filename>,
		  <filename>math</filename> 等、他のカテゴリには
		  あてはまらない科学関連の ports</entry>
	      </row>

	      <row>
		<entry><filename>security</filename></entry>
		<entry>セキュリティ関連のユーティリティ</entry>
	      </row>

	      <row>
		<entry><filename>shells</filename></entry>
		<entry>コマンドラインシェル</entry>
	      </row>

	      <row>
		<entry><filename>sysutils</filename></entry>
		<entry>システムユーティリティ</entry>
	      </row>

	      <row>
		<entry><filename>tcl76*</filename></entry>
		<entry>実行に Tcl バージョン 7.6 を必要とする ports</entry>
	      </row>

	      <row>
		<entry><filename>tcl80*</filename></entry>
		<entry>実行に Tcl バージョン 8.0 を必要とする ports</entry>
	      </row>

	      <row>
		<entry><filename>tcl81*</filename></entry>
		<entry>実行に Tcl バージョン 8.1 を必要とする ports</entry>
	      </row>

	      <row>
		<entry><filename>tcl82*</filename></entry>
		<entry>実行に Tcl バージョン 8.2 を必要とする ports</entry>
	      </row>

	      <row>
		<entry><filename>tcl83*</filename></entry>
		<entry>実行に Tcl バージョン 8.3 を必要とする ports</entry>
	      </row>

	      <row>
		<entry><filename>textproc</filename></entry>
		<entry>テキスト処理ユーティリティ。
		  DTP ツールはここではなく、<filename>print</filename>
		  に分類されます。</entry>
	      </row>

	      <row>
		<entry><filename>tk42*</filename></entry>
		<entry>実行に Tk バージョン 4.2 を必要とする ports</entry>
	      </row>

	      <row>
		<entry><filename>tk80*</filename></entry>
		<entry>実行に Tk バージョン 8.0 を必要とする ports</entry>
	      </row>

	      <row>
		<entry><filename>tk81*</filename></entry>
		<entry>実行に Tk バージョン 8.1 を必要とする ports</entry>
	      </row>

	      <row>
		<entry><filename>tk82*</filename></entry>
		<entry>実行に Tk バージョン 8.2 を必要とする ports</entry>
	      </row>

	      <row>
		<entry><filename>tk83*</filename></entry>
		<entry>実行に Tk バージョン 8.3 を必要とする ports</entry>
	      </row>

	      <row>
		<entry><filename>tkstep80*</filename></entry>
		<entry>実行に TkSTEP バージョン 8.0 を必要とする ports</entry>
	      </row>

	      <row>
		<entry><filename>ukrainian</filename></entry>
		<entry>ウクライナ語サポート</entry>
	      </row>

	      <row>
		<entry><filename>vietnamese</filename></entry>
		<entry>ベトナム語サポート</entry>
	      </row>

	      <row>
		<entry><filename>windowmaker*</filename></entry>
		<entry>WindowMaker ウィンドウマネージャをサポートする ports</entry>
	      </row>

	      <row>
		<entry><filename>www</filename></entry>
		<entry>World Wide Web 関連のソフトウェア。
		  HTML 言語サポートもここに分類されます。</entry>
	      </row>

	      <row>
                <entry><filename>x11</filename></entry>
		<entry>X ウィンドウシステムとその関連ソフトウェア。
		  このカテゴリは、
		  直接ウィンドウシステムをサポートするソフトウェアのみを対象とするものです。
		  通常の X アプリケーションをここに分類しないでください。
		  あなたの port が X アプリケーションで、
		  <makevar>USE_XLIB</makevar> が定義
		  (<makevar>USE_IMAKE</makevar> を定義すると自動的に定義されます)
		  されている場合は、適切なカテゴリに分類してください。
		  また、それらのほとんどは他の <filename>x11-*</filename>
		  カテゴリ (下記参照) に分類されます。</entry>
	      </row>

	      <row>
		<entry><filename>x11-clocks</filename></entry>
		<entry>X11 用時計</entry>
	      </row>

	      <row>
		<entry><filename>x11-fm</filename></entry>
		<entry>X11 用ファイルマネージャ</entry>
	      </row>

	      <row>
		<entry><filename>x11-fonts</filename></entry>
		<entry>X11 フォントとフォントユーティリティ</entry>
	      </row>

	      <row>
		<entry><filename>x11-servers</filename></entry>
		<entry>X11 サーバ</entry>
	      </row>

	      <row>
		<entry><filename>x11-toolkits</filename></entry>
		<entry>X11 ツールキット</entry>
	      </row>

	      <row>
		<entry><filename>x11-wm</filename></entry>
		<entry>X11 ウィンドウマネージャ</entry>
	      </row>

	      <row>
		<entry><filename>zope*</filename></entry>
		<entry>Zope サポート</entry>
	      </row>
	    </tbody>
	  </tgroup>
	</informaltable>
      </sect2>

      <sect2>
	<title>適切なカテゴリの選択</title>

	<para>多くのカテゴリに重なるので、
	  どれを<quote>第一</quote>カテゴリにするかを決めなければならないことがたびたびあるでしょう。
	  これをうまく決めるルールがいくつかあります。
	  以下はその優先順のリストで、優先度の高いものから低いものの順に書いてあります。</para>

	<itemizedlist>
	  <listitem>
	    <para>言語特有のカテゴリがまず最初です。
	      たとえば日本語の
	      X11 のフォントをインストールする port の場合、
	      <makevar>CATEGORIES</makevar> 行は
	      <filename>japanese x11-fonts</filename>
	      となるでしょう。</para>
	  </listitem>

	  <listitem>
	    <para>より特徴的なカテゴリが、
	      一般的なカテゴリより優先されます。
	      たとえば、HTML エディタの場合は <filename>www editors</filename> となります。
	      これを逆順にはしないでください。
	      また、
	      port が <filename>irc</filename>,
	      <filename>mail</filename>,
	      <filename>mbone</filename>,
	      <filename>news</filename>,
	      <filename>security</filename>,
	      <filename>www</filename>
	      のいずれかに属する場合には
	      <filename>net</filename>
	      は必要ありません。</para>
	  </listitem>

	  <listitem>
	    <para><filename>x11</filename>
	      を第二カテゴリにするのは第一カテゴリが自然言語の場合のみにしてください。
	      特に X のアプリケーションには
	      <filename>x11</filename> を指定しないでください。</para>
	  </listitem>

	  <listitem>
	    <para><application>Emacs</application> のモードは、
	      そのモードで対応しているアプリケーションと同じ
	      ports カテゴリに置くようにして、
	      <filename>editors</filename> には置かないでください。
	      例えば、あるプログラミング言語のソースファイルを編集するための
	      <application>Emacs</application> モードは、
	      <filename>lang</filename> に置くべきです。</para>
	  </listitem>

	  <listitem>
	    <para>もし、あなたの port が他のどのカテゴリにも属しない場合には
	      <filename>misc</filename> にしてください。</para>
	  </listitem>
	</itemizedlist>

	<para>もし、あなたがカテゴリについて自信が持てない場合には、
	  そのことを &man.send-pr.1; する時に書き加えてください。
	  そうすればインポートする前にそれについて議論できます
	  (もしあなたがコミッターであれば、
	  そのことを &a.ports; に送って先に議論するようにしてください
	  &mdash; 新しい port が間違ったカテゴリにインポートされて、
	  すぐ移動されることが多いので)。</para>
      </sect2>
    </sect1>

    <sect1 id="makefile-distfiles">
      <title>配布ファイル</title>

      <para><filename>Makefile</filename> の第二の部分では、
	その port をビルドするためにダウンロードしなければならないファイルと、
	それをどこからダウンロードできるか説明しています。</para>

      <sect2>
	<title><makevar>DISTNAME</makevar></title>

	<para><makevar>DISTNAME</makevar>
	  は製作者が決めたソフトウェアの名前です。
	  デフォルトでは <makevar>DISTNAME</makevar> は
	  <literal>${PORTNAME}-${PORTVERSION}</literal> になりますが、
	  必要に応じて書き換えることができます。
	  <makevar>DISTNAME</makevar> は二つの場所でしか使われません。
	  一つ目は配布ファイルリスト (<makevar>DISTFILES</makevar>) のデフォルト
	  <makevar>${DISTNAME}</makevar><makevar>${EXTRACT_SUFX}</makevar>
	  で、二つ目は配布ファイルが展開されるサブディレクトリ
	  <makevar>WRKSRC</makevar> のデフォルト
	  <filename>work/<makevar>${DISTNAME}</makevar></filename>
	  です。</para>

	<note>
	  <para><makevar>PKGNAMEPREFIX</makevar> や
	    <makevar>PKGNAMESUFFIX</makevar> は
	    <makevar>DISTNAME</makevar> に影響を与えません。
	    また、元のソースアーカイブが
	    <makevar>${PORTNAME}-${PORTVERSION}${EXTRACT_SUFX}</makevar> という
	    名前ではないのに、<makevar>WRKSRC</makevar> を
	    <filename>work/<makevar>${PORTNAME}-${PORTVERSION}</makevar></filename>
	    と設定している場合、おそらく <makevar>DISTNAME</makevar>
	    はそのままにしておく必要があることに注意してください &mdash;
	    <makevar>DISTNAME</makevar> と <makevar>WRKSRC</makevar>
	    の両方を (そして おそらく <makevar>EXTRACT_SUFX</makevar> も)
	    セットするよりは、<makevar>DISTFILES</makevar>
	    を定義する方が楽でしょう。</para>
	</note>
      </sect2>

      <sect2>
	<title><makevar>MASTER_SITES</makevar></title>

	<para>元になる配布ファイルを指し示す、FTP/HTTP の URL のファイル名を除いた部分を
	  <makevar>MASTER_SITES</makevar> に設定します。
	  最後にスラッシュ (<filename>/</filename>)
	  をつけることをお忘れなく!</para>

	<para>このシステム上に配布ファイルが見つからなかった場合、
	  <command>make</command> マクロは <makevar>FETCH</makevar>
	  を使ってこの変数に指定されたサイトから配布ファイルを取得しようとします。</para>

	<para>このリストには、
	  できれば異なる大陸に存在する複数のサイトを入れておくことが推奨されています。
	  これにより、広域ネットワークのトラブルに対する耐性を高めることができます。
	  さらに私たちは、自動的に最も近いマスタサイトを判断して、
	  そこから取ってくるメカニズムの導入を計画しています。</para>

	<para>元になる tar ファイルが X-contrib や GNU, Perl CPAN
	  等の有名なアーカイブサイトに置かれている場合には、
	  <makevar>MASTER_SITE_<replaceable>*</replaceable></makevar>
	  を使ってこれらのサイトを簡潔に
	  (例えば <makevar>MASTER_SITE_XCONTRIB</makevar> とか、
	  <makevar>MASTER_SITE_PERL_CPAN</makevar> のように) 指定することができます。
	  <makevar>MASTER_SITES</makevar> を これらの変数の一つにセットし、
	  サイト内でのパスを <makevar>MASTER_SITE_SUBDIR</makevar>
	  に指定するだけです。
	  以下に例を示します。</para>

	<programlisting>MASTER_SITES=         ${MASTER_SITE_XCONTRIB}
MASTER_SITE_SUBDIR=   applications</programlisting>

	<para>これらの変数は <filename>/usr/ports/Mk/bsd.sites.mk</filename>
	  で定義されています。
	  いつでも新しいアーカイブサイトが追加されますので、
	  port を提出する前に このファイルの最新版を
	  チェックするように心掛けてください。</para>

	<para>ユーザは <filename>/etc/make.conf</filename> 中で
	  <makevar>MASTER_SITE_*</makevar> 変数を上書きすることもできます。
	  そうすることで、これらの有名なアーカイブそのものではなく、
	  好みのミラーサイトを使用することができます。</para>
      </sect2>

      <sect2>
	<title><makevar>EXTRACT_SUFX</makevar></title>

	<para>配布ファイルが 1 つで、
	  圧縮方式を示すのに普通と異なる接尾辞を使っていたら、
	  <makevar>EXTRACT_SUFX</makevar> を設定してください。</para>
	
	<para>例えば、配布ファイルがより一般的な
	  <filename>foo.tar.gz</filename> ではなく、
	  <filename>foo.tgz</filename> となっていたら、
	  次のように書きます。</para>

	<programlisting>DISTNAME=      foo
EXTRACT_SUFX=  .tgz</programlisting>

	<para><makevar>USE_BZIP2</makevar> と <makevar>USE_ZIP</makevar>
	  変数を設定すると、<makevar>EXTRACT_SUFX</makevar>
	  は必要に応じて自動的に <literal>.bz2</literal>
	  または <literal>.zip</literal> に設定されます。
	  どちらも設定されていなければ、<makevar>EXTRACT_SUFX</makevar>
	  は <literal>.tar.gz</literal> に設定されます。</para>

	<para><makevar>EXTRACT_SUFX</makevar> と
	  <makevar>DISTFILES</makevar> を両方設定する必要はありません。</para>
      </sect2>

      <sect2>
	<title><makevar>DISTFILES</makevar></title>

	<para>時々、ダウンロードするファイルの名称が port
	  の名称とまったく似ていないことがあります。たとえば、
	  <filename>source.tar.gz</filename>
	  などと名づけられていることもあるでしょう。
	  ほかに、ソースコードがいくつかのアーカイブに分かれていて、
	  そのすべてをダウンロードしなければならないならないこともあります。</para>

	<para>この場合、<makevar>DISTFILES</makevar>
	  に、ダウンロードしなければならないファイルすべてのリストを、
	  スペースで区切って設定してください。</para>

	<programlisting>DISTFILES=     source1.tar.gz source2.tar.gz</programlisting>

	<para>明示的に設定されていない場合、
	  <makevar>DISTFILES</makevar> は
	  <literal>${DISTNAME}${EXTRACT_SUFX}</literal>
	  に設定されます。</para>
      </sect2>

      <sect2>
	<title><makevar>EXTRACT_ONLY</makevar></title>

	<para><makevar>DISTFILES</makevar> の一部だけを展開すべき
	  (例えば、一方がソースコードで、もう一方は圧縮されていない文書という)
	  場合、展開しなければならないファイル名を
	  <makevar>EXTRACT_ONLY</makevar> に設定してください。</para>

	<programlisting>DISTFILES=     source.tar.gz manual.html
EXTRACT_ONLY=  source.tar.gz</programlisting>

	<para><emphasis>どの</emphasis> <makevar>DISTFILES</makevar>
	  も展開すべきでは<emphasis>ない</emphasis>なら、
	  <makevar>EXTRACT_ONLY</makevar>
	  に空文字列を設定してください。</para>

	<programlisting>EXTRACT_ONLY=</programlisting>
      </sect2>

      <sect2 id="porting-patchfiles">
	<title><makevar>PATCHFILES</makevar></title>

	<para>その port が配布ファイルの他に FTP や HTTP
	  で手に入る追加パッチを必要とする場合には、
	  <makevar>PATCHFILES</makevar> にはそのパッチのファイル名を、
	  <makevar>PATCH_SITES</makevar>
	  にはそのファイルが置かれているディレクトリの URL
	  をセットしてください。(書き方は
	  <makevar>MASTER_SITES</makevar> と同じです。)</para>

	<para>そのパッチに記録されているファイル名に余計なパス名がついていて、
	  ソースツリーのトップディレクトリ
	  (つまり <makevar>WKRSRC</makevar>)
	  からの相対パスになっていない場合には、
	  それに応じた <makevar>PATCH_DIST_STRIP</makevar> を指定してください。
	  たとえば、パッチ内のすべてのファイル名の先頭に、余計な
	  <literal>foozolix-1.0/</literal> がついている場合には、
	  <literal>PATCH_DIST_STRIP=-p1</literal>
	  としてください。</para>

	<para>これらのパッチは圧縮されていても大丈夫です。
	  ファイル名が <filename>.gz</filename> や <filename>.Z</filename>
	  で終わる場合には、自動的に展開されるようになっています。</para>

	<para>もしパッチが、ドキュメント等その他のファイルと一緒に
	  gzip された tar ファイルで配布されている場合には、単に
	  <makevar>PATCHFILES</makevar> を使うだけではうまくいきません。
	  このような場合には、このパッチの tar ファイルの名前と場所を
	  <makevar>DISTFILES</makevar> と
	  <makevar>MASTER_SITES</makevar> に追加しておきます。
	  それから、<makevar>EXTRA_PATCHES</makevar>
	  変数にそれらのパッチを指定すれば、
	  <filename>bsd.port.mk</filename> が
	  自動的にパッチを適用してくれます。
	  特に注意が必要なのは、パッチファイルを
	  <makevar>PATCHDIR</makevar>
	  ディレクトリにコピー<emphasis>してはならない</emphasis>ことです
	  &mdash; (訳注: port が CD-ROM 上に置かれている等の場合には、) 
	  そのディレクトリには書き込みができないかもしれません。</para>

	<note>
	  <para>それが普通の gzip か compress された tar ファイルであれば、
	    通常のソースファイルと一緒にパッチ適用時までに展開されていますので、
	    明示的に展開する必要はありません。
	    もしパッチを <makevar>DISTFILES</makevar>
	    に追加した場合には、パッチを含むファイルが展開される際に、
	    そのディレクトリにある何かを上書きしないように注意してください。
	    さらに、コピーされたパッチファイルを削除するコマンドを
	    <maketarget>pre-clean</maketarget>
	    ターゲットに追加することを忘れないでください。</para>
	</note>
      </sect2>

      <sect2 id="porting-master-sites-n">
	<title>異なるサイトやサブディレクトリからの複数の配布ファイルまたはパッチ
	  (<literal>MASTER_SITES:n</literal>)</title>

	<para>この節は <literal>MASTER_SITES:n</literal> や
	  <literal>MASTER_SITES_NN</literal>
	  と呼ばれる取得方法について説明しています。
	  ここでは、この方式を <literal>MASTER_SITES:n</literal>
	  と呼びます。</para>

	<para>まず、背景を少し説明しておきましょう。OpenBSD
	  には、<makevar>DISTFILES</makevar> と
	  <makevar>PATCHFILES</makevar>
	  変数の両方に素敵な機能があります。ファイル、パッチの両方とも、
	  後ろに <literal>:n</literal> (<literal>n</literal>
	  は <literal>[0-9]</literal> のどれかになります)
	  をつけてグループを指示できます。たとえば、</para>

	<programlisting>DISTFILES=      alpha:0 beta:1</programlisting>

	<para>OpenBSD では、配布ファイル <filename>alpha</filename>
	  は、通常の <makevar>MASTER_SITES</makevar> ではなく
	  <makevar>MASTER_SITES0</makevar> に、
	  <filename>beta</filename> は <makevar>MASTER_SITES1</makevar>
	  に結び付けられます。</para>

	<para>これは、正しいダウンロードサイトを際限なく探す羽目になるのを減らせる、
	  興味深い機能です。</para>

	<para><makevar>DISTFILES</makevar> にファイルが
	  2 つ指定され、<makevar>MASTER_SITES</makevar> が
	  20 サイトあって、サイトはものすごく遅く、
	  <filename>beta</filename> は <makevar>MASTER_SITES</makevar>
	  中のすべてのサイトに置かれていますが、
	  <filename>alpha</filename> は
	  20 番目のサイトにしかないという場合を考えてください。
	  メンテナがあらかじめそのことを知っていたら、
	  すべてのサイトを確認するのは無駄だと思いませんか?
	  楽しい週末のはじまりというわけにはゆきませんね。</para>

	<para>イメージできたら、今度は <makevar>DISTFILES</makevar>
	  や <makevar>MASTER_SITES</makevar>
	  がもっと沢山あるのを想像してください。
	  <quote>distfiles 調査マイスタ</quote>は、
	  ネットワーク負荷が緩和されることを喜ぶに違いありません。</para>

	<para>次節からは、FreeBSD におけるこのアイディアの実装について説明します。
	  OpenBSD の考え方を多少改良しています。</para>

	<sect3>
	  <title>簡単な説明</title>

	  <para>この節では、複数の配布ファイルやパッチを、
	    異なるサイトやサブディレクトリから細かく分けて取得する簡単な設定を示します。
	    ここでは、単純化した <literal>MASTER_SITES:n</literal>
	    の使い方を説明します。ほとんどの場面ではこれで十分です。
	    さらに詳しいことを知りたければ、次の節をお読みください。</para>

	  <para>アプリケーションによっては、
	    いくつもの異なるサイトからダウンロードする複数の配布ファイルからなっているものがあります。
	    たとえば、<application>Ghostscript</application>
	    は、中核部のプログラムと、
	    ユーザのプリンタに応じて使い分けられる多数のドライバファイルからなっています。
	    このドライバファイルの一部は中核部と共に配布されますが、
	    多くはさまざまなサイトからダウンロードしなければなりません。</para>

	  <para>これに対応するため、<makevar>DISTFILES</makevar>
	    の各項目の後ろには、コロンと<quote>タグ名</quote>
	    をつけられるようになっています。<makevar>MASTER_SITES</makevar>
	    に設定されているそれぞれのサイトの末尾にも、コロンと、
	    そのサイトからダウンロードすべきファイルを示すためのタグを加えます。</para>

	  <para>たとえば、ソースコードが
	    <filename>source1.tar.gz</filename> と
	    <filename>source2.tar.gz</filename> の
	    2 つに分けられていて、
	    2 つの別のサイトからダウンロードしなければならないアプリケーションを考えてみましょう。
	    その port の <filename>Makefile</filename>
	    には、<xref
	      linkend="ports-master-sites-n-example-simple-use-one-file-per-site">
	    のような行があるとします。</para>

	  <example
	    id="ports-master-sites-n-example-simple-use-one-file-per-site">
	    <title>各サイトに 1 つファイルがある場合の、簡単な
	      <literal>MASTER_SITES:n</literal> の使用法</title>

	    <programlisting>MASTER_SITES=   ftp://ftp.example1.com/:source1 \
                ftp://ftp.example2.com/:source2
DISTFILES=      source1.tar.gz:source1 \
                source2.tar.gz:source2</programlisting>
	  </example>

	<para>複数の配布ファイルに同じタグがついていてもかまいません。
	  先ほどの例に続いて、3 番目の配布ファイル
	  <filename>source3.tar.gz</filename> があって、
	  <hostid>ftp.example2.com</hostid> からダウンロードすべきだとしましょう。
	  <filename>Makefile</filename> は <xref
	      linkend="ports-master-sites-n-example-simple-use-more-than-one-file-per-site">
	    のようになります。</para>

	  <example
	    id="ports-master-sites-n-example-simple-use-more-than-one-file-per-site">
	    <title>各サイトに 1 つ以上ファイルがある場合の、簡単な
	      <literal>MASTER_SITES:n</literal> の使用法</title>

	    <programlisting>MASTER_SITES=   ftp://ftp.example1.com/:source1 \
                ftp://ftp.example2.com/:source2
DISTFILES=      source1.tar.gz:source1 \
                source2.tar.gz:source2 \
                source3.tar.gz:source2</programlisting>
	  </example>
	</sect3>

	<sect3>
	  <title>詳しい説明</title>

	  <para>分かりました。
	    前節の例ではあなたの要求を満足できなかったわけですね。
	    この節では、ファイルの取得を細かく制御する仕組み
	    <literal>MASTER_SITES:n</literal>
	    がどう働くかと、これを利用するために
	    ports をどう変更すればよいかを詳しく説明します。</para>

	  <orderedlist>
	    <listitem>
	      <para>要素の末尾に
		<literal>:<replaceable>n</replaceable></literal>
		をつけることができます。
		ここで、<replaceable>n</replaceable> は
		<literal>[^:,]+</literal>
		つまり、概念上はいかなる文字と数字からなる文字列でもよいのですが、
		われわれとしては、当面は
		<literal>[a-zA-Z_][0-9a-zA-Z_]+</literal>
		に制限します。</para>

	      <para>さらに、文字列のマッチは大文字と小文字を区別します。
		つまり、<literal>n</literal> と <literal>N</literal>
		は別の文字として扱われます。</para>

	      <para>しかし、
		<literal>default</literal>, <literal>all</literal>,
		<literal>ALL</literal>
		は特別な意味を与えられているので、
		末尾に付加するのには使えません
		(これは、<xref
		  linkend="porting-master-sites-n-what-changes-in-port-targets">
		項で内部的に利用されています)。
		さらに、<literal>DEFAULT</literal>
		は特別な意味を持つ単語です
		(<xref
		  linkend="porting-master-sites-n-DEFAULT-group">
		の項を確認してください)。</para>
	    </listitem>

	    <listitem>
	      <para><literal>:n</literal> がついた要素は、グループ
		<literal>n</literal> に属し、
		<literal>:m</literal> がついた要素は、グループ
		<literal>m</literal>
		に属するということになります。</para>
	    </listitem>

	    <listitem id="porting-master-sites-n-DEFAULT-group">
	      <para>接尾辞がついていない要素はグループに属しません。
		これは、特別なグループ <literal>DEFAULT</literal>
		に属しているとして扱われます。
		要素の後ろに <literal>DEFAULT</literal>
		をつけるのは、その要素を <literal>DEFAULT</literal>
		とそれ以外のグループに同時に割り当てたいのでなければ、
		冗長に過ぎません
		(<xref linkend="porting-master-sites-n-comma-operator">
		の項を確認してください)。</para>

	      <para>次の例はどちらも同じ意味ですが、
		最初の方が好ましいです。</para>

	      <programlisting>MASTER_SITES=   alpha

MASTER_SITES=   alpha:DEFAULT</programlisting>
	    </listitem>

	    <listitem>
	      <para>グループは相互排他ではありません。
		ひとつの要素が同時に複数のグループに属することができ、
		ひとつのグループには複数の要素が属することも、
		何も割り当てないこともできます。
		同じグループで何回も指定された要素は、
		単に複数回指定された要素ということになります。</para>
	    </listitem>

	    <listitem id="porting-master-sites-n-comma-operator">
	      <para>ある要素を同時にいくつものグループに所属させたい時は、
		カンマ演算子 (<literal>,</literal>) が使えます。</para>

	      <para>その都度別の接尾辞をつけて繰り返すかわりに、
		一度だけ接尾辞を指定して複数のグループを指定できます。
		たとえば、<literal>:m,n,o</literal>
		と書くと、その要素はグループ <literal>m</literal>,
		<literal>n</literal> および <literal>o</literal>
		に属することを示します。</para>

	      <para>以下の例はすべて同等ですが、
		最後の形式がもっともよいでしょう。</para>

	      <programlisting>MASTER_SITES=   alpha alpha:SOME_SITE

MASTER_SITES=   alpha:DEFAULT alpha:SOME_SITE

MASTER_SITES=   alpha:SOME_SITE,DEFAULT

MASTER_SITES=   alpha:DEFAULT,SOME_SITE</programlisting>
	    </listitem>

	    <listitem>
	      <para>任意のグループ内のサイトは、
		<makevar>MASTER_SORT_AWK</makevar>
		によって整列されます。
		<makevar>MASTER_SITES</makevar> と
		<makevar>PATCH_SITES</makevar>
		内のすべてのグループについても同様に整列されます。</para>
	    </listitem>

	    <listitem id="porting-master-sites-n-group-semantics">
	      <para>グループの概念は、変数 
		<makevar>MASTER_SITES</makevar>,
		<makevar>PATCH_SITES</makevar>,
		<makevar>MASTER_SITE_SUBDIR</makevar>,
		<makevar>PATCH_SITE_SUBDIR</makevar>,
		<makevar>DISTFILES</makevar> および
		<makevar>PATCHFILES</makevar>
		においても、下記の文法に従って使えます。</para>

	      <orderedlist>
		<listitem>
		  <para><makevar>MASTER_SITES</makevar>,
		    <makevar>PATCH_SITES</makevar>,
		    <makevar>MASTER_SITE_SUBDIR</makevar> および
		    <makevar>PATCH_SITE_SUBDIR</makevar>
		    のすべての要素はスラッシュ <literal>/</literal>
		    記号で終端されていなければなりません。
		    ある要素がどれかのグループに属しているなら、
		    グループの接尾辞
		    <literal>:<replaceable>n</replaceable></literal>
		    は、終端記号 <literal>/</literal>
		    のすぐ後にこなければなりません。
		    <literal>MASTER_SITES:n</literal>
		    の仕組みでは、終端記号
		    <literal>/</literal> があることで、
		    <literal>:n</literal> が要素の有効な一部である場合と、
		    <literal>:n</literal> がグループ <literal>n</literal>
		    を示す場合の混同を避けることができます。
		    以前は、
		    <makevar>MASTER_SITE_SUBDIR</makevar> と
		    <makevar>PATCH_SITE_SUBDIR</makevar>
		    要素のいずれにおいても終端記号 <literal>/</literal>
		    は不要だったので、互換性を保つために、
		    接尾辞の直前の文字が <literal>/</literal>
		    でなければ、
		    要素の接尾辞が <literal>:n</literal> であっても、
		    グループの接尾語ではなく、
		    要素の有効な一部分として扱われます。
		    <xref
		      linkend="ports-master-sites-n-example-detailed-use-master-site-subdir">
		    と <xref
		      linkend="ports-master-sites-n-example-detailed-use-complete-example-master-sites">
		    の両方をご覧ください。</para>

		  <example id="ports-master-sites-n-example-detailed-use-master-site-subdir">
		    <title><makevar>MASTER_SITE_SUBDIR</makevar> における
		      <literal>MASTER_SITES:n</literal> の詳細な使用法</title>

		    <programlisting>MASTER_SITE_SUBDIR=     old:n new/:NEW</programlisting>

		    <itemizedlist>
		      <listitem>
			<para>グループ <literal>DEFAULT</literal>
			  に属するディレクトリ -> old:n</para>
		      </listitem>

		      <listitem>
			<para>グループ <literal>NEW</literal>
			  に属するディレクトリ -> new</para>
		      </listitem>
		    </itemizedlist>
		  </example>

		  <example
		    id="ports-master-sites-n-example-detailed-use-complete-example-master-sites">
		      <title>カンマ演算子、複数のファイル、複数のサイト、
			複数のサブディレクトリと合わせた
			<literal>MASTER_SITES:n</literal>
			の詳細な使用法</title>

		    <programlisting>MASTER_SITES=   http://site1/%SUBDIR%/ http://site2/:DEFAULT \
                http://site3/:group3 http://site4/:group4 \
                http://site5/:group5 http://site6/:group6 \
                http://site7/:DEFAULT,group6 \
                http://site8/%SUBDIR%/:group6,group7 \
                http://site9/:group8
DISTFILES=      file1 file2:DEFAULT file3:group3 \
                file4:group4,group5,group6 file5:grouping \
                file6:group7
MASTER_SITE_SUBDIR=     directory-trial:1 directory-n/:groupn \
                        directory-one/:group6,DEFAULT \
                        directory</programlisting>

		    <para>上の例は、次のような細かく分けた取得を実現します。
		      サイトは、利用される順番で挙げられています。</para>

		    <itemizedlist>
		      <listitem>
			<para><filename>file1</filename>
			  は次のサイトから取得されます。</para>

			<itemizedlist>
			  <listitem>
			    <para><makevar>MASTER_SITE_OVERRIDE</makevar></para>
			  </listitem>

			  <listitem>
			    <para>http://site1/directory/</para>
			  </listitem>

			  <listitem>
			    <para>http://site1/directory-one/</para>
			  </listitem>

			  <listitem>
			    <para>http://site1/directory-trial:1/</para>
			  </listitem>

			  <listitem>
			    <para>http://site2/</para>
			  </listitem>

			  <listitem>
			    <para>http://site7/</para>
			  </listitem>

			  <listitem>
			    <para><makevar>MASTER_SITE_BACKUP</makevar></para>
			  </listitem>
			</itemizedlist>
		      </listitem>

		      <listitem>
			<para><filename>file2</filename>
			  は、<filename>file1</filename>
			  と同じグループに属しているので、
			  まったく同じように取得されます。</para>

			<itemizedlist>
			  <listitem>
			    <para><makevar>MASTER_SITE_OVERRIDE</makevar></para>
			  </listitem>

			  <listitem>
			    <para>http://site1/directory/</para>
			  </listitem>

			  <listitem>
			    <para>http://site1/directory-one/</para>
			  </listitem>

			  <listitem>
			    <para>http://site1/directory-trial:1/</para>
			  </listitem>

			  <listitem>
			    <para>http://site2/</para>
			  </listitem>

			  <listitem>
			    <para>http://site7/</para>
			  </listitem>

			  <listitem>
			    <para><makevar>MASTER_SITE_BACKUP</makevar></para>
			  </listitem>
			</itemizedlist>
		      </listitem>

		      <listitem>
			<para><filename>file3</filename>
			  は次のサイトから取得されます。</para>

			<itemizedlist>
			  <listitem>
			    <para><makevar>MASTER_SITE_OVERRIDE</makevar></para>
			  </listitem>

			  <listitem>
			    <para>http://site3/</para>
			  </listitem>

			  <listitem>
			    <para><makevar>MASTER_SITE_BACKUP</makevar></para>
			  </listitem>
			</itemizedlist>
		      </listitem>

		      <listitem>
			<para><filename>file4</filename>
			  は次のサイトから取得されます。</para>

			<itemizedlist>
			  <listitem>
			    <para><makevar>MASTER_SITE_OVERRIDE</makevar></para>
			  </listitem>

			  <listitem>
			    <para>http://site4/</para>
			  </listitem>

			  <listitem>
			    <para>http://site5/</para>
			  </listitem>

			  <listitem>
			    <para>http://site6/</para>
			  </listitem>

			  <listitem>
			    <para>http://site7/</para>
			  </listitem>

			  <listitem>
			    <para>http://site8/directory-one/</para>
			  </listitem>

			  <listitem>
			    <para><makevar>MASTER_SITE_BACKUP</makevar></para>
			  </listitem>
			</itemizedlist>
		      </listitem>

		      <listitem>
			<para><filename>file5</filename>
			  は次のサイトから取得されます。</para>

			<itemizedlist>
			  <listitem>
			    <para><makevar>MASTER_SITE_OVERRIDE</makevar></para>
			  </listitem>

			  <listitem>
			    <para><makevar>MASTER_SITE_BACKUP</makevar></para>
			  </listitem>
			</itemizedlist>
		      </listitem>

		      <listitem>
			<para><filename>file6</filename>
			  は次のサイトから取得されます。</para>

			<itemizedlist>
			  <listitem>
			    <para><makevar>MASTER_SITE_OVERRIDE</makevar></para>
			  </listitem>

			  <listitem>
			    <para>http://site8/directory-one/</para>
			  </listitem>

			  <listitem>
			    <para><makevar>MASTER_SITE_BACKUP</makevar></para>
			  </listitem>
			</itemizedlist>
		      </listitem>
		    </itemizedlist>
		  </example>
		</listitem>
	      </orderedlist>
	    </listitem>

	    <listitem>
	      <para><makevar>MASTER_SITE_SOURCEFORGE</makevar>
		のように、<filename>bsd.sites.mk</filename>
		で定義される特別な変数をグループに割り当てるにはどうすればよいですか?</para>

	      <para><xref
		  linkend="ports-master-sites-n-example-detailed-use-master-site-sourceforge">
		をご覧ください。</para>

	      <example
		id="ports-master-sites-n-example-detailed-use-master-site-sourceforge">
		<title><makevar>MASTER_SITE_SOURCEFORGE</makevar>
		  と合わせた <literal>MASTER_SITES:n</literal>
		  の詳しい使用法</title>

		<programlisting>MASTER_SITES=   http://site1/ ${MASTER_SITE_SOURCEFORGE:S/$/:sourceforge,TEST/}
DISTFILES=      something.tar.gz:sourceforge</programlisting>
	      </example>

	      <para><filename>something.tar.gz</filename>
		は、<makevar>MASTER_SITE_SOURCEFORGE</makevar>
		に含まれるあらゆるサイトから取得されます。</para>
	    </listitem>

	    <listitem>
	      <para>これを <makevar>PATCH*</makevar>
		変数と組み合わせて使うにはどうすればよいでしょうか?</para>

	      <para>すべての例で <makevar>MASTER*</makevar>
		変数を使っていますが、<xref
		  linkend="ports-master-sites-n-example-detailed-use-patch-sites">
		にあるように、<makevar>PATCH*</makevar>
		変数に対してもまったく同じように働きます。</para>

	      <example
		id="ports-master-sites-n-example-detailed-use-patch-sites">
		<title><makevar>PATCH_SITES</makevar> と合わせた
		  <literal>MASTER_SITES:n</literal> の簡単な使用法</title>

		<programlisting>PATCH_SITES=    http://site1/ http://site2/:test
PATCHFILES=     patch1:test</programlisting>
	      </example>
	    </listitem>
	  </orderedlist>
	</sect3>

	<sect3>
	  <title>ports
	    について何が変更され、何が変わらないのでしょうか?</title>

	  <orderedlist numeration="lowerroman">
	    <listitem>
	      <para>現在のすべての ports はそのまま変わりません。
		<literal>MASTER_SITES:n</literal>
		機能のコードは、<xref
		  linkend="porting-master-sites-n-group-semantics">
		で述べた文法に従う
		<literal>:<replaceable>n</replaceable></literal>
		のような形式が後ろについた要素がある場合だけ動作します。</para>
	    </listitem>

	    <listitem id="porting-master-sites-n-what-changes-in-port-targets">
	      <para>port を make する際のターゲットにも変更はありません。
		<maketarget>checksum</maketarget>,
		<maketarget>makesum</maketarget>,
		<maketarget>patch</maketarget>,
		<maketarget>configure</maketarget>,
		<maketarget>build</maketarget> 等です。
		もちろん、<maketarget>do-fetch</maketarget>,
		<maketarget>fetch-list</maketarget>,
		<maketarget>master-sites</maketarget> それから
		<maketarget>patch-sites</maketarget>
		は例外です。</para>

	      <itemizedlist>
		<listitem>
		  <para><maketarget>do-fetch</maketarget>
		    は、新しくグループ分けの接尾辞のついた
		    <makevar>DISTFILES</makevar> と
		    <makevar>PATCHFILES</makevar>
		    を設定します。それぞれが、対応する
		    <makevar>MASTER_SITES</makevar> と
		    <makevar>PATCH_SITES</makevar>
		    を利用し、さらに対応する
		    <makevar>MASTER_SITE_SUBDIR</makevar> と
		    <makevar>PATCH_SITE_SUBDIR</makevar>
		    を利用します。<xref
		      linkend="ports-master-sites-n-example-detailed-use-complete-example-master-sites">
		    をご覧ください。</para>
		</listitem>

		<listitem>
		  <para><maketarget>fetch-list</maketarget>
		    は、<maketarget>do-fetch</maketarget>
		    と同じようにグループを利用するということを除いて、以前の
		    <maketarget>fetch-list</maketarget>
		    のように動作します。</para>
		</listitem>

		<listitem>
		  <para><maketarget>master-sites</maketarget> および
		    <maketarget>patch-sites</maketarget> は、
		    (古いバージョンと互換性がなくなり)
		    <literal>DEFAULT</literal>
		    グループの要素を返すだけになっています。
		    実際は、それぞれ
		    <maketarget>master-sites-default</maketarget> および
		    <maketarget>patch-sites-default</maketarget>
		    というターゲットを実行します。</para>

		  <para>さらに、
		    <maketarget>MASTER_SITES</maketarget> や
		    <maketarget>PATCH_SITES</maketarget>
		    を直接確認するよりも、
		    <maketarget>master-sites-all</maketarget> または
		    <maketarget>patch-sites-all</maketarget>
		    のどちらかのターゲットを使う方がよいです。
		    また、将来のバージョンでも直接確認ができるかどうかは保証されていません。
		    これら新規 port ターゲットについては、<xref
		      linkend="porting-master-sites-n-new-port-targets-master-sites-all">
		    の項をご確認ください。</para>
		</listitem>

	      </itemizedlist>
	    </listitem>

	    <listitem>
	      <para>新規の port ターゲット</para>

	      <orderedlist>
		<listitem>
		  <para><makevar>MASTER_SITES</makevar> および
		    <makevar>PATCH_SITES</makevar>
		    のそれぞれについて、
		    グループ <replaceable>n</replaceable> の要素を表示する
		    <maketarget>master-sites-<replaceable>n</replaceable></maketarget>
		    および
		    <maketarget>patch-sites-<replaceable>n</replaceable></maketarget>
		    ターゲットがあります。たとえば、
		    <maketarget>master-sites-DEFAULT</maketarget> および
		    <maketarget>patch-sites-DEFAULT</maketarget>
		    のいずれも <literal>DEFAULT</literal>
		    グループの要素を返し、
		    <maketarget>master-sites-test</maketarget> および
		    <maketarget>patch-sites-test</maketarget>
		    は <literal>test</literal>
		    グループの要素を返します。</para>
		</listitem>

		<listitem id="porting-master-sites-n-new-port-targets-master-sites-all">
		  <para>以前の
		    <maketarget>master-sites</maketarget> および
		    <maketarget>patch-sites</maketarget>
		    が行っていた作業を行う
		    <maketarget>master-sites-all</maketarget> および
		    <maketarget>patch-sites-all</maketarget>
		    という新たなターゲットがあります。
		    これらのターゲットは、
		    すべてのグループの要素をすべてが同じグループに属しているかのように返します。
		    ただし、
		    <maketarget>master-sites-all</maketarget> および
		    <maketarget>patch-sites-all</maketarget>
		    のそれぞれについて、
		    <makevar>DISTFILES</makevar> や
		    <makevar>PATCHFILES</makevar>
		    で定義されているグループと同じ数だけ
		    <makevar>MASTER_SITE_BACKUP</makevar> と
		    <makevar>MASTER_SITE_OVERRIDE</makevar>
		    を表示します。</para>
		</listitem>
	      </orderedlist>
	    </listitem>
	  </orderedlist>
	</sect3>
      </sect2>

      <sect2>
	<title><makevar>DIST_SUBDIR</makevar></title>

	<para><filename>/usr/ports/distfiles</filename>
	  ディレクトリ内をあまり散らかさないようにしてください。
	  たくさんのファイルを取ってくる port
	  や、他の port と名前の衝突が起きる恐れのあるファイル
	  (<filename>Makefile</filename> など)
	  がある場合には、
	  <makevar>DIST_SUBDIR</makevar> に port の名前
	  (<literal>${PORTNAME}</literal> か
	  <literal>${PKGNAMEPREFIX}${PORTNAME}</literal>
	  を使うといいでしょう)
	  を入れてください。すると <makevar>DISTDIR</makevar>
	  がデフォルトの
	  <filename>/usr/ports/distfiles</filename> から
	  <filename>/usr/ports/distfiles/<makevar>DIST_SUBDIR</makevar></filename>
	  に変更され、
	  取ってきたファイルはすべてそのサブディレクトリの中に置かれるようになります。</para>

	<para>また、
	  ファイルを取ってくるときにバックアップサイトとして使われる
	  <filename>ftp.FreeBSD.org</filename>
	  のディレクトリ名にもこの変数の値が使われます
	  (<makevar>Makefile</makevar> の中で
	  <makevar>DISTDIR</makevar> を明示的に指定した場合、
	  ローカルのファイルを置くところは変わりますが、
	  このサイトのディレクトリ名は変わりません。
	  必ず <makevar>DIST_SUBDIR</makevar>
	  を使うようにしてください)。</para>

	<note>
	  <para>この変数は <filename>Makefile</filename>
	    中で明示的に指定された
	    <makevar>MASTER_SITES</makevar>
	    には影響しません。</para>
	</note>
      </sect2>
    </sect1>

    <sect1 id="makefile-maintainer">
      <title><makevar>MAINTAINER</makevar></title>

      <para>あなたのメールアドレスをここに入れてください。
	お願いします。
	<!-- smiley --><emphasis remap=tt>:-)</emphasis></para>

      <para>保守担当者 (maintainer) の責任に関する詳細説明は、
	<ulink url="../developers-handbook/policies.html#POLICIES-MAINTAINER">
	Makefile 中の MAINTAINER</ulink> の
	セクションを参照してください。</para>
    </sect1>

    <sect1 id="makefile-comment">
      <title><makevar>COMMENT</makevar></title>

      <para>その port の 1 行の説明です。
	コメントにはパッケージ名 (やソフトウェアのバージョン)
	を<emphasis>入れないでください</emphasis>。
	コメントは大文字で始まり、最後にピリオドは付けないでください。
	たとえば、こんな具合です。</para>

      <programlisting>COMMENT=       A cat chasing a mouse all over the screen</programlisting>

      <para><filename>Makefile</filename> 中で、
	COMMENT 変数は MAINTAINER 変数の直後においてください。</para>
    </sect1>

    <sect1 id="makefile-depend">
      <title>依存関係</title>

      <para>多くの port は他の port に依存しています。
	必要なものすべてがユーザのマシン上に存在することを
	保証するために使用可能な、5 つの変数が用意されています。
	よくあるケースのためにあらかじめ設定された依存変数に加え、
	いくつかの依存関係の制御のための変数があります。</para>

      <sect2>
	<title><makevar>LIB_DEPENDS</makevar></title>

	<para>その port が必要とする共有ライブラリを、この変数で指定します。
	  (訳注: libc 等、標準のライブラリは指定する必要がありません。) 
	  これは <replaceable>lib</replaceable>:<replaceable>dir</replaceable><optional><replaceable>:target</replaceable></optional> という
	  組のリストです。
	  <replaceable>lib</replaceable> が共有ライブラリの名前、
	  <replaceable>dir</replaceable> が
	  そのライブラリが見つからない場合に
	  インストールされる port のディレクトリ、
	  <replaceable>target</replaceable>が
	  そのディレクトリで呼ばれるターゲットです。
	  たとえば、

	<programlisting>LIB_DEPENDS= jpeg.9:${PORTSDIR}/graphics/jpeg:install</programlisting>

	  と指定されていた場合、まずメジャーバージョンが 9 の jpeg
	  共有ライブラリがインストールされているかどうかを確認します。
	  インストールされていない場合には、ports ツリーの
	  <filename>graphics/jpeg</filename> サブディレクトリに移動し、
	  <replaceable>target</replaceable>
	  のコンパイルとインストールを行ないます。
	  <replaceable>target</replaceable> の部分は、
	  それが <makevar>DEPENDS_TARGET</makevar>
	  (デフォルトでは <literal>install</literal>) と
	  等しいときには省略することができます。</para>

	<note>
	  <para>先頭の <replaceable>lib</replaceable> の部分は
	    <command>ldconfig -r | grep -wF</command> への引数になります。
	    この変数には正規表現を入れないようにしてください。
	  </para>
	</note>

	<para>
	  この依存関係のチェックは、
	  <maketarget>extract</maketarget> ターゲットと
	  <maketarget>install</maketarget> ターゲットの中で、2 回行なわれます。
	  (訳注: これは、その port をビルドするマシンと
	  インストールされるマシンが違う場合、どちらのマシンでも
	  そのライブラリが利用できることを確認するためです。)
	  同様に、依存するライブラリの名前は package 中にも書き込まれていて、
	  <command>pkg_add</command> 実行時に そのライブラリが
	  ユーザのシステムに存在していなければ、自動的にインストールされます。
	</para>
      </sect2>

      <sect2>
	<title><makevar>RUN_DEPENDS</makevar></title>

	<para>この port の実行時に必要となるプログラム、
	  またはファイルがあるときにはこの変数で指定します。これは
	  <replaceable>path</replaceable>:<replaceable>dir</replaceable><optional><replaceable>:target</replaceable></optional>
	  という組のリストです。
	  <replaceable>path</replaceable> がファイルまたはプログラムの名前、
	  <replaceable>dir</replaceable>
	  が それが見つからない場合にインストールされる port のディレクトリ、
	  <replaceable>target</replaceable>
	  が そのディレクトリで呼ばれるターゲットです。
	  <replaceable>path</replaceable> の最初の文字がスラッシュ
	  (<literal>/</literal>) の場合にはファイルかディレクトリとみなし、
	  存在するかどうか
	  <command>test -e</command> を使ってチェックします。
	  そうでない場合には実行可能ファイルであると考えて、
	  そのプログラムがユーザのサーチパス上にあるかどうか
	  <command>which -s</command> を使って確認します。</para>

	<para>たとえば Makefile に以下のように書いてあるとします。</para>

	  <programlisting>RUN_DEPENDS=   ${LOCALBASE}/etc/innd:${PORTSDIR}/news/inn \
                wish8.0:${PORTSDIR}/x11-toolkits/tk80</programlisting>

	<para>まず、<filename>/usr/local/etc/innd</filename>
	  というファイルかディレクトリが存在するか確認します。
	  存在しない場合には、ports ツリーの
	  <filename>news/inn</filename> というサブディレクトリで
	  ビルドとインストールを行ないます。
	  さらに、<command>wish8.0</command>
	  というプログラムがユーザのサーチパス中にあるかどうか探します。
	  ない場合には同じく ports ツリーの
	  <filename>x11-toolkits/tk80</filename>
	  というサブディレクトリでコンパイルとインストールを行ないます。</para>

	<note>
	  <para>この例で、<command>innd</command> は実際にはプログラムです。
	    このように、プログラムであっても一般ユーザのサーチパスに
	    含まれているとは考えにくいところに置かれているものの場合には、
	    絶対パスで指定してください。</para>
	</note>

	<para>この依存関係は <maketarget>install</maketarget>
	  ターゲット中でチェックされます。
	  また、<command>pkg_add</command> によるインストールの際に、その package
	  が依存するものがユーザのシステムに存在しない場合には自動的に追加インストールできるように、
	  依存するものの名前も package 中に記録されます。
	  <replaceable>target</replaceable> の部分が
	  <makevar>DEPENDS_TARGET</makevar> と同じ場合には、
	  <replaceable>target</replaceable> の部分を省略することができます。
	</para>
      </sect2>

      <sect2>
	<title><makevar>BUILD_DEPENDS</makevar></title>

	<para>この port のビルド時に必要となるプログラム、
	  またはファイルがあるときにはこの変数で指定します。
	  <makevar>RUN_DEPENDS</makevar> と同様に、これは
	  <replaceable>path</replaceable>:<replaceable>dir</replaceable><optional><replaceable>:target</replaceable></optional>
	  という組のリストです。たとえば、

	  <programlisting>BUILD_DEPENDS=unzip:${PORTSDIR}/archivers/unzip</programlisting>

	  と指定されていた場合、まず <command>unzip</command>
	  という名前のプログラムがインストールされているかどうかを確認します。
	  インストールされていない場合には ports ツリーの
	  <filename>archivers/unzip</filename> サブディレクトリに移動し、
	  ビルドとインストールを行ないます。</para>

	<note>
	  <para>ここで言う<quote>ビルド</quote>とは、
	    ファイルの展開からコンパイルまでのすべての処理を意味します。
	    この依存関係は、<maketarget>extract</maketarget>
	    ターゲットの中でチェックされます。
	    <replaceable>target</replaceable> の部分は、
	    <makevar>DEPENDS_TARGET</makevar>
	    と同じ場合には省略することができます。</para>
	</note>
      </sect2>

      <sect2>
	<title><makevar>FETCH_DEPENDS</makevar></title>

	<para>この port を取ってくるのに必要となるプログラム、
	  またはファイルがあるときにはこの変数で指定します。
	  上の二つと同様に、これは
	  <replaceable>path</replaceable>:<replaceable>dir</replaceable><optional><replaceable>:target</replaceable></optional>
	  という組のリストです。たとえば、

	  <programlisting>FETCH_DEPENDS=ncftp2:${PORTSDIR}/net/ncftp2</programlisting>

	  と指定されていれば、<command>ncftp2</command>
	  という名前のプログラムを探します。
	  見つからない場合には、ports ツリーの
	  <filename>net/ncftp2</filename>
	  サブディレクトリでビルドとインストールを行ないます。

	<para>この依存関係は <maketarget>fetch</maketarget>
	  ターゲット中でチェックされます。
	  <replaceable>target</replaceable> の部分は、
	  <makevar>DEPENDS_TARGET</makevar>
	  と同じ場合には省略することができます。
      </sect2>

      <sect2>
	<title><makevar>DEPENDS</makevar></title>

	<para>上記の四つのいずれにもあてはまらないような依存関係がある場合、
	  または他の port がインストールされているだけではなく
	  ソースが展開されている必要がある場合には、この変数を使います。
	  これは上記の四つと違い、特に<quote>確認</quote>するものが
	  ありませんので、
	  <replaceable>dir</replaceable><optional><replaceable>:target</replaceable></optional>
	  という形式のリストになります。
	  <replaceable>target</replaceable> の部分は
	  <makevar>DEPENDS_TARGET</makevar>
	  と同じ場合には省略することができます。</para>
      </sect2>

      <sect2>
	<title><makevar>USE_<replaceable>*</replaceable></makevar></title>

	<para>多くの ports に共通の依存関係をカプセル化するために、
	  いくつもの変数が存在しています。</para>

	<table frame="none">
	  <title><makevar>USE_<replaceable>*</replaceable></makevar>
	    変数</title>

	  <tgroup cols="2">
	    <thead>
	      <row>
		<entry>変数</entry>

		<entry>意味</entry>
	      </row>
	    </thead>

	    <tbody>
	      <row>
		<entry><makevar>USE_BZIP2</makevar></entry>

		<entry>その port の tarball は <command>bzip2</command>
		  で圧縮されています。</entry>
	      </row>

	      <row>
		<entry><makevar>USE_ZIP</makevar></entry>

		<entry>その port の tarball は <command>zip</command>
		  で圧縮されています。</entry>
	      </row>

	      <row>
		<entry><makevar>USE_GMAKE</makevar></entry>

		<entry>その port をビルドするのに <command>gmake</command>
		  が必要です。</entry>
	      </row>

	      <row>
		<entry><makevar>USE_PERL5</makevar></entry>

		<entry>その port をビルドしてインストールするのに Perl 5
		  が必要です。Perl に関連して設定可能な他の変数については
		  <xref linkend="using-perl"> をご覧ください。</entry>
	      </row>

	      <row>
		<entry><makevar>USE_X_PREFIX</makevar></entry>

		<entry>その port は <makevar>PREFIX</makevar> ではなく
		  <makevar>X11BASE</makevar> にインストールされます。
		  X11 に関連して設定可能な他の変数については、
		  <xref linkend="using-x11"> をご覧ください。</entry>
	      </row>

	      <row>
		<entry><makevar>USE_AUTOMAKE</makevar></entry>

		<entry>その port のビルドに GNU <command>automake</command>
		  が使われます。<command>automake</command>
		  に関わる他に設定可能な変数については、
		  <xref linkend="using-automake"> をご覧ください。</entry>
	      </row>

	      <row>
		<entry><makevar>USE_AUTOCONF</makevar></entry>

		<entry>その port のビルドに GNU <command>autoconf</command>
		  が使われます。<command>autoconf</command>
		  に関わる他に設定可能な変数については、
		  <xref linkend="using-automake"> をご覧ください。</entry>
	      </row>

	      <row>
		<entry><makevar>USE_LIBTOOL</makevar></entry>

		<entry>その port のビルドに GNU <command>libtool</command>
		  が使われます。<command>libtool</command>
		  に関わる他に設定可能な変数については、
		  <xref linkend="using-automake"> をご覧ください。</entry>
	      </row>

	      <row>
		<entry><makevar>GMAKE</makevar></entry>

		<entry><command>gmake</command> が
		  <envar>PATH</envar> に入っていない場合のフルパス</entry>
	      </row>

	      <row>
		<entry><makevar>USE_BISON</makevar></entry>

		<entry>その port のビルドに <command>bison</command>
		  が使われます。</entry>
	      </row>

	      <row>
		<entry><makevar>NO_INSTALL_MANPAGES</makevar></entry>

		<entry><maketarget>install.man</maketarget>
		  ターゲットを使いません。</entry>
	      </row>

	  </tgroup>
	</table>

	<para>その ports が X Window System を必要とするのであれば、
	  <literal>USE_XLIB=yes</literal> を定義してください
	  (これは <makevar>USE_IMAKE</makevar>
	  が定義されていれば自動的に定義されます)。
	  BSD <command>make</command> ではなく
	  GNU <command>make</command> を必要とする場合には
	  <literal>USE_GMAKE=yes</literal> を、
	  GNU autoconf を実行する必要がある場合には
	  <literal>USE_AUTOCONF=yes</literal> を、
	  最新の qt toolkit を使用する場合には
	  <literal>USE_QT=yes</literal> を、
	  perl 言語のバージョン 5 を必要とする場合には
	  <literal>USE_PERL5=yes</literal> を定義してください
	  (特に最後のものは重要です。
	  FreeBSD のバージョンにより、基本システムに perl5
	  が含まれていたり、いなかったりします)。</para>
      </sect2>

      <sect2>
	<title>依存関係に関する注意</title>

	<para>上で述べたように、依存する ports
	  が必要になったときに呼ばれるデフォルトのターゲットは
	  <maketarget>DEPENDS_TARGET</maketarget>
	  で、そのデフォルトは <literal>install</literal> です。
	  これはユーザが使用する変数であり、
	  port の <filename>Makefile</filename> で定義するものではありません。
	  もし、その port が特別な方法で依存関係を扱う必要がある場合には、
	  <makevar>DEPENDS_TARGET</makevar> を再定義するのではなく
	  <makevar>*_DEPENDS</makevar> 変数の
	  <literal>:target</literal> 部分を使用してください。</para>

	<para><command>make clean</command> と入力したときには、
	  その port が依存する port も自動的に clean されます。
	  そうならないようにしたい場合には、
	  環境変数 <makevar>NOCLEANDEPENDS</makevar> を設定してください。</para>

	<para>無条件に他の port に依存させるには、
	  <makevar>BUILD_DEPENDS</makevar> や
	  <makevar>RUN_DEPENDS</makevar> の最初のフィールドに
	  <makevar>${NONEXISTENT}</makevar> という変数を指定してください。
	  これは、他の port のソースが必要なときのみ使用してください。
	  ターゲットも指定することで、
	  コンパイルの時間を節約できる場合もあります。
	  たとえば

	  <programlisting>BUILD_DEPENDS=   ${NONEXISTENT}:${PORTSDIR}/graphics/jpeg:extract</programlisting>

	  とすると、常に JPEG port
	  のディレクトリに行ってソースの展開を行ないます。</para>

	<para>あなたがやりたいことが他の方法ではできない場合以外には
	  <makevar>DEPENDS</makevar> を使わないでください。
	  これは常に他の port の作成を行ない (さらにデフォルトでは
	  インストールも行ない)、package まで作成します。
	  この動作が本当に所望のものでしたら、
	  それを <literal>BUILD_DEPENDS</literal> と
	  <literal>RUN_DEPENDS</literal> に書くべきでしょう
	  &mdash; 少なくとも意図を明確にすることができます。</para>
      </sect2>

      <sect2>
      <title>オプション選択可能な依存ライブラリ</title>

      <para>巨大なアプリケーションの中には、
	複数のコンフィギュレーションでビルドすることができるものがあります。
	つまり、いくつもの外部ライブラリやアプリケーションの中の、
	あるものが利用可能な場合に、
	それを拡張機能として使用するように設定することができるということです。
	それらのライブラリやアプリケーションを、
	必ずしも すべてのユーザが必要としているわけではありませんので、ports
	システムではどのコンフィギュレーションがビルドされるべきかを
	port 作者が決めるために使えるフックを用意しています。
	これらを適切にサポートすることにより、ユーザをハッピーにしたり、
	port 1 つ分のコストで 2 つまたはそれ以上の
	port を提供するのと同様の効率化を行なうことが可能です。</para>

      <para>これらのフックのうちで最も簡単に使えるものは
	<makevar>WITHOUT_X11</makevar> でしょう。
	その port が X Window System のサポートありと、
	サポートなしの設定でビルドできるのであれば、
	通常は X Window System サポートありでビルドするべきでしょう。
	ビルド時に <makevar>WITHOUT_X11</makevar> が定義されていれば、
	その時は X Window System サポートなしのバージョンが
	ビルドされるべきです。</para>

      <para>GNOME 環境の様々なパーツも、そのようなノブ (フック)
	を持っていますが、それらは幾分使いにくいものです。
	<filename>Makefile</filename> 中で その目的に使用される変数は
	<makevar>WANT_*</makevar> と <makevar>HAVE_*</makevar> になります。
	そのアプリケーションが、
	以下に示されている依存ライブラリの一つについて、
	サポートあり、なしの両方でビルドできる場合、
	<filename>Makefile</filename> には <makevar>WANT_PKG</makevar>
	をセットする必要があります。
	そして、ビルド時に <makevar>HAVE_PKG</makevar> が定義されていれば
	<makevar>PKG</makevar> を使うバージョンがビルドされることになります。

      <para>現在、このような形でサポートされている
	<makevar>WANT_*</makevar> 変数は、
	<makevar>WANT_GLIB</makevar>, <makevar>WANT_GTK</makevar>,
	<makevar>WANT_ESOUND</makevar>, <makevar>WANT_IMLIB</makevar>,
	そして <makevar>WANT_GNOME</makevar> です。</para>
      </sect2>
    </sect1>

    <sect1 id="makefile-wrkdir">
      <title>作業ディレクトリの指定</title>

      <para>それぞれの port は作業ディレクトリに展開されるので、
	作業ディレクトリは書き込み可能でなければなりません。
	Ports システムは、<makevar>DISTFILES</makevar> が
	<literal>${DISTNAME}</literal>
	というディレクトリに展開されると仮定しています。
	つまり、次のように設定していたら、</para>

      <programlisting>PORTNAME=      foo
PORTVERSION=   1.0</programlisting>

      <para>その port の配布ファイルの内容は、最上位のディレクトリが
	<filename>foo-1.0</filename> で、
	残りのファイルはそのディレクトリの下に置かれているということです。</para>

      <para>そうでない場合に使える変数がいくつもあります。</para>

      <sect2>
	<title><makevar>WRKSRC</makevar></title>

	<para>この変数は、
	  アプリケーションの配布ファイルが展開された時に作成されるディレクトリの名称を示します。
	  前の例で、(<filename>foo-1.0</filename> ではなく)
	  <filename>foo</filename> というディレクトリに展開されるなら、</para>

	<programlisting>WRKSRC=      ${WRKDIR}/foo</programlisting>

	<para>または、</para>

	<programlisting>WRKSRC=      ${WRKDIR}/${PORTNAME}</programlisting>

	<para>と書いてください。</para>
      </sect2>

      <sect2>
	<title><makevar>NO_WRKSUBDIR</makevar></title>

	<para>その port がサブディレクトリに展開しないのであれば、
	  それを示すために <makevar>NO_WRKSUBDIR</makevar>
	  を設定してください。</para>

	<programlisting>NO_WRKSUBDIR= yes</programlisting>
      </sect2>
    </sect1>

    <sect1 id="makefile-build">
      <title>ビルドのメカニズム</title>

      <para>そのソフトウェアがビルドの際に GNU <command>make</command>
	を使う場合には、<literal>USE_GMAKE=yes</literal> をセットしてください。
	<command>configure</command> を使う場合には、
	<literal>HAS_CONFIGURE=yes</literal> をセットしてください。
	GNU <command>configure</command> を使う場合には、
	<literal>GNU_CONFIGURE=yes</literal> をセットしてください (これにより
	<literal>HAS_CONFIGURE</literal> もセットされます)。
	<command>configure</command> に追加の引数を渡したい場合には、
	追加部分を <makevar>CONFIGURE_ARGS</makevar> に指定してください。
	(デフォルトの引数リストは、GNU <command>configure</command> では
	<literal>--prefix=&dollar;{PREFIX}</literal> に、
	GNU でない <command>configure</command> では空リストになります。)
	GNU <command>autoconf</command> を使う場合には、
	<literal>USE_AUTOCONF=yes</literal> をセットしてください。
	これにより <makevar>GNU_CONFIGURE</makevar> もセットされ、
	<command>configure</command> を実行する前に
	<command>autoconf</command> が実行されます。</para>

      <note>
	<para>もしそのパッケージが GNU <command>configure</command>
	  を使っていて、作成された実行形式のファイルが
	  <filename>i386-portbld-freebsd4.7-</filename><replaceable>appname</replaceable>
	  のような<quote>奇妙な</quote>名称だった場合は、さらに
	  <makevar>CONFIGURE_TARGET</makevar>
	  を上書きして、新しいバージョンの <command>autoconf</command>
	  で生成されたスクリプトが要求する方法でターゲットを指定する必要があります。
	  <filename>Makefile</filename> の
	  <literal>GNU_CONFIGURE=yes</literal>
	  行のすぐ後に次の行を追加してください。</para>

	<para>
	  <literal>CONFIGURE_TARGET=--build=${MACHINE_ARCH}-portbld-freebsd${OSREL}</literal>
	</para>
      </note>

      <para>そのソフトウェアが X Window System のアプリケーションなどで、
	<command>imake</command> を使って <filename>Imakefile</filename> から
	<filename>Makefile</filename> を作成する場合には、
	<literal>USE_IMAKE=yes</literal> を指定してください。
	そうするとコンフィグレーションステージで自動的に
	<command>xmkmf -a</command> が実行されます。
	もし <option>-a</option> フラグが問題を引き起こすなら、
	さらに <literal>XMKMF=xmkmf</literal> をセットしてください。
	もし、その port が <command>imake</command> を使用するけれども
	<maketarget>install.man</maketarget> ターゲットを持たない場合には、
	<literal>NO_INSTALL_MANPAGES=yes</literal> をセットしてください。
	ついでに、そのソフトウェアの作者を探し出して八つ裂きにするといいでしょう。
	<!-- smiley --><emphasis>(-_-#)</emphasis></para>

      <para>そのソフトウェアの元々の <filename>Makefile</filename> が
	<maketarget>all</maketarget>
	以外のものをメインのターゲットとしている場合には、それを
	<makevar>ALL_TARGET</makevar> に指定してください。
	<maketarget>install</maketarget> と
	<makevar>INSTALL_TARGET</makevar> も同様です。</para>
    </sect1>
  </chapter>

  <chapter id="special">
    <title>特別な配慮</title>

    <para>port を作成する場合、
      考慮しなくてはいけないことが他にもいくつかあります。
      このセクションでは、それらのうちでも特によくあることについて説明します。</para>

    <sect1 id="porting-shlibs">
      <title>共有ライブラリ</title>

      <para>その port が共有ライブラリのインストールを行なう場合、
	make 変数 <makevar>INSTALLS_SHLIB</makevar> を定義してください。
	これにより、<filename>bsd.port.mk</filename> が
	<maketarget>post-install</maketarget>
	ターゲットの実行時に新しいライブラリがインストールされたディレクトリ
	(通常は	<filename><makevar>PREFIX</makevar>/lib</filename>) に
	<literal>&dollar;{LDCONFIG} -m</literal> を実行し、
	共有ライブラリキャッシュへの登録が行なわれるようになります。
	また、この変数が定義されている場合、共有ライブラリを
	インストールしたユーザが それをすぐに使い始められるように、
	また、削除の際には そのライブラリが まだ存在していると
	システムに誤認されないように、
	適切な <literal>@exec /sbin/ldconfig -m</literal> と
	<literal>@unexec /sbin/ldconfig -R</literal> のペアが
	<filename>pkg-plist</filename> ファイルに
	指定されているように扱われます。</para>

      <para>必要であれば、
	共有ライブラリがインストールされるディレクトリのリストを格納する
	make 変数 <makevar>LDCONFIG_DIRS</makevar> を定義することにより、
	新しいライブラリがインストールされるデフォルトの位置を上書きすることも可能です。
	例えば、その port が共有ライブラリを
	<filename><makevar>PREFIX</makevar>/lib/foo</filename> と
	<filename><makevar>PREFIX</makevar>/lib/bar</filename> に
	インストールする場合、<filename>Makefile</filename>
	で以下の記述を使用することができます:</para>

      <programlisting>INSTALLS_SHLIB= yes
LDCONFIG_DIRS=  %%PREFIX%%/lib/foo %%PREFIX%%/lib/bar</programlisting>

      <para><filename>pkg-plist</filename> の他の部分と同様に、
	<makevar>LDCONFIG_DIRS</makevar> の内容も &man.sed.1;
	による処理が行なわれるため、ここでも <makevar>PLIST_SUB</makevar>
	に指定した置換が行なわれることに注意してください。
	<makevar>PREFIX</makevar> には <literal>%%PREFIX%%</literal> を、
	<makevar>LOCALBASE</makevar> には <literal>%%LOCALBASE%%</literal>,
	<makevar>X11BASE</makevar> には <literal>%%X11BASE%%</literal>
	を使用することを推奨します。</para>

    </sect1>

    <sect1 id="porting-restrictions">
      <title>配布制限がある ports</title>

      <para>ライセンスにはさまざまなものがあり、なかには、
	アプリケーションをパッケージ化するやり方、営利目的で販売できるか、
	といったことに制限をかけているものがあります。</para> 

      <important>
	<para>port 作成者として、あなたには、使用許諾条件をよく読み、
	  FTP または CD-ROM
	  で再配布してはいけないソースコードやコンパイルされたバイナリを配布してしまい、
	  その責任が FreeBSD プロジェクトにかかってくることのないよう注意する義務があります。
	  疑わしい場合には &a.ports; で聞いてみてください。</para>
      </important>

      <para>そのような場合、次の変数を設定してください。
	また、<filename>ports/LEGAL</filename> も更新すべきです。</para>

      <sect2>
	<title><makevar>NO_PACKAGE</makevar></title>

	<para>この変数が設定されていたら、
	  このアプリケーションのバイナリパッケージを作成してはいけないということです。
	  ただし、この port の <makevar>DISTFILES</makevar>
	  は自由に配布できます。</para>

	<para>また、<makevar>NO_PACKAGE</makevar>
	  は、バイナリパッケージが汎用的ではなく、
	  いつもアプリケーションをソースコードからコンパイルすべき場合にも利用すべきです。
	  たとえば、アプリケーションにサイト特有の設定情報がコンパイル時にハードコードされるような場合です。</para>

	<para><makevar>NO_PACKAGE</makevar> には、
	  パッケージを作成すべきではない理由を述べた文字列を設定すべきです。</para>

      <sect2>
	<title><makevar>NO_CDROM</makevar></title>

	<para>この変数は、
	  バイナリパッケージの作成は許可されていますが、
	  そのパッケージや port の <makevar>DISTFILES</makevar>
	  を販売用の CDROM に載せるのは許されていないことを表します。
	  <makevar>DISTFILES</makevar> は、FTP で入手可能です。</para>

	<para><makevar>NO_PACKAGE</makevar> と <makevar>NO_CDROM</makevar>
	  は、同時に設定できます。</para>
      </sect2>

      <sect2>
	<title><makevar>RESTRICTED</makevar></title>

	<para>アプリケーションのライセンスが、FTP でそのアプリケーションの
	  <makevar>DISTFILES</makevar> をミラーすることも禁じていたら、
	  この変数を設定してください。</para>

	<para>また、
	  アプリケーションのライセンスが利用者について一般的な制限をかけている場合も、
	  この変数を設定してください。
	  たとえば、非商用利用限定のアプリケーションなどがあります。</para>
      </sect2>

      <sect2>
	<title><makevar>RESTRICTED_FILES</makevar></title>

	<para>一部の配布ファイルだけに制限がかかっていたら、
	  この変数にそのファイルのリストを設定してください。デフォルトでは、
	  <literal>${DISTFILES} ${PATCHFILES}</literal>
	  になります。</para>
      </sect2>
    </sect1>

    <sect1 id="using-perl">
      <title>Perl の利用</title>

      <table frame="none">
	<title>Perl を使用する ports 用の変数</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>変数</entry>

	      <entry>意味</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><makevar>USE_PERL5</makevar></entry>

	      <entry>その port のビルドと実行に Perl 5
		を使用することを示します。</entry>
	    </row>

	    <row>
	      <entry><makevar>PERL</makevar></entry>
	    </row>

	    <row>
	      <entry><makevar>PERL_VERSION</makevar></entry>

	      <entry>インストールされている Perl の完全なバージョン
		(たとえば <literal>5.00503</literal>)。</entry>
	    </row>

	    <row>
	      <entry><makevar>PERL_VER</makevar></entry>

	      <entry>インストールされている Perl のバージョンの短縮形
		(たとえば <literal>5.005</literal>)。</entry>
	    </row>

	    <row>
	      <entry><makevar>PERL_LEVEL</makevar></entry>

	      <entry>インストールされている Perl の
		MNNNPP 形式の整数で表されるバージョン
		(たとえば <literal>500503</literal>)。</entry>
	    </row>

	    <row>
	      <entry><makevar>PERL_ARCH</makevar></entry>

	      <entry>Perl
		がアーキテクチャ依存のライブラリをインストールする場所。
		デフォルトは <literal>${ARCH}-freebsd</literal>。</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>
    </sect1>

    <sect1 id="using-x11">
      <title>X11 の利用</title>

      <table frame="none">
	<title>X を利用する ports 用の変数</title>

	<tgroup cols="2">
	  <tbody>
	    <row>
	      <entry><makevar>USE_X_PREFIX</makevar></entry>

	      <entry>その port は <makevar>PREFIX</makevar> ではなく
		<makevar>X11BASE</makevar> にインストールされます。</entry>
	    </row>

	    <row>
	      <entry><makevar>USE_XLIB</makevar></entry>

	      <entry>その port は X ライブラリを使用します。</entry>
	    </row>

	    <row>
	      <entry><makevar>USE_MOTIF</makevar></entry>

	      <entry>その port は Motif ツールキットを使用します。
		<makevar>USE_XPM</makevar> が自動的に設定されます。</entry>
	    </row>

	    <row>
	      <entry><makevar>USE_IMAKE</makevar></entry>

	      <entry>その port は <command>imake</command>
		を使用します。<makevar>USE_X_PREFIX</makevar>
		が自動的に設定されます。</entry>
	    </row>

	    <row>
	      <entry><makevar>XMKMF</makevar></entry>

	      <entry><command>xmkmf</command> が <envar>PATH</envar>
		にない場合にパスを設定してください。
		デフォルトは <literal>xmkmf -a</literal> になります。</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>
    </sect1>

    <sect1 id="using-automake">
      <title><command>automake</command>, <command>autoconf</command>
	および <command>libtool</command> の利用</title>

      <table frame="none">
	<title>automake, autoconf または libtool
	  を使用する ports 用の変数</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>変数</entry>

	      <entry>意味</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><makevar>USE_AUTOMAKE</makevar></entry>

	      <entry>その port は <command>automake</command> を使用します。
		<makevar>USE_AUTOCONF</makevar> と
		<literal><makevar>USE_AUTOMAKE_VER</makevar>?=14</literal>
		が自動的に設定されます。</entry>
	      </row>

	    <row>
	      <entry><makevar>AUTOMAKE</makevar></entry>

	      <entry><command>automake</command> が <envar>PATH</envar>
		に含まれない場合のフルパス。</entry>
	    </row>

	    <row>
	      <entry><makevar>USE_AUTOMAKE_VER</makevar></entry>

	      <entry>その port は <command>automake</command>
		を使用します。この変数の有効な値は
		<literal>14</literal> と <literal>15</literal>
		で、<makevar>AUTOMAKE_DIR</makevar> および
		<makevar>ACLOCAL_DIR</makevar>
		変数が適切な値に設定されます。</entry>
	    </row>

	    <row>
	      <entry><makevar>AUTOMAKE_ARGS</makevar></entry>

	      <entry><makevar>USE_AUTOMAKE_VER</makevar>
		が設定されていた場合に <makevar>AUTOMAKE</makevar>
		に渡す 1 つまたはそれ以上のコマンドライン引数</entry>
	    </row>

	    <row>
	      <entry><makevar>AUTOMAKE_ENV</makevar></entry>

	      <entry><makevar>AUTOMAKE</makevar>
		を実行する前に設定する 1 つまたはそれ以上の環境変数 (とその値)</entry>
	    </row>

	    <row>
	      <entry><makevar>ACLOCAL</makevar></entry>

	      <entry>GNU <command>aclocal</command> が <envar>PATH</envar>
		にない場合にパスを設定してください。デフォルトは
		<makevar>USE_AUTOMAKE_VER</makevar>
		変数に応じて設定されます。</entry>
	    </row>

	    <row>
	      <entry><makevar>ACLOCAL_DIR</makevar></entry>

	      <entry>GNU <command>aclocal</command>
		の共有ディレクトリのパスを設定してください。
		デフォルトは <makevar>USE_AUTOMAKE_VER</makevar>
		変数に応じて設定されます。</entry>
	    </row>

	    <row>
	      <entry><makevar>AUTOMAKE_DIR</makevar></entry>

	      <entry>GNU <command>automake</command>
		の共有ディレクトリのパスを設定してください。
		デフォルトは <makevar>USE_AUTOMAKE_VER</makevar>
		変数に応じて設定されます。</entry>
	    </row>

	    <row>
	      <entry><makevar>USE_AUTOCONF_VER</makevar></entry>

	      <entry>その port が <command>autoconf</command>
		を使用することを指定します。デフォルト値は 213 です。</entry>
	    </row>

	    <row>
	      <entry><makevar>USE_AUTOCONF</makevar></entry>

	      <entry>その port が <command>autoconf</command>
		を使用することを指定します。<literal>GNU_CONFIGURE</literal>
		および <literal>USE_AUTOCONF_VER?=213</literal>
		を自動的に設定します。</entry>
	    </row>

	    <row>
	      <entry><makevar>AUTOCONF</makevar></entry>

	      <entry>GNU <command>autoconf</command> が <envar>PATH</envar>
		にない場合にパスを設定してください。デフォルトは
		<makevar>USE_AUTOCONF_VER</makevar>
		変数の値に応じて設定されます。</entry>
	    </row>

	    <row>
	      <entry><makevar>AUTOCONF_ARGS</makevar></entry>

	      <entry><command>autoconf</command>
		に渡すコマンドライン引数</entry>
	    </row>

	    <row>
	      <entry><makevar>AUTOCONF_ENV</makevar></entry>

	      <entry>この変数で指定された
		<literal><replaceable>変数</replaceable>=<replaceable>値</replaceable></literal> 
		の組を <command>autoconf</command>
		を実行する前に環境変数として設定してください。</entry>
	    </row>

	    <row>
	      <entry><makevar>AUTOHEADER</makevar></entry>

	      <entry>GNU <command>autoheader</command> が <envar>PATH</envar>
		にない場合にパスを設定してください。デフォルトは
		<makevar>USE_AUTOCONF_VER</makevar>
		の値に応じて設定されます。</entry>
	    </row>

	    <row>
	      <entry><makevar>AUTORECONF</makevar></entry>

	      <entry>GNU <command>autoreconf</command> が <envar>PATH</envar>
		にない場合にパスを設定してください。デフォルトは
		<makevar>USE_AUTOCONF_VER</makevar>
		に応じて設定されます。</entry>
	    </row>

	    <row>
	      <entry><makevar>AUTOSCAN</makevar></entry>

	      <entry>GNU <command>autoscan</command> が <envar>PATH</envar>
		にない場合にパスを設定してください。デフォルトは
		<makevar>USE_AUTOCONF_VER</makevar>
		に応じて設定されます。</entry>
	    </row>

	    <row>
	      <entry><makevar>AUTOIFNAMES</makevar></entry>

	      <entry>GNU <command>autoifnames</command> が <envar>PATH</envar>
		にない場合にパスを設定してください。デフォルトは
		<makevar>USE_AUTOCONF_VER</makevar>
		に応じて設定されます。</entry>
	    </row>

	    <row>
	      <entry><makevar>USE_LIBTOOL</makevar></entry>

	      <entry>その port は <command>libtool</command>
		を使用します。<makevar>GNU_CONFIGURE</makevar>
		を自動的に設定します。</entry>
	      </row>

	    <row>
	      <entry><makevar>LIBTOOL</makevar></entry>

	      <entry><command>libtool</command> が <envar>PATH</envar>
		にない場合にパスを設定してください。</entry>
	    </row>

	    <row>
	      <entry><makevar>LIBTOOLFILES</makevar></entry>

	      <entry><command>libtool</command> 用のパッチファイル。
		デフォルトは <makevar>USE_AUTOCONF</makevar>
		が設定されていれば <literal>aclocal.m4</literal>、
		それ以外は <literal>configure</literal> です。</entry>
	    </row>

	    <row>
	      <entry><makevar>LIBTOOLFLAGS</makevar></entry>

	      <entry><command>ltconfig</command> に追加で渡すフラグ。
		デフォルトは <literal>--disable-ltlibs</literal>。</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>
    </sect1>

    <sect1 id="using-gnome">
      <title>GNOME の利用</title>

      <para>FreeBSD/GNOME プロジェクトは、ある特定の port
	が使っている GNOME コンポーネントを特定するために
	<literal>GNOMENG</literal> というシステムを利用しています。
	FreeBSD/GNOME プロジェクトのページに
	<ulink url="http://www.FreeBSD.org/gnome/docs/porting.html">その変数のわかりやすい一覧</ulink>
	があります。</para>

    </sect1>

    <sect1 id="using-kde">
      <title>KDE の利用</title>

      <table frame="none">
	<title>KDE を利用する ports 用の変数</title>

	<tgroup cols="2">
	  <tbody>
	    <row>
	      <entry><makevar>USE_QT_VER</makevar></entry>

	      <entry>その port は Qt ツールキットを使用します。
		設定できる値は、
		<literal>1</literal>, <literal>2</literal> および
		<literal>3</literal> で、それぞれ使用する Qt
		のメジャーバージョンを示します。
		これは、<makevar>MOC</makevar> と <makevar>QTCPPFLAGS</makevar>
		をデフォルトの適切な値に設定します。</entry>
	    </row>

	    <row>
	      <entry><makevar>USE_KDELIBS_VER</makevar></entry>

	      <entry>その port は KDE ライブラリを使用します。
		設定できる値は、
		<literal>1</literal>, <literal>2</literal> および
		<literal>3</literal> で、それぞれ使用する KDE
		のメジャーバージョンを示します。
		暗黙で <makevar>USE_QT_VER</makevar>
		に適切なバージョンを設定します。</entry>
	    </row>

	    <row>
	      <entry><makevar>USE_KDEBASE_VER</makevar></entry>

	      <entry>その port は KDE base を使用します。
		設定できる値は、
		<literal>1</literal>, <literal>2</literal> および
		<literal>3</literal> で、それぞれ使用する KDE
		のメジャーバージョンを示します。
		暗黙で <makevar>USE_KDELIBS_VER</makevar>
		に適切なバージョンを設定します。</entry>
	    </row>

	    <row>
	      <entry><makevar>MOC</makevar></entry>

	      <entry><command>moc</command> へのパスを設定してください。
		デフォルトでは、<makevar>USE_QT_VER</makevar>
		の値に応じて設定されます。</entry>
	    </row>

	    <row>
	      <entry><makevar>QTCPPFLAGS</makevar></entry>

	      <entry>Qt のコードを処理する際の <makevar>CPPFLAGS</makevar>
		を設定してください。デフォルトでは
		<makevar>USE_QT_VER</makevar> の値に応じて設定されます。</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>
    </sect1>

    <sect1 id="using-bison">
      <title>Bison の利用</title>

      <para></para>
    </sect1>

    <sect1 id="using-java">
      <title>Java の利用</title>

      <para></para>
    </sect1>

    <sect1 id="using-python">
      <title>Python の利用</title>

      <para></para>
    </sect1>

    <sect1 id="using-emacs">
      <title>Emacs の利用</title>

      <para></para>
    </sect1>

    <sect1 id="using-ruby">
      <title>Ruby の利用</title>

      <para></para>
    </sect1>
  </chapter>

<!--

    <chapter>
      <title>ELF 対応</title>

      <para>FreeBSD は 3.0-RELEASE で ELF に移行しましたので、
	共有ライブラリを作成するたくさんの port を
	ELF 対応にする必要があります。
	3.0 システムは ELF としても a.out としても動作しますし、
	わたしたちは非公式ではありますが、
	できるだけ長い間 2.2
	システムのサポートをしたいと思っていますので状況は複雑です。
	以下は a.out のみに対応している port
	をどのように a.out と ELF 両方に対応させるかのガイドラインです。</para>

      <para>このリストの一部は移行時にしかあてはまらないものもありますが、
	古い port をアップグレードしたい場合に参考になるようにしばらくのあいだは残しておきます。</para>

      <sect1>
	<title>a.out ライブラリの退避</title>

	<para>すべての a.out ライブラリは
	  <filename>/usr/local/lib</filename> から
	  <filename>aout</filename> サブディレクトリに移動しなくはなりません
	  (もし移動しないと、ELF ports
	  がそれらをあっさり上書きしてしまいます)。
	  3.0-CURRENT の <filename>src/Makefile</filename> にある
	  <maketarget>move-aout-libs</maketarget> ターゲット
	  (<maketarget>aout-to-elf</maketarget> から呼ばれます)
	  がその移動をしてくれます。
	  a.out ライブラリを移動するだけなので、
	  ELF と a.out の両方のライブラリが標準的なディレクトリにあるシステムでは、
	  このターゲットを実行しても安全です。</para>
      </sect1>

      <sect1>
	<title>フォーマット</title>

	<para>ports ツリーは、そのマシンの (訳注: オブジェクト) フォーマットで
	  package を作成します。
	  つまり、2.2 のマシンでは a.out で作成され、
	  3.0 のマシンでは <command>`objformat`</command> の結果によって
	  a.out か ELF で作成されるということです。
	  また、いったん a.out ライブラリをサブディレクトリに移動すると
	  a.out ライブラリの作成はサポート外となります。
	  (つまり、自分が何をやっているのかを理解していれば、移動後にも
	  うまく作成できる可能性もあるけれど、自力でやらなければならない
	  ということです。)</para>

	<note>
	  <para>もし port が a.out でしか動作しないのなら、
	    <makevar>BROKEN_ELF</makevar>
	    に原因を説明する文字列を設定してください。
	    この変数が設定された port は、ELF
	    システム上でのビルドの際スキップされます。</para>
	</note>
      </sect1>

      <sect1>
	<title>PORTOBJFORMAT</title>

	<para><filename>bsd.port.mk</filename> において
	  <makevar>PORTOBJFORMAT</makevar> は
	  <literal>aout</literal> か
	  <literal>elf</literal> に設定され、環境変数
	  <envar>CONFIGURE_ENV</envar>,
	  <envar>SCRIPTS_ENV</envar>,
	  <envar>MAKE_ENV</envar> の中で export されます
	  (2.2-STABLE
	  では常に <literal>aout</literal> になります)。
	  また、
	  <literal>PORTOBJFORMAT=${PORTOBJFORMAT}</literal> として
	  <maketarget>PLIST_SUB</maketarget> に渡されます
	  (以下にある
	  <literal>ldconfig</literal>
	  に関するコメントを参照してください)。</para>

	<para>この変数は、以下のようにして
	  <filename>bsd.port.mk</filename> 中で設定されます。</para>

	<programlisting>PORTOBJFORMAT!= test -x /usr/bin/objformat && /usr/bin/objformat || echo aout</programlisting>

	<para>この変数を使って、port の make
	  の過程で何をすべきかを決定すべきですが、
	  もし port の <filename>configure</filename> スクリプトが元々
	  ELF システムを自動的に検出するのであれば、
	  <makevar>PORTOBJFORMAT</makevar>
	  を参照する必要はありません。</para>
      </sect1>

      <sect1>
	<title>共有ライブラリの作成</title>

	<para>以下は、a.out と ELF
	  での共有ライブラリの扱いの違いです。</para>

	<itemizedlist>
	  <listitem>
	    <para>共有ライブラリのバージョン</para>

	    <para>ELF の共有ライブラリは
	      <filename>libfoo.so.<replaceable>M</replaceable></filename>
	      という名前になっていなければなりません。
	      ここで <replaceable>M</replaceable>
	      は単一のバージョン番号を表します。
	      一方 a.out のライブラリは
	      <filename>libfoo.so.<replaceable>M</replaceable>.<replaceable>N</replaceable></filename>
	      という名前で、
	      <replaceable>M</replaceable> はメジャーバージョン番号、
	      <replaceable>N</replaceable>
	      はマイナーバージョン番号になっている必要があります。
	      これらを混同しないでください。
	      <filename>libfoo.so.<replaceable>N</replaceable>.<replaceable>M</replaceable></filename>
	      という名の ELF 共有ライブラリや
	      <filename>libfoo.so.<replaceable>N</replaceable></filename>
	      という名の a.out 共有ライブラリ
	      (あるいはシンボリックリンク)
	      は<emphasis>絶対にインストールしないでください</emphasis>。</para>
	  </listitem>

	  <listitem>
	    <para>リンカコマンドライン</para>

	    <para>直接 <command>ld</command> を使用せずに
	      <command>cc -shared</command> を使用してください。
	      たった一つの違いは、ELF には、
	      <option>-Wl,-<replaceable>soname,libfoo.so.M</replaceable></option>
	      コマンドラインにを加える必要があることです。</para>
	    < ! - - kuriyama - strange Japanese representation - - >
	  </listitem>
	</itemizedlist>

	<para>ELF のリンカを満足させるためには、
	  <filename>libfoo.so</filename> から
	  <filename>libfoo.so.<replaceable>N</replaceable></filename>
	  へのシンボリックリンクを作る必要があります。
	  これは <filename>pkg-plist</filename> にも加えなくてはいけませんし、
	  a.out の場合でも害にはならないので
	  (一部の port
	  ではダイナミックリンクローディングのために必要でもあります)、
	  <makevar>PORTOBJFORMAT</makevar>
	  の設定を気にせずに、ただ単純にリンクを作成してください。</para>
      </sect1>

      <sect1>
	<title><makevar>LIB_DEPENDS</makevar></title>

	<para>すべての port の <filename>Makefile</filename> を編集して
	  <makevar>LIB_DEPENDS</makevar>
	  からマイナー番号を除去する必要があり、
	  正規表現のサポートも除去する必要があります
	  (たとえば、
	  <literal>foo\\.1\\.\\(33|40\\)</literal> から
	  <literal>foo.2</literal>).
	  マッチングは <command>grep -wF</command>
	  を使って行なわれます。</para>
      </sect1>

      <sect1>
	<title><filename>pkg-plist</filename></title>

	<para><filename>pkg-plist</filename> は
	  a.out のマイナー番号が 0 であれば短い
	  (ELFの) 共有ライブラリの名前を含み、
	  そうでなければ長い (a.out の) 名前を含んでいる必要があります。
	  <makevar>PORTOBJFORMAT</makevar> が
	  <literal>aout</literal> であれば、
	  <filename>bsd.port.mk</filename> は自動的に
	  <literal>.0</literal> を短い共有ライブラリの名前の行に付け加え、
	  <makevar>PORTOBJFORMAT</makevar> が <literal>elf</literal>
	  であれば、
	  マイナー番号を長い共有ライブラリの名前から削除します。</para>

	<para>ELF システムで二つのバージョン番号を持つ共有ライブラリをインストールしたり、
	  a.out システムで一つのバージョン番号しか持たない共有ライブラリをインストールするのが避けられない場合
	  (たとえば他のオペレーティングシステム用の互換ライブラリをインストールする port など)、
	  <makevar>NO_FILTER_SHLIBS</makevar>
	  変数を定義すれば前のセクションで説明されている
	  <filename>pkg-plist</filename>
	  編集の機能が停止されます。</para>
      </sect1>

      <sect1>
	<title><literal>ldconfig</literal></title>

	< ! - - kuriyama - Eng. why literal? - - >
	  <para><filename>Makefile</filename> 中の
	    <literal>ldconfig</literal>
	    の行は以下のようになります。</para>

	  <programlisting>${SETENV} OBJFORMAT=${PORTOBJFORMAT} ${LDCONFIG} -m ....</programlisting>

	  <para>また <filename>pkg-plist</filename> 中では、</para>

	  <programlisting>@exec /usr/bin/env OBJFORMAT=%%PORTOBJFORMAT%% /sbin/ldconfig -m ...
@unexec /usr/bin/env OBJFORMAT=%%PORTOBJFORMAT%% /sbin/ldconfig -R</programlisting>

	  <para>となります。これは、
	    システムのデフォルトフォーマットではなく package のフォーマットに応じて、
	    正しい
	    <command>ldconfig</command>
	    が呼ばれることを保証するためのものです。</para>
      </sect1>
    </chapter>

-->

  <chapter id="porting-masterdir">
    <title><makevar>MASTERDIR</makevar></title>

    <para>その port の変数 (たとえば解像度とか紙のサイズなど) を
      変えたりした、少しだけ違うバージョンを作成する必要があるときには、
      ユーザが分りやすいように package ごとに別々のサブディレクトリを作成し、
      できるだけ port 間でファイルを共有するようにしてください。
      ほとんどの場合、うまく変数を使えば、一つを除くすべてのディレクトリには
      とても短い <filename>Makefile</filename> を置くだけで済みます。
      その短い <filename>Makefile</filename> では、
      <makevar>MASTERDIR</makevar> を使って、
      残りのファイルがあるディレクトリを指定できます。
      また、<link
      linkend="porting-pkgname"><makevar>PKGNAMESUFFIX</makevar></link> の
      一部に変数に使って、package が別々の名前を持つようにしてください。</para>

    <para>具体的な例を示すのが一番わかりやすいでしょう。
      これは <filename>japanese/xdvi300/Makefile</filename> の一部です。</para>

    <programlisting>PORTNAME=       xdvi
PORTVERSION=    17
PKGNAMEPREFIX=  ja-
PKGNAMESUFFIX=  ${RESOLUTION}
 :
# default
RESOLUTION?=   300
.if ${RESOLUTION} != 118 && ${RESOLUTION} != 240 && \
       ${RESOLUTION} != 300 && ${RESOLUTION} != 400
       @${ECHO} "Error: invalid value for RESOLUTION: \"${RESOLUTION}\""
       @${ECHO} "Possible values are: 118, 240, 300 (default) and 400."
       @${FALSE}
.endif</programlisting>

    <para><filename role="package">japanese/xdvi300</filename> には
      <filename>Makefile</filename> の他に通常のパッチや、
      package ファイル等が置かれています。
      このディレクトリで <command>make</command> を実行すると、
      デフォルトの解像度 (300) を使って、
      普通に port のビルドを行ないます。</para>

    <para>他の解像度に関していうと、
      <filename>xdvi118/Makefile</filename> に
      必要なのは<emphasis>これだけ</emphasis>です:</para>

    <programlisting>RESOLUTION=     118
MASTERDIR=      ${.CURDIR}/../xdvi300

.include "${MASTERDIR}/Makefile"</programlisting>

    <para>(<filename>xdvi240/Makefile</filename> や
      <filename>xdvi400/Makefile</filename> も同様のものになります)。
      <filename>bsd.port.mk</filename> は、
      <makevar>MASTERDIR</makevar> の定義から
      <makevar>FILESDIR</makevar> や <makevar>SCRIPTDIR</makevar> 等の
      通常のサブディレクトリが <filename>xdvi300</filename>
      以下に存在することを理解します。
      <literal>RESOLUTION=118</literal> の行が、
      <filename>xdvi300/Makefile</filename> の
      <literal>RESOLUTION=300</literal> の行を上書きし、
      port は解像度を 118 として作成されます。</para>
  </chapter>

  <chapter id="shared">
    <title>共有ライブラリのバージョン</title>

    <para>まず<ulink url="../developers-handbook/policies-shlib.html">
      共有ライブラリのバージョンについての指針</ulink>を読んで、
      一般的に共有ライブラリのバージョンをどうすれば良いかを理解してください。
      ソフトウェアの作者は自分がしていることを理解していると、
      盲目的に信じていてはいけません。多くの場合は理解していないのです。
      細部にわたって注意深く考慮することは大変重要です。なぜなら我々は、
      互換性がないかもしれない大量のソフトウェアを共存させようとする特殊な状況にあるからです。
      むかし、不注意な port
      の導入が共有ライブラリに関する重大な問題を引き起してしまったことがあります
      (なぜ <filename>jpeg-6b</filename> の共有ライブラリのバージョン番号が
      9 なのか、今まで不思議に思ったことはありませんか?)。
      もし疑問があれば、&a.ports; にメールを送ってください。
      ほとんどの時間は正しい共有ライブラリのバージョンを決めることと、
      それを実現するためのパッチを作成することに終始します。</para>

<!--

    <para>しかしながら、
      同じソフトウェアの違ったバージョンのソフトウェアが既にツリーにある場合には、
      状況は非常に複雑です。< ! - - kuriyama - strange translation? - - >
      つまり FreeBSD ではユーザがリンカにどのバージョンの共有ライブラリを使用するかを指定できないからです
      (リンカは常にもっとも高いバージョンを選びます)。
      これは、もし <filename>libfoo.so.3.2</filename> と
      <filename>libfoo.so.4.0</filename>
      がシステムに存在するときに、リンカに特別なアプリケーションだけ
      <filename>libfoo.so.3.2</filename>
      をリンクするよう指示する方法がないことを意味します。
      これはコンパイル時のリンクという意味では完全に見劣りします。
      この場合の唯一の解決方法は、
      共有ファイルの名前の<emphasis>ベース</emphasis>部分を変えることです。
      たとえば
      <filename>libfoo.so.4.0</filename> を
      <filename>libfoo4.so.1.0</filename> へ変えることによって、
      バージョン 3.2 とバージョン 4.0 共に他の
      port からリンクされることができるようになります。</para>

-->
  </chapter>

  <chapter id="porting-manpages">
    <title>マニュアルページ</title>

    <para><makevar>MAN[1-9LN]</makevar> 変数に指定したマニュアルは
      自動的に <filename>pkg-plist</filename> に追加されます
      (つまり、マニュアルを <filename>pkg-plist</filename>
      に加えては<emphasis>いけません</emphasis>&mdash; <link
        linkend="porting-plist">pkg-plist の生成</link>を参照してください)。
      また、<filename>/etc/make.conf</filename> 中の
      <makevar>NOMANCOMPRESS</makevar> の設定に従って、インストール時に
      マニュアルを自動的に圧縮したり復元したりします。</para>

    <para>その port が、シンボリックリンクやハードリンクを用いて、
      複数のファイル名を持つマニュアルをインストールする場合には、
      それらを識別するために <makevar>MLINKS</makevar>
      変数を使用しなければなりません。
      port によってインストールされたリンクは、
      意図したファイルをきちんと指しているかどうか確認するため、
      <filename>bsd.port.mk</filename> によって削除されたり、
      再作成されたりします。
      MLINKS に指定されたマニュアルも、
      <filename>pkg-plist</filename> に含めてはいけません。</para>

    <para>マニュアルをインストール時に圧縮するかどうかを指定するには、
      <makevar>MANCOMPRESSED</makevar> 変数を使用します。
      この変数は <literal>yes</literal>, <literal>no</literal>
      そして <literal>maybe</literal> の三つの値をとることができます、
      <literal>yes</literal>
      はマニュアルが既に圧縮されてインストールされていること、
      <literal>no</literal> は圧縮されていないこと、
      <literal>maybe</literal> は既にそのソフトウェアが
      <makevar>NOMANCOMPRESS</makevar> の値に従っていて、
      <filename>bsd.port.mk</filename>
      は特別なにもする必要がないことを意味します。</para>

    <para><makevar>USE_IMAKE</makevar> がセットされていて、
      <makevar>NO_INSTALL_MANPAGES</makevar> がセットされていなければ、
      <makevar>MANCOMPRESSED</makevar> は自動的に <literal>yes</literal>
      に設定されます。それ以外の場合には、<makevar>MANCOMPRESSED</makevar>
      は <literal>no</literal> に設定されます。
      その port にとって、デフォルトの設定が適切でない場合以外には、
      明示的に設定する必要はありません。</para>

    <para><makevar>PREFIX</makevar>
      以外のディレクトリの下にマニュアルを置くような port
      では、そのディレクトリを <makevar>MANPREFIX</makevar>
      で指定することができます。
      さらに、いくつかの Perl モジュールの ports のように、
      特定のセクションのマニュアルだけを非標準の場所にインストールする場合、
      個々のマニュアルのパスを
      <makevar>MAN<replaceable>sect</replaceable>PREFIX</makevar>
      (ここで <replaceable>sect</replaceable> は <literal>1-9</literal>,
      <literal>L</literal>, または <literal>N</literal> のいずれか)
      により指定することができます。</para>

    <para>マニュアルが言語特有のサブディレクトリに置かれる場合には、
      その言語名を <makevar>MANLANG</makevar> に設定してください。
      この変数のデフォルト値は <literal>""</literal>
      になっています (つまり、英語のみ)。</para>

    <para>これは、全部をまとめた例です。</para>

    <programlisting>MAN1=           foo.1
MAN3=           bar.3
MAN4=           baz.4
MLINKS=         foo.1 alt-name.8
MANLANG=        "" ja
MAN3PREFIX=     ${PREFIX}/share/foobar
MANCOMPRESSED=  yes</programlisting>

    <para>これは、この port により以下の
      6 個のファイルがインストールされることを表しています。</para>

      <programlisting>${PREFIX}/man/man1/foo.1.gz
${PREFIX}/man/ja/man1/foo.1.gz
${PREFIX}/share/foobar/man/man3/bar.3.gz
${PREFIX}/share/foobar/man/ja/man3/bar.3.gz
${PREFIX}/man/man4/baz.4.gz
${PREFIX}/man/ja/man4/baz.4.gz</programlisting>

    <para>さらに
      <filename>${PREFIX}/man/man8/alt-name.8.gz</filename>
      がこの port によってインストールされるかどうかわかりませんが、
      それとは無関係に foo(1) と alt-name(8)
      のマニュアルページを指すシンボリックリンクが作成されます。</para>
  </chapter>

  <chapter id="porting-motif">
    <title>Motif を必要とする port</title>

    <para>コンパイルに Motif ライブラリを必要とするアプリケーションがいくつかあります
      (Motif 自体は有料のものがいくつかの会社から手に入りますし、
      <filename role="package">x11-toolkits/lesstif</filename>
      には多くのアプリケーションを動作させることが可能な無料の互換ライブラリもあります)。
      Motif は広く使われているツールキットですし、
      有料のもののライセンスでもライブラリを静的にリンクした実行形式の再配布が認められている場合が多いので、
      Motif を必要とするソフトウェアを簡単に
      (port からコンパイルする人々のために) 動的にでも、
      (package を配布する人々のために) 静的にでもリンクできるような仕組みが用意されています。</para>

    <sect1 id="motif-use">
      <title><makevar>USE_MOTIF</makevar></title>

      <para>Motif が無いとコンパイルできない port
	の <filename>Makefile</filename> では、この変数を指定してください。
	これにより、Motif を持っていない人がこの
	port をコンパイルしようとするのを未然に防ぎます。</para>
    </sect1>

    <sect1 id="motif-lib">
      <title><makevar>MOTIFLIB</makevar></title>

      <para>この変数は <filename>bsd.port.mk</filename> によって
	Motif ライブラリの指定に置き換えられます。ソース内の Makefile や
	Imakefile で Motif ライブラリを指定しているところを、
	この変数に置き換えるようにパッチを適用してください。</para>

      <para>代表的な例としては以下の二つがあげられます:</para>

      <orderedlist>
	<listitem>
	  <para>Makefile か Imakefile の中で Motif ライブラリが
	    <option>-lXm</option> として使われている場合には、
	    かわりに
	    <makevar>MOTIFLIB</makevar>
	    と書いてください。</para>
	</listitem>

	<listitem>
	  <para>Imakefile の中で <literal>XmClientLibs</literal>
	    が使われている場合には、それを
	    <literal>&dollar;{MOTIFLIB} &dollar;{XTOOLLIB} &dollar;{XLIB}</literal>
	    と書きかえてください。</para>
	</listitem>
      </orderedlist>

      <para>なお <makevar>MOTIFLIB</makevar> は通常、
	<literal>-L/usr/X11R6/lib   -lXm</literal> か
	<literal>/usr/X11R6/lib/libXm.a</literal>
	に置き換えられます。
	したがって前に <option>-L</option> や
	<option>-l</option> をつける必要はありません。</para>
    </sect1>
  </chapter>

  <chapter id="x11-fonts">
    <title>X11 のフォント</title>

    <para>もし、あなたの port が X Window System
      のフォントをインストールするのであれば、
      それらを
      <filename><makevar>X11BASE</makevar>/lib/X11/fonts/local</filename>
      に置くようにしてください。このディレクトリは
      <application>XFree86 3.3.3</application> で新設されたものです。
      このディレクトリが存在しなければ作成して、ユーザに
      <application>XFree86</application> を
      3.3.3 かそれより新しいものに更新するか、
      少なくともこのディレクトリを <filename>/etc/XF86Config</filename>
      のフォントパスに加えるように促すメッセージを出力するようにしてください。
    </para>
  </chapter>

  <chapter id="porting-info">
    <title>Info ファイル</title>

    <para>新しい版の texinfo
      (2.2.2-RELEASE およびそれ以降に入っています) には
      <command>install-info</command> というコマンドが含まれており、
      <filename>dir</filename>
      ファイルに項目を追加したり削除したりすることができます。
      もし、あなたの port が info 文書をインストー ルするのであれば、
      以下の指示に従ってその port および package
      が正しくユーザの
      <filename><makevar>PREFIX</makevar>/info/dir</filename>
      ファイルを更新するようにしてください
      (このセクションはとても長くてすいません。
      しかし info ファイルを作りあげるためにはこれらは不可欠です。
      正しく行なえば<emphasis>美しい</emphasis>リストができますので、
      辛抱してください!
      <!-- smiley --><emphasis>:-)</emphasis></para>

    <para>まず、これを知っておかなければなりません。</para>

    <screen>&prompt.user; <userinput>install-info --help</userinput>
install-info [OPTION]... [INFO-FILE [DIR-FILE]]
  Install INFO-FILE in the Info directory file DIR-FILE.
  (訳注: Info ディレクトリの INFO-FILE を DIR-FILE にインストールする)
Options:
--delete          Delete existing entries in INFO-FILE;
                    don't insert any new entries.
                  (訳注: INFO-FILE の中の項目を削除、
                   新しい項目は一切追加しない。)
 :
--entry=TEXT      Insert TEXT as an Info directory entry.
                  (訳注: TEXT を Info ディレクトリの項目として追加する。)
 :
--section=SEC     Put this file's entries in section SEC of the directory.
                  (訳注: このファイルの項目を Info ディレクトリの SEC
                   というセクションに置く。)
 :</screen>

    <note>
      <para>このプログラムは、実際には info
	ファイルを<emphasis>インストール</emphasis>しません。
	単に <filename>dir</filename>
	ファイルにエントリを挿入したり削除したりするだけです。</para>
    </note>

    <para>これから、<command>install-info</command>
      を使用するように、ports を変換する 7 段階の工程を示します。
      例として
      <filename role="package">editors/emacs</filename>
      を使用します。</para>

    <procedure>
      <step>
	<para>まず、texinfo のソースを見て、
	  <literal>@dircategory</literal> と
	  <literal>@direntry</literal> 文がないファイルについて、
	  それらを追加するパッチを作成します。以下は、
	  ここでの例での patchの一部です:</para>

	<programlisting>--- ./man/vip.texi.org  Fri Jun 16 15:31:11 1995
+++ ./man/vip.texi      Tue May 20 01:28:33 1997
@@ -2,6 +2,10 @@

 @setfilename ../info/vip
 @settitle VIP
+@dircategory The Emacs editor and associated tools
+@direntry
+* VIP: (vip).          A VI-emulation for Emacs.
+@end direntry

 @iftex
 @finalout
 :</programlisting>

	<para>フォーマットについては見ればわかると思います。
	  <filename>dir</filename>
	  というファイルに必要な項目を書いておいてくれる作者も多いので、
	  まず自分で書く前にさがしてみてください。
	  また、関係する ports も調べて、
	  セクションの名前やインデントなどがきちんと合っているかどうかを確認してください
	  (項目のテキスト は、すべて 4 つめのタブ・ストップ
	  (tab stop) から始めることを推奨します)。</para>

	<note>
	  <para>一つのファイルに対して一つの info
	    の項目しか書けないことに注意してください。これは
	    <command>install-info --delete</command>
	    <!-- kuriyama - not email --> のバグにより
	    <email>@direntry</email>
	    セクションに複数の項目を書いても初めの一つの項目しか削除してくれないからです。</para>
	</note>

	<para>texinfo のソースにパッチを適用する代わりに
	  <literal>dir</literal> の項目を
	  <command>install-info</command> の引数
	  (<option>--section</option>, <option>--entry</option>)
	  として与えることもできますが、あまり良い方法とは言えません。
	  なぜなら同じ情報を三つの場所
	  (<filename>Makefile</filename>,
	  <filename>pkg-plist</filename> の
	  <literal>@exec</literal>/<literal>@unexec</literal>:
	  以下参照)
	  に重複して書く必要があるからです。
	  しかし、日本語 (あるいは、他のマルチバイトエンコーディング) の
	  info ファイルがある場合には
	  <command>install-info</command>
	  の特別な引数を使用する必要があるでしょう。
	  なぜなら <command>makeinfo</command> がこのような
	  texinfo ソースファイルを扱えないからです。
	  (このようなものをどう扱うかの例としては
	  <filename role="package">japanese/skk</filename> の
	  <filename>Makefile</filename> と
	  <filename>pkg-plist</filename> を見てください)。</para>
      </step>

      <step>
	<para>portのディレクトリに戻って
	  <command>make clean; make</command> を実行し、info ファイルが
	  texinfo ソースファイルから再び生成されることを確認してください。
	  texinfo ソースファイルのほうが info ファイルよりも新しいので
	  <command>make</command> と入力すれば
	  info ファイルは再構築されるはずですが、多くの
	  <filename>Makefile</filename>
	  には info ファイルの正しい依存関係が書かれていません。
	  <application>Emacs</application> の場合、
	  info ファイルの再構築の際には
	  <filename>man</filename> サブディレクトリに降りるように
	  メインの <filename>Makefile.in</filename>
	  にパッチを適用する必要がありました。</para>

	<programlisting>--- ./Makefile.in.org   Mon Aug 19 21:12:19 1996
+++ ./Makefile.in       Tue Apr 15 00:15:28 1997
@@ -184,7 +184,7 @@
 # Subdirectories to make recursively.  `lisp' is not included
 # because the compiled lisp files are part of the distribution
 # and you cannot remake them without installing Emacs first.
-SUBDIR = lib-src src
+SUBDIR = lib-src src man

 # The makefiles of the directories in $SUBDIR.
 SUBDIR_MAKEFILES = lib-src/Makefile man/Makefile src/Makefile oldXMenu/Makefile lwlib/Makefile
--- ./man/Makefile.in.org       Thu Jun 27 15:27:19 1996
+++ ./man/Makefile.in   Tue Apr 15 00:29:52 1997
@@ -66,6 +66,7 @@
        ${srcdir}/gnu1.texi \
        ${srcdir}/glossary.texi

+all: info
 info: $(INFO_TARGETS)

 dvi: $(DVI_TARGETS)</programlisting>

	<para>メインの <filename>Makefile</filename> からは、
	  <maketarget>all</maketarget> として呼びたいのですが、
	  <filename>man</filename>
	  サブディレクトリでのデフォルトターゲットは
	  <maketarget>info</maketarget> になっています。
	  このため、二つ目のパッチが必要になります。
	  また、<filename>info</filename> info
	  ファイルのインストールも削除しました。
	  なぜなら、それは同じ名前ですでに
	  <filename>/usr/share/info</filename> にあるからです
	  (そのパッチはここでは示しません)。</para>
      </step>

      <step>
	<para>もし、<filename>Makefile</filename> に
	  <filename>dir</filename>
	  ファイルをインストールする個所があれば削除します。
	  あなたの port がインストールしてはいけません。
	  また、<filename>dir</filename>
	  ファイルを壊してしまうようなコマンドの類も削除します。</para>

	<programlisting>--- ./Makefile.in.org   Mon Aug 19 21:12:19 1996
+++ ./Makefile.in       Mon Apr 14 23:38:07 1997
@@ -368,14 +368,8 @@
        if [ `(cd ${srcdir}/info &amp;&amp; /bin/pwd)` != `(cd ${infodir} &amp;&amp; /bin/pwd)` ]; \
        then \
          (cd ${infodir};  \
-          if [ -f dir ]; then \
-            if [ ! -f dir.old ]; then mv -f dir dir.old; \
-            else mv -f dir dir.bak; fi; \
-          fi; \
           cd ${srcdir}/info ; \
-          (cd $${thisdir}; ${INSTALL_DATA} ${srcdir}/info/dir ${infodir}/dir); \
-          (cd $${thisdir}; chmod a+r ${infodir}/dir); \
           for f in ccmode* cl* dired-x* ediff* emacs* forms* gnus* info* message* mh-e* sc* vip*; do \
             (cd $${thisdir}; \
              ${INSTALL_DATA} ${srcdir}/info/$$f ${infodir}/$$f; \
              chmod a+r ${infodir}/$$f); \</programlisting>
      </step>

      <step>
	<para>(これは、既存のportを修正するときのみ必要です。)
	  <filename>pkg-plist</filename> を見て、
	  <filename>info/dir</filename>
	  にパッチをあてようとするものすべてを削除します。これらは
	  <filename>pkg-install</filename>
	  やその他のファイルにもあるかもしれないので、
	  いろいろさがしてみてください。</para>

	<programlisting>Index: pkg-plist
===================================================================
RCS file: /usr/cvs/ports/editors/emacs/pkg/pkg-plist,v
retrieving revision 1.15
diff -u -r1.15 pkg-plist
--- pkg-plist   1997/03/04 08:04:00     1.15
+++ pkg-plist   1997/04/15 06:32:12
@@ -15,9 +15,6 @@
 man/man1/emacs.1.gz
 man/man1/etags.1.gz
 man/man1/ctags.1.gz
-@unexec cp %D/info/dir %D/info/dir.bak
-info/dir
-@unexec cp %D/info/dir.bak %D/info/dir
 info/cl
 info/cl-1
 info/cl-2</programlisting>
      </step>

      <step>
	<para><maketarget>post-install</maketarget> ターゲットを
	  <filename>Makefile</filename>
	  に加えてインストールされた info ファイルについては、
	  <maketarget>install-info</maketarget>
	  を実行するようします
	  (<filename>dir</filename>
	  ファイルが存在しない場合にそれを作成するようにする必要はなくなりました。
	  <command>install-info</command>
	  はこのファイルが存在しなければ自動的に作成します)。
	</para>

	<programlisting>Index: Makefile
===================================================================
RCS file: /usr/cvs/ports/editors/emacs/Makefile,v
retrieving revision 1.26
diff -u -r1.26 Makefile
--- Makefile    1996/11/19 13:14:40     1.26
+++ Makefile    1997/05/20 10:25:09     1.28
@@ -20,5 +20,11 @@
 post-install:
 .for file in emacs-19.34 emacsclient etags ctags b2m
        strip ${PREFIX}/bin/${file}
 .endfor
+.for info in emacs vip viper forms gnus mh-e cl sc dired-x ediff ccmode
+       install-info ${PREFIX}/info/${info} ${PREFIX}/info/dir
+.endfor

 .include &lt;bsd.port.mk&gt;</programlisting>
      </step>

      <step>
	<para><filename>pkg-plist</filename> を編集して、同じ働きをする
	  <literal>@exec</literal> 文、
	  それに <command>pkg_delete</command> のために
	  <literal>@unexec</literal> 文を加えてください。</para>

	<programlisting>Index: pkg-plist
===================================================================
RCS file: /usr/cvs/ports/editors/emacs/pkg-plist,v
retrieving revision 1.15
diff -u -r1.15 pkg-plist
--- pkg-plist   1997/03/04 08:04:00     1.15
+++ pkg-plist   1997/05/20 10:25:12     1.17
@@ -16,7 +14,14 @@
 man/man1/etags.1.gz
 man/man1/ctags.1.gz
+@unexec install-info --delete %D/info/emacs %D/info/dir
 :
+@unexec install-info --delete %D/info/ccmode %D/info/dir
 info/cl
 info/cl-1
@@ -87,6 +94,18 @@
 info/viper-3
 info/viper-4
+@exec install-info %D/info/emacs %D/info/dir
 :
+@exec install-info %D/info/ccmode %D/info/dir
 libexec/emacs/19.34/i386--freebsd/cvtmail
 libexec/emacs/19.34/i386--freebsd/digest-doc</programlisting>

	<note>
	  <para><literal>@unexec install-info --delete</literal>
	    コマンドは info ファイル自身より先に置き、
	    コマンドがファイルを読めるようにしておかなければならないことに注意してください。
	    また <literal>@exec install-info</literal> コマンドは、
	    info ファイルおよび <filename>dir</filename>
	    ファイルを作る <literal>@exec</literal>
	    コマンドより後におかなければなりません。</para>
	</note>
      </step>

      <step>
	<para><link linkend="porting-testing">テスト</link>
	  をして出来栄えに感服しましょう
	  <!-- smiley --><emphasis>:)</emphasis>
	  各段階の前後に <filename>dir</filename>
	  ファイルをチェックしましょう。</para>
      </step>
    </procedure>
  </chapter>

  <chapter id="pkg-files">
    <title><filename>pkg-<replaceable>*</replaceable></filename> ファイル</title>

    <para><filename>pkg-<replaceable>*</replaceable></filename> ファイルには、
      まだ取り上げていない何かと重宝なトリックがいくつかあります。</para>

    <sect1 id="porting-message">
      <title><filename>pkg-message</filename></title>

      <para>もしインストールする人にメッセージを表示する必要がある場合には、
	そのメッセージを
	<filename>pkg-message</filename> に置くことができます。
	この機能は <command>pkg_add</command>
	の後の追加のインストール手続きを表示するときなどに重宝します。</para>

      <note>
	<para>
	  <filename>pkg-message</filename> ファイルは
	  <filename>pkg-plist</filename> に加える必要はありません。
	  また、もしユーザが package ではなく
	  port を使用している場合には自動的には表示されませんので、
	  明示的に <maketarget>post-install</maketarget>
	  で表示するようにするべきでしょう。</para>
      </note>
    </sect1>

    <sect1 id="pkg-install">
      <title><filename>pkg-install</filename></title>

      <para>バイナリパッケージが <command>pkg_add</command>
	でインストールされるときに実行する必要のあるコマンドがあれば、
	<filename>pkg-install</filename>
	スクリプトを使って実行することができます。
	このスクリプトは自動的に package に加えられ、
	<command>pkg_add</command> によって 2 回実行されます。
	1 回目は
	<literal>&dollar;{SH} pkg-install &dollar;{PKGNAME} PRE-INSTALL</literal>
	として、2 回目には
	<literal>&dollar;{SH} pkg-install &dollar;{PKGNAME} POST-INSTALL</literal>
	として実行されます。
	どちらのモードで実行されているかは
	<literal>&dollar;2</literal> を調べることによってわかります。
	環境変数 <envar>PKG_PREFIX</envar> には
	package がインストールされるディレクトリが設定されます。
	詳細は &man.pkg.add.1; を見てください。</para>

      <note>
	<para>
	  port を <command>make install</command>
	  でインストールするときにはこのスクリプトは自動的に実行されません。
	  もし実行される必要があるならば port の Makefile
	  から明示的に呼ぶ必要があります。
	</para>
      </note>
    </sect1>

    <sect1 id="pkg-req">
      <title><filename>pkg-req</filename></title>

      <para>(訳注: 実行されるマシンの状態に応じて) その port
	をインストールするべきか、そうでないかを判断する必要があるときには、
	<quote>要件 (requirements)</quote> スクリプト
	<filename>pkg-req</filename> を作ることができます。
	インストールや削除を実行すべきかどうか判断するために、
	このスクリプトがインストールや削除を実行する際に自動的に実行されます。</para>

      <para>このスクリプトはインストール時には <command>pkg_add</command> により
	<literal>pkg-req &dollar;{PKGNAME} INSTALL</literal> として実行され、
	削除時には <command>pkg_delete</command> により
	<literal>pkg-req &dollar;{PKGNAME} DEINSTALL</literal> として
	実行されます。</para>
    </sect1>

    <sect1 id="porting-plist">
      <title>make の変数にあわせた
	<filename>pkg-plist</filename> の変更</title>

      <para>いくつかの port、特に p5-ports などは configure のオプション
	(あるいは、p5-ports の場合は perl のバージョン)	によって
	<filename>pkg-plist</filename> を変える必要があります。
	これを容易に実現するために
	<filename>pkg-plist</filename> 中の
	<literal>%%OSREL%%</literal>,
	<literal>%%PERL_VER%%</literal>,
	<literal>%%PERL_VERSION%%</literal>
	は適切に置き換えられるようになっています。
	<literal>%%OSREL%%</literal>
	の値はオペレーティングシステムの数字で表されたリビジョンです
	(たとえば <literal>2.2.7</literal>)。
	<literal>%%PERL_VERSION%%</literal> は perl
	のバージョン番号全体
	(たとえば <literal>5.00502</literal>)
	で、<literal>%%PERL_VER%%</literal>
	はバージョン番号からパッチレベルを引いたものです
	(たとえば <literal>5.005</literal>)。</para>

      <para>他の置き換えが必要であれば、<makevar>PLIST_SUB</makevar>
	変数に
	<literal><replaceable>VAR</replaceable>=<replaceable>VALUE</replaceable></literal>
	という形式のペアのリストを設定することによって、
	<filename>pkg-plist</filename> 中の
	<literal>%%<replaceable>VAR</replaceable>%%</literal> は
	<replaceable>VALUE</replaceable> に置き換えられます。
	たとえばバージョンに固有のたくさんのファイルをインストールする場合には、
	<filename>Makefile</filename> に</para>
      <!-- kuriyama - Eng ver has unneeded quote above -->

      <programlisting>OCTAVE_VERSION= 2.0.13
PLIST_SUB=      OCTAVE_VERSION=${OCTAVE_VERSION}</programlisting>

      <para>と書いて、<filename>PLIST</filename>
	中のバージョン番号が表われるすべてのところに、
	<literal>%%OCTAVE_VERSION%%</literal> と書きます。
	このようにしておけば、port をアップグレードするときに、
	何十行 (時として、何百行) も
	<filename>pkg-plist</filename>
	を書き替えないですみます。</para>

      <para>この書き換えは
	(<link linkend="porting-manpages">マニュアル</link>の追加も)
	<maketarget>do-install</maketarget> と
	<maketarget>post-install</maketarget> ターゲットの間に
	<makevar>pkg-plist</makevar> を読み
	<makevar>TMPPLIST</makevar>
	(デフォルトは
	<filename><makevar>WRKDIR</makevar>/.PLIST.mktmp</filename>)
	に書き込むことによって行なわれます。
	もし、あなたの port が
	<makevar>PLIST</makevar> を実行時に生成するのであれば、
	<maketarget>do-install</maketarget>
	の間かその前に行なうようにしてください。
	また、書きかえられたあとのファイルを編集する必要がある場合には、
	<maketarget>post-install</maketarget>
	で <makevar>TMPPLIST</makevar> を書きかえてください。</para>
    </sect1>

    <sect1 id="pkg-names">
      <title id="porting-pkgfiles"><filename>pkg-<replaceable>*</replaceable></filename>
	ファイルの名前変更</title>

      <para><filename>pkg-<replaceable>*</replaceable></filename>
	ファイルの名前はすべて変数を使用して定義されていますので、
	必要であれば
	<filename>Makefile</filename> 中で変更可能です。
	いくつかの ports で一つの
	<filename>pkg-<replaceable>*</replaceable></filename>
	ファイルを共有する場合や、
	上記のファイルに書き込みをしなければならないときなど特に便利です
	(<filename>pkg-<replaceable>*</replaceable></filename>
	サブディレクトリに直接書き込むのが良くない理由については
	<link linkend="porting-wrkdir"><makevar>WRKDIR</makevar>
	以外への書きこみ</link> を参照してください)。</para>

      <para>以下に変数名と そのデフォルト値のリストを示します。
	(<makevar>PKGDIR</makevar> のデフォルト値は
	<makevar>${MASTERDIR}</makevar> になっています。)</para>

      <informaltable frame="none">
	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>変数名</entry>
	      <entry>デフォルト値</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><makevar>DESCR</makevar></entry>
	      <entry><literal>${PKGDIR}/pkg-descr</literal></entry>
	    </row>

	    <row>
	      <entry><makevar>PLIST</makevar></entry>
	      <entry><literal>${PKGDIR}/pkg-plist</literal></entry>
	    </row>

	    <row>
	      <entry><makevar>PKGINSTALL</makevar></entry>
	      <entry><literal>${PKGDIR}/pkg-install</literal></entry>
	    </row>

	    <row>
	      <entry><makevar>PKGDEINSTALL</makevar></entry>
	      <entry><literal>${PKGDIR}/pkg-deinstall</literal></entry>
	    </row>

	    <row>
	      <entry><makevar>PKGREQ</makevar></entry>
	      <entry><literal>${PKGDIR}/pkg-req</literal></entry>
	    </row>

	    <row>
	      <entry><makevar>PKGMESSAGE</makevar></entry>
	      <entry><literal>${PKGDIR}/pkg-message</literal></entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>

      <para><makevar>PKG_ARGS</makevar>
	を上書きせずにこれらの変数を変更するようにしてください。
	<makevar>PKG_ARGS</makevar>
	を変更すると、これらのファイルは port から正しく
	<filename>/var/db/pkg</filename>
	にインストールされなくなります。</para>
    </sect1>
  </chapter>

  <chapter id="testing">
    <title>port のテスト</title>

    <sect1 id="testing-portlint">
      <title>portlint</title>

      <para>送付や commit をする前に
	<link linkend="porting-portlint"><command>portlint</command></link>
	を使ってチェックしましょう。</para>
    </sect1>

    <sect1 id="porting-prefix">
      <title><makevar>PREFIX</makevar></title>

      <para>なるべく port は <makevar>PREFIX</makevar>
	に対する相対パスにインストールすることができるように心がけてください
	(この変数の値は
	<makevar>USE_X_PREFIX</makevar> か
	<makevar>USE_IMAKE</makevar> が指定してある時には
	<makevar>X11BASE</makevar>
	(デフォルトは <filename>/usr/X11R6</filename>)、
	そうでない場合には<makevar>LOCALBASE</makevar>
	(デフォルトは <filename>/usr/local</filename>)
	にセットされます)。</para>

      <para>サイトによってフリーソフトウェアがインストールされる場所が違いますので、
	ソース内で
	<filename>/usr/local</filename> や
	<filename>/usr/X11R6</filename>
	を明示的に書かないようにしてください。
	X のプログラムで
	<command>imake</command> を使うものについては、
	<!-- kuriyama - imake is command -->
	これは問題にはなりません。
	それ以外の場合にはソース中の Makefile やスクリプトで
	<filename>/usr/local</filename>
	(imake を使わない X のプログラムは <filename>/usr/X11R6</filename>)
	と書いてあるところを
	<makevar>PREFIX</makevar> に書き換えてください。
	この値は port のコンパイルおよび、
	インストール時に自動的に環境変数として下位 make に渡されます。</para>

      <para>そのアプリケーションが <makevar>PREFIX</makevar> を
	使用しないで、何かを直接 <filename>/usr/local</filename> に
	インストールしないことを確認してください。
	以下のようにすると、簡単なテストを行なうことができます:</para>

	<screen>&prompt.root; <userinput>make clean; make package PREFIX=/var/tmp/<replaceable>port-name</replaceable></userinput></screen>

      <para>この時、もし <makevar>PREFIX</makevar> の外に
	何かがインストールされていた場合、package 生成プロセスは
	ファイルが見つからないと文句を言うはずです。</para>

      <!-- XXX This paragraph is confusing and poorly indented. -->
      <para>ただし、これは そのソフトウェアが内部で決め打ちの参照を
	していないかどうか だとか、他の port によってインストールされる
	ファイルを参照する際に <makevar>LOCALBASE</makevar> を
	正しく使用しているかどうかをテストしているわけではありません。
	その port を他の場所にインストールした状態で、
	<filename>/var/tmp/<replaceable>port-name</replaceable></filename> に
	対するインストールを試みることにより、
	そのテストをすることができるでしょう。</para>

      <para><makevar>USE_X_PREFIX</makevar> は本当に必要な時 (つまり
	X のライブラリをリンクしたり、<makevar>X11BASE</makevar> 以下にある
	ファイルを参照したりする必要がある時) 以外には
	設定しないでください。</para>

      <para>変数 <makevar>PREFIX</makevar> の値は
	port の Makefile やユーザの環境で変更することもできます。
	しかし、個々の port が Makefile
	でこの変数の値を明示的に設定することはなるべくしないでください。</para>

      <para>また、他の port によりインストールされるプログラムや
	ファイルを指定する場合には、直接的なパス名を使用するのではなく
	上で述べた変数を使用してください。
	たとえば <command>less</command> のフルパスを
	<literal>PAGER</literal> というマクロに入れたい場合は、
	<literal>-DPAGER=\"/usr/local/bin/less\"</literal>
	というフラグをコンパイラに渡すかわりに
	<programlisting>-DPAGER=\"&dollar;{PREFIX}/bin/less\"</programlisting>
	(X Window System を使う port の場合には
	<programlisting>-DPAGER=\"&dollar;{LOCALBASE}/bin/less\"</programlisting>)
	を渡してください。
	こうしておけば、システム管理者が <quote>/usr/local</quote> を
	まるごと どこか他の場所に移していたとしても、その port が
	そのまま使える可能性が高くなります。</para>
    </sect1>

    <sect1 id="testing-freshports">
      <title>FreshPorts 正当性テスト</title>

      <para><ulink url="http://www.FreshPorts.org/">FreshPorts</ulink>
	には、FreeBSD ports へ commit されたものについて、
	自動的に正当性テストを行う仕組みがあります。
	このサービスに登録すると、あなたが commit したものについて、
	正当性テストでエラーが起きると連絡が行きます。</para>

      <para>このサービスを利用したい場合、必要なのは FreshPorts
	のアカウントだけです。登録したメールアドレスが @FreeBSD.org
	のものであれば、
	ウェブページの右側にサービスを選択するリンクがあるはずです。
	FreshPorts にアカウントを持っていても @FreeBSD.org
	のメールアドレスを利用していない場合、メールアドレスを
	@FreeBSD.org に変え、登録したあとで、
	メールアドレスをまた変更してください。</para>
    </sect1>
  </chapter>

  <chapter id="port-upgrading">
    <title>アップグレード</title>

    <para>port のバージョンが原作者からのものに比べて古いことに気がついたら、
      まずはあなたの持っている port が私たちの最新のもの
      (FTP ミラーサイトの <filename>ports/ports-current</filename>
      というディレクトリにあります)
      であることを確認してください。
      また、Ports Collection 全体を最新の状態に保つために
      <application>CVSup</application> を利用することもできます。
      詳しくは
      <ulink url="../handbook/synching.html#CVSUP-CONFIG">FreeBSD
	ハンドブック</ulink>をご覧ください。</para>

    <para>次に port の
      <filename>Makefile</filename> に
      <makevar>MAINTAINER</makevar> (保守担当者)
      のアドレスが書いてある場合には、その人にメールを出してみましょう。
      保守担当者の人がすでにアップグレードの準備をしているかも知れませんし、
      (新しいバージョンの安定度に問題があるなど)
      あえてアップグレードをしない理由があるのかも知れません。</para>

    <para>保守担当者にアップグレードをしてくれと頼まれた場合、
      あるいは、そもそも port の Makefile に保守担当者が書いてない場合などは、
      あなたがアップグレードをしてくださると助かります。
      その場合にはアッ プグレードをした後、
      変更前と変更後のディレクトリの再帰的 diff
      (unified diff と context diff のどちらでもいいのですが、
      port のコミッター達は unified diff の方を好むようです)
      をとって送ってください
      (たとえば変更前のディレクトリが
      <filename>superedit.bak</filename>
      という名前でとってあり、変更後のものが
      <filename>superedit</filename>
      に入っているなら、
      <command>diff -ruN superedit.bak superedit</command>
      の結果を送ってください)。
      diff の出力を見て、
      すべての変更が正しくなされているか確認してください。
      変更箇所については、&man.send-pr.1;
      (カテゴリは <literal>ports</literal>)
      に diff の出力結果を添えて、わたしたちに送ってもらうのが一番良いです。
      commit する際に CVS に明確に記述しなければならないので、
      あなたがその port のメンテナなら、概要 (synopsis) 行の先頭に
      <literal>[maintainer update]</literal>
      と記入し、PR の <quote>Class</quote> を
      <literal>maintainer-update</literal> にしてください。
      付け加えたり削除したりしたファイルがあればそれについて書いておいてください。
      もし diff の大きさが 20 KB 程度を超えるようであれば、
      圧縮したものを uuencode してください。
      そうでなければそのまま PR に入れるだけで構いません。</para>

      <important>
	<para>更新の動機が、セキュリティ上の問題や、
	  現在 commit されている port に重大な欠陥である場合は、
	  &a.portmgr; に連絡して、あなたの port
	  のパッケージをただちに作りなおして再配布するように要求してください。
	  そうしないと、無防備な &man.pkg.add.1;
	  のユーザたちが、何週間にもわたって <command>pkg_add -r</command>
	  で古いバージョンをインストールし続けてしまいます。</para>
      </important>

    <note>
      <para>繰り返しになりますが、既存の ports の変更を送るときには
	  &man.shar.1; ではなく &man.diff.1; を使用してください!</para>
    </note>
  </chapter>

  <chapter id="porting-dads">
    <title>やっていいことといけないこと</title>

    <para>このセクションではソフトウェアを port する上で、
      良くある落し穴などについて説明します。
      このリストを使ってあなた自身が作成した port のチェックはもとより、
      PR データベースにある、
      他の人が作成した port のチェックもできます。
      あなたがチェックした port についてのコメントを<ulink
      url="../../articles/contributing/contrib-how.html#CONTRIB-GENERAL">
      バグ報告と一般的な論評</ulink>にしたがって送ってください。
      PR データベースにある port をチェックすることは、
      わたしたちがそれらを commit するのを早めるとともに、
      何をしているかをあなたが理解していることも証明します。</para>
    <!-- 2000/07/16:hrs strange translation -->

    <sect1 id="dads-strip">
      <title>バイナリの strip</title>

      <para>バイナリは特に必要がなければ、手動で strip しないでください。
	すべてのバイナリは strip すべきですが、
	<maketarget>INSTALL_PROGRAM</maketarget>
	マクロがバイナリのインストールと strip を同時に行います
	(次節をご覧ください)。</para>

      <para>ファイルを strip する必要はあるものの
	<makevar>INSTALL_PROGRAM</makevar> マクロを使いたくない場合は、
	<makevar>${STRIP_CMD}</makevar> でプログラムを strip できます。
	これは、多くの場合 <literal>post-install</literal>
	ターゲット内で行われます。たとえば</para>

      <programlisting>post-install:
	${STRIP_CMD} ${PREFIX}/bin/xdl</programlisting>

      <para>インストールされた実行形式がすでに strip
	されているかどうかは <command>file</command>
	コマンドで確認できます。
	<quote>not stripped</quote>
	と表示されなければ strip されていることを示しています。
	さらに、&man.strip.1; はすでに strip されたプログラムは
	strip せず、問題なく終了します。</para>
    </sect1>

    <sect1 id="dads-install">
      <title><makevar>INSTALL_*</makevar> マクロ</title>

      <para>あなた自身の <maketarget>*-install</maketarget>
	ターゲットでファイルの正しいモードとオーナを保証するために、
	必ず
	<filename>bsd.port.mk</filename>
	で提供されているマクロを使用してください。</para>

      <itemizedlist>
	<listitem>
	  <para><makevar>${INSTALL_PROGRAM}</makevar>
	    は実行可能なバイナリをインストール
	    (し、その過程で strip 処理)するコマンドです。</para>
	</listitem>

	<listitem>
	  <para><makevar>${INSTALL_SCRIPT}</makevar>
	    は実行可能なスクリプトをインストールするコマンドです。</para>
	</listitem>

	<listitem>
	  <para><makevar>${INSTALL_DATA}</makevar>
	    は共有可能なデータをインストールするコマンドです。</para>
	</listitem>

	<listitem>
	  <para><makevar>${INSTALL_MAN}</makevar>
	    はマニュアルとその他の文書をインストールするコマンドです
	    (圧縮はしません)。</para>
	</listitem>
      </itemizedlist>

      <para>これらは基本的に <command>install</command>
	コマンドに適切なフラグを与えたものです。
	それらは distfile の <filename>Makefile</filename>
	で、頭に <quote>BSD_</quote> が付けられた
	(つまり BSD_INSTALL_PROGRM というような)
	形で使うことができます。
	どのようにこれらを使用するかは以下の例を見てください。
      </para>
    </sect1>

    <sect1 id="porting-wrkdir">
      <title><makevar>WRKDIR</makevar></title>

      <para><makevar>WRKDIR</makevar>
	の外に存在するファイルには何も書き込んではいけません。
	port のビルド中に書き込み可能なことが保証されているのは
	<makevar>WRKDIR</makevar> の中だけです
	(書き込み不可のツリー上での port ビルドの例については、
	<ulink url="../handbook/ports-using.html#PORTS-CD">CDROM からの
	ports のコンパイル</ulink> を参照のこと)。
	<filename>pkg-<replaceable>*</replaceable></filename>
	ファイルを変更する必要があるときには、
	ファイルを上書きするのではなく
	<link linkend="porting-pkgfiles">変数の再定義</link>により
	行なうようにしてください。</para>
    </sect1>

    <sect1 id="porting-wrkdirprefix">
      <title><makevar>WRKDIRPREFIX</makevar></title>

      <para><makevar>WRKDIRPREFIX</makevar>
	を尊重していることを確認してください。特に、別の port の
	<makevar>WRKDIR</makevar> を参照しているときには気を付けてください。
	正しい場所は、
	<filename><makevar>WRKDIRPREFIX</makevar><makevar>PORTSDIR</makevar>/<replaceable>subdir</replaceable>/<replaceable>name</replaceable>/work</filename>
	です。
	<filename><makevar>PORTSDIR</makevar>/<replaceable>subdir</replaceable>/<replaceable>name</replaceable>/work</filename>
	や
	<filename><makevar>.CURDIR</makevar>/../../<replaceable>subdir</replaceable>/<replaceable>name</replaceable>/work</filename>
	ではありません。</para>

      <para>また、
	自分で <makevar>WRKDIR</makevar> 定義するときには先頭に
	<literal>&dollar;{WRKDIRPREFIX}&dollar;{.CURDIR}</literal>
	が付いていることを確認してください。</para>
    </sect1>

    <sect1 id="porting-versions">
      <title>OS の種類やバージョンの識別</title>

      <para>どのバージョンの Unix で動かすかによって、
	変更や条件つきコンパイルが必要なコードに出くわすこともあるでしょう。
	そのような変更を行なう場合には、
	FreeBSD 1.x システムへのバックポートや、
	CSRG の 4.4BSD, BSD/386, 386BSD, NetBSD, OpenBSD 等、
	他の BSD システムへの移植が可能なように、
	できるだけ汎用的な変更を行なうことを心がけてください。</para>

      <para>4.3BSD/Reno (1990) と、それより新しいバージョンの
	BSD コードを区別するには、
	<filename>&lt;sys/param.h&gt;</filename> で定義されている
	<literal>BSD</literal> マクロを利用するのがよいでしょう。
	このファイルがすでにインクルードされていれば良いのですが、
	そうでない場合には、その <filename>.c</filename> ファイルの
	適当な場所に以下のコードを追加してください。</para>

      <programlisting>#if (defined(__unix__) || defined(unix)) &amp;&amp; !defined(USG)
#include &lt;sys/param.h&gt;
#endif</programlisting>

      <para>これらの二つのシンボルが定義されているシステムには必ず
	<filename>sys/param.h</filename> があるはずです。
	もしそうでないシステムを発見したら、
	&a.ports; までメールを送ってわたしたちに伝えてください。</para>

      <para>あるいは、GNU Autoconf のスタイルを使用することもできます。</para>

      <programlisting>#ifdef HAVE_SYS_PARAM_H
#include &lt;sys/param.h&gt;
#endif</programlisting>

      <para>この方法を使用するときには、
	<filename>Makefile</filename> 中の
	<makevar>CFLAGS</makevar>に
	<literal>-DHAVE_SYS_PARAM_H</literal>
	を加えることを忘れないようにしてください。</para>

      <para>いったん <filename>sys/param.h</filename>
	がインクルードされると、</para>

      <programlisting>#if (defined(BSD) &amp;&amp; (BSD &gt;= 199103))</programlisting>

      <para>このようにしてそのコードが 4.3 Net2 コードベース、
	またはそれより新しいもの
	(例: FreeBSD 1.x, 4.3/Reno, NetBSD 0.9, 386BSD, BSD/386 1.1 とそれ以前)
	の上でコンパイルされているかを検出できます。</para>

      <programlisting>#if (defined(BSD) &amp;&amp; (BSD &gt;= 199306))</programlisting>

      <para>これは、4.4コードベース、またはそれより新しいもの
	(例: FreeBSD 2.x, 4.4, NetBSD 1.0, BSD/386 2.0 とそれ以後)
	の上でコンパイルされているかどうかを検出するために使用します。</para>

      <para>4.4BSD-Lite2 コードベースでは
	<literal>BSD</literal> マクロの値は
	<literal>199506</literal> になっています。
	これは参考程度の意味合いしかありません。
	4.4-Lite ベースの FreeBSD と 4.4-Lite2
	での変更がマージされたバージョンとを区別するのに使用するべきものではありません。
	この目的のためにはかわりに
	<literal>__FreeBSD__</literal>
	マクロを使用してください。</para>

      <para>以下は控え目に使ってください。</para>

      <itemizedlist>
	<listitem>
	  <para><literal>__FreeBSD__</literal>
	    はFreeBSDのすべての版で定義されています。
	    変更が FreeBSD だけに適用されるとき以外は使用しないでください。
	    port でよくある
	    <function>strerror()</function> ではなく
	    <literal>sys_errlist[]</literal> を使うなどは
	    FreeBSDでの変更ではなく BSD の流儀です。</para>
	</listitem>

	<listitem>
	  <para>FreeBSD 2.xでは <literal>__FreeBSD__</literal> が
	    <literal>2</literal> と定義されています。
	    それ以前の版では <literal>1</literal> になっています。
	    その後の版ではそのメジャー番号に合うように上がっていきます。</para>
	</listitem>

	<listitem>
	  <para>もし FreeBSD 1.x システムと FreeBSD 2.x、
	    あるいは FreeBSD 3.x システムを区別する必要があれば、
	    上で述べた <literal>BSD</literal>
	    マクロを使用するのが大抵の場合において正しい答です。
	    もし FreeBSD 特有の変更であれば
	    (<command>ld</command> を使うときの共有ライブラリ用のオプションなど)、
	    <!-- kuriyama - strange translation -->
	    <literal>__FreeBSD__</literal>を使い
	    <literal>#if __FreeBSD__ &gt; 1</literal>
	    のようにFreeBSD 2.x および、
	    それ以降のシステムを検出するのはかまいません。
	    もし 2.0-RELEASE 以降の FreeBSD システムを細かく検出したければ、
	    以下を使用することができます。</para>

	  <programlisting>#if __FreeBSD__ &gt;= 2
#include &lt;osreldate.h&gt;
#    if __FreeBSD_version &gt;= 199504
         /* 2.0.5+ release specific code here */
#    endif
#endif</programlisting>
	</listitem>
      </itemizedlist>

      <para>これまで、何百もの port が作られてきましたが、
	<literal>__FreeBSD__</literal>
	が正しく使われたのは一つか二つの場合だけでしょう。
	以前の port が間違ってふさわしくない場所で
	そのマクロを使っているからといって、
	それをまねする理由はありません。</para>
    </sect1>

    <sect1 id="freebsd-versions">
      <title>__FreeBSD_version の値</title>

      <informaltable frame="none">
	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>Release</entry>
	      <entry><literal>__FreeBSD_version</literal></entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry>2.0-RELEASE</entry>
	      <entry>119411</entry>
	    </row>

	    <row>
	      <entry>2.1-CURRENT</entry>
	      <entry>199501, 199503</entry>
	    </row>

	    <row>
	      <entry>2.0.5-RELEASE</entry>
	      <entry>199504</entry>
	    </row>

	    <row>
	      <entry>2.1 以前の 2.2-CURRENT</entry>
	      <entry>199508</entry>
	    </row>

	    <row>
	      <entry>2.1.0-RELEASE</entry>
	      <entry>199511</entry>
	    </row>

	    <row>
	      <entry>2.1.5 以前の 2.2-CURRENT</entry>
	      <entry>199512</entry>
	    </row>

	    <row>
	      <entry>2.1.5-RELEASE</entry>
	      <entry>199607</entry>
	    </row>

	    <row>
	      <entry>2.1.6 以前の 2.2-CURRENT</entry>
	      <entry>199608</entry>
	    </row>

	    <row>
	      <entry>2.1.6-RELEASE</entry>
	      <entry>199612</entry>
	    </row>

	    <row>
	      <entry>2.1.7-RELEASE</entry>
	      <entry>199612</entry>
	    </row>

	    <row>
	      <entry>2.2-RELEASE</entry>
	      <entry>220000</entry>
	    </row>

	    <row>
	      <entry>2.2.1-RELEASE</entry>
	      <entry>220000 (変更なし)</entry>
	    </row>

	    <row>
	      <entry>2.2.1-RELEASE 以降の 2.2-STABLE</entry>
	      <entry>220000 (変更なし)</entry>
	    </row>

	    <row>
	      <entry>texinfo-3.9 以降の 2.2-STABLE</entry>
	      <entry>221001</entry>
	    </row>

	    <row>
	      <entry>top 導入以降の 2.2-STABLE</entry>
	      <entry>221002</entry>
	    </row>

	    <row>
	      <entry>2.2.2-RELEASE</entry>
	      <entry>222000</entry>
	    </row>

	    <row>
	      <entry>2.2.2-RELEASE 以降の 2.2-STABLE</entry>
	      <entry>222001</entry>
	    </row>

	    <row>
	      <entry>2.2.5-RELEASE</entry>
	      <entry>225000</entry>
	    </row>

	    <row>
	      <entry>2.2.5-RELEASE 以降の 2.2-STABLE</entry>
	      <entry>225001</entry>
	    </row>

	    <row>
	      <entry>ldconfig -R マージ以降の 2.2-STABLE</entry>
	      <entry>225002</entry>
	    </row>

	    <row>
	      <entry>2.2.6-RELEASE</entry>
	      <entry>226000</entry>
	    </row>

	    <row>
	      <entry>2.2.7-RELEASE</entry>
	      <entry>227000</entry>
	    </row>

	    <row>
	      <entry>2.2.7-RELEASE 以降の 2.2-STABLE</entry>
	      <entry>227001</entry>
	    </row>

	    <row>
	      <entry>&man.semctl.2; 変更以降の 2.2-STABLE</entry>
	      <entry>227002</entry>
	    </row>

	    <row>
	      <entry>2.2.8-RELEASE</entry>
	      <entry>228000</entry>
	    </row>

	    <row>
	      <entry>2.2.8-RELEASE 以降の 2.2-STABLE</entry>
	      <entry>228001</entry>
	    </row>

	    <row>
	      <entry>&man.mount.2; 変更以前の 3.0-CURRENT</entry>
	      <entry>300000</entry>
	    </row>

	    <row>
	      <entry>&man.mount.2; 変更以降の 3.0-CURRENT</entry>
	      <entry>300001</entry>
	    </row>

	    <row>
	      <entry>&man.semctl.2; 変更以降の 3.0-CURRENT</entry>
	      <entry>300002</entry>
	    </row>

	    <row>
	      <entry>ioctl 引数変更以降の 3.0-CURRENT</entry>
	      <entry>300003</entry>
	    </row>

	    <row>
	      <entry>ELF 化以降の 3.0-CURRENT</entry>
	      <entry>300004</entry>
	    </row>

	    <row>
	      <entry>3.0-RELEASE</entry>
	      <entry>300005</entry>
	    </row>

	    <row>
	      <entry>3.0-RELEASE 以降の 3.0-CURRENT</entry>
	      <entry>300006</entry>
	    </row>

	    <row>
	      <entry>3/4 の分岐以降の 3.0-STABLE</entry>
	      <entry>300007</entry>
	    </row>

	    <row>
	      <entry>3.1-RELEASE</entry>
	      <entry>310000</entry>
	    </row>

	    <row>
	      <entry>3.1-RELEASE 以降の 3.1-STABLE</entry>
	      <entry>310001</entry>
	    </row>

	    <row>
	      <entry>C++ コンストラクタ/デストラクタ順序変更の後の
		3.1-STABLE</entry>
	      <entry>310002</entry>
	    </row>

	    <row>
	      <entry>3.2-RELEASE</entry>
	      <entry>320000</entry>
	    </row>

	    <row>
	      <entry>3.2-STABLE</entry>
	      <entry>320001</entry>
	    </row>

	    <row>
	      <entry>バイナリ互換性のない IPFW とソケットの変更後の
		3.2-STABLE</entry>
	      <entry>320002</entry>
	    </row>

	    <row>
	      <entry>3.3-RELEASE</entry>
	      <entry>330000</entry>
	    </row>

	    <row>
	      <entry>3.3-STABLE</entry>
	      <entry>330001</entry>
	    </row>

	    <row>
	      <entry>libc に &man.mkstemp.3; が追加された後の 3.3-STABLE</entry>
	      <entry>330002</entry>
	    </row>

	    <row>
	      <entry>3.4-RELEASE</entry>
	      <entry>340000</entry>
	    </row>

	    <row>
	      <entry>3.4-STABLE</entry>
	      <entry>340001</entry>
	    </row>

	    <row>
	      <entry>3.5-RELEASE</entry>
	      <entry>350000</entry>
	    </row>

	    <row>
	      <entry>3.5-STABLE</entry>
	      <entry>350001</entry>
	    </row>

	    <row>
	      <entry>3.4 が分岐した後の 4.0-CURRENT</entry>
	      <entry>400000</entry>
	    </row>

	    <row>
	      <entry>dynamic linker の変更後の 4.0-CURRENT</entry>
	      <entry>400001</entry>
	    </row>

	    <row>
	      <entry>C++ コンストラクタ/デストラクタ順序変更の後の
		4.0-CURRENT</entry>
	      <entry>400002</entry>
	    </row>

	    <row>
	      <entry>&man.dladdr.3; 機能追加後の 4.0-CURRENT</entry>
	      <entry>400003</entry>
	    </row>

	    <row>
	      <entry>__deregister_frame_info dynamic linker のバグ修正、
		EGCS 1.1.2 導入後の 4.0-CURRENT</entry>
	      <entry>400004</entry>
	    </row>

	    <row>
	      <entry>&man.suser.9; の API 変更、newbus 化
		以降の 4.0-CURRENT</entry>
	      <entry>400005</entry>
	    </row>

	    <row>
	      <entry>cdevsw 登録方法の変更後の 4.0-CURRENT</entry>
	      <entry>400006</entry>
	    </row>

	    <row>
	      <entry>ソケットレベルの証明書 (credential) のために
		so_cred が追加された後の 4.0-CURRENT</entry>
	      <entry>400007</entry>
	    </row>

	    <row>
	      <entry>libc_r への poll syscall ラッパー追加後の
		4.0-CURRENT</entry>
	      <entry>400008</entry>
	    </row>

	    <row>
	      <entry>kernel の <literal>dev_t</literal> 型から
		<literal>struct spacinfo</literal> ポインタへの
		変更後の 4.0-CURRENT</entry>
	      <entry>400009</entry>
	    </row>

	    <row>
	      <entry>&man.jail.2; のセキュリティホール
		修正後の 4.0-CURRENT </entry>
	      <entry>400010</entry>
	    </row>

	    <row>
	      <entry><literal>sigset_t</literal> の
		データ型変更後の 4.0-CURRENT</entry>
	      <entry>400011</entry>
	    </row>

	    <row>
	      <entry>システムコンパイラを gcc 2.95.2 にアップグレードした
		後の 4.0-CURRENT</entry>
	      <entry>400012</entry>
	    </row>

	    <row>
	      <entry>動的組み込み可能な Linux モードの ioctl ハンドラが
		追加された後の 4.0-CURRENT</entry>
	      <entry>400013</entry>
	    </row>

	    <row>
	      <entry>OpenSSL 導入後の 4.0-CURRENT</entry>
	      <entry>400014</entry>
	    </row>

	    <row>
	      <entry>GCC 2.95.2 の C++ ABI 変更で、
		デフォルトを -fvtable-thunks から -fno-vtable-thunks に
		変更した後の 4.0-CURRENT</entry>
	      <entry>400015</entry>
	    </row>

	    <row>
	      <entry>OpenSSH 導入後の 4.0-CURRENT</entry>
	      <entry>400016</entry>
	    </row>

	    <row>
	      <entry>4.0-RELEASE</entry>
	      <entry>400017</entry>
	    </row>

	    <row>
	      <entry>4.0-RELEASE 以降の 4.0-STABLE</entry>
	      <entry>400018</entry>
	    </row>

	    <row>
	      <entry>チェックサム計算タイミングの変更後の 4.0-STABLE</entry>
	      <entry>400019</entry>
	    </row>

	    <row>
	      <entry>libxpg4 が libc にマージされた後の
		4.0-STABLE</entry>
	      <entry>400020</entry>
	    </row>

	    <row>
	      <entry>Binutils を 2.10.0 にアップグレードし、
		ELF バイナリのマーク付け (branding) 方法を変更し、
		tcsh をベースシステムに導入した後の
		4.0-STABLE</entry>
	      <entry>400021</entry>
	    </row>

	    <row>
	      <entry>4.1-RELEASE</entry>
	      <entry>410000</entry>
	    </row>

	    <row>
	      <entry>4.1-RELEASE 以降の 4.1-STABLE</entry>
	      <entry>410001</entry>
	    </row>

	    <row>
	      <entry>&man.setproctitle.3; が libutil から libc に
		移動した後の 4.1-STABLE</entry>
	      <entry>410002</entry>
	    </row>

	    <row>
	      <entry>4.1.1-RELEASE</entry>
	      <entry>411000</entry>
	    </row>

	    <row>
	      <entry>4.1.1-RELEASE 以降の 4.1.1-STABLE</entry>
	      <entry>411001</entry>
	    </row>

	    <row>
	      <entry>4.2-RELEASE</entry>
	      <entry>420000</entry>
	    </row>

	    <row>
	      <entry>libgcc.a と libgcc_r.a の結合および、関連する
		GCC linkage 変更が行なわれた後の 4.2-STABLE</entry>
	      <entry>420001</entry>
	    </row>

	    <row>
	      <entry>4.3-RELEASE</entry>
	      <entry>430000</entry>
	    </row>

	    <row>
	      <entry>wint_t 導入後の 4.3-STABLE</entry>
	      <entry>430001</entry>
	    </row>

	    <row>
	      <entry>PCI パワーステート API マージ後の 4.3-STABLE</entry>
	      <entry>430002</entry>
	    </row>

	    <row>
	      <entry>4.4-RELEASE</entry>
	      <entry>440000</entry>
	    </row>

	    <row>
	      <entry>d_thread_t 導入後の 4.4-STABLE</entry>
	      <entry>440001</entry>
	    </row>

	    <row>
	      <entry>マウント構造変更 (ファイルシステム kld に影響あり)
		後の 4.4-STABLE</entry>
	      <entry>440002</entry>
	    </row>

	    <row>
	      <entry>smbfs のユーザランド部が取り込まれた後の
		4.4-STABLE</entry>
	      <entry>440003</entry>
	    </row>

	    <row>
	      <entry>4.5-RELEASE</entry>
	      <entry>450000</entry>
	    </row>

	    <row>
	      <entry>usb の構成要素の名称が変更された後の 4.5-STABLE</entry>
	      <entry>450001</entry>
	    </row>

	    <row>
	      <entry>&man.rc.conf.5; の
		<literal>sendmail_enable</literal> 変数が
		<literal>NONE</literal> という値をとれるようになった後の
		4.5-STABLE</entry>
	      <entry>450004</entry>
	    </row>

	    <row>
	      <entry>package 作成のデフォルトを XFree86 4
		に移行した後の 4.5-STABLE</entry>
	      <entry>450005</entry>
	    </row>

	    <row>
	      <entry>accept filter が修正され、
		簡単なサービス妨害攻撃には影響を受けなくなった後の
		4.5-STABLE</entry>
	      <entry>450006</entry>
	    </row>

	    <row>
	      <entry>4.6-RELEASE</entry>
	      <entry>460000</entry>
	    </row>

	    <row>
	      <entry>&man.sendfile.2;
		をドキュメントに適合するよう修正して、
		送信されたいかなるヘッダも、
		ファイルから送信されたデータの総量に合計しないようにした
		4.6-STABLE</entry>
	      <entry>460001</entry>
	    </row>

	    <row>
	      <entry>4.6.2-RELEASE</entry>
	      <entry>460002</entry>
	    </row>

	    <row>
	      <entry>4.6-STABLE</entry>
	      <entry>460100</entry>
	    </row>

	    <row>
	      <entry>`sed -i' を MFC した後の 4.6-STABLE</entry>
	      <entry>460101</entry>
	    </row>

	    <row>
	      <entry>多くの新たな pkg_install の機能を HEAD から MFC
		した後の 4.6-STABLE</entry>
	      <entry>460102</entry>
	    </row>

	    <row>
	      <entry>4.7-RELEASE</entry>
	      <entry>470000</entry>
	    </row>

	    <row>
	      <entry>4.7-STABLE</entry>
	      <entry>470100</entry>
	    </row>

	    <row>
	      <entry>__sF の代わりに __std{in,out,err}p 参照生成を開始。
		これは、std{in,out,err} をコンパイル時の定数から、
		ランタイムに変更します。</entry>
	      <entry>470101</entry>
	    </row>

	    <row>
	      <entry>m_aux mbuf を m_tag で置き換える mbuf
		の変更を MFC した後の 4.7-STABLE</entry>
	      <entry>470102</entry>
	    </row>

	    <row>
	      <entry>OpenSSL 0.9.7 導入後の 4.7-STABLE</entry>
	      <entry>470103</entry>
	    </row>

	    <row>
	      <entry>4.8-RELEASE</entry>
	      <entry>480000</entry>
	    </row>

	    <row>
	      <entry>4.8-STABLE</entry>
	      <entry>480100</entry>
	    </row>

	    <row>
	      <entry>5.0-CURRENT</entry>
	      <entry>500000</entry>
	    </row>

	    <row>
	      <entry>ELF ヘッダフィールドの追加と ELF バイナリのマーク付け
		(branding) 方法の変更後の 5.0-CURRENT</entry>
	      <entry>500001</entry>
	    </row>

	    <row>
	      <entry>kld メタデータ変更後の 5.0-CURRENT</entry>
	      <entry>500002</entry>
	    </row>

	    <row>
	      <entry>buf/bio 変更後の 5.0-CURRENT</entry>
	      <entry>500003</entry>
	    </row>

	    <row>
	      <entry>binutils アップグレード後の 5.0-CURRENT</entry>
	      <entry>500004</entry>
	    </row>

	    <row>
	      <entry>libxpg4 コードの libc へのマージと、
		TASKQ インターフェイスの導入後の 5.0-CURRENT</entry>
	      <entry>500005</entry>
	    </row>

	    <row>
	      <entry>AGP インターフェイス追加後の 5.0-CURRENT</entry>
	      <entry>500006</entry>
	    </row>

	    <row>
	      <entry>Perl を 5.6.0 にアップグレードした後の
		5.0-CURRENT</entry>
	      <entry>500007</entry>
	    </row>

	    <row>
	      <entry>KAME コードを 2000/07 版のソースに更新した後の
		5.0-CURRENT</entry>
	      <entry>500008</entry>
	    </row>

	    <row>
	      <entry>ether_ifattach() および
		ether_ifdetach() 変更後の 5.0-CURRENT</entry>
	      <entry>500009</entry>
	    </row>

	    <row>
	      <entry>mtree のデフォルトをオリジナルの変種に戻し、
		シンボリックリンクをたどる -L オプションを追加した後の
		5.0-CURRENT</entry>
	      <entry>500010</entry>
	    </row>

	    <row>
	      <entry>kqueue API 変更後の 5.0-CURRENT</entry>
	      <entry>500011</entry>
	    </row>

	    <row>
	      <entry>&man.setproctitle.3; が libutil から libc
		へ移動した後の 5.0-CURRENT</entry>
	      <entry>500012</entry>
	    </row>

	    <row>
	      <entry>最初の SMPng がコミットされた後の
		5.0-CURRENT</entry>
	      <entry>500013</entry>
	    </row>

	    <row>
	      <entry>&lt;sys/select.h&gt; が &lt;sys/selinfo.h&gt; に
		移動した後の 5.0-CURRENT</entry>
	      <entry>500014</entry>
	    </row>

	    <row>
	      <entry>libgcc.a と libgcc_r.a の結合および関連する
		GCC linkage 変更が行なわれた後の 5.0-CURRENT</entry>
	      <entry>500015</entry>
	    </row>

	    <row>
	      <entry>libc と libc_r の混合リンクを許し、
		-pthread オプションを deprecate する
		変更後の 5.0-CURRENT</entry>
	      <entry>500016</entry>
	    </row>

	    <row>
	      <entry>mountd 等が使用する kernel-exported API の
		安定化のため、ucred 構造体から xucred 構造体へ
		移行した後の 5.0-CURRENT</entry>
	      <entry>500017</entry>
	    </row>

	    <row>
	      <entry>CPU 依存の最適化を制御するための make 変数
		CPUTYPE が追加された後の 5.0-CURRENT</entry>
	      <entry>500018</entry>
	    </row>

	    <row>
	      <entry>&lt;machine/ioctl_fd.h&gt; が
		&lt;sys/fdcio.h&gt; に移動した後の 5.0-CURRENT</entry>
	      <entry>500019</entry>
	    </row>

	    <row>
	      <entry>ロケール名変更の後の 5.0-CURRENT</entry>
	      <entry>500020</entry>
	    </row>

	    <row>
	      <entry>Bzip2 導入後の 5.0-CURRENT。
		また、S/Key が削除されていることも示す。</entry>
	      <entry>500021</entry>
	    </row>

	    <row>
	      <entry>SSE サポート後の 5.0-CURRENT</entry>
	      <entry>500022</entry>
	    </row>

	    <row>
	      <entry>KSE マイルストーン 2 以降の 5.0-CURRENT</entry>
	      <entry>500023</entry>
	    </row>

	    <row>
	      <entry>d_thread_t 導入、および UUCP を ports
		に移動した後の 5.0-CURRENT</entry>
	      <entry>500024</entry>
	    </row>

	    <row>
	      <entry>64 ビットプラットホーム上のデスクリプタおよび
		cred 受け渡し ABI 変更後の 5.0-CURRENT</entry>
	      <entry>500025</entry>
	    </row>

	    <row>
	      <entry>package 作成のデフォルトを XFree86 4
		に移行し、libc に新たに strnstr() 関数を追加した後の
		5.0-CURRENT</entry>
	      <entry>500026</entry>
	    </row>

	    <row>
	      <entry>libc に新たに strcasestr() 関数を追加した後の
		5.0-CURRENT</entry>
	      <entry>500027</entry>
	    </row>

	    <row>
	      <entry>smbfs のユーザランド部が取り込まれた後の
		5.0-CURRENT</entry>
	      <entry>500028</entry>
	    </row>

	    <row>
	      <entry>C99 の新しい特定サイズの整数型追加後の
		5.0-CURRENT</entry>
	      <entry>500028 (変更なし)</entry>
	    </row>

	    <row>
	      <entry>sendfile(2) の戻り値が変更された後の
		5.0-CURRENT</entry>
	      <entry>500029</entry>
	    </row>

	    <row>
	      <entry>ファイルフラグにふさわしいサイズの
		<literal>fflags_t</literal> が導入された後の
		5.0-CURRENT</entry>
	      <entry>500030</entry>
	    </row>

	    <row>
	      <entry>usb の構成要素の名称が変更された後の 5.0-CURRENT</entry>
	      <entry>500031</entry>
	    </row>

	    <row>
	      <entry>Perl 5.6.1 導入後の 5.0-CURRENT</entry>
	      <entry>500032</entry>
	    </row>

	    <row>
	      <entry>&man.rc.conf.5; の
		<literal>sendmail_enable</literal> 変数が
		<literal>NONE</literal> という値をとれるようになった後の
		5.0-CURRENT</entry>
	      <entry>500033</entry>
	    </row>

	    <row>
	      <entry>mtx_init() に 3 番目の引数が加わった後の
		5.0-CURRENT</entry>
	      <entry>500034</entry>
	    </row>

	    <row>
	      <entry>GCC 3.1 が取り込まれた 5.0-CURRENT</entry>
	      <entry>500035</entry>
	    </row>

	    <row>
	      <entry>/usr/src に Perl がなくなった 5.0-CURRENT</entry>
	      <entry>500036</entry>
	    </row>

	    <row>
	      <entry>dlfunc(3) 追加後の 5.0-CURRENT</entry>
	      <entry>500037</entry>
	    </row>

	    <row>
	      <entry>構造体 sockbuf
		のメンバの型が一部変更され、順序が変更された後の
		5.0-CURRENT</entry>
	      <entry>500038</entry>
	    </row>

	    <row>
	      <entry>ヘッダで _BSD_FOO_T_ の使用をやめ、
		_FOO_T_DECLARED を使うようになった後の 5.0-CURRENT。
		また、この変数は &man.bzip2.1;
		パッケージに対応したことが確実な目安としても使えます。</entry>
	      <entry>500039</entry>
	    </row>

	    <row>
	      <entry>ディスクラベルの内部構造の依存性を除く名目で行われた、
		ディスク関連の機能へのさまざまな変更を加えた後の
		5.0-CURRENT</entry>
	      <entry>500040</entry>
	    </row>

	    <row>
	      <entry>libc に getopt_long(3) を加えた後の 5.0-CURRENT</entry>
	      <entry>500041</entry>
	    </row>

	    <row>
	      <entry>Binutils 2.13 にアップグレードした後の
		5.0-CURRENT。このアップグレードには、新たな FreeBSD
		の emulation, vec および出力形式が含まれている。
	      </entry>
	      <entry>500042</entry>
	    </row>

	    <row>
	      <entry>libc に pthread_XXX への弱いスタブを追加し、
		libXThrStub.so が obsolete になった後の 5.0-CURRENT。
		5.0-RELEASE</entry>
	      <entry>500043</entry>
	    </row>

	    <row>
	      <entry>RELENG_5_0_0 をブランチした後の 5.0-CURRENT</entry>
	      <entry>500100</entry>
	    </row>
	    <row>
	      <entry>&lt;sys/dkstat.h&gt; は空なので include
		すべきではない</entry>
	      <entry>500101</entry>
	    </row>
	    <row>
	      <entry>d_mmap_t インターフェイス変更後の
		5.0-CURRENT</entry>
	      <entry>500102</entry>
	    </row>
	    <row>
	      <entry>taskqueue_swi が Giant ロック無しで実行され、
		Giant ロックされて実行される taskqueue_swi_giant
		が追加された後の 5.0-CURRENT</entry>
	      <entry>500103</entry>
	    </row>
	    <row>
	      <entry>cdevsw_add() と cdevsw_remove()
		はもう存在しません。
		MAJOR_AUTO 割り当て機能が登場しました</entry>
	      <entry>500104</entry>
	    </row>
	    <row>
	      <entry>cdevsw の新たな初期化方法が導入された後の
		5.0-CURRENT</entry>
	      <entry>500105</entry>
	    </row>
	    <row>
	      <entry>devstat_add_entry() が devstat_new_entry()
		に置き換えられました</entry>
	      <entry>500106</entry>
	    </row>
	    <row>
	      <entry>Devstat のインターフェイス変更。
		sys/sys/param.h 1.149 を参照のこと</entry>
	      <entry>500107</entry>
	    </row>
	    <row>
	      <entry>トークンリングインターフェイスの変更</entry>
	      <entry>500108</entry>
	    </row>
	    <row>
	      <entry>vm_paddr_t の追加</entry>
	      <entry>500109</entry>
	    </row>
	    <row>
	      <entry>realpath(3) がスレッドセーフになった後の
		5.0-CURRENT</entry>
	      <entry>500110</entry>
	    </row>
	    <row>
	      <entry>usbhid(3) が NetBSD と同期した後の 5.0-CURRENT</entry>
	      <entry>500111</entry>
	    </row>
	    <row>
	      <entry>新たな NSS 実装と
		POSIX.1 準拠の getpw*_r, getgr*_r
		関数が導入後の 5.0-CURRENT</entry>
	      <entry>500112</entry>
	    </row>
	    <row>
	      <entry>古い rc システムを削除した後の 5.0-CURRENT</entry>
	      <entry>500113</entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>

      <note>
	<para>(2.2-STABLE は 2.2.5-RELESE 以後、
	  <quote>2.2.5-STABLE</quote> と呼ばれることがあります。)
	  見てのとおりこれは年・月というフォーマットになっていましたが、
	  バージョン 2.2 からより直接的にメジャー/マイナー番号を使うように変更になりました。
	  並行していくつかのブランチ (枝分かれしたバージョン)
	  を開発する場合には、
	  リリースされた日付でそれらのリリースを分類することが不可能だからです
	  (あなたが今 port
	  を作成するときに、古い -CURRENT 達について心配する必要はありません。
	  これは参考のために挙げられているに過ぎないからです)。</para>
      </note>
    </sect1>

    <sect1 id="dads-after-port-mk">
      <title><filename>bsd.port.mk</filename> の後に書くこと</title>

      <para><literal>.include &lt;bsd.port.mk&gt;</literal>
	の行の後には何も書かないようにしてください。
	大抵の場合は
	<filename>Makefile</filename> の中程のどこかで
	<filename>bsd.port.pre.mk</filename> をインクルードして、
	最後に <filename>bsd.port.pre.mk</filename>
	をインクルードすることによって避けることができます。</para>

      <note>
	<para><filename>pre.mk</filename>/<filename>post.mk</filename>
	  のペアか <filename>bsd.port.mk</filename>
	  だけのどちらかだけをインクルードし、二つを混ぜないでください。</para>
      </note>

      <para>前者はいくつかの変数の定義だけをして
	<filename>Makefile</filename>
	でのテストに使用し、後者は残りを定義します。</para>

      <para>以下は <filename>bsd.port.pre.mk</filename>
	で定義される重要な変数です
	(これは、すべてではありません。
	完全なリストは <filename>bsd.port.mk</filename> を参照してください)。
      </para>

      <informaltable frame="none">
	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>変数名</entry>
	      <entry>解説</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><makevar>ARCH</makevar></entry>
	      <entry><command>uname -m</command>
		で返されるアーキテクチャ。(例、<literal>i386</literal>)。
	      </entry>
	    </row>

	    <row>
	      <entry><makevar>OPSYS</makevar></entry>
	      <entry><command>uname -s</command>
		で返されるオペレーティングシステム
		(例、<literal>FreeBSD</literal>)。</entry>
	    </row>

	    <row>
	      <entry><makevar>OSREL</makevar></entry>
	      <entry>オペレーティングシステムのリリースバージョン
		(例、<literal>2.1.5</literal>,
		<literal>2.2.7</literal>)。</entry>
	    </row>

	    <row>
	      <entry><makevar>OSVERSION</makevar></entry>
	      <entry>数字形式のオペレーティングシステムのバージョン、
		上記の <link
		  linkend="freebsd-versions"><literal>__FreeBSD_version</literal></link>
		と同じです。</entry>
	    </row>

	    <row>
	      <entry><makevar>PORTOBJFORMAT</makevar></entry>
	      <entry>システムのオブジェクトフォーマット
		(<literal>aout</literal> あるいは
		<literal>elf</literal>)。</entry>
	    </row>

	    <row>
	      <entry><makevar>LOCALBASE</makevar></entry>
	      <entry><quote>local</quote> ツリーのベース。
		(例、<literal>/usr/local/</literal>)。
	      </entry>
	    </row>

	    <row>
	      <entry><makevar>X11BASE</makevar></entry>
	      <entry><quote>X11</quote> ツリーのベース。
		(例、<literal>/usr/X11R6/</literal>)。
	      </entry>
	    </row>

	    <row>
	      <entry><makevar>PREFIX</makevar></entry>
	      <entry>ports のインストール先
		(<link linkend="porting-prefix">
		  <makevar>PREFIX</makevar>について</link>を参照)。
	      </entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>

      <note>
	<para><makevar>USE_IMAKE</makevar>,
	  <makevar>USE_X_PREFIX</makevar> あるいは
	  <makevar>MASTERDIR</makevar>
	  などの変数を定義する必要がある場合には、
	  <filename>bsd.port.pre.mk</filename>
	  をインクルード前に定義してください。
	  他のものは <filename>bsd.port.pre.mk</filename>
	  の前でも後でもかまいません。</para>
      </note>

      <para>以下は <filename>bsd.port.pre.mk</filename>
	の後に書けるものの例です。</para>

      <programlisting># no need to compile lang/perl5 if perl5 is already in system
.if ${OSVERSION} > 300003
BROKEN= perl is in system
.endif

# only one shlib version number for ELF
.if ${PORTOBJFORMAT} == "elf"
TCL_LIB_FILE=  ${TCL_LIB}.${SHLIB_MAJOR}
.else
TCL_LIB_FILE=  ${TCL_LIB}.${SHLIB_MAJOR}.${SHLIB_MINOR}
.endif

# software already makes link for ELF, but not for a.out
post-install:
.if ${PORTOBJFORMAT} == "aout"
       ${LN} -sf liblinpack.so.1.0 ${PREFIX}/lib/liblinpack.so
.endif</programlisting>
    </sect1>

    <sect1 id="dads-documentation">
      <title>付加的な文書のインストール</title>

      <para>普通のマニュアルや info
	ファイルの他にユーザにとって有用だと思えるような文書がある場合には、
	<filename><makevar> PREFIX</makevar>/share/doc</filename>
	の下にインストールしてください。
	これは前記と同様 <maketarget>post-install</maketarget>
	ターゲットの中から行なうと良いでしょう。</para>

      <para>まず、あなたの port のために新しいディレクトリを作ります。
	どの port の文書か簡単にわかるような名前にする必要がありますので、
	普通は <makevar>PORTNAME</makevar> を使うと良いでしょう。
	もちろん、ユーザが異なるバージョンのものを同時に使うことが予想される
	port の場合には
	<makevar>PKGNAME</makevar> をそのまま使っても構いません。</para>

      <para>ユーザが <filename>/etc/make.conf</filename>
	でこの部分を禁止するために
	<makevar>NOPORTDOCS</makevar>
	という変数をセットしている場合には、
	これらの文書がインストールされないようにしてください。
	こんな具合です。</para>

      <programlisting>post-install:
.if !defined(NOPORTDOCS)
        ${MKDIR} ${PREFIX}/share/doc/xv
        ${INSTALL_MAN} ${WRKSRC}/docs/xvdocs.ps ${PREFIX}/share/doc/xv
.endif</programlisting>

	<para>文書ファイルおよびディレクトリはすべて
	  <filename>pkg-plist</filename> の中に
	  <literal>%%PORTDOCS%%</literal> を頭につけて書く必要があります。
	  たとえば、次のようにしてください。</para>

	<programlisting>%%PORTDOCS%%share/doc/pure-ftpd/AUTHORS
%%PORTDOCS%%share/doc/pure-ftpd/CONTACT
%%PORTDOCS%%@dirrm share/doc/pure-ftpd</programlisting>

      <para>インストール時に <filename>pkg-message</filename>
	ファイルを利用してメッセージを表示することができます。詳細は
	<link linkend="porting-message">pkg-message を使う</link>
	のセクションを参照してください。</para>

      <!-- kuriyama - note below is not exist in Jap ver, but Eng ver has it. why? -->
      <note>
	<para><filename>pkg-message</filename>
	  ファイルを <filename>pkg-plist</filename>
	  に加える必要はありません。</para>
      </note>
    </sect1>

    <sect1 id="dads-subdirs">
      <title>ディレクトリ構成</title>

      <para>インストール時には <makevar>PREFIX</makevar>
	の正しいサブディレクトリにファイルを置くように心がけてください。
	ソフトウェアによっては新しいディレクトリを一つ作って、
	ファイルを全部それに入れてしまうものがありますが、
	それは良くありません。
	また、バイナリ、ヘッダファイルとマニュアル以外のすべてを
	<filename>lib</filename> というディレクトリに入れてしまう
	port もありますが、これも
	BSD 的なファイルシステム構成からいうと正しくありません。
	これは以下のように分散すべきです。
	<filename>etc</filename>
	にセットアップ/コンフィグレーションファイル、
	<filename>libexec</filename> に内部で使用されるプログラム
	(コマンドラインから呼ばれることのないコマンド)、
	<filename>sbin</filename> に管理者用のコマンド、
	<filename>info</filename> に GNU Info 用の文書、
	そして <filename>share</filename>
	にアーキテクチャに依存しないファイルが入ります。
	詳細については &man.hier.7; のマニュアルページを参照してください。
	<filename>/usr</filename> の構成方針はほとんどそのまま
	<filename>/usr/local</filename> にもあてはまります。
	USENET <quote>ニュース</quote>を扱う ports は例外です。
	これらはファイルのインストール先として
	<filename><makevar>PREFIX</makevar>/news</filename>
	を使用します。</para>
    </sect1>

    <sect1 id="porting-cleaning">
      <title>空のディレクトリの削除</title>

      <para>ports は削除の際に、
	自分自身を消去したあとに
	(ディレクトリの)
	削除をするようにしてください。
	これは大抵の場合 <literal>@dirrm</literal> の行を
	ports が作成するすべてのディレクトリについて加えることによって実現できます。
	親ディレクトリは子ディレクトリを先に消さないと消せないことに注意してください。</para>

      <programlisting> :
lib/X11/oneko/pixmaps/cat.xpm
lib/X11/oneko/sounds/cat.au
 :
@dirrm lib/X11/oneko/pixmaps
@dirrm lib/X11/oneko/sounds
@dirrm lib/X11/oneko</programlisting>

      <para>といった感じです。</para>

      <para>しかし時として、
	他の port とディレクトリを共有しているために
	<literal>@dirrm</literal> がエラーを返すことがあります。
	<command>rmdir</command> を
	<literal>@unexec</literal>
	から呼びだすことによって、
	警告(warning)なしで空のディレクトリのみを削除することができます。
      </para>

      <programlisting>@unexec rmdir %D/share/doc/gimp 2>/dev/null || true</programlisting>

      <para>これを使えば、たとえ他の
	port がファイルをインストールしていて
	<filename><makevar>PREFIX</makevar>/share/doc/gimp</filename>
	が空でない場合でもエラーメッセージは表示されませんし、
	<command>pkg_delete</command>
	が異常終了することもありません。</para>
    </sect1>

    <sect1 id="dads-uid">
      <title>UID</title>

      <para>あなたの port が、
	インストールされるシステム上に特定のユーザを必要とする場合は
	<filename>pkg-install</filename> スクリプトから
	<command>pw</command>
	コマンドを実行して自動的にそのユーザを追加するようにしてください。
	<filename role="package">net/cvsup-mirror</filename>
	の port が参考になるでしょう。</para>

      <para>あなたの port がバイナリの
	package としてインストールされる場合とコンパイルされる場合の両方で、
	同じユーザー/グループ ID を使わなければならないのなら、50 から
	999 の間で空いている UID を選んで登録してください。
	<filename role="package">japanese/Wnn</filename> の port
	が参考になるでしょう。</para>

      <para>既にシステムや他の port で利用されている
	UIDを使わないように十分注意してください。
	現在の 50 から 999 までの間の UID は以下のとおりです。</para>

      <programlisting>majordom:*:54:54:Majordomo Pseudo User:/usr/local/majordomo:/nonexistent
cyrus:*:60:60:the cyrus mail server:/nonexistent:/nonexistent
gnats:*:61:1:GNATS database owner:/usr/local/share/gnats/gnats-db:/bin/sh
uucp:*:66:66:UUCP pseudo-user:/var/spool/uucppublic:/usr/libexec/uucp/uucico
xten:*:67:67:X-10 daemon:/usr/local/xten:/nonexistent
pop:*:68:6:Post Office Owner (popper):/nonexistent:/sbin/nologin
wnn:*:69:7:Wnn:/nonexistent:/nonexistent
pgsql:*:70:70:PostgreSQL pseudo-user:/usr/local/pgsql:/bin/sh
ircd:*:72:72:IRCd hybrid:/nonexistent:/nonexistent
ifmail:*:75:66:Ifmail user:/nonexistent:/nonexistent
www:*:80:80:World Wide Web Owner:/nonexistent:/sbin/nologin
alias:*:81:81:QMail user:/var/qmail/alias:/nonexistent
qmaill:*:83:81:QMail user:/var/qmail:/nonexistent
qmaild:*:82:81:QMail user:/var/qmail:/nonexistent
qmailq:*:85:82:QMail user:/var/qmail:/nonexistent
qmails:*:87:82:QMail user:/var/qmail:/nonexistent
qmailp:*:84:81:QMail user:/var/qmail:/nonexistent
qmailr:*:86:82:QMail user:/var/qmail:/nonexistent
msql:*:87:87:mSQL-2 pseudo-user:/var/db/msqldb:/bin/sh
mysql:*:88:88:MySQL Daemon:/var/db/mysql:/sbin/nologin
vpopmail:*:89:89:VPop Mail User:/usr/local/vpopmail:/nonexistent
smmsp:*:90:90:Sendmail Queue:/nonexistent:/nonexistent
mailman:*:91:91:Mailman User:/usr/local/mailman:/sbin/nologin
gdm:*:92:92:GDM Sandbox:/:/sbin/nologin
jabber:*:93:93:Jabber Daemon:/nonexistent:/nonexistent
p4admin:*:94:94:Perforce admin:/usr/local/perforce:/sbin/nologin
interch:*:95:95:Interchange user:/usr/local/interchange:/sbin/nologin
fido:*:111:111:Fido System:/usr/local/fido:/bin/sh
drweb:*:426:426:Dr.Web Mail Scanner:/nonexistent:/sbin/nologin</programlisting>

      <para>このリストを最新の状態に保つためにも、
	この範囲の UID や GID を予約するような port を作ったり、
	既存の port にそのような改変を行なってわたしたちに送るときには
	UID の予約に関する注意書きをつけてください。</para>
    </sect1>

    <sect1 id="dads-rational">
      <title>合理的な port</title>

      <para><filename>Makefile</filename>
	は単純かつ適切であるべきです。もし、
	<filename>Makefile</filename> を数行短かくできたり、
	もっと読みやすくできるのであればそうしてください。
	たとえば、
	シェルの <literal>if</literal> 構文を使うかわりに
	make の <literal>.if</literal> 構文を使う、
	<makevar>EXTRACT*</makevar> の再定義で代用できるのであれば
	<maketarget>do-extract</maketarget> を再定義しない、
	<literal>CONFIGURE_ARGS += --prefix=&dollar;{PREFIX}</literal>
	とするかわりに
	<makevar>GNU_CONFIGURE</makevar> とする、などです。</para>
      </sect1>

      <sect1 id="dads-cc">
	<title><makevar>CC</makevar> および <makevar>CXX</makevar>
	  の尊重</title>

	<para>Port は <makevar>CC</makevar> および <makevar>CXX</makevar>
	  変数を尊重すべきです。そうでない場合は、<filename>Makefile</filename>
	  に <literal>NO_PACKAGE=ignores either cc or cxx</literal>
	  を追加してください。</para>

	<para><makevar>CC</makevar> と <makevar>CXX</makevar>
	  変数を尊重している <filename>Makefile</filename>
	  の例を次に示します。<makevar>?=</makevar> に注意してください。</para>

	<programlisting>CC ?= gcc</programlisting>
	<programlisting>CXX ?= g++</programlisting>

	<para>こちらは、<makevar>CC</makevar> 変数も <makevar>CXX</makevar>
	  変数も尊重していない例です。</para>

	<programlisting>CC = gcc</programlisting>
	<programlisting>CXX = g++</programlisting>

	<para>FreeBSD システム上では、<makevar>CC</makevar> および
	  <makevar>CFLAGS</makevar>
	  変数は、どちらも <filename>/etc/make.conf</filename>
	  で定義できます。最初の例では、システム全体の定義を保存している
	  <filename>/etc/make.conf</filename>
	  で値がすでに設定されてない場合に限って、値を設定します。
	  2 番目の例では、すでに設定されていた内容を上書きしてしまいます。</para>
    </sect1>

    <sect1 id="dads-cflags">
      <title><makevar>CFLAGS</makevar> の尊重</title>

      <para><makevar>CFLAGS</makevar> 変数は尊重すべきです。
	port がこれを無視する場合は、
	<literal>NO_PACKAGE=ignores cflags</literal> を
	<filename>Makefile</filename> に加えてください。</para>

      <para><makevar>CFLAGS</makevar> 変数をきちんと考慮した
	<filename>Makefile</filename> の例を以下に示します。
	<makevar>+=</makevar> の部分に注目してください。</para>

      <programlisting>CFLAGS += -Wall -Werror</programlisting>

      <para>次は <makevar>CFLAGS</makevar>
	変数を考慮しない <filename>Makefile</filename> の例です。</para>

      <programlisting>CFLAGS = -Wall -Werror</programlisting>

      <para><makevar>CFLAGS</makevar> 変数は、FreeBSD システムの
	<filename>/etc/make.conf</filename> で定義されています。
	最初の例では既存の定義を保存しつつ <makevar>CFLAGS</makevar>
	変数にオプションフラグを追加しているのに対し、
	二番目の例では既存の定義をすべて無効にしてしまっています。</para>
    </sect1>

    <sect1 id="dads-config">
      <title>コンフィグレーション (設定) ファイル</title>

      <para>もしあなたの port が設定ファイルを
	<filename><makevar>PREFIX</makevar>/etc</filename>
	に置く必要がある場合には、それを単純にインストールしたり、
	<filename>pkg-plist</filename>
	に加えては<emphasis>いけません</emphasis>。
	こうしてしまうと
	<command>pkg_delete</command>
	によってユーザが苦労して作ったファイルが消えてしまったり、
	新しくインストールする時に上書きされてしまったりします。</para>

      <para>かわりに見本となるファイルをサフィックス
	(<filename><replaceable>filename</replaceable>.sample</filename>
	が良いでしょう)
	を付けてインストールして<link linkend="porting-message">メッセージ</link>を表示し、
	ソフトウェアを動かす前にユーザがそのファイルをコピーして編集をしなければならないことを知らせましょう。
      </para>
    </sect1>

    <sect1 id="dads-freedback">
      <title>フィードバック</title>

      <para>port を作るためにソフトウェアに変更を加えたら、
	なるべく原作者にその旨を伝えてパッチ等を送ってください。
	これらが次のリリースに取り入れられればアップグレードが楽になります。</para>
    </sect1>

    <sect1 id="dads-readme">
      <title><filename>README.html</filename></title>

      <para><filename>README.html</filename>
	というファイルを含めてはいけません。
	このファイルは、cvs コレクションの一部ではなく、
	<command>make readme</command>
	コマンドで生成されるファイルです。</para>
    </sect1>

    <sect1 id="dads-broken">
      <title>Port に <makevar>BROKEN</makevar>, <makevar>FORBIDDEN</makevar>
	などの印をつける</title>

      <para>ある port にセキュリティ脆弱性があることが判明したり、
	根本的に壊れてしまい修正に何時間もの注意深い作業が必要になったり、
	基本的には廃れてしまったものの、
	何らかの理由で ports ツリーには残される
	(もちろんあとで修正しますよね?)
	という日が来るのは避けられません。
	ある port が壊れていることを示すために、port の
	<filename>Makefile</filename> では 3 つの
	<command>make</command> 変数が使えます。以下の
	<command>make</command> 変数の値は、
	その port が壊れている理由を説明するためにユーザに示されます。
	それぞれの make 変数は、ユーザと <filename>Makefiles</filename>
	を処理する自動化システムに対して根本的に異なる意味を伝えますので、
	正しい <command>make</command> 変数をお使いください。</para>

	<itemizedlist>
	  <listitem>
	    <para><makevar>BROKEN</makevar>
	      は、動作しないためインストールすべきでない port
	      用のものです。これは、ユーザがその port
	      をインストールしないようにしますが、
	      <makevar>BROKEN</makevar> とされた port
	      は <ulink url="http://bento.FreeBSD.org/">Bento
	      クラスタ</ulink>で引き続きビルドされます。
	      ユーザには port をインストールしてほしくないけれども
	      Bento ではビルドしてほしい場合は、port
	      を <makevar>BROKEN</makevar> にしてください。</para>
	  </listitem>

	  <listitem>
	    <para><makevar>FORBIDDEN</makevar>
	      は、セキュリティ脆弱性があったり、その port
	      をインストールすると
	      FreeBSD システムの安全性に重大な懸念を生じる
	      (たとえば、セキュアでないという評判があるプログラムや、
	      容易に悪用できるサービスを提供するプログラムなど)
	      port 用のものです。
	      あるソフトウェアの一部に脆弱性があることが判明し、
	      修正がリリースされていない場合は
	      <makevar>FORBIDDEN</makevar> にすべきです。
	      理想的には、セキュリティ脆弱性が発見された時は、
	      脆弱性を抱えた FreeBSD ホストの数を減らすために、
	      ただちに ports を更新すべきです
	      (我々は、セキュアであるという評判を得たいのです)。
	      しかし、脆弱性が公表されてから、
	      脆弱性を抱えたソフトウェアの新しい版がリリースされるまでに無視できない時間があくことがままあります。
	      セキュリティ以外の理由で port を
	      <makevar>FORBIDDEN</makevar> にしないでください。</para>
	  </listitem>

	  <listitem>
	    <para><makevar>IGNORE</makevar>
	      は、どんな理由であれビルドすべきではない port 用です。
	      ユーザも <ulink url="http://bento.FreeBSD.org/">Bento
	      クラスタ</ulink> も、どんな状況であれ
	      <makevar>IGNORE</makevar> とされた port はビルドしません。
	      嘘だと思うなら、port のビルドを妨げるのに
	      <makevar>IGNORE</makevar> を使ってみてください。</para>
	  </listitem>

	</itemizedlist>

	<para>この変数を使うのは、port
	  が更新できない場合の最後の手段にしてください。
	  ずっと壊れたままの port は、ports
	  ツリーから完全に削除すべきです。</para>
    </sect1>

    <sect1 id="dads-misc">
      <title>その他諸々</title>

      <para>ファイル <filename>pkg-descr</filename> と
	<filename>pkg-plist</filename>
	はそれぞれ二重にチェックしてください。
	再検討してもっと良い記述があればそれに置きかえてください。</para>

      <para>GNU General Public License
	(GNU一般公有使用許諾)
	のコピーは
	(すでにあるので)
	コピーしないでください。
	お願いします。</para>

      <para>法律に関することには十分注意をはらってください。
	わたしたちに法律に反するような形でソフトウェアの配布をさせないでください!</para>
    </sect1>

    <sect1 id="dads-stuck">
      <title>困ったら…</title>

      <para>わたしたちに質問を送る前に、
	既存の port の例と
	<filename>bsd.port.mk</filename> をちゃんと読んでください!
	<!-- smiley --><emphasis>;)</emphasis></para>

      <para>それでもわからないことがあったら一人で悩まないでどんどん質問してください!
	<!-- smiley --><emphasis>:-)</emphasis></para>
    </sect1>
  </chapter>

  <chapter id="porting-samplem">
    <title><filename>Makefile</filename> のサンプル</title>

    <para>これは port の
      <filename>Makefile</filename> を作る際のお手本です。
      かぎかっこ ([]) 内のコメントは忘れずに取ってください。</para>

    <para>変数の順番、段落の間の空行など、
      <filename>Makefile</filename>
      を作るときはなるべくこの形式に従ってください。
      この形式は重要な情報が簡単に見つけられるように設計されています。
      <link linkend="porting-portlint">portlint</link> を使って
      <filename>Makefile</filename> をチェックすることが推奨されています。</para>

    <programlisting>[ヘッダ ... どのような port の Makefile かすぐにわかるようになっています]
# New ports collection makefile for:    xdvi
["version required" 行は、PORTVERSION 変数では port のバージョンを
十分に表現できない場合にのみ必要です。]
# Date created: 26 May 1995
[このソフトウェアを最初に FreeBSD に port した人の名前、つまり、
 この Makefile の最初の版を書いた人です。この port をアップグレー
 ドするとき、この行も変えないでください。]
# Whom:         Satoshi Asami &lt;asami@FreeBSD.org&gt;
#
# &dollar;FreeBSD&dollar;
[ ^^^^^^^^^ この部分は、CVS ツリーに入れる時に自動的に RCS の ID 文字列に
 置き換えられます。]
#

[port 自体、およびオリジナルのソースを取ってくるところを記述する部分。
 最初は必ず PORTNAME と PORTVERSION, そして必要なら PKGNAME,
 CATEGORIES, 続いて MASTER_SITES が置かれ、さらに MASTER_SITE_SUBDIR が
 置かれることもあります。必要なら PKGNAMEPREFIX と PKGNAMESUFFIX が
 それに続き、そして DISTNAME, EXTRACT_SUFX, DISTFILES が、
 また、その後に必要に応じて EXTRACT_ONLY が置かれます。]
PORTNAME=       xdvi
PORTVERSION=    18.2
CATEGORIES=     print
[MASTER_SITE_* マクロを使用しない場合は、
最後のスラッシュを忘れないように ("/")!]
MASTER_SITES= ${MASTER_SITE_XCONTRIB}
MASTER_SITE_SUBDIR= applications
DISTNAME=       xdvi-pl18
[ソースファイルが標準の ".tar.gz" 形式でない時にこれを使いましょう]
EXTRACT_SUFX=   .tar.Z

[配布パッチセクション -- ない場合もあります]
PATCH_SITES=    ftp://ftp.sra.co.jp/pub/X11/japanese/
PATCHFILES=     xdvi-18.patch1.gz xdvi-18.patch2.gz

[保守責任者 -- これは *必ず* 必要です。担当者 (あなた) 自身、あるいは
 担当者に素早く連絡をとれる人のアドレスを書いてください。どうしてもこ
 こに自分のアドレスを書くのがいやな人は "ports@FreeBSD.org" と書いて
 もいいです]
MAINTAINER=     asami@FreeBSD.org
COMMENT=       A DVI Previewer for the X Window System

[依存するport -- ない場合もあります]
RUN_DEPENDS=    gs:${PORTSDIR}/print/ghostscript
LIB_DEPENDS=    Xpm.5:${PORTSDIR}/graphics/xpm

[ここには標準の bsd.port.mk の変数で、上のどれにもあてはまらないものを
 書きます]
[コンフィグレーション、コンパイル、インストールなどの時に質問をする
 なら…]
IS_INTERACTIVE=yes
[${DISTNAME} 以外のディレクトリにソースが展開されるなら…]
WRKSRC= ${WRKDIR}/xdvi-new
[配布されているパッチが ${WRKSRC} に対する相対パスで作られてい
 い場合にこの変数の指定が必要かも…]
PATCH_DIST_STRIP=       -p1
[GNU autoconf によって生成された "configure" スクリプトを走らせたいなら…]
GNU_CONFIGURE=  yes
[/usr/bin/makeでなく、GNU make を使わないといけないなら…]
USE_GMAKE=      yes
[これが X のアプリケーションで、"xmkmf -a" を走らせたいなら…]
USE_IMAKE=      yes
[などなど]

[下の方のルールで使う非標準の変数]
MY_FAVORITE_RESPONSE=   "yeah, right"

[そして、特別なターゲット、使用順に]
pre-fetch:
        i go fetch something, yeah

post-patch:
        i need to do something after patch, great

pre-install:
        and then some more stuff before installing, wow

[最後には必ず]
.include &lt;bsd.port.mk&gt;</programlisting>
  </chapter>

  <chapter id="porting-autoplist">
    <title>パッキングリストの自動生成</title>

    <para>まず、あなたの port に
      <filename>pkg-plist</filename>
      がないことを除けば完成していることを確認してください。</para>

    <para>次に、あなたの port
      をインストールする一時ディレクトリを作成して、
      依存するものをすべてインストールしてください。
      <replaceable>port-type</replaceable> は
      X アプリケーションではない port については <literal>local</literal>、
      XFree86 4 またはそれより前の XFree86
      のディレクトリ階層にインストールする ports については、それぞれ
      <literal>x11-4</literal> または <literal>x11</literal>
      にすべきです。</para>

      <screen>&prompt.root; <userinput>mkdir /var/tmp/<replaceable>port-name</replaceable></userinput>
&prompt.root; <userinput>mtree -U -f /etc/mtree/BSD.<replaceable>port-type</replaceable>.dist -d -e -p /var/tmp/<replaceable>port-name</replaceable></userinput>
&prompt.root; <userinput>make depends PREFIX=/var/tmp/<replaceable>port-name</replaceable></userinput></screen>

    <para>このディレクトリ構造を新しいファイルに保存してください。</para>

    <screen>&prompt.root; <userinput>(cd /var/tmp/<replaceable>port-name</replaceable> && find -d * -type d) | sort -r &gt; OLD-DIRS</userinput></screen>

    <para>もしあなたの port が <makevar>PREFIX</makevar> にちゃんと従うなら、
      ここで port をインストールしてパッキングリストを作ることができます。</para>

    <screen>&prompt.root; <userinput>make install PREFIX=/var/tmp</userinput>
&prompt.root; <userinput>(cd /var/tmp/<replaceable>port-name</replaceable> && find -d * \! -type d) | sort &gt; pkg-plist</userinput></screen>

    <para>新しく生成されたディレクトリはすべてパッキングリストに追加する必要があります。</para>

    <screen>&prompt.root; <userinput>(cd /var/tmp/<replaceable>port-name</replaceable> && find -d * -type d) | sort -r | comm -13 OLD-DIRS - | sed -e 's#^#@dirrm #' &gt;&gt; pkg-plist</userinput></screen>

    <para>最後にパッキングリストを手で整える必要があります;
      <emphasis>すべて</emphasis>が自動化されているわけではありません。
      マニュアルはパッキングリストに記述するのではなく、
      port の <filename>Makefile</filename> 中の
      <makevar>MAN<replaceable>n</replaceable></makevar> に
      記述しなければなりません。
      ユーザ設定ファイルは削除するか
      <filename><replaceable>filename</replaceable>.sample</filename>
      としてインストールされなければなりません。
      また <filename>info/dir</filename>
      ファイルはリストに含めず、
      <link linkend="porting-info">info ファイル</link>に記述されているように、
      適切な <filename>install-info</filename> 行に追加しなければなりません。
      port によってインストールされるライブラリは、
      <link linkend="porting-shlibs">共有ライブラリ</link>
      のセクションで示したように記載されるべきです。</para>

    <para>または、<filename>/usr/ports/Tools/scripts/</filename>
      にある <command>plist</command>
      スクリプトを使ってパッキングリストを自動的に生成してください。</para>
  </chapter>

  <chapter id="changes">
    <title>この文書と ports システムの変更</title>

    <para>もしあなたが、たくさんの ports の保守をしているのであれば、
      &a.ports; の内容を読むことを考えてください。
      ports のしくみについての重要な変更点はここに アナウンスされます。
      最新の変更点については、いつでも、
      <ulink url="http://www.FreeBSD.org/cgi/cvsweb.cgi/ports/Mk/bsd.port.mk">bsd.port.mk
        の CVS ログ</ulink>で詳細な情報を得ることができます。</para>

      <para>port メンテナを補助するほかのリソースとして、
	<ulink url="http://bento.FreeBSD.org/">パッケージビルド記録と
	エラー</ulink>一覧、および<ulink
	  url="http://people.FreeBSD.org/~fenner/portsurvey/">FreeBSD
	  Ports distfiles 調査</ulink> があります。</para>
  </chapter>
</book>

<!--
     Local Variables:
     mode: sgml
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     End:
-->

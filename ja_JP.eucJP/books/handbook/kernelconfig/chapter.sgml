<!--
     The FreeBSD Documentation Project
     The FreeBSD Japanese Documentation Project

     Original revision: 1.16
     $Id: chapter.sgml,v 1.2 1999-06-25 06:48:38 motoyuki Exp $
-->

<chapter id="kernelconfig">
  <title>FreeBSDカーネルのコンフィグレーション</title>

  <para><emphasis>原作: &a.jehamby;.
      <!-- <br> -->6 October 1995.</emphasis></para>

      <para><emphasis>訳: &a.jp.tomo;, &a.jp.yoshiaki;.
      <!-- <br> -->2 November 1996. </emphasis></para>

  <para>この章はシステムに合わせたカーネルの再構築の基礎について
    述べたものです.  この章は, システム管理の初心者から Unix
    システム管理に十分な経験を積んだ人までを対象としています.</para>

  <sect1>
    <title>なぜカスタムカーネルを作るか?</title>

    <para>システムに合わせたカーネルの構築はすべての
      Unixシステム管理者が
      避けて通ることのできない最も重要な通過儀礼の1つです.
      この作業は, 多くの時間を必要としますが, あなたの FreeBSD
      システムに多くの利益をもたらします.
      <literal>GENERIC</literal>カーネルは,
      めったに使われることのないハードウェアをサポートするとともに,
      考えられるすべての SCSIカードやネットワークカードをサポート
      しなければなりませんが, システムに合わせたカーネルは
      <emphasis>あなたの</emphasis> PC
      のハードウェアのみをサポートします.  これは,
      次にあげるような利益をもたらします.</para>

    <itemizedlist>
      <listitem>
	<para>あなたが持っていない
	  ハードウェアについては検出をおこなわな いので,
	  ブートにかかる時間が短くなります.</para>
      </listitem>

      <listitem>
	<para>システムに合わせたカーネルは多くの場合メモリ使用量が
	  減ります. カーネルはいつもメモリ上に存在するので,
	  不必要なコードがあると本来プログラムが利用できるはずの RAM
	  (実メモリ) を占めてしまいますのでこれは重要なことだ
	  といえます.  したがって, メモリが少ないシステムでは,
	  カーネルの再構築は大変重要です.</para>
      </listitem>

      <listitem>
	<para>必要に応じていくつかのカーネルオプションは調整すること
	  ができ, またサウンドカードのような GENERICカーネルには
	  <emphasis>ない</emphasis>
	  デバイスドライバをカーネルに含めることが できます.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 id="kernelconfig-building">
    <title>カスタムカーネルの構築とインストール</title>

    <para>まず,
      カーネル再構築に必要なディレクトリをざっと見てみましょう.
      ここではディレクトリはすべて
      <filename>/usr/src/sys</filename>以下の相対位 置で示します.
      また, <filename>/sys</filename>からもアクセス可能です.
      ここには, カーネルの各部分を構成するサブディレクトリが
      いくつもあります. しかし, 私たちの目的では 最も重要なのは
      <filename>i386/conf</filename>です. ここで, あなたの
      システムに合わせてカーネル コンフィグレーションを編集します.
      それから <filename>compile</filename>ディレクトリ,
      ここはカーネルが作られる 場所です.
      サポートされているデバイスやファイルシステムのディレ
      クトリツリーがオプション毎にサブディレクトリに分かれている論理
      的構成に注意してください. また,
      <filename>i386</filename>のディレクトリは
      PCのハードウェアのみを扱い,
      <filename>i386</filename>以外のディレクトリは
      FreeBSDが他のプラットフォームに移植される際には共有されるコー
      ドです.</para>

    <note>
      <para>もし, あなたのシステムに<filename>/usr/src/sys</filename>
	以下のディレクトリが<emphasis>なければ</emphasis>,
	カーネルのソースが インストールされていません.
	もっとも簡単な方法は (<username>root</username>で)
	<command>/stand/sysinstall</command>
	を用いて以下のようにします. <literal>設定(Configure)</literal>
	を選んでから <literal>配布ファイル(Distribution)</literal>
	を選択し, <literal>src</literal> の中の <literal>sys</literal>
	をインストールしてください.
      </para>
    </note>

    <para>つぎに, <filename>i386/conf</filename>に移動して,
      <filename>GENERIC</filename>
      コンフィグレーションファイルをカーネルに与えたい名前に
      コピーしてください. たとえば：</para>

    <screen>&prompt.root; <userinput>cd /usr/src/sys/i386/conf</userinput>
&prompt.root; <userinput>cp GENERIC MYKERNEL</userinput></screen>

    <para>慣習として, この名前はすべて大文字でつづられます. もし,
      いくつかの異なるハードウェアの FreeBSDマシンを扱うなら,
      この名前にホスト名を含めるとよいでしょう.  ここでは, 例として
      <filename>MYKERNEL</filename> と呼ぶことにします.</para>

    <note>
      <para>この作業は root権限でおこなう必要があります.
	そうでなければ, <errortype>permission
	  denied</errortype>というエラーが出ます.</para>
	</note>

    <para>では, <filename>MYKERNEL</filename>
      をあなたの好きなエディタで編集してください.  もし,
      システムをインストールしたばかりならば, 利用できるエディタは
      <command>vi</command>だけかもしれません. ここでは使い方
      の説明はしませんが, <link linkend="bibliography">参考図書</link>
      にあるような多くの本で詳しく説明 されていますので,
      そちらを参照してください. FreeBSD にはより簡単なエディタとして
      &ldquo;ee&rdquo があります. 初心者の方であればこちらをエディタ
      に選ぶとよいでしょう.
      まずファイルの最初の方のコメント行を編集し, あなたのコンフィグ
      レーションに合せて変更した点などを記述して
      <filename>GENERIC</filename> と区別がつく
      ようにしておきましょう.</para>

    <para>もし SunOSや他の BSDオペレーティングシステムでカーネルの
      再構築をしたことがあれば, このファイルはとても親しみ
      やすいでしょう. しかし, DOSのようなその他の
      オペレーティングシステムしか知らない人から見れば,
      <filename>GENERIC</filename>
      コンフィグレーションファイルはとても
      なじみにくいものかもしれません. そのような場合は, <link
	linkend="kernelconfig-config"> コンフィグレーションファイル
      </link> の節をゆっくりと注意深く読んでください.</para>

    <note>
      <para>古いバージョンの FreeBSD からアップグレードを
	おこなう場合,
	新しいカーネルソースを得た場所より新しいバージョンの
	&man.config.8; を取ってくる必要があるかもしれません.  これは
	<filename>/usr/src/usr.sbin</filename>にあります.
	したがってこれらのソースをダ ウンロードする必要があります.
	次のコマンドを実行する前に
	(configを)作りインストールをしておいてください.</para>
    </note>

    <para>編集し終ったら, 次のコマンドによってコンパイル, インストール
      を行ってください. </para>

    <screen>&prompt.root; <userinput>/usr/sbin/config MYKERNEL</userinput>
&prompt.root; <userinput>cd ../../compile/MYKERNEL</userinput>
&prompt.root; <userinput>make depend</userinput>
&prompt.root; <userinput>make</userinput>
&prompt.root; <userinput>make install</userinput></screen>

    <para>新しいカーネルはルートディレクトリに
      <filename>/kernel</filename>という 名前でコピーされ,
      今までのカーネルは <filename>/kernel.old</filename>
      という名前へ変更されます. では, システムをシャットダウン, リブー
      トして新しいカーネルを使ってください. うまく行かない場合は,
      この章の終りの <link
	linkend="kernelconfig-trouble">問題が起きた場合には</link>
      を参照してください. この章の新しい <link
	linkend="kernelconfig-noboot">カーネルがブートしない</link>
      場合のリカバリの方法を注意深く読んでおいてください.</para>

    <note>
      <para>(サウンドカードのような)新しいデバイスを 追加した場合は,
	使う前に <filename>/dev</filename>ディレクトリで
	デバイスノードを追加しなければならないかもしれません.
	詳しくは, <link linkend="kernelconfig-nodes">デバイスノード
	</link> を読んでください.</para>
    </note>
  </sect1>

  <sect1 id="kernelconfig-config">
    <title>コンフィグレーション ファイル</title>

    <para>コンフィグレーション ファイルの一般的なフォーマット
      はとてもシンプルです. 各行は1つのキーワードと1つ以上の
      引数を含んでいます. 見やすくするために, ほとんどのキーワードは
      引数を1つしか書いてありません.
      <literal>#</literal>に続くものはすべてコメントとして扱われ,
      無視されます. ここでは, それぞれのキーワードについて だいたい
      <filename>GENERIC</filename> に出てくる順番で説明します. しかし,
      お互いに関係のあるキーワードは, 実際には
      <filename>GENERIC</filename> ファイル上に
      バラバラに現れていても, (ネットワーキングのように)1つにまとめ
      てあります. <anchor id="kernelconfig-options"> おびただしい数の
      オプションの一覧が
      <filename>GENERIC</filename>と同じディレクトリの
      <filename>LINT</filename> コンフィグ
      レーションファイルにあります.  もし, ある行の目的や必要性に疑
      問を持ったら最初に <filename>LINT</filename>
      をチェックしてください.</para>

    <para>カーネルは現在, オプションを扱う方法をよりよい機構に移行しよ
      うとしています. 従来は, 各々のオプションは単純にカーネルの
      Makefile中の <acronym>CFLAGS</acronym>行の
      <option>-D</option>スイッチに変換されて いました.
      自然とオプションは際限なく増えて行きます. だれも実際に
      はどのオプションがどのファイルで参照されているかは知りません.
    </para>

    <para>新しい方法では, すべてのオプション依存の
      <literal>#ifdef</literal>は当該オプショ ンを
      <filename>opt_<replaceable>foo</replaceable>.h</filename>
      (これらのファイルは<command>config</command>によって
      compileディレ クトリに作られます)
      から読み込むように変わりました. <command>config</command>
      の有効なオプションのリストは2つのファイルにお かれます.
      アーキテクチャに依存しないオプションは
      <filename>/sys/conf/options</filename>に置かれ,
      アーキテクチャ依存のオプションは
      <filename>/sys/<replaceable>arch</replaceable>/conf/options</filename>
      に置かれます. <emphasis>arch</emphasis> の部分は例えば
      <filename>i386</filename>となります.</para>

    <sect2>
      <title>必須キーワード</title>

      <para>ここにあるキーワードはカーネルの構築に必要不可欠です.
      </para>

      <variablelist>
	<varlistentry><term><literal>machine "i386"</literal></term>
	  <listitem>
	    <para>最初のキーワードは <literal>machine</literal>です.
	      FreeBSDは Intelの 386(とその互換)チップあるいは alpha 
	      プロセッサ上でのみ動作するので
             <replaceable>i386</replaceable> か
             <replaceable>alpha</replaceable>を指定します.</para>

	    <note>
	      <para>数字を含むキーワードはすべて
		クォーテーションマークで囲む必要があります.
		そうせずに,<literal>machine i386</literal> と入力すると
		<command>config</command>は混乱して
		386を実際の数値として扱ってしまいます.</para>
	    </note>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>cpu "<replaceable>cpu_type</replaceable>"</literal></term>
	  <listitem>
	    <para>次のキーワードは <literal>cpu</literal>です.
	      FreeBSDでサポートしている CPUの中から記述します.
	      i386 システムでは<replaceable>cpu_type</replaceable>
	      として指定可能な値は次の通りです: </para>

	    <itemizedlist>
	      <listitem>
		<para>I386_CPU</para>
	      </listitem>

	      <listitem>
		<para>I486_CPU</para>
	      </listitem>

	      <listitem>
		<para>I586_CPU</para>
	      </listitem>

	      <listitem>
		<para>I686_CPU</para>
	      </listitem>
	    </itemizedlist>

           <para>Alpha システムでは指定可能な
	   <replaceable>cpu_type</replaceable> は
               次の通りです: </para>

           <itemizedlist>
             <listitem>
               <para>EV4</para>
             </listitem>
             
             <listitem>
               <para>EV5</para>
             </listitem>
            </itemizedlist>

	    <para><filename>GENERIC</filename> カーネルのように
	      <literal>cpu</literal>の行の
	      <replaceable>cpu_type</replaceable>
	      が異なった値を持つものが 複数あってもかまいません.
	      カスタムカーネルでは, あなたが持っている
	      cpuを1つだけ指定するのが 一番です. 例えば, もし Intelの
	      Pentiumを持っていれば,
	      <replaceable>cpu_type</replaceable>には,
	      <literal>I586_CPU</literal> を使ってください.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>ident <replaceable>machine_name</replaceable></literal></term>
	  <listitem>
	    <para>次は,
	      カーネルの識別名となる<literal>ident</literal>です.
	      <literal>GENERIC</literal>
	      からあなたがカーネルに与えたい名前に 変えてください.
	      ここでは, <literal>MYKERNEL</literal> とします.
	      <literal>ident</literal>に与えた名前はカーネルの
	      ブート時に表示されるので, 普段のカーネルとは別に
	      カーネルに違う名前を与えたいとき(例えば,
	      実験用のカーネルを作りたい時など), 便利でしょう.
	      数字を含む名前にしたい場合は
	      <literal>machine</literal>や <literal>cpu</literal>
	      の時と同じようにクォーテーションマークで
	      囲む必要があります.</para>

	    <para>C コンパイラに <option>-D</option>
	      スイッチで渡されるので,
	      <literal>DEBUG</literal>のような名前にしたり,
	      <literal>vax</literal>
	      といった他のCPUの名前など紛らわしい名前にしないで
	      ください.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>maxusers <replaceable>number</replaceable></literal></term>
	  <listitem>
	    <para>これは, 重要なシステムテーブルのサイズを決めます.
	      ここ
	      で与えられる数字はマシンに同時にログインすると考えられ
	      るおよそのユーザ数です. しかし, 通常の使用環境であれば,
	      特に X Window System を立ち上げたり, ソフトウェアを
	      コンパイルするような使用であれば
	      <literal>maxusers</literal>には少 なくとも
	      <literal>4</literal> 以上を指定したほうがいいでしょう.
	      その理由は, <literal>maxusers</literal>
	      で決るテーブルで最も重要なものはプロセス
	      の最大数であるからです. プロセス最大数は <literal>20 +
		16 * maxusers</literal>で与えられ,
	      <literal>maxusers</literal>を<literal>1</literal>
	      にすると36プロセスしか同時には持てません. この中にはブー
	      ト時にシステムによって起動する18個ぐらいのプロセス, Xを
	      起動する時の15程度のプロセスも含みます. <!-- kuriyama -
	      should be katakana -->
	      manページを読むという1つのタスクでさえ, フィ
	      ルタやファイル伸長や表示のために9つのプロセスを起動し
	      ます. <literal>maxusers</literal>を<literal>4</literal>
	      にすれば, 同時に84個のプロセ
	      スを持つことができるのでどんな人でも十分な数だといえる
	      でしょう.  それでも他のプログラムを起動した場合に,
	      あるいは,  (Walnut Creek CDROMのFTPサイトのように)
	      同時に多くの ユーザを抱えるサーバを走らせた場合に
	      <errorname>proc table full</errorname>
	      というおぞましいエラーが起きる場合はこの値を増や し,
	      カーネルを再構築してください.</para>

	    <note>
	      <para><literal>maxuser</literal>はあなたのマシン
		にログインできるユーザの数を制限するものでは
		<emphasis>ありません</emphasis>. 単に,
		あなたのシステムに
		ログインするユーザ数の最大値と各々のユーザが
		いくつのプロセスを走らせるかを考慮することに
		よってさまざまなテーブルの値を適切な値に設定
		するだけです. これに対し, <link
		  linkend="kernelconfig-ptys">pseudo-device pty
		  16</link>の <emphasis>remote
		  logins</emphasis>というキーワードは
		同時にリモートログインできるユーザ数を制限
		<emphasis>します</emphasis>.</para>
	    </note>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>config <replaceable>kernel_name</replaceable> root on <replaceable>root_device</replaceable></literal></term>
	  <listitem>
	    <para>これはカーネルの位置と名前を特定します.
	      伝統的にカーネルは
	      <filename>vmunix</filename>と呼ばれますが,  FreeBSDでは
	      <filename>kernel</filename>とふさわしい名前になりました.
	      <replaceable>kernel_name</replaceable>にはいつも
	      <literal>kernel</literal> を 使ってください.
	      名前を変えると多くのシステム
	      ユーティリティが使えなくなります. 2番目の部分は
	      ルートファイルシステムとカーネルのあるディスクと
	      パーティションを指定してください.
	      SCSIドライブでなければ, <literal>wd0</literal>を,
	      SCSIドライブならば <literal>da0</literal>です.</para>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2>
      <title>一般的なオプション</title>

      <para>以下はカーネルのサポートするさまざまなファイルシステムおよ
	びその他のオプションです.</para>

      <variablelist>
	<varlistentry><term><literal>options MATH_EMULATE</literal></term>
	  <listitem>
	    <para>これは, 数値演算コプロセッサがない コンピュータ
	      (386や486SX) で数値演算コプロセッサ
	      のエミュレーションを可能にします. もし, Pentiumや 486DX,
	      あるいは387や487があれば, コメントアウト
	      できます.</para>

	    <note>
	      <para>FreeBSD付属の数値演算
		コプロセッサエミュレータはあまり正確では
		<emphasis>ありません</emphasis>.
		非常に正確な計算をおこないたい ならば, より優れた
		GNUのエミュレータである
		<literal>GPL_MATH_EMULATE</literal>に変えることを
		おすすめします. これはライセンスの関係でデフォルトでは
		含まれていません.</para>
	    </note>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>options "COMPAT_43"</literal></term>
	  <listitem>
	    <para>4.3BSDとの互換性のためのオプションです.
	      そのままにしておいてください. コメントアウトすると,
	      いくつかのプログラムで動作がおかしくなります.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>options BOUNCE_BUFFERS</literal></term>
	  <listitem>
	    <para>ISAデバイスやISA互換モードで動作する EISAデバイス
	      では DMA (Direct Memory Access) は16MB以下のメモリに対し
	      てのみ動作します. このオプションによりメモリが16MB以上
	      のシステムで DMA
	      を使うデバイスを動作させることができます.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>options UCONSOLE</literal></term>
	  <listitem>
	    <para>ユーザがコンソールを横取り (grab)
	      できるようにします.  これは X Window System
	      上で便利です. 例えば, コ ンソール xtermを <command>xterm
		-C</command>とタイプして作ると,  そこに
	      <command>write</command>, <command>talk</command>
	      などのメッセージがカーネルからコ
	      ンソールへ送られるメッセージと同じように表示されます.
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>options SYSVSHM</literal></term>
	  <listitem>
	    <para>このオプションは System V の共有メモリを提供します.
	      X Window System の XSHM拡張での利用がもっとも一般に見
	      られる例で, 多くのグラフィックを多用したプログラム
	      (movie player の Xanimや Linux DOOMなど) ではこれを
	      利用することで速度が増加するというメリットがあります. X
	      Window System を利用するのであればこれは間違いな
	      く含めたくなるでしょう.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>options SYSVSEM</literal></term>
	  <listitem>
	    <para>System V のセマフォをサポートします.
	      一般的に利用される
	      ことは少ないですがカーネルサイズの増加は数百バイトだ
	      けです.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>options SYSVMSG</literal></term>
	  <listitem>
	    <para>System V のメッセージをサポートします.
	      これを指定した場
	      合もカーネルサイズの増加は数百バイトだけです.</para>

	    <note>
	      <para>&man.ipcs.1; コマンドは これらの System V
		の機構を利用しているプロセスを表示し ます.</para>
	    </note>

	    <note>
	      <para><emphasis>訳注: </emphasis>共有メモリ, セマフォ,
		メッセージ(メッ セージキュー)  は System V系
		で一般的なプロセス間通信の機 構です. くわしくは System
		Vのプロセス間通信に関する文 献, 「詳解
		UNIXプログラミング」 (ソフトバンク) , 「UNIXネッ
		トワークプログラミング」 (トッパン)
		などを参照してくださ い.</para>
	    </note>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2>
      <title>ファイルシステムオプション</title>

      <para>これらのオプションはさまざまなファイルシステムへのサポート
	を追加します. 少なくともブートするためのデバイスのサポートを含
	める必要があります. 標準的にはハードディスクからブートするので
	あれば <acronym>FFS</acronym> ,
	ディスクレスワークステーションとしてイー
	サネットからブートするのであれば <acronym>NFS</acronym>です.
	一般的に利用される他のファイルシステムをカーネルに含め, あまり
	利用しないファイルシステム (多分 MS-DOSファイルシステム?)
	のサポー トをコメントアウトすることができます. これは
	Kernel Module ディレクトリ <filename>/modules</filename> から,
	最初にそのタイプのファイ ルシステムがマウントされる時に
	動的にドライバがロードされるからです.</para>

      <variablelist>
	<varlistentry><term><literal>options FFS</literal></term>
	  <listitem>
	    <para>基本的なハードドライブ ファイルシステムです.
	      ハードディ
	      スクからブートする場合は残しておいてください.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>options NFS</literal></term>
	  <listitem>
	    <para>ネットワーク ファイルシステムです. Ethernet経由で
	      Unixファ
	      イルサーバからパーティションをマウントする予定がない場
	      合はコメントアウトすることができます.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>options MSDOSFS</literal></term>
	  <listitem>
	    <para>MS-DOS ファイルシステムです. ブート時に
	      DOSフォーマット のハード
	      ドライブをマウントする予定のない場合はコメン
	      トアウトしても安全です. 先に示したように, DOSパーティ
	      ションをマウントする時に自動的にロードされます. また
	      (ports コレクションにある)
	      <application>mtools</application> という素晴
	      らしいソフトウェアにより mount , unmountなしで DOSフロッ
	      ピーにアクセスすることができます (これは MSDOSFSも必要
	      ありません).</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>options "CD9660"</literal></term>
	  <listitem>
	    <para>CD-ROMのための ISO 9660 ファイルシステムです.
	      CD-ROMを 持っていないか, 時々 データ
	      CDをマウントするだけならコ メントアウトしましょう
	      (データ CDを最初にマウントする
	      時に動的にロードされます). オーディオ CDはこのファイル
	      システムは必要ありません.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>options PROCFS</literal></term>
	  <listitem>
	    <para>プロセス ファイルシステムです.
	      これは疑似的なファイルシ ステムで
	      <filename>/proc</filename> にマウントされ,
	      &man.ps.1; などのプロ
	      グラムがプロセスに関してより詳しい情報を与えてくれるよ
	      うになります.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>options MFS</literal></term>
	  <listitem>
	    <para>メモリマップド ファイルシステムです.
	      これは基本的に一時 ファイルを記憶するための高速な
	      RAMディスクで, 大きな swap領域がある場合に有効です.
	      MFSパーティションをマウ
	      ントするに適した場所は多くのプログラムが一時ファイルを
	      置く <filename>/tmp</filename>です. MFS RAMディスクを
	      <filename>/tmp</filename> にマウントするには以下の内容を
	      <filename>/etc/fstab</filename>に追 加してリブートするか
	      <command>mount /tmp</command>とタイプします.</para>

	    <programlisting>
/dev/wd1s2b   /tmp mfs rw 0 0</programlisting>

	    <note>
	      <para><filename>/dev/wd1s2b</filename>をあなたが使用して
		いるswap パーティションに置き換えてください. これは以
		下のように <filename>/etc/fstab</filename>
		に書かれているでしょう.
	      </para>

	      <programlisting>
/dev/wd1s2b none swap sw 0 0</programlisting>
	    </note>

	    <note>
	      <para>また, <acronym>MFS</acronym> ファ
		イルシステムは動的にロードすることは
		<emphasis>できません </emphasis>.
		したがって使いたい場合はコンパイル時に カーネルに
		<emphasis>含める必要があります</emphasis>.</para>
	    </note>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>options "EXT2FS"</literal></term>
	  <listitem>
	    <para>Linux のファイルシステム. ext2fs のサポートにより,
	      Linux パーティションを読み書きすることができます.
	      これは, FreeBSD と Linux
	      のデュアルブートシステムにおいて
	      両者でデータを共有したい場合に有用です.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>options QUOTA</literal></term>
	  <listitem>
	    <para>ディスククォータを有効にします.
	      アクセスが公開されてい るシステムで (一人のユーザが)
	      <filename>/home</filename>パーティショ ン (全体)
	      をあふれさせることができないようにそれぞれのユーザ
	      にディスククォータを発行することができます.
	      ディスククォータについての詳しい内容は<link
		linkend="quotas">ディスク
		クォータ</link>の章を見てください.</para>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2>
      <title>基本的なコントローラとデバイス</title>

      <para>この節では FreeBSDでサポートされているディスク, テー プ,
	CD-ROMコントローラについて示します.  <link
	  linkend="kernelconfig-scsi">SCSI</link> コントローラと <link
	  linkend="kernelconfig-network">ネットワーク</link>
	カードについ ては別の節になっています.</para>

      <variablelist>
	<varlistentry><term><literal>controller isa0</literal></term>
	  <listitem>
	    <para>FreeBSD のサポートするすべての PCで必要です. IBM
	      PS/2 (マイ クロチャネルアーキテクチャ) では現時点では
	      FreeBSDは動 きません.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>controller pci0</literal></term>
	  <listitem>
	    <para>PCIバスを持つマザーボードの場合は含めます.
	      これにより PCIカードの自動認識と PCIから
	      ISAバスへのゲートウェイが 可能になります.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>controller fdc0</literal></term>
	  <listitem>
	    <para>フロッピードライブコントローラです.
	      <literal>fd0</literal> は <devicename>A:</devicename>
	      ドライブで <literal>fd1</literal> は
	      <devicename>B:</devicename> ドライブです.
	      <literal>ft0</literal> は
	      フロッピーコントローラに接続する QIC-80 テープドライブで
	      す. 対応するデバイスがない場合はそれぞれの行をコメント
	      アウトしてください.</para>

	    <note>
	      <para>QIC-80テープのサポートは別に
		&man.ft.8; というフィルタプログラムが必要です.
		くわしくはマニュアルページを見てください.</para>
	    </note>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>controller wdc0</literal></term>
	  <listitem>
	    <para>プライマリIDEコントローラです.
	      <literal>wd0</literal> と
	      <literal>wd1</literal>はそれぞれマスタ,
	      スレーブドライブで す. <literal>wdc1</literal> は
	      セカンダリの IDEコントローラで3台 目,
	      4台目のハードディスクまたは IDE CD-ROMのある場合に
	      使います. 利用しない行はコメントアウトしてください (例え
	      ば, SCSIハードディスクのみを使う場合は6行全部をコメント
	      アウトしてもよいかもしれません).</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device wcd0<anchor id="kernelconfig-atapi"></literal></term>
	  <listitem>
	    <para>このデバイスは IDE CD-ROMのサポートをします.
	      <literal>wdc0</literal>を有効にしておく必要があり, もし
	      2つ以上の IDE コントローラがあり, そのうちの
	      2つ目のカードに CD-ROMを接 続する場合
	      <literal>wdc1</literal> も必要です. また
	      <literal>options ATAPI</literal>
	      を書いておく必要もあります.</para>
		</listitem>
	</varlistentry>

	<varlistentry><term><literal>device npx0 at isa? port "IO_NPX" irq 13 vector npxintr</literal></term>
	  <listitem>
	    <para><literal>npx0</literal> は FreeBSD
	      ハードウェアコプロセッサとソフト
	      ウェアエミュレータ両方の浮動小数点演算ユニットへのインタ
	      フェースです.  これは <emphasis>不可欠</emphasis>
	      です.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device wt0 at isa? port 0x300 bio irq 5 drq 1 vector wtintr</literal></term>
	  <listitem>
	    <para>Wangtek と Archive の QIC-02/QIC-36
	      テープドライブのサポートです.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term>Proprietary CD-ROM support</term>
	  <listitem>
	    <para>以下のようなドライブを
	      <emphasis>proprietary</emphasis>(独自の) CD-ROM
	      ドライブと呼ぶことにします. これらのドライブは専
	      用のコントローラを持つか, サウンドブラスタ16などのサウ
	      ンドカードに接続します. これらは IDEでも
	      SCSIでも<emphasis>あ りません</emphasis>.
	      多くの標準速や2倍速の古い CD-ROMはこれら
	      のインタフェースを持っていますが, より新しい四倍速の
	      ものは <link linkend="kernelconfig-atapi">IDE</link> か
	      <link linkend="kernelconfig-scsi">SCSI</link>
	      でしょう.</para>

	    <variablelist>
	      <varlistentry><term><literal>device mcd0 at isa? port 0x300 bio irq 10 vector mcdintr</literal></term>
		<listitem>
		  <para>ミツミ製 CD-ROM (LU002,
		    LU005, FX001D)です.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>device scd0 at isa? port 0x230 bio</literal></term>
		<listitem>
		  <para>ソニー製 CD-ROM (CDU31,CDU33A)です.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>controller matcd0 at isa? port ? bio</literal></term>
		<listitem>
		  <para>松下/パナソニック製 CD-ROM (サウンドブラスタ用
		    クリエィティブ ラボ製として販売されていました)
		    です.</para>
		</listitem>
	      </varlistentry>
	    </variablelist>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2 id="kernelconfig-scsi">
      <title>SCSI デバイスのサポート</title>

      <para>この節では FreeBSDのサポートするいろいろな SCSIコント
	ローラとデバイスのサポートについて書きます.</para>

      <variablelist>
	<varlistentry><term>SCSI コントローラ</term>
	  <listitem>
	    <para>以下の十数行は異る種類の
	      SCSIコントローラのサポートです.
	      使用しているもの以外の部分は
	      コメントアウトしてください.</para>

	    <variablelist>
	      <varlistentry><term><literal>controller bt0 at isa? port "IO_BT0" bio irq ? vector btintr</literal></term>
		<listitem>
		  <para>ほとんどの Buslogic社のコントローラです.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>controller uha0 at isa? port "IO_UHA0" bio irq ? drq 5 vector uhaintr</literal></term>
		<listitem>
		  <para>UltraStor 14F と 34F です.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>controller ahc0</literal></term>
		<listitem>
		  <para>Adaptec 274x/284x/294x です.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>controller ahb0    at isa? bio irq ? vector ahbintr</literal></term>
		<listitem>
		  <para>Adaptec 174x です.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>controller aha0    at isa? port "IO_AHA0" bio irq ? drq 5 vector ahaintr</literal></term>
		<listitem>
		  <para>Adaptec 154x です.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>controller aic0    at isa? port 0x340 bio irq 11 vector aicintr</literal></term>
		<listitem>
		  <para>Adaptec 152x や
		    サウンドカードなどに使われている Adaptec AIC-6360
		    チップです.  (slow!)</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>controller nca0    at isa? port 0x1f88 bio irq 10 vector ncaintr</literal></term>
		<listitem>
		  <para>NCR 5380を使っている ProAudioSpectrum や
		    Trantor T130 で す.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>controller sea0    at isa? bio irq 5 iomem 0xc8000 iosiz 0x2000 vector seaintr</literal></term>
		<listitem>
		  <para>Seagate ST01/02 8 ビットコントローラです.
		    (slow!)</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>controller wds0    at isa? port 0x350 bio irq 15 drq 6 vector wdsintr</literal></term>
		<listitem>
		  <para>Western Digital WD7000コントローラです.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>controller ncr0</literal></term>
		<listitem>
		  <para>NCR 53C810, 53C815, 53C825, 53C860, 53C875
		    チップを使った  PCI SCSI コントローラです.</para>

                 <note>
                   <para>これにより Diamond FirePort コントローラも
                     サポートします.</para>
                 </note>

		</listitem>
	      </varlistentry>
	    </variablelist>
	  </listitem>
	</varlistentry>

	<varlistentry>
	<term><literal>options "SCSI_DELAY=15000"</literal></term>
	  <listitem>
	    <para>このオプションによりカーネルはそれぞれの
	      SCSIデバイスをプローブする前に 15秒間待ちます.
	      IDEドライブのみを使用している場合は無視して構いません.
	      ブートを速くするためにこの数値を
	      5秒ぐらいまで小さくしたいでしょう. そうした場合,
	      FreeBSDが SCSIデバイスを認識しにくくなるかもしれません.
	      その時は, もちろんこのオプションの値は元に戻
	      さないといけません.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>controller scbus0</literal></term>
	  <listitem>
	    <para>SCSIコントローラがある場合, この行で
	      SCSI全般のサポー トを与えます. SCSIのない場合,
	      この行と以下の3つの行をコメ
	      ントにすることができます.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device da0</literal></term>
	  <listitem>
	    <para>SCSIハードディスクのサポートです.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device st0</literal></term>
	  <listitem>
	    <para>SCSIテープドライブのサポートです.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device cd0</literal></term>
	  <listitem>
	    <para>SCSI CD-ROM のサポートです.</para>

	    <para>上のエントリについている
	      <literal>0</literal>はいくらか誤解を招き
	      やすいかもしれません. これらのデバイスはすべてカーネルが
	      見つけた時に割り当てがおこなわれ,
	      SCSIバスに何台つながってい るか, ターゲット
	      IDが何番であるかはここの記述とは関係あ りません.</para>

	    <para>明示的に &ldquo;固定的な&rdquo;ターゲット
	      IDの特定のデバイスへの 割り当てをおこないたい場合は
	      <filename>LINT</filename>
	      カーネルコンフィグレーションファイルの
	      該当する部分の説明を参照してください.</para>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2>
      <title>コンソール, バスマウス, キーボード, Xサーバのサポート</title>

      <para>2 つのタイプのコンソールからどちらか 1
	つを選ぶ必要があります. 標準ではない方の vt220
	コンソールを選んだ場合, X Window System を利用するには XSERVER
	オプションを有効にする必要があります (訳注: sc0 には XSERVER
	オプション相当の機能が始めから入っています).
	またバスマウスと PS/2 マウスのオプションもあります.</para>

      <variablelist>
	<varlistentry><term><literal>device sc0 at isa? port "IO_KBD" tty irq 1 vector scintr</literal></term>
	  <listitem>
	    <para><literal>sc0</literal>
	      はデフォルトのコンソールドライバで SCOコン
	      ソールに似ています. このデバイス, あるいは VT220コンパ
	      チブルドライバの
	      <literal>vt0</literal>いずれを使う場合もほとんど
	      のフルスクリーンプログラムは
	      <filename>termcap</filename>などのターミナルデータベース
	      ライブラリを通してアクセスしますので,
	      あまり違いはないでしょう.
	      このコンソールを使う場合でフルスクリーンプログラムでト
	      ラブルが起きる場合にはログインした時に
	      <envar>TERM</envar>変数の値を
	      &ldquo;scoansi&rdquo;にしてください.</para>
	  </listitem>
	</varlistentry>

       <varlistentry>
         <term><literal>controller atkbdc0 at isa? port IO_KBD
             tty</literal></term>

         <listitem>
           <para> <literal>atkbdc</literal> はキーボードコントローラで
	     ATキーボードと PS/2タイプのポインティングデバイスを
	     サポートします. このコントローラはキーボードドライバの
	     <literal>atkbd</literal> と PS/2 ポインティングデバイス
	     ドライバの<literal>psm</literal>が必要とします.
           </para>

           <variablelist>
             <varlistentry>
               <term><literal>options 
                 "KBD_RESETDELAY=<replaceable>X</replaceable>", options 
                 "KBD_MAXWAIT=<replaceable>Y</replaceable>"</literal></term>

               <listitem>
                 <para>キーボードドライバの <literal>atkbd</literal>
                   と <literal>atkbd</literal> はブート処理を行なっている
		   時にデバイスのリセットを行なうために
		   <literal>atkbdc</literal> に要求を出すでしょう. 
		   デバイスがリセットコマンドに対して応答を返すまでに
		   長い時間がかかる場合があります. これらのオプション
                   は <literal>atkbdc</literal> がどれだけの時間待つか
                   を制御します &mdash; ドライバは最大
		    <replaceable>X</replaceable> *
		      <replaceable>Y</replaceable> ミリ秒待ちます.
		   もし, ドライバがデバイスを見つけることが
		   できないようであれば, これらの値を増やすことが
		   できます. デフォルト値は
                   <replaceable>X</replaceable>
		   が 200m秒で <replaceable>Y</replaceable> は5回です.
		   </para>
               </listitem>
             </varlistentry>
             <varlistentry>
               <term><literal>options 
                 "KBDIO_DEBUG=<replaceable>N</replaceable>"</literal></term>

               <listitem>
                 <para>デバッグレベルを <replaceable>N</replaceable>
                 に設定します.
		 デフォルト値は 0 で, デバッグ出力は全て抑制されます.
                  </para>
               </listitem>
             </varlistentry>
           </variablelist>

           <note>
             <para><literal>atkbdc</literal>デバイスはシステム中
	     設定できるのは一つだけです.
             </para>
           </note>
         </listitem>
       </varlistentry>

       <varlistentry>
         <term><literal>device atkbd0 at isa? tty irq 1</literal></term>

         <listitem>
           <para><literal>atkbd</literal> ドライバは, together with the
             <literal>atkbdc</literal> コントローラと一緒に利用され,
	     ATキーボードコントローラに接続された AT 84 キーボードや
             AT拡張キーボード のアクセスを提供します.
           </para>
         </listitem>
       </varlistentry>

	<varlistentry><term><literal>device vt0 at isa? port "IO_KBD" tty irq 1 vector pcrint</literal></term>

	  <listitem>
	    <para>これはVT-220コンパチブルコンソールドライバで
	      VT100/102の 上位互換です. これは
	      <literal>sc0</literal>の使えない種類のラッ
	      プトップ機でもうまく動きます. ログイン時に
	      <envar>TERM</envar>変数の値 を<literal>>vt100</literal>
	      か <literal>vt220</literal>にしてください. また,
	      このドラ
	      イバはネットワークを介して多くの異るマシンから接続する
	      場合も便利です.
	      <devicename>sc0</devicename>デバイスのための
	      <filename>termcap</filename>や
	      <filename>terminfo</filename>エントリは必ずしも
	      利用できるわけではありませんが &mdash;
	      <literal>vt100</literal>はいずれの
	      プラットフォームでも利用可能でしょう.</para>

	    <variablelist>
	      <varlistentry><term><literal>options "PCVT_FREEBSD=210"</literal></term>
		<listitem>
		  <para><literal>vt0</literal>
		    コンソールドライバを使う場合に必要で す.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>options XSERVER</literal></term>
		<listitem>
		  <para><literal>vt0</literal>
		    コンソールドライバを使う時のみ有効です. これは
		    <literal>vt0</literal> コンソールドライバのもとで
		    <application>XFree86</application> X
		    サーバを動かすのに必要なコードを含めます.</para>
		</listitem>
	      </varlistentry>
	    </variablelist>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device mse0 at isa? port 0x23c tty irq 5 vector ms</literal></term>
	  <listitem>
	    <para>Logitech や
	      ATIのバスマウス入力カードを利用する場合のデ
	      バイスです.</para>

	    <note>
	      <para>シリアルマウスを使う場合にはこれら2つ
		の行(バスマウスとPS/2マウスに関する行) は無視して,
		代わりに <link
		  linkend="kernelconfig-serial">シリアル</link>
		ポート(おそらくはCOM1)を有効にしてくだ さい.</para>
	    </note>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device psm0 at isa? port "IO_KBD" conflicts tty irq 12 vector psmintr</literal></term>
	  <listitem>
	    <para>このデバイスは
	      PS/2マウスポートにマウスを接続する場合に
	      使います.</para>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2>
      <title>シリアル, パラレルポート</title>

      <para>ほとんどすべてのシステムにこれらはあります.
	プリンタを接続す る場合は <link
	  linkend="printing">プリンタの利用</link>の章が非常
	に役に立つでしょう. モデムを使う場合は <link
	  linkend="dialup">ダイヤルアップ アクセス</link>
	に非常に詳しいシリアルポートの設定とデ
	バイスの使い方があります.</para>

      <variablelist>
	<varlistentry><term><literal>device sio0 at isa? port "IO_COM1" tty irq 4 vector siointr</literal><anchor id="kernelconfig-serial"></term>
	  <listitem>
	    <para><literal>sio0</literal>から<literal>sio3</literal>は
	      MS-DOSにおける COM1から
	      COM4に相当する4本のシリアルポートです.
	      COM4に内蔵モデムがあり COM2を使う場合, FreeBSDからアク
	      セスするためにはモデムのIRQを2へ変更する必要があるとい
	      うことを注意しておきます (技術的な理由より IRQ 2 = IRQ
	      9となります).
	      マルチポートシリアルカードを使う場合にマニュアルページ
	      の &man.sio.4; にはこのオプションで使う値などのよ
	      り多くの情報があります. ビデオカードの中には (特に S3
	      チップベースのものには) IOアドレスの
	      <literal>0x*2e8</literal>から を利用するものがあり,
	      また多くの安価なシリアルカードは
	      IOアドレス空間を16-bitフルデコードしていませんので, こ
	      れらのカードは衝突します. この場合 COM4ポートは実質上
	      利用できません.</para>

	    <para>それぞれのシリアルポートは
	      (割込みの共有をサポートした
	      マルチポートカードを利用していないのであれば) 別々の IRQ
	      を割り当てる必要がありますので COM3と COM4のデフォルトの
	      IRQは利用できません.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device lpt0 at isa? port? tty irq 7 vector lptintr</literal></term>
	  <listitem>
	    <para><literal>lpt0</literal> から
	      <literal>lpt2</literal>は利用可能な3本のプリン
	      タポートです. 多くの場合は1本のみですので他の2本はない
	      のであればコメントアウトして構いません.</para>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2 id="kernelconfig-network">
      <title>ネットワーク</title>

      <para>FreeBSDでは他の一般的な
	Unixと同様にネットワークが<emphasis>非常に</emphasis>
	重視されています. イーサネットカードが
	なくても必須のオプションとダイヤルアップ ネットワークのサポー
	トに注意してください.</para>

      <variablelist>
	<varlistentry><term><literal>options INET</literal></term>
	  <listitem>
	    <para>ネットワーキングのサポートです.
	      ネットワークに接続する予定がな
	      くても残しておいてください.
	      多くのプログラムは少なくともループ
	      バックネットワーキングが必要です(つまり,
	      PCの中でネットワーク コネクションをおこないます).
	      したがってこのオプションは本質的 に不可欠です.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term>Ethernet cards</term>
	  <listitem>
	    <para>以下にさまざまなイーサネットカードを
	      有効にするオプショ ンを示します.
	      ネットワークカードがなければこれらすべてを
	      コメントアウトすることができます. そうでなければ利用す
	      る特定のイーサネットカードをサポートするオプションを残
	      しておきます.</para>

	     <variablelist>
	      <varlistentry>
               <term><literal>device cs0</literal></term>

               <listitem>
                 <para>IBM Etherjet 及び クリスタル・セミコンダクタ社
                   の CS89x0ベースのアダプタです.</para>
               </listitem>
             </varlistentry>

	      <varlistentry><term><literal>device de0</literal></term>
		<listitem>
		  <para>DECの DC21040, DC21041, DC21140チップを使った
		    PCIイーサネットアダプタです.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>device fxp0</literal></term>
		<listitem>
		  <para>Intel EtherExpress Pro/100B
		    高速イーサネットカード です.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>device vx0</literal></term>
		<listitem>
		  <para>3Com の 3C590, 3C595です (いくらか
		    bugがあります).</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>device cx0 at isa? port 0x240 net irq 15 drq 7 vector cxintr</literal></term>
		<listitem>
		  <para>Cronyx/Sigma の
		    マルチポート同期/非同期カードです.  (with Cisco or
		    PPP framing)</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>device ed0 at isa? port 0x280 net irq 5 iomem 0xd8000 vector edintr</literal></term>
		<listitem>
		  <para>Western Digital と SMC の 80xx, 8216 Elite
		    Ultra ;  ノベル NE1000, NE2000; 3Com の 3C503;
		    HPの PC Lan Plus  (HP27247B とHP27252A)
		    です.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>device el0 at isa? port 0x300 net irq 9 vector elintr</literal></term>
		<listitem>
		  <para>3Com の 3C501 です. (slow!)</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>device eg0 at isa? port 0x310 net irq 5 vector egintr</literal></term>
		<listitem>
		  <para>3Com の 3C505です.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>device ep0 at isa? port 0x300 net irq 10 vector epintr</literal></term>
		<listitem>
		  <para>3Com の 3C509 です(バグがあります).</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>device fe0 at isa? port 0x240 net irq ? vector feintr</literal></term>
		<listitem>
		  <para>富士通 MB86960A/MB86965A
		    ベースのイーサネットカード です.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>device fea0 at isa? net irq ? vector feaintr</literal></term>
		<listitem>
		  <para>DEC DEFEA EISA FDDI アダプタです.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>device ie0 at isa? port 0x360 net irq 7 iomem 0xd0000 vector ieintr</literal></term>
		<listitem>
		  <para>AT&amp;T StarLAN 10 と EN100; 3Com の 3C507;
		    NI5210; Intel EtherExpress 16 です.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>device le0 at isa? port 0x300 net irq 5 iomem 0xd0000 vector le_intr</literal></term>
		<listitem>
		  <para>DEC の EtherWorks 2 and EtherWorks
		    3 (DEPCA, DE100, DE101, DE200, DE201, DE202,
		    DE203, DE204, DE205, DE422)です.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>device lnc0 at isa? port 0x300 net irq 10 drq 0 vector lncintr</literal></term>
		<listitem>
		  <para>Lance/PCnet カード (Isolan, Novell NE2100,
		    NE32-VL)です.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>device ze0 at isa? port 0x300 net irq 5 iomem 0xd8000 vector zeintr</literal></term>
		<listitem>
		  <para>IBM/ナショナルセミコンダクタの PCMCIA
		    イーサネット コントローラです.</para>
		</listitem>
	      </varlistentry>

	      <varlistentry><term><literal>device zp0 at isa? port 0x300 net irq 10 iomem 0xd8000 vector zpintr</literal></term>
		<listitem>
		  <para>3Com の PCMCIA Etherlink III です.</para>
		</listitem>
	      </varlistentry>
	    </variablelist>

	    <note>
	      <para>いくつかのカードでは (特に NE2000では)
		&ldquo;標準値&rdquo; がありませんので
		IOポートやIRQの値を変更す
		る必要がある場合があります.</para>
	    </note>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>pseudo-device loop</literal></term>
	  <listitem>
	    <para><literal>loop</literal> は
	      TCP/IPの一般的なループバックデバイスで す.  telnet や
	      FTPを <hostid>localhost</hostid> (<hostid
		role="ipaddr">127.0.0.1</hostid>)
	      に対して行なうとこの疑似デバイスを通して帰ってきます.
	      不可欠です.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>pseudo-device ether</literal></term>
	  <listitem>
	    <para><literal>ether</literal>
	      はイーサネットカードがある場合のみ必要で
	      一般的なイーサネットプロトコルを含めます.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>pseudo-device sl <replaceable>number</replaceable></literal></term>
	  <listitem>
	    <para><literal>sl</literal> は SLIP (Serial Line Internet
	      Protocol) をサポー トします. これはほとんど完全に,
	      より簡単に設定ができ, モ デム to モデム接続に適した,
	      よりパワフルな PPPに取って代 わられています.
	      <literal>sl</literal>の後の
	      <replaceable>number</replaceable> は同 時にいくつの
	      SLIPセッションをサポートするかを示します.
	      SLIPの設定のより詳しい情報はこのハンドブックの
	      「PPPとSLIP」の章の  <link
		linkend="slipc">SLIPクライアントのセットアップ</link>
	      と <link linkend="slips">SLIP
		サーバのセットアップ方法</link>
	      について書かれた節にあります.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>pseudo-device ppp <replaceable>number</replaceable></literal></term>
	  <listitem>
	    <para><literal>ppp</literal>はダイヤルアップ
	      インターネット接続のための カーネルモード PPP
	      (Point-to-Point Protocol) をサポート します.
	      ユーザアプリケーションとして<devicename>tun</devicename>
	      を 利用する PPPの実装もあり,
	      こちらはより柔軟性がありデマ
	      ンドダイアリング(プログラムが接続要求を出した時に自動
	      的にダイヤルをおこなう)などの機能もあります. それでもこ
	      の PPPドライバを利用したい場合は <link
		linkend="ppp">カーネル PPP の設定</link>
	      の節を読んでください.
	      <literal>sl</literal>デバイスと同じように
	      <replaceable>number</replaceable>は同時 に
	      PPP接続できる数を示します.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>pseudo-device tun <replaceable>number</replaceable></literal></term>
	  <listitem>
	    <para><literal>tun</literal> はユーザモード
	      PPPソフトウェアが利用しま す.
	      このプログラムは設定が簡単で非常に高速です.
	      また自動ダイヤル オン デマンドなどの機能を持ちます.
	      <literal>tun</literal>の後のnumber
	      は同時におこなうことのできる
	      PPPセッションの数を示します.  <link
		linkend="userppp">ユーザ PPP のセットアップ</link>
	      の節により多くの情報があ ります.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>pseudo-device bpfilter <replaceable>number</replaceable></literal></term>
	  <listitem>
	    <para>バークレイ パケットフィルタです.
	      この疑似デバイスはネッ トワークインタフェースを無差別
	      (promiscuous) モードにし てネットワーク
	      (例えば単一のイーサネット) にブロードキャス
	      トされるすべてのパケットを取り入れることを可能にします.
	      こ れらのパケットはディスクに取り入れられたり
	      &man.tcpdump.1; によって検査されます. この機能の実現
	      はネットワーク全体のセキュリティとの微妙な妥協点であるこ
	      とに注意してください.  bpffilter の後の
	      <replaceable>number</replaceable>は同時に検査することの
	      できるインタフェースの数を示します.
	      危険の可能性について十分解っている場合を除いてこのオプ
	      ションは奨めません. すべてのネットワークカードでこの機能
	      をサポートをしてはいません.</para>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2>
      <title>サウンドカード</title>

      <para>ここは
	GENERICカーネルに含まれていない最初のセクションです.
	サウンドカードのサポートをするためには LINTコンフィグレーショ
	ンファイル(これには <emphasis>すべての</emphasis>
	デバイスが含まれています)か
	ら以下のような適切な行をコピーする必要があります.</para>

      <variablelist>
	<varlistentry><term><literal>controller snd0</literal></term>
	  <listitem>
	    <para>サウンドドライバ一般のコードです.
	      <literal>pca</literal>
	      を除く以下のすべてのサウンドカードで必要で す.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device pas0 at isa? port 0x388 irq 10 drq 6 vector pasintr</literal></term>
	  <listitem>
	    <para>ProAudioSpectrum のオーディオ と MIDI です.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device sb0 at isa? port 0x220 irq 7 conflicts drq 1 vector sbintr</literal></term>
	  <listitem>
	    <para>SoundBlaster です.</para>

	    <note>
	      <para>SoundBlaster の IRQが標準と異る値,  例えば
		5になっている場合, <literal>irq
		  7</literal>を<literal>irq 5</literal>に書き換え,
		キーワード <literal>conflicts</literal>を
		削除してください.</para>
	    </note>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device sbxvi0 at isa? drq 5</literal></term>
	  <listitem>
	    <para>SoundBlaster 16 の 16-bit オーディオです.</para>

	    <note>
	      <para>SB16の DMAチャネルが標準と異っている( 例えば
		6か7)キーワード <literal>drq
		  5</literal>を適切な値に書き直してください.
		</para>
	    </note>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device sbmidi0 at isa? port 0x330</literal></term>
	  <listitem>
	    <para>SoundBlaster 16 の MIDI インタフェースです.
	      SoundBlaster 16を使う場合必ずこの行を含めてコンパイル
	      してください.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device gus0 at isa? port 0x220 irq 10 drq 1 vector gusintr</literal></term>
	  <listitem>
	    <para>Gravis Ultrasound です.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device mss0 at isa? port 0x530 irq 10 drq 1 vector adintr</literal></term>
	  <listitem>
	    <para>Microsoft Sound System です.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device opl0 at isa? port 0x388 conflicts</literal></term>
	  <listitem>
	    <para>AdLib FMシンセサイザオーディオです.    AdLib,
	      SoundBlaster, ProAudioSpectrum を使い
	      <command>playmidi</command> (ports にあります)
	      などのプログラムで
	      MIDIの演奏をしたい場合にこの行を含めます.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device mpu0 at isa? port 0x330 irq 6 drq 0</literal></term>
	  <listitem>
	    <para>Roland MPU-401 カードです.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device uart0 at isa? port 0x330 irq 5 vector "m6850intr"</literal></term>
	  <listitem>
	    <para>MIDIインタフェースの 6850 UART です.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>device pca0 at isa? port "IO_TIMER1" tty<anchor id="kernelconfig-pcaudio"></literal></term>
	  <listitem>
	    <para>PC のスピーカーを使ったオーディオです.
	      これは非常に品質 が悪く, CPUの性能,
	      負荷に強く依存します, と言っておき ます
	      (サウンドカードは必要ありませんが).</para>
	  </listitem>
	</varlistentry>

       <varlistentry>
         <term><literal>device pcm0 at isa? port ? tty irq 10 drq 1 flags 0x0
           </literal></term>

         <listitem>
           <para> <literal>pcm</literal> ドライバは WSS/MSS, Sound
	     Blaster Pro , Sound Blaster 16 などのいろいろな種類の
	     ISA サウンドカードをサポートします.
             </para>
         </listitem>
       </varlistentry>
      </variablelist>

      <note>
	<para>追加のドキュメントが
	  <filename>/usr/src/sys/i386/isa/sound/</filename>
	  にあります.  また, これらのデバイスを追加する場合は,
	  サウンド<link
	    linkend="kernelconfig-nodes">デバイスノード</link>
	  を作る必要があり ます.</para>
      </note>
    </sect2>

    <sect2>
      <title>疑似デバイス</title>

      <para>疑似デバイスドライバはデバイスドライバと同様に働きますがマ
	シン上に対応する実際のハードウェアがないカーネルの部分です.
	<link linkend="kernelconfig-network">ネットワーク</link>関連の
	疑似デバイスはそちらのセクションに示しました. ここでは残りにつ
	いて示します.</para>

      <variablelist>
	<varlistentry><term><literal>pseudo-device gzip</literal></term>
	  <listitem>
	    <para><literal>gzip</literal>は
	      <command>gzip</command>によって圧縮された FreeBSDの
	      プログラムを実行できるようにします. /standにあるプログ
	      ラムは圧縮されているのでカーネルにこのオプションをつけ
	      ておくのはいい考えでしょう.</para>

           <note>
             <para><literal>gzip</literal> は現在 a.out バイナリに
	     対してのみ動作します.</para>
           </note>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>pseudo-device log</literal></term>
	  <listitem>
	    <para><literal>log</literal>
	      はカーネルエラーのログを取るのに使います.
	      不可欠です.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>pseudo-device pty <replaceable>number</replaceable><anchor id="kernelconfig-ptys"></literal></term>
	  <listitem>
	    <para><literal>pty</literal>
	      は&ldquo;仮想ターミナル&rdquo;や仮想ログインポート です.
	      外部からの <command>telnet</command>や
	      <command>rlogin</command>セッ ション, xterm,
	      emacsなどのアプリケーションが使います.
	      <replaceable>number</replaceable>は作ることのできる
	      <literal>pty</literal>の数を示 します.
	      <filename>GENERIC</filename>のデフォルトは16で, 同時の
	      xtermウィンドウやリモー
	      トログインのために増やす場合は最大で 64までです.</para>
		</listitem>
	      </varlistentry>

	<varlistentry><term><literal>pseudo-device snp <replaceable>number</replaceable></literal></term>
	  <listitem>
	    <para>スヌープデバイスです.
	      この疑似デバイスはあるターミナル セッションが
		&man.watch.8; command によって他のター
	      ミナルを監視することを可能にします. この機能の実現はセ
	      キュリティとプライバシに対して極めて微妙な関係があり
	      ます. snp の後の <replaceable>number</replaceable>
	      は同時におこなうことのでき
	      るスヌープセッションの総数です. 選択可能です.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>pseudo-device vn</literal></term>
	  <listitem>
	    <para>V ノードドライバです. ファイルを &man.vnconfig.8;
	      コマンドによって
	      デバイスとして取り扱うことを可能にします.
	      このドライバによりフロッピーディスクイメージを
	      操作したりファ イルをスワップデバイスとして (MS
	      Windowsのスワッ プファイルなどを)用いることができます.
	      選択可能です.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>pseudo-device ccd <replaceable>number</replaceable></literal></term>
	  <listitem>
	    <para>ccd (concatenated
	      disk)デバイスはいくつかのディスクパーティ
	      ションを融合して大きなディスクのように
	      見せることができます. ccdの後の
	      <replaceable>number</replaceable>
	      は同時に作ることのできる疑似ディスクの数です.
	      (詳しいことは &man.ccd.4; と &man.ccdconfig.8; のマニュ
	      アルを参照してください.) 選択可能です.</para>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2>
      <title>ジョイスティック, スピーカー, その他</title>

      <para>この節は FreeBSDのここまでに示した以外のハードウェア
	デバイスへのサポートについて示します. これらは GENERICカーネル
	には含まれませんのでこのハンドブックや LINT (このファイルには
	<emphasis>すべての</emphasis>デバイスのサポートが含まれます)
	からコピーする必 要があります.</para>

      <variablelist>
	<varlistentry><term><literal>device joy0 at isa? port "IO_GAME"</literal></term>
	  <listitem>
	    <para>PC のジョイスティックです.</para>
	  </listitem>
	</varlistentry>

	<varlistentry><term><literal>pseudo-device speaker</literal></term>
	  <listitem>
	    <para>IBM BASIC スタイルの PC内蔵スピーカーのサポートです.
	      シェルスクリプトで簡単な演奏をする
	      <filename>/usr/sbin/spkrtest</filename>
	      やキーボードを使って単純なピ
	      アノのように演奏することができる
	      <filename>/usr/games/piano</filename>
	      (<literal>games</literal>パッケージをイ
	      ンストールした場合にはあります) のようないくつかのプロ
	      グラムで使われます. また素晴らしいテキストロールプレイ
	      ングゲームである <application>NetHack</application>
	      (ports コレクションにあります)
	      はゲーム中の楽器の演奏でこのデバイスを使うように設定を
	      することができます (訳注:日本語化されたJNetHackもportsに
	      あります).</para>

	    <para><link linkend="kernelconfig-pcaudio">pca0</link> デバイスの
	      項も参照してください.</para>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>
  </sect1>

  <sect1 id="kernelconfig-nodes">
    <title>デバイスノードを作る</title>

    <para>カーネル内のほとんどすべてのデバイスは対応する
      &ldquo;node&rdquo; エント リが <filename>/dev</filename>
      ディレクトリにあります. これらのノードは普
      通のファイルのように見えますが, 実際にはプログラムがデバイスに
      アクセスするのに用いるカーネル内への特別なエントリです.
      シェルスクリプトである
      <filename>/dev/MAKEDEV</filename>はオペレーティング
      システムを最初にインストールする時に実行され, サポートされてい
      る大部分のデバイスのノードを作ります.  しかし,
      <emphasis>すべての</emphasis>
      ノードが作られるわけではありませんので
      新しいデバイスのサポートを加える時は対応するエントリがこのディ
      レクトリにあるかどうか確認してもしなければ, 作ってください.
      以下に例を示します.</para>

    <para>IDE CD-ROMのサポートをカーネルに加えるとします. 次の行
      を加えます.</para>

    <programlisting>
controller wcd0</programlisting>

    <para>これにしたがって, <filename>/dev</filename>ディレクトリに
      <filename>wcd0</filename>で始ま るエントリを捜してください.
      1文字が後ろにつくかもしれません. 後 ろについた文字が
      <literal>c</literal>であるか先に
      <literal>r</literal>のつくエントリは &ldquo;raw&rdquo;デバ
      イスを示します.
      それらのファイルがないことが明らかになったとします. そこで
      <filename>/dev</filename>
      ディレクトリに移動して次のようにタイプします.</para>

    <screen>&prompt.root; <userinput>sh MAKEDEV wcd0</userinput></screen>

    <para>スクリプトの実行が終ったら <filename>/dev</filename>に
      <filename>wcd0c</filename> と  <filename>rwcd0c</filename>
      エントリがあることを確認してください. これによ
      り正しく実行されたことがわかります.</para>

    <para>サウンドカードの場合のコマンドは次の通りです.

      <screen>&prompt.root; <userinput>sh MAKEDEV snd0</userinput></screen>

      これにより対応するエントリが作られます.</para>

    <note>
      <para>サウンドカードのようなデバイスのノードを作る場合で, もし他
	の人がマシンにアクセスするようであれば, そのデバイスを
	<filename>/etc/fbtab</filename>
	ファイルに追加して外部からのアクセスから
	保護するのが望ましいでしょう. このファイルの詳細については
	<command>man fbtab</command> を参照してください.</para>
    </note>

    <para><filename>GENERIC</filename>
      に含まれていないデバイスはエントリがありませんから,以上
      の簡単な手順をおこなうことになります.</para>

    <note>
      <para>すべての SCSI コントローラは同じ <filename>/dev</filename>
	の エントリを使用しますのでノードを作る必要はありません.
	またネッ トワークカードと SLIP/PPP 疑似デバイスは
	<filename>/dev</filename> にはエント
	リがありませんのでこれらについても作る必要がありません.</para>
    </note>
  </sect1>

  <sect1 id="kernelconfig-trouble">
    <title>問題が起きた場合には</title>

    <para>カスタムカーネルを作る場合に起きるトラブルは 4
      種類に分けられま す.</para>

    <variablelist>
      <varlistentry><term>Config コマンドの失敗</term>
	<listitem>
	  <para>カーネルにあなたの設定をおこなった場合で
	    <command>config</command>コ マンドが失敗したのであれば,
	    多分どこかで単純な間違いを やっているのでしょう. さいわい,
	    <command>config</command>はトラ
	    ブルの起きた行番号を出力しますので
	    <command>vi</command>で素早く 見つけることができます.
	    例えばもし次のように出力されれ ば, <screen>config: line
	      17: syntax error</screen>
	    <command>vi</command>のコマンドモードで
	    <command>17G</command>とタイプすればあな
	    たは問題のところへ飛ぶことができます.
	    <filename>GENERIC</filename> カーネル
	    のファイルや他のリファレンスと比較して注意深く修正して
	    ください.</para>
	</listitem>
      </varlistentry>

      <varlistentry><term>Make コマンドの失敗</term>
	<listitem>
	  <para><command>make</command> コマンドが失敗した場合には,
	    カーネル設定で <command>config</command>
	    がとらえられなかったような間違いをして
	    いることが多いようです. ふたたびコン
	    フィグレーションを見直してください. それでも問題を解決
	    することができなければ &a.questions;
	    へあなたのカーネルのコンフィグレーションをつけてメー
	    ルしてください. 誰かが素早く間違いを見つけてくれるで
	    しょう.</para>
	</listitem>
      </varlistentry>

      <varlistentry><term>カーネルがブートしない
	  <anchor id="kernelconfig-noboot"></term>
	<listitem>
	  <para>新しいカーネルがブートしなかったり,
	    デバイスの認識をしな い場合でもあわてないでください!
	    さいわい, BSDは利用で
	    きないカーネルから復帰する優れたメカニズムがあります.
	    FreeBSDの bootプロンプトでリターンキーを押すかわりに
	    単にブートさせたいカーネルの名前 (例えば
	    <filename>kernel.old</filename>) をタイプするだけです.
	    カーネルの再設定
	    をおこなう場合に現在のカーネルを利用できるように取ってお
	    くのはよい考えです.</para>

	  <para>問題のないカーネルでブートした後に
	    あなたのコンフィグレー ションファイルを調べ,
	    再び構築を試みてください.
	    <filename>/var/log/messages</filename>
	    ファイルにはすべての成功した
	    ブートのカーネルのメッセージやその他の記録があり, これ
	    は助けになる情報の一つでしょう. また,
	    &man.dmesg.8; コマンドは現在のブート時のカーネルメッ
	    セージを出力します.</para>

	  <note>
	    <para>カーネルの構築中にトラブルが起きた時に使うために
	      GENERICや他のカーネルを次の構築で消されない
	      ように異る名前で保存するようにしてください. <emphasis
		remap=tt>kernel.old</emphasis>
	      は新しいカーネルをインストールする 時に,
	      その一つ前にインストールしたうまく動かないかもしれ
	      ないカーネルで上書きされてしまいますので当てにできませ
	      ん. またできる限り早く動作しているカーネルを本来の
	      <filename>kernel</filename>の位置に移動させてください.
	      そうしないと
	      &man.ps.1; のようなコマンドが正しく動きません.
	      <command>make</command>
	      でインストールされたカーネルのファイルを
	      (別のカーネルに戻すために)
	      &ldquo;アンロック&rdquo; するための特別
	      のコマンドは</para>

	    <screen>&prompt.root; <userinput>chflags noschg
		/kernel</userinput></screen>

	    <para>です. また,
	      新しい置き換えたカーネルあるいは重要ファイ
	      ルを動かしたり変更されないように
	      &ldquo;ロック&rdquo; するには 次のようにします. </para>

	    <screen>&prompt.root; <userinput>chflags schg
		/kernel</userinput></screen>
	  </note>
	</listitem>
      </varlistentry>

      <varlistentry><term>カーネルは動くが
	  <command>ps</command> は動かない!</term>

	<listitem>
	  <para>システムユーティリティと異る
	    バージョンのカーネルをインストールした場合, 例えば
	    実験的に &ldquo;4.0&rdquo; のカーネルを 3.1-RELEASE
	    システム上にインストールするような場合,
	    &man.ps.1; や &man.vmstat.8; のような多くの
	    システムステータスコマンドは動かなくなります.
	    <filename>libkvm</filename> を
	    再コンパイルしてこれらのユーティリティを作りなおす
	    必要があります. これは,
	    オペレーティングシステムのそれ以外の部分と異る
	    バージョンのカーネルを使うことが普通はあまりよくない
	    理由の一つです.</para>
	</listitem>
      </varlistentry>
    </variablelist>
  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../handbook.sgml" "part" "chapter")
     End:
-->

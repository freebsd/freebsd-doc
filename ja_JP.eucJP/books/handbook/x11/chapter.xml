<?xml version="1.0" encoding="euc-jp"?>
<!--
     The FreeBSD Documentation Project
     The FreeBSD Japanese Documentation Project

     Original revision: r54719
     $FreeBSD$
-->
<chapter xmlns="http://docbook.org/ns/docbook"
  xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
  xml:id="x11">
  <info><title>X Window System</title>
    <!--<authorgroup>
      <author><personname><firstname>Ken</firstname><surname>Tom</surname></personname><contrib>X.Org X11 サーバ対応: </contrib></author>
      <author><personname><firstname>Marc</firstname><surname>Fonvieille</surname></personname></author>
    </authorgroup>-->
  </info>

  <sect1 xml:id="x11-synopsis">
    <title>この章では</title>

    <para><application>bsdinstall</application> を用いた &os;
      のインストールでは、
      グラフィカルユーザインタフェースは自動的にはインストールされません。
      この章では、グラフィカル環境で使われるオープンソースの
      X Window System を提供する <application>&xorg;</application>
      のインストールおよび設定方法について説明します。
      その後、
      デスクトップ環境およびウィンドウマネージャの探し方およびインストール方法について説明します。</para>

    <note>
      <para><application>&xorg;</application>
	を自動的に設定するインストール方法を希望するユーザは、
	<link xlink:href="https://www.furybsd.org">FuryBSD</link>,
	<link xlink:href="https://ghostbsd.org">GhostBSD</link> および
	<link
	  xlink:href="https://www.midnightbsd.org">MidnightBSD</link>
	を参照してください。</para>
    </note>

    <para><application>&xorg;</application>
      が対応するビデオハードウェアについてのより多くの情報は、
      <link xlink:href="http://www.x.org/">x.org</link>
      のウェブサイトをご覧ください。</para>

    <para>この章を読めば以下のことがわかります。</para>

    <itemizedlist>
      <listitem>
	<para>X Window System のさまざまなコンポーネントと、
	  それらが互いにどのように連携しているか。</para>
      </listitem>

      <listitem>
	<para><application>&xorg;</application>
	  のインストールおよび設定方法</para>
      </listitem>

      <listitem>
	<para>さまざまなウィンドウマネージャおよびデスクトップ環境のインストールおよび設定方法</para>
      </listitem>

      <listitem>
	<para><application>&xorg;</application>
	  での &truetype; フォントの使い方</para>
      </listitem>

      <listitem>
	<para>GUI ログイン (<application>XDM</application>)
	  の設定方法</para>
      </listitem>
    </itemizedlist>

    <para>この章を読み始める前に以下のことを理解しておく必要があります。</para>

    <itemizedlist>
      <listitem>
	<para><xref linkend="ports"/>
	  で説明されているサードパーティ製ソフトウェアのインストール方法</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="x-understanding">
    <title>用語の説明</title>

    <para>X Window System のさまざまなコンポーネントについての詳細や、
      それらがどのようにやり取りするかについてすべて理解する必要はありませんが、
      これらのコンポーネントについて基本的なことを知っていると、
      強力な武器になるでしょう。</para>

    <variablelist>
      <varlistentry>
	<term>X サーバ</term>

	<listitem>
	  <para>X は最初からネットワークを意識してデザインされており、
	    <quote>クライアント - サーバ</quote> モデルを採用しています。
	    このモデルでは、<quote>X サーバ</quote> はキーボードやモニタ、
	    マウスが接続されたコンピュータ上で動きます。
	    このサーバはディスプレイの表示を管理したり、キーボード、
	    マウスからの入力を処理したり、
	    タブレットやビデオプロジェクタ等の他の装置からの入出力を処理します。
	    これは、ある人々を混乱させることがあります。
	    X での用語は彼らが想定するものとは正反対だからです。
	    彼らは <quote>X サーバ</quote>
	    は地下にある大きなパワフルなマシンであり、
	    <quote>X クライアント</quote>
	    が自分たちのデスク上にあると想像するのです。</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>X クライアント</term>

	<listitem>
	  <para><application>XTerm</application> や
	    <application>Firefox</application> などの各 X アプリケーションは、
	    <quote>クライアント</quote> になります。
	    クライアントは <quote>この座標にウィンドウを描いてください</quote>
	    といったメッセージをサーバへ送り、サーバは
	    <quote>ユーザが OK ボタンを押しました</quote>
	    といったメッセージを送り返します。</para>

	  <para>家庭や小さなオフィスのような環境では、X サーバと
	    X クライアントは通常同じコンピュータ上で動いています。
	    X サーバを非力なコンピュータで動かし、
	    X アプリケーションをより高性能なマシンで動かすことも可能です。
	    この場合、
	    X のクライアントとサーバの通信はネットワーク越しに行なわれます。</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>ウィンドウマネージャ</term>

	<listitem>
	  <para>X はスクリーン上でウィンドウがどのように見えるべきか、
	    マウスでそれらをどうやって動かすか、
	    ウィンドウ間を移動するのにどういうキーストロークを使うべきか、
	    各ウィンドウのタイトルバーはどのように見えるべきか、
	    クローズボタンを持つべきかどうか、
	    といったことは規定しません。そのかわりに、X
	    ではそういったことを <quote>ウィンドウマネージャ</quote>
	    と呼ばれるアプリケーションに任せます。<link
	      xlink:href="http://www.xwinman.org/">ウィンドウマネージャはたくさん</link>
	    あります。
	    これらのウィンドウマネージャの見た目や使い勝手はそれぞれ異なっています。
	    バーチャルデスクトップをサポートしているものもありますし、
	    デスクトップを操作するキーストロークをカスタマイズできたり、
	    <quote>スタート</quote>
	    ボタンやそれに類するものを持っているものもあります。
	    テーマに対応しており、
	    デスクトップの見た目や使い勝手を完全に変えられるものもあります。
	    ウィンドウマネージャは Ports Collection の
	    <filename>x11-wm</filename>	カテゴリに用意されています。</para>

	  <para>それぞれのウィンドウマネージャは異なる設定機構を備えています。
	    手で設定ファイルを編集しなければならないものや、
	    設定作業のほとんどを GUI ツールで行うことができるものもあります。</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>デスクトップ環境</term>

	<listitem>
	  <para><application>KDE</application> や
	    <application>GNOME</application> は、デスクトップ環境です。
	    これらは、共通のデスクトップのタスクを実行するための完全なアプリケーションスイートを含んでいます。
	    オフィススイート、ウェブブラウザやゲームを含んでいるものもあります。</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>フォーカスポリシ</term>

	<listitem>
	  <para>ウィンドウマネージャは、
	    マウスのフォーカスポリシに責任を持ちます。
	    このポリシは、どのウィンドウがアクティブにキーストロークを
	    受け付けるようにするための方法を提供し、
	    そして、どのウィンドウがアクティブなのかを示します。</para>

	  <para>よく知られているフォーカスポリシは
	    <quote>click-to-focus</quote> と呼ばれるものです。
	    このポリシは、
	    あるウィンドウ内でマウスをクリックすればそのウィンドウがアクティブになる、
	    というものです。
	    <quote>focus-follows-mouse</quote> ポリシでは、
	    マウスポインタの下にいるウィンドウがフォーカスされるというものです。
	    フォーカスを変えるには他のウィンドウにマウスポインタを動かすだけです。
	    マウスがルートウィンドウに移動した時には、
	    このウィンドウがフォーカスされます。
	    <quote>sloppy-focus</quote> モデルでは、
	    マウスがルートウィンドウに移動した時には、
	    直前に使われていたウィンドウがフォーカスされています。
	    sloppy-focus では、
	    ポインタが別のウィンドウに移った時のみフォーカスが変わり、
	    現在のウィンドウから出ただけでは変わりません。
	    <quote>click-to-focus</quote> ポリシでは、
	    マウスクリックによりアクティブなウィンドウが選択されます。
	    ウィンドウは前面に表示され、他のすべてのウィンドウの前にきます。
	    ポインタが別のウィンドウ上に移動した時でも、
	    すべてのキーストロークがこのウィンドウに届きます。</para>

	  <para>それぞれのウィンドウマネージャは、
	    それぞれのフォーカスポリシに対応しています。
	    すべてのものは click-to-focus をサポートしていますし、
	    多くのものは他の方法もサポートしています。
	    どのフォーカスモデルを利用可能かどうかについては、
	    ウィンドウマネージャのドキュメントをご覧ください。</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>ウィジェット</term>

	<listitem>
	  <para>ウィジェットはクリック可能であったり、
	    他の方法で操作可能なすべてのユーザインタフェース用アイテムを指す用語です。
	    ボタンやチェックボックス、ラジオボタン、アイコン、リスト、などがそうです。
	    ウィジェットツールキットはグラフィカルアプリケーションを作成するために使われます。
	    <application>KDE</application> で使われている Qt や
	    <application>GNOME</application> プロジェクトで使われている GTK+
	    といった有名なウィジェットセットがあります。
	    そのため、アプリケーションのルックアンドフィールは、
	    アプリケーションを作成するのに使われたウィジェットツールキットに依存し、
	    異なります。</para>
	</listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="x-install">
    <title><application>&xorg;</application> のインストール</title>

    <para>&os; では、<application>&xorg;</application> を
      package または port からインストールできます。</para>

    <para>バイナリ package を使うと早くインストールできますが、
      カスタマイズのためのオプションは少なくなります。</para>

    <screen>&prompt.root; <userinput>pkg install xorg</userinput></screen> 

    <para>Ports Collection からビルドしてインストールするには、
      以下のように実行してください。</para>

    <screen>&prompt.root; <userinput>cd /usr/ports/x11/xorg</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

    <para>どちらの方法でも、完全な
      <application>&xorg;</application> システムがインストールされます。
      バイナリ package を用いる方法が、
      ほとんどのユーザにとってはベストな選択となります。</para>

    <para>経験のあるユーザ向けの最小の X システムは、<filename
	role="package">x11/xorg-minimal</filename> です。
      ほとんどのドキュメント、
      ライブラリおよびアプリケーションはインストールされません。
      アプリケーションによってはこれらの追加の要素が機能する上で必要となります。</para>
  </sect1>

  <sect1 xml:id="x-config">
    <title><application>&xorg;</application> の設定</title>

    <info>
      <authorgroup>
      <author>
	<personname>
	  <firstname>Warren</firstname>
	  <surname>Block</surname>
	</personname>
	<contrib>寄稿: </contrib>
      </author>
      </authorgroup>
    </info>

    <indexterm><primary>&xorg;</primary></indexterm>
    <indexterm><primary><application>&xorg;</application></primary></indexterm>

    <sect2 xml:id="x-config-quick-start">
      <title>クィックスタート</title>

      <para><application>&xorg;</application> は、
	標準的なほとんどのビデオカード、
	キーボード、ポインティングデバイスに対応しています。</para>

      <tip>
	<para>ビデオカード、キーボード、入力デバイスは、
	  自動的に検出されるので、手動の設定は必要ありません。
	  自動認識に失敗したとき以外は、<filename>xorg.conf</filename>
	  を作成したり、<option>-configure</option>
	  プロセスの実行は行わないでください。</para>
      </tip>

      <procedure>
	<step>
	  <para>もし、使用しているコンピュータですでに
	    <application>&xorg;</application> が使われているのであれば、
	    コンフィグレーションファイルを移動するか、削除してください。</para>

	  <screen>&prompt.root; <userinput>mv /etc/X11/xorg.conf ~/xorg.conf.etc</userinput>
&prompt.root; <userinput>mv /usr/local/etc/X11/xorg.conf ~/xorg.conf.localetc</userinput></screen>
	</step>

	<step>
	  <para>3D アクセラレータを利用できるシステムでは、
	    <application>&xorg;</application> を実行するユーザを
	    <systemitem class="groupname">video</systemitem> または
	    <systemitem class="groupname">wheel</systemitem>
	    グループに追加して、使用できるようにしてください。
	    ユーザ <replaceable>jru</replaceable>
	    をどちらのグループでも利用できるようにするには以下のように実行してください。</para>

	  <screen>&prompt.root; <userinput>pw groupmod video -m <replaceable>jru</replaceable> || pw groupmod wheel -m <replaceable>jru</replaceable></userinput></screen>
	</step>

	<step>
	  <para>デフォルトでは <acronym>twm</acronym>
	    ウィンドウマネージャがインストールされています。
	    <application>&xorg;</application> が起動すると、
	    このウィンドウマネージャが立ち上がります。</para>

	  <screen>&prompt.user; <userinput>startx</userinput></screen>
	</step>

	<step>
	  <para>古いバージョンの &os; では、
	    テキストコンソールに戻れるようにするために、
	    システムコンソールは &man.vt.4; に設定する必要があります。
	    <xref linkend="x-config-kms"/> を参照してください。</para>
	</step>
      </procedure>
    </sect2>

    <sect2 xml:id="x-config-user-group">
      <title>Accelerated Video のためのユーザグループ</title>

      <para>ビデオカードの 3D アクセラレータを有効にするには、
	<filename>/dev/dri</filename> へのアクセスが必要となります。
	通常は、X を実行するユーザを
	<systemitem class="groupname">video</systemitem> または
	<systemitem class="groupname">wheel</systemitem>
	グループに追加するするだけです。
	ここでは、&man.pw.8; を使ってユーザ
	<replaceable>slurms</replaceable> を
	<systemitem class="groupname">video</systemitem> グループ、または
	<systemitem class="groupname">video</systemitem>
	グループが存在しない時に、
	<systemitem class="groupname">wheel</systemitem>
	グループに追加しています。</para>

      <screen>&prompt.root; <userinput>pw groupmod video -m <replaceable>slurms</replaceable> || pw groupmod wheel -m <replaceable>slurms</replaceable></userinput></screen>
    </sect2>

    <sect2 xml:id="x-config-kms">
      <title>Kernel Mode Setting (<acronym>KMS</acronym>)</title>

      <para>コンピュータが、コンソールの表示から、
	X 用の高解像度の表示へと切り替える時には、
	ビデオの出力 <emphasis>mode</emphasis>
	が設定されている必要があります。
	最近の <acronym>&xorg;</acronym> では、
	カーネル内部のシステムを使って効率的にこれらのモードの変換をしています。
	古いバージョンの &os; では、
	<acronym>KMS</acronym> システムを用いない
	&man.sc.4; が使用されています。
	X を閉じた後、システムコンソールは動作をしていても、
	表示に黒になります。
	新しい &man.vt.4; コンソールではこの問題は起こりません。</para>

      <para>以下の行を <filename>/boot/loader.conf</filename> に追加して
	&man.vt.4; を有効にしてください。</para>

      <programlisting>kern.vty=vt</programlisting>
    </sect2>

    <sect2 xml:id="x-config-files">
      <title>コンフィグレーションファイル</title>

      <para>通常、この節で説明する手動の設定は必要ありません。
	自動認識に失敗したとき以外は、
	手動で設定ファイルを作成しないでください。</para>

      <sect3 xml:id="x-config-files-directory">
	<title>ディレクトリ</title>

	<para><application>&xorg;</application> は、
	  複数のディレクトリから設定ファイルを探します。
	  &os; において、設定ファイルのディレクトリは、
	  <filename>/usr/local/etc/X11/</filename>
	  が推奨されます。
	  このディレクトリを使うことで、
	  アプリケーションのファイルをオペレーティングシステムとは区別する事になります。</para>

	<para>昔のコンフィグレーションファイルの置き場である
	  <filename>/etc/X11/</filename> も機能します。
	  しかしながら、この場所に置くと、アプリケーションファイルと
	  &os; システムのファイルが混ざってしまうため、推奨されません。</para>
      </sect3>

      <sect3 xml:id="x-config-files-single-or-multi">
	<title>単一または複数ファイル</title>

	<para>複数のファイルを用いて、
	  各ファイルが特定の部分を設定するようにすると、
	  古い単一の <filename>xorg.conf</filename>
	  を用いるよりも設定が簡単になります。
	  これらのファイルは、
	  メインのコンフィグレーションファイルのディレクトリの
	  <filename>xorg.conf.d/</filename> サブディレクトリに置かれます。
	  フルパスは、一般的に
	  <filename>/usr/local/etc/X11/xorg.conf.d/</filename>
	  となります。</para>

	<para>これらのファイルの例は、この節の後半で説明します。</para>

	<para>古い単一の <filename>xorg.conf</filename> も機能しますが、
	  <filename>xorg.conf.d/</filename>
	  サブディレクトリに複数のファイルで設定する形式に比べると、
	  柔軟ではなく、わかりにくいものとなります。</para>
      </sect3>
    </sect2>

    <sect2 xml:id="x-config-video-cards">
      <title>ビデオカード</title>

      <para>最近の &os; では、Ports または packages
	形式で提供されるグラフィックドライバを利用できるようになりました。
	そのようなものとして、ユーザは <package>graphics/drm-kmod</package>
	で提供される以下のドライバを利用できます。</para>

      <variablelist>
	<varlistentry xml:id="x-config-video-cards-ports">
	  <term>&i915kms;</term>
	  <term>&radeonkms;</term>
	  <term>&amdgpu;</term>

	  <listitem>
	    <para>&intel; が提供しているほとんどの &i915kms;
	      グラフィックカードは、2D および 3D
	      アクセラレーションに対応しています。</para>

	    <para>ドライバ名: <literal>i915kms</literal></para>

	    <para>&amd; が提供している古い &radeonkms;
	      グラフィックカードのほとんどは、2D および 3D
	      アクセラレーションに対応しています。</para>

	    <para>ドライバ名: <literal>radeonkms</literal></para>

	    <para>&amd; が提供している新しい &radeonkms;
	      グラフィックカードのほとんどは、2D および 3D
	      アクセラレーションに対応しています。</para>

	    <para>ドライバ名: <literal>amdgpu</literal></para>

	    <para>参考として、対応している GPU 一覧を <link
		xlink:href="https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units"/>
	      または <link
		xlink:href="https://en.wikipedia.org/wiki/List_of_AMD_graphics_processing_units"/>
	      でご覧ください。</para>
	  </listitem>
	</varlistentry>

	<varlistentry xml:id="x-config-video-cards-intel">
	  <term>&intel;</term>

	  <listitem>
	    <para>Iron Lake (HD Graphics) および
	      Sandy Bridge (HD Graphics 2000) を含む
	      Ivy Bridge (HD Graphics 2500, 4000, および
	      P4000) までのほとんどの &intel;
	      グラフィックスは、3D acceleration に対応しています。</para>

	    <para>ドライバ名: <literal>intel</literal></para>

	    <para>参考情報については <link
		xlink:href="https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units"/> をご覧ください。</para>
	  </listitem>
	</varlistentry>

	<varlistentry xml:id="x-config-video-cards-radeon">
	  <term>&amd; Radeon</term>

	  <listitem>
	    <para>ATI/Radeon: 2D および 3D acceleration は、
	      HD6000 シリーズまでのほとんどの
	      Radeon カードで対応しています。</para>

	    <para>ドライバ名: <literal>radeon</literal></para>

	    <para>参考情報については <link
		xlink:href="https://en.wikipedia.org/wiki/List_of_AMD_graphics_processing_units"/>
	      をご覧ください。</para>
	  </listitem>
	</varlistentry>

	<varlistentry xml:id="x-config-video-cards-nvidia">
	  <term>NVIDIA</term>

	  <listitem>
	    <para>NVIDIA: いくつかの NVIDIA ドライバが
	      Ports Collection の <filename>x11</filename>
	      カテゴリから利用できます。
	      ビデオカードのモデルに対応するドライバをインストールしてください。</para>

	    <para>参考情報については <link
	      xlink:href="https://en.wikipedia.org/wiki/List_of_Nvidia_graphics_processing_units"/> をご覧ください。</para>
	  </listitem>
	</varlistentry>

	<varlistentry xml:id="x-config-video-cards-hybrid">
	  <term>ハイブリッドグラフィックス</term>

	  <listitem>
	    <para>ノートブックコンピュータによっては、
	      チップセットまたはプロセッサに組み込まれているグラフィックプロセッサユニットの他に、
	      追加でそれらを持つものがあります。
	      <emphasis>Optimus</emphasis> は、
	      &intel; と NVIDIA ハードウェアを組み合わせています。
	      <emphasis>Switchable Graphics</emphasis> または、
	      <emphasis>Hybrid Graphics</emphasis> は、
	      &intel; または &amd; プロセッサと &amd; Radeon
	      <acronym>GPU</acronym> を組み合わせています。</para>

	    <para>これらのハイブリッドなグラフィックシステムの実装は、
	      システムごとに異なるので、
	      &os; の <application>&xorg;</application> は、
	      これらのすべてのバージョンについて対応しているわけではありません。</para>

	    <para>コンピュータによっては、
	      片方のグラフィックアダプタを無効にしたり、
	      標準のビデオカードドライバの一つとともに使われる
	      <emphasis>discrete</emphasis> モードを選択できるような
	      <acronym>BIOS</acronym> オプションを提供しています。
	      たとえば、Optimus システムでは、NVIDIA <acronym>GPU</acronym>
	      を無効にできるものがあります。
	      その後、&intel; ビデオカードは、
	      &intel; ドライバで利用できます。</para>

	    <para><acronym>BIOS</acronym> の設定は、
	      コンピュータのモデルに依存します。
	      システムによっては、両方の <acronym>GPU</acronym>
	      を有効にできますが、
	      そのようなシステムの機能を利用するには、
	      <literal>Device</literal> セッションにおいて、
	      メインの <acronym>GPU</acronym>
	      のみを使用するようなコンフィグレーションファイルを作成ことで十分です。</para>
	  </listitem>
	</varlistentry>

	<varlistentry xml:id="x-config-video-cards-other">
	  <term>他のビデオカード</term>

	  <listitem>
	    <para>Ports Collection の
	      <filename>x11-drivers</filename> ディレクトリには、
	      あまり使用されないようなドライバも用意されています。</para>

	    <para>特定のドライバによりサポートされていないようなカードでも、
	      <package>x11-drivers/xf86-video-vesa</package>
	      で使用できるかもしれません。
	      このドライバは、<package>x11/xorg</package>
	      によりインストールされます。
	      手動でインストールするには、
	      <package>x11-drivers/xf86-video-vesa</package>
	      としてインストールしてください。
	      ビデオカードに対して、特定のドライバが見つからない場合には、
	      <application>&xorg;</application>
	      はこのドライバを使うことを試みます。</para>

	    <para><package>x11-drivers/xf86-video-scfb</package>
	      も同様に、多くの <acronym>UEFI</acronym> および &arm;
	      コンピュータで動くような、
	      使用するカードを特定していないビデオドライバです。</para>
	  </listitem>
	</varlistentry>

	<varlistentry xml:id="x-config-video-cards-file">
	  <term>ファイルでビデオドライバを設定する。</term>

	  <listitem>
	    <para>コンフィグレーションファイルにおいて
	      &intel; ドライバを設定するには、以下のようにしてください。</para>

	    <example xml:id="x-config-video-cards-file-intel">
	      <title>ファイルにおいて &intel; ビデオドライバを選択する。</title>

	      <para><filename>/usr/local/etc/X11/xorg.conf.d/driver-intel.conf</filename></para>

	      <programlisting>Section "Device"
	Identifier "Card0"
	Driver     "intel"
	# BusID    "PCI:1:0:0"
EndSection</programlisting>

	      <para>１つ以上のビデオカードが存在する場合には、
		<literal>BusID</literal> 行のコメントを外し、
		希望するカードを選択するように設定できます。
		ビデオカードバス <acronym>ID</acronym> は、
		<command>pciconf -lv | grep -B3
		  display</command> で表示できます。</para>
	    </example>

	    <para>コンフィグレーションファイルで、Radeon
	      ドライバを設定するには以下のようにしてください。</para>

	    <example xml:id="x-config-video-cards-file-radeon">
	      <title>ファイルにおいて Radeon ビデオドライバを設定する。</title>

	      <para><filename>/usr/local/etc/X11/xorg.conf.d/driver-radeon.conf</filename></para>

	      <programlisting>Section "Device"
	Identifier "Card0"
	Driver     "radeon"
EndSection</programlisting>
	    </example>

	    <para>コンフィグレーションファイルで <acronym>VESA</acronym>
	      ドライバを設定するには、以下のようにしてください。</para>

	    <example xml:id="x-config-video-cards-file-vesa">
	      <title>ファイルで <acronym>VESA</acronym>
		ビデオドライバを設定する。</title>

	      <para><filename>/usr/local/etc/X11/xorg.conf.d/driver-vesa.conf</filename></para>

	      <programlisting>Section "Device"
	Identifier "Card0"
	Driver     "vesa"
EndSection</programlisting>
	    </example>

	    <para><acronym>UEFI</acronym> または &arm;
	      コンピュータを使うために <literal>scfb</literal>
	      ドライバを設定するには、以下のように設定してください。</para>

	    <example xml:id="x-config-video-cards-file-scfb">
	      <title>ファイルの中で <literal>scfb</literal>
	      ビデオドライバを選択する。</title>

	      <para><filename>/usr/local/etc/X11/xorg.conf.d/driver-scfb.conf</filename></para>

	      <programlisting>Section "Device"
	Identifier "Card0"
	Driver     "scfb"
EndSection</programlisting>
	    </example>
	  </listitem>
	</varlistentry>
      </variablelist>
    </sect2>

    <sect2 xml:id="x-config-monitors">
      <title>モニタ</title>

      <para>ほとんどすべてのモニタは、Extended Display
	Identification Data standard (<acronym>EDID</acronym>)
	に対応しています。
	<application>&xorg;</application> は
	<acronym>EDID</acronym> を使ってモニタと通信し、
	対応している解像度とリフレッシュレートを検出します。
	そのため、モニタを使用するのに最も適切な設定が選択されます。</para>

      <para>モニタにより対応している他の解像度は、
	コンフィグレーションファイルに希望する解像度を設定する、
	または X サーバを起動後、&man.xrandr.1;
	により選択が可能となります。</para>

      <variablelist>
	<varlistentry xml:id="x-config-monitors-xrandr">
	  <term>&man.xrandr.1; の使用</term>

	  <listitem>
	    <para>パラメータを与えずに &man.xrandr.1; を実行すると、
	      ビデオ出力と検出されているモニタのモードを確認できます。</para>

	    <screen>&prompt.user; <userinput>xrandr</userinput>
Screen 0: minimum 320 x 200, current 3000 x 1920, maximum 8192 x 8192
DVI-0 connected primary 1920x1200+1080+0 (normal left inverted right x axis y axis) 495mm x 310mm
   1920x1200     59.95*+
   1600x1200     60.00
   1280x1024     85.02    75.02    60.02
   1280x960      60.00
   1152x864      75.00
   1024x768      85.00    75.08    70.07    60.00
   832x624       74.55
   800x600       75.00    60.32
   640x480       75.00    60.00
   720x400       70.08
DisplayPort-0 disconnected (normal left inverted right x axis y axis)
HDMI-0 disconnected (normal left inverted right x axis y axis)</screen>

	    <para>この出力からは、リフレッシュレート約 60 Hz で、
	      スクリーン解像度 1920x1200 ピクセルの表示に
	      <literal>DVI-0</literal> 出力が使用されていることが分かります。
	      また、<literal>DisplayPort-0</literal> および
	      <literal>HDMI-0</literal> インタフェースには、
	      モニタは接続されていません。</para>

	    <para>&man.xrandr.1; を使用して、
	      他のディスプレイモードを選択できます。
	      たとえば、60 Hz で、1280x1024 の表示に変更するには、
	      以下のように実行してください。</para>

	    <screen>&prompt.user; <userinput>xrandr --mode 1280x1024 --rate 60</userinput></screen>

	    <para>ノートブックコンピュータの外部出力を使用して、
	      ビデオプロジェクタに接続することがよく行われます。</para>

	    <para>出力端子のタイプおよび番号は、デバイスごとに異なります。
	      また、各端子の名前もドライバごとに異なります。
	      あるドライバが <literal>HDMI-1</literal> と呼ぶ出力が、
	      別のドライバでは <literal>HDMI1</literal>
	      と呼ばれることもあります。
	      そのため、最初に &man.xrandr.1; を実行して、
	      利用可能な出力のすべての一覧を表示してください。</para>

	    <screen>&prompt.user; <userinput>xrandr</userinput>
Screen 0: minimum 320 x 200, current 1366 x 768, maximum 8192 x 8192
LVDS1 connected 1366x768+0+0 (normal left inverted right x axis y axis) 344mm x 193mm
   1366x768      60.04*+
   1024x768      60.00
   800x600       60.32    56.25
   640x480       59.94
VGA1 connected (normal left inverted right x axis y axis)
   1280x1024     60.02 +  75.02
   1280x960      60.00
   1152x864      75.00
   1024x768      75.08    70.07    60.00
   832x624       74.55
   800x600       72.19    75.00    60.32    56.25
   640x480       75.00    72.81    66.67    60.00
   720x400       70.08
HDMI1 disconnected (normal left inverted right x axis y axis)
DP1 disconnected (normal left inverted right x axis y axis)</screen>

	    <para>この出力からは、組み込みパネルの
	      <literal>LVDS1</literal>, 外部出力の
	      <literal>VGA1</literal>, <literal>HDMI1</literal>, そして
	      <literal>DP1</literal> 端子の 4 つの出力を確認できます。</para>

	    <para>プロジェクタは
	      <literal>VGA1</literal> 出力に接続されています。
	      情報を得られたので、&man.xrandr.1;
	      を使ってプロジェクタの標準の解像度に設定し、
	      デスクトップの右側にスペースを追加できます。</para>

	    <screen>&prompt.user; <userinput>xrandr --output VGA1 --auto --right-of LVDS1</userinput></screen>

	    <para>この設定において、<literal>--auto</literal> は、
	      <acronym>EDID</acronym>
	      により検出された解像度とリフレッシュレートを選択します。
	      解像度を正しく検出できていない場合には、
	      <literal>--auto</literal> のかわりに、
	      <literal>--mode</literal> を使うことで、
	      解像度を固定値を与えることにより設定できます。
	      たとえば、ほとんどのプロジェクタでは
	      1024x768 の解像度で使用できるので、
	      この場合には、<literal>--mode 1024x768</literal>
	      のように設定できます。</para>

	    <para>&man.xrandr.1; は、X を起動する際に、
	      適切なモードを設定するように、しばしば 
	      <filename>.xinitrc</filename> から実行されます。</para>
	  </listitem>
	</varlistentry>

	<varlistentry xml:id="x-config-monitors-files">
	  <term>モニタ解像度をファイルで設定する。</term>

	  <listitem>
	    <para>コンフィグレーションファイルでスクリーンの解像度を
	      1024x768 と設定するには以下のようにしてください。</para>

	    <example>
	      <title>スクリーンの解像度をファイルで設定する。</title>

	      <para><filename>/usr/local/etc/X11/xorg.conf.d/screen-resolution.conf</filename></para>

	      <programlisting>Section "Screen"
	Identifier "Screen0"
	Device     "Card0"
	SubSection "Display"
	Modes      "1024x768"
	EndSubSection
EndSection</programlisting>
	    </example>

	    <para><acronym>EDID</acronym>
	      を持っていないモニタもあります。その場合には、
	      モニタが対応している周波数の範囲を、
	      <literal>HorizSync</literal> および
	      <literal>VertRefresh</literal>
	      で、指定することで設定できます。</para>

	    <example>
	      <title>手動でモニタの周波数を設定する。</title>

	      <para><filename>/usr/local/etc/X11/xorg.conf.d/monitor0-freq.conf</filename></para>

	      <programlisting>Section "Monitor"
	Identifier   "Monitor0"
	HorizSync    30-83   # kHz
	VertRefresh  50-76   # Hz
EndSection</programlisting>
	    </example>
	  </listitem>
	</varlistentry>
     </variablelist>
    </sect2>

    <sect2 xml:id="x-config-input">
      <title>入力デバイス</title>

      <sect3 xml:id="x-config-input-keyboard">
	<title>キーボード</title>

	<variablelist>
	  <varlistentry xml:id="x-config-input-keyboard-layout">
	    <term>キーボードレイアウト</term>

	    <listitem>
	      <para>キーボード上の標準化されたキーの位置を
		<emphasis>レイアウト</emphasis> と呼びます。
		レイアウトと他の調整可能なパラメータについては、
		&man.xkeyboard-config.7; にまとめられています。</para>

	      <para>アメリカ合衆国のレイアウトがデフォルトです。
		他のレイアウトを選択するには、
		<literal>InputClass</literal> で、
		<literal>XkbLayout</literal> および
		<literal>XkbVariant</literal> オプションを設定してください。
		クラスに対応するすべての入力デバイスに適用できます。</para>

	      <para>以下の例では、
		フランス語のキーボードレイアウトを選択しています。</para>

	      <example>
		<title>キーボードレイアウトを選択する。</title>

		<para><filename>/usr/local/etc/X11/xorg.conf.d/keyboard-fr.conf</filename></para>

		<programlisting>Section	"InputClass"
	Identifier	"KeyboardDefaults"
	MatchIsKeyboard	"on"
	Option		"XkbLayout" "fr"
EndSection</programlisting>
	      </example>

	      <example>
		<title>複数のキーボードレイアウトを選択する。</title>

		<para>アメリカ合衆国、スペイン、
		  ウクライナのキーボードレイアウトを、
		  <keycombo action="simul">
		    <keycap>Alt</keycap>
		    <keycap>Shift</keycap>
		  </keycombo>
		  によって切り替えるようにするには以下のように設定します。
		  レイアウトスイッチングコントロールや現在のレイアウトインディケータを改良するには、
		  <package>x11/xxkb</package> または、
		  <package>x11/sbxkb</package> を使ってください。</para>

		<para><filename>/usr/local/etc/X11/xorg.conf.d/kbd-layout-multi.conf</filename></para>

		<programlisting>Section	"InputClass"
	Identifier	"All Keyboards"
	MatchIsKeyboard	"yes"
	Option		"XkbLayout" "us, es, ua"
EndSection</programlisting>
	      </example>
	    </listitem>
	  </varlistentry>

	  <varlistentry xml:id="x-config-input-keyboard-zap">
	    <term>キーボードから <application>&xorg;</application>
	      を終了する。</term>

	    <listitem>
	      <para>X をキーの組み合わせで終了できるように設定できます。
		デフォルトでは、幾つかのアプリケーションで、
		キーボードコマンドと衝突してしまう可能性があるため、
		このキーの組み合わせは設定されていません。
		このオプションを有効にするには、
		キーボードの <literal>InputDevice</literal>
		セクションを変更してください。</para>

	      <example>
		<title>キーボードからの X の終了を有効にする。</title>

		<para><filename>/usr/local/etc/X11/xorg.conf.d/keyboard-zap.conf</filename></para>

		<programlisting>Section	"InputClass"
	Identifier	"KeyboardDefaults"
	MatchIsKeyboard	"on"
	Option		"XkbOptions" "terminate:ctrl_alt_bksp"
EndSection</programlisting>
	      </example>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </sect3>

      <sect3 xml:id="x11-input-mice">
	<title>マウスおよびポインティングデバイス</title>

	<important>
	  <para>もし &os;&nbsp;&rel121.current; において、
	    &man.moused.8; を使わず、
	    <package>xorg-server</package>&nbsp;1.20.8
	    以降を使用しているのであれば、
	    <filename>/etc/sysctl.conf</filename> に、
	    <userinput>kern.evdev.rcpt_mask=12</userinput>
	    を追加してください。</para>
	</important>

	<para>コンフィグレーションオプションにより、
	  多くのマウスパラメータを調整できます。
	  すべての一覧については、&man.mousedrv.4x; をご覧ください。</para>

	<variablelist>
	  <varlistentry xml:id="x11-input-mice-buttons">
	    <term>マウスボタン</term>

	    <listitem>
	      <para><filename>xorg.conf</filename>
		のマウス <literal>InputDevice</literal> セクションで、
		マウスのボタンの数を設定できます。
		ボタンの数を 7 に設定するには、
		以下のように設定してください。</para>

	      <example>
		<title>マウスボタンの数を設定する。</title>

		<para><filename>/usr/local/etc/X11/xorg.conf.d/mouse0-buttons.conf</filename></para>

		<programlisting>Section "InputDevice"
	Identifier  "Mouse0"
	Option      "Buttons" "7"
EndSection</programlisting>
	      </example>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </sect3>
    </sect2>

    <sect2 xml:id="x-config-manual-configuration">
      <title>手動による設定</title>

      <para>ハードウェアによっては、<application>&xorg;</application>
	の自動設定で適切な設定が行われなかったり、
	自動設定とは別の設定にしたいときがあります。
	そのような場合のため、
	カスタムコンフィグレーションファイルを作成できます。</para>

      <warning>
	<para>自動認識に失敗したとき以外は、
	  手動で設定ファイルを作成しないでください。
	  不必要な手動の設定を行った結果、
	  適切に動作しなくなるということがあります。</para>
      </warning>

      <para>検出されたハードウェアをベースとした、
	<application>&xorg;</application>
	のコンフィグレーションファイルを作成できます。
	このファイルは、
	カスタムコンフィグレーションファイルの最初の出発点として有用です。</para>

      <para>以下のようにすると <filename>xorg.conf</filename>
	が生成されます。</para>

      <screen>&prompt.root; <userinput>Xorg -configure</userinput></screen>

      <para>このコンフィグレーションファイルは、
	<filename>/root/xorg.conf.new</filename> として保存されます。
	必要となる変更を行った後、このファイルを
	(バックグラウンドが表示されるように <option>-retro</option> を使って)
	テストしてください。</para>

      <screen>&prompt.root; <userinput>Xorg -retro -config /root/xorg.conf.new</userinput></screen>

      <para>新しい設定を調整してテストしたら、
	ファイルに分割して、標準の場所である、
	<filename>/usr/local/etc/X11/xorg.conf.d/</filename>
	に置いてください。</para>
    </sect2>
  </sect1>

  <sect1 xml:id="x-fonts">
    <info><title><application>&xorg;</application> でのフォントの使用</title>
      <!-- <authorgroup>
	<author><personname><firstname>Murray</firstname><surname>Stokely</surname></personname><contrib>寄稿: </contrib></author>
      </authorgroup> -->
    </info>

    <sect2 xml:id="type1">
      <title>Type1 フォント</title>

      <para><application>&xorg;</application>
	に付いてくるデフォルトのフォントは、
	通常のデスクトップパブリッシングアプリケーションにとっては理想的とは言えない程度のものです。
	文字を大きくするとジャギーになりプロフェッショナルとは言えないようなものになりますし、
	小さなフォントは頭が悪そうに見えます。
	しかし、世の中には質の高い Type1 (&postscript;)
	フォントがいくつかあり、
	<application>&xorg;</application>
	ではそれらを簡単に利用することができます。
	例えば、URW フォントコレクション
	(<package>x11-fonts/urwfonts</package>)
	には高品質の Type1 フォント (<trademark
	  class="registered">Times Roman</trademark>, <trademark
	  class="registered">Helvetica</trademark>, <trademark
	  class="registered">Palatino</trademark> など)
	が含まれています。freefont コレクション
	(<package>x11-fonts/freefonts</package>)
	にはもっとたくさんのフォントが含まれていますが、
	それらは <application>Gimp</application>
	のようなグラフィックソフトウェアで使用するためのものであり、
	スクリーンフォントとしては十分ではありません。
	さらに、<application>&xorg;</application>
	は簡単に &truetype; フォントを使うように設定することも可能です。
	詳しくは、&man.X.7; のマニュアルページか
	<xref linkend="truetype"/> を参照してください。</para>

      <para>上記の Type1 フォントコレクションをバイナリ package
	からインストールする場合には、次のコマンドを実行してください。</para>

      <screen>&prompt.root; <userinput>pkg install urwfonts</userinput></screen>

      <para>あるいは、Ports Collection
	から構築してインストールするには次のコマンドを実行してください。</para>

      <screen>&prompt.root; <userinput>cd /usr/ports/x11-fonts/urwfonts</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

      <para>freefont や他のコレクションでも同じようにします。
	X サーバがこれらのフォントを検出できるようにするには
	X サーバ設定ファイル (<filename>/etc/X11/xorg.conf</filename>)
	の適切な場所に次のような行を加えます。</para>

      <programlisting>FontPath "/usr/local/share/fonts/urwfonts/"</programlisting>

      <para>別の方法としては、
	X のセッション中に次のようなコマンドラインを実行します。</para>

      <screen>&prompt.user; <userinput>xset fp+ /usr/local/share/fonts/urwfonts</userinput>
&prompt.user; <userinput>xset fp rehash</userinput></screen>

      <para>これは動くのですが、X
	のセッションが終了すると消えてしまいます。
	消えないようにするには X の起動時に読み込まれるファイル
	(通常の <command>startx</command> セッションの場合は
	<filename>~/.xinitrc</filename>, <application>XDM</application>
	のようなグラフィカルなログインマネージャを通してログインする時は
	<filename>~/.xsession</filename>) に加えておきます。
	三番目の方法は新しい
	<filename>/usr/local/etc/fonts/local.conf</filename>
	ファイルを使うことです。
	これに関しては <xref linkend="antialias"/> をご覧ください。</para>
    </sect2>

    <sect2 xml:id="truetype">
      <title>&truetype; フォント</title>

      <indexterm>
	<primary>TrueType フォント</primary>
      </indexterm>
      <indexterm>
	<primary>フォント</primary>
	<secondary>TrueType</secondary>
      </indexterm>

      <para><application>&xorg;</application> には、
	&truetype; フォントのレンダリング機能が組み込まれています。
	この機能を実現するために 2 つの異なるモジュールがあります。
	ここでは、freetype
	の方が他のフォントレンダリングバックエンドと整合性が高いので、
	このモジュールを使うことにします。
	freetype モジュールを使うためには
	<filename>/etc/X11/xorg.conf</filename> ファイルの
	<literal>"Module"</literal>
	セクションに以下の行を追加するだけです。</para>

      <programlisting>Load  "freetype"</programlisting>

      <para>さて、まずは &truetype; フォント用のディレクトリ
	(例えば <filename>/usr/local/share/fonts/TrueType</filename>)
	を作り、そこに &truetype; フォントをすべて放り込みましょう。
	&apple; &mac; の &truetype;
	フォントは、そのままでは使うことができませんので注意してください。
	<application>&xorg;</application> で使うには
	&unix;/&ms-dos;/&windows; 用のフォーマットでなければなりません。
	ファイルを置いたら <application>mkfontscale</application> を使って
	<filename>fonts.dir</filename> ファイルを作り、
	X のフォントレンダラが新しいファイルがイントールされたことを分かるようにしてください。
	<command>mkfontscale</command> は package
	からインストールできます。</para>

      <screen>&prompt.root; <userinput>pkg install mkfontscale</userinput></screen>

      <para>その後、ディレクトリに X
	フォントファイルのインデックスを作成してください。</para>

      <screen>&prompt.root; <userinput>cd /usr/local/share/fonts/TrueType</userinput>
&prompt.root; <userinput>mkfontscale</userinput></screen>

      <para>次に &truetype;
	フォントのディレクトリをフォントパスに追加します。
	<xref linkend="type1"/> の場合と同じように、</para>

      <screen>&prompt.user; <userinput>xset fp+ /usr/local/share/fonts/TrueType</userinput>
&prompt.user; <userinput>xset fp rehash</userinput></screen>

      <para>とするか、もしくは <filename>xorg.conf</filename>
	ファイルに <literal>FontPath</literal> 行を追加します。</para>

      <para>これで <application>Gimp</application> や
	<application>LibreOffice</application>
	といったすべての X アプリケーションから
	&truetype; フォントを使うことができます。
	(高解像度なディスプレイで見るウェブページ上のテキストみたいな)
	とても小さなフォントや
	(<application>LibreOffice</application> にあるような)
	非常に大きなフォントもかなり綺麗に見えるようになることでしょう。</para>
    </sect2>

    <sect2 xml:id="antialias">
      <info><title>フォントのアンチエイリアス</title>
	<!--<authorgroup>
	  <author><personname><firstname>Joe Marcus</firstname><surname>Clarke</surname></personname><contrib>更新 (2003 年 5 月): </contrib></author>
	</authorgroup>-->
      </info>

      

      <indexterm>
	<primary>フォントのアンチエイリアス</primary>
      </indexterm>
      <indexterm>
	<primary>フォント</primary>
	<secondary>アンチエイリアス</secondary>
      </indexterm>

      <para><filename>/usr/local/share/fonts/</filename> と
	<filename>~/.fonts/</filename> にあるすべての
	<application>&xorg;</application> のフォントが、Xft
	に対応しているアプリケーションで自動的にアンチエイリアス表示できるようになりました。
	<application>KDE</application>, <application>GNOME</application> および
	<application>Firefox</application>
	のような最新のアプリケーションは、Xft に対応しています。</para>

      <para>どのフォントがアンチエイリアスされるかを制御するため、
	もしくはアンチエイリアスの特性を設定するために、
	<filename>/usr/local/etc/fonts/local.conf</filename>
	ファイルを作成 (すでに存在しているのなら編集) します。
	多くの Xft フォントシステムの高度な機能をこのファイルを使って調整できます。
	この節ではいくつか簡単なところだけを紹介します。
	詳しくは、&man.fonts-conf.5; をご覧ください。</para>

      <indexterm><primary>XML</primary></indexterm>

      <para>このファイルは XML 形式でなければなりません。
	大文字小文字の区別に注意を払い、
	すべてのタグが正しく閉じられているか確認してください。
	ファイルは一般的な XML ヘッダで始まり、DOCTYPE 定義と
	<literal>&lt;fontconfig&gt;</literal>
	タグがその後にきます。</para>

      <programlisting>&lt;?xml version="1.0"?&gt;
        &lt;!DOCTYPE fontconfig SYSTEM "fonts.dtd"&gt;
        &lt;fontconfig&gt;
      </programlisting>

      <para>すでに説明したように、
	<filename>/usr/local/share/fonts/</filename> と
	<filename>~/.fonts/</filename> にあるすべてのフォントは
	Xft 対応のアプリケーションで利用できます。
	これら 2 つのディレクトリ以外に別のディレクトリを追加したいなら、
	<filename>/usr/local/etc/fonts/local.conf</filename>
	に以下のような行を追加してください。</para>

      <programlisting>&lt;dir&gt;/path/to/my/fonts&lt;/dir&gt;</programlisting>

      <para>新しいフォント、
	特に新しいフォントディレクトリを追加したら、
	フォントキャッシュを再構築してください。</para>

      <screen>&prompt.root; <userinput>fc-cache -f</userinput></screen>

      <para>アンチエイリアスをかけることによって境界が少しぼやけ、
	そのためにとても小さなテキストはさらに読みやすくなり、
	大きなフォントでは <quote>ギザギザ</quote> が消えるのです。
	しかし、普通のテキストにかけた場合には目が疲れてしまうこともあります。
	14 ポイント以下のサイズのフォントについて、
	アンチエイリアスをかけないようにするには次の行を加えます。</para>

      <programlisting>        &lt;match target="font"&gt;
            &lt;test name="size" compare="less"&gt;
                &lt;double&gt;14&lt;/double&gt;
            &lt;/test&gt;
            &lt;edit name="antialias" mode="assign"&gt;
                &lt;bool&gt;false&lt;/bool&gt;
            &lt;/edit&gt;
        &lt;/match&gt;
        &lt;match target="font"&gt;
            &lt;test name="pixelsize" compare="less" qual="any"&gt;
                &lt;double&gt;14&lt;/double&gt;
            &lt;/test&gt;
            &lt;edit mode="assign" name="antialias"&gt;
                &lt;bool&gt;false&lt;/bool&gt;
            &lt;/edit&gt;
        &lt;/match&gt;</programlisting>

      <indexterm>
	<primary>フォント</primary>
	<secondary>スペーシング</secondary>
      </indexterm>

      <para>いくつかの等幅フォントは、
	アンチエイリアスをかけるとスペーシングがうまくいかなくなる場合があります。
	特に <application>KDE</application> でその傾向があるようです。
	解決策の一つとして、そういったフォントのスペーシングを
	100 に設定する方法があります。
	そうするためには次の行を加えてください。</para>

      <programlisting>	&lt;match target="pattern" name="family"&gt;
            &lt;test qual="any" name="family"&gt;
                &lt;string&gt;fixed&lt;/string&gt;
            &lt;/test&gt;
            &lt;edit name="family" mode="assign"&gt;
                &lt;string&gt;mono&lt;/string&gt;
            &lt;/edit&gt;
        &lt;/match&gt;
        &lt;match target="pattern" name="family"&gt;
            &lt;test qual="any" name="family"&gt;
                &lt;string&gt;console&lt;/string&gt;
            &lt;/test&gt;
            &lt;edit name="family" mode="assign"&gt;
                &lt;string&gt;mono&lt;/string&gt;
            &lt;/edit&gt;
        &lt;/match&gt;</programlisting>

      <para>(これは固定サイズのフォントに <literal>"mono"</literal>
	という一般的な別名をつけます) そして以下を追加します。</para>

      <programlisting>        &lt;match target="pattern" name="family"&gt;
            &lt;test qual="any" name="family"&gt;
                &lt;string&gt;mono&lt;/string&gt;
            &lt;/test&gt;
            &lt;edit name="spacing" mode="assign"&gt;
                &lt;int&gt;100&lt;/int&gt;
            &lt;/edit&gt;
        &lt;/match&gt;</programlisting>

      <para>Helvetica の様なある種のフォントは、
	アンチエイリアスすると問題が起こるでしょう。
	たいてい、フォントが縦に半分に切られて表示されます。
	最悪の場合、アプリケーションがクラッシュします。
	これを回避するには、以下を <filename>local.conf</filename>
	に追加します。</para>

      <programlisting>        &lt;match target="pattern" name="family"&gt;
            &lt;test qual="any" name="family"&gt;
                &lt;string&gt;Helvetica&lt;/string&gt;
            &lt;/test&gt;
            &lt;edit name="family" mode="assign"&gt;
                &lt;string&gt;sans-serif&lt;/string&gt;
            &lt;/edit&gt;
        &lt;/match&gt;</programlisting>

      <para><filename>local.conf</filename> の編集を終えたら、
	ファイルの末尾が <literal>&lt;/fontconfig&gt;</literal>
	タグで終わるようにしてください。
	これを行わなければ、変更は無視されるでしょう。</para>

      <para>ユーザは自分だけの設定を各自の
	<filename>~/.config/fontconfig/fonts.conf</filename>
	に追加できます。
	このファイルもこれまでの説明と同じく <acronym>XML</acronym>
	形式を使います。</para>

      <indexterm><primary>LCD スクリーン</primary></indexterm>
      <indexterm><primary>フォント</primary>
	<secondary>LCD スクリーン</secondary></indexterm>

      <para>最後に一つ。LCD
	スクリーンではサブピクセルサンプリングが必要な場合があります。
	これは、基本的には (水平方向に分かれている) 赤、緑、
	青の各コンポーネントを別々に扱うことによって水平方向の解像度を良くするというもので、
	劇的な結果が得られます。
	これを有効にするには <filename>local.conf</filename>
	ファイルに次の行を加えます。</para>

      <programlisting>	 &lt;match target="font"&gt;
            &lt;test qual="all" name="rgba"&gt;
                &lt;const&gt;unknown&lt;/const&gt;
            &lt;/test&gt;
            &lt;edit name="rgba" mode="assign"&gt;
                &lt;const&gt;rgb&lt;/const&gt;
            &lt;/edit&gt;
        &lt;/match&gt;
      </programlisting>

      <note>
	<para>ディスプレイの種類にもよりますが、
	  <literal>rgb</literal> ではなく
	  <literal>bgr</literal> や <literal>vrgb</literal>、もしくは
	  <literal>vbgr</literal> の場合もあるので、
	  試してみて最も良いものを使ってください。</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="x-xdm">
    <info>
      <title>X ディスプレイマネージャ</title>

      <authorgroup>
	<author>
	  <personname>
	    <firstname>Seth</firstname>
	    <surname>Kingsley</surname>
	  </personname>
	  <contrib>寄稿: </contrib>
	</author>
      </authorgroup>
    </info>
    
    <indexterm><primary>X ディスプレイマネージャ</primary></indexterm>
    <para><application>&xorg;</application> は、
      ログインセッションの管理に用いることのできる
      X ディスプレイマネージャ <application>XDM</application>
      を提供しています。<application>XDM</application>
      はどのディスプレイサーバに接続するかを選択でき、
      ログイン名とパスワードの組み合わせなど認証情報を入力できるグラフィカルなインタフェースを提供しています。</para>

    <para>この章では、&os; 上での X
      ディスプレイマネージャの設定方法について説明します。
      デスクトップ環境によっては、
      各環境独自のグラフィカルログインマネージャを提供しています。
      GNOME ディスプレイマネージャの設定方法については、<xref
	linkend="x11-wm-gnome"/> を参照してください。
      また、KDE ディスプレイマネージャの設定方法については、<xref
	linkend="x11-wm-kde"/> を参照してください。</para>

    <sect2>
      <title><application>XDM</application> の設定</title>

      <para><application>XDM</application> をインストールするには、
	<package>x11/xdm</package> package または port
	を使ってください。
	インストール後、コンピュータの起動時に、
	<application>XDM</application> を起動するように設定するには、
	<filename>/etc/ttys</filename>
	の以下のエントリを変更してください。</para>

      <screen>ttyv8	"/usr/local/bin/xdm -nodaemon"	xterm	off secure</screen>

      <para><literal>off</literal> の部分を
	<literal>on</literal> に変更して、保存してください。
	このエントリの <literal>ttyv8</literal> は、
	<application>XDM</application> が
	9 番目の仮想端末で起動することを示しています。</para>

      <para><application>XDM</application> の設定用ディレクトリは
	<filename>/usr/local/etc/X11/xdm</filename> です。
	このディレクトリには <application>XDM</application>
	の振る舞いや見た目を変更するために用いられるファイルや、
	<application>XDM</application>
	の動作中にデスクトップを設定するためのスクリプトやプログラムがあります。
	<xref linkend="xdm-config-files"/> には、
	これらのフィアルの機能についてまとめられています。
	これらのファイルの正確な文法や使用方法については、&man.xdm.1;
	に記述されています。</para>

      <table frame="none" pgwide="1" xml:id="xdm-config-files">
	<title>XDM 設定ファイル</title>

	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>ファイル</entry>
	      <entry>説明</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><filename>Xaccess</filename></entry>
	      <entry><application>XDM</application>
		に接続するためのプロトコルは X Display
		Manager Connection Protocol (<acronym>XDMCP</acronym>)
		と呼ばれます。
		このファイルにはリモートのマシンからの
		<acronym>XDMCP</acronym>
		接続をコントロールするためのルールセットが書かれます。
		デフォルトでは、どのクライアントからの接続も拒否します。</entry>
	    </row>

	    <row>
	      <entry><filename>Xresources</filename></entry>
	      <entry>このファイルは、<application>XDM</application>
		ディスプレイの chooser およびログインスクリーンを設定します。
		デフォルトの設定は、シンプルな長方形のログインウィンドウで、
		コンピュータのホスト名がログインウィンドウの上部に大きなフォントで表示され、
		その下に <quote>Login:</quote> および <quote>Password:</quote>
		のプロンプトが表示されます。
		このファイルのフォーマットは <application>&xorg;</application>
		のドキュメントで記述されている
		app-defaults ファイルのものと同じです。</entry>
	    </row>

	    <row>
	      <entry><filename>Xservers</filename></entry>
	      <entry>これは、chooser
		がログインの選択肢として提供するローカルおよびリモートのディスプレイの一覧です。</entry>
	    </row>

	    <row>
	      <entry><filename>Xsession</filename></entry>
	      <entry>ユーザのログイン時に <application>XDM</application>
		により実行されるデフォルトのセッションスクリプトです。
		<filename>~/.xsession</filename>
		に置かれているカスタマイズされたセッションスクリプトが優先されます。</entry>
	    </row>

	    <row>
	      <entry><filename>Xsetup_</filename>*</entry>
	      <entry>これらは chooser
		やログインインタフェースが表示される前に自動的に実行されるアプリケーションです。
		それぞれのディスプレイに対して、<filename>Xsetup_*</filename>
		(<literal>*</literal> はローカルのディスプレイ番号)
		という名前のついたスクリプトがあります。
		典型的な使い方は <command>xconsole</command>
		のようなバックグラウンドで動かすプログラムを一つか二つ起動することです。</entry>
	    </row>

	    <row>
	      <entry><filename>xdm-config</filename></entry>
	      <entry>このマシンで動いているすべてのディスプレイのグローバルな設定</entry>
	    </row>

	    <row>
	      <entry><filename>xdm-errors</filename></entry>
	      <entry>このファイルにはサーバプログラムからのエラーが書き出されます。
	      <application>XDM</application>
	      が起動しようとしているディスプレイがなんらかの理由でハングした場合、
	      このファイルのエラーメッセージを見てください。
	      これらのメッセージは各ユーザの
	      <filename>~/.xsession-errors</filename>
	      ファイルにもセッション毎に書き出されます。</entry>
	    </row>

	    <row>
	      <entry><filename>xdm-pid</filename></entry>
	      <entry>現在動いている <application>XDM</application>
		のプロセス <acronym>ID</acronym>。</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>
    </sect2>

    <sect2>
      <title>リモートアクセスの設定</title>

      <para>デフォルトでは、<application>XDM</application>
	を使ってログインできるのは、同じシステムのユーザのみです。
	あるディスプレイサーバに他のシステムのユーザが接続できるようにするためには、
	アクセスコントロールのルールを編集し、
	コネクションリスナを有効にする必要があります。</para>

      <para><application>XDM</application>
	が他のリモートコネクションを待ち受けるようにするためには、
	<filename>/usr/local/etc/X11/xdm/xdm-config</filename> の
	<literal>DisplayManager.requestPort</literal>
	行を、行頭に <literal>!</literal>
	を置くことでコメントアウトしてください。</para>

      <screen>! SECURITY: do not listen for XDMCP or Chooser requests
! Comment out this line if you want to manage X terminals with xdm
DisplayManager.requestPort:     0</screen>

      <para>変更点を保存して、<application>XDM</application>
	を再起動してください。リモートアクセスを制限するには、
	<filename>/usr/local/etc/X11/xdm/Xaccess</filename>
	にある例を参考にしたり、詳細について
	&man.xdm.1; を参照してください。</para>
    </sect2>
  </sect1>

  <sect1 xml:id="x11-wm">
    <info>
      <title>デスクトップ環境</title>

      <authorgroup>
	<author>
	  <personname>
	    <firstname>Valentino</firstname>
	    <surname>Vaschetto</surname>
	  </personname>
	  <contrib>寄稿: </contrib>
	   <!-- in June 2001 -->
	</author>
      </authorgroup>
    </info>

    <para>この節では、良く使われている 3 つのデスクトップ環境を
      &os; 上でにインストールする方法について解説します。
      デスクトップ環境とは、
      単なるウィンドウマネージャから完全なデスクトップアプリケーションスイートまでカバーします。
      Ports Collection の <filename>x11-wm</filename> カテゴリには、
      100 を超えるデスクトップ環境が用意されています。</para>

    <sect2 xml:id="x11-wm-gnome">
      <title>GNOME</title>

      <indexterm><primary>GNOME</primary></indexterm>
      <para><application>GNOME</application>
	はユーザフレンドリなデスクトップ環境です。
	アプリケーションを起動したりステータスを表示するパネル、
	デスクトップ、ツールおよびアプリケーション群、
	そしてアプリケーションが互いにうまくやり取りできるような仕組みが含まれています。
	&os; 上の <application>GNOME</application>
	に関するもっと詳しい情報は、<link
	  xlink:href="https://www.FreeBSD.org/gnome">https://www.FreeBSD.org/gnome</link>
	で見ることができます。
	このウェブサイトには、&os; での <application>GNOME</application>
	のインストール、設定、管理に関する多くの情報があります。</para>

      <para>このデスクトップ環境は、package からインストールできます。</para>

      <screen>&prompt.root; <userinput>pkg install gnome3</userinput></screen>

      <para>ports から <application>GNOME</application>
	を構築するには、以下のコマンドを実行してください。
	<application>GNOME</application> は大きなアプリケーションなので、
	コンパイルには高速のコンピュータでも時間がかかります。</para>

      <screen>&prompt.root; <userinput>cd /usr/ports/x11/gnome3</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

      <para><application>GNOME</application> を使用するには、
	<filename>/proc</filename>
	ファイルシステムをマウントする必要があります。
	以下を <filename>/etc/fstab</filename> に追加して、
	システムの起動中にこのファイルシステムをマウントするように設定してください。</para>

      <programlisting>proc           /proc       procfs  rw  0   0</programlisting>

      <para><application>GNOME</application> は、
	メッセージバスおよびハードウェアアブストラクションに
	<application>D-Bus</application> および
	<application>HAL</application> を使います。
	これらのアプリケーションは、<application>GNOME</application>
	の依存として自動的にインストールされます。
	<filename>/etc/rc.conf</filename> の中で、
	システムの起動時にスタートするように有効にしてください。</para>

      <programlisting>dbus_enable="YES"
hald_enable="YES"</programlisting>

      <para>インストール後、
	<application>GNOME</application> を起動するように
	<application>&xorg;</application> を設定してください。
	最も簡単な方法は、GNOME ディスプレイマネージャ
	<application>GDM</application> を使うことです。
	<application>GDM</application> は、
	<application>GNOME</application> package または port
	の一部としてインストールされます。
	有効にするには、以下の行を <filename>/etc/rc.conf</filename>
	に追加してください。</para>

      <programlisting>gdm_enable="YES"</programlisting>

      <para><application>GNOME</application> のすべてのサービスを、
	起動するようにしておくと良いでしょう。
	このように設定するには、以下の行を <filename>/etc/rc.conf</filename>
	に追加してください。</para>

      <programlisting>gnome_enable="YES"</programlisting>

      <para>システムを再起動すると、<application>GDM</application>
	が自動的に起動します。</para>

      <para><application>GNOME</application> を起動するもう一つの方法は、
	<filename>.xinitrc</filename> を適切に設定した後で、
	コマンドラインから <command>startx</command> と入力する方法です。
	<filename>.xinitrc</filename> が既にある場合には、
	ウィンドウマネージャを起動する行を
	<filename>/usr/local/bin/gnome-session</filename>
	を起動するように変更してください。
	このファイルが存在しなければ、
	次のコマンドで作成してください。</para>

      <screen>&prompt.user; <userinput>echo "exec /usr/local/bin/gnome-session" &gt; ~/.xinitrc</userinput></screen>

      <para>3 つめの方法は、<application>XDM</application>
	をディスプレイマネージャとして使う方法です。
	この場合は、実行可能な <filename>.xsession</filename>
	というファイルを作成してください。</para>

      <screen>&prompt.user; <userinput>echo "exec /usr/local/bin/gnome-session" &gt; ~/.xsession</userinput></screen>
    </sect2>

    <sect2 xml:id="x11-wm-kde">
      <title>KDE</title>

      <indexterm><primary>KDE</primary></indexterm>

      <para><application>KDE</application>
	はもう一つの使いやすいデスクトップ環境です。
	このデスクトップは、統一されたルックアンドフィール、
	標準化されたメニューおよびツールバー、
	キーバインディング、カラースキーム、国際化、
	一元化されたダイアログベースのデスクトップ設定とともに、
	アプリケーションのスイートを提供します。
	<application>KDE</application> の詳細については	<link
	  xlink:href="http://www.kde.org/">http://www.kde.org/</link>
	をご覧ください。
	<application>KDE</application> に関する
	&os; 特有の情報については、<link
	  xlink:href="http://freebsd.kde.org/">http://freebsd.kde.org</link>
	をご覧ください。</para>

      <para><application>KDE</application> package
	をインストールするには以下のように実行してください。</para>

      <screen>&prompt.root; <userinput>pkg install x11/kde5</userinput></screen>

      <para><application>KDE</application> port
	を構築するには、以下のコマンドを使ってください。
	port のインストールでは、
	インストールするアプリケーションを選択するためのメニューが表示されます。
	<application>KDE</application> は大きなアプリケーションなので、
	高速のコンピュータでもコンパイルには時間がかかります。</para>

      <screen>&prompt.root; <userinput>cd /usr/ports/x11/kde5</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

      <para><application>KDE</application> では、
	<filename>/proc</filename>
	ファイルシステムをマウントする必要があります。
	以下の行を <filename>/etc/fstab</filename> に追加して、
	システム起動時にこのファイルシステムが自動的にマウントされるように設定してください。</para>

      <programlisting>proc           /proc       procfs  rw  0   0</programlisting>

      <para><application>KDE</application> は、
	メッセージバスおよびハードウェアアブストラクションに
	<application>D-Bus</application> および
	<application>HAL</application> を使います。
	これらのアプリケーションは、<application>KDE</application>
	の依存として自動的にインストールされます。
	<filename>/etc/rc.conf</filename> の中で、
	システムの起動時にスタートするように有効にしてください。</para>

      <programlisting>dbus_enable="YES"
hald_enable="YES"</programlisting>

      <indexterm>
	<primary>KDE</primary>
	<secondary>ディスプレイマネージャ</secondary>
      </indexterm>

      <para>KDE Plasma 5 から KDE のディスプレイマネージャ
	<application>KDM</application> の開発は終了しました。
	かわりに推奨されているのが <application>SDDM</application> です。
	インストールするには、以下を実行してください。</para>

      <screen>&prompt.root; <userinput>pkg install x11/sddm</userinput></screen>

      <para>その後、以下の行を
 	<filename>/etc/rc.conf</filename> に追加してください。</para>

      <programlisting>sddm_enable="YES"</programlisting>

      <para><application>KDE Plasma</application> を起動するもう一つの方法は、
	コマンドラインから <command>startx</command> を実行する方法です。
	このコマンドを実行するには、<filename>~/.xinitrc</filename>
	に以下の行を追加してください。</para>

      <programlisting>exec ck-launch-session startplasma-x11</programlisting>

      <para><application>KDE Plasma</application> を起動する 3 つめの方法は、
	<application>XDM</application> を利用する方法です。
	この方法を使うには、以下のようにして実行可能な
	<filename>~/.xsession</filename> を作成してください。</para>

      <screen>&prompt.user; <userinput>echo "exec ck-launch-session startplasma-x11" &gt; ~/.xsession</userinput></screen>

      <para><application>KDE Plasma</application> を起動した後は、
	ビルトインヘルプシステムから、
	さまざまなメニューおよびアプリケーションの使用方法などのより詳しい情報を参照できます。</para>
    </sect2>

    <sect2 xml:id="x11-wm-xfce">
      <title>Xfce</title>

      <para><application>Xfce</application> は
	<application>GNOME</application> で使われている
	GTK+ ツールキットをベースにしたデスクトップ環境ですが、より軽量、
	シンプルでかつ効率的でありながら使いやすいデスクトップ環境です。
	すべての設定が可能で、メニュー、
	アプレットおよびアプリケーションランチャを含むメインパネル、
	ファイルマネージャ、サウンドマネージャを提供し、
	テーマに対応しています。
	速くて軽く、効率的なため、古いマシンや遅いマシン、
	メモリの限られたマシンに向いています。
	<application>Xfce</application> に関する詳しい情報は <link
	  xlink:href="http://www.xfce.org/">http://www.xfce.org</link>
	で得られます。</para>

      <para><application>Xfce</application> package
	をインストールするには、次のように実行してください。</para>

      <screen>&prompt.root; <userinput>pkg install xfce</userinput></screen>

      <para>また、port を構築するには以下のようにしてください。</para>

      <screen>&prompt.root; <userinput>cd /usr/ports/x11-wm/xfce4</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

      <para><application>Xfce</application> は、
	メッセージバスに <application>D-Bus</application> を使います。
	これらのアプリケーションは <application>Xfce</application>
	の依存として自動的にインストールされます。
	<filename>/etc/rc.conf</filename> において、
	システム起動時に起動するように有効にしてください。</para>

      <programlisting>dbus_enable="YES"</programlisting>

      <para><application>GNOME</application> や
	<application>KDE</application> とは異なり、
	<application>Xfce</application> は、
	ログインマネージャを提供していません。
	コマンドラインから <command>startx</command> を実行して
	<application>Xfce</application> を起動するには、
	以下のコマンドを使って、
	<filename>~/.xinitrc</filename> を作成してください。</para>

      <screen>&prompt.user; <userinput>echo ". /usr/local/etc/xdg/xfce4/xinitrc" &gt; ~/.xinitrc</userinput></screen>

      <para>もう一つの方法は <application>XDM</application>
	を用いる方法です。この方法を使うには、
	実行可能な <filename>.xsession</filename> を作成してください。</para>

      <screen>&prompt.user; <userinput>echo ". /usr/local/etc/xdg/xfce4/xinitrc" &gt; ~/.xsession</userinput></screen>
    </sect2>
  </sect1>

  <sect1 xml:id="x-compiz-fusion">
    <title>Compiz Fusion のインストール</title>

    <para>魅力的な 3D 効果を使うと、
      デスクトップコンピュータを使う楽しさがさらに増えることでしょう。</para>

    <para><application>Compiz&nbsp;Fusion</application>
      のインストールは簡単ですが、設定の際には、port
      の文書には記載されていないような作業が必要となることがあります。</para>

    <sect2 xml:id="x-compiz-video-card">
      <title>&os; nVidia ドライバの設定</title>

      <para>デスクトップ効果は、
	グラフィックカードに極めて高い負荷をかけることがあります。
	nVidia ベースのグラフィックカードにおいて、
	良いパフォーマンスを出すには、
	プロプリエタリなドライバが必要となります。
	他のグラフィックカードを使っているユーザは、この節を飛ばし、
	<filename>xorg.conf</filename> の設定に進んでください。</para>

      <para>必要となる nVidia ドライバについては、
	<link xlink:href="&url.books.faq;/x.html#idp59950544">この問題に関する
	  FAQ </link> を参照して決めてください。</para>

      <para>使用しているカードに対する適切なドライバが決まれば、
	インストール作業は他の package
	をインストールするのと同じように簡単です。</para>

      <para>たとえば、
	最新のドライバをインストールするには以下のように実行してください。</para>

      <screen>&prompt.root; <userinput>pkg install x11/nvidia-driver</userinput></screen>

      <para>このドライバはカーネルモジュールを作成するので、
	このモジュールをシステムの起動時に読み込むように設定してください。
	以下の行を <filename>/boot/loader.conf</filename>
	に追加してください。</para>

      <programlisting>nvidia_load="YES"</programlisting>

      <note>
	<para>動作しているカーネルに、
	  カーネルモジュールを今すぐ読み込ませるには、
	  <command>kldload nvidia</command>
	  のようなコマンドを実行してください。
	  しかしながら、<application>&xorg;</application>
	  のバージョンによっては、
	  起動時にドライバが読み込まれていないと正しく動かないもありますので、
	  注意してください。<filename>/boot/loader.conf</filename>
	  を編集後は、再起動してください。</para>
      </note>

      <para>読み込まれたカーネルモジュールを使うには、
	通常は、<filename>xorg.conf</filename>
	ファイルの一つの行をプロプリエタリなドライバを使うように変更するだけです。</para>

      <para><filename>/etc/X11/xorg.conf</filename> において、
	以下の行を探し出してください。</para>

      <programlisting>Driver      "nv"</programlisting>

      <para>この行を以下のように変更してください。</para>

      <programlisting>Driver      "nvidia"</programlisting>

      <para>いつものように GUI を起動すると、nVidia
	のスプラッシュが表示されます。
	すべてはこれまで通りに動作するはずです。</para>
    </sect2>

    <sect2 xml:id="xorg-configuration">
      <title>デスクトップ効果のための xorg.conf の設定</title>

      <para><application>Compiz&nbsp;Fusion</application> を有効にするには
	<filename>/etc/X11/xorg.conf</filename>
	を変更する必要があります。</para>

      <para>コンポジット効果を有効にするには、
	以下のセクションを追加してください。</para>

      <programlisting>Section "Extensions"
    Option         "Composite" "Enable"
EndSection</programlisting>

      <para>以下のような <quote>Screen</quote>
	セクションの場所を見つけてください。</para>

      <programlisting>Section "Screen"
    Identifier     "Screen0"
    Device         "Card0"
    Monitor        "Monitor0"
    ...</programlisting>

      <para>(<quote>Monitor</quote> の後に)
	次の二つの行を追加してください。</para>

      <programlisting>DefaultDepth    24
Option         "AddARGBGLXVisuals" "True"</programlisting>

      <para>あなたが使用したいと考えているスクリーン解像度に対応する
	<quote>Subsection</quote> を探してください。
	たとえば、1280x1024 を使用する予定であれば、
	次のようなセクションを探してください。
	もし希望の解像度の subsection がなければ、
	手動でそのエントリを追加してください。</para>

      <programlisting>SubSection     "Display"
    Viewport    0 0
    Modes      "1280x1024"
EndSubSection</programlisting>

      <para>デスクトップコンポジットで
	24&nbsp;ビットのカラーが必要であれば、上述の subsection
	を以下のように変更してください。</para>

      <programlisting>SubSection     "Display"
    Viewport    0 0
    Depth       24
    Modes      "1280x1024"
EndSubSection</programlisting>

      <para>最後に、<quote>Module</quote> セクションに
	<quote>glx</quote> および <quote>extmod</quote>
	モジュールが読み込まれるように設定されていることを確認してください。</para>

      <programlisting>Section "Module"
    Load           "extmod"
    Load           "glx"
    ...</programlisting>

      <para>前述の設定は、
	<package>x11/nvidia-xconfig</package> を
	(<systemitem class="username">root</systemitem>
	権限で) 実行することで自動的に設定できます。</para>

      <screen>&prompt.root; <userinput>nvidia-xconfig --add-argb-glx-visuals</userinput>
&prompt.root; <userinput>nvidia-xconfig --composite</userinput>
&prompt.root; <userinput>nvidia-xconfig --depth=24</userinput></screen>
    </sect2>

    <sect2 xml:id="compiz-fusion">
      <title>Compiz&nbsp;Fusion のインストールおよび設定</title>

      <para><application>Compiz&nbsp;Fusion</application> のインストールは、
	他の package と同様に簡単です。</para>

      <screen>&prompt.root; <userinput>pkg install x11-wm/compiz-fusion</userinput></screen>

      <para>インストールが終了したら、グラフィックデスクトップを起動して、
	端末から以下のコマンドを通常のユーザで実行してください。</para>

      <screen>&prompt.user; <userinput>compiz --replace --sm-disable --ignore-desktop-hints ccp &amp;</userinput>
&prompt.user; <userinput>emerald --replace &amp;</userinput></screen>

      <para>使っているウィンドウマネージャ (<application>GNOME</application>
	では、<application>Metacity</application>) が、
	<application>Compiz&nbsp;Fusion</application> に置き換えられるため、
	画面は数秒間ちらつきます。
	<application>Emerald</application> がウィンドウデコレーション
	(たとえば、閉じる、最小化、最大化ボタンタイトルバーなど)
	を取り扱います。</para>

      <para>このコマンドをスクリプトに変換して、
	(たとえば <application>GNOME</application> デスクトップの
	<quote>Sessions</quote> に追加して)
	起動時に自動的に実行されるようにすることもできます。</para>

      <programlisting>#! /bin/sh
compiz --replace --sm-disable --ignore-desktop-hints ccp &amp;
emerald --replace &amp;</programlisting>

      <para>これを、たとえば <filename>start-compiz</filename>
	という名前でホームディレクトリに保存して、
	以下のように実行可能にしてください。</para>

      <screen>&prompt.user; <userinput>chmod +x ~/start-compiz</userinput></screen>

      <para>GUI を使って、このスクリプトを
	(<application>GNOME</application> デスクトップの
	<guimenuitem>System</guimenuitem>,
	<guimenuitem>Preferences</guimenuitem>,
	<guimenuitem>Sessions</guimenuitem> にある)
	<guimenuitem>Startup Programs</guimenuitem> に追加してください。</para>

      <para>すべての希望する効果と設定を選択するには、
	(もう一度通常のユーザで)
	<application>Compiz&nbsp;Config&nbsp;Settings&nbsp;Manager</application>
	を実行してください。</para>

      <screen>&prompt.user; <userinput>ccsm</userinput></screen>

      <note>
	<para><application>GNOME</application> では、
	  <guimenuitem>System</guimenuitem>,
	  <guimenuitem>Preferences</guimenuitem>
	  メニューから選択することも出来ます。</para>
      </note>

      <para>ビルドの際に <quote>gconf support</quote>
	を選択していたのであれば、
	<command>gconf-editor</command> を使って
	<literal>apps/compiz</literal> 以下を見ることで、
	これらの設定を確認することも出来ます。</para>
    </sect2>
  </sect1>

  <sect1 xml:id="x11-troubleshooting">

    <title>トラブルシューティング</title>

    <para>もしマウスが動作しなければ、
      先へ進む前にマウスの設定を行う必要があります。
      最近の <application>Xorg</application> では、デバイスの自動認識のため、
      <filename>xorg.conf</filename> の
      <literal>InputDevice</literal> セクションは無視されます。
      古い設定の記述を利用するには、
      このファイルの <literal>ServerLayout</literal> もしくは、
      <literal>ServerFlags</literal>
      セクションに以下の行を追加してください。</para>

      <programlisting>Option "AutoAddDevices" "false"</programlisting>

      <para>これで、以前のバージョンのように、入力デバイスを
	(キーボードレイアウトの変更のように)
	必要なオプションを用いて設定できるようになります。</para>

      <note>
	<para>すでに説明したように、デフォルトで
	  <application>hald</application>
	  デーモンがキーボードを自動的に認識します。
	  キーボードレイアウトやモデルを正しく認識しない場合でも、
	  <application>GNOME</application>,
	  <application>KDE</application> もしくは
	  <application>Xfce</application>
	  のようなデスクトップ環境が、
	  キーボードの設定ツールを提供しています。
	  しかしながら、
	  &man.setxkbmap.1; ユーティリティや
	  <application>hald</application> の設定ルールを利用することで、
	  キーボードのプロパティを直接設定できます。</para>

	<para>たとえば、フランス語のレイアウトの PC 102
	  キーボードを使いたい場合には、
	  <application>hald</application> のキーボード設定ファイル
	  <filename>x11-input.fdi</filename> を作成し、
	  <filename>/usr/local/etc/hal/fdi/policy</filename>
	  ディレクトリに保存してください。
	  このファイルは以下を含んでいる必要があります。</para>

	<programlisting>&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;
&lt;deviceinfo version="0.2"&gt;
  &lt;device&gt;
    &lt;match key="info.capabilities" contains="input.keyboard"&gt;
	  &lt;merge key="input.x11_options.XkbModel" type="string"&gt;pc102&lt;/merge&gt;
	  &lt;merge key="input.x11_options.XkbLayout" type="string"&gt;fr&lt;/merge&gt;
    &lt;/match&gt;
  &lt;/device&gt;
&lt;/deviceinfo&gt;</programlisting>

	<para>このファイルがすでに存在する場合には、
	  キーボードの設定に関する部分をただ単にコピーし、
	  ファイルに追加してください。</para>

	<para><application>hald</application>
	  がこのファイルを読み込むように、
	  コンピュータを再起動してください。</para>

	<para>X 端末やスクリプトから以下のコマンドラインを実行することでも、
	  同様に設定できます。</para>

	<screen>&prompt.user; <userinput>setxkbmap -model pc102 -layout fr</userinput></screen>

	<para><filename>/usr/local/share/X11/xkb/rules/base.lst</filename>
	  には、利用可能なキーボード、
	  レイアウトおよびオプションの一覧があります。</para>
      </note>

      <indexterm><primary><application>&xorg;</application>
	  のチューニング</primary></indexterm>

      <para><filename>xorg.conf.new</filename>
	設定ファイルを好みに合うように調整できます。
	&man.emacs.1; や &man.ee.1;
	のようなテキストエディタでファイルを開いてください。
	古いモニタや、通常とは異なるモデルで、
	同期周波数の自動認識に対応していない場合には、
	以下のような設定を <filename>xorg.conf.new</filename> の
	<literal>"Monitor"</literal>
	セクションの下に加えてください。</para>

      <programlisting>Section "Monitor"
        Identifier   "Monitor0"
        VendorName   "Monitor Vendor"
        ModelName    "Monitor Model"
        HorizSync    30-107
        VertRefresh  48-120
EndSection</programlisting>

      <para>ほとんどのモニタは同期周波数の自動認識に対応しているので、
	これらの値を手動で入力する必要はありません。
	自動認識に対応していないモニタでは、
	ダメージの可能性を避けるため、
	メーカーが提供している値のみを入力してください。</para>

      <para>X はモニタが対応していれば DPMS (Energy Star)
	機能を使うことができます。
	&man.xset.1; プログラムでタイムアウトをコントロールしたり、
	強制的にスタンバイ、サスペンドや電源オフにすることができます。
	モニタの DPMS 機能を有効にしたい場合は、
	<literal>"Monitor"</literal>
	セクションに次の行を加えてください。</para>

      <programlisting>Option       "DPMS"</programlisting>

      <indexterm>
	<primary><filename>xorg.conf</filename></primary>
      </indexterm>

      <para><filename>xorg.conf.new</filename>
	設定ファイルはエディタで開いたままにしておき、
	デフォルトの解像度と色数を好みで選んでください。
	<literal>"Screen"</literal>
	セクションで定義されます。</para>

      <programlisting>Section "Screen"
        Identifier "Screen0"
        Device     "Card0"
        Monitor    "Monitor0"
        DefaultDepth 24
        SubSection "Display"
                Viewport  0 0
                Depth     24
                Modes     "1024x768"
        EndSubSection
EndSection</programlisting>

      <para><literal>DefaultDepth</literal> というキーワードは
	実行時のデフォルトの色数について記述するためのものです。
	&man.Xorg.1; のコマンドラインスイッチ <option>-depth</option>
	が使用された場合はそちらが優先されます。
	<literal>Modes</literal> というキーワードは、
	与えられた色数におけるデフォルトの解像度を記述しておくためのものです。
	ターゲットのシステムのグラフィックハードウェアによって定義されている、
	VESA スタンダードモードのみがサポートされていることに注意してください。
	上の例ではデフォルトの色数はピクセルあたり 24 ビットであり、
	この色数での解像度は 1024 ピクセル× 768 ピクセルです。</para>

      <para>最後に、設定ファイルを保存し、
	上の例にあるようにテストしてみてください。</para>

      <note>
	<para>トラブルシューティングの過程で助けとなるツールのひとつに
	  <application>&xorg;</application> のログファイルがあります。
	  これには、<application>&xorg;</application>
	  サーバが検知したデバイスそれぞれについての情報があります。
	  <application>&xorg;</application> のログファイル名は
	  <filename>/var/log/Xorg.0.log</filename>
	  という形式です。実際のログファイル名は
	  <filename>Xorg.0.log</filename> から
	  <filename>Xorg.8.log</filename> のように変わります。</para>
      </note>

      <para>すべてうまくいったなら、設定ファイルを &man.Xorg.1;
	が見つけることができる共通の場所に置きます。
	これは、通常は <filename>/etc/X11/xorg.conf</filename> や
	<filename>/usr/local/etc/X11/xorg.conf</filename> です。</para>

      <screen>&prompt.root; <userinput>cp xorg.conf.new /etc/X11/xorg.conf</userinput></screen>

      <para>これで <application>&xorg;</application> の設定は完了です。
	&man.startx.1; ユーティリティで
	<application>&xorg;</application> を起動できます。
	&man.xdm.1; を使って <application>&xorg;</application>
	サーバを起動することもできます。</para>

      <sect2>
	<title>&intel; <literal>i810</literal>
	  グラフィックチップセットの設定</title>

	<indexterm>
	  <primary>&intel; i810 graphic chipset</primary>
	</indexterm>

	<para>&intel; i810 統合チップセットを設定するには、
	  <application>&xorg;</application> にカードを制御させるために
	  AGP プログラミングインタフェースである
	  <filename>agpgart</filename> が必要になります。
	  詳しくは、&man.agp.4;
	  ドライバのマニュアルページをご覧ください。</para>

	<para>このドライバを用いることで、
	  他のグラフィックボードと同様に設定を行うことができるようになります。
	  カーネルに &man.agp.4; ドライバが組み込まれていないシステムでは、
	  このモジュールを &man.kldload.8;
	  を使って読み込もうとしても動作しないことに注意してください。
	  このドライバは、
	  起動時にカーネル内に存在するようにカーネル内部に組み込むか、
	  <filename>/boot/loader.conf</filename>
	  を使わなければなりません。</para>
      </sect2>

      <sect2>
	<title>ワイドスクリーンフラットパネルの追加</title>

	<indexterm>
	  <primary>ワイドスクリーンフラットパネルコンフィグレーション</primary>
	</indexterm>

	<para>この節では、設定に関する幾分高度な知識を必要とします。
	  これまでに述べた標準ツールを使って設定に失敗する場合は、
	  ログファイルを参照してください。
	  ログファイルには、
	  設定のために有用な情報が十分含まれています。
	  テキストエディタを使用する必要があるでしょう。</para>

	<para>現在のワイドスクリーン
	  (WSXGA, WSXGA+, WUXGA, WXGA, WXGA+ など) は、
	  16:10 や 10:9 形式、または
	  (問題を含む可能性のある) 他のアスペクト比に対応しています。
	  以下は、16:10 アスペクト比のスクリーン解像度の例です。</para>

	<itemizedlist>
	  <listitem>
	    <para>2560x1600</para>
	  </listitem>

	  <listitem>
	    <para>1920x1200</para>
	  </listitem>

	  <listitem>
	    <para>1680x1050</para>
	  </listitem>

	  <listitem>
	    <para>1440x900</para>
	  </listitem>

	  <listitem>
	    <para>1280x800</para>
	  </listitem>
	</itemizedlist>

	<para>これらの解像度のひとつを以下のように
	  <literal>"Screen" セクション</literal> の
	  可能な <literal>Mode</literal> に追加してください。</para>

	<programlisting>Section "Screen"
Identifier "Screen0"
Device     "Card0"
Monitor    "Monitor0"
DefaultDepth 24
SubSection "Display"
	Viewport  0 0
	Depth     24
	Modes     "1680x1050"
EndSubSection
EndSection</programlisting>

	<para><application>&xorg;</application> は、I2C/DDC
	  情報を通してワイドスクリーンの解像度に関する情報を取得できるので、
	  モニタの周波数や解像度の範囲を把握しています。</para>

	<para>もし、これらの <literal>ModeLines</literal>
	  がドライバに存在しないのであれば、
	  <application>&xorg;</application>
	  にヒントを与えなけれならないでしょう。
	  <literal>ModeLine</literal>
	  を手動で設定するのに十分な情報を
	  <filename>/var/log/Xorg.0.log</filename>
	  から得ることができます。
	  以下のような情報を探してください。</para>

	<programlisting>(II) MGA(0): Supported additional Video Mode:
(II) MGA(0): clock: 146.2 MHz   Image Size:  433 x 271 mm
(II) MGA(0): h_active: 1680  h_sync: 1784  h_sync_end 1960 h_blank_end 2240 h_border: 0
(II) MGA(0): v_active: 1050  v_sync: 1053  v_sync_end 1059 v_blanking: 1089 v_border: 0
(II) MGA(0): Ranges: V min: 48  V max: 85 Hz, H min: 30  H max: 94 kHz, PixClock max 170 MHz</programlisting>

	<para>これは EDID と呼ばれる情報です。
	  この情報を用いて <literal>ModeLine</literal>
	  を作成するには、
	  正しい順番に数字を入力するだけです。 </para>

	<programlisting> ModeLine &lt;name&gt; &lt;clock&gt; &lt;4 horiz. timings&gt; &lt;4 vert. timings&gt;</programlisting>

	<para>この例では <literal>Monitor セクション </literal> の
	  <literal>ModeLine</literal>
	  は以下のようになります。</para>

	<programlisting>Section "Monitor"
Identifier      "Monitor1"
VendorName      "Bigname"
ModelName       "BestModel"
ModeLine        "1680x1050" 146.2 1680 1784 1960 2240 1050 1053 1059 1089
Option          "DPMS"
EndSection</programlisting>

	<para>以上の簡単な編集作業が終わったら、
	  新しいワイドスクリーンモニタ上で X が動作するでしょう。</para>
      </sect2>

      <sect2 xml:id="compiz-troubleshooting">
	<title>Compiz&nbsp;Fusion 使用時のトラブルシューティング</title>

	<qandaset>
	  <qandaentry>
	    <question xml:id="no-decorations">
	      <para><application>Compiz&nbsp;Fusion</application>
		をインストールし、説明されたようにコマンドを実行すると、
		ウィンドウのタイトルバーやボタンが表示されません。
		何が問題でしょうか？</para>
	    </question>

	    <answer>
	      <para>おそらく <filename>/etc/X11/xorg.conf</filename>
		の設定が行われていていないのでしょう。
		このファイルを詳細に確認してください。特に
		<literal>DefaultDepth</literal> および
		<literal>AddARGBGLXVisuals</literal>
		ディレクティブを確認してください。</para>
	    </answer>
	  </qandaentry>

	  <qandaentry>
	    <question xml:id="xorg-crash">
	      <para><application>Compiz&nbsp;Fusion</application>
		を起動するコマンドを実行すると、X サーバがクラッシュし、
		コンソールに戻ります。何が問題でしょうか？</para>
	    </question>

	    <answer>
	      <para><filename>/var/log/Xorg.0.log</filename>
		ファイルを確認すると、
		X の起動時のエラーメッセージを探し出すことができます。
		多くの場合は、以下のようなものです。</para>

	      <screen>(EE) NVIDIA(0):     Failed to initialize the GLX module; please check in your X
(EE) NVIDIA(0):     log file that the GLX module has been loaded in your X
(EE) NVIDIA(0):     server, and that the module is the NVIDIA GLX module.  If
(EE) NVIDIA(0):     you continue to encounter problems, Please try
(EE) NVIDIA(0):     reinstalling the NVIDIA driver.</screen>

	    <para>これは通常 <application>&xorg;</application>
	      をアップグレードした時に起きる現象です。
	      <package>x11/nvidia-driver</package> package
	      をインストールして glx を再構築してください。</para>
	  </answer>
	</qandaentry>
      </qandaset>
    </sect2>
  </sect1>
</chapter>

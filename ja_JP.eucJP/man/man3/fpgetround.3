.\" Copyright (c) 1993 Andrew Moore, Talke Studio
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @(#)fpgetround.3	1.0 (Berkeley) 9/23/93
.\"	$Id: fpgetround.3,v 1.1.1.1 1999-12-09 16:26:05 kuriyama Exp $
.\"
.Dd August 23, 1993
.Dt FPGETROUND 3
.Os
.Sh 名称
.Nm fpgetround ,
.Nm fpsetround ,
.Nm fpsetprec ,
.Nm fpgetprec ,
.Nm fpgetmask ,
.Nm fpsetmask ,
.Nm fpgetsticky ,
.Nm fpresetsticky
.Nd IEEE 浮動小数インタフェース
.Sh 書式
.Fd #include <floatingpoint.h>
.Ft typedef enum {
.br
.Fa 	FP_RN,	
.Li		/* round to nearest */
.br
.Fa 	FP_RM,	
.Li		/* round to minus infinity */
.br
.Fa 	FP_RP,	
.Li		/* round to plus infinity */
.br
.Fa 	FP_RZ,	
.Li		/* truncate */
.br
.Ft } fp_rnd_t;
.Pp
.Ft fp_rnd_t
.Fn fpgetround void
.Ft fp_rnd_t
.Fn fpsetround "fp_rnd_t direction"
.Pp
.nr fZ 0
.Ft typedef enum {
.br
.Fa 	FP_PS,	
.Li		/* 24 bit (single-precision) */
.br
.Fa 	FP_PRS,	
.Li		/* reserved */
.br
.Fa 	FP_PD,	
.Li		/* 53 bit (double-precision) */
.br
.Fa 	FP_PE,	
.Li		/* 64 bit (extended-precision) */
.br
.Ft } fp_prec_t;
.Pp
.Ft fp_prec_t
.Fn fpgetprec void
.Ft fp_prec_t
.Fn fpsetprec "fp_prec_t precision"
.Pp
.Fd #define fp_except_t int
.Fd #define FP_X_INV	0x01		/* invalid */
.Fd #define FP_X_OFL	0x08		/* overflow */
.Fd #define FP_X_UFL	0x10		/* underflow */
.Fd #define FP_X_DZ	0x04		/* divide-by-zero */
.Fd #define FP_X_IMP	0x20		/* loss of precision */
.Fd #define FP_X_DNML	0x02		/* denormal */
.Ft fp_except_t
.Fn fpgetmask void
.Ft fp_except_t
.Fn fpsetmask "fp_except_t mask"
.Ft fp_except_t
.Fn fpgetsticky void
.Ft fp_except_t
.Fn fpresetsticky "fp_except_t sticky"
.Sh 解説
浮動小数例外が検出されると、例外スティッキフラグが設定され、例外マスク
が検査されます。マスクが設定されている場合はトラップが発生します。この
ルーチンでは、浮動小数例外マスクの設定、および例外が発生した後での例外
スティッキフラグのリセットができます。浮動小数丸めモードと精度も
設定できます。
.Pp
.Fn fpgetround
関数は、現在の浮動小数丸めモードを戻します。
.Pp
.Fn fpsetround
関数は、浮動小数丸めモードを設定し、前のモードを
戻します。
.Pp
.Fn fpgetprec
関数は、現在の浮動小数精度を戻します。
.Pp
.Fn fpsetprec
関数は、浮動小数精度を設定し、前の精度を戻します。
.Pp
.Fn fpgetmask
関数は、現在の浮動小数例外マスクを戻します。
.Pp
.Fn fpsetmask
関数は、浮動小数例外マスクを設定し、前のマスクを戻します。
.Pp
.Fn fpgetsticky
関数は、現在の浮動小数スティッキフラグを戻します。
.Pp
.Fn fpresetsticky
関数は、浮動小数スティッキフラグをクリアし、前のフラグ
を戻します。
.Pp
以下は、ゼロ除算によるトラップを防ぐコード例です。
.Bd -literal -offset indent
fpsetmask(~FP_X_DZ);
a = 1.0;
b = 0;
c = a / b;
fpresetsticky(FP_X_DZ);
fpsetmask(FP_X_DZ);
.Ed
.Sh 関連項目
.Xr isnan 3
.Sh 警告
浮動小数例外が発生した後、かつ、マスクを設定する前に、
スティッキフラグをリセットする必要があります。スティッキフラグをリセット
する前に別の例外が発生した場合は、誤った例外タイプが
通知されることがあります。
.Sh 歴史
このルーチンは、同じ名前の SysV/386 ルーチンに基づいています。
.\"X kuma 1999-11-5

.\" Copyright (c) 1980, 1991, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @(#)getrlimit.2	8.1 (Berkeley) 6/4/93
.\" %FreeBSD: src/lib/libc/sys/getrlimit.2,v 1.8.2.1 1999/08/29 14:49:02 peter Exp %
.\"
.Dd June 4, 1993
.Dt GETRLIMIT 2
.Os BSD 4
.Sh 名称
.Nm getrlimit ,
.Nm setrlimit
.Nd 最大システムリソース消費を制御する
.Sh 書式
.Fd #include <sys/types.h>
.Fd #include <sys/time.h>
.Fd #include <sys/resource.h>
.Ft int
.Fn getrlimit "int resource" "struct rlimit *rlp"
.Ft int
.Fn setrlimit "int resource" "const struct rlimit *rlp"
.Sh 解説
現在のプロセス、およびそれが作成する各プロセスによるシステムリソースの
消費のリミットは、
.Fn getrlimit
によって得ることができ、
.Fn setrlimit
呼び出しで設定できます。
.Pp
.Fa resource
パラメータは次のうちの 1 つです。
.Bl -tag -width RLIMIT_FSIZEAA
.It Li RLIMIT_CORE
作成できる
.Xr core 5
ファイルの最大サイズ (バイト単位)
.It Li RLIMIT_CPU
各プロセスが使用する CPU 時間の最大量 (秒単位)
.It Li RLIMIT_DATA
プロセス用のデータセグメントの最大サイズ (バイト単位)。これは、プログラムが
そのブレークを
.Xr sbrk 2
システムコールでどのくらい遠くまで延長できるかを定義します。
.It Li RLIMIT_FSIZE
作成できるファイルの最大サイズ (バイト単位)
.It Li RLIMIT_MEMLOCK
プロセスが
.Xr mlock 2
関数を使用して、プロセスをメモリにロックできる
最大サイズ (バイト単位)。
.It Li RLIMIT_NOFILE
このプロセスが開けるファイルの最大数
.It Li RLIMIT_NPROC
このユーザ ID が同時に利用できるプロセスの最大数
.It Li RLIMIT_RSS
増加させて良いプロセスの常駐セットサイズの最大サイズ (バイト単位)。
これはプロセスに与えられる物理メモリの量に制限を課します。
メモリが逼迫してシステムがメモリを回収する際に、
宣言された常駐セットサイズを越えるプロセスを回収対象として選択します。
.It Li RLIMIT_STACK
プロセスのスタックセグメントの最大サイズ (バイト数)。これによって、
プログラムのスタックセグメントがどのくらい遠くまで延長できるか定義できます。
スタック延長はシステムによって自動的に実行されます。
.El
.Pp
リソースリミットはソフトリミットおよびハードリミットとして指定されます。
ソフトリミットを越えた場合、
プロセスはシグナル (たとえば、CPU 時間またはファイルサイズを越えたかどうか)
を受信する可能性がありますが、
ハードリミットに到達する (またはリソースリミットを修正する)
まで実行を継続することはできます。
.Em rlimit
構造体を使用してリソースのハードリミットとソフトリミットを指定できます。

.Bd -literal -offset indent
struct rlimit {
	rlim_t	rlim_cur;	/* 現在の (ソフト) リミット */
	rlim_t	rlim_max;	/* rlim_cur の最大値 */
};
.Ed
.Pp
スーパユーザだけがリミットの最大値を大きくできます。他のユーザは、0 から
.Fa rlim_max
の範囲内で
.Fa rlim_cur
を変更するか、または
.Fa rlim_max
を下げられるだけです (撤回できません)。
.Pp
リミットを
.Dq 無制限
にする値は
.Dv RLIM_INFINITY
として定義されます。
.Pp
この情報はプロセスごとの情報に保存されるので、
このシステムコールがシェルの作成する将来のすべての
プロセスに影響を及ぼすためには、
このシステムコールをシェルが直接実行する必要があります。このため
.Ic limit
は
.Xr csh 1
の組み込みコマンドです。
.Pp
システムは、通常の方法でリミットを超えようとするときに、
データまたはスタック空間を延長することを拒絶します。
データ空間リミットに到達すると
.Xr brk 2
呼び出しは処理に失敗します。スタックリミットに到達すると、プロセスは
セグメント化侵犯
.Pq Dv SIGSEGV
を受信します。
シグナルスタックを使用するハンドラによってこのシグナルが捕捉されない
場合、このシグナルはプロセスを抹消します。
.Pp
プロセスのソフトリミットより大きなファイルを作成するファイル入出力操作によって
書込みは処理に失敗し、シグナル
.Dv SIGXFSZ
が生成されます。通常、これによってプロセスは終了しますが、
捕捉することもできます。
CPU 時間のソフトリミットを越えたとき、シグナル
.Dv SIGXCPU
が障害を起こしているプロセスに送信されます。
.Sh 戻り値
戻り値 0 は呼び出しが正常に完了し、リソースリミットを変更しているか、
またはリソースリミットを返している
ことを示します。戻り値 -1 はエラーが起こったことを示し、
エラーコードはグローバル変数
.Va errno
に保存されます。
.Sh エラー
.Fn getrlimit
と
.Fn setrlimit
は次の場合に失敗します。
.Bl -tag -width Er
.It Bq Er EFAULT
.Fa rlp
で指定したアドレスが無効です。
.It Bq Er EPERM
.Fn setrlimit
に指定されたリミットがリミットの最大値を上昇させようとましたが、
呼び出し側はスーパユーザではありません。
.El
.Sh 関連項目
.Xr csh 1 ,
.Xr quota 1 ,
.Xr quotactl 2 ,
.Xr sigaltstack 2 ,
.Xr sigvec 2 ,
.Xr sysctl 3
.Sh 歴史
.Fn getrlimit
関数は
.Bx 4.2
で登場しました。

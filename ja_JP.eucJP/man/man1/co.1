.\" jpman %Id: co.1,v 1.2 1997/06/01 11:30:43 horikawa Stab %
.de Id
.ds Rv \\$3
.ds Dt \\$4
..
.Id %FreeBSD: src/gnu/usr.bin/rcs/co/co.1,v 1.5.2.1 1999/08/29 14:34:46 peter Exp %
.ds i \&\s-1ISO\s0
.ds r \&\s-1RCS\s0
.ds u \&\s-1UTC\s0
.if n .ds - \%--
.if t .ds - \(em
.TH CO 1 \*(Dt GNU
.SH 名称
co \- RCS ファイルからリビジョンをチェックアウトする
.SH 書式
.B co
.RI [ options ] " file " .\|.\|.
.SH 解説
.B co
は、各 \*r ファイルからリビジョンを取り出し、
対応したワークファイルに格納します。
.PP
\*r 拡張子にマッチするファイル名は \*r ファイルであるとみなし、
その他のファイル名はワークファイルであるとみなします。
ファイル名の対応に関しては、
.BR ci (1)
を参照してください。
.PP
\*r ファイルのリビジョンは、ロックしてもしなくともチェックアウトできます。
リビジョンをロックすることにより、
同時に複数の更新が行われることを防止します。
内容を表示したり、読むだけの処理(たとえば、コンパイル)で用いたりする場合は
ロックする必要はありません。
編集し後にチェックインするつもりで \*r ファイルから取り出す場合は、
通常、ロックしなければなりません。
他のユーザによってロックされているリビジョンを
ロックしてチェックアウトしようとするとエラーになります(ロックは
.BR rcs (1)
によって解除することができます)。
更に、リビジョンをロックしてチェックアウトするには、
チェックアウトする人が \*r ファイルのアクセスリストに登録されているか、
そのファイルの所有者もしくはスーパユーザであるか、
アクセスリストが空である必要が有ります。
ロックしないで取り出す場合は、
アクセスリストや他人のロックに影響されることはありません。
.PP
取り出されるリビジョンを、リビジョン番号、枝番号、
チェックイン日時、作者、状態によって指定するオプションが存在します。
複数のオプションが組み合わされて指定された場合、
.B co
はすべての条件に合致するリビジョンのうちで最新のものを取り出します。
リビジョン指定オプションが指定されなかった場合、
.B co
は、デフォルト枝(通常は幹:
.BR rcs (1)
の
.B \-b
オプションの項を参照)の最新のリビジョンを取り出します。
リビジョン番号あるいは枝番号は、
以下のオプションを使って指定することができます:
.BR \-f ,
.BR \-I ,
.BR \-l ,
.BR \-M ,
.BR \-p ,
.BR \-q ,
.BR \-r ,
.B \-u
。
オプション
.B \-d
(日時)、
.B \-s
(状態)、
.B \-w
(作者)は、単一の枝から取り出します。
この枝は
.I 選択された
枝であり、
.BR \-f ,
\&.\|.\|.,
.B \-u
オプションもしくはデフォルト枝により指定されます。
.PP
リビジョンを 1 つも持たない \*r ファイルに対して
.B co
コマンドを適用すると、長さ 0 のワークファイルが作成されます。
.B co
は、つねにキーワード置換を行います
(下記参照)。
.SH オプション
.TP
.BR \-r [\f2rev\fP]
リビジョン番号
.I rev
以前(
.I rev
と同じものも含む)で最新のリビジョンを取り出します。
.I rev
がリビジョンではなく枝を指定している場合、その枝上の最新
のリビジョンが取り出されます。
.I rev
が省略された場合、デフォルト枝
(
.BR rcs (1)
の
.B \-b
オプションの項を参照)の最新のリビジョンが取り出されます。
.I rev
が
.B $
の場合、
.B co
はリビジョン番号をワークファイルのキーワードから
取り出します。これら以外の場合、
.I rev
はリビジョンを示すピリオドで区切られた数字またはシンボルの列です。
.I rev
がピリオドで始まる場合、デフォルトの枝(通常は幹)が設定されます。
.I rev
がピリオドを後ろに付けた枝番号であるならば、
その枝の最新のリビジョンが使われます。
シンボルは、
.BR ci (1)
や
.BR rcs (1)
によりリビジョン番号と結びつけることができます。
.TP
.BR \-l [\f2rev\fP]
.B \-r
と同様の動作ですが、取り出したリビジョンを呼び出したユーザにてロックします。
.TP
.BR \-u [\f2rev\fP]
.B \-r
と同様の動作ですが、取り出したリビジョンが呼び出したユーザによって
ロックされていたならば、そのロックを解除します。
.I rev
が省略された場合、
.B co
を起動したユーザがロックしたリビジョンが 1 つあれば、
そのリビジョンを取り出します;
そうでなければ、デフォルト枝の最新のリビジョンを取り出します。
.TP
.BR \-f [\f2rev\fP]
ワークファイルの上書きを強制します；
後述の
.B \-q
オプションを使用する場合、いっしょに
.B \-f
オプションも
指定すると便利な場合があります。
.SM "ファイルモード"
の項も参照してください。
.TP
.B \-kkv
ワークファイルにデフォルト形式のキーワード文字列を埋め込みます。たとえば、
キーワード
.B Revision
に対しては、文字列
.B "$\&Revision: \*(Rv $"
を生成します。
.B "ci\ \-l"
や
.B "co\ \-l"
でファイルがロックされる時のみ、
.BR Header ,
.BR Id ,
.B Locker
キーワードにロック者名を挿入します。これがデフォルトの動作です。
.TP
.B \-kkvl
.B \-kkv
とほぼ同様ですが、指定されたリビジョンがロックされていた場合にはいつも、
ロック者名を挿入します。
.TP
.BR \-kk
キーワード文字列中のキーワード名のみの文字列を生成し、値は省略します。
後述の
.SM "キーワード置換"
を参照して下さい。
たとえば、キーワード 
Revision に対しては、通常の
.B "$\&Revision: \*(Rv $"
のかわりに、
.B "$\&Revision$"
を生成します。これは、異なるリビジョンの内容を比較する場合、キーワード
値の違いを無視できるので、便利です。
.B -kk
が指定されても、キーワード
.B "$\&Log$"
の後にはログメッセージが挿入されます。これはリビジョンを統合する変更に、
より便利であることを意図しています。
.TP
.BR \-ko
チェックインされる前の
ワークファイル中のキーワード文字列をそのまま出力します。たとえば、
キーワード
.B "$\&Revision$"
に対しては、
チェックインされる前に展開されていた文字列
.B "$\&Revision: 1.1 $"
が、
.B "$\&Revision: \*(Rv $"
の代わりに展開されます。
キーワード文字列の形式を取るバイト列が置換されてしまっては困るような
場合(訳注:バイナリファイル等)に便利でしょう。
.TP
.BR \-kb
元のキーワード文字列のバイナリイメージを生成します。これは、
.B \-ko
とほぼ同じですが、入出力する全てのワークファイルをバイナリモードで
扱う点が違います。これは、Posix と Unix のホスト間ではたいした違いでは
ありません。が、DOS のようなシステムではバイナリファイルを扱う場合、
\*r ファイルの初期化には
.B rcs \-i \-kb
を使わねばならないでしょう。
また、全ての環境において、
.BR rcsmerge(1)
は通常、
.B \-kb
が働いている場合はファイルの統合を受け付けません。
.TP
.BR \-kv
キーワード文字列としてキーワード値のみを生成します。たとえば、キーワード 
.B Revision
に対して、通常の
.B "$\&Revision: \*(Rv $"
のかわりに
.B \*(Rv
を生成します。
これは、キーワード文字列から
.B "$\&Revision: $"
のようなキーワード区切りを取
り除くことが困難なプログラミング言語用のファイル等を生成するために
使用します。しかしながら、キーワード名が取り除かれてしまうと、それ以降に
キーワード置換を行うことができないので、注意が必要です。
キーワードを失うことはこのように危険であるため、本オプションを
.B \-l 
オプションと組み合わせて使うことはできません。また、ワークファイルの
書き込み権はオフになります;
後でワークファイルを編集する場合は、
.B \-kv
オプションを指定せずにワークファイルを取り出してから行います。
.TP
.BR \-p [\f2rev\fP]
ワークファイルに格納する代わりに、
対象となるリビジョンを標準出力に書き出します。
.B co
をパイプの一部として使用する場合に便利です。
.TP
.BR \-q [\f2rev\fP]
静かなモード; 診断メッセージを表示しません。
.TP
.BR \-I [\f2rev\fP]
対話モード; たとえ標準入力が端末でなくても、ユーザに対して
問い合わせを行います。
.TP
.BI \-d date
選択された枝上の、
.I date
以前の登録日付を持つ、最新のリビジョンを取り出します。
日付と時刻は自由形式で指定します。タイムゾーンとして
.B LT
を指定することにより、ローカルタイムを使用することができます;
他の一般的なタイムゾーンも使用することができます。
たとえば、以下に挙げるいくつかの
.I date
指定は、
太平洋標準時における 1990 年 1 月 11 日午後 8 時と同時刻を示します
(太平洋標準時は協定世界時 (\*u) よりも 8 時間遅れです)。
.RS
.LP
.RS
.nf
.ta \w'\f3Thu, 11 Jan 1990 20:00:00 \-0800\fP  'u
.ne 9
\f38:00 pm lt\fP
\f34:00 AM, Jan. 12, 1990\fP	デフォルトは \*u
\f31990-01-12 04:00:00+00\fP	\*i 8601 (\*u)
\f31990-01-11 20:00:00\-08\fP	\*i 8601 (ローカル時刻)
\f31990/01/12 04:00:00\fP	伝統的 \*r 形式
\f3Thu Jan 11 20:00:00 1990 LT\fP	\f3ctime\fP(3) + \f3LT\fP出力
\f3Thu Jan 11 20:00:00 PST 1990\fP	\f3date\fP(1)出力
\f3Fri Jan 12 04:00:00 GMT 1990\fP
\f3Thu, 11 Jan 1990 20:00:00 \-0800\fP	インターネット RFC 822
\f312-January-1990, 04:00 WET\fP
.ta 4n +4n +4n +4n
.fi
.RE
.LP
ほとんどの日付の項目にはデフォルト値があります。
デフォルトのタイムゾーンは \*u です。
これは
.B \-z
オプションにて優先指定することが出来ます。
他のデフォルト値は、年、月、日、時、分、秒 の順番で決定されます。
これらの項目のうち、少なくとも 1 つが指定されなければいけません。
指定のある項目よりも先に決定される項目が省略されている場合には、
タイムゾーンにおける現在の値を使用します。
他の省略されたフィールドには最小値が採用されます。
たとえば、
.B \-z
無しの
.B "20, 10:30"
の場合は、\*u タイムゾーンの現在の年月の 20 日 10:30:00 \*u が採用されます。
日付の指定に空白が含まれる場合には、
日付の指定をクオートでくくる必要があることに注意してください。
.RE
.TP
.BR \-M [\f2rev\fP]
作成されるワークファイルの最終更新日付を、取り出されるリビジョンの日付に
します。本オプションを指定すると
.BR make (1)
が正しく動作しなくなるので、注意して使用する必要があります。
.TP
.BI \-s state
選択された枝上の、状態
.I state
を持つ最新のリビジョンを取り出します。
.TP
.BR \-T
\*r ファイルの変更日付を変更しません。
ロックされたりロック解除されたりして \*r ファイルが変更された場合でもです。
このオプションは、コピーした \*r ファイルのワークファイルを使って
.BR make (1)
をかける際に再コンパイルをさせたくない場合に便利でしょう。
このオプションは必要であるにもかかわらず再コンパイルを行なわないことに
なってしまう場合があるので注意が必要です。
それは、ロックの変更が別のワークファイルのキーワード文字列の変更を行う時です。
.TP
.BR \-w [\f2login\fP]
選択された枝上の、ユーザ名
.I login
によって登録された最新のリビジョンを取り出します。
.I login
が省略された場合は、
.B co
を起動したユーザ名を使います。
.TP
.BI \-j joinlist
.I joinlist
で指定されたリビジョンを結合した新しいリビジョンを作成します。
本オプションは、旧バージョンとの互換性のために残されています。
通常、リビジョンの結合には
.BR rcsmerge (1)
を用います。
.RS
.PP
.I joinlist
は
.IB rev2 : rev3
形式のリビジョンの対をコロンで区切って並べたリストです。
ここで、
.I rev2
と
.I rev3
は(シンボリックまたは数字の)リビジョン番号です。
以下の説明で、
.I rev1
は以下のリビジョンを示します: (1) joinlist に列挙さ
れた対のうち、最初のものは、上記の
.BR \-f ,
\&.\|.\|.,
.B \-w
オプションによって選択されたリビジョンです。
(2) それ以外の対に対しては、直前の対から作成されたリビジョン
(すなわち、1 つの対によって作成されたリビジョンは次の結合
のための入力となります)。
.PP
それぞれの対に対して、
.B co
は
.I rev1
と
.I rev3
を
.I rev2
と比較しながら結合します。つまり、
.I rev2
を
.I rev1
と同一にするための変更を、
.I rev3
のコピーに対して適用します。
.I rev2
を同一の祖先とする 2 つの枝の末端のリビジョン
.I rev1 
と
.I rev3
を結合するのによく用いられます。もし、3 つのリビジョンが同一の
枝上にあり、リビジョン番号が
.IR rev1 < rev2 < rev3
ならば、結合の結果は、
.I rev3 
の内容のうち、
.I rev1
から
.I rev2
への変更を無効にしたものになります。
もし、
.I rev2
から
.I rev1
への変更が
.I rev2
から
.I rev3
への変更と重複している
なら、
.B co
は
.BR merge (1)
に示したような報告を行います。
.PP
最初に指定する対では
.I rev2
を省略することができます。この場合は、
.I rev1
と
.I rev3
の共通の祖先
.ig
／＊？-> 共通の祖先リビジョン以外に言いかたを思いつきません
共通の祖先リビジョンで良いと思います(horikawa@jp.freebsd.org)

共通の祖先リビジョン
 |        |        |
revX     rev3     revY
 |
rev1


＊／
..
リビジョンを
.I rev2
として使用します。もし、いずれかの引数
がリビジョンではなく枝を示しているなら、その枝上の最新のリビジョンが用
いられます。同時に
.B \-l
オプションや
.B \-u
オプションを指定すると、
.I rev1
がロックまたはロック解除されます。
.RE
.TP
.BI \-V
\*r's のバージョン番号を表示します。
.TP
.BI \-V n
バージョン
.I n
の \*r システムの動作をエミュレートします。
.I n
は
.BR 3 ,
.BR 4 ,
.B 5 
のいずれかです。これは、古い \*r を使っているユーザと \*r ファイルを交
換するときに便利です。使用している \*r がどのバージョンかを調べるには、
.BR "rcs \-V"
を実行します; これは最近のバージョンの \*r では動作します。
これが動作しない場合は適当な \*r ファイルに対して
.B rlog
を起動します; 最初の数行に文字列
.B branch:
がなければ、それはバージョン 3 です; 
また、日付に現れる年が 2 桁の数字ならば、それはバージョン 4 です;
どちらでもなければ、バージョン 5 です。
\*r バージョン 3 をエミュレートして作成された \*r ファイルからはデフォルト
枝の情報が失われます。
バージョン 4 またはそれ以前のバージョンをエミュレートして作成された
リビジョンは、最大 13 時間ずれた日付を持つことになります。
バージョン 4 またはそれ以前のバージョンをエミュレートして取り出された
ファイルには
.IB yy / mm / dd
形式の日付がキーワード中に展開されます。また、
.B $\&Log$
キーワードでは空白の入り方が異なります。
.TP
.BI \-x "suffixes"
\*r ファイルの拡張子として
.I suffixes
を使用します。詳細は
.BR ci (1)
を参照して下さい。
.TP
.BI \-z zone
キーワード置換での日付の出力書式の指定を行い、また、
.BI \-d date
オプションでの
.I date
のデフォルトのタイムゾーンの指定を行います。
.I zone
は、省略する事も、UTC からの数値差で指定する事も、特別な文字列
.B LT
を使ってローカル時間で指定する事もできます。
デフォルトでは
.I zone
は空であり、
この場合は伝統的な \*r フォーマット、
すなわちタイムゾーン無しの \*u であり日付をスラッシュで区切ります;
そうでない場合は時刻はタイムゾーン付の \*i 8601 フォーマットです。
例えば、ローカルタイムが 1990 年 1 月 11 日 太平洋標準時間
(\*u の 8 時間西)午後 8 時の場合、時間の出力は次のようになります:
.RS
.LP
.RS
.nf
.ta \w'\f3\-z+05:30\fP  'u +\w'\f31990-01-11 09:30:00+05:30\fP  'u
.ne 4
\f2オプション\fP\f2時刻の出力\fP
\f3\-z\fP	\f31990/01/12 04:00:00\fP	\f2(デフォルト)\fP
\f3\-zLT\fP	\f31990-01-11 20:00:00\-08\fP
\f3\-z+05:30\fP	\f31990-01-12 09:30:00+05:30\fP
.ta 4n +4n +4n +4n
.fi
.RE
.LP
.B \-z
オプションは \*r ファイルに格納されている日付(常に \*u です)には影響しません。
.RE
.SH "キーワード置換"
テキスト中に存在する
.BI $ keyword $
または
.BI $ keyword : .\|.\|. $
形式の文字列は、
.BI $ keyword : value $
形式の文字列に置換されます。
.I keyword
と
.I value 
の対については後述します。キーワードはリテラルな文字列として、あるいは
リビジョンを特定するためのコメントとして埋められることがあります。
.PP
まず、ユーザは
.BI $ keyword $
なる形式の文字列を入力します。
チェックアウト時に、
.B co
はこの文字列を
.BI $ keyword : value $
に置換します。
.BI $ keyword : value $
形式の文字列を含むものがチェックインされた場合、
.I value
の部分は次にチェックアウトされたときに新たな値に置換されます。
このように、チェックアウトを行うごとにキーワードの値は
更新されていきます。この自動更新は
.B \-k
オプションにより変更することができます。
.PP
キーワードの種類とその値:
.TP
.B $\&Author$
リビジョンを登録したユーザのログイン名。
.TP
.B $\&Date$
リビジョンが登録された日時。
.BI \-z zone
を指定した場合、数値によるタイムゾーンオフセットが追加されます;
指定しない場合は、日時は \*u です。
.TP
.B $\&Header$
標準的なヘッダ。\*r ファイルのフルパス名、リビジョン番号、日時、作者、
状態、ロック者(ロックされている場合)が含まれます。
.BI \-z zone
を指定した場合、数値によるタイムゾーンオフセットが追加されます;
指定しない場合は、日時は \*u です。
.TP
.B $\&Id$
.B $\&Header$
とほぼ同様です。\*r ファイル名はパスをつけずに埋め込まれます。
.TP
.B $\&Locker$
リビジョンをロックしたユーザのログイン名(ロックされていない場合は空です)。
.TP
.B $\&Log$
チェックイン時に与えたログメッセージ。その前に、\*r ファイル名、リビジョン
番号、作者、日時が埋め込まれます。
.BI \-z zone
を指定した場合、数値によるタイムゾーンオフセットが追加されます;
指定しない場合は、日時は \*u です。
すでに埋め込まれているログメッセージは変更
.I されません。
新たなログメッセージのみが
.BR $\&Log: .\|.\|. $
のあとに追加されます。
ソースファイルの完全なログを記録するときに便利です。
.RS
.LP
挿入される行の前には
.B $\&Log$
の行の前のプレフィックス文字列が付きます。例えば、
.B $\&Log$
の行が
.RB \*(lq "//\ $\&Log: tan.cc\ $" \*(rq
である場合、ログの各行の前の \*r プレフィックスは
.RB \*(lq "//\ " \*(rq
となります。
これはコメントが行末まで及ぶ言語にて便利です。
別の言語に対しては、複数行コメント内部にて
.RB \*(lq " \(** " \(rq
プレフィックスを使用するのが慣例です。
例えば、C プログラムの最初のログのコメントは慣例的に以下の形式です:
.RS
.LP
.nf
.ft 3
.ne 3
/\(**
.in +\w'/'u
\(** $\&Log$
\(**/
.in
.ft
.fi
.RE
.LP
古いバージョンの \*r とのバックワードコンパチビリティのため、
ログのプレフィックスが
.B /\(**
または
.B (\(**
でありオプションの空白で囲まれている場合、挿入されるログの行は
.B /
や
.B (
の代わりに空白が用いられます;
しかしこの使用方法は古くさく、この動作に依存してはなりません。
.RE
.TP
.B $\&Name$
存在する場合、リビジョンをチェックアウトするために使用したシンボリック名。
例えば
.B "co\ \-rJoe"
は
.B "$\&Name:\ Joe\ $"
を生成します。
単に
.B co
を指定した場合は、
.B "$\&Name:\ \ $"
となります。
.TP
.B $\&RCSfile$
パス名を含まない \*r ファイル名。
.TP
.B $\&Revision$
リビジョン番号。
.TP
.B $\&Source$
\*r ファイルのフルパス名。
.TP
.B $\&State$
リビジョンに
.BR rcs (1)
か
.BR ci (1)
の
.B \-s
オプションにより割り付けられた状態。
.PP
キーワード文字列の体裁を整えるために、
以下の文字をキーワード中に用いるには、
エスケープシーケンスを使用します。
.LP
.RS
.nf
.ne 6
.ta \w'newline  'u
\f2文字	エスケープシーケンス\fP
tab	\f3\et\fP
newline	\f3\en\fP
space	\f3\e040
$	\e044
\e	\e\e\fP
.fi
.RE
.SH "ファイルモード"
ワークファイルは、\*r ファイルの読み込みと実行の許可属性を受け継ぎます。
さらに、ユーザに対する書き込み権が設定されます。
.B \-kv
オプションが設定されている場合と、厳格ロックモード(
.BR rcs (1)
参照)にてロックせずに取り出した場合は、書き込み権が設定されません。
.PP
すでに、ワークファイルと同名の書き込み可能なファイルが存在していると、
.B co
は取り出しを中断し、もし可能ならば削除するかどうかを問い合わせます。
もし、すでに存在するファイルが書き込み禁止であったり、
.B -f
オプションが
指定されていた場合には、問い合わせを行わずに削除します。
.SH 関連ファイル
.B co
は
.B ci
とほぼ同じくらいのファイルにアクセスします。ただし、
.B $
が指定されていなければワークファイルを読むことはありません。
.SH 環境変数
.TP
.B \s-1RCSINIT\s0
本変数に空白で区切ったオプションを設定することで、
コマンドライン引数に先立って処理されます。
詳しくは
.BR ci (1)
を参照してください。
.SH 診断
\*r パス名、ワークファイルパス名、
取り出されるリビジョンの番号を診断出力します。
全ての処理が成功した場合のみ、終了ステータス 0 を返します。
.SH 作者
Author: Walter F. Tichy.
.br
Manual Page Revision: \*(Rv; Release Date: \*(Dt.
.br
Copyright \(co 1982, 1988, 1989 Walter F. Tichy.
.br
Copyright \(co 1990, 1991, 1992, 1993, 1994, 1995 Paul Eggert.
.SH 関連項目
rcsintro(1), ci(1), ctime(3), date(1), ident(1), make(1),
rcs(1), rcsclean(1), rcsdiff(1), rcsmerge(1), rlog(1),
rcsfile(5)
.br
Walter F. Tichy,
\*r\*-A System for Version Control,
.I "Software\*-Practice & Experience"
.BR 15 ,
7 (July 1985), 637-654.
.SH 制限事項
\*r ファイル、ワークファイルのリンクは保存されません。
.PP
キーワードを
.B "$\&keyword:$"
以外の形式に書換える以外に、一部のキーワードの
みを展開させる方法がありません。nroff や troff ではキーワード中にヌル文字
.B \e&
を埋め込むことにより展開を防ぐことができます。
.br

.\"-
.\" Copyright (c) 2000 Dag-Erling Coan Smgrav
.\" All rights reserved.
.\" Portions Copyright (c) 1999 Massachusetts Institute of Technology; used
.\" by permission.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer
.\"    in this position and unchanged.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. The name of the author may not be used to endorse or promote products
.\"    derived from this software without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
.\" INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
.\" NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
.\" DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
.\" THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
.\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
.\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\"
.\"      %FreeBSD: src/usr.bin/fetch/fetch.1,v 1.33.2.5 2000/12/08 15:13:33 ru Exp %
.\"
.\" jpman %Id: fetch.1,v 1.4 1997/08/15 06:31:28 horikawa Stab %
.Dd June 28, 2000
.Dd February 22, 1999
.Dt FETCH 1
.Os
.Sh 名称
.Nm fetch
.Nd URL (Uniform Resource Locator) 形式でのファイルの取得
.Sh 書式
.Nm
.Op Fl 146AFHMPRadlmnpqrsv
.Op Fl B Ar bytes
.Op Fl S Ar bytes
.Op Fl T Ar seconds
.Op Fl o Ar file
.Op Fl w Ar seconds
.Op Fl h Ar host
.Op Fl c Ar dir
.Op Fl f Ar file
.Op Ar URL ...
.Sh 解説
.Nm
は
.Xr fetch 3
ライブラリへのコマンド行インタフェースを提供します。
目的は、コマンド行の URL (複数可) に示されるファイル (複数可)
を取得することです。
.Pp
以下のオプションが使用可能です。
.Bl -tag -width Fl
.It Fl \&1
最初にファイルの取得に成功したときに、終了値 0 を返して停止します。
.It Fl 4
.Nm
が IPv4 アドレスのみを使用することを強制します。
.It Fl 6
.Nm
が IPv6 アドレスのみを使用することを強制します。
.It Fl A
``一時的な'' (302) リダイレクトを自動的には追跡しません。
要求したオブジェクトが存在しない場合に、
発見できないというエラーではなくリダイレクトを返すという、
壊れたウェブサイトが存在します。
.It Fl a
ソフト上での失敗の場合に自動的に転送を再試行します。
.It Fl B Ar bytes
読み込みバッファの大きさをバイト単位で指定します。
デフォルトは 4096 バイトです。
バッファの大きさを小さくしようとしても、黙って無視されます。
実際に実行された読み込み回数は、冗長レベル 2 以上で報告されます (
.Fl v
フラグを参照してください)。
.It Fl c Ar dir
遠隔ホストの
.Ar dir
ディレクトリのファイルを取得します。
本オプションは、価値が低下しており、後方互換性のためだけに提供されています。
.It Fl d
プロキシが設定されていても、直接接続します。
.It Fl F
.Fl r
フラグと組み合わせると、
ローカルファイルとリモートファイルの修正時刻が異なったとしても、
強制的に再開します。
.It Fl f Ar file
遠隔ホストの
.Ar file
という名前のファイルを取得します
本オプションは、価値が低下しており、後方互換性のためだけに提供されています。
.It Fl H
パッシブな FTP を使用しているとき、データ接続用に高位ポートを割り当てます。
どのポート範囲が対応するかの指定方法の詳細については、
.Xr ip 4
を参照してください。
.It Fl h Ar host
ホスト名が
.Ar host
にあるファイルを取得します。
本オプションは、価値が低下しており、後方互換性のためだけに提供されています。
.It Fl l
目標が、ファイル形式の URL の場合、目標を複製しようとするのではなく、
リンクを作成します。
.It Fl M
.It Fl m
ミラーモード: ローカルホストにファイルが既に存在し、サイズと
変更時間がリモートファイル同じである場合、転送は行われません。
.Fl m
と
.Fl r
のフラグは、あいいれないことに注意してください。
.It Fl n
転送されるファイルの変更時間を保存しません。
.It Fl o Ar file
出力ファイル名を
.Ar file 
にします。
デフォルトでは、``パス名'' が指定された URI から取り出され、その
ベースネームが出力ファイルの名前として使われます。
.Ar file
引数として 
.Sq Li \&-
を与えると、結果は標準出力に出力されます。
.It Fl P
.It Fl p
.Tn FTP
プロトコルをパッシブモードで使います。
これは、入力接続をブロックする防火壁 (firewall) の背後にいる場合に有用です。
FTP URL を取得するときに
.Nm
がハングするように見える場合に使用してみてください。
.It Fl q
沈黙モード。
.It Fl R
与えられたファイル名は大事にされ、どんな状況下でもファイル名は消去されません。
それは、転送が失敗もしくは不完全であった時でさえさえ、あてはまります。
.It Fl r
以前に中断された転送を再開します。
.Fl m
と
.Fl r
のフラグは、あいいれないことに注意してください。
.It Fl S Ar bytes
サーバが報告するファイルサイズが、指定値に合致することを要求します。
合致しない場合、メッセージが表示され、ファイルは取得されません。
サーバがファイルサイズの報告をサポートしていない場合、
本オプションは無視され、無条件にファイルが取得されます。
.It Fl s
各要求ファイルごとに、取得せずに、バイト数単位の大きさを表示します。
.It Fl T Ar second
タイムアウト時間を
.Ar second
秒に設定します。
FTP での転送に対しては
.Ev FTP_TIMEOUT
環境変数が、HTTP での転送に関しては
.Ev HTTP_TIMEOUT 
環境変数が、設定されていた場合は、それを上書きします。
.It Fl v
冗長レベルを増やします。
.It Fl w Ar seconds
.Fl a
が指定された場合、次のリトライの前に指定した秒数だけ待ちます。
.El
.Sh 診断
.Nm
コマンドは、成功時には 0 を返し、失敗時には 1 を返します。
コマンド行上に複数の URL を指定した場合、
.Nm
は、それぞれを順番に取得しようとし、
すべての取得に成功した場合のみに 0 を返します。
.Sh 環境変数
.Bl -tag -width FTP_PASSIVE_MODE -offset indent
.It Ev FTP_TIMEOUT
.Tn FTP
接続を中断するまでの最大時間を秒で指定します。
.It Ev HTTP_TIMEOUT
.Tn HTTP
接続を中断するまでの最大時間を秒で指定します。
.El
.Pp
.Xr fetch 3
ライブラリの文書に記述されている環境変数は、すべてサポートされています。
.Sh 関連項目
.Xr fetch 3
.Sh 歴史
.Nm
コマンドは
.Fx 2.1.5
から導入されました。
本実装が最初に登場したのは
.Fx 4.1
です。
.Sh 作者
.An -nosplit
.Nm
のオリジナル実装は
.An Jean-Marc Zucconi
が行いました。
.Fx 2.2
のために、拡張を行ったのは
.An Garrett Wollman
であり、後に
.Xr fetch 3
を使用するように
.An Dag-Erling Sm\(/orgrav .
が完全に書き直しました。
.Sh 注
The
.Fl b
および
.Fl t
のオプションは、すでにサポートされておらず、警告を表示します。
これらのオプションは、他の OS のバグの回避策であって、
本実装ではバグを引き起こしません。
.Pp
.Fl h ,
.Fl c ,
.Fl f
オプションの使用と、コマンド行上の URL 指定は、同時にはできません。

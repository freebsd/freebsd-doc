<!DOCTYPE HTML PUBLIC "-//FreeBSD//DTD HTML 4.01 Transitional-Based Extension//EN" [
<!ENTITY base CDATA "../..">
<!ENTITY date "$FreeBSD$">
<!ENTITY title "FreeBSD &java; Project: &jdk; 1.3">
<!ENTITY % navinclude.developers "INCLUDE">
<!-- $FreeBSD$ -->
<!-- The FreeBSD Japanese Documentation Project -->
<!-- Original revision: 1.17 -->
]>

<html>
    &header;
    <table border="0">
        <tr>
          <td>
	    <p><b>2003 年 12 月 19 日:</b> <a href="mailto:glewis@FreeBSD.org">Greg
	      Lewis</a> 氏が &jdk; 1.3.1 ソフトウェア向けの最新のパッチセット
	      (パッチレベル 9) と、それに対応した ports/java/jdk13 port
	      を公開しました。最新のパッチは、いつもどおり
	      <a href="http://www.eyesbeyond.com/freebsddom/java/jdk13.html">http://www.eyesbeyond.com/freebsddom/java/jdk13.html</a>
	      に置かれています。
	      <br>
	      このリリースにはたくさんの修正や改良が含まれていますので、
	      問題を報告する前に、まずアップグレードしてみるようにお願いします。</p>

	    <p><b>2003 年 2 月 12 日:</b> <a href="mailto:glewis@FreeBSD.org">Greg
	      Lewis</a> 氏が &jdk; 1.3.1 ソフトウェア向けの最新のパッチセット
	      (パッチレベル 8) と、それに対応した ports/java/jdk13 port
	      を公開しました。最新のパッチは、いつもどおり
	      <a href="http://www.eyesbeyond.com/freebsddom/java/jdk13.html">http://www.eyesbeyond.com/freebsddom/java/jdk13.html</a>
	      に置かれています。
	      <br>
	      このリリースは、Sun Microsystems の互換性テストに
	      はじめて合格したリリースです。
	      たくさんの修正や改良が含まれていますので、
	      問題を報告する前に、まずアップグレードしてみるようにお願いします。</p>

	    <p><b>2002 年 7 月 26 日:</b> <a href="mailto:glewis@FreeBSD.org">Greg
                Lewis</a> 氏が JDK 1.3.1 ソフトウェア向けの最新のパッチセット
              (パッチレベル 7) と、それに対応した ports/java/jdk13 port
              を公開しました。最新のパッチは、いつもどおり
              <a href="http://www.eyesbeyond.com/freebsddom/java/jdk13.html">http://www.eyesbeyond.com/freebsddom/java/jdk13.html</a> に置かれています。
              <br>
              このリリースにはたくさんの修正や改良が含まれていますので、
              問題を報告する前に、まずアップグレードしてみるようにお願いします。</p>

            <p><b>2002 年 2 月 13 日:</b> <a href="mailto:glewis@FreeBSD.org">Greg
                Lewis</a> 氏が JDK 1.3.1 ソフトウェア向けの最新のパッチセット
              (パッチレベル 6) と、それに対応した ports/java/jdk13 port
              を公開しました。最新のパッチは、いつもどおり
              <a href="http://www.eyesbeyond.com/freebsddom/java/jdk13.html">http://www.eyesbeyond.com/freebsddom/java/jdk13.html</a> に置かれています。
              <br>
              このリリースにはたくさんの修正や改良が含まれていますので、
              問題を報告する前に、まずアップグレードしてみるようにお願いします。</p>

            <p><b>2001 年 10 月 16 日:</b>
	      <a href="mailto:glewis@FreeBSD.org">Greg Lewis</a>
	      は JDK 1.3.1 向けパッチセット (パッチレベル 5) を更新し、
	      ports/java/jdk13 port を更新しました。
	      このパッチはいつも通り
	      <a href="http://www.eyesbeyond.com/freebsddom/java/jdk13.html">http://www.eyesbeyond.com/freebsddom/java/jdk13.html</a>
	      にあります。<br>
	      このリリースは多くのバグフィックスと改良を含んでいます。
	      問題を報告する前にアップグレードしてみてください。
	    </p>

	    <p>
	      <b>2001 年 9 月 10 日:</b>
	      <a href="mailto:glewis@FreeBSD.org">Greg Lewis</a>
	      は JDK 1.3.1 向けパッチセット (パッチレベル 5) を更新し、
	      ports/java/jdk13 port を更新しました。
	      このパッチはいつも通り
	      <a href="http://www.eyesbeyond.com/freebsddom/java/jdk13.html">http://www.eyesbeyond.com/freebsddom/java/jdk13.html</a>
	      にあります。<br>
	      このリリースは多くのバグフィックスと改良を含んでいます。
	      問題を報告する前にアップグレードしてみてください。
	    </p>

	    <p>
	      <b>2001 年 8 月 27 日:</b>
	      <a href="mailto:glewis@FreeBSD.org">Greg Lewis</a>
	      は待ち望まれていた JDK 1.3.1 ソフトウェアの移植版を
	      リリースしました。
	      ports/java/jdk13 port ディレクトリから構築できます。
	      以下の注意書きは同様に適用され、これはいまだに
	      <strong>開発者専用</strong> のリリースであり製品環境
	      としての利用は勧められないということに注意してください。
	    </p>

	    <p>
	      <b>2001 年 7 月 16 日:</b>
	      <a href="mailto:glewis@FreeBSD.org">Greg Lewis</a>
	      はネイティブな FreeBSD JDK&nbsp;1.3.1 を構築することに
	      興味を持つ開発者のためにパッチをリリースしました。
	      これは <strong>開発者専用</strong> のリリースであり、
	      うまく動作する JDK を構築することができません。
	      このパッチは、移植作業を手伝ってくれる人たちが一から
	      始めなくてもいいようにするためのリリースです。
	      パッチと構築方法は
	      <A HREF="http://www.eyesbeyond.com/freebsddom/java/jdk13.html">http://www.eyesbeyond.com/freebsddom/java/jdk13.html</a>
	      からダウンロードできます。</p>

            <P><B>2000 年 9 月 15 日:</B>
              <a href="mailto:gallatin@cs.duke.edu">Andrew Gallatin</a> 氏および
              <a href="mailto:sean@stat.Duke.EDU">Sean O'Connell</a>
              氏が IBM 社の JDK 1.3 に取り組んでいます。
              これを FreeBSD で動かすには FreeBSD のソースに、
              いくつかの修正パッチを適用する必要があります。
              修正パッチは、各バージョン向けに以下のところで提供されています。
              <br>
              <a href="http://www.cs.duke.edu/~gallatin/linux_sa_siginfo/4.0-release.diff">
                4.0-RELEASE</a>
              <br><a href="http://people.FreeBSD.org/~patrick/ibmjdk/linux.patch2">
                4.0-STABLE</a>
              <br><a href="http://www.cs.duke.edu/~gallatin/linux_sa_siginfo/diff">
                -CURRENT</a> (SMPng 導入前)

            <P>Drew 氏のメッセージより引用:<br>
<pre>
ついに IBM jdk 1.3 を動作させることができました。 まだ十分なテストを
行なっていませんが、AWT 関連はきちんと動いているようです。

SMPng が導入される前の -current に対応した、新しい修正パッチセットです。
この修正パッチセットは、以下のような変更を行ないます。

- MINSIGSTKSZ を 8192 から 2048 へ変更。
- linux_rt_sendsig() および linux_rt_sigreturn() を実装。
- linux_rt_sigreturn() 用にユーザランドの sigtramp コードを実装。
- linux_rt_sigreturn() での膨大なカットアンドペーストを避け、
  linux_sigaltstack にあったバグを修正するために
  linux_to_bsd_sigaltstack および bsd_to_linux_sigaltstack() を実装。
  これにより、Sun の 1.3 JDK で見られた "Java HotSpot(TM) Client VM warning:
  cannot uninstall alt signal stack" という不具合も修正されます。
- LINUX_MAP_GROWSDOWN mmaps 用の MAP_STACK フラグを MAP_ANON に変更。
  これは動作させるために必要な最後のステップでした。
  linux スレッドの自動成長スタック (autogrowing linux thread stack) は
  明らかに問題を抱えているのですが、VM グル (訳注: guru(導師、達人)級の
  人のこと) の方、これについて議論しませんか?  

修正パッチはこちら: http://www.cs.duke.edu/~gallatin/linux_sa_siginfo/diff

[*]この「問題」とは、メインプロセスのスタックにおいてスタック部分かどうかを
vm_map_growstack() を使った実験的な方法で判別しているという点です。
現在、わたしたちが用いている方法は以下のとおりです。

        is_procstack = addr >= (vm_offset_t)vm->vm_maxsaddr;

ここで vm->vm_maxsaddr は、exec_new_vmspace() から得られる値です。
        vmspace->vm_maxsaddr = (char *)USRSTACK - MAXSSIZ; 

IBM 社の JDK におけるメインスレッドは、まずスタックサイズを
rlim_cur=2040*1024 まで減らします。 そして、そのスレッド用のスタックを
p->p_rlimit[RLIMIT_STACK].rlim_cur で定義されるメインプロセスの
スタックの底より小さく、vm_maxsaddr より大きいアドレスに生成します。
スレッドがこの領域を大きくしなければならないようなアクセスを初めて
行なった時、動作がおかしくなってしまうのです。
</pre>

            <P>Sean 氏のメールからの引用: 
<pre>
わたしは  IBM Java SDK を動作させた Andrew Gallatin 氏の成果を
単純 (Quick&amp;Dirty) に MFC しました (訳注: Merge From Current;
一般的に、-CURRENT から -STABLE へのコードの取り込みを指します)。
appletviewer でデモプログラムのうちの一つを実行することができ、
それはきちんと動作しましたが、それ以上のことは良く分かりません。

修正パッチはすべて、/usr/src を起点としたもの (すべて sys にあるので、
/ と考えることもできます) になっています。

修正パッチの大部分は /sys/i386/linux にあるファイルに対するものです。
修正パッチを適用して /sys/modules/linux にカレントディレクトリを
変更し、make; kldunload linux; make install; kldload linux と順に
入力してください。

修正パッチには sys/sys/signal.h の MINSIGSTKSZ を 2048 にする修正も
含まれています。 これを有効にするには、カーネルの再構築が必要です。
</pre>

            <P><B>2000 年 7 月 18 日:</B>
              <a href="ernst@jollem.com">Ernst de Haan</a> 氏は
              Sun の Linux JDK 1.3.0b9 を 4.0-STABLE
              で動作させることに成功しました。
              .java_wrapper ファイルは
              <a href="http://people.FreeBSD.org/~patrick/sunjdk/java_wrapper">
                ここ</a>におかれています
              (これを .java_wrapper という名前に変更することを忘れないでください)。

            <P>Ernst 氏のメールより引用:
<pre>
もう一つだけヒント: jre/lib/jvm.cfg を変更して、先頭に最後の行を
入れてみてください。 そうすると、以下のようになるはずです。

   -classic
   -hotspot
   -server

ただし、Swing アプリケーションを実行すると必ず警告が表示されます。

   Warning: Cannot convert string "MetaCtrl&lt;Key&gt;Insert" to type VirtualBinding 

Ernst


Ernst de Haan wrote:
> Hi folkz、
> 
> Sun JDK 1.3.0 for Linux のベータ 9 を FreeBSD 4.0-STABLE システムで
> 動作させることができました。 きちんと動作しているみたいです。
>
> java -version は次のように表示されます。
>
>    bash-2.04$ java -version
>    expr: syntax error
>    java version "1.3.0beta_refresh"
>    Java(TM) 2 Runtime Environment, Standard Edition (build 1.3.0beta_refresh-b09)
>    Classic VM (build 1.3.0beta_refresh-b09, green threads, nojit)
> 
> 最初の行は、.java_wrapper の文法エラーのために表示されているもので、
> 深刻なものではありません。 わたしは JDK を動作させるために .java_wrapper に
> いくつか手を加える必要がありました。 今使っているものを添付しておきます。
> 
> まだ十分にテストしていないのですが、Swing アプリケーションを一つ
> 試してみました。フォントがちょっと違っていたことを除けば、ほぼすべてが
> きちんと高速に動作しているみたいです :)
>
> うん、FreeBSD はすぐにものすごい数の JDK が動くプラットフォームに
> なるでしょうね。 WINE が動くようになれば、Windows の JDK だって
> 動くでしょうし、あとは AS/400 エミュレータを書いて、それから.... ;-)
> 
> 
> Ernst
> 
> P.S。 わたしを正しい方向に導いてくれた Victor Salaman 氏に感謝します。
>       彼は本当に長い間、Sun JDK 1.3 for Linux を使っていました。
</pre>

            <P><B>2000 年 1 月 29 日:</B> JDK 1.3 の移植は始まっていません。
              JDK 1.2 がリリースされた後になるまで JDK 1.3 の作業は始められません。</p>
          </td>
        </tr>
    </TABLE>
      &footer;
  </BODY>
</HTML>

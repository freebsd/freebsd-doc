<!--
     The Chinese FreeBSD Documentation Project 
     $FreeBSD$
     Original revision: 1.53
-->

<chapter id="devel">
  <title>中文程式設計</title>
    <para>
      以下是一些軟體在中文支援方面，利用程式的判斷。</para>
    <para>
      原則上如果是用 gtk 寫的軟體，裡面有呼叫到 gtk_set_locale()
      這個函式的話應該都沒問題。</para>
    <para>
      如果是其他的 X 軟體可能要找一下 source 裡面有沒有 
      setlocale(LC_CTYPE, NULL);
      及 XIM 相關函式呼叫情形。如果有遵照正統做法，
      <application>xcin2.5</application> 應該都可以跟它搭配良好。</para>
    <para>
      Qt 沒碰過，所以不知道他怎麼運作。不過猜想 XIM 這段應該跟
      gtk 大同小異。</para>
    <para>
      用 xforms 寫的軟體應該會有問題。</para>
    <para>
      用 X11R6.4 版以後的 Xt/Xaw 寫的軟體應該是沒問題，
      記得在 .Xdefaults 裡頭加入 <option>*international:true</option>
      、<option>*fontSet:-*-iso8859-1,-*-16-*-big5-0</option>
      等等。</para>
    <para>用 fltk 寫的軟體似乎也沒支援 XIM。</para>

  <sect1 id="freebsd-prog">
    <title>在 FreeBSD 下寫程式應該注意的問題</title>
      <para>
        在FreeBSD下寫程式，結果發現一個中文的問題，
	例如字串中包含這"許"這個字，因為許字的下半碼是
	ascii中的\符號，結果就會造成錯誤，請問這種情形
	應該如何解決？又還有沒有其他的碼有這種問題？</para>
      <para>在程式中該字前加一個 '\'，還有很多有這個問題呢，如下：</para>
      <programlisting>
5C  +0 +1 +2 +3 +4 +5 +6 +7 +8 +9 +A +B +C +D +E +F
A0     ﹏ 兝 α 么 功 吒 吭 沔 坼 歿 俞 枯 苒 娉 珮
B0  豹 崤 淚 許 廄 琵 跚 愧 稞 鈾 暝 蓋 墦 穀 閱 璞
C0  餐 縷 擺 黠 孀 髏 躡 ツ \ 尐 佢 汻 岤 狖 垥 柦
D0  胐 娖 涂 罡 偅 惝 牾 莍 傜 揊 焮 茻 鄃 幋 滜 綅
E0  赨 塿 槙 箤 踊 嫹 潿 蔌 醆 嬞 獦 螏 餤 燡 螰 駹
F0  礒 鎪 瀙 酀 瀵 騱 酅 贕 鱋 鱭 </programlisting>
      <para> '\' 的 ASCII code 是 \0x5c，從 [\0xa1-\0xf9][\0x5c] 
        都會有這個問題。</para>
      <programlisting>
#!/usr/bin/perl
#
# create code table (Big5) [\0xa1-0xf9][\0x40-\0x7e\0xa1-\0xfe]
#

# 繁體中文 (Big5) 文字內碼表的產生
open (OUT, "&gt; big55c.txt"); select OUT;

# 文字內碼表的產生
# 開頭的表示
print "\n5C  ";
print "+0 +1 +2 +3 +4 +5 +6 +7 +8 +9 +A +B +C +D +E +F\n";
$c = 1; # 1行文字數(16文字)
$head = "";
$line = "";
for ($c1 = 0xA0; $c1 i&lt;= 0xF9; $c1++) { # $c1 是第一個位元 [\0xa1-\0xf9]
    $c2=0x5c;
    # 開頭第一個字
    if ("$head" eq "") {
        $head = sprintf ("%02X ", $c1);
    }

    $line .= " "; # 文字間的空白
    if ($c1 == 0xA0) {
        $line .= "  ";
    } else {
        $line .= pack("CC", $c1, $c2);
    }

    if ($c == 16 || $c1 ==0xf9) { # 16文字表示一行
        print "$head$line\n";
        $head = "";
        $line = "";
        $c = 1;
    } else {
        $c++;
    }
}
close(OUT);

exit;</programlisting>
  </sect1>

  <sect1 id="jsp-servlet">
    <title>JSP / Servlet 怎樣才能處理中文？</title>
      <para>
        鄭原真 &a.ycheng; Copyright 2000.</para>
      <para>
        本文版權 : GPL or BSD style，請保留作者姓名。</para>
      <para>
        本文假設您已經會使用 JSP 或是 Servlet 撰寫英文的 Web-Page。
        如果您還不會，或是根本不知道 JSP 或是 Servlet 是幹什麼的，
        那這篇文章不是寫給您看的。</para>
      <para>
        在 Java Servlet Spec v2.0 中，對於多國語言的支援，並不足。
        您必須找到 Java Servlet Spec v2.2 的實作才行，筆者試過的
        是 Apache Jakarta Tomcat 3.1 軟體(註一）。</para>
      <para>
        本文測試平台是 Debian Woody, Sun jdk1.2.2, Tomcat 3.1,
        mm.mysql-2.0.2</para>
      <para>Java Server 如何處理中文。</para>
      <para>前言</para>
      <para>
        首先，如何正確的了解您一個 Big5 中文在 Java 中是正確的
        中文 Unicode 呢？</para>
      <para>
        輸出一個 String("今").length() 吧 ! 由於 "今" 在 Big5 是由兩個
        byte 組成，但對 java 來說，java 的字元是 unicode，也就是說，
        無論是一個英文字或是一個中文字，其 length() 都是 1. 也就是說，
        (new String("今")).length() ==&gt; 1。才是正確的。</para>
      <para>Servlet 輸出中文的一個例子。</para>
      <para>下面是一個典型的 Java Servlet。</para>
      <programlisting>
HelloWorldExample.java =&gt;
----------- cut here -----------------
import java.io.*;
import java.text.*;
import java.util.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class HelloWorldExample extends HttpServlet {

    public void doGet(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
        response.setLocale(new Locale(new String("zh"), new String("TW")));
        response.setContentType("text/html");
        PrintWriter out = response.getWriter();

        out.println("&lt;html&gt;");
        out.println("&lt;head&gt;");

        String title = new String("hello 大家好");

        out.println("&lt;title&gt;" + title + "&lt;/title&gt;");
        out.println("&lt;/head&gt;");
        out.println("&lt;body bgcolor=\"white\"&gt;");
        out.println("&lt;body&gt;");

        out.println("&lt;p&gt;");

        out.println("&lt;h1&gt;" + title + "&lt;/h1&gt;");
        out.println("&lt;/body&gt;");
        out.println("&lt;/html&gt;");
    }
}
----------- cut here -----------------</programlisting>
      <para>可以正常輸出中文的關鍵是：</para>
      <programlisting>
        response.setLocale(new Locale(new String("zh"), new String("TW")));</programlisting>
      <para>注意這一行應該要放在</para>
      <programlisting>
        PrintWriter out = response.getWriter();</programlisting>
      <para>之前執行。另外編譯時注意</para>
      <programlisting>
        javac -encoding Big5 HelloWorldExample.java</programlisting>
      <para>或是 (linux 上的 jdk1.2.2)</para>
      <programlisting>
        export LANG=zh_TW.Big5
        export LC_CTYPE=zh_TW.Big5
        javac HelloWorldExample.java</programlisting>
      <para>
        注意，這個例子在 jserv v1.1.2 並不能 work，因為該版本實做的
        JavaSoft Java Servlet APIs 2.0, 而 setLocale 是到
        Servlet APIs 2.2 才有。</para>
      <para>Java Server Page 如何處理中文</para>
      <para>在此簡略說明，先看下面的例子：</para>
      <programlisting>
test.jsp
----------------------
&lt;%@ page contentType="text/html; charset=big5" %&gt;
&lt;html&gt;
&lt;body bgcolor="white"&gt;
    中文TEST.&lt;p&gt;
    &lt;%= (new String("今天")).length() %&gt;
    out.println("大家好");
&lt;/body&gt;
&lt;/html&gt;
----------------------</programlisting>
      <para>關鍵在第一行。有了這一行就行了。</para>
      <para>而如果使用 POST 時，要使用中文就先看下面的例子</para>
      <programlisting>
test2.jsp
----------------------
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Instropection&lt;/title&gt;
&lt;/head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=big5"&gt;
&lt;body&gt;
&lt;body bgcolor="#FFFFFF" text="#000000"&gt;
&lt;form name="form1" action="test3.jsp" method="post"  &gt;
  &lt;p&gt; 姓名：
    &lt;input type="text" name="name"&gt;
  &lt;/p&gt;
  &lt;p&gt;編號：
    &lt;input type="text" name="number"&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;input type="submit" value="傳送"&gt;
    &lt;input type="reset" value="清除"&gt;
  &lt;/p&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
----------------------

test3.jsp
----------------------
&lt;%@ page language="java" contentType="text/html;charset=Big5" %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Instropection&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;%
    String name = new String(request.getParameter("name").getBytes("ISO-8859-1"), "Big5");
    String number = request.getParameter("number");
%&gt;
姓名：&lt;%= name %&gt;
&lt;br&gt;編號：&lt;%= number %&gt;
&lt;/body&gt;
&lt;/html&gt;
----------------------</programlisting>
      <para>
        關鍵在於 String(str.getBytes("ISO-8859-1"), "Big5")，
        java.lang.String 的建構函式可以產生指定特定語系的 String，
        透過這個範例，可以使 String 正確地轉換中文。</para>
      <para>For Hacker：</para>
      <para>
        理論上這一行可以放在文件的任何地方，但由於 Java 時做上
        開檔案後通常就必須指定 encoding，當 java jsp engine 發現 
        charset 跟 default 不同時，通常必須重新開檔案。所以實做上
        這一行放在越前面越好。不過話是這樣說，由於通常 jsp 會在 
        run time 被 compile 成 java bytecode，也就是說只有在 
        .jsp 更新時才需要 recompile。overhead 實在有限。</para>
      <para>
        註一：請到 http://jakarta.apache.org/ 下去 Download。</para>
  </sect1>

  <sect1 id="java-mysql">
    <title>Java 連結到 MySql 如何使用中文？</title>
      <para>鄭原真 &a.ycheng; Copyright 2000.</para>
      <para>本文版權 : GPL or BSD style，請保留作者姓名。</para>
      <para>
        本文假設您已經會使用 JSP 或是 Servlet 撰寫英文的 Web-Page。
        如果您還不會，或是根本不知道 JSP 或是 Servlet 是幹什麼的，
        那這篇文章不是寫給您看的。</para>
      <para>
        在 Java Servlet Spec v2.0 中，對於多國語言的支援，並不足。
        您必須找到 Java Servlet Spec v2.2 的實作才行，筆者試過的
        是 Apache Jakarta Tomcat 3.1 軟體(註一）。</para>
      <para>
        本文測試平台是 Debian Woody, Sun jdk1.2.2, Tomcat 3.1,
        mm.mysql-2.0.2</para>
      <para>
        Java 以 jdbc 連結到 databases server，MySql 有 Free 的
        jdbc driver。以下不擬說明如何使用 jdbc，僅說明如何修改
        您的 code 使可以用中文。</para>
      <para>
        mysql 儲存中文資料有兩種方法，第一種是使用 big5 內碼儲存，
        其優點是節省硬碟/記憶體空間，相較於使用 UTF8 之下，若輸出
        為 Big5，更省去一次的 Unicode (UTF8) 與 Big5 需要經過
        Table lookup 的轉換。但使用 Big5 就會有 Big5 先天上的問題。
        典型的問題是 Big5 字串在處理字的邊界的問題。Big5 先天上的
        問題是這樣的，就以 "問題" 這個字串為例，問字的第二個 byte
        跟題字的第一個 byte 所形成的字是 "暋" 字。所以當我們在作
        文字搜尋找包含 "暋" 的字串，我們會連包含 "問題" 的字串也
        一起找到。但 UTF8 內碼在設計上就避開了這個問題, 犧牲的是
        必須用較多的 byte (octets) 表示。</para>
      <para>
        我只有試過 MySql 內的 Data 用 UTF8，Big5 沒試過。要注意的
        是，在 UTF8 中，中文的長度是 3 個 bytes，由於 MySQL 固定
        字串欄位送進過長的資料時，會發生過長處被截斷。但 MySql 不懂
        UTF8，所以可能發生一個 UTF8 字元第二 or 三個 byte 被截掉
        問題，在 ASCII 中問題不大，頂多出現一個 "I Love Yo"，"u" 不
        見了。但在 java 把資料讀進來，把 UTF8 轉成 java 內部的表示
        法時，就會發生有些 Byte 無法轉成功的問題，應該會造成
        Exception。(註二)</para>
      <para>
        好，回來，在 jdbc 中，並沒有規範在 Database 中的字元的內碼，
        而把這個問題留給各個 jdbc driver 處理。mysql jdbc driver
        要在 database 中設為 utf8 的設定方式如下：</para>
      <programlisting>
        Properties pr;
        Connection db;

        pr = new Properties();
        pr.put("characterEncoding", "UTF8");
        pr.put("useUnicode", "TRUE");
        Class.forName("org.gjt.mm.mysql.Driver").newInstance();
        db = DriverManager.getConnection("jdbc:mysql:///test", pr);</programlisting>
      <para>
        其餘請自行參考一般 jdbc 程式寫作的資料。當然, compile 此 
        Servlet 時需要在呼叫 javac 時加上 "-encoding Big5"。</para>
      <para>
        若要使用 Big5 的話, 上面 "UTF8" 改成 "Big5" 即可。但這樣作會
        出現另一個問題, 就是中文第二個 byte 有 '\' 的問題。這個問題我
        不知道有沒有方便的解法，不知道 compile mysql 時將 encoding 設
        為 big5 可否解決這個問題。(註二)</para>
      <para>
        註二：這個我沒有測試過，誰要測了跟大家說結果的？</para>
  </sect1>

  <sect1 id="linux-gtk">
    <title>linux-gtk - gtk-1.2.6 的函式庫 rpm，有 Big5/GB 的支援</title>
      <para>
        以下是比 x11-toolkits/linux-gtk 更好的 I18N 的優點。</para>
      <programlisting>
  Better word wrapping for CJK strings
  Specify default font's encoding explicitly
  Better XLFD handling
  Selection resync fixes
  Numerous gtkrc.$locale samples
  Other minor fixes</programlisting>
      <para>安裝 <filename role="package">chinese/linux-gtk</filename>。</para>
      <para>
      唯一的缺點是這個套件是 CLE 用來給 i386 平台所使用的，
      所以如果是 alpha 的使用者的話仍需使用 x11-toolkits/linux-gtk。</para>
  </sect1>

  <sect1 id="php-ImageTTFText">
    <title>php 的 ImageTTFText() 經常抓錯字？</title>
    <para>Contributed by &a.jerry;</para>
    <para>Last Update: 2003年 4月29日 周二 19時43分15秒 CST</para>
    <para>在安裝 <filename role="package">www/mod_php4</filename> 
    時必須選擇 GD library support 及 freetype 的套件才能進行下面的步驟。</para>
    <para>目前常見的有三種做法，一種是 patch gdttf.c，
      一種是使用 iconv support 來將編碼轉成 UCS-2 ，
      還有一種就是直接使用 <filename role="package">chinese/hc</filename>
      的資料庫。</para>
    <para>這邊是第一種做法，patch gdttf.c 讓 PHP 不會抓錯字。</para>
    <programlisting>
--- gdttf.c.orig	Mon Oct 16 21:55:47 2000
+++ gdttf.c	Sun Dec 31 18:00:34 2000
@@ -654,7 +654,7 @@
 	TT_BBox **bbox, 
 	char **next)
 {
-    int pc, ch, len;
+    int pc, ch, len, ch2;
 	int row, col;
 	int x2, y2;     /* char start pos in pixels */ 
 	int x3, y3;     /* current pixel pos */
@@ -687,6 +687,8 @@
 		(*next)++;
 		if (ch &gt;= 161                /* first code of JIS-8 pair */
 			&& **next) {                /* don't advance past '\0' */
+			ch2 = (**next) & 255;
+			if(ch2 &gt;= 161) ch++; /* Big5 ttf patch */
 			ch = (ch * 256) + **next;
 			(*next)++;
 		}</programlisting>
    <para>由於已經處理過 gdttf.c，在這邊就可以直接使用中文編碼的字。</para>
    <programlisting>
&lt;?php
    Header ("Content-type: image/gif");
    $im = imagecreate (400, 30);
    $black = ImageColorAllocate ($im, 0, 0, 0);
    $white = ImageColorAllocate ($im, 255, 255, 255);
    ImageTTFText ($im, 20, 0, 10, 20, $white,
      "/usr/X11R6/lib/X11/fonts/TrueType/moe_kai.ttf", "這是中文測試 許功蓋 "); 
    ImagePng ($im); 
    ImageDestroy ($im);
?&gt;</programlisting>
    <para>
      第二種是使用 unicode 讓中文正常的顯示，
      以下就是 big5 轉 unicode 的做法，
      在這邊提供一個小函式來自動判斷為英文還是中文，
      英文的部分不需要轉碼，只有中文才需要。</para>
    <programlisting>
&lt;?php
  /*  need iconv module */
  function big52uni($text) {
    $rtext="";
    $max=strlen($text);
    for($i=0;$i&lt;$max;$i++){
      $h=ord($text[$i]);
      if($h>=160 && $i&lt;$max-1){
        $rtext.="&#".base_convert(bin2hex(iconv("big5","ucs-2",
          substr($text,$i,2))),16,10).";";
        $i++;
      }else{
        $rtext.=$text[$i];
      }
    }
    return $rtext;
  }
?&gt;</programlisting>
    <para>用法的範例如下，在 ImageTTFText 必須指定系統上的字型，
      以下是安裝 <filename role="package">chinese/arphicttf</filename>
      來使用文鼎PL上海宋，所以必須根據自己的安裝的字型作修改，
      然後搭配上面的 big52uni 這個函式：</para>
    <programlisting>
&lt;?php
Header("Content-type: image/gif");
$im = imagecreate(400,30);
$black = ImageColorAllocate($im, 0,0,0);
$white = ImageColorAllocate($im, 255,255,255);
ImageTTFText($im, 20, 0, 10, 20, $white, 
  "/usr/local/share/fonts/TrueType/bsmi00lp.ttf", 
  big52uni("Test中文測試"));
ImageGif($im);
ImageDestroy($im);
?&gt;</programlisting>
      <figure>
        <title>php-imagettftext snapshot</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/php-imagettftext" format="PNG">
          </imageobject>
        </mediaobject>
      </figure>
    <para>
      WWW: <ulink url="http://www.php.net/">
      http://www.php.net/</ulink></para>
  </sect1>

  <sect1 id="php-upload">
    <title>php 上傳中文檔名的檔案</title>
      <para>by Wiseguy.bbs@bbs.nsysu.edu.tw</para>
      <para>
        另開一個 &lt;input type="hidden" name="filename"&gt;
	在 submit 前，把 file 裡的檔名取出來 (用 split('\\')，陣列最後一個。)
	放到 filename 去，這樣就可知道原檔名是什麼，而不用 file 裡面處理的檔名。
	這種作法可以使中文檔名、含空白、管道字元 | 、反斜線，通通可上傳。</para>
      <programlisting>
&lt;?php
if($_FILES['userfile']['name']) {
  echo $_POST['fname'];
} else {
?&gt;
&lt;script language="JavaScript"&gt;
function validate() {
  var Ary = document.uploadf.userfile.value.split('\\');
  document.uploadf.fname.value=Ary[Ary.length-1];
  return true;
}
&lt;/script&gt;
&lt;form enctype="multipart/form-data" action="index.php" method="post"
 name="uploadf" onsubmit="return validate()"&gt;
  Send this file: &lt;input name="userfile" type="file"&gt;
  &lt;input type="hidden" name="fname"&gt;
  &lt;input type="submit" value="Send File"&gt;
&lt;/form&gt;
&lt;?php } ?&gt;
</programlisting>
      <para>
        WWW: <ulink url="http://www.php.net/manual/en/features.file-upload.php">
	http://www.php.net/manual/en/features.file-upload.php</ulink></para>
  </sect1>

  <sect1 id="php-pdf">
    <title>用 php 製作中文 PDF 檔</title>
      <para>Contributed by Tim (tim@dnes.mlc.edu.tw)</para>
      <para>Last Update: 2003年 4月20日 周日 15時59分41秒 CST</para>
      <para>php 目前可以使用 PDFlib 來建立不內嵌字型的 PDF 檔，
	
        在 pdf_findfont 的部分要給對字型就可以了。</para>
      <programlisting>
$font = pdf_findfont($pdf, 'MSung-Light', 'ETen-B5-H', 0); </programlisting>
      <para>以下是完整範例，記得要先在該目錄底下建立 hello.pdf 
        並且將權限改成 666。</para>
      <programlisting>
&lt;?php
  echo '&lt;meta http-equiv="Content-Type" content="text/html; charset=big5"&gt;';
  //create file
  $fp = fopen('hello.pdf', 'w');
  if(!$fp)
  {
    echo "Error: could not create the PDF file";
    exit;
  }

  // start the pdf document
  $pdf = pdf_open($fp);
  pdf_set_info($pdf, "Creator", "pdftest.php");
  pdf_set_info($pdf, "Author", "Shen Chun-Hsing");
  pdf_set_info($pdf, "Title", "Hello World (PHP)");

  // US letter is 11" x 8.5" and there are approximately 72 points per inch
  pdf_begin_page($pdf, 8.5*72, 11*72/2);
  pdf_add_outline($pdf, 'Page 1');

  // 取得字型
  $Efont = pdf_findfont($pdf, 'Times-Roman', 'host', 0);
  $Cfont = pdf_findfont($pdf, 'MSung-Light', 'ETen-B5-H', 0);

  // write text
  pdf_setfont($pdf, $Efont, 24);
  pdf_set_text_pos($pdf, 50, 700/2);
  pdf_show($pdf,'Hello world!');
  pdf_continue_text($pdf,'(says PHP)');
  pdf_setfont($pdf, $Cfont, 24);
  pdf_continue_text($pdf,'細明體中文字測試');

  // end the document
  pdf_end_page($pdf);
  pdf_close($pdf);
  fclose($fp);

  // display a link to download
  echo "&lt;a href = 'hello.pdf' target='_blank'&gt;測試檔PDF&lt;/a&gt;";
  echo "&lt;hr&gt;";
  show_source( basename( getenv("SCRIPT_FILENAME") ) );
?&gt;</programlisting>

      <para>在 pdf_findfont 的部分選擇 ('MSung-Light', 'ETen-B5-H') 
        這樣子的 CID-Keyed font 就可以使用明體了，
        第一個欄位還可以換成 MHei-Medium 來使用楷體，
	不過在目前的支援度下，所能看到的不管設定明體或是楷體，
	都只會有明體而以，
	這必須是 PDF 瀏覽器支援設定的字體有其相對應的字體才行，
        而第二個欄位 CMap 基本上建議使用 ETen-B5-H 才能使用倚天外字。</para>
      <para>可以用的英文字型如下：
Courier Courier-Bold Courier-Oblique Courier-BoldOblique Helvetica 
Helvetica-Bold Helvetica-Oblique Helvetica-BoldOblique Symbol 
Times-Roman Times-Bold Times-Italic Times-BoldItalic ZapfDingbats。</para>
      <para>可以用的中文 CMap 如下：
B5pc-H B5pc-V HKscs-B5-H HKscs-B5-V ETen-B5-H ETen-B5-V ETenms-B5-H
ETenms-B5-V CNS-EUC-H CNS-EUC-V UniCNS-UCS2-H UniCNS-UCS2-V。</para> 
      <figure>
        <title>php-pdf snapshot</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/php-pdf" format="PNG">
          </imageobject>
        </mediaobject>
      </figure>
      <para>而 pdf_add_bookmark 有人說有中文的問題，可是在筆者的測試之下，
      Big5 編碼的 bookmark 在 Acroread 5 可以正常看到，或是利用
      iconv 轉成 UTF-16 也是正常的，所以如果您看到的 bookmark 有中文問題，
      可以利用 iconv("Big5", "UTF-16", "中文字") 來試試看。</para>
      <para>WWW: <ulink url="http://www.PDFlib.com/">
	http://www.PDFlib.com/</ulink></para>
  </sect1>

  <sect1 id="tcltk">
    <title>Tcl/Tk - 廣為運用的一種高階電腦語言與 GUI 發展工具</title>
      <para>
        tcl 是一個高階的電腦語言，語法類似 shell script 與 C 語言之間。而
        tk 是一個使用者界面發展工具，有 buttons、menus、listboxes、
        scrollbars 等等。</para>
      <para>
        把這兩者結合起來，就形成了強有力的 GUI 發展套件。最新版本的 
        tcl/tk 支援了多平台的開發程式庫。所以我們可以寫一個 tcl/tk
        的程式（也稱為script），然後在 UNIX 下看起來就像是 Motif
        的應用程式；在 Windows9x/NT 下看起來像是 Win32 的應用程式；而在
        Macintosh 下看起來像 Mac 的應用程式。</para>
      <para>
        tcl/tk 的優點第一是 free（自由）。
        第二是容易學習，您不須具備 object-oriented 或 threads 或 
        Microsoft Fundation Classes 的基礎，也不須寫一大串的程式碼。
        像是傳統的 Hello, World! 程式，在 tcl/tk 只要兩行就搞定，</para>
      <programlisting>
button .b -text "Hello, World!" -command exit
pack .b</programlisting>
      <para>
        第三是有許多的 extensions（延伸套件）可以支援其他軟體程式庫，
        例如 Oracle, Sybase, Informix, OpenGL 等多達 400 種。</para>
      <para>安裝 <filename role="package">chinese/tcl83</filename> 與
        <filename role="package">chinese/tk83</filename>。</para>
      <para>
        chinese/tcl83 和 chinese/tk83 主要是補上一個
	<option>--enable-i18nImprove</option> 的選項，
	修正 XIM 處理有問題的部份。</para>
      <para>中文顯示都正常，中文輸入也是正常的。</para>
      <programlisting>
#!/usr/local/bin/wish8.3
tk useinputmethods 1
font create bsmilpfont -family "ar pl mingti2l big5" -size 16
label .a -text "標籤" -font bsmilpfont
pack .a
button .b -text "按鈕" -command { puts stdout $cc; exit } -font bsmilpfont
pack .b
entry .c -textvariable cc -font bsmilpfont
pack .c</programlisting>
      <figure>
        <title>tcltk snapshot</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/tcltk" format="PNG">
          </imageobject>
        </mediaobject>
      </figure>
      <para> WWW: <ulink url="http://www.scriptics.com/software/tcltk/8.3.html">
        http://www.scriptics.com/software/tcltk/8.3.html</ulink></para>
  </sect1>

  <sect1 id="postgre">
    <title>PostgreSQL 不能處理中文？</title>
      <para>
        <application>PostgreSQL</application> 中使用中文一向有小問題，
        如 '許'、'社' 等等後面是 \ 的中文字都會出搥，直到
        6.5 版以後，才加入了 multibyte 的支援。</para>
      <para>
        <application>PostgreSQL</application> 的語言支援分
        前/後端(frontend/backend)，無論前端使用何種語言，
        後端都會使用設定好的語言存入資料庫中。</para>
      <para>
        這有什麼好處？例如：後端設定成繁體中文，前端設定成簡體中文，
        然後，存入的繁體中文，顯示的是簡體中文，當然，
        它不會做中、英翻譯。</para>
      <para>
        要正確使用中文，比較保險的作法是後端使用 euc_tw
        編碼，前端使用 big5 編碼，例如：</para>
      <screen>
<prompt>%</prompt> <userinput>createdb --encoding euc_tw test</userinput>  ' 建>
立後端為 euc_tw 編碼的 db
<prompt>%</prompt> <userinput>psql test</userinput>  ' 使用 psql 管理工具，就像
mysql 般。
<prompt>test=#</prompt>  ' 已經進入 psql
<prompt>test=#</prompt> <userinput>\encoding big5</userinput>  ' 設定前端為 big5 編碼
<prompt>test=#</prompt> <userinput>create table test (</userinput>
<prompt>test=#</prompt> <userinput>usrname char(20));</userinput>  ' 建立 table
<prompt>test=#</prompt> <userinput>insert into test values('許國榮');</userinput>  ' 測試
<prompt>test=#</prompt> <userinput>select * from test;</userinput>  '您會看到正>
確的答案
<prompt>test=#</prompt> <userinput>\q</userinput></screen>
      <para>
        也可以在 <application>PostgreSQL</application> 中下
        <command>PGCLIENTENCODING=BIG5</command>
        的指令，如果是使用 <application>PHP</application>
        + <application>PostgreSQL</application> 則使用以下方式：</para>
      <programlisting>
 $conn = pg_connect("user=postgres dbname=stip");
 pg_exec($conn, "set client_encoding to 'BIG5'");</programlisting>
      <para>
        WWW: <ulink url="http://www.postgresql.org/">
        http://www.postgresql.org/</ulink></para>
  </sect1>

  <sect1 id="postgresql-jdbc">
    <title>PostgreSQL + JDBC + Servlet + XMLC 中文完全解決方案</title>
      <para>作者：smallufo，Email：smallufo@bigfoot.com</para>
      <para>
	自古以來 Servlet 連結 Database 在中文方面總是有許多問題，尤其是在
	web 端，要考慮的因素更多了。有時候，form的文字遇到「許，功」等字，
	要使用者自行輸入“\”這個跳說字元；有時候明明把「許，功」insert
	進資料庫，但是取出來又會變成〈？〉；而中文的許多次常用字，
	例如宏眭滿u痋v，等怪怪的字元，更是讓 
	programmer 頭髮白了一半。而 encoding 又是個最重要的關鍵，常見的 
	encoding 有以下幾點：</para>
      <programlisting>
code  +0 +1 +2 +3 +4 +5 +6 +7 +8 +9 +A +B +C +D +E +F
F9D0                              
F9E0                 
F9F0            ╭ ╮ ╰ ╯   </programlisting> 
      <itemizedlist>
	<listitem><para>
	  作業系統 Locale 的 encoding
	</para></listitem>
	<listitem><para>
	  資料庫端的 encoding
	</para></listitem>
	<listitem><para>
	  javac-encoding xxx
	</para></listitem>
	<listitem><para>
	  ServletRequest.setContentType("texe/html; charset=xxx)
	</para></listitem>
	<listitem><para>
	  web application deployment(web.xml) 所指定的 character-encoding="xxx"
	</para></listitem>
	<listitem><para>
	  new String(String.getByte("xxx),"yyy)
	</para></listitem>
	<listitem><para>
	  如果使用 xmlc，還有 xmlc 的 encoding 以及
	  org.enhydra.xml.io.OutputOptions.setXmlEncoding("xxx")
	</para></listitem>
      </itemizedlist>
      <para>
	這幾種 encoding 萬馬奔騰，常使 programmer 轉的暈頭轉向，
	不知目前身在何處，不知多少 programmer 在此浪費青春。</para>
      <para>
	中文解決方案以前在網路上有許多做法，但是通常都不太完整，
	要不然就得大刀闊斧更動到 JDBC driver，或是重新 compile
	整個資料庫系統。而為了系統的「完整性」，我並不考慮這些做法。
	我的作法可以完整保留 postgreSQL 的完整性〈以 RPM 安裝，不用重新
	compile〉，而且 JDBC driver 不用重新 compile。
	以下的步驟後半部主要是針對 XMLC 而言，不過一般「純」的 servlet 
	程式，應該很容易粹取出來。</para>
      <para>以下是我的一些環境：</para>
      <para>
	RedHat Linux 7.0 (CLE 1.0)，其他的中文環境也應該沒問題。
	如果您是英文版的，請安裝 Chinese locale patch 即可。
	重點是，當您輸入 'set' 時，可以看到 'LANG=zh_TW' 這個環境變數。</para>
      <para>Servlet Engine：Resin 2.0.2</para>
      <para>posrgreSQL-7.1.3-1PGDG.i386.rpm，檔案大小 1164817 bytes，直接以
	rpm -Uvh 安裝即可，不用重新 compile。JDBC driver 也是直接使用
	postgresql-jdbc-7.1.3-1PGDG.i386.rpm 所安裝的 jdbc7.1-1.2.jar 即可。</para>
      <para>資料庫請以 Unicode 編碼〈createdb -E Unicode〉，這點最為重要。</para>
      <para>Web application Deployment(web.xml) 中的 &lt;web-app&gt; 不要加上
	character-encoding="xxx" 這個 attribute</para>
      <para>在 servlet 中，請設定 res.setcontentType("text/html; charset=CP950");</para>
      <para>form 的參數，直接以 getParameter("xxx") 讀取，
	再 insert 進資料庫，不用作任何轉碼。</para>
      <para>要從資料庫中讀取資料，得利用：
	new String(rs.getString("ColName").getBytes("8859_1"),"CP950") </para>
      <para>要輸出整份文件〈implement org.enhydra.xml.xmlc.html.HTMLObject 的文件〉時，
	不要用 out.println(doc.toDocument())，請改用如下的方法：</para>
      <programlisting>
org.enhydra.xml.io.OutputOptions options = new OutputOptions();
options.setOmitEncoding(false);
options.setXmlEncoding("Big5");
DOMFormatter formatter = new DOMFormatter(options);
if(iChingVotingsPage.getDelefate() != null) {
  out.println(formatter.toString(iChingVotingsPage.getDelegate()));
) else {
  out.println(formatter.toString(iChingVoringPage));
}</programlisting>
      <para>Servlet 檔案要以 javac -encoding CP950 來編譯。</para>
      <para>大功告成，如此解決方案，則可以完全正常處理所有罕見以及特殊字元，
	不論是插入資料庫，從資料庫取出來在網頁上，都沒有問題。</para>
  </sect1>

  <sect1 id="java">
    <title>Java 中文程式設計</title>
      <para>FreeBSD 下的 java distribution 分為 Native JDK For FreeBSD、
	Sun JDK For Linux、IBM JDK For Linux、Blackdown JDK For Linux，
	都可以在 <filename>/usr/ports/java</filename> 目錄下找到，
	For Linux 的部分只要裝上 Linux 模擬器就可以執行，
	而 Native JDK 就必須自己從 source 編譯。
	而且安裝上都必須依照步驟先去網站上下載所需的檔案，
	放置到 <filename>/usr/ports/distfiles</filename>。</para>
      <para>以最困難的 <filename role="package">java/jdk13</filename> 安裝為例，
	你必須到 <ulink url="http://www.sun.com/software/java2/download.html">
	Sun Community Source Licensing</ulink> 下載 j2sdk-src-scsl.zip 和
	j2sdk-bin.scsl.zip 這兩個檔案，並到
	<ulink url="http://www.eyesbeyond.com/freebsddom/java/jdk14.html">
	Java 2 on FreeBSD</ulink> 下載 bsd-jdk14-patches.tar.gz。
	又因為編譯的時候需要 <filename role="package">java/linux-sun-jdk14</filename>，
	所以還需要先安裝好才行。
	並且根據編譯的需求，我們還需要一個 <option>linprocfs</option>，
	你可以用 <command>mount -t linprocfs linprocfs /compat/linux/proc</command>
	來將 linprocfs 掛上。並在系統上預留 2.5GB 的硬碟空間來進行編譯，
	當以上都準備就緒，就可以開始編譯然後等明天再來驗收囉。</para>
      <para>想知道您的 JDK 或 JRE 會用什麼樣的編碼方式來和作業系統溝通，
	請執行下面的 Java 程式：</para>
      <programlisting>
public class ShowNativeEncoding {
  public static void main(String[] args) {
    String enc = System.getProperty("file.encoding");
    System.out.println("NativeEncoding:" + enc);
    System.out.println("成功");
  }
}</programlisting>
      <screen>
&prompt.user; <userinput>javac ShowNativeEncoding.java</userinput>
&prompt.user; <userinput>java ShowNativeEncoding</userinput>
NativeEncoding:Big5
成功</screen>
      <para>
	如果出現以上的訊息，就表示中文正常，如果沒有的話，
	請確定您的 LC_CTYPE 是 zh_TW.Big5，或是用
	<command>javac -encoding CP950 ShowNativeEncoding.java</command>
	來進行編譯，應該會出現如上的顯示才對。</para>
      <note>
	<para>Big5：這是繁體中文 de facto 標準。 </para>
        <para>
	  MS950 或 Cp950：ASCII + Big5，用於台灣和香港的繁體中文 MS
Windows作業系統。</para></note>
      <para>筆者的環境設定 <filename>~/.cshrc</filename></para>
      <programlisting>
# For JAVA jdk1.3.1
setenv JAVA_HOME /usr/local/jdk1.3.1
setenv CLASSPATH /usr/local/jdk1.3.1/lib/tools.jar:/usr/local/share/java/classes/:./
setenv PATH /usr/local/jdk1.3.1/bin:$PATH</programlisting>
      <para>如果要執行 applet 或是 swing的話，
	請按照以下步驟設定才能正確的看到中文字，
	<filename>font.properties.zh_TW</filename> 為 Forth 提供，
	該設定檔專給 arphicttf 使用：</para>
      <screen>
&prompt.root; <userinput>cd /usr/local/jdk1.3.1/jre/lib/</userinput>
&prompt.root; <userinput>fetch http://freebsd.sinica.edu.tw/~statue/conf/font.properties.zh_TW</userinput></screen>
      <para>
        經筆者測試在 mozilla-1.0 + jdk1.3.1p6_4 之後已經不需要設定就可以正確的看到中文，
	如果沒辦法就手動作如下步驟：</para>
      <screen>
&prompt.root; <userinput>cd /usr/X11R6/lib/mozilla/plugins/</userinput>
&prompt.root; <userinput>ln -s /usr/local/jdk1.3.1/jre/plugin/i386/ns600/libjavaplugin_oji.so libjavaplugin_oji.so</userinput></screen>
      <figure>
        <title>applet snapshot</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/applet" format="PNG">
          </imageobject>
        </mediaobject>
      </figure>
      <figure>
        <title>swing snapshot</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/swing" format="PNG">
          </imageobject>
        </mediaobject>
      </figure>
      <para>
	參考：
	<ulink url="http://www.oreilly.com.tw/sleepless/java_big5_1.htm">
	Java繁體中文處理完全攻略（一）</ulink>、
	<ulink url="http://www.oreilly.com.tw/sleepless/java_big5_2.htm">
	Java 繁體中文處理完全攻略（二）</ulink>。</para>
      <para>
	WWW: <ulink url="http://java.sun.com/">
	http://java.sun.com/</ulink></para>
  </sect1>

  <sect1 id="perl">
    <title>Perl 中文程式設計</title>
      <para>如何排除 Perl 程式處理中文資料的障礙？</para>
      <para>
	在 CGI Perl 程式中，有許多符號字元是有特殊用途的，
	而不幸的有某些這樣的字元卻與中文字的第二個位元組互相衝突，
	以至於會有中文字顯示或比對不正確，甚至是產生錯誤結果的現象，
	尤其是 | 及 \ 這兩個字元，所幸我們還有個 quotemeta 指令可以使用，
	這個指令可以將指定的字串中每個字元的前面都再多加上一個 \
	這個字元，使得字串內的特殊字元在處理時被視為單純的字碼，
	請參考下列的範例：</para>
      <para>
	假設 $str 是一個要做搜尋比對的中文字串，而 $line
	是逐行讀入的資料檔內容：</para>
<programlisting>
$restr = quotemeta $str;
if ($line !~ m/$restr/i) { ......
}</programlisting>
      <para>
	另外若不是以變數來處理的字串，通常我們會使用雙引號來標示及處理，
        然而這也是會發生上述的障礙，但是當您直接對雙引號括住的字串使用
        quotemeta 來處理時卻又會怪怪的，那怎麼辦呢？很間單！
        將雙引號改為單引號就可以囉∼因為單引號不會對其內的字元作特殊處理，
        換句話講在單引號之內的文字資料將會原原本本的呈現出來，
        不會去解譯變數也不會處理 escape 字元 ，例如原來的敘述是：</para>
<programlisting>
print "測試成功的$msg訊息！\n";</programlisting>
      <para>應改為：</para> 
<programlisting>
print '測試成功的訊息！';</programlisting>
      <para>
        請特別注意 \n 換行符號及 $msg 變數也需拿掉，因為單引號並不處理
        escape 字元及變數，如果不將 \n 符號及 $msg 變數拿掉，
        那麼顯示出來的字樣將會是</para> 
<screen>
成功的$msg訊息！\n</screen>
      <para>
        ，如果您仍希望顯示成原來包含變數及換行的效果，
        那就必須將單引號與雙引號資料併用，同時以 .
        符號來連結成完整的輸出敘述：</para> 
<programlisting>
print '成功的'.$msg.'訊息！'."\n";</programlisting>
      <para>
        上述結論就是當印出 成功的 與 訊息！ 字樣是使用單引號，
        而換行的 \n 則是用雙引號。</para>
      <para>以下是一個將檔案中所有的中文字移除的程式範例：</para>
      <programlisting>
#!/usr/bin/perl -w
# ./bg5rm.pl filename
# and it's will generate a filename.bg5rm
$ifname=$ARGV[0];
open(IF,"$ifname");
open(OF,"&gt;${ifname}.bg5rm");
$big5 = "[\xA1-\xF9][\x40-\x7E\xA1-\xFE]";
while(&lt;IF&gt;) {
  s/$big5//g;
  print OF $_;
  print $_;
}
close(IF);
close(OF);</programlisting>
      <para>以下是一個將文章中的中英文 word split 進 list：</para>
      <programlisting>
my $big5 = q{
    [\xA1-\xF9][\x40-\x7E\xA1-\xFE]
};
my $big5plus = q{
    [\x81-\xFE][\x40-\x7E\x80-\xFE]
};
my @chars = /$big5|$ascii+/gox;
my @charsplus = /$big5plus|$ascii+/gox;</programlisting>
      <para>MPX 的 <ulink url="http://www.hkln.net/perl/technique/chinese.htm">
	解決 Perl 處理中文字的問題</ulink></para>
      <para>CJKV Information Processing 這本書有些不錯的 perl 程式
	<ulink url="ftp://ftp.oreilly.com/pub/examples/nutshell/cjkv/perl/">
	範例</ulink>，其中 *.pdf 是一些討論 perl 下處理 multibyte 的 
	papers。</para>
      <para>Erik Peterson 寫了一些有用的 <ulink
	url="http://www.mandarintools.com/">Perl 程式</ulink>，
	可處理中文轉換。</para>
      <para>
	WWW: <ulink url="http://www.perl.org/">
	http://www.perl.org/</ulink></para>
  </sect1>

  <sect1 id="mysql">
    <title>MySQL Localisation and International Usage</title>
    <para>WWW: <ulink url="http://www.mysql.com/documentation/mysql/bychapter/index.html#Localisation">
       MySQL Localisation and International Usage</ulink></para> 
    <para>動態能從 my.cnf 調整的部份並沒有 big5.conf：</para>
    <screen>
&prompt.user; <userinput>ls /usr/local/share/mysql/charsets</userinput>
Index        danish.conf   greek.conf      koi8_ukr.conf  usa7.conf
README       dec8.conf     hebrew.conf     latin1.conf    win1250.conf
cp1251.conf  dos.conf      hp8.conf        latin2.conf    win1251.conf
cp1257.conf  estonia.conf  hungarian.conf  latin5.conf    win1251ukr.conf
croat.conf   german1.conf  koi8_ru.conf    swe7.conf</screen>
    <para>靜態要在 compile 階段完成的部份：</para>
    <screen>
&prompt.user; <userinput>ls mysql-3.23.55/strings/ctype*.c</userinput>
mysql-3.23.55/strings/ctype-big5.c    mysql-3.23.55/strings/ctype-sjis.c
mysql-3.23.55/strings/ctype-czech.c   mysql-3.23.55/strings/ctype-tis620.c
mysql-3.23.55/strings/ctype-euc_kr.c  mysql-3.23.55/strings/ctype-ujis.c
mysql-3.23.55/strings/ctype-gb2312.c  mysql-3.23.55/strings/ctype.c
mysql-3.23.55/strings/ctype-gbk.c</screen>
    <para>也就是說 multibyte support 必須要 compile 時就給他下好這個參數，
      是否能直接設定 my.cnf 達到 --with-charset=big5 的效果還不確定。</para>
    <para>檢驗方式，進入 mysql 後打：</para>
    <screen>
mysql&gt; <userinput>show variables like 'character_sets';</userinput>
mysql&gt; <userinput>show variables like 'character_set';</userinput></screen>
    <para>那 character set 影響那些呢？就我所知的有 ORDER BY 和 GROUP BY 
      的順序，那特殊中文字 insert 進資料的問題還是在嗎？</para>
    <note><para>另一常見的問題是，MySQL 無法輸入中文資料庫名稱、中文表格名稱、
      中文欄位名稱？其實是可以的，只要用 <literal>`</literal>
      將中文字包含在內就可以，像是 <command>CREATE DATABASE `哈囉`;</command>。</para></note>
    <para>WWW: <ulink url="http://www.mysql.com/">
    http://www.mysql.com/</ulink></para>
  </sect1>

  <sect1 id="ldap">
    <title>在 LDAP 下使用中文</title>
    <para>Contributed by duncanlo (duncan@twn.wox.org)</para>
    <para>Last Update: 2003年 4月24日 周四 05時13分04秒 CST</para>
    <para>如果是要將 .ldif 轉入，必須先將中文轉成 utf-8。</para>
    <para>安裝 <filename role="package">converter/iconv</filename>，
    假設要轉碼的檔案是 big5.ldif，轉出來的檔案是 utf-8.ldif。</para>
    <screen>
&prompt.user; <userinput>iconv -f big5 -t utf-8 big5.ldif > utf-8.ldif</userinput></screen>
    <para>然後就可以用 <command>ldapadd</command> 來將 utf-8.ldif 轉入 ldap 了。</para>
      <figure>
        <title>ldap snapshot</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/ldap" format="PNG">
          </imageobject>
        </mediaobject>
      </figure>
    <para>WWW: <ulink url="http://www.iit.edu/~gawojar/ldap/">
      Java LDAP Browser/Editor</ulink></para>
  </sect1>

  <sect1 id="perl-cgi">
    <title>用 perl 寫 CGI 時的中文顯示問題？</title>
    <para>Contributed by fjj.bbs@bbs.csie.ncku.edu.tw (Frank Millers)</para>
    <para>Last Update: Sun Nov  2 17:45:35 2003</para>
    <programlisting>
use CGI;
my $q = new CGI;
$q->head(charset=big5);
$q->start_html(lang=big5);</programlisting>
  </sect1>

</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../zh-tut.sgml" "part" "chapter")
     End:
-->

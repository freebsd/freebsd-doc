<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE article PUBLIC "-//FreeBSD//DTD DocBook XML V5.0-Based Extension//EN" "http://www.FreeBSD.org/XML/share/xml/freebsd50.dtd">
<!--
  - Copyright (c) 2001-2003 Networks Associates Technology, Inc.
  - All rights reserved.
  -
  - This software was developed for the FreeBSD Project by ThinkSec AS and
  - Network Associates Laboratories, the Security Research Division of
  - Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
  - ("CBOSS"), as part of the DARPA CHATS research program.
  -
  - Redistribution and use in source and binary forms, with or without
  - modification, are permitted provided that the following conditions
  - are met:
  - 1. Redistributions of source code must retain the above copyright
  -    notice, this list of conditions and the following disclaimer.
  - 2. Redistributions in binary form must reproduce the above copyright
  -    notice, this list of conditions and the following disclaimer in the
  -    documentation and/or other materials provided with the distribution.
  - 3. The name of the author may not be used to endorse or promote
  -    products derived from this software without specific prior written
  -    permission.
  -
  - THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
  - ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  - IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  - ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
  - FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  - DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
  - OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
  - HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
  - LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
  - OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
  - SUCH DAMAGE.
  -->
<article xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:its="http://www.w3.org/2005/11/its" version="5.0" xml:lang="pt_BR">
  <info>
    <title>Módulos de Autenticação Plugáveis</title>

    <abstract>
      <para>Esse artigo descreve princípios subjacentes e mecanismos da biblioteca de Módulos de Autenticação Plugáveis (PAM), e explica como configurar, como integrar com outras aplicações e como escrever novos módulos.</para>
    </abstract>

    <copyright><year>2001</year> <year>2002</year> <year>2003</year> <holder>Networks Associates Technology, Inc.</holder></copyright>

    <authorgroup>
      <author><personname> <firstname>Dag-Erling</firstname> <surname>Smørgrav</surname> </personname> <contrib>Contributed by </contrib></author>
    </authorgroup>

    <legalnotice xml:id="pam-legalnotice">
      <para>This article was written for the FreeBSD Project by ThinkSec AS and Network Associates Laboratories, the Security Research Division of Network Associates, Inc. under DARPA/SPAWAR contract N66001-01-C-8035 (<quote>CBOSS</quote>), as part of the DARPA CHATS research program.</para>
    </legalnotice>

    <legalnotice xml:id="trademarks" role="trademarks">
      <para>FreeBSD is a registered trademark of the FreeBSD Foundation.</para>
      <para>Linux is a registered trademark of Linus Torvalds.</para>
      <para>Motif, OSF/1, and UNIX are registered trademarks and IT DialTone and The Open Group are trademarks of The Open Group in the United States and other countries.</para>
      <para>Sun, Sun Microsystems, Java, Java Virtual Machine, JDK, JRE, JSP, JVM, Netra, OpenJDK, Solaris, StarOffice, SunOS and VirtualBox are trademarks or registered trademarks of Sun Microsystems, Inc. in the United States and other countries.</para>
      <para>Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where those designations appear in this document, and the FreeBSD Project was aware of the trademark claim, the designations have been followed by the <quote>™</quote> or the <quote>®</quote> symbol.</para>
    </legalnotice>

    <releaseinfo>$FreeBSD$</releaseinfo>
  </info>

  <section xml:id="pam-intro">
    <title xml:id="pam-intro.title">Introdução</title>

    <para>A biblioteca dos Módulos de Autenticação Plugáveis (PAM) é uma API generalizada para serviços relacionados com autenticações as quais permitem ao administrador de sistema adicionar um novo método de autenticação simplesmente pela instalação de um novo módulo PAM, e modificar a política de autenticação pela edição do arquivo de configuração.</para>

    <para>O PAM foi definido e desenvolvido em 1995 por Vipin Samar e Charlie Lai da Sun Microsystems, e não teve muitas mudanças até hoje. Em 1997, o Open Group publicou a especificação preliminar do X/Open Single Sign-on (XSSO),  a qual padroniza a API do PAM e adiciona extensões para autenticação única ou integrada. No momento da redação deste documento, esta especificação ainda não tinha sido adotada como padrão.</para>

    <para>Apesar deste artigo focar primariamente no sistema FreeBSD 5.x, o qual usa o OpenPAM, ele poderá ser igualmente aplicado ao FreeBSD 4.x, o qual usa o Linux-PAM, e a outros systemas operacionais, tais como o Linux e o <trademark>Solaris</trademark>.</para>
  </section>

  <section xml:id="pam-terms">
    <title xml:id="pam-terms.title">Termos e convenções</title>

    <section xml:id="pam-definitions">
      <title xml:id="pam-definitions.title">Definições</title>

      <para>A terminologia em torno do PAM é bastante confusa. Nem o artigo original de  Neither Samar e Lai nem a especificação original do XSSO fizeram algum esforço para definir formalmente os termos de vários atores e entidades envolvidas no PAM, e os termos que eles usam (mas não definem) são algumas vezes duvidosos ou ambíguos. A primeira tentativa de estabelecer uma terminologia consistente e não ambígua foi feita no artigo escrito por Andrew G. Morgan (autor do Linux-PAM) em 1999. A escolha da terminologia de Morgan foi um grande avanço, mas na opinião deste autor, não é perfeita. O que segue é uma tentativa, fortemente inspirada por Morgan, de definir termos precisos e não ambíguos para todos os atores e entidades envolvidas no PAM.</para>

      <glosslist>
	<glossentry>
	  <glossterm>conta (account)</glossterm>
	  <glossdef>
	    <para>Um conjunto de credenciais que o requerente está solicitando ao mediador.</para>
	  </glossdef>
	</glossentry>

	<glossentry>
	  <glossterm>requerente (applicant)</glossterm>
	  <glossdef>
	    <para>Usuário ou entidade que solicita autenticação</para>
	  </glossdef>
	</glossentry>

	<glossentry>
	  <glossterm>Mediador (arbitrator)</glossterm>
	  <glossdef>
	    <para>Usuário ou entidade a qual tem privilégios necessários para verificar as credenciais do requerente e autorizar ou não a solicitação</para>
	  </glossdef>
	</glossentry>

	<glossentry>
	  <glossterm>chain</glossterm>
	  <glossdef>
	    <para>Uma sequência de módulos que irá ser chamada em resposta a uma solicitação do PAM. A chain inclui informações sobre a ordem a qual invocar os módulos, quais argumentos foram passados e como interpretar os resultados.</para>
	  </glossdef>
	</glossentry>

	<glossentry>
	  <glossterm>client</glossterm>
	  <glossdef>
	    <para>A aplicação responsável por inicializar uma solicitação de autenticação em nome do requerente para obter as informações necessárias da autenticação dele.</para>
	  </glossdef>
	</glossentry>

	<glossentry>
	  <glossterm>recursos </glossterm>
	  <glossdef>
	    <para>Um dos quatro grupos básicos de funcionalidades fornecidos pelo PAM: autenticação, gerenciamento de conta, gerenciamento de sessão e atualização de token de autenticação.</para>
	  </glossdef>
	</glossentry>

	<glossentry>
	  <glossterm>módulo</glossterm>
	  <glossdef>
	    <para>Uma coleção de uma ou mais funções relacionadas implementando um recurso de autenticação específico, reunidas em um único arquivo binário (normalmente carregável dinamicamente) e identificadas por um único nome.</para>
	  </glossdef>
	</glossentry>

	<glossentry>
	  <glossterm>política</glossterm>
	  <glossdef>
	    <para>O conjunto completo de instruções de configuração que descrevem como lidar com solicitações do PAM para um serviço específico. Uma política normalmente consiste em quatro chains, uma para cada recurso, embora alguns serviços não utilizem os quatro recursos.</para>
	  </glossdef>
	</glossentry>

	<glossentry>
	  <glossterm>servidor</glossterm>
	  <glossdef>
	    <para>O aplicativo agindo em nome do mediador para conversar com o cliente, recuperar informações de autenticação, verificar as credenciais do requerente e conceder ou negar solicitações.</para>
	  </glossdef>
	</glossentry>

	<glossentry>
	  <glossterm>serviço</glossterm>
	  <glossdef>
	    <para>Classe de servidores que provêm recursos similares ou relacionados e requerem autenticação similar. As políticas do PAM são definidas por serviço, portanto, todos os servidores que reivindicam o mesmo nome de serviço estarão sujeitos à mesma política.</para>
	  </glossdef>
	</glossentry>

	<glossentry>
	  <glossterm>sessão</glossterm>
	  <glossdef>
	    <para>O contexto com o qual serviços são apresentados para o requerente pelo servidor. Um dos quatro recursos do PAM, gerenciamento de sessão, é concedido exclusivamente configurando e derrubando esse contexto.</para>
	  </glossdef>
	</glossentry>

	<glossentry>
	  <glossterm>token</glossterm>
	  <glossdef>
	    <para>Um pedaço de informação associada à conta, como uma senha sendo uma palavra ou uma frase, que o solicitante deve fornecer para provar sua identidade.</para>
	  </glossdef>
	</glossentry>

	<glossentry>
	  <glossterm>transação</glossterm>
	  <glossdef>
	    <para>Uma sequência de solicitações do mesmo requerente para a mesma instância do mesmo servidor, começando com a configuração de autenticação e sessão e terminando com a desmontagem da sessão.</para>
	  </glossdef>
	</glossentry>
      </glosslist>
    </section>

    <section xml:id="pam-usage-examples">
      <title xml:id="pam-usage-examples.title">Exemplos de uso</title>

      <para>Esta seção tem como objetivo ilustrar os significados de alguns dos termos definidos acima por meio de alguns exemplos simples.</para>

      <section>
	<title>O cliente e o servidor são um</title>

	<para>Este exemplo simples mostra <literal>alice</literal> usando <citerefentry> <refentrytitle>su</refentrytitle><manvolnum>1</manvolnum></citerefentry> para se tornar <literal>root</literal>.</para>

	<screen><prompt>%</prompt> <userinput>whoami</userinput>
alice
<prompt>%</prompt> <userinput>ls -l `which su`</userinput>
-r-sr-xr-x  1 root  wheel  10744 Dec  6 19:06 /usr/bin/su
<prompt>%</prompt> <userinput>su -</userinput>
Password: <userinput>xi3kiune</userinput>
<prompt>#</prompt> whoami
root</screen>

	<itemizedlist>
	  <listitem>
	    <para>O requerente é <literal>alice</literal>.</para>
	  </listitem>
	  <listitem>
	    <para>A conta é <literal>root</literal>.</para>
	  </listitem>
	  <listitem>
	    <para>O processo <citerefentry><refentrytitle>su</refentrytitle><manvolnum>1</manvolnum></citerefentry> é ao mesmo tempo, o cliente e o servidor.</para>
	  </listitem>
	  <listitem>
	    <para>O token de autenticação é <literal>xi3kiune</literal>.</para>
	  </listitem>
	  <listitem>
	    <para>O mediador é <literal>root</literal>, e é por isso que <citerefentry><refentrytitle>su</refentrytitle><manvolnum>1</manvolnum></citerefentry> possui setuid para <literal>root</literal>.</para>
	  </listitem>
	</itemizedlist>
      </section>

      <section>
	<title>O cliente e o servidor são separados</title>

	<para>O exemplo abaixo mostra <literal>eve</literal> tentar iniciar uma conexão <citerefentry><refentrytitle>ssh</refentrytitle><manvolnum>1</manvolnum></citerefentry> com <literal>login.example.com</literal>, solicitar para efetuar login como <literal>bob</literal> e ter exito. Bob deveria ter escolhido uma senha melhor!</para>

	<screen><prompt>%</prompt> <userinput>whoami</userinput>
eve
<prompt>%</prompt> <userinput>ssh bob@login.example.com</userinput>
bob@login.example.com's password: <userinput>god</userinput>
Last login: Thu Oct 11 09:52:57 2001 from 192.168.0.1
Copyright (c) 1980, 1983, 1986, 1988, 1990, 1991, 1993, 1994
	The Regents of the University of California.  All rights reserved.
FreeBSD 4.4-STABLE (LOGIN) #4: Tue Nov 27 18:10:34 PST 2001

Welcome to FreeBSD!
<prompt>%</prompt></screen>

	<itemizedlist>
	  <listitem>
	    <para>O requerente é <literal>eve</literal>.</para>
	  </listitem>
	  <listitem>
	    <para>O cliente é o processo <citerefentry><refentrytitle>ssh</refentrytitle><manvolnum>1</manvolnum></citerefentry> de Eve.</para>
	  </listitem>
	  <listitem>
	    <para>O servidor é o processo <citerefentry><refentrytitle>sshd</refentrytitle><manvolnum>8</manvolnum></citerefentry> em <literal>login.example.com</literal></para>
	  </listitem>
	  <listitem>
	    <para>A conta é <literal>bob</literal>.</para>
	  </listitem>
	  <listitem>
	    <para>O token de autenticação é <literal>god</literal>.</para>
	  </listitem>
	  <listitem>
	    <para>Embora isso não seja mostrado neste exemplo, o mediador é <literal>root</literal>.</para>
	  </listitem>
	</itemizedlist>
      </section>

      <section>
	<title>Exemplo de política</title>

	<para>A seguir, a política padrão do FreeBSD para <literal>sshd</literal>:</para>

	<programlisting>sshd	auth		required	pam_nologin.so	no_warn
sshd	auth		required	pam_unix.so	no_warn try_first_pass
sshd	account		required	pam_login_access.so
sshd	account		required	pam_unix.so
sshd	session		required	pam_lastlog.so	no_fail
sshd	password	required	pam_permit.so</programlisting>

	<itemizedlist>
	  <listitem>
	    <para>Esta política se aplica ao serviço <literal>sshd</literal> (que não é necessariamente restrito ao servidor <citerefentry><refentrytitle>sshd</refentrytitle><manvolnum>8</manvolnum></citerefentry>).</para>
	  </listitem>
	  <listitem>
	    <para><literal>auth</literal>, <literal>account</literal>, <literal>session</literal> e <literal>password</literal> são recursos.</para>
	  </listitem>
	  <listitem>
	    <para><filename>pam_nologin.so</filename>, <filename>pam_unix.so</filename>, <filename>pam_login_access.so</filename>, <filename>pam_lastlog.so</filename> e <filename>pam_permit.so</filename> são módulos. Fica claro neste exemplo que o <filename>pam_unix.so</filename> fornece pelo menos dois recursos (autenticação e gerenciamento de conta).</para>
	  </listitem>
	</itemizedlist>
      </section>
    </section>

<!--
    <section id="pam-conventions">
      <title id="pam-conventions.title">Conventions</title>

      <para>This section has not yet been written.</para>
    </section>
-->
  </section>

  <section xml:id="pam-essentials">
    <title xml:id="pam-essentials.title">PAM Essencial</title>

    <section xml:id="pam-facilities-primitives">
      <title xml:id="pam-facilities-primitives.title">Recursos e Primitivas</title>

      <para>A API do PAM oferece seis primitivas de autenticação diferentes agrupadas em quatro recursos, descritos abaixo.</para>

      <variablelist>
	<varlistentry>
	  <term><literal>auth</literal></term>
	  <listitem>
	    <para><emphasis>Autenticação.</emphasis> Este recurso se preocupa em autenticar o requerente e estabelecer as credenciais da conta. Ele fornece duas primitivas:</para>

	    <itemizedlist>
	      <listitem>
		<para><citerefentry><refentrytitle>pam_authenticate</refentrytitle><manvolnum>3</manvolnum></citerefentry> autentica o requerente, geralmente solicitando um token de autenticação e comparando-o com um valor armazenado em um banco de dados ou obtido de um servidor de autenticação.</para>
	      </listitem>

	      <listitem>
		<para><citerefentry><refentrytitle>pam_setcred</refentrytitle><manvolnum>3</manvolnum></citerefentry> estabelece credenciais de conta, como ID de usuário, associação de grupo e limites de recursos.</para>
	      </listitem>
	    </itemizedlist>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><literal>account</literal></term>
	  <listitem>
	    <para><emphasis>Gerenciamento de contas.</emphasis> Esse recurso lida com problemas de disponibilidade de conta não relacionados à autenticação, como restrições de acesso com base na hora do dia ou na carga de trabalho do servidor. Ele fornece uma única primitiva:</para>

	    <itemizedlist>
	      <listitem>
		<para><citerefentry><refentrytitle>pam_acct_mgmt</refentrytitle><manvolnum>3</manvolnum></citerefentry> verifica se a conta solicitada está disponível.</para>
	      </listitem>
	    </itemizedlist>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><literal>session</literal></term>
	  <listitem>
	    <para><emphasis>Gerenciamento de sessão.</emphasis> Esse recurso lida com tarefas associadas à configuração e desmontagem da sessão, como a contabilização de login. Ele fornece duas primitivas:</para>

	    <itemizedlist>
	      <listitem>
		<para><citerefentry><refentrytitle>pam_open_session</refentrytitle><manvolnum>3</manvolnum></citerefentry> executa tarefas associadas à configuração da sessão: adiciona uma entrada nos bancos de dados <filename>utmp</filename> e <filename>wtmp</filename>, inicia um agente SSH, etc.</para>
	      </listitem>

	      <listitem>
		<para><citerefentry><refentrytitle>pam_close_session</refentrytitle><manvolnum>3</manvolnum></citerefentry> executa tarefas associadas à desmontagem da sessão: adiciona uma entrada nos bancos de dados <filename>utmp</filename> e <filename>wtmp</filename>, pare o agente SSH, etc.</para>
	      </listitem>
	    </itemizedlist>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><literal>password</literal></term>
	  <listitem>
	    <para><emphasis>Gerenciamento de senhas.</emphasis> Esse recurso é usado para alterar o token de autenticação associado a uma conta, porque expirou ou porque o usuário deseja alterá-lo. Ele fornece uma única primitiva:</para>

	    <itemizedlist>
	      <listitem>
		<para><citerefentry><refentrytitle>pam_chauthtok</refentrytitle><manvolnum>3</manvolnum></citerefentry> altera o token de autenticação, opcionalmente, verificando se é suficientemente difícil de adivinhar, se não foi usado anteriormente etc.</para>
	      </listitem>
	    </itemizedlist>
	  </listitem>
	</varlistentry>
      </variablelist>

    </section>

    <section xml:id="pam-modules">
      <title xml:id="pam-modules.title">Módulos</title>

      <para>Módulos são um conceito muito central no PAM; afinal, eles são os <quote>M</quote> no <quote>PAM</quote>. Um módulo PAM é um código de programa autocontido que implementa as primitivas em uma ou mais instalações para um mecanismo específico; possíveis mecanismos para o recurso de autenticação, por exemplo, incluem os bancos de dados de senhas <trademark class="registered">UNIX</trademark>, NIS, LDAP e Radius.</para>

      <section xml:id="pam-module-naming">
	<title xml:id="pam-module-naming.title">Nomeação de Módulos</title>

	<para>O FreeBSD implementa cada mecanismo em um único módulo, chamado <literal>pam_<replaceable>mechanism</replaceable>.so</literal> (por exemplo, <literal>pam_unix.so</literal> para o mecanismo <trademark class="registered">UNIX</trademark>. Outras implementações às vezes possuem módulos separados para instalações separadas e incluem o nome do recurso, bem como o nome do mecanismo no nome do módulo. Para citar um exemplo, <trademark>Solaris</trademark> tem um módulo <literal>pam_dial_auth.so.1</literal> que é comumente usado para autenticar usuários de conexões discadas.</para>
      </section>

      <section xml:id="pam-module-versioning">
	<title xml:id="pam-module-versioning.title">Versionando Módulos</title>

	<para>A implementação original do PAM no FreeBSD, baseada no Linux-PAM, não utilizou números de versão para os módulos PAM. Isso normalmente causaria problemas com aplicativos legados, que poderiam estar vinculados a versões mais antigas das bibliotecas do sistema, pois não havia como carregar uma versão correspondente dos módulos necessários.</para>

	<para>O OpenPAM, por outro lado, procura por módulos que possuam o mesmo número de versão que a biblioteca PAM (atualmente 2), e só retorna a um módulo não versionado se nenhum módulo versionado puder ser carregado. Assim, os módulos legados podem ser fornecidos para aplicativos legados, permitindo que novos aplicativos (ou recém-construídos) aproveitem os módulos mais recentes.</para>

	<para>Embora os módulos PAM do <trademark>Solaris</trademark> normalmente tenham um número de versão, eles não são realmente versionados, porque o número é uma parte do nome do módulo e deve ser incluído na configuração.</para>
      </section>
    </section>

    <section xml:id="pam-chains-policies">
      <title xml:id="pam-chains-policies.title">Cadeias e Políticas</title>

      <para>Quando um servidor inicia uma transação PAM, a biblioteca PAM tenta carregar uma política para o serviço especificado na chamada <citerefentry><refentrytitle>pam_start</refentrytitle><manvolnum>3</manvolnum></citerefentry>. A política especifica como as solicitações de autenticação devem ser processadas e definidas em um arquivo de configuração. Este é o outro conceito central no PAM: a possibilidade de o administrador ajustar a política de segurança do sistema (no sentido mais amplo da palavra) simplesmente editando um arquivo de texto.</para>

      <para>Uma política consiste em quatro cadeias, uma para cada uma dos quatro recursos do PAM. Cada chain é uma sequência de instruções de configuração, cada uma especificando um módulo para invocar, alguns parâmetros (opcionais) para passar para o módulo e um sinalizador de controle que descreve como interpretar o código de retorno do módulo.</para>

      <para>Entender os sinalizadores de controle é essencial para entender os arquivos de configuração do PAM. Existem quatro diferentes flags de controle:</para>

      <variablelist>
	<varlistentry>
	  <term><literal>binding</literal></term>
	  <listitem>
	    <para>Se o módulo tiver exito e nenhum módulo anterior na chain tiver falhado, a chain será encerrada imediatamente e a solicitação será concedida. Se o módulo falhar, o resto da chain é executado, mas a solicitação é negada no final.</para>

	    <para>Esta flag de controle foi introduzida pela Sun no <trademark>Solaris</trademark>9 (<trademark>SunOS</trademark> 5.9), e também é suportado pelo OpenPAM.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><literal>required</literal></term>
	  <listitem>
	    <para>Se o módulo tiver exito, o restante da chain será executada e a solicitação será concedida, a menos que algum outro módulo falhe. Se o módulo falhar, o restante da chain também será executado, mas a solicitação será negada no final.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><literal>requisite</literal></term>
	  <listitem>
	    <para>Se o módulo for tiver exito, o restante da chain será executado e a solicitação será concedida, a menos que algum outro módulo falhe. Se o módulo falhar, a chain será encerrada imediatamente e a solicitação será negada.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><literal>sufficient</literal></term>
	  <listitem>
	    <para>Se o módulo tiver exito e nenhum módulo anterior na chain tiver falhado, a chain será encerrada imediatamente e a solicitação será concedida. Se o módulo falhar, o módulo será ignorado e o resto da chain será executado.</para>

	    <para>Como a semântica dessa flag pode ser um pouco confusa, especialmente quando ela é usada para o último módulo em uma chain, é recomendado que a flag de controle <literal>binding</literal> seja usada em seu lugar, se a implementação o suportar.</para>
	  </listitem>
	</varlistentry>

	<varlistentry>
	  <term><literal>optional</literal></term>
	  <listitem>
	    <para>O módulo é executado, mas seu resultado é ignorado. Se todos os módulos em uma chain estiverem marcados como <literal>optional</literal>, todas as solicitações serão sempre concedidas.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>Quando um servidor invoca uma das seis primitivas PAM, o PAM recupera a chain para o recurso ao qual a primitiva pertence, e invoca cada um dos módulos listados na chain, na ordem em que estão listados, até chegar ao fim ou determina que nenhum processamento adicional é necessário (porque um módulo <literal>binding</literal> ou <literal>sufficient</literal> teve exito, ou porque um módulo <literal>requisite</literal> falhou.) O pedido é concedido se e somente se pelo menos um módulo foi chamado e todos os módulos não opcionais tiveram exito.</para>

      <para>Note que é possível, embora não muito comum, ter o mesmo módulo listado várias vezes na mesma chain. Por exemplo, um módulo que procura nomes de usuário e senhas em um servidor de diretório pode ser chamado várias vezes com parâmetros diferentes, especificando diferentes servidores de diretórios para contato. O PAM trata diferentes ocorrências do mesmo módulo na mesma chain de módulos diferentes e não relacionados.</para>
    </section>

    <section xml:id="pam-transactions">
      <title xml:id="pam-transactions.title">Transações</title>

      <para>O ciclo de vida de uma transação típica do PAM é descrito abaixo. Observe que, se qualquer uma dessas etapas falhar, o servidor deverá informar uma mensagem de erro adequada ao cliente e anular a transação.</para>

      <orderedlist>
	<listitem>
	  <para>Se necessário, o servidor obtém as credenciais do mediador por meio de um mecanismo independente do PAM - mais comumente em virtude de ter sido iniciado por <literal>root</literal> ou de ser setuid <literal>root</literal>.</para>
	</listitem>

	<listitem>
	  <para>O servidor chama <citerefentry><refentrytitle>pam_start</refentrytitle><manvolnum>3</manvolnum></citerefentry> para inicializar a biblioteca PAM, especificar seu nome de serviço e a conta de destino e registrar uma função de conversação adequada.</para>
	</listitem>

	<listitem>
	  <para>O servidor obtém várias informações relacionadas à transação (como o nome de usuário do requerente e o nome do host no qual o cliente é executado) e o envia ao PAM usando <citerefentry><refentrytitle>pam_set_item</refentrytitle><manvolnum>3</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem>
	  <para>O servidor chama <citerefentry><refentrytitle>pam_authenticate</refentrytitle><manvolnum>3</manvolnum></citerefentry> para autenticar o requerente.</para>
	</listitem>

	<listitem>
	  <para>O servidor chama <citerefentry><refentrytitle>pam_acct_mgmt</refentrytitle><manvolnum>3</manvolnum></citerefentry> para verificar se a conta solicitada está disponível e é válida. Se a senha estiver correta mas expirar, <citerefentry><refentrytitle>pam_acct_mgmt</refentrytitle><manvolnum>3</manvolnum></citerefentry> retornará <literal>PAM_NEW_AUTHTOK_REQD</literal> em vez de <literal>PAM_SUCCESS</literal>.</para>
	</listitem>

	<listitem>
	  <para>Se a etapa anterior retornasse <literal>PAM_NEW_AUTHTOK_REQD</literal>, o servidor agora chamaria <citerefentry><refentrytitle>pam_chauthtok</refentrytitle><manvolnum>3</manvolnum></citerefentry> para forçar o cliente a alterar o token de autenticação para a conta solicitada.</para>
	</listitem>

	<listitem>
	  <para>Agora que o requerente foi devidamente autenticado, o servidor chama <citerefentry><refentrytitle>pam_setcred</refentrytitle><manvolnum>3</manvolnum></citerefentry> para estabelecer as credenciais da conta solicitada. É capaz de fazer isso porque age em nome do mediador e possui as credenciais do madiador.</para>
	</listitem>

	<listitem>
	  <para>Depois que as credenciais corretas forem estabelecidas, o servidor chamará <citerefentry><refentrytitle>pam_open_session</refentrytitle><manvolnum>3</manvolnum></citerefentry> para configurar a sessão.</para>
	</listitem>

	<listitem>
	  <para>O servidor agora executa qualquer serviço solicitado pelo cliente - por exemplo, fornecer ao requerente um shell.</para>
	</listitem>

	<listitem>
	  <para>Quando o servidor terminar de atender ao cliente, ele chamará <citerefentry><refentrytitle>pam_close_session</refentrytitle><manvolnum>3</manvolnum></citerefentry> para derrubar a sessão.</para>
	</listitem>

	<listitem>
	  <para>Finalmente, o servidor chama <citerefentry><refentrytitle>pam_end</refentrytitle><manvolnum>3</manvolnum></citerefentry> para notificar a biblioteca PAM que ela esta pronta e que pode liberar quaisquer recursos alocados no curso da transação.</para>
	</listitem>
      </orderedlist>
    </section>
  </section>

  <section xml:id="pam-config">
    <title xml:id="pam-config.title">Configuração do PAM</title>

    <section xml:id="pam-config-file">
      <title xml:id="pam-config-file.title">Arquivos de política do PAM</title>

      <section xml:id="pam-config-pam.conf">
	<title xml:id="pam-config-pam.conf.title">O arquivo <filename>/etc/pam.conf</filename></title>

	<para>O arquivo de política tradicional do PAM é <filename>/etc/pam.conf</filename>. Este arquivo contém todas as políticas do PAM para o seu sistema. Cada linha do arquivo descreve uma etapa em uma chain, conforme mostrado abaixo:</para>

	<programlisting>login   auth    required        pam_nologin.so  no_warn</programlisting>

	<para>Os campos estão, na ordem: nome do serviço, nome do recurso, flag de controle, nome do módulo e argumentos do módulo. Quaisquer campos adicionais são interpretados como argumentos adicionais do módulo.</para>

	<para>Uma chain separada é construída para cada par de serviço/recurso, portanto, embora a ordem na qual as linhas para o mesmo serviço e recurso apareçam seja significativa, a ordem na qual os serviços e recursos individuais são listados não é. Os exemplos no artigo original do PAM agruparam as linhas de configuração por recurso, e o suporte do <trademark>Solaris</trademark> ao <filename>pam.conf</filename> ainda faz isso, mas a configuração de ações do FreeBSD configura as linhas por serviço. De qualquer maneira está bem; De qualquer forma, faz o mesmo sentido.</para>
      </section>

      <section xml:id="pam-config-pam.d">
	<title xml:id="pam-config-pam.d.title">O diretório <filename>/etc/pam.d</filename></title>

	<para>O OpenPAM e o Linux-PAM suportam um mecanismo de configuração alternativo, que é o mecanismo preferido no FreeBSD. Neste esquema, cada política está contida em um arquivo separado com o nome do serviço ao qual se aplica. Esses arquivos são armazenados em <filename>/etc/pam.d/</filename>.</para>

	<para>Esses arquivos de políticas por serviço possuem apenas quatro campos, em vez de cinco no <filename>pam.conf</filename>: o campo nome do serviço é omitido. Assim, em vez da linha de exemplo no <filename>pam.conf</filename> da seção anterior, a seguinte linha deve estar em <filename>/etc/pam.d/login</filename>:</para>

<programlisting>auth    required        pam_nologin.so  no_warn</programlisting>

	<para>Como consequência dessa sintaxe simplificada, é possível usar a mesma política para vários serviços vinculando cada nome de serviço a um mesmo arquivo de política. Por exemplo, para usar a mesma política para os serviços <literal>su</literal> e <literal>sudo</literal>, pode-se fazer o seguinte:</para>

	<screen><prompt>#</prompt> <userinput>cd /etc/pam.d</userinput>
<prompt>#</prompt> <userinput>ln -s su sudo</userinput></screen>

	<para>Isso funciona porque o nome do serviço é determinado a partir do nome do arquivo em vez de ser especificado no arquivo de políticas, portanto, o mesmo arquivo pode ser usado para vários serviços com nomes diferentes.</para>

	<para>Como a política de cada serviço é armazenada em um arquivo separado, o mecanismo <filename>pam.d</filename> também facilita a instalação de políticas adicionais para pacotes de software de terceiros.</para>
      </section>

      <section xml:id="pam-config-file-order">
	<title xml:id="pam-config-file-order.title">A ordem de pesquisa da política</title>

	<para>Como vimos acima, as políticas do PAM podem ser encontradas em vários lugares. O que acontece se as políticas para o mesmo serviço existirem em vários lugares?</para>

	<para>É essencial entender que o sistema de configuração do PAM está centrado em chains.</para>

      </section>
    </section>

    <section xml:id="pam-config-breakdown">
      <title xml:id="pam-config-breakdown.title">Quebra de uma linha de configuração</title>

      <para>Como explicado em <xref linkend="pam-config-file"/>, cada linha em <filename>/etc/pam.conf</filename> consiste em quatro ou mais campos: o nome do serviço, o nome do recurso, a flag de controle, o nome do módulo e nenhum ou mais argumentos do módulo.</para>

      <para>O nome do serviço é geralmente (embora nem sempre) o nome do aplicativo ao qual a instrução se aplica. Se não tiver certeza, consulte a documentação do aplicativo individual para determinar qual nome de serviço ele usa.</para>

      <para>Note que se você usar <filename>/etc/pam.d/</filename> em vez de <filename>/etc/pam.conf</filename>, o nome do serviço é especificado pelo nome do arquivo de política e omitido a partir das linhas de configuração atuais, que então começam com o nome da instalação.</para>

      <para>O recurso é uma das quatro palavras-chave do recurso descritas em <xref linkend="pam-facilities-primitives"/>.</para>

      <para>Da mesma forma, a flag de controle é uma das quatro palavras-chave descritas em <xref linkend="pam-chains-policies"/>, descrevendo como interpretar o código de retorno do módulo. O Linux-PAM suporta uma sintaxe alternativa que permite especificar a ação para associar com cada código de retorno possível, mas isso deve ser evitado, pois não é padrão e está intimamente ligado à forma como o Linux-PAM envia chamadas de serviço (que difere muito da maneira que <trademark>Solaris</trademark> e OpenPAM fazem isso). Não surpreendentemente, o OpenPAM não suporta esta sintaxe.</para>
    </section>

    <section xml:id="pam-policies">
      <title xml:id="pam-policies.title">Políticas</title>

      <para>Para configurar o PAM corretamente, é essencial entender como as políticas são interpretadas.</para>

      <para>Quando um aplicativo chama <citerefentry><refentrytitle>pam_start</refentrytitle><manvolnum>3</manvolnum></citerefentry>, a biblioteca PAM carrega a diretiva do serviço especificado e constrói quatro chains de módulos (uma para cada recurso). Se uma ou mais dessas chains estiverem vazias, as chains correspondentes da política para o <literal>outro</literal> serviço são substituídas.</para>

      <para>Quando o aplicativo chama mais tarde uma das seis primitivas PAM, a biblioteca PAM recupera a chain para o recurso correspondente e chama a função de serviço apropriado em cada módulo listado na chain, na ordem em que foram listadas na configuração. Após cada chamada para uma função de serviço, o tipo de módulo e o código de erro retornado pela função de serviço são usados ​​para determinar o que acontece a seguir. Com algumas exceções, discutidas abaixo, a tabela a seguir se aplica:</para>

      <table>
	<title>Resumo de execução da cadeia PAM</title>

	<tgroup cols="4">
	  <colspec colwidth="1*" colname="type"/>
	  <colspec colwidth="1*" colname="success"/>
	  <colspec colwidth="1*" colname="ignore"/>
	  <colspec colwidth="1*" colname="other"/>
	  <thead>
	    <row>
	      <entry colname="type"/>
	      <entry colname="success"><literal>PAM_SUCCESS</literal></entry>
	      <entry colname="ignore"><literal>PAM_IGNORE</literal></entry>
	      <entry colname="other"><literal>other</literal></entry>
	    </row>
	  </thead>
	  <tbody>
	    <row>
	      <entry colname="type">binding</entry>
	      <entry colname="success">if (!fail) break;</entry>
	      <entry colname="ignore">-</entry>
	      <entry colname="other">fail = true;</entry>
	    </row>

	    <row>
	      <entry colname="type">required</entry>
	      <entry colname="success">-</entry>
	      <entry colname="ignore">-</entry>
	      <entry colname="other">fail = true;</entry>
	    </row>

	    <row>
	      <entry colname="type">requisite</entry>
	      <entry colname="success">-</entry>
	      <entry colname="ignore">-</entry>
	      <entry colname="other">fail = true; break;</entry>
	    </row>

	    <row>
	      <entry colname="type">sufficient</entry>
	      <entry colname="success">if (!fail) break;</entry>
	      <entry colname="ignore">-</entry>
	      <entry colname="other">-</entry>
	    </row>

	    <row>
	      <entry colname="type">optional</entry>
	      <entry colname="success">-</entry>
	      <entry colname="ignore">-</entry>
	      <entry colname="other">-</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para>Se <varname>fail</varname> for true no final de uma chain, ou quando um <quote>break</quote> for atingido, o dispatcher retornará o código de erro retornado pelo primeiro módulo que falhou. Caso contrário, retorna <literal>PAM_SUCCESS</literal>.</para>

      <para>A primeira exceção é que o código de erro <literal>PAM_NEW_AUTHTOK_REQD</literal> é tratado como um sucesso, exceto que se nenhum módulo falhar e pelo menos um módulo retornar <literal>PAM_NEW_AUTHTOK_REQD</literal>, o dispatcher retornará <literal>PAM_NEW_AUTHTOK_REQD</literal>.</para>

      <para>A segunda exceção é que <citerefentry><refentrytitle>pam_setcred</refentrytitle><manvolnum>3</manvolnum></citerefentry> trata os módulos <literal>binding</literal> e <literal>sufficient</literal> como se eles fossem <literal>required</literal>.</para>

      <para>A terceira e última exceção é que <citerefentry><refentrytitle>pam_chauthtok</refentrytitle><manvolnum>3</manvolnum></citerefentry> executa a chain inteira duas vezes (uma vez para verificações preliminares e uma vez para definir a senha), e na fase preliminar, ele trata os módulos <literal>binding</literal> e <literal>sufficient</literal> como se fossem <literal>required</literal>.</para>
    </section>
  </section>

  <section xml:id="pam-freebsd-modules">
    <title xml:id="pam-freebsd-modules.title">Módulos PAM do FreeBSD</title>

    <section xml:id="pam-modules-deny">
      <title xml:id="pam-modules-deny.title"><citerefentry><refentrytitle>pam_deny</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_deny</refentrytitle><manvolnum>8</manvolnum></citerefentry> é um dos módulos mais simples disponíveis; responde a qualquer pedido com <literal>PAM_AUTH_ERR</literal>. É útil para desabilitar rapidamente um serviço (adicioná-lo ao topo de cada chain) ou para encerrar chains de módulos <literal>sufficient</literal>.</para>
    </section>

    <section xml:id="pam-modules-echo">
      <title xml:id="pam-modules-echo.title"><citerefentry><refentrytitle>pam_echo</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_echo</refentrytitle><manvolnum>8</manvolnum></citerefentry> simplesmente passa seus argumentos para a função de conversação como uma mensagem <literal>PAM_TEXT_INFO</literal>. É principalmente útil para depuração, mas também pode servir para exibir mensagens como <quote>O acesso não autorizado será processado</quote> antes de iniciar o procedimento de autenticação.</para>
    </section>

    <section xml:id="pam-modules-exec">
      <title xml:id="pam-modules-exec.title"><citerefentry><refentrytitle>pam_exec</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_exec</refentrytitle><manvolnum>8</manvolnum></citerefentry> leva seu primeiro argumento a ser o nome de um programa a ser executado, e os argumentos restantes são passados ​​para esse programa como argumentos de linha de comando. Uma aplicação possível é usá-lo para executar um programa no momento do login, que monta o diretório pessoal do usuário.</para>
    </section>

    <section xml:id="pam-modules-ftpusers">
      <title xml:id="pam-modules-ftpusers.title"><citerefentry><refentrytitle>pam_ftpusers</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>The <citerefentry><refentrytitle>pam_ftpusers</refentrytitle><manvolnum>8</manvolnum></citerefentry> module</para>
    </section>

    <section xml:id="pam-modules-group">
      <title xml:id="pam-modules-group.title"><citerefentry><refentrytitle>pam_group</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_group</refentrytitle><manvolnum>8</manvolnum></citerefentry> aceita ou rejeita os requerentes com base em sua participação em um determinado grupo de arquivos (normalmente <literal>wheel</literal> para <citerefentry><refentrytitle>su</refentrytitle><manvolnum>1</manvolnum></citerefentry>). Ele é destinado principalmente para manter o comportamento tradicional do <citerefentry><refentrytitle>su</refentrytitle><manvolnum>1</manvolnum></citerefentry> do BSD, mas tem muitos outros usos, como excluir determinados grupos de usuários de um serviço particular.</para>
    </section>

    <section xml:id="pam-modules-guest">
      <title xml:id="pam-modules-guest.title"><citerefentry><refentrytitle>pam_guest</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_guest</refentrytitle><manvolnum>8</manvolnum></citerefentry> permite logins convidados usando nomes de login fixos. Vários requerimentos podem ser colocados na senha, mas o comportamento padrão é permitir qualquer senha, desde que o nome de login seja o de uma conta de convidado. O módulo <citerefentry><refentrytitle>pam_guest</refentrytitle><manvolnum>8</manvolnum></citerefentry> pode ser facilmente utilizado para implementar logins FTP anônimos.</para>
    </section>

    <section xml:id="pam-modules-krb5">
      <title xml:id="pam-modules-krb5.title"><citerefentry><refentrytitle>pam_krb5</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_krb5</refentrytitle><manvolnum>8</manvolnum></citerefentry></para>
    </section>

    <section xml:id="pam-modules-ksu">
      <title xml:id="pam-modules-ksu.title"><citerefentry><refentrytitle>pam_ksu</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_ksu</refentrytitle><manvolnum>8</manvolnum></citerefentry></para>
    </section>

    <section xml:id="pam-modules-lastlog">
      <title xml:id="pam-modules-lastlog.title"><citerefentry><refentrytitle>pam_lastlog</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_lastlog</refentrytitle><manvolnum>8</manvolnum></citerefentry></para>
    </section>

    <section xml:id="pam-modules-login-access">
      <title xml:id="pam-modules-login-access.title"><citerefentry><refentrytitle>pam_login_access</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_login_access</refentrytitle><manvolnum>8</manvolnum></citerefentry> fornece uma implementação da primitiva de gerenciamento de contas que impõe as restrições de login especificadas na tabela <citerefentry><refentrytitle>login.access</refentrytitle><manvolnum>5</manvolnum></citerefentry>.</para>
    </section>

    <section xml:id="pam-modules-nologin">
      <title xml:id="pam-modules-nologin.title"><citerefentry><refentrytitle>pam_nologin</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_nologin</refentrytitle><manvolnum>8</manvolnum></citerefentry> recusa logins não-root quando existe um <filename>/var/run/nologin</filename>. Este arquivo é normalmente criado por <citerefentry><refentrytitle>shutdown</refentrytitle><manvolnum>8</manvolnum></citerefentry> quando restam menos de cinco minutos até o horário de encerramento programado.</para>
    </section>

    <section xml:id="pam-modules-opie">
      <title xml:id="pam-modules-opie.title"><citerefentry><refentrytitle>pam_opie</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_opie</refentrytitle><manvolnum>8</manvolnum></citerefentry> implementa o método de autenticação <citerefentry><refentrytitle>opie</refentrytitle><manvolnum>4</manvolnum></citerefentry>. O sistema <citerefentry><refentrytitle>opie</refentrytitle><manvolnum>4</manvolnum></citerefentry> é um mecanismo de desafio-resposta em que a resposta a cada desafio é uma função direta do desafio e uma frase-senha, então a resposta pode ser facilmente computada <quote>just in time</quote> por qualquer pessoa que possua a senha, eliminando a necessidade de listas de senhas. Além disso, como <citerefentry><refentrytitle>opie</refentrytitle><manvolnum>4</manvolnum></citerefentry> nunca reutiliza um desafio que tenha sido respondido corretamente, ele não é vulnerável a ataques de repetição.</para>
    </section>

    <section xml:id="pam-modules-opieaccess">
      <title xml:id="pam-modules-opieaccess.title"><citerefentry><refentrytitle>pam_opieaccess</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_opieaccess</refentrytitle><manvolnum>8</manvolnum></citerefentry> é um módulo complementar para <citerefentry><refentrytitle>pam_opie</refentrytitle><manvolnum>8</manvolnum></citerefentry>. Sua finalidade é impor as restrições codificadas em <citerefentry><refentrytitle>opieaccess</refentrytitle><manvolnum>5</manvolnum></citerefentry>, que regulam as condições sob as quais um usuário que normalmente se autenticaria usando <citerefentry><refentrytitle>opie</refentrytitle><manvolnum>4</manvolnum></citerefentry> tem permissão para usar métodos alternativos. Isso geralmente é usado para proibir o uso de autenticação de senha de hosts não confiáveis.</para>

      <para>Para ser eficaz, o módulo <citerefentry><refentrytitle>pam_opieaccess</refentrytitle><manvolnum>8</manvolnum></citerefentry> deve ser listado como <literal>requisite</literal> imediatamente após uma entrada <literal>sufficient</literal> para <citerefentry><refentrytitle>pam_opie</refentrytitle><manvolnum>8</manvolnum></citerefentry>, e antes de qualquer outro módulo, na chain <literal>auth</literal>.</para>
    </section>

    <section xml:id="pam-modules-passwdqc">
      <title xml:id="pam-modules-passwdqc.title"><citerefentry><refentrytitle>pam_passwdqc</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_passwdqc</refentrytitle><manvolnum>8</manvolnum></citerefentry></para>
    </section>

    <section xml:id="pam-modules-permit">
      <title xml:id="pam-modules-permit.title"><citerefentry><refentrytitle>pam_permit</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_permit</refentrytitle><manvolnum>8</manvolnum></citerefentry> é um dos módulos mais simples disponíveis; responde a qualquer pedido com <literal>PAM_SUCCESS</literal>. É útil como um espaço reservado para serviços onde uma ou mais chains estariam vazias.</para>
    </section>

    <section xml:id="pam-modules-radius">
      <title xml:id="pam-modules-radius.title"><citerefentry><refentrytitle>pam_radius</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_radius</refentrytitle><manvolnum>8</manvolnum></citerefentry></para>
    </section>

    <section xml:id="pam-modules-rhosts">
      <title xml:id="pam-modules-rhosts.title"><citerefentry><refentrytitle>pam_rhosts</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_rhosts</refentrytitle><manvolnum>8</manvolnum></citerefentry></para>
    </section>

    <section xml:id="pam-modules-rootok">
      <title xml:id="pam-modules-rootok.title"><citerefentry><refentrytitle>pam_rootok</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_rootok</refentrytitle><manvolnum>8</manvolnum></citerefentry> reporta sucesso se e somente se o ID do usuário real do processo que o chama (que é assumido como sendo executado pelo requerente) é 0. Isso é útil para serviços que não estão em rede, como <citerefentry><refentrytitle>su</refentrytitle><manvolnum>1</manvolnum></citerefentry> ou <citerefentry><refentrytitle>passwd</refentrytitle><manvolnum>1</manvolnum></citerefentry>, para o qual o <literal>root</literal> deve ter acesso automático.</para>
    </section>

    <section xml:id="pam-modules-securetty">
      <title xml:id="pam-modules-securetty.title"><citerefentry><refentrytitle>pam_securetty</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_securetty</refentrytitle><manvolnum>8</manvolnum></citerefentry></para>
    </section>

    <section xml:id="pam-modules-self">
      <title xml:id="pam-modules-self.title"><citerefentry><refentrytitle>pam_self</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_self</refentrytitle><manvolnum>8</manvolnum></citerefentry> reporta sucesso se, e somente se, os nomes do requerente coincidem com os da conta de destino. É mais útil para serviços que não estão em rede, como <citerefentry><refentrytitle>su</refentrytitle><manvolnum>1</manvolnum></citerefentry>, onde a identidade do requerente pode ser facilmente verificada.</para>
    </section>

    <section xml:id="pam-modules-ssh">
      <title xml:id="pam-modules-ssh.title"><citerefentry><refentrytitle>pam_ssh</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_ssh</refentrytitle><manvolnum>8</manvolnum></citerefentry> fornece serviços de autenticação e de sessão. O serviço de autenticação permite que os usuários que tenham chaves secretas SSH protegidas por senha em seu diretório <filename>~/.ssh</filename> se autentiquem digitando sua frase secreta. O serviço de sessão inicia o <citerefentry><refentrytitle>ssh-agent</refentrytitle><manvolnum>1</manvolnum></citerefentry> e o pré-carrega com as chaves que foram descriptografadas na fase de autenticação. Esse recurso é particularmente útil para logins locais, seja em X (usando <citerefentry vendor="xfree86"><refentrytitle>xdm</refentrytitle><manvolnum>1</manvolnum></citerefentry> ou outro gerenciador de login X que reconhece o PAM ) ou no console.</para>
    </section>

    <section xml:id="pam-modules-tacplus">
      <title xml:id="pam-modules-tacplus.title"><citerefentry><refentrytitle>pam_tacplus</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_tacplus</refentrytitle><manvolnum>8</manvolnum></citerefentry></para>
    </section>

    <section xml:id="pam-modules-unix">
      <title xml:id="pam-modules-unix.title"><citerefentry><refentrytitle>pam_unix</refentrytitle><manvolnum>8</manvolnum></citerefentry></title>

      <para>O módulo <citerefentry><refentrytitle>pam_unix</refentrytitle><manvolnum>8</manvolnum></citerefentry> implementa a autenticação de senha <trademark class="registered">UNIX</trademark> tradicional, usando <citerefentry><refentrytitle>getpwnam</refentrytitle><manvolnum>3</manvolnum></citerefentry> para obter a senha da conta de destino e compará-la com a fornecida pelo requerente. Ele também fornece serviços de gerenciamento de conta (impondo tempos de expiração de conta e senha) e serviços de alteração de senha. Este é provavelmente o módulo mais útil, já que a grande maioria dos administradores desejará manter um comportamento histórico para pelo menos alguns serviços.</para>
    </section>
  </section>

  <section xml:id="pam-appl-prog">
    <title xml:id="pam-appl-prog.title">Programação de Aplicação PAM</title>

    <para>Esta seção ainda não foi escrita.</para>

    <!--

      Note that while the original PAM paper includes a sample PAM
      application that calls pam_open_session() before pam_setcred(),
      the Linux-PAM documentation states that pam_setcred() must be
      called first, which makes more sense.

      Also note that the example in the paper calls setgid(),
      initgroups() and setuid() itself rather than rely on
      pam_setcred() to do it.

      -->

  </section>

  <section xml:id="pam-module-prog">
    <title xml:id="pam-module-prog.title">Programação de Módulos PAM</title>

    <para>Esta seção ainda não foi escrita.</para>
  </section>

  <appendix xml:id="pam-sample-appl">
    <title xml:id="pam-sample-appl.title">Exemplo de Aplicação PAM</title>

    <para>O que vem a seguir é uma implementação mínima de <citerefentry><refentrytitle>su</refentrytitle><manvolnum>1</manvolnum></citerefentry> utilizando o PAM. Observe que ele usa a função de conversa <citerefentry><refentrytitle>openpam_ttyconv</refentrytitle><manvolnum>3</manvolnum></citerefentry> específica do OpenPAM, que é prototipada em <filename>security/openpam.h</filename> . Se você deseja construir este aplicativo em um sistema com uma biblioteca PAM diferente, você terá que fornecer sua própria função de conversação. Uma função de conversa robusta é surpreendentemente difícil de implementar; o apresentado em <xref linkend="pam-sample-conv"/> é um bom ponto de partida, mas não deve ser usado em aplicações do mundo real.</para>

    <programlisting>/*-
 * Copyright (c) 2002,2003 Networks Associates Technology, Inc.
 * All rights reserved.
 *
 * This software was developed for the FreeBSD Project by ThinkSec AS and
 * Network Associates Laboratories, the Security Research Division of
 * Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
 * ("CBOSS"), as part of the DARPA CHATS research program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote
 *    products derived from this software without specific prior written
 *    permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * $P4: //depot/projects/openpam/bin/su/su.c#10 $
 * $FreeBSD$
 */

#include &lt;sys/param.h&gt;
#include &lt;sys/wait.h&gt;

#include &lt;err.h&gt;
#include &lt;pwd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;syslog.h&gt;
#include &lt;unistd.h&gt;

#include &lt;security/pam_appl.h&gt;
#include &lt;security/openpam.h&gt;	/* for openpam_ttyconv() */

extern char **environ;

static pam_handle_t *pamh;
static struct pam_conv pamc;

static void
usage(void)
{

	fprintf(stderr, "Usage: su [login [args]]\n");
	exit(1);
}

int
main(int argc, char *argv[])
{
	char hostname[MAXHOSTNAMELEN];
	const char *user, *tty;
	char **args, **pam_envlist, **pam_env;
	struct passwd *pwd;
	int o, pam_err, status;
	pid_t pid;

	while ((o = getopt(argc, argv, "h")) != -1)
		switch (o) {
		case 'h':
		default:
			usage();
		}

	argc -= optind;
	argv += optind;

	if (argc &gt; 0) {
		user = *argv;
		--argc;
		++argv;
	} else {
		user = "root";
	}

	/* initialize PAM */
	pamc.conv = &amp;openpam_ttyconv;
	pam_start("su", user, &amp;pamc, &amp;pamh);

	/* set some items */
	gethostname(hostname, sizeof(hostname));
	if ((pam_err = pam_set_item(pamh, PAM_RHOST, hostname)) != PAM_SUCCESS)
		goto pamerr;
	user = getlogin();
	if ((pam_err = pam_set_item(pamh, PAM_RUSER, user)) != PAM_SUCCESS)
		goto pamerr;
	tty = ttyname(STDERR_FILENO);
	if ((pam_err = pam_set_item(pamh, PAM_TTY, tty)) != PAM_SUCCESS)
		goto pamerr;

	/* authenticate the applicant */
	if ((pam_err = pam_authenticate(pamh, 0)) != PAM_SUCCESS)
		goto pamerr;
	if ((pam_err = pam_acct_mgmt(pamh, 0)) == PAM_NEW_AUTHTOK_REQD)
		pam_err = pam_chauthtok(pamh, PAM_CHANGE_EXPIRED_AUTHTOK);
	if (pam_err != PAM_SUCCESS)
		goto pamerr;

	/* establish the requested credentials */
	if ((pam_err = pam_setcred(pamh, PAM_ESTABLISH_CRED)) != PAM_SUCCESS)
		goto pamerr;

	/* authentication succeeded; open a session */
	if ((pam_err = pam_open_session(pamh, 0)) != PAM_SUCCESS)
		goto pamerr;

	/* get mapped user name; PAM may have changed it */
	pam_err = pam_get_item(pamh, PAM_USER, (const void **)&amp;user);
	if (pam_err != PAM_SUCCESS || (pwd = getpwnam(user)) == NULL)
		goto pamerr;

	/* export PAM environment */
	if ((pam_envlist = pam_getenvlist(pamh)) != NULL) {
		for (pam_env = pam_envlist; *pam_env != NULL; ++pam_env) {
			putenv(*pam_env);
			free(*pam_env);
		}
		free(pam_envlist);
	}

	/* build argument list */
	if ((args = calloc(argc + 2, sizeof *args)) == NULL) {
		warn("calloc()");
		goto err;
	}
	*args = pwd-&gt;pw_shell;
	memcpy(args + 1, argv, argc * sizeof *args);

	/* fork and exec */
	switch ((pid = fork())) {
	case -1:
		warn("fork()");
		goto err;
	case 0:
		/* child: give up privs and start a shell */

		/* set uid and groups */
		if (initgroups(pwd-&gt;pw_name, pwd-&gt;pw_gid) == -1) {
			warn("initgroups()");
			_exit(1);
		}
		if (setgid(pwd-&gt;pw_gid) == -1) {
			warn("setgid()");
			_exit(1);
		}
		if (setuid(pwd-&gt;pw_uid) == -1) {
			warn("setuid()");
			_exit(1);
		}
		execve(*args, args, environ);
		warn("execve()");
		_exit(1);
	default:
		/* parent: wait for child to exit */
		waitpid(pid, &amp;status, 0);

		/* close the session and release PAM resources */
		pam_err = pam_close_session(pamh, 0);
		pam_end(pamh, pam_err);

		exit(WEXITSTATUS(status));
	}

pamerr:
	fprintf(stderr, "Sorry\n");
err:
	pam_end(pamh, pam_err);
	exit(1);
}
</programlisting>
  </appendix>

  <appendix xml:id="pam-sample-module">
    <title xml:id="pam-sample-module.title">Exemplo do módulo PAM</title>

    <para>Segue-se uma implementação mínima de <citerefentry><refentrytitle>pam_unix</refentrytitle><manvolnum>8</manvolnum></citerefentry>, oferecendo apenas serviços de autenticação. Ele deve ser compilado e executado com a maioria das implementações do PAM, mas aproveita as extensões do OpenPAM, se disponível: observe o uso de <citerefentry><refentrytitle>pam_get_authtok</refentrytitle><manvolnum>3</manvolnum></citerefentry>, que simplifica enormemente solicitando ao usuário uma senha.</para>

<programlisting>/*-
 * Copyright (c) 2002 Networks Associates Technology, Inc.
 * All rights reserved.
 *
 * This software was developed for the FreeBSD Project by ThinkSec AS and
 * Network Associates Laboratories, the Security Research Division of
 * Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
 * ("CBOSS"), as part of the DARPA CHATS research program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote
 *    products derived from this software without specific prior written
 *    permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * $P4: //depot/projects/openpam/modules/pam_unix/pam_unix.c#3 $
 * $FreeBSD$
 */

#include &lt;sys/param.h&gt;

#include &lt;pwd.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;

#include &lt;security/pam_modules.h&gt;
#include &lt;security/pam_appl.h&gt;

#ifndef _OPENPAM
static char password_prompt[] = "Password:";
#endif

#ifndef PAM_EXTERN
#define PAM_EXTERN
#endif

PAM_EXTERN int
pam_sm_authenticate(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{
#ifndef _OPENPAM
	struct pam_conv *conv;
	struct pam_message msg;
	const struct pam_message *msgp;
	struct pam_response *resp;
#endif
	struct passwd *pwd;
	const char *user;
	char *crypt_password, *password;
	int pam_err, retry;

	/* identify user */
	if ((pam_err = pam_get_user(pamh, &amp;user, NULL)) != PAM_SUCCESS)
		return (pam_err);
	if ((pwd = getpwnam(user)) == NULL)
		return (PAM_USER_UNKNOWN);

	/* get password */
#ifndef _OPENPAM
	pam_err = pam_get_item(pamh, PAM_CONV, (const void **)&amp;conv);
	if (pam_err != PAM_SUCCESS)
		return (PAM_SYSTEM_ERR);
	msg.msg_style = PAM_PROMPT_ECHO_OFF;
	msg.msg = password_prompt;
	msgp = &amp;msg;
#endif
	for (retry = 0; retry &lt; 3; ++retry) {
#ifdef _OPENPAM
		pam_err = pam_get_authtok(pamh, PAM_AUTHTOK,
		    (const char **)&amp;password, NULL);
#else
		resp = NULL;
		pam_err = (*conv-&gt;conv)(1, &amp;msgp, &amp;resp, conv-&gt;appdata_ptr);
		if (resp != NULL) {
			if (pam_err == PAM_SUCCESS)
				password = resp-&gt;resp;
			else
				free(resp-&gt;resp);
			free(resp);
		}
#endif
		if (pam_err == PAM_SUCCESS)
			break;
	}
	if (pam_err == PAM_CONV_ERR)
		return (pam_err);
	if (pam_err != PAM_SUCCESS)
		return (PAM_AUTH_ERR);

	/* compare passwords */
	if ((!pwd-&gt;pw_passwd[0] &amp;&amp; (flags &amp; PAM_DISALLOW_NULL_AUTHTOK)) ||
	    (crypt_password = crypt(password, pwd-&gt;pw_passwd)) == NULL ||
	    strcmp(crypt_password, pwd-&gt;pw_passwd) != 0)
		pam_err = PAM_AUTH_ERR;
	else
		pam_err = PAM_SUCCESS;
#ifndef _OPENPAM
	free(password);
#endif
	return (pam_err);
}

PAM_EXTERN int
pam_sm_setcred(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_acct_mgmt(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_open_session(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_close_session(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_chauthtok(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SERVICE_ERR);
}

#ifdef PAM_MODULE_ENTRY
PAM_MODULE_ENTRY("pam_unix");
#endif
</programlisting>
  </appendix>

  <appendix xml:id="pam-sample-conv">
    <title xml:id="pam-sample-conv.title">Exemplo de função de conversação PAM</title>

    <para>A função de conversação apresentada abaixo é uma versão bastante simplificada do <citerefentry><refentrytitle>openpam_ttyconv</refentrytitle><manvolnum/></citerefentry> do OpenPAM. Ele é totalmente funcional e deve dar ao leitor uma boa ideia de como uma função de conversa deve se comportar, mas é simples demais para uso no mundo real. Mesmo se você não estiver usando o OpenPAM, sinta-se à vontade para baixar o código-fonte e adaptar <citerefentry><refentrytitle>openpam_ttyconv</refentrytitle><manvolnum>3</manvolnum></citerefentry> aos seus usos; acreditamos que seja tão robusto quanto uma função de conversa orientada para tty pode razoavelmente ser.</para>

<programlisting>/*-
 * Copyright (c) 2002 Networks Associates Technology, Inc.
 * All rights reserved.
 *
 * This software was developed for the FreeBSD Project by ThinkSec AS and
 * Network Associates Laboratories, the Security Research Division of
 * Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
 * ("CBOSS"), as part of the DARPA CHATS research program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote
 *    products derived from this software without specific prior written
 *    permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * $FreeBSD$
 */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;

#include &lt;security/pam_appl.h&gt;

int
converse(int n, const struct pam_message **msg,
	struct pam_response **resp, void *data)
{
	struct pam_response *aresp;
	char buf[PAM_MAX_RESP_SIZE];
	int i;

	data = data;
	if (n &lt;= 0 || n &gt; PAM_MAX_NUM_MSG)
		return (PAM_CONV_ERR);
	if ((aresp = calloc(n, sizeof *aresp)) == NULL)
		return (PAM_BUF_ERR);
	for (i = 0; i &lt; n; ++i) {
		aresp[i].resp_retcode = 0;
		aresp[i].resp = NULL;
		switch (msg[i]-&gt;msg_style) {
		case PAM_PROMPT_ECHO_OFF:
			aresp[i].resp = strdup(getpass(msg[i]-&gt;msg));
			if (aresp[i].resp == NULL)
				goto fail;
			break;
		case PAM_PROMPT_ECHO_ON:
			fputs(msg[i]-&gt;msg, stderr);
			if (fgets(buf, sizeof buf, stdin) == NULL)
				goto fail;
			aresp[i].resp = strdup(buf);
			if (aresp[i].resp == NULL)
				goto fail;
			break;
		case PAM_ERROR_MSG:
			fputs(msg[i]-&gt;msg, stderr);
			if (strlen(msg[i]-&gt;msg) &gt; 0 &amp;&amp;
			    msg[i]-&gt;msg[strlen(msg[i]-&gt;msg) - 1] != '\n')
				fputc('\n', stderr);
			break;
		case PAM_TEXT_INFO:
			fputs(msg[i]-&gt;msg, stdout);
			if (strlen(msg[i]-&gt;msg) &gt; 0 &amp;&amp;
			    msg[i]-&gt;msg[strlen(msg[i]-&gt;msg) - 1] != '\n')
				fputc('\n', stdout);
			break;
		default:
			goto fail;
		}
	}
	*resp = aresp;
	return (PAM_SUCCESS);
 fail:
        for (i = 0; i &lt; n; ++i) {
                if (aresp[i].resp != NULL) {
                        memset(aresp[i].resp, 0, strlen(aresp[i].resp));
                        free(aresp[i].resp);
                }
        }
        memset(aresp, 0, n * sizeof *aresp);
	*resp = NULL;
	return (PAM_CONV_ERR);
}
</programlisting>
  </appendix>

  <bibliography xml:id="pam-further">
    <info>
      <title xml:id="pam-further.title">Leitura Adicional</title>

      <abstract>
	<para>Esta é uma lista de documentos relevantes para o PAM e questões relacionadas. Não está de modo algum completo.</para>
      </abstract>
    </info>

    <bibliodiv>
      <title>Papers</title>

      <biblioentry>
	<citetitle>Tornando os Serviços de Login Independentes das Tecnologias de Autenticação</citetitle>
	<authorgroup>
	  <author><personname> <surname>Samar</surname> <firstname>Vipin</firstname> </personname></author>
	  <author><personname> <surname>Lai</surname> <firstname>Charlie</firstname> </personname></author>
	</authorgroup>
	<orgname>Sun Microsystems</orgname>
      </biblioentry>

      <biblioentry>
	<citetitle><link xlink:href="https://pubs.opengroup.org/onlinepubs/8329799/toc.htm">Especificação Preliminar do X/Open Single Sign-on</link></citetitle>
	<orgname>O grupo aberto</orgname>
	<biblioid class="isbn">1-85912-144-6</biblioid>
	<pubdate>Junho de 1997</pubdate>
      </biblioentry>

      <biblioentry>
	<citetitle><link xlink:href="https://mirrors.kernel.org/pub/linux/libs/pam/pre/doc/draft-morgan-pam-07.txt">Módulos de Autenticação Plugáveis</link></citetitle>
	<author><personname> <surname>Morgan</surname> <firstname>Andrew</firstname> <othername role="mi">G.</othername> </personname></author>
	<pubdate>06-10-1999</pubdate>
      </biblioentry>
    </bibliodiv>

    <bibliodiv>
      <title>Manuais do usuário</title>

      <biblioentry>
	<citetitle><link xlink:href="https://docs.oracle.com/cd/E26505_01/html/E27224/pam-1.html">Administração do PAM</link></citetitle>
	<orgname>Sun Microsystems</orgname>
      </biblioentry>
    </bibliodiv>

    <bibliodiv>
      <title>Páginas Web Relacionadas</title>

      <biblioentry>
	<citetitle><link xlink:href="https://www.openpam.org/">Homepage do OpenPAM</link></citetitle>
	<author><personname> <surname>Smørgrav</surname> <firstname>Dag-Erling</firstname> </personname></author>
	<orgname>ThinkSec AS</orgname>
      </biblioentry>

      <biblioentry>
	<citetitle><link xlink:href="http://www.kernel.org/pub/linux/libs/pam/">Página inicial do Linux-PAM</link></citetitle>
	<author><personname> <surname>Morgan</surname> <firstname>Andrew</firstname> <othername role="mi">G.</othername> </personname></author>
      </biblioentry>

      <biblioentry>
	<citetitle>Homepage do Solaris PAM</citetitle>
	<orgname>Sun Microsystems</orgname>
      </biblioentry>
    </bibliodiv>
  </bibliography>
</article>

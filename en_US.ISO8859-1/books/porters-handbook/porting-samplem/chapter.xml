<?xml version="1.0" encoding="iso-8859-1"?>
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->

<chapter xmlns="http://docbook.org/ns/docbook"
  xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
  xml:id="porting-samplem">

  <title>A Sample <filename>Makefile</filename></title>

  <para>Here is a sample <filename>Makefile</filename> that can be
    used to create a new port.  Make sure to remove all the extra
    comments (ones between brackets).</para>

  <para>The format shown is the recommended one for ordering
    variables, empty lines between sections, and so on.  This format is
    designed so that the most important information is easy to locate.
    We recommend using
    <link linkend="porting-portlint">portlint</link> to check the
    <filename>Makefile</filename>.</para>

  <programlisting>[the header...just to make it easier for us to identify the ports.]
# &dollar;FreeBSD&dollar;
[ ^^^^^^^^^ This will be automatically replaced with RCS ID string by SVN
when it is committed to our repository.  If upgrading a port, do not alter
this line back to "&dollar;FreeBSD&dollar;".  SVN deals with it automatically.]

[section to describe the port itself and the master site - PORTNAME
 and PORTVERSION are always first, followed by CATEGORIES,
 and then MASTER_SITES, which can be followed by MASTER_SITE_SUBDIR.
 PKGNAMEPREFIX and PKGNAMESUFFIX, if needed, will be after that.
 Then comes DISTNAME, EXTRACT_SUFX and/or DISTFILES, and then
 EXTRACT_ONLY, as necessary.]
PORTNAME=	xdvi
PORTVERSION=	18.2
CATEGORIES=	print
[do not forget the trailing slash ("/")!
 if not using MASTER_SITE_* macros]
MASTER_SITES=	${MASTER_SITE_XCONTRIB}
MASTER_SITE_SUBDIR=	applications
PKGNAMEPREFIX=	ja-
DISTNAME=	xdvi-pl18
[set this if the source is not in the standard ".tar.gz" form]
EXTRACT_SUFX=	.tar.Z

[section for distributed patches -- can be empty]
PATCH_SITES=	ftp://ftp.sra.co.jp/pub/X11/japanese/
PATCHFILES=	xdvi-18.patch1.gz xdvi-18.patch2.gz
[If the distributed patches were not made relative to ${WRKSRC},
 this may need to be tweaked]
PATCH_DIST_STRIP=	-p1

[maintainer; *mandatory*!  This is the person who is volunteering to
 handle port updates, build breakages, and to whom a users can direct
 questions and bug reports.  To keep the quality of the Ports Collection
 as high as possible, we do not accept new ports that are assigned to
 "ports@FreeBSD.org".]
MAINTAINER=	asami@FreeBSD.org
COMMENT=	DVI Previewer for the X Window System

[license -- should not be empty]
LICENSE=	BSD2CLAUSE
LICENSE_FILE=	${WRKSRC}/LICENSE

[dependencies -- can be empty]
RUN_DEPENDS=	gs:print/ghostscript

[If it requires GNU make, not /usr/bin/make, to build...]
USES= gmake
[If it is an X application and requires "xmkmf -a" to be run...]
USES= imake
[If the source is obtained from github, remove MASTER_SITE* and...]
USE_GITHUB=	yes
GH_ACCOUNT=	example

[this section is for other standard bsd.port.mk variables that do not]
 belong to any of the above]
[If it asks questions during configure, build, install...]
IS_INTERACTIVE=	yes
[If it extracts to a directory other than ${DISTNAME}...]
WRKSRC=		${WRKDIR}/xdvi-new
[If it requires a "configure" script generated by GNU autoconf to be run]
GNU_CONFIGURE=	yes
[et cetera.]

[If it requires options, this section is for options]
OPTIONS_DEFINE=	DOCS EXAMPLES FOO
OPTIONS_DEFAULT=	FOO
[If options will change the files in plist]
OPTIONS_SUB=yes

FOO_DESC=		Enable foo support

FOO_CONFIGURE_ENABLE=	foo

[non-standard variables to be used in the rules below]
MY_FAVORITE_RESPONSE=	"yeah, right"

[then the special rules, in the order they are called]
pre-fetch:
	i go fetch something, yeah

post-patch:
	i need to do something after patch, great

pre-install:
	and then some more stuff before installing, wow

[and then the epilogue]

.include &lt;bsd.port.mk&gt;</programlisting>

  <sect1 xml:id="porting-samplem-order">
    <title>Order of Variables in Port Makefiles</title>

    <para>The first sections of the <filename>Makefile</filename>
      must always come in the same order.  This standard makes it so
      everyone can easily read any port without having to search for
      variables in a random order.</para>

    <para>The first line of a <filename>Makefile</filename> is always
      a comment containing the <application>Subversion</application>
      version control ID, followed by an empty line.  In new ports, it
      looks like this:</para>

    <programlisting># &dollar;FreeBSD&dollar;
&nbsp;</programlisting>

    <para>In existing ports, <application>Subversion</application>
      has expanded it to look like this:</para>

    <programlisting># &dollar;FreeBSD: head/ports-mgmt/pkg/Makefile 437007 2017-03-26 21:25:47Z bapt &dollar;
&nbsp;</programlisting>

    <note>
      <para>The sections and variables described here are mandatory in
	a ordinary port.  In a slave port, many sections variables and
	can be skipped.</para>
    </note>

    <important>
      <para>Each following block must be separated from the previous
	block by a single blank line.</para>

      <para>In the following blocks, only set the variables that are
	required by the port.  Define these variables in the order
	they are shown here.</para>
    </important>

    <sect2 xml:id="porting-samplem-portname">
      <title><varname>PORTNAME</varname> Block</title>

      <para>This block is the most important.  It defines the port
	name, version, distribution file location, and category.  The
	variables must be in this order:</para>

      <itemizedlist>
	<listitem>
	  <para><link
	      linkend="makefile-portname"><varname>PORTNAME</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-portname"><varname>PORTVERSION</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-distversion"><varname>DISTVERSIONPREFIX</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-distversion"><varname>DISTVERSION</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-distversion"><varname>DISTVERSIONSUFFIX</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-portrevision"><varname>PORTREVISION</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-portepoch"><varname>PORTEPOCH</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-categories"><varname>CATEGORIES</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-master_sites"><varname>MASTER_SITES</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-master_sites-shorthand"><varname>MASTER_SITE_SUBDIR</varname></link>
	    (deprecated)</para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="porting-pkgnameprefix-suffix"><varname>PKGNAMEPREFIX</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="porting-pkgnameprefix-suffix"><varname>PKGNAMESUFFIX</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-distversion"><varname>DISTNAME</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-extract_sufx"><varname>EXTRACT_SUFX</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-distfiles-definition"><varname>DISTFILES</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-dist_subdir"><varname>DIST_SUBDIR</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-extract_only"><varname>EXTRACT_ONLY</varname></link></para>
	</listitem>
      </itemizedlist>

      <important>
	<para>Only one of <varname>PORTVERSION</varname> and
	  <varname>DISTVERSION</varname> can be used.</para>
      </important>
    </sect2>

    <sect2 xml:id="porting-samplem-patch">
      <title><varname>PATCHFILES</varname> Block</title>

      <para>This block is optional.  The variables are:</para>

      <itemizedlist>
	<listitem>
	  <para><link
	      linkend="porting-patchfiles"><varname>PATCH_SITES</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="porting-patchfiles"><varname>PATCHFILES</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="porting-patchfiles"><varname>PATCH_DIST_STRIP</varname></link></para>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2 xml:id="porting-samplem-maintainer">
      <title><varname>MAINTAINER</varname> Block</title>

      <para>This block is mandatory.  The variables are:</para>

      <itemizedlist>
	<listitem>
	  <para><link
	      linkend="makefile-maintainer"><varname>MAINTAINER</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-comment"><varname>COMMENT</varname></link></para>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2 xml:id="porting-samplem-license">
      <title><varname>LICENSE</varname> Block</title>

      <para>This block is optional, although it is highly recommended.
	The variables are:</para>

      <itemizedlist>
	<listitem>
	  <para><link
	      linkend="licenses-license"><varname>LICENSE</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="licenses-license_comb"><varname>LICENSE_COMB</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="licenses-license_groups"><varname>LICENSE_GROUPS</varname></link>
	    or
	    <varname>LICENSE_GROUPS_<replaceable>NAME</replaceable></varname></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="licenses-license_name"><varname>LICENSE_NAME</varname></link>
	    or
	    <varname>LICENSE_NAME_<replaceable>NAME</replaceable></varname></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="licenses-license_text"><varname>LICENSE_TEXT</varname></link>
	    or
	    <varname>LICENSE_TEXT_<replaceable>NAME</replaceable></varname></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="licenses-license_file"><varname>LICENSE_FILE</varname></link>
	    or
	    <varname>LICENSE_FILE_<replaceable>NAME</replaceable></varname></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="licenses-license_perms"><varname>LICENSE_PERMS</varname></link>
	    or
	    <varname>LICENSE_PERMS_<replaceable>NAME</replaceable></varname></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="licenses-license_distfiles"><varname>LICENSE_DISTFILES</varname></link>
	    or
	    <varname>LICENSE_DISTFILES_<replaceable>NAME</replaceable></varname></para>
	</listitem>
      </itemizedlist>

      <para>If there are multiple licenses, sort the different
	LICENSE_<replaceable>VAR</replaceable>_<replaceable>NAME</replaceable>
	variables by license name.</para>
    </sect2>

    <sect2 xml:id="porting-samplem-broken">
      <title>Generic
	<varname>BROKEN</varname>/<varname>IGNORE</varname>/<varname>DEPRECATED</varname>
	Messages</title>

      <para>This block is optional.  The variables are:</para>

      <itemizedlist>
	<listitem>
	  <para><link
	      linkend="dads-deprecated">DEPRECATED</link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="dads-deprecated">EXPIRATION_DATE</link></para>
	</listitem>

	<listitem>
	  <para><link linkend="dads-noinstall">FORBIDDEN</link></para>
	</listitem>

	<listitem>
	  <para><link linkend="dads-noinstall">BROKEN</link></para>
	</listitem>

	<listitem>
	  <para><link linkend="dads-noinstall">BROKEN_<replaceable>*</replaceable></link></para>
	</listitem>

	<listitem>
	  <para><link linkend="dads-noinstall">IGNORE</link></para>
	</listitem>

	<listitem>
	  <para><link linkend="dads-noinstall">IGNORE_<replaceable>*</replaceable></link></para>
	</listitem>

	<listitem>
	  <para><link linkend="dads-noinstall">ONLY_FOR_ARCHS</link></para>
	</listitem>

	<listitem>
	  <para><link linkend="dads-noinstall">ONLY_FOR_ARCHS_REASON<replaceable>*</replaceable></link></para>
	</listitem>

	<listitem>
	  <para><link linkend="dads-noinstall">NOT_FOR_ARCHS</link></para>
	</listitem>

	<listitem>
	  <para><link linkend="dads-noinstall">NOT_FOR_ARCHS_REASON<replaceable>*</replaceable></link></para>
	</listitem>
      </itemizedlist>

      <note>
	<para><varname>BROKEN<replaceable>*</replaceable></varname>
	  and <varname>IGNORE<replaceable>*</replaceable></varname>
	  can be any generic variables, for example,
	  <varname>IGNORE_amd64</varname>,
	  <varname>BROKEN_FreeBSD_10</varname>,
	  <varname>BROKEN_SSL</varname>, etc.</para>

	<para>If the port is marked BROKEN when some conditions are
	  met, and such conditions can only be tested after including
	  <filename>bsd.port.options.mk</filename> or
	  <filename>bsd.port.pre.mk</filename>, then those variables
	  should be set later, in <xref
	    linkend="porting-samplem-rest"/>.</para>
      </note>
    </sect2>

    <sect2 xml:id="porting-samplem-depends">
      <title>The Dependencies Block</title>

      <para>This block is optional.  The variables are:</para>

      <itemizedlist>
	<listitem>
	  <para><link
	      linkend="makefile-fetch_depends"><varname>FETCH_DEPENDS</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-extract_depends"><varname>EXTRACT_DEPENDS</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-patch_depends"><varname>PATCH_DEPENDS</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-build_depends"><varname>BUILD_DEPENDS</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-lib_depends"><varname>LIB_DEPENDS</varname></link></para>
	</listitem>

	<listitem>
	  <para><link
	      linkend="makefile-run_depends"><varname>RUN_DEPENDS</varname></link></para>
	</listitem>

	<listitem>
	  <!-- FIXME: write a section about tests -->
	  <para><varname>TEST_DEPENDS</varname></para>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2 xml:id="porting-samplem-uses">
      <title><varname>USES</varname> and
	<varname>USE_<replaceable>x</replaceable></varname></title>

      <para>Start this section with defining <varname>USES</varname>,
	and then possible
	<varname>USE_<replaceable>x</replaceable></varname>.</para>

      <para>Keep related variables close together.  For example, if
	using <link
	  linkend="makefile-master_sites-github"><varname>USE_GITHUB</varname></link>,
	always put the
	<varname>GH_<replaceable>*</replaceable></varname> variables
	right after it.</para>
    </sect2>

    <sect2 xml:id="porting-samplem-variables">
      <title>Standard <filename>bsd.port.mk</filename> Variables</title>

      <para>This section block is for variables that can be defined in
        <filename>bsd.port.mk</filename> that do not belong in any
        of the previous section blocks.</para>

      <para>Order is not important, however try to keep similar variables together.
        For example uid and gid variables <varname>USERS</varname> and <varname>GROUPS</varname>.
	Configuration variables <varname>CONFIGURE_<replaceable>*</replaceable></varname> and
        <varname><replaceable>*</replaceable>_CONFIGURE</varname>. List of files, and directories
        <varname>PORTDOCS</varname> and <varname>PORTEXAMPLES</varname>.</para>
    </sect2>

    <sect2 xml:id="porting-samplem-options">
      <title>Options</title>

      <para>If the port uses the <link
	  linkend="makefile-options">options framework</link>, define
	<varname>OPTIONS_DEFINE</varname> and
	<varname>OPTIONS_DEFAULT</varname> first, then the other
	<varname>OPTIONS_<replaceable>*</replaceable></varname>
	variables first, then the
	<varname><replaceable>*</replaceable>_DESC</varname>
	descriptions, then the options helpers.  Try and sort all of
	those alphabetically.</para>
    </sect2>

    <sect2 xml:id="porting-samplem-rest">
      <title>The Rest of the Variables</title>

      <para>And then, the rest of the variables that are not
	mentioned in the previous blocks.</para>
    </sect2>

    <sect2 xml:id="porting-samplem-targets">
      <title>The Targets</title>

      <para>After all the variables are defined, the optional
	&man.make.1; targets can be defined.  Keep
	<literal>pre-<replaceable>*</replaceable></literal> before
	<literal>post-<replaceable>*</replaceable></literal> and in
	the same order as the different stages run:</para>

      <itemizedlist>
	<listitem>
	  <para><varname>fetch</varname></para>
	</listitem>

	<listitem>
	  <para><varname>extract</varname></para>
	</listitem>

	<listitem>
	  <para><varname>patch</varname></para>
	</listitem>

	<listitem>
	  <para><varname>configure</varname></para>
	</listitem>

	<listitem>
	  <para><varname>build</varname></para>
	</listitem>

	<listitem>
	  <para><varname>install</varname></para>
	</listitem>

	<listitem>
	  <para><varname>test</varname></para>
	</listitem>
      </itemizedlist>
    </sect2>
  </sect1>
</chapter>

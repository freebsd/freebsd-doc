<!--
     The FreeBSD Mongolian Documentation Project

     Original revision 1.35

     $FreeBSD$
-->

<!-- Need more documentation on praudit, auditreduce, etc.  Plus more info
on the triggers from the kernel (log rotation, out of space, etc).
And the /dev/audit special file if we choose to support that.  Could use
some coverage of integrating MAC with Event auditing and perhaps discussion
on how some companies or organizations handle auditing and auditing
requirements. -->

<chapter id="audit">
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Том</firstname>
	<surname>Рөүдс</surname>
	<contrib>Бичсэн </contrib>
      </author>
      <author>
	<firstname>Роберт</firstname>
	<surname>Ватсон</surname>
      </author>
    </authorgroup>
    <authorgroup>
      <author>
	<firstname>Цагаанхүүгийн</firstname>
	<surname>Ганболд</surname>
	<contrib>Орчуулсан  </contrib>
 	<!-- Nov 2006 -->
      </author>
    </authorgroup>
  </chapterinfo>

  <title>Аюулгүй байдлын үйл явцад аудит хийх нь </title>

  <sect1 id="audit-synopsis">
    <title>Ерөнхий агуулга</title>

    <indexterm><primary>АУДИТ</primary></indexterm>
    <indexterm>
      <primary>Аюулгүй байдлын үйл явцад аудит хийх нь</primary>
      <see>MAC</see>
    </indexterm>

    <para>&os; үйлдлийн системд нягт-боловсруулсан,
	аюулгүй байдлын үйл явцад аудит хийх дэмжлэг орсон байгаа. Үйл явцад аудит хийх нь
	нэвтрэн оролтууд, тохиргооны өөрчлөлтүүд, болон файл болон сүлжээний хандалт зэрэг
	төрөл бүрийн аюулгүй байдлын холбогдолтой системийн үйл явцуудын хянаж бүртгэсэн бичлэгийг найдвартай, 
	нягт-боловсруулсан, ба тохируулах боломжтойгоор хийх боломжийг бүрдүүлдэг.
	Эдгээр хянаж бүртгэсэн бичлэгүүд нь системийг шууд хянах, халдлага илрүүлэх, болон халдлагын 
	дараах анализ хийхэд үнэлж баршгүй байж болох юм. &os; &sun;-ий гаргасан 
	<acronym>BSM</acronym> API болон файлын хэлбэрийг шийдлээ болгосон бөгөөд 
	&sun;-ий Solaris болон &apple;-ийн &macos; X-ийн аудит шийдлүүдтэй харилцан  
	ажиллах боломжтой.</para>

    <para>Энэ бүлэг нь үйл явцыг аудит хийхийг тохируулах болон суулгах тал дээр анхаарна.
	Энд аудитийн бодлогуудын талаар тайлбарлах бөгөөд аудитийн тохиргооны жишээг бас 
	харж болно.</para>

    <para>Энэ бүлгийг уншсаны дараа, та дараах зүйлсийг мэдэх болно:</para>

    <itemizedlist>
      <listitem>
        <para>Үйл явцыг аудит хийх гэж юу вэ болон яаж ажилладаг талаар.</para>
      </listitem>

      <listitem>
	<para>Хэрэглэгчид болон процессуудын үйл явцыг аудит хийхийг &os; дээр яаж 
                          тохируулах талаар.</para>
      </listitem>

      <listitem>
	<para>Аудитийн мөрийг аудит багасгах болон хянах хэрэгслүүдээр хэрхэн шалгах талаар.</para>
      </listitem>
    </itemizedlist>

    <para>Энэ бүлгийг уншихаасаа өмнө, та дараах зүйлсийг мэдэх шаардлагатай:</para>

    <itemizedlist>
      <listitem>
	<para>&unix; болон &os;-ийн үндсийг ойлгох
	  (<xref linkend="basics">).</para>
      </listitem>

      <listitem>
	<para>Цөмийг тохируулах/хөрвүүлэх үндэстэй танилцах
	  (<xref linkend="kernelconfig">).</para>
      </listitem>

      <listitem>
	<para>Аюулгүй байдлын талаар болон түүний &os; -тэй хэрхэн холбогддог талаар ойлголттой байх
          (<xref linkend="security">).</para>
      </listitem>
    </itemizedlist>

    <warning>
      <para>Аудит хэрэгсэл нь зарим нэг хязгаарлагдмал боломжуудтай бөгөөд тэдгээрээс дурдвал
	бүх аюулгүй байдлын холбогдолтой системийн үйл явцуудыг аудит хийх боломжгүй,
	X11 дээр үндэслэгдсэн дэлгэцийн менежерүүд болон гуравдагч дэмонууд зэрэг 
	зарим нэвтрэх механизмууд хэрэглэгчийн нэвтрэх сессийг аудит хийх тохиргоог буруу
	хийдэг зэрэг болно.</para>
      <para>Аюулгүй байдлын үйл явцыг аудит хийх хэрэгсэл нь системийн ажиллагааны маш 
	дэлгэрэнгүй бичлэгүүдийг үүсгэх чадвартай: нарийвчилсан тохиргоо хийгдсэн завгүй системд 
	мөр бичлэгийн файлын өгөгдөл тохиргооноос хамааран зарим тохиолдолд гигабайтаас ч илүү
	асар их болох боломжтой. Администраторууд их хэмжээний аудит хийх тохиргоотой холбоотой
	дискний хэмжээний шаардлагыг тооцох ёстой. Жишээ нь, аудит бичиж байгаа файлын систем
	дүүрэх нөхцөлд өөр бусад файлын системүүдэд хамааралгүйгээр файлын системийг 
	<filename>/var/audit</filename> модонд зориулах  нь	магадгүй зохимжтой байж 
	болох юм.</para>
    </warning>

  </sect1>

  <sect1 id="audit-inline-glossary">
    <title>Энэ бүлгийн түлхүүр ухагдахуунууд</title>

    <para>Энэ бүлгийг уншихаас өмнө аудиттай холбоотой цөөн түлхүүр ухагдахуунуудыг 
	тайлбарлах шаардлагатай:</para>

    <itemizedlist>
      <listitem>
	<para><emphasis>үйл явц</emphasis>: Аудит хийх боломжтой үйл явц гэдэг нь
	аудит дэд системийн тусламжтайгаар хянаж бүртгэх боломжтой дурын үйл явцыг хэлнэ.
	Аюулгүй байдалтай холбоотой үйл явцуудын жишээнүүдэд файлын үүсгэлт,
	сүлжээний холболтыг босгох, эсвэл хэрэглэгчийн нэвтрэлтийг дурдаж болно.
	Үйл явцууд нь нэг бол жинхэнэ хэрэглэгч хүртэл мөрдөн гаргаж болох 
	<quote>шинж чанарлаг</quote>, эсвэл тэгж болохооргүй 
	<quote>шинж чанарлаг бус </quote> байна. 
	<quote>Шинж чанарлаг бус</quote> үйл явцуудын жишээнүүд гэвэл
	нууц үгийн буруу оролдлогууд гэх мэт нэвтрэн орох процессийн жинхэнэ эсэхийг шалгахаас 
	өмнөх үеийн дурын үйл явцуудыг хэлж болно.</para>
      </listitem>

      <listitem>
        <para><emphasis>ангилал</emphasis>: Үйл явцын ангиллууд гэдэг нь
	холбоотой үйл явцууд бүхий хэсэг бүлгүүдийн нэр  бөгөөд эдгээр нь сонголтын 
	илэрхийллүүдэд хэрэглэгддэг. Энгийн ашиглагддаг үйл явцуудын ангиллуудад 
	<quote>файл үүсгэлт</quote> (fc), <quote>ажиллуулах</quote> (ex) 
	мөн <quote>нэвтрэх_гарах</quote> (lo) зэрэг орно.</para>
      </listitem>

      <listitem>
	<para><emphasis>бичлэг</emphasis>: Бичлэг гэдэг нь аюулгүй байдлын үйл явцыг 
	тайлбарласан аудитийн хянан бүртгэсэн оруулга юм. Бичлэгүүд нь үйл явцын төрлийн бичлэг,
	субьектийн (хэрэглэгч) үйлдэл хийж байгаа тухай мэдээлэл, огноо болон цагийн 
	мэдээлэл, дурын нэмэлт өгөгдлүүд болон обьектуудын мэдээлэл, амжилт эсвэл уналтын
	нөхцөлүүдийг агуулдаг.</para>
      </listitem>

      <listitem>
	<para><emphasis>мөр</emphasis>: Аудитийн мөр буюу хянан бүртгэлийн файл нь
	аюулгүй байдлын үйл явцуудыг тайлбарласан аудит бичлэгүүдийн сериэс тогтоно.
	Ерөнхийдөө мөрүүд нь үйл явцуудын биелж дууссан цагийн дагуу
	он цагийн дарааллаар байрладаг. Зөвхөн жинхэнэ процессууд аудитийн 
	мөрд бичлэг нэмэх эрхтэй байдаг.</para>
      </listitem>

      <listitem>
	<para><emphasis>сонголтын илэрхийлэл</emphasis>: Сонголтын илэрхийлэл нь
	угтваруудын жагсаалт болон үйл явцтай тохирох аудитийн үйл явцын ангиллын нэрсээс
	тогтох мөр юм.</para>
      </listitem>

      <listitem>
	<para><emphasis>урьдчилсан сонголт</emphasis>: Энэ нь 
	администраторын сонирхох боломж бүхий үйл явцууд, сонирхлыг татахгүй байгаа
	үйл явц зэргийг тайлбарласан аудитийн бичлэгүүдийг үүсгэхээс зайлсхийх зорилготойгоор
	ялгасан системийн процесс юм. Урьдчилсан тохиргоо нь аль хэрэглэгчийн хувьд
	үйл явцуудын аль ангиллуудыг таних болон жинхэнэ болон жинхэнэ биш процессуудад 
	хамаарах глобал тохиргоонуудын сонголтын илэрхийллүүдийн серийг ашигладаг.</para>
      </listitem>

      <listitem>
	<para><emphasis>хураангуйлалт</emphasis>: Энэ нь байгаа аудитийн мөрнүүдээс 
	аль бичлэгүүдийг хадгалалт, хэвлэлт болон анализ хийхээр сонгосон процесс юм. 
	Үүний нэгэн адил аудит мөрөөс хэрэггүй аудит бичлэгүүдийг устгах процесс бас хамаарна.
	Хураангуйлалтыг ашиглаад администраторууд аудит өгөгдлийн хадгалалтын бодлогуудыг
	боловсруулах боломжтой юм. Жишээ нь, дэлгэрэнгүй аудитийн мөрнүүд нэг сарын хугацаанд
	хадгалагдаад дараагаар нь тэдгээр мөрнүүдийг архивын зорилгоор зөвхөн нэвтрэлтийн мэдээллийг
	үлдээн багасгаж болох юм.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 id="audit-install">
    <title>Аудит хийх дэмжлэг суулгах нь</title>

    <para>Үйл явцыг Аудит хийх хэрэглэгчийн талбарын дэмжлэг үндсэн &os; 
	үйлдлийн системд орсон байгаа. Үйл явцыг Аудит хийх дэмжлэг 
        анхдагчаар эмхэтгэгдэн орсон боловч яг энэ боломжийг дэмжихийн тулд 
	дараах мөрийг цөмд оруулан хөрвүүлсэн байх шаардлагатай:</para>

    <programlisting>options	AUDIT</programlisting>

    <para><xref linkend="kernelconfig"> -д тайлбарласан ердийн процессийн 
	дагуу цөмийг дахин хөрвүүлж суулгана.</para>

    <para>Аудит идэвхжсэн цөм бүтээгдэж суулгагдаад систем дахин ачаалсны дараа 
	дараах мөрийг &man.rc.conf.5; -д нэмж аудит дэмонг идэвхжүүлнэ:</para>

    <programlisting>auditd_enable="YES"</programlisting>

    <para>Тэгээд системийг дахин ачаалах замаар эсвэл гараар аудит дэмонг
	ажиллуулах замаар аудит дэмжлэгийг эхлүүлэх ёстой:</para>

    <programlisting>/etc/rc.d/auditd start</programlisting>
  </sect1>

  <sect1 id="audit-config">
    <title>Аудитийн тохиргоо</title>

    <para>Аюулгүй байдлын аудитийн тохиргооны бүх файлуудыг 
	<filename class="directory">/etc/security</filename> дотроос олж болно.
	Дараах файлууд аудит дэмон эхлэхээс өмнө байх ёстой:</para>

    <itemizedlist>
      <listitem>
	<para><filename>audit_class</filename> - Аудитийн ангиллуудын
	тодорхойлолтуудыг агуулна.</para>
      </listitem>

      <listitem>
	<para><filename>audit_control</filename> - Анхдагч аудитийн ангиллууд,
	аудитийн хянан бүртгэлтийн эзлэхүүнд үлдээх хамгийн бага дискний зай, хамгийн их 
	аудитийн мөрийн хэмжээ гэх зэрэг аудит дэд системийн шинж чанарыг хянана.</para>
      </listitem>

      <listitem>
	<para><filename>audit_event</filename> - Системийн аудит үйл явцуудын 
	тайлбарууд, нэрс болон үйл явц болгон аль ангилалд хамаарах жагсаалт.</para>
      </listitem>

      <listitem>
	<para><filename>audit_user</filename> - Нэвтрэн орох үеийн глобал анхдагчуудаас 
	бүрдсэн зөвхөн хэрэглэгчид хамааралтай аудитийн шаардлагууд</para>
      </listitem>

      <listitem>
	<para><filename>audit_warn</filename> - Аудитийн бичлэгүүдийн зай хангалтгүй 
	болох эсвэл аудитийн мөрийн файл дахин эргэсэн зэрэг зайлшгүй шаардлагатай тохиолдолд 
	анхааруулах мэдээллүүдийг үүсгэдэг өөрчлөх боломж бүхий <application>auditd</application>-ийн ашигладаг 
	бүрхүүлийн скрипт.</para>
      </listitem>
    </itemizedlist>

    <warning>
      <para>Тохиргоон дахь алдаанууд үйл явцуудын буруу хянан бүртгэлд хүргэж болзошгүй тул 
	аудитийн тохиргооны файлуудыг засварлах болон ажиллагааг хангахдаа заавал 
	болгоомжтой байх шаардлагатай.</para>
    </warning>

    <sect2>
      <title>Үйл явц сонголтын илэрхийллүүд</title>

      <para>Сонголтын илэрхийллүүд нь аль үйл явцуудыг аудит хийх ёстойг тодорхойлох
	аудитийн тохиргооны хэд хэдэн газар ашиглагддаг. Илэрхийллүүд нь тохирох үйл 
	явцын ангиллуудын жагсаалтаас бүрдэх ба эдгээр тус бүр нь тохирох бичлэгүүдийг 
	хүлээн авах ёстой юу эсвэл орхих ёстой юу гэдгийг харуулсан угтвартайгаас 
	гадна оруулга нь амжилттай эсвэл амжилтгүй үйлдлүүдтэй тохирох ёстойг харуулах
	боломж бас байна. Сонголтын илэрхийллүүд нь зүүнээс баруун тийш биелэгддэг 
	бөгөөд хоёр илэрхийллийг нэг дээр нь нөгөөг нь нэмж нийлүүлдэг.</para>

      <para>Дараах жагсаалт нь <filename>audit_class</filename>-д байгаа анхдагч 
	үйл явцын ангиллуудаас тогтоно:</para>

      <itemizedlist>
	<listitem>
	  <para><literal>all</literal> - <emphasis>all</emphasis> - Бүх үйл 
		явцын ангиллуудыг тааруулах(match).</para>
	</listitem>

	<listitem>
	  <para><literal>ad</literal> - <emphasis>administrative</emphasis>
	    - Удирдлагын үйлдлүүд систем дээр бүхэлдээ гүйцэтгэгдэнэ.</para>
	</listitem>

	<listitem>
	  <para><literal>ap</literal> - <emphasis>application</emphasis> -
	    Програмын тодорхойлсон үйлдэл.</para>
	</listitem>

	<listitem>
	  <para><literal>cl</literal> - <emphasis>file close</emphasis> -
		<function>close</function> системийн дуудлагыг аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>ex</literal> - <emphasis>exec</emphasis> - Програмын 
		ажиллагааг аудит хийх. Тушаалын мөрийн нэмэлт өгөгдлүүд болон орчны 
		хувьсагчуудыг <literal>argv</literal> ба <literal>envv</literal>
		параметрүүдийг ашиглан <literal>policy</literal> тохиргоонд
		тохиргоо хийн &man.audit.control.5; -ийн тусламжтайгаар хянадаг.</para>
	</listitem>

	<listitem>
	  <para><literal>fa</literal> - <emphasis>file attribute access</emphasis>
	    - &man.stat.1;, &man.pathconf.2; болон бусад адил үйл явцуудын 
		обьектийн шинж чанаруудад хандсан хандалтыг аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>fc</literal> - <emphasis>file create</emphasis>
	    - Үр дүнд нь файл үүсдэг үйл явцуудыг аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>fd</literal> - <emphasis>file delete</emphasis>
	    - Файлыг устгадаг үйл явцуудыг аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>fm</literal> - <emphasis>file attribute modify</emphasis>
	    - &man.chown.8;, &man.chflags.1;, &man.flock.2; зэрэг
		файлын шинж чанарын өөрчлөлт гарч байгаа үйл явцуудыг аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>fr</literal> - <emphasis>file read</emphasis>
	    - Өгөгдөл уншигдаж байгаа, мөн файлуудыг уншихаар нээсэн зэрэг үйл явцуудыг
		аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>fw</literal> - <emphasis>file write</emphasis> -
		Өгөгдөл бичигдэж байгаа, мөн файлд бичсэн эсвэл файл өөрчлөгдсөн зэрэг үйл
		явцуудыг аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>io</literal> - <emphasis>ioctl</emphasis> - &man.ioctl.2;
		системийн дуудлагын хэрэглээг аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>ip</literal> - <emphasis>ipc</emphasis> - POSIX хоолойнууд
		болон System V <acronym>IPC</acronym> үйлдлүүд зэрэг Процесс-Хоорондох 
		Холбооны төрөл бүрийн хэлбэрүүдийг аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>lo</literal> - <emphasis>login_logout</emphasis> -
		Систем дээр болж байгаа &man.login.1; ба &man.logout.1; 
		үйл явцуудыг аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>na</literal> - <emphasis>non attributable</emphasis> -
		Шинж чанаргүй үйл явцуудыг аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>no</literal> - <emphasis>invalid class</emphasis> -
		Аудит бус үйл явцуудыг тааруулах(match).</para>
	</listitem>

	<listitem>
	  <para><literal>nt</literal> - <emphasis>network</emphasis> -
		&man.connect.2; ба &man.accept.2; зэрэг сүлжээний үйлдлүүдтэй 
		холбоотой үйл явцуудыг аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>ot</literal> - <emphasis>other</emphasis> -
	    Бусад үйл явцуудыг аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>pc</literal> - <emphasis>process</emphasis> -
		&man.exec.3; ба &man.exit.3; зэрэг процессийн үйлдлүүдийг 
		аудит хийх.</para>
	</listitem>

      </itemizedlist>

      <para>Эдгээр аудит үйл явцын ангиллуудыг <filename>audit_class</filename>
	болон <filename>audit_event</filename> тохиргооны файлуудыг өөрчилснөөр
	өөрчилж болно.</para>

      <para>Жагсаалтад байгаа аудитийн ангилал бүр амжилттай/амжилтгүй үйлдлүүдийг
	таарсан эсэхийг болон ангилал ба төрлийн хувьд таарч байгааг нэмж
	байгаа эсвэл устгаж байгааг харуулсан угтвартай байна.</para>

      <itemizedlist>
	<listitem>
	  <para>(none) Үйл явцын амжилттай болон амжилтгүйг аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>+</literal> Энэ ангилал дахь амжилттай үйл явцуудыг
		аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>-</literal> Энэ ангилал дахь амжилтгүй үйл явцуудыг 
		аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>^</literal> Энэ ангилал дахь амжилттай, амжилтгүй
		аль нь ч биш үйл явцуудыг аудит хийх.</para>
	</listitem>

	<listitem>
	  <para><literal>^+</literal> Энэ ангилал дахь амжилттай үйл явцуудыг
		аудит хийхгүй.</para>
	</listitem>

	<listitem>
	  <para><literal>^-</literal> Энэ ангилал дахь амжилтгүй үйл явцуудыг
		аудит хийхгүй.</para>
	</listitem>

      </itemizedlist>

      <para>Дараах сонголтын мөр амжилттай ба амжилтгүй нэвтрэлт/гаралтын үйл явцуудаас 
	гадна зөвхөн амжилттай ажиллуулсныг сонгож байна:</para>

      <programlisting>lo,+ex</programlisting>

    </sect2>

    <sect2>
      <title>Тохиргооны файлууд</title>

      <para>Аудит системийг тохируулахдаа ихэнх тохиолдолд администраторууд зөвхөн хоёр 
	файлыг өөрчлөх хэрэгтэй: <filename>audit_control</filename>
	болон <filename>audit_user</filename>.  Эхнийх нь системийн дагуух
	аудит өмчүүд болон бодлогуудыг хянадаг; хоёр дахь нь хэрэглэгчийн аудитийг нарийн 
	тохируулахад ашиглагддаг.</para>

      <sect3 id="audit-auditcontrol">
        <title> <filename>audit_control</filename> файл</title>

	<para> <filename>audit_control</filename> файл нь аудит дэд системийн хувьд 
	анхдагч утгуудын тоог тодорхойлно. Энэ файлын дотор бид дараах зүйлсийг харна:</para>

	<programlisting>dir:/var/audit
flags:lo
minfree:20
naflags:lo
policy:cnt
filesz:0</programlisting>

	<para> <option>dir</option> тохиргоо нь аудит бүртгэлүүдийг хадгалах нэг болон 
	хэд хэдэн санг заахад хэрэглэгдэнэ. Хэрэв нэгээс их сан байгаа бол бичигдсэн
	дарааллаараа ашиглагдана. Файлын систем дүүрсэн тохиолдолд аудит дэд систем болон 
	бусад дэд системүүд бие биедээ нөлөөлж болзошгүй учир аудит бүртгэлүүдийг тусгайлан 
	зориулсан файлын систем дээр хадгалахаар аудит системийг ихэвчлэн тохируулдаг.</para>

	<para> <option>flags</option> талбар нь системийн дагуух шинж чанар бүхий үйл явцуудад 
	зориулсан анхдагч урьдчилан сонголтын багийг тодорхойлдог. Дээрх жишээн дээр бүх хэрэглэгчийн
	хувьд амжилттай болон амжилтгүй нэвтрэлт  болон гаралтын үйл явцууд аудит хийгдэж байна.</para>

	<para> <option>minfree</option> тохиргоо нь аудит мөр хадгалагдах файлын системийн 
	хувьд хамгийн бага чөлөөт зайны хувийг тодорхойлдог. Энэ тогтоосон хэмжээнээс илүү гарахад
	анхааруулга үүсгэгддэг. Дээрх жишээ хамгийн бага чөлөөт зайг 20 хувиар тогтоожээ.</para>

	<para> <option>naflags</option> тохиргоо нь нэвтрэн оролтын процесс
	болон системийн дэмонууд зэрэг шинж чанаргүй үйл явцуудыг аудит хийх аудитийн ангиллуудыг 
	тодорхойлдог.</para>

	<para> <option>policy</option> тохиргоо нь таслалаар тусгаарлагдсан, аудитийн зан 
	авирын төрөл бүрийн шинж чанарыг хянах бодлогын тугуудын жагсаалтыг тодорхойлдог. Анхдагч 
	<literal>cnt</literal> туг нь аудит амжилтгүй болсон ч гэсэн систем ажиллагаагаа 
	үргэлжлүүлэхийг заадаг (энэ туг зайлшгүй шаардлагатай). Өөр нэг байнга ашиглагддаг туг бол
	<literal>argv</literal> бөгөөд энэ нь &man.execve.2; системийн дуудлагад орж байгаа
	тушаалын мөрийн нэмэлт өгөгдлүүдийг тушаалын ажиллагааг аудит хийхийн хэсэг болох боломж 
	олгодог.</para>

	<para><option>filesz</option> тохиргоо нь мөрийн файл автоматаар төгсөх болон эргэхээс
	өмнөх аудит мөрийн файлын хамгийн их хэмжээг байтаар  тодорхойлдог. Анхдагч утга нь 0 байх ба 
	автоматаар эргүүлэхийг хориглосон байна. Хэрэв хүссэн файлын хэмжээ тэгээс ялгаатай ба 512k -аас
	бага бол түүнийг орхиж бүртгэлийн мэдээлэл үүсгэнэ.</para>
      </sect3>

      <sect3 id="audit-audituser">
	<title> <filename>audit_user</filename> файл</title>

	<para> <filename>audit_user</filename> файл нь зарим нэг хэрэглэгчдэд
	зориулсан аудитийн шаардлагуудыг администраторууд тодорхойлохыг зөвшөөрдөг.
	Мөр болгон хэрэглэгчид зориулсан аудитийг хийхийг хоёр талбараар тохируулдаг: нэг дэх нь
	хэрэглэгчийн хувьд  үргэлж аудит хийх шаардлагатай нэг хэсэг үйл явцуудыг тодорхойлдог 
	<literal>alwaysaudit</literal> талбар ба хоёр дахь нь 
	<literal>neveraudit</literal> талбар бөгөөд хэрэглэгчийн хувьд  хэзээ ч 
	аудит хийх шаардлагагүй нэг хэсэг үйл явцуудыг тодорхойлдог.</para>

	<para>Дараах жишээн дээр <filename>audit_user</filename> файл нь нэвтрэлт/гаралтын
	үйл явцууд, <username>root</username> хэрэглэгчийн амжилттай тушаалын ажиллагаа, файл үүсгэлт ба <username>www</username>
	хэрэглэгчийн амжилттай тушаалын ажиллагааг аудит хийж байна. Хэрэв дээрх жишээ 
	<filename>audit_control</filename> файлтай цуг ашиглагдвал 
	<username>root</username>-ийн <literal>lo</literal> оруулга нь давхардах бөгөөд
	<username>www</username> хэрэглэгчийн нэвтрэлт/гаралтын үйл явцууд бас аудит хийгдэнэ.</para>

	<programlisting>root:lo,+ex:no
www:fc,+ex:no</programlisting>

      </sect3>
    </sect2>
  </sect1>

  <sect1 id="audit-administration">
    <title>Аудит дэд системийг удирдах нь</title>

    <sect2>
      <title>Аудит мөрүүдийг харах нь</title>

      <para>Аудит мөрүүд нь BSM хоёртын хэлбэрээр хадгалагддаг бөгөөд өөрчлөх болон текст
	уруу хөрвүүлэхэд тусгай хэрэгслүүд ашиглах шаардлагатай. &man.praudit.1;
	тушаал нь мөрийн файлуудыг хялбар текст хэлбэрт хөрвүүлдэг; &man.auditreduce.1;
	тушаал нь аудит мөрийн файлыг шинжлэх, архивлах эсвэл хэвлэх зорилгоор багасгахад
	ашиглагддаг. <command>auditreduce</command> нь үйл явцын төрөл, үйл явцын 
	ангилал, үйл явцын хэрэглэгч, огноо эсвэл цаг, файлын зам эсвэл обьектийн үйлдэл үзүүлсэн 
	зэрэг төрөл бүрийн сонголтын параметрүүдийг дэмждэг.</para>

      <para>Жишээ нь <command>praudit</command> хэрэгсэл нь заасан аудит бүртгэлийн бүх агуулгыг
	жирийн текстээр харуулна:</para>

      <screen>&prompt.root; <userinput>praudit /var/audit/AUDITFILE</userinput></screen>

      <para> <filename><replaceable>AUDITFILE</replaceable></filename> нь харуулах аудит бүртгэл юм.</para>

      <para>Аудит мөрүүд нь токенуудаас бүтэх аудит бичлэгүүдийн цувралаас тогтох бөгөөд 
	<command>praudit</command> нь мөр болгонд нэгийг дараалуулан хэвлэнэ.
	Токен бүр аудит бичлэгийн толгойг агуулсан <literal>header</literal>
	эсвэл нэрийн хайлтаас гарсан файлын замыг агуулсан <literal>path</literal>
	зэрэг тусгай төрлийн байна. Дараах жишээ нь <literal>execve</literal>
	үйл явцыг харуулж байна:</para>

      <programlisting>header,133,10,execve(2),0,Mon Sep 25 15:58:03 2006, + 384 msec
exec arg,finger,doug
path,/usr/bin/finger
attribute,555,root,wheel,90,24918,104944
subject,robert,root,wheel,root,wheel,38439,38032,42086,128.232.9.100
return,success,0
trailer,133</programlisting>

      <para>Энэхүү аудит нь амжилттай <literal>execve</literal> дуудлагыг илэрхийлж
	байгаа бөгөөд түүнд <literal>finger doug</literal> тушаал ажиллажээ. Нэмэлт өгөгдлийн токен нь
	цөм уруу бүрхүүлээс гарч боловсруулагдсан тушаалын мөрийг агуулна. <literal>path</literal> буюу замын токен 
	нь цөмийн хайсан ажиллах файлын замыг агуулна. <literal>attribute</literal> буюу шинж чанарын токен 
	нь хоёртын файлыг тайлбарлах ба тухайлбал програм setuid эсэхийг тодорхойлоход 
	ашиглагдах файлын горимыг агуулна. <literal>subject</literal> буюу субьект токен нь субьект процессийг 
	тайлбарлах бөгөөд аудит хэрэглэгчийн ID, идэвхитэй хэрэглэгчийн ID ба бүлгийн ID, 
	жинхэнэ хэрэглэгчийн ID ба бүлгийн ID, процессийн ID, сессийн ID, портын ID болон 
	нэвтрэлтийн хаяг гэсэн дарааллаар хадгална. Аудит хэрэглэгчийн ID ба жинхэнэ хэрэглэгчийн 
	ID нь ялгаатайг анхаарах хэрэгтэй:
	<username>robert</username> гэдэг хэрэглэгч энэ тушаалыг ажиллуулахаасаа өмнө
	<username>root</username> бүртгэл уруу шилжсэн бөгөөд энэ нь эхний шалгуулсан 
	хэрэглэгчийг ашиглан аудит хийгдсэн байна. Төгсгөлд нь <literal>return</literal> буюу буцах токен нь 
	амжилттай ажиллагааг харуулж <literal>trailer</literal> нь бичлэгийг төгсгөнө.</para>

      <para><command>praudit</command> нь бас 
	XML гаралтын хэлбэрийг дэмждэг бөгөөд үүнийг <option>-x</option> нэмэлт өгөгдлийг 
	ашиглан сонгож болдог.</para>

    </sect2>

    <sect2>
      <title>Аудитийн мөрүүдийг багасгах нь</title>

      <para>Аудит бүртгэлүүд нь маш их байж болно, администратор зарим хэрэглэгчтэй холбоотой 
	бичлэгүүд зэрэг хэсэг бичлэгүүдийг ашиглахын тулд шилж сонгохыг магадгүй хүснэ:</para>

      <screen>&prompt.root; <userinput>auditreduce -u trhodes /var/audit/AUDITFILE | praudit</userinput></screen>

      <para>Энэ нь <filename><replaceable>AUDITFILE</replaceable></filename> файлд хадгалагдсан 
	<username>trhodes</username> хэрэглэгчийн бүх аудитийн бичлэгүүдийг сонгож 
	байна.</para>
    </sect2>

    <sect2>
      <title>Аудит хянах эрхүүдийг томилох нь</title>

      <para><groupname>audit</groupname> бүлгийн гишүүд <filename>/var/audit</filename>
	дахь аудит мөрүүдийг унших эрхтэй; анхандаа энэ бүлэг нь хоосон байх бөгөөд тэгэхээр зөвхөн
	<username>root</username> хэрэглэгч аудит мөрүүдийг уншиж чадна. Аудит хянах эрхүүдийг хэрэглэгчдэд
	томилохын тулд хэрэглэгчдийг <groupname>audit</groupname> бүлэгт нэмж болно. Аудитийн 
	бүртгэлийн агуулгыг хянах чадвар нь хэрэглэгчид болон процессуудын үйл хөдлөлийн дотоод уруу 
	нэлээн гүнзгий ханддаг учир аудит хянах эрхүүдийг томилохдоо болгоомжтой хийхийг зөвлөж байна.</para>
    </sect2>

    <sect2>
      <title>Аудит хоолойнуудыг шууд монитор хийх нь</title>

      <para>Аудит хоолойнууд нь төхөөрөмжийн файлын систем дахь клон хийгдсэн псевдо төхөөрөмжүүд 
	бөгөөд програмыг шууд явж байгаа аудит бичлэгийн урсгалд холбох боломж олгоно. Энэ нь голчлон
	халдлага илрүүлэх болон систем монитор хийх програмуудын зохиогчдын сонирхлыг татдаг.
	Гэхдээ администраторуудын хувьд аудитийн хоолойны төхөөрөмж нь аудитийн мөрийн файлын 
	эзэмшил эсвэл үйл явцын урсгалыг зогсоох, бүртгэл эргүүлэх зэрэг асуудлуудтай холбогдолгүйгээр
	шууд монитор хийх эвтэйхэн боломжийг бүрдүүлдэг. Шууд явж байгаа аудитийн үйл явцын урсгалыг 
	хянахдаа дараах тушаалын мөрийг ашиглана:</para>

      <screen>&prompt.root; <userinput>praudit /dev/auditpipe</userinput></screen>

      <para>Анхандаа аудитийн  хоолойны төхөөрөмжийн цэгүүдэд зөвхөн <username>root</username> хэрэглэгч хандах
	эрхтэй байдаг. <groupname>audit</groupname> бүлгийн хэрэглэгчид хандах боломжтой
	болгохын тулд <literal>devfs</literal> дүрмийг <filename>devfs.rules</filename> -д
	нэмнэ:</para>

      <programlisting>add path 'auditpipe*' mode 0440 group audit</programlisting>

      <para>devfs файлын системийг тохируулах талаар дэлгэрэнгүй мэдээллийг &man.devfs.rules.5; -ээс 
	харна уу.</para>

      <warning>
	<para>Аудитийн үйл явцын буцааж өгөх давталтуудыг үүсгэх нь хялбар бөгөөд 
	аудит үйл явц бүрийн үзэлт нь олон аудитийн үйл явцуудыг үүсгэхэд хүргэнэ. Жишээ нь,
	хэрэв сүлжээний бүх I/O аудит хийгдсэн бөгөөд &man.praudit.1; нь SSH сессээс ажилласан
	бол үйл явц бүр хэвлэгдэхэд өөр үйл явцыг бас үүсгэх учраас үргэлжилсэн аудитийн үйл 
	явцууд их хэмжээгээр үүсэх болно. Энэ асуудлыг бий болгохгүйн тулд нарийн тохируулаагүй 
	I/O аудит хийх сессээс <command>praudit</command>-ийг аудитийн хоолойны төхөөрөмж дээр ажиллуулахыг
	зөвлөж байна.</para>
      </warning>
    </sect2>

    <sect2>
      <title>Аудит мөрийн файлуудыг эргүүлэх нь</title>

      <para>Аудит мөрүүд нь зөвхөн цөмөөр бичигдэх бөгөөд <application>auditd</application>
	аудит дэмоноор удирдагддаг. Администраторууд аудит бүртгэлүүдийг шууд эргүүлэхдээ
	&man.newsyslog.conf.5; эсвэл бусад хэрэгслүүдийг ашиглан хийх ёсгүй юм. Харин
	<command>audit</command> удирдах хэрэгслийг ашиглан аудитийг унтраах, 
	аудит системийг дахин тохируулах, болон бүртгэлийг эргүүлэх үйлдлүүдийг хийх боломжтой
	байдаг. Дараах тушаал аудит дэмонг шинэ аудит бүртгэл үүсгэж цөмийг шинэ бүртгэл 
	уруу шилжихийг дохино. Хуучин бүртгэл нь төгсөж нэр нь өөрчлөгдөх бөгөөд дараагаар түүнтэй
	администратор ажиллах боломж бүрдэнэ.</para>

      <screen>&prompt.root; <userinput>audit -n</userinput></screen>

      <warning>
	<para>Хэрэв <application>auditd</application> дэмон ажиллахгүй байгаа бол энэ тушаал
	нь амжилтгүй болох бөгөөд алдааны мэдээлэл үүсгэнэ.</para>
      </warning>

      <para>Дараах мөрийг <filename>/etc/crontab</filename> -д нэмснээр 
	&man.cron.8; -оос арван хоёр цаг тутам эргүүлэх болно:</para>

      <programlisting>0     */12       *       *       *       root    /usr/sbin/audit -n</programlisting>

      <para>Шинэ <filename>/etc/crontab</filename> -ийг хадгалсны дараа өөрчлөлт
	үйлчилж эхлэх болно.</para>

      <para>Файлын хэмжээн дээр тулгуурласан аудитийн мөрийн файлыг автоматаар эргүүлэх нь  
	&man.audit.control.5; дахь <option>filesz</option> тохиргоогоор хийгдэх 
	боломжтой бөгөөд гарын авлагын энэ бүлгийн тохиргооны файлуудын хэсэгт тайлбарласан болно.</para>
    </sect2>

    <sect2>
      <title>Аудит мөрүүдийг шахах нь</title>

      <para>Аудит мөрийн файлууд асар их болох тусам мөрүүдийг аудит дэмоноор хаалгасны
	дараа шахах эсвэл архивлах нь зүйтэй юм. <filename>audit_warn</filename>
	скрипт нь аудитийн мөрүүдийг эргүүлэх үеийн цэвэр төгсгөл зэрэг төрөл бүрийн аудиттай 
	холбоотой үйл явцуудад зориулан өөрчилсөн үйлдлүүдийг гүйцэтгэхэд ашиглагдана.
	Жишээ нь хаагдах үед аудит мөрүүдийг шахах дараах кодыг <filename>audit_warn</filename> 
	скриптэд нэмж болно:</para>

      <programlisting>#
# Compress audit trail files on close.
#
if [ "$1" = closefile ]; then
        gzip -9 $2
fi</programlisting>

      <para>Бусад архивлах идэвхүүдэд мөрийн файлуудыг төв сервер уруу хуулах, хуучин мөрийн 
	файлуудыг устгах эсвэл хэрэггүй бичлэгүүдийг хасч аудит мөрийг багасгах зэрэг орж болно.
	Аудит мөрийн файлууд цэвэрхэн дууссан тохиолдолд скрипт ажиллана, тэгэхээр буруу унтраасны
	дараа дуусаагүй мөрүүд дээр ажиллахгүй.</para>
    </sect2>
  </sect1>
</chapter>

<!--
    The FreeBSD Mongolian Documentation Project

    Original revision 1.21

    $FreeBSD$
-->
<chapter id="jails">
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Матео</firstname>
	<surname>Риондато</surname>
	<contrib>Хувь нэмэр болгон оруулсан </contrib>
      </author>
    </authorgroup>
    <authorgroup>
      <author>
	<firstname>Цагаанхүүгийн</firstname>
	<surname>Ганболд</surname>
	<contrib>Орчуулсан  </contrib>
      </author>
    </authorgroup>
  </chapterinfo>

  <title>Jails буюу Шоронгууд</title>

  <indexterm><primary>шоронгууд</primary></indexterm>

  <sect1 id="jails-synopsis">
    <title>Ерөнхий агуулга</title>

    <para>Энэ бүлэг нь &os;-ийн шоронгууд гэж юу болох, тэдгээрийг хэрхэн ашиглах 
	талаар тайлбарлах болно. Шоронгууд буюу заримдаа <emphasis>chroot орчнууд</emphasis>ын 
	өргөжүүлсэн орлуулалт гэгддэг энэ боломж нь системийн администраторуудад 
	зориулагдсан маш хүчтэй хэрэгсэл боловч тэдгээрийн үндсэн хэрэглээ нь 
	илүү дэвшилтэт хэрэглэгчдэд бас үр ашигтай байдаг.</para>

    <para>Энэ бүлгийг уншсаны дараа, та дараах зүйлсийг мэдэх болно:</para>

    <itemizedlist>
      <listitem>
	<para>Шорон гэж юу болох, &os;-ийн суулгалтуудад ямар зорилгоор 
	ашиглагдаж болох талаар.</para>
      </listitem>

      <listitem>
	<para>Шоронг хэрхэн бүтээх, эхлүүлэх, болон зогсоох талаар.</para>
      </listitem>

      <listitem>
	<para>Шоронгийн гадна болон дотор талаас хийгдэж болох 
		удирдлагын үндсүүд.</para>
      </listitem>
    </itemizedlist>

    <para>Шоронгийн тухай ашигтай мэдээллийн өөр бусад эхүүдийг дурдвал:</para>

    <itemizedlist>
      <listitem>
	<para>&man.jail.8; гарын авлагын хуудас. Энэ нь <command>jail</command> 
	хэрэгслийн бүрэн гүйцэд авлага юм &mdash; <command>jail</command> нь  &os; 
	дээр &os; шоронгуудыг эхлүүлэх, зогсоох, болон хянахад ашиглагдаж болох 
	удирдлагын хэрэгсэл юм.</para>
      </listitem>

      <listitem>
	<para>Захидлын жагсаалтууд болон тэдгээрийн архивууд. &a.questions; 
	болон бусад захидлын жагсаалтуудын архивууд нь &a.mailman.lists; дээр 
	байрладаг бөгөөд шоронгуудын талаар маш баялаг материалуудыг агуулсан байдаг. 
	Архивуудаас хайх юм уу эсвэл &a.questions.name; захидлын жагсаалт уруу 
	шинэ асуултаа илгээх нь үргэлж сонирхолтой байдаг.</para>
      </listitem>
    </itemizedlist>

  </sect1>

  <sect1 id="jails-terms">
    <title>Шоронгуудтай холбоотой ойлголтууд</title>

    <para>Шоронгуудтай холбоотой &os; системийн хэсгүүд, тэдгээрийн дотоод хэсгүүд болон 
	&os;-ийн бусад хэсэгтэй хэрхэн харилцдаг арга замыг илүүтэй ойлгохыг хөнгөвчлөхийн тулд 
	энэ бүлэгт дараах ойлголтуудыг ашиглах болно:</para>

    <variablelist>
      <varlistentry>
        <term>&man.chroot.8; (тушаал)</term>
        <listitem>
	  <para>Процесс болон түүний бүх үр удмуудын root санг өөрчилдөг 
		&os;-ийн &man.chroot.2; системийн дуудлагыг ашигладаг хэрэгсэл.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
        <term>&man.chroot.2; (орчин)</term>
        <listitem>
	  <para><quote>chroot</quote>-д ажиллаж байгаа процессуудын орчин. 
		Үүнд харагдаж байгаа файлын системийн хэсэг, байгаа хэрэглэгч болон 
		бүлэг, сүлжээний интерфэйсүүд болон бусад IPC арга замууд гэх 
		мэт эх үүсвэрүүд ордог.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
        <term>&man.jail.8; (тушаал)</term>
        <listitem>
	  <para>Шоронгийн орчин дотор процессуудыг ажиллуулах боломжийг олгох 
		системийн удирдлагын хэрэгсэл.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
        <term>хост (систем, процесс, хэрэглэгч, гэх мэт.)</term>
        <listitem>
	  <para>Шоронгийн системийн хяналтын систем. Хост систем нь байгаа бүх тоног 
		төхөөрөмжийн эх үүсвэрүүдэд хандах боломжтой байдаг бөгөөд 
		шоронгийн орчны болон түүний гаднах процессуудыг хянаж чаддаг. 
		Хост системийн шоронгоос ялгарах нэг чухал ялгаа нь шорон доторх 
		супер хэрэглэгчийн процессуудад хамаарах хязгаарлалтууд  
		хост системийн процессуудын хувьд үйлчилдэггүй явдал юм.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
        <term>хост хийгдсэн (систем, процесс, хэрэглэгч, гэх мэт.)</term>
        <listitem>
	  <para>&os; шоронгоор эх үүсвэрүүдэд ханддаг хандалт нь хязгаарлагддаг 
		процесс, хэрэглэгч эсвэл бусад зүйлс.</para>
	</listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 id="jails-intro">
    <title>Танилцуулга</title>

    <para>Системийн удирдлага нь хэцүү, самууруулмаар ажил болохоор администраторын 
	амьдралыг хялбар болгох үүднээс олон хүчирхэг хэрэгслүүд хийгдэж хөгжүүлэгдсэн 
	байдаг. Эдгээр хэрэгслүүд нь системийг суулгах, тохируулах, болон арчлахад 
	нэгэн төрлийн өргөтгөлүүдийг ихэвчлэн хангаж өгдөг. Администраторуудын 
	хийх ёстой эдгээр ажлуудын нэг хэсэг нь системийн аюулгүй байдлыг зөв тохируулах 
	явдал юм. Ингэснээр аюулгүй байдлын зөрчлүүдгүйгээр систем өөрийн жинхэнэ 
	зорилгоороо үйлчлэх болно.</para>

    <para>&os; системийн аюулгүй байдлыг сайжруулахад ашиглагдаж болох хэрэгслүүдийн 
	нэг нь <emphasis>jails</emphasis> буюу <emphasis>шоронгууд</emphasis> 
	юм. Шоронгуудыг &os;&nbsp;4.X дээр &a.phk; анх танилцуулсан юм. Гэхдээ тэдгээрийг 
	хүчирхэг, уян хатан дэд систем болгохын тулд &os;&nbsp;5.X дээр илүү ихээр сайжруулсан 
	билээ. Тэдгээрийн ашигтай тал, ажиллагаа болон найдвартай байдлыг өргөжүүлэн
	тэдгээрийн хөгжүүлэлт үргэлжилсэн хэвээр болой.</para>

    <sect2 id="jails-what">
      <title>Шорон гэж юу вэ</title>

      <para>BSD-тэй төстэй үйлдлийн системүүд нь 4.2BSD-ийн үеэс эхлэн &man.chroot.2; 
	боломжтой болсон билээ. &man.chroot.8; хэрэгсэл нь процессуудын олонлогийн 
	root санг өөрчлөхөд ашиглагдаж 
	аюулгүй орчин үүсгэн системийн бусад хэсгээс тэдгээрийг тусгаарладаг.
	chroot хийгдсэн орчинд үүсгэгдсэн процессууд нь өөрийн орчноос гаднах файлууд 
	болон эх үүсвэрүүдэд хандаж чаддаггүй. Энэ шалтгаанаар chroot хийгдсэн 
	орчинд ажиллаж байгаа үйлчилгээг эвдэх нь халдагчид бүхэл системийг 
	эвдэх боломжийг олгох ёсгүй юм. &man.chroot.8; хэрэгсэл нь маш их уян хатан 
	чанар эсвэл төвөгтэй, дэвшилтэт боломжуудыг шаарддаггүй хялбар ажлуудад 
	сайн байдаг. Мөн chroot ойлголтын эхлэлээс эхлээд л chroot хийгдсэн орчноос 
	зугтах олон арга замууд олдсон бөгөөд хэдийгээр тэдгээр нь &os; цөмийн 
	орчин үеийн хувилбаруудад засагдсан боловч &man.chroot.2; нь үйлчилгээнүүдийг 
	аюулгүй болгоход зориулагдсан туйлын шийдэл биш нь тодорхой байсан юм.
	Үүнтэй холбоотой шинэ дэд систем хийгдэх шаардлагатай болсон байна.</para>

      <para>Энэ нь <emphasis>шоронгууд</emphasis> яагаад хөгжүүлэгдсэн
	гол шалтгаануудын нэг юм.</para>

      <para>Шоронгууд нь уламжлалт &man.chroot.2; орчны ойлголтуудыг хэд хэдэн 
	аргаар сайжруулдаг. Уламжлалт &man.chroot.2; орчинд процессууд нь 
	өөрийн хандаж болох файлын системийн нэг хэсэгт хязгаарлагдаж байдаг. 
	Системийн бусад эх үүсвэрүүд (системийн хэрэглэгчид, ажиллаж байгаа процессууд, 
	эсвэл сүлжээний дэд систем зэрэг) нь chroot хийгдсэн процессууд болон 
	хост системийн процессуудын хооронд хуваалцан хэрэглэгддэг. Шоронгууд нь 
	зөвхөн файлын систем уруу хандах хандалт биш бас хэрэглэгчид, &os; цөмийн 
	сүлжээний дэд систем болон бусад хэд хэдэн зүйлсүүдийг виртуалчлан энэ загварыг 
	өргөтгөдөг байна. Шорон болгосон орчны хандалтыг тааруулахад зориулсан 
	илүү бүрэн гүйцэд нарийн тааруулсан хяналтуудын олонлог байдаг нь 
	<xref linkend="jails-tuning"> хэсэгт тайлбарлагдсан байгаа.</para>

      <para>Шорон дөрвөн элементээр тодорхойлогддог:</para>

      <itemizedlist>
	<listitem>
	  <para>Сангийн дэд мод &mdash; шоронгийн орж ирдэг эхлэл цэг. 
		Шорон дотор орсны дараа процессийг энэ дэд модноос гадна 
		зугтахыг зөвшөөрдөггүй. Анхдагч &man.chroot.2; дизайныг 
		зовоосон аюулгүй байдлын уламжлалт асуудлууд нь &os; шоронгуудад 
		байдаггүй.</para>
	</listitem>

	<listitem>
	  <para>Хостын нэр &mdash; шорон дотор ашиглагдах хостын нэр. Шоронгууд нь 
		сүлжээний үйлчилгээнүүдийг хост хийхэд (байрлуулах) ихэвчлэн ашиглагддаг 
		болохоор шорон бүрийн хувьд тодорхойлсон нэртэй байх нь системийн администраторт 
		ихээхэн тус болж чадах юм.</para>
	</listitem>

	<listitem>
	  <para><acronym>IP</acronym> хаяг &mdash; энэ нь шорон бүрт өгөгдөх 
		бөгөөд шоронгийн оршин тогтнох хугацаанд ямар ч талаараа өөрчлөгдөх 
		ёсгүй. Шоронгийн IP хаяг нь ихэвчлэн байгаа сүлжээний интерфэйсийн alias хаяг 
		байх боловч заавал тийм байх шаардлагагүй юм.</para>
	</listitem>

	<listitem>
	  <para>Тушаал &mdash; шорон дотор ажиллах програм/тушаалын зам. 
		Энэ нь шоронгийн орчны root сантай харьцангуй байх бөгөөд 
		шоронгийн тусгай очны төрлөөс хамаараад асар өөр өөр байж болох 
		юм.</para>
	</listitem>
      </itemizedlist>

      <para>Эдгээрээс гадна шоронгууд нь өөрийн гэсэн хэрэглэгчид болон өөрийн 
	<username>root</username> хэрэглэгчтэй байж болдог. Мэдээжийн хэрэг 
	<username>root</username> хэрэглэгчийн хүч чадал шоронгийн орчин дотор 
	хязгаарлагддаг бөгөөд хост системийн үүднээс авч үзвэл шоронгийн <username>root</username> 
	хэрэглэгч нь бүхнийг чадагч хэрэглэгч биш юм. Мөн шоронгийн <username>root</username> 
	хэрэглэгчид өөрийнх нь харгалзах &man.jail.8; орчноос гадна осолтой үйлдлүүдийг 
	систем дээр хийлгэхийг зөвшөөрдөггүй. <username>root</username> хэрэглэгчийн 
	боломжууд болон хязгаарлалтуудын тухай дэлгэрэнгүй мэдээллийг <xref
	  linkend="jails-tuning"> хэсэгт доор хэлэлцэх болно.</para>
    </sect2>
  </sect1>

  <sect1 id="jails-build">
    <title>Шоронг үүсгэж хянах нь</title>

    <para>Зарим администраторууд шоронг дараах хоёр төрөлд хуваадаг: эдгээр нь
	жинхэнэ &os; системтэй адил төстэй <quote>бүрэн</quote> шоронгууд болон 
	нэг програм юм уу эсвэл үйлчилгээнд зориулагдсан, магадгүй зөвшөөрлүүдтэй ажиллах 
	<quote>үйлчилгээ</quote> шоронгууд юм. Энэ нь зөвхөн ухагдахууны хуваагдал 
	бөгөөд шоронг бүтээх процесс үүнд хамаагүй юм. &man.jail.8; гарын авлагын 
	хуудас шоронг бүтээх аргачлалын талаар маш тодорхой зааварласан буй:</para>

      <screen>&prompt.root; <userinput>setenv D <replaceable>/here/is/the/jail</replaceable></userinput>
&prompt.root; <userinput>mkdir -p $D</userinput> <co id="jailpath">
&prompt.root; <userinput>cd /usr/src</userinput>
&prompt.root; <userinput>make buildworld</userinput> <co id="jailbuildworld">
&prompt.root; <userinput>make installworld DESTDIR=$D</userinput> <co id="jailinstallworld">
&prompt.root; <userinput>make distribution DESTDIR=$D</userinput> <co id="jaildistrib">
&prompt.root; <userinput>mount -t devfs devfs $D/dev</userinput> <co id="jaildevfs"></screen>

    <calloutlist>
      <callout arearefs="jailpath">
	<para>Шоронгийн байрлалыг сонгох нь хамгийн шилдэг эхлэх цэг юм. 
	Энэ нь шорон физикээр өөрийн хостын файлын систем дотор байрлах байрлал юм. Сайн сонголт нь 
	<filename
	    class="directory">/usr/jail/<replaceable>jailname</replaceable></filename> 
	байж болох бөгөөд энд байгаа <replaceable>jailname</replaceable> нь 
	шоронг таниулж байгаа хостын нэр юм. <filename
	    class="directory">/usr/</filename> файлын систем нь 
	шоронгийн файлын системийн хувьд ихэвчлэн хангалттай зайтай байдаг. 
	Үндсэндээ  <quote>бүрэн</quote> шоронгуудын хувьд энэ шоронгийн 
	файлын систем нь үндсэн &os; системийн андагч 
	суулгацад байдаг бүх файлуудын хуулбар байдаг.</para>
      </callout>

      <callout arearefs="jailbuildworld">
        <para>Хэрэв та өөрийн хэрэглэгчийн талбарыг 
          <command>make world</command> эсвэл <command>make buildworld</command> тушаалаар 
	  аль хэдийн бүтээсэн бол та энэ алхмыг алгасаж өөрийн хэрэглэгчийн талбарыг шинэ 
	  шорон руу суулгаж болно.</para>
      </callout>

      <callout arearefs="jailinstallworld">	
	<para>Энэ тушаал нь шоронгийн физик байрлал болгон сонгосон сангийн дэд модыг 
	файлын систем дээр шаардлагатай хоёртын файлууд, сангууд, гарын авлагын 
	хуудаснууд гэх зэргүүдийг тараан байрлуулах болно.</para>
      </callout>

      <callout arearefs="jaildistrib">
	<para><application>make</application> тушаалд зориулагдсан 
	<maketarget>distribution</maketarget> тохируулга нь бүх шаардлагатай 
	тохиргооны файлыг суулгана, өөрөөр хэлбэл энэ нь 
	<filename class="directory">/usr/src/etc/</filename> сангийн 
	бүх суулгаж болох файлуудыг шоронгийн орчны 
	<filename class="directory">/etc</filename> сан болох 
	<filename class="directory">$D/etc/</filename> руу хуулдаг.</para>
      </callout>

      <callout arearefs="jaildevfs">
	<para>Шорон дотор &man.devfs.8; файлын системийг холбох шаардлагагүй. 
	Нөгөө талаас авч үзвэл дурын, бараг бүх програм өөрийн зорилгоосоо хамааран 
	хамгийн багаар бодоход ядаж ганц төхөөрөмжид хандах шаардлагатай байдаг.
	Шорон дотроос төхөөрөмжид хандах хандалтыг хянах нь маш чухал байдаг. 
	Учир нь буруу тохируулгууд халдагчид шорон дотор муухай зүйлс хийх боломжийг 
	олгож болох юм. &man.devfs.8; дээрх хяналтыг &man.devfs.8; болон 
	&man.devfs.conf.5; гарын авлагын хуудаснуудад тайлбарласан дүрмийн 
	олонлогуудаар удирддаг.</para>
      </callout>
    </calloutlist>

    <para>Шорон суулгагдсаны дараа &man.jail.8; хэрэгсэл ашиглан түүнийг 
	эхлүүлж болно. &man.jail.8; хэрэгсэл дөрвөн зайлшгүй шаардлагатай 
	нэмэлт өгөгдлийг авдаг бөгөөд эдгээр нь <xref
	linkend="jails-what"> хэсэгт тайлбарлагдсан байгаа болно. 
	Өөр бусад нэмэлт өгөгдлүүдийг бас зааж өгч болох бөгөөд өөрөөр хэлбэл 
	шорон хийгдсэн процессийг тухайн нэг хэрэглэгчийн итгэмжлэлүүдтэй ажиллуулж болох юм.
	<option><replaceable>command</replaceable></option>-н нэмэлт өгөгдөл нь 
	шоронгийн төрлөөс хамаарна; <emphasis>виртуал системийн</emphasis> 
	хувьд <filename>/etc/rc</filename> нь боломжийн сонголт байна.
	Энэ нь жинхэнэ &os; системийн эхлүүлэх дарааллыг хуулбарлах учраас тэр 
	юм. <emphasis>Үйлчилгээ</emphasis> шоронгийн хувьд шорон дотор 
	ажиллах үйлчилгээ эсвэл програмаас энэ нь хамаарна.</para>

    <para>Шоронгууд нь ихэвчлэн ачаалах үед эхлүүлэгддэг бөгөөд &os;
      <filename>rc</filename> арга зам нь үүнийг хийх хялбар аргаар 
	хангадаг.</para>

    <procedure>
      <step>
	<para>Ачаалах үед эхлэхээр идэвхжүүлэгдсэн шоронгуудын жагсаалтыг 
	&man.rc.conf.5; файлд нэмэх ёстой:</para>

	<programlisting>jail_enable="YES"   # Set to NO to disable starting of any jails
jail_list="<replaceable>www</replaceable>"     # Space separated list of names of jails</programlisting>

	<note>
          <para><varname>jail_list</varname> хувьсагчид өгөгдсөн байгаа шоронгийн нэрс 
	    зөвхөн үсэг, тооноос бүрдсэн байх ёстой.</para>
        </note>
      </step>

      <step>
	<para>Шорон бүрийг тайлбарласан &man.rc.conf.5; тохируулгуудын бүлэг 
	<varname>jail_list</varname>-д жагсаагдсан шорон бүрийн 
	хувьд доор дурдсаныг нэмэх ёстой:</para>

	<programlisting>jail_<replaceable>www</replaceable>_rootdir="/usr/jail/www"     # jail's root directory
jail_<replaceable>www</replaceable>_hostname="<replaceable>www</replaceable>.example.org"   # jail's hostname
jail_<replaceable>www</replaceable>_ip="192.168.0.10"          # jail's IP address
jail_<replaceable>www</replaceable>_devfs_enable="YES"          # mount devfs in the jail
jail_<replaceable>www</replaceable>_devfs_ruleset="<replaceable>www_ruleset</replaceable>" # devfs ruleset to apply to jail</programlisting>

	<para>&man.rc.conf.5;-д тохируулагдсан шоронгуудын анхдагч 
	эхлүүлэлт нь шоронг бүрэн виртуал систем гэж тооцдог шоронгийн 
	<filename>/etc/rc</filename> скриптийг ажиллуулах болно. Үйлчилгээний 
	шоронгуудын хувьд  
	<varname>jail_<replaceable>jailname</replaceable>_exec_start</varname>
	тохируулгыг зохистойгоор тохируулан шоронгийн анхдагч эхлүүлэх тушаалыг 
	өөрчлөх ёстой.</para>

	<note>
	  <para>Тохируулгуудын бүрэн жагсаалтыг &man.rc.conf.5; гарын 
		авлагын хуудаснаас үзнэ үү.</para>
	</note>
      </step>
    </procedure>

    <para>Шоронд зориулагдсан оруулга <filename>rc.conf</filename> файлд байгаа 
	тохиолдолд <filename>/etc/rc.d/jail</filename> скрипт шоронг гараар эхлүүлэх 
	эсвэл зогсооход ашиглагдаж болох юм:</para>

    <screen>&prompt.root; <userinput>/etc/rc.d/jail start <replaceable>www</replaceable></userinput>
&prompt.root; <userinput>/etc/rc.d/jail stop <replaceable>www</replaceable></userinput></screen>

    <para>Одоогоор &man.jail.8;-г зогсоох цэвэр зам байхгүй байгаа. 
	Цэвэр системийн зогсолтыг хийх тушаалуудыг шорон дотор ашиглах боломжгүй 
	байдаг болохоор тэр юм. Шоронг зогсоох хамгийн шилдэг арга бол 
	дараах тушаалыг шорон дотроос ажиллуулах эсвэл шоронгийн гадна 
	&man.jexec.8; хэрэгслийг ашиглах явдал юм:</para>

    <screen>&prompt.root; <userinput>sh /etc/rc.shutdown</userinput></screen>

    <para>Үүний талаар дэлгэрэнгүй мэдээллийг &man.jail.8; гарын авлагын хуудаснаас 
	олж болно.</para>
  </sect1>

  <sect1 id="jails-tuning">
    <title>Нарийн тааруулалт болон удирдлага</title>

    <para>Аль ч шоронд зориулж тохируулж болох хэд хэдэн тохируулгууд байдаг бөгөөд 
	өндөр түвшний програмуудыг хийхийн тулд хост &os; системийг шоронгуудтай цуг 
	хослуулах төрөл бүрийн аргууд бас байдаг. Энэ хэсэг нь дараах зүйлсийг үзүүлнэ:</para>

    <itemizedlist>
      <listitem>
	<para>Ажиллагаа болон шоронгийн суулгалтаар хийгдсэн аюулгүй байдлын 
	хязгаарлалтуудыг тааруулахад зориулагдсан зарим тохируулгууд.</para>
      </listitem>

      <listitem>
	<para>&os;-ийн портын цуглуулгад байх, шорон дээр суурилсан шийдлүүдийг 
	хийхэд ашиглагдаж болох шорон удирдах зарим нэг өндөр түвшний 
	програмууд.</para>
    </itemizedlist>

    <sect2 id="jails-tuning-utilities">
      <title>&os; дээр шорон тааруулах системийн хэрэгслүүд</title>

      <para>Шоронгийн тохиргооны нарийн сайн тааруулалтыг &man.sysctl.8; 
	хувьсагчуудыг тохируулснаар ихэвчлэн хийдэг. Бүх хамаатай тохируулгуудыг 
	зохион байгуулах үндэс болон sysctl-ийн тусгай дэд мод байдаг: энэ нь 
	&os; цөмийн тохируулгуудын <varname>security.jail.*</varname> шатлал 
	юм. Энд шоронтой холбоотой гол sysctl-уудын жагсаалтыг тэдгээрийн 
	анхдагч утгуудтайгаар харуулав. Нэрс нь өөрийгөө тайлбарласан байгаа, 
	гэхдээ тэдгээрийн талаар илүү мэдээллийг &man.jail.8; болон &man.sysctl.8; 
	гарын авлагын хуудаснуудаас лавлана уу.</para>

      <itemizedlist>
	<listitem>
	  <para><varname>security.jail.set_hostname_allowed:
	     1</varname></para>
	</listitem>

	<listitem>
	  <para><varname>security.jail.socket_unixiproute_only:
	     1</varname></para>
	</listitem>

	<listitem>
	  <para><varname>security.jail.sysvipc_allowed:
	     0</varname></para>
	</listitem>

	<listitem>
	  <para><varname>security.jail.enforce_statfs:
	     2</varname></para>
	</listitem>

	<listitem>
	  <para><varname>security.jail.allow_raw_sockets:
	     0</varname></para>
	</listitem>

	<listitem>
	  <para><varname>security.jail.chflags_allowed:
	    0</varname></para>
	</listitem>

	<listitem>
	  <para><varname>security.jail.jailed: 0</varname></para>
	</listitem>
      </itemizedlist>

      <para><username>root</username> хэрэглэгчид анхдагчаар ноогдуулсан хязгаарлалтуудын 
	заримыг нэмэх эсвэл хасахын тулд эдгээр хувьсагчуудыг <emphasis>хост системийн</emphasis> 
	администратор  ашиглаж болно. Зарим нэг хязгаарлалтуудыг хасаж болохгүйг 
	тэмдэглэе. <username>root</username> хэрэглэгчид &man.jail.8; 
	дотор файлын системүүдийг холбох эсвэл салгахыг зөвшөөрдөггүй. Шорон 
	доторх <username>root</username> хэрэглэгч &man.devfs.8; дүрмийн 
	олонлогуудыг дуудах эсвэл буцааж болиулах, галт ханын дүрмүүдийг тохируулах, 
	эсвэл цөмийн <varname>securelevel</varname> хувьсагчийг тохируулах зэрэг 
	цөм дэх өгөгдлийн өөрчлөлтүүдийг шаарддаг өөр олон бусад удирдлагын 
	ажлуудыг хийж чадахгүй байж болох юм.</para>

      <para>&os;-ийн үндсэн систем нь идэвхтэй шоронгуудын тухай мэдээллийг үзүүлэх болон 
	удирдлагын тушаалуудыг ажиллуулахын тулд шоронд залгагдаж болох хялбар хэрэгслүүдийн 
	цуглуулгыг агуулдаг. &man.jls.8; болон &man.jexec.8; тушаалууд нь &os;-ийн үндсэн системийн 
	хэсэг бөгөөд дараах хялбар ажлуудыг хийж гүйцэтгэхэд ашиглагдаж болно:</para>

      <itemizedlist>
	<listitem>
	  <para>Идэвхтэй байгаа шоронгуудын жагсаалт болон тэдгээрийн харгалзах 
		шорон танигч (<acronym>JID</acronym>), <acronym>IP</acronym> 
		хаяг, хостын нэр болон замыг үзүүлнэ.</para>
	</listitem>

	<listitem>
	  <para>Өөрийнх нь хост системээс ажиллаж байгаа шоронд залгагдаж 
		шорон дотор тушаал ажиллуулах юм уу эсвэл шоронгийн удирдлагын ажлуудыг 
		шорон дотор ажиллуулна. 
		<username>root</username> хэрэглэгч шоронг цэвэрхэн 
		зогсоож унтраахыг хүсэх үед энэ нь ялангуяа ашигтай байдаг. 
		Шорон дотор удирдлага хийхийн тулд түүн дотор бүрхүүл эхлүүлэхэд 
		&man.jexec.8; хэрэгсэл бас ашиглагдаж болдог; жишээ нь:</para>

	  <screen>&prompt.root; <userinput>jexec <replaceable>1</replaceable> tcsh</userinput></screen>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2 id="jails-tuning-admintools">
      <title>&os;-ийн портын цуглуулга дахь өндөр түвшний удирдлагын хэрэгслүүд</title>

    <para>Шорон удирдлагад зориулагдсан гуравдагч талуудын олон хэрэгслүүдийн дундаас 
	хамгийн бүрэн гүйцэд, ашигтай нь <filename
	role="package">sysutils/jailutils</filename> юм. Энэ нь 
	&man.jail.8;-ийн удирдлагад хувь нэмэр болсон жижиг програмуудын цуглуулга
	юм. Дэлгэрэнгүй мэдээллийн талаар түүний вэб хуудсанд хандана уу.</para>
    </sect2>
  </sect1>

  <sect1 id="jails-application">
    <title>Шоронгийн хэрэглээ</title>

    <sect2 id="jails-service-jails">
      <sect2info>
	<authorgroup>
	  <author>
	    <firstname>Даниэл</firstname>
	    <surname>Гэрзо</surname>
	    <contrib>Хувь нэмэр болгон оруулсан </contrib>
	    <!-- 15. May 2007 -->
	  </author>
	</authorgroup>
      </sect2info>

      <title>Үйлчилгээ шоронгууд</title>

      <para>Энэхүү хэсэг нь &a.simon; хөгжүүлэгчийн <ulink
	url="http://simon.nitro.dk/service-jails.html"></ulink> хуудас болон 
	Кен Том <email>locals@gmail.com</email>-ийн бичсэн шинэчилсэн нийтлэл 
	дээр гаргасан санаа дээр тулгуурласан юм. Энэ хэсэг нь 
	&man.jail.8; боломжийг ашиглан аюулгүй байдлын нэмэлт давхарга 
	бүхий &os; систем хэрхэн тохируулах талаар тайлбарлах болно. 
	Өгөгдсөн систем нь ядаж RELENG_6_0 бөгөөд энэ бүлгийн өмнө 
	дурдсан мэдээллийг уншигч авхай сайн ойлгосон гэж тооцдог.</para>

      <sect3 id="jails-service-jails-design">
       <title>Шийдэл</title>

	<para>Шоронгуудын гол асуудлуудын нэг нь тэдгээрийн шинэчлэлтийн
	процессийн удирдлага юм. Шорон бүр нь шинэчлэгдэх болгондоо 
	дахин бүр эхнээсээ бүтээгдэх хэрэгтэй болдог учраас тэр юм. 
	Нэг шоронгийн хувьд энэ нь ихэвчлэн асуудал болдоггүй, 
	шинэчлэлтийн процесс их хялбар байдаг боловч олон шоронгууд 
	үүсгэсэн бол их хугацаа шаардсан, төвөгтэй ажиллагаа байдаг.</para>

	<warning>
	  <para>Энэхүү тохиргоо нь &os;-ийн маш сайн туршлага болон түүний 
		боломжуудын хэрэглээг шаарддаг. Хэрэв доор үзүүлсэн алхмууд нь 
		хэтэрхий төвөгтэй санагдвал &os; шоронгуудыг удирдах илүү хялбар 
		боломжийг олгодог бөгөөд энэ тохиргооных шиг төвөгтэй биш 
		<filename role="package">sysutils/ezjail</filename> зэрэг хялбар системийг 
		үзэхийг зөвлөж байна.</para>
	</warning>

	<para>Гол санаа нь иймэрхүү асуудлуудыг шоронгууд хооронд аль болох 
	ихээр аюулгүй аргаар хуваалцах замаар шийдэх явдал юм &mdash; шинэчлэлт хялбар 
	байхаар зөвхөн уншигдах &man.mount.nullfs.8; холболтуудыг ашиглах болон 
	ганц үйлчилгээнүүдийг тусдаа шоронд хийх нь илүүтэй болох юм. 
	Мөн энэ нь шоронгуудыг нэмэх эсвэл устгах болон тэдгээрийг 
	шинэчлэх хялбар боломжийг олгодог юм.</para>

	<note>
	  <para>Ийм зорилгоор ашиглаж болох үйлчилгээнүүдийг дурдвал: 
		<acronym>HTTP</acronym> сервер, <acronym>DNS</acronym>
	  сервер, <acronym>SMTP</acronym> сервер гэх мэт байж болох юм.</para>
	</note>

	<para>Энэ хэсэгт тайлбарласан тохиргооны зорилгуудыг дурдвал:</para>

	<itemizedlist>
	  <listitem>
	    <para>Шоронгийн хялбар, ойлгоход амархан бүтцийг үүсгэх. 
		Энэ нь шорон бүрийн хувьд болон тэдгээр дээр бүрэн хэмжээний 
		installworld үйлдлийг <emphasis>ажиллуулахгүй</emphasis> 
		байх гэсэн үг юм.</para>
	  </listitem>
	  <listitem>
	    <para>Шинэ шоронгууд нэмэх эсвэл байгааг нь устгах процессийг 
		хялбар болгох.</para>
	  </listitem>
	  <listitem>
	    <para>Байгаа шоронгуудыг шинэчлэх эсвэл сайжруулах процессийг
		хялбар болгох.</para>
	  </listitem>
	  <listitem>
	    <para>Өөрчлөн тохируулсан &os; салбарыг ажиллуулах боломжтой 
		болгох.</para>
	  </listitem>
	  <listitem>
	    <para>Нэвтрэн орох, эвдлэн орох боломжийг аль болох ихээр 
		багасгаж аюулгүй байдлын хувьд паранойд байх.</para>
	  </listitem>
	  <listitem>
	    <para>Зай болон inode-уудыг аль болох ихээр хэмнэх.</para>
	  </listitem>
	</itemizedlist>

	<para>Урьд нь дурдагдсаны адил энэ шийдэл нь 
	шорон бүрт зөвхөн уншигдахаар (<application>nullfs</application> гэгддэг) 
	холбогдох ганц мастер загвар болон шорон бүрийн хувьд нэг уншигдах, 
	бичигдэх төхөөрөмжтэй байх бүтэц дээр үндсэндээ тулгуурласан юм. 
	Төхөөрөмж нь тусдаа физик диск, хуваалт, эсвэл vnode дээр 
	тулгуурласан &man.md.4; төхөөрөмж байж болох юм. Энэ жишээн дээр 
	бид уншигдах, бичигдэх <application>nullfs</application> холболтуудыг 
	ашиглах болно.</para>

	<para>Файлын системийн дүр зураг доор дурдсан хэсэгт тайлбарласан буй:</para>

	<itemizedlist>
	  <listitem>
	    <para>Шорон бүр <filename
	      class="directory">/home/j</filename> сангийн доор холбогдох болно.</para>
	  </listitem>
	  <listitem>
	    <para><filename class="directory">/home/j/mroot</filename> нь 
		шорон бүрийн хувьд загвар ба бүх шоронгуудын хувьд 
		зөвхөн уншигдах хуваалт юм.</para>
	  </listitem>
	  <listitem>
	    <para><filename class="directory">/home/j</filename> сангийн доор 
		шорон бүрийн хувьд хоосон сан үүсгэгдэнэ.</para>
	  </listitem>
	  <listitem>
	    <para>Шорон бүр системийн уншигдах, бичигдэх хэсэг уруу холбогдох 
		<filename class="directory">/s</filename> сантай байна.</para>
	  </listitem>
	  <listitem>
	    <para>Шорон бүр <filename
		class="directory">/home/j/skel</filename> дээр тулгуурласан 
		өөрийн уншигдах, бичигдэх системтэй байх болно.</para>
	  </listitem>
	  <listitem>
	    <para>Шоронгийн талбар бүр (шорон бүрийн уншигдах, бичигдэх хэсэг) 
		<filename
		class="directory">/home/js</filename>-д үүсгэгдэх болно.<para>
	  </listitem>
	</itemizedlist>

	<note>
	  <para>Энэ нь шоронгууд <filename class="directory">/home</filename> 
	хуваалтын доор үндэслэсэн гэж үзнэ. Үүнийг мэдээж өөрчилж болох боловч 
	ингэх тохиолдолд доор дурдсан жишээ бүрийн хувьд өөрчлөгдөх ёстой 
	болно.</para>
	</note>
	<!-- Insert an image or drawing here to illustrate the example. -->
      </sect3>

      <sect3 id="jails-service-jails-template">
	<title>Загвар үүсгэх нь</title>

	<para>Энэ хэсэг нь шоронд зориулагдан ашиглагдах, зөвхөн уншигдах хэсэг болох 
	мастер загварыг үүсгэхэд хэрэгтэй алхмуудыг тайлбарлах болно.<para>

	<para>&os; системийг сүүлийн -RELEASE салбар уруу шинэчлэх нь үргэлж 
	зөв санаа байдаг. Үүнийг хийхийн тулд гарын авлагын 
	<ulink url="&url.books.handbook;/makeworld.html">бүлгээс</ulink> 
	лавлах хэрэгтэй. Шинэчлэл хийх шаардлагагүй бол гүйцэтгэлийг 
	гүйцээхийн тулд buildworld хийх шаардлагатай. Мөн 
	<filename role="package">sysutils/cpdup</filename> багц хэрэгтэй. 
	&os;-ийн портын цуглуулгыг татаж авахдаа бид &man.portsnap.8; 
	хэрэгслийг ашиглах болно. Эхлэн суралцагчид гарын авлагын 
	<ulink url="&url.books.handbook;/portsnap.html">Portsnap бүлгийг</ulink> 
	унших нь зүйтэй юм.</para>

	<procedure>
	  <step>
	    <para>Эхлээд бидний шоронгуудад зориулсан &os;-ийн хоёртын файлуудыг 
		агуулах зөвхөн уншигдах файлын системийн сангийн бүтцийг 
		үүсгэх хэрэгтэй бөгөөд дараа нь &os;-ийн эх модны сан уруу 
		сангаа сольж ороод зөвхөн уншигдах файлын системийг шоронгийн загвар 
		уруу суулгах хэрэгтэй:</para>

	    <screen>&prompt.root; <userinput>mkdir /home/j /home/j/mroot</userinput>
&prompt.root; <userinput>cd /usr/src</userinput>
&prompt.root; <userinput>make installworld DESTDIR=/home/j/mroot</userinput></screen>
	  </step>
	  <step>
	    <para>Дараа нь шоронгуудад зориулж &os;-ийн портын цуглуулга болон 
		<application>mergemaster</application>-т шаардлагатай, &os;-ийн 
		эх модыг бэлдэх хэрэгтэй:</para>

	    <screen>&prompt.root; <userinput>cd /home/j/mroot</userinput>
&prompt.root; <userinput>mkdir usr/ports</userinput>
&prompt.root; <userinput>portsnap -p /home/j/mroot/usr/ports fetch extract</userinput>
&prompt.root; <userinput>cpdup /usr/src /home/j/mroot/usr/src</userinput></screen>
	  </step>
	  <step>
	    <para>Системийн уншигдах, бичигдэх хэсэгт зориулж араг ясыг үүсгэх хэрэгтэй:</para>

	    <screen>&prompt.root; <userinput>mkdir /home/j/skel /home/j/skel/home /home/j/skel/usr-X11R6 /home/j/skel/distfiles</userinput>
&prompt.root; <userinput>mv etc /home/j/skel</userinput>
&prompt.root; <userinput>mv usr/local /home/j/skel/usr-local</userinput>
&prompt.root; <userinput>mv tmp /home/j/skel</userinput>
&prompt.root; <userinput>mv var /home/j/skel</userinput>
&prompt.root; <userinput>mv root /home/j/skel</userinput></screen>
	  </step>
	  <step>
	    <para>Байхгүй байгаа тохиргооны файлуудыг суулгахын тулд 
		<application>mergemaster</application>-г ашиглах хэрэгтэй. 
		Дараа нь <application>mergemaster</application>-ийн үүсгэсэн 
		илүү сангуудыг арилгах хэрэгтэй:</para>

	    <screen>&prompt.root; <userinput>mergemaster -t /home/j/skel/var/tmp/temproot -D /home/j/skel -i</userinput>
&prompt.root; <userinput>cd /home/j/skel</userinput>
&prompt.root; <userinput>rm -R bin boot lib libexec mnt proc rescue sbin sys usr dev</userinput></screen>
	  </step>
	  <step>
	    <para>Одоо уншигдах, бичигдэх файлын системийг зөвхөн уншигдах 
		файлын систем уруу заасан симболын холбоос үүсгэх хэрэгтэй. 
		Симболын холбоосууд нь зөв <filename
		class="directory">s/</filename> байрлалуудад үүсгэгдсэн 
		эсэхийг шалгаарай. Жинхэнэ сангууд юм уу эсвэл сангуудын 
		үүсгэлт буруу байрлалуудад хийгдсэн бол суулгалт амжилтгүй 
		болоход хүргэнэ.</para>

	    <screen>&prompt.root; <userinput>cd /home/j/mroot</userinput>
&prompt.root; <userinput>mkdir s</userinput>
&prompt.root; <userinput>ln -s s/etc etc</userinput>
&prompt.root; <userinput>ln -s s/home home</userinput>
&prompt.root; <userinput>ln -s s/root root</userinput>
&prompt.root; <userinput>ln -s ../s/usr-local usr/local</userinput>
&prompt.root; <userinput>ln -s ../s/usr-X11R6 usr/X11R6</userinput>
&prompt.root; <userinput>ln -s ../../s/distfiles usr/ports/distfiles</userinput>
&prompt.root; <userinput>ln -s s/tmp tmp</userinput>
&prompt.root; <userinput>ln -s s/var var</userinput></screen>
	  </step>
	  <step>
	    <para>Сүүлийн шатанд доор дурдсан агуулга бүхий ерөнхий 
		<filename>/home/j/skel/etc/make.conf</filename> файлыг үүсгэх 
		хэрэгтэй:</para>

	      <programlisting>WRKDIRPREFIX?=  /s/portbuild</programlisting>


	      <para><literal>WRKDIRPREFIX</literal>-г ийм байдлаар тохируулах нь 
		шорон бүрт &os;-ийн портуудыг эмхэтгэх боломжтой болгох юм. 
		Портуудын сан нь зөвхөн уншигдах системийн хэсэг гэдгийг санаарай.
		<literal>WRKDIRPREFIX</literal>-д зориулсан өөр зам нь 
		шорон бүрийн уншигдах, бичигдэх хэсэгт бүтээлтүүдийг хийх боломжийг 
		олгох юм.</para>
	  </step>
	</procedure>
      </sect3>

      <sect3 id="jails-service-jails-creating">
	<title>Шорон үүсгэх нь</title>

	<para>Одоо бид бүрэн гүйцэд &os;-ийн шоронгийн загвартай болсон болохоор 
	<filename>/etc/rc.conf</filename> файлд бид шоронгуудыг суулган тохируулах 
	боломжтой болно. Энэ жишээ нь <quote>NS</quote>,
	  <quote>MAIL</quote> болон <quote>WWW</quote> гэсэн 3 шоронгийн үүсгэлтийг 
	харуулж байна.<para>

	<procedure>
	  <step>
	    <para>Доор дурдсан мөрүүдийг <filename>/etc/fstab</filename> файлд 
		нэмэх хэрэгтэй. Ингэснээр шоронгуудад зориулсан зөвхөн уншигдах 
		загвар болон уншигдах, бичигдэх зай тохирох шоронгуудад ашиглах боломжтой
		болох юм:</para>

	    <programlisting>/home/j/mroot   /home/j/ns     nullfs  ro  0   0
/home/j/mroot   /home/j/mail   nullfs  ro  0   0
/home/j/mroot   /home/j/www    nullfs  ro  0   0
/home/js/ns     /home/j/ns/s   nullfs  rw  0   0
/home/js/mail   /home/j/mail/s nullfs  rw  0   0
/home/js/www    /home/j/www/s  nullfs  rw  0   0</programlisting>
	
	    <note>
	      <para>0 pass буюу өнгөрөх дугаараар тэмдэглэгдсэн хуваалтууд нь 
		ачаалах үед &man.fsck.8; хэрэгслээр шалгагддаггүй бөгөөд 
		0 dump дугаараар тэмдэглэгдсэн хуваалтууд нь &man.dump.8; 
		хэрэгслээр нөөцлөгддөггүй. Бид <application>fsck</application> 
		хэрэгслээр <application>nullfs</application> холболтуудыг шалгах эсвэл 
		<application>dump</application> хэрэгслээр шоронгуудын зөвхөн уншигдах 
		nullfs холболтуудыг нөөцлөхийг хүсэхгүй байгаа билээ. Дээр дурдсан 
		<filename>fstab</filename> оруулга бүрийн сүүлийн хоёр багана 
		<quote>0&nbsp;0</quote> гэж тэмдэглэгдсэн учир нь энэ юм.</para>
	    </note>
	  </step>
	  <step>
	    <para>Шоронгуудыг <filename>/etc/rc.conf</filename>-д тохируулах хэрэгтэй:</para>

	    <programlisting>jail_enable="YES"
jail_set_hostname_allow="NO"
jail_list="ns mail www"
jail_ns_hostname="ns.example.org"
jail_ns_ip="192.168.3.17"
jail_ns_rootdir="/usr/home/j/ns"
jail_ns_devfs_enable="YES"
jail_mail_hostname="mail.example.org"
jail_mail_ip="192.168.3.18"
jail_mail_rootdir="/usr/home/j/mail"
jail_mail_devfs_enable="YES"
jail_www_hostname="www.example.org"
jail_www_ip="62.123.43.14"
jail_www_rootdir="/usr/home/j/www"
jail_www_devfs_enable="YES"</programlisting>

	    <warning>
	      <para><varname>jail_<replaceable>name</replaceable>_rootdir</varname> 
		хувьсагчийн утга <filename class="directory">/home</filename>-ийн 
		оронд <filename class="directory">/usr/home</filename> гэсэн шалтгаан нь 
		&os;-ийн үндсэн суулгац дээр <filename class="directory">/home</filename> 
		сангийн физик зам нь <filename class="directory">/usr/home</filename> 
		гэж байдагт оршиж байгаа юм. 
		<varname>jail_<replaceable>name</replaceable>_rootdir</varname> 
		хувьсагчийн утга симбол холбоос бүхий зам байхаар тохируулагдсан 
		байх <emphasis>ёсгүй</emphasis> бөгөөд хэрэв ингэвэл шоронгууд ажиллаж 
		эхлэхгүй байх болно. Энэ хувьсагчийн утгад тавьж болох утгыг олохдоо 
		&man.realpath.1;-г ашиглах хэрэгтэй. Дэлгэрэнгүй мэдээллийг 
		&os;-SA-07:01.jail Аюулгүй байдлын Зөвлөгөөнөөс үзнэ үү.</para>
	    </warning>
	  </step>
	  <step>
	    <para>Шорон бүрийн зөвхөн уншигдах файлын системд зориулсан, шаардлагатай 
		холбох цэгүүдийг үүсгэнэ:</para>

	    <screen>&prompt.root; <userinput>mkdir /home/j/ns /home/j/mail /home/j/www</userinput></screen>
	  </step>
	  <step>
	    <para>Шорон бүрт уншигдах, бичигдэх загварыг суулгах хэрэгтэй. 
		<filename
		role="package">sysutils/cpdup</filename> хэрэгслийн хэрэглээг 
		энд тэмдэглэх нь зүйтэй юм. Энэ нь сан бүрийн зөв хуулбарыг хийхэд 
		тусалдаг:</para>
	    <!-- keramida: Why is cpdup required here?  Doesn't cpio(1)
	     already include adequate functionality for performing this
	     job *and* have the advantage of being part of the base
	     system of FreeBSD? -->

	    <screen>&prompt.root; <userinput>mkdir /home/js</userinput>
&prompt.root; <userinput>cpdup /home/j/skel /home/js/ns</userinput>
&prompt.root; <userinput>cpdup /home/j/skel /home/js/mail</userinput>
&prompt.root; <userinput>cpdup /home/j/skel /home/js/www</userinput></screen>
	  </step>
	  <step>
	    <para>Энэ үед шоронгууд нь бүтээгдэж ажиллахад бэлтгэгдсэн 
		байна. Эхлээд шорон бүрийн хувьд шаардлагатай файлын 
		системийг холбож дараа нь тэдгээрийг <filename>/etc/rc.d/jail</filename> 
		скрипт ашиглан эхлүүлэх хэрэгтэй:</para>

	    <screen>&prompt.root; <userinput>mount -a</userinput>
&prompt.root; <userinput>/etc/rc.d/jail start</userinput></screen>
	  </step>
	</procedure>

	<para>Шоронгууд нь одоо ажиллаж байх ёстой. Тэдгээрийг зөв 
	эхэлсэн эсэхийг шалгахын тулд &man.jls.8; тушаалыг ашиглана. 
	Үүний гаралт доор дурдсантай төстэй байх ёстой:</para>

	<screen>&prompt.root; <userinput>jls</userinput>
   JID  IP Address      Hostname                      Path
     3  192.168.3.17    ns.example.org                /home/j/ns
     2  192.168.3.18    mail.example.org              /home/j/mail
     1  62.123.43.14    www.example.org               /home/j/www</screen>

	<para>Энэ үед шорон бүр рүү нэвтэрч, шинэ хэрэглэгчид нэмэх эсвэл 
	дэмонуудыг тохируулах боломжтой болсон байх ёстой.
	<literal>JID</literal> багана нь ажиллаж байгаа шорон бүрийн 
	шорон таниулах дугаарыг илэрхийлдэг. <literal>JID</literal> нь 
	3 бүхий шорон дотор удирдлагын ажлуудыг гүйцэтгэхийн тулд 
	дараах тушаалыг ашиглах хэрэгтэй:</para>

	<screen>&prompt.root; <userinput>jexec 3 tcsh</userinput></screen>
      </sect3>

      <sect3 id="jails-service-jails-upgrading">
	<title>Шинэчлэх нь</title>

	<para>Аюулгүй байдлын асуудлаас болоод эсвэл одоо байгаа шоронгуудад 
	ашигтай шинэ боломжууд хийгдсэнээс болоод системээ &os;-ийн шинэ 
	хувилбар уруу шинэчлэх шаардлага заримдаа гардаг. Энэ тохиргооны 
	дизайн нь байгаа шоронгуудыг хялбар аргаар шинэчлэх боломжийг 
	олгодог. Мөн шоронгуудыг сүүлийн минутанд зогсоодог болохоор 
	энэ нь тэдгээрийн зогсох хугацааг багасгадаг. Бас ямар нэг асуудал 
	гарахад энэ нь хуучин хувилбар уруугаа шилжих боломжийг олгодог.</para>

	<procedure>
	  <step>
	    <para>Эхний алхам нь хост системийг журмын дагуу шинэчлэх 
		явдал юм. Дараа шинэ, түр зуурын, зөвхөн уншигдах 
		загварыг <filename
		class="directory">/home/j/mroot2</filename>-д үүсгэх хэрэгтэй.</para>

	    <screen>&prompt.root; <userinput>mkdir /home/j/mroot2</userinput>
&prompt.root; <userinput>cd /usr/src</userinput>
&prompt.root; <userinput>make installworld DESTDIR=/home/j/mroot2</userinput>
&prompt.root; <userinput>cd /home/j/mroot2</userinput>
&prompt.root; <userinput>cpdup /usr/src usr/src</userinput>
&prompt.root; <userinput>mkdir s</userinput></screen>

	    <para><maketarget>installworld</maketarget> ажиллахдаа цөөн хэрэггүй 
		сангуудыг үүсгэдэг бөгөөд эдгээрийг устгах хэрэгтэй:</para>

	    <screen>&prompt.root; <userinput>chflags -R 0 var</userinput>
&prompt.root; <userinput>rm -R etc var root usr/local tmp</userinput></screen>
	  </step>
	  <step>
	    <para>Мастер файлын системд зориулж уншигдах, бичигдэх симболын 
		холбоосуудыг дахин үүсгэх хэрэгтэй:</para>

	    <screen>&prompt.root; <userinput>ln -s s/etc etc</userinput>
&prompt.root; <userinput>ln -s s/root root</userinput>
&prompt.root; <userinput>ln -s s/home home</userinput>
&prompt.root; <userinput>ln -s ../s/usr-local usr/local</userinput>
&prompt.root; <userinput>ln -s ../s/usr-X11R6 usr/X11R6</userinput>
&prompt.root; <userinput>ln -s s/tmp tmp</userinput>
&prompt.root; <userinput>ln -s s/var var</userinput></screen>
	  </step>
	  <step>
	    <para>Шоронгуудыг зогсоох зөв үе нь одоо байна:</para>

	    <screen>&prompt.root; <userinput>/etc/rc.d/jail stop</userinput></screen>
	  </step>
	  <step>
	    <para>Эх файлын системүүдийг салгах хэрэгтэй:</para>
	    <!-- keramida: Shouldn't we suggest a short script-based
	     loop here, instead of tediously copying the same commands
	     multiple times? -->

	    <screen>&prompt.root; <userinput>umount /home/j/ns/s</userinput>
&prompt.root; <userinput>umount /home/j/ns</userinput>
&prompt.root; <userinput>umount /home/j/mail/s</userinput>
&prompt.root; <userinput>umount /home/j/mail</userinput>
&prompt.root; <userinput>umount /home/j/www/s</userinput>
&prompt.root; <userinput>umount /home/j/www</userinput></screen>

	    <note>
	      <para>Уншигдах, бичигдэх системүүд нь зөвхөн уншигдах системд 
		залгагдсан (<filename class="directory">/s</filename>) бөгөөд 
		эхлээд салгагдах ёстой.</para>
	    </note>
	  </step>
	  <step>
	    <para>Хуучин зөвхөн уншигдах файлын системийг шилжүүлж шинээр 
		сольно. Ямар нэг юм болохоо байхад энэ нь хуучин, зөвхөн уншигдах 
		файлын системийн нөөц болон архив маягаар ашиглагдах юм.
		Энд ашиглагдсан нэрлэх аргачлал нь шинэ, зөвхөн уншигдах файлын 
		систем үүсгэгдэх үеийнхтэй тохирдог. Зай болон inode-уудыг хэмнэхийн тулд 
		&os;-ийн эх портын цуглуулгыг шинэ файлын систем уруу шилжүүлэх хэрэгтэй:</para>

	    <screen>&prompt.root; <userinput>cd /home/j</userinput>
&prompt.root; <userinput>mv mroot mroot.20060601</userinput>
&prompt.root; <userinput>mv mroot2 mroot</userinput>
&prompt.root; <userinput>mv mroot.20060601/usr/ports mroot/usr</userinput></screen>
	  </step>
	  <step>
	    <para>Энэ үед шинэ, зөвхөн уншигдах загвар бэлэн болох бөгөөд 
		үлдсэн цорын ганц ажил нь файлын системүүдийг дахин холбож 
		шоронгуудыг эхлүүлэх явдал юм:</para>

	    <screen>&prompt.root; <userinput>mount -a</userinput>
&prompt.root; <userinput>/etc/rc.d/jail start</userinput></screen>
	  </step>
	</procedure>

	<para>Шоронгууд зөв эхэлсэн эсэхийг шалгахын тулд &man.jls.8;-г ашиглана.
	Шорон бүрт mergemaster-г ажиллуулахаа мартуузай. Тохиргооны файлууд болон 
	rc.d скриптүүдийг шинэчлэх хэрэгтэй болно.</para>
      </sect3>
    </sect2>
  </sect1>
</chapter>

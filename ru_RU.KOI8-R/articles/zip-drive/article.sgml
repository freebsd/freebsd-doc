<!--
     The FreeBSD Russian Documentation Project

     $FreeBSD$
     $FreeBSDru: frdp/doc/ru_RU.KOI8-R/articles/zip-drive/article.sgml,v 1.5 2005/10/28 18:00:47 gad Exp $

     Original revision: 1.15
-->

<!DOCTYPE article PUBLIC "-//FreeBSD//DTD DocBook V4.1-Based Extension//EN" [
<!ENTITY % articles.ent PUBLIC "-//FreeBSD//ENTITIES DocBook FreeBSD Articles Entity Set//EN">
%articles.ent;
]>

<article lang="ru">
  <articleinfo>
    <title>Устройства &iomegazip;</title>

    <authorgroup>
      <author>
	<firstname>Jason</firstname>
	<surname>Bacon</surname>
	
	<affiliation>
	  <address><email>acadix@execpc.com</email></address>
	</affiliation>
      </author>
    </authorgroup>

    <legalnotice id="trademarks" role="trademarks">
      &tm-attrib.freebsd;
      &tm-attrib.adaptec;
      &tm-attrib.iomega;
      &tm-attrib.microsoft;
      &tm-attrib.opengroup;
      &tm-attrib.general;
    </legalnotice>

  </articleinfo>

  <sect1>
    <title>Обзор устройств &iomegazip;</title>

    <para>Диски &iomegazip; являются сменными магнитными дисками большой
      емкости, чтение и запись на которые может выполняться устройствами
      ZIP от корпорации IOMEGA.  Диски ZIP похожи на дискеты, кроме
      того, что они работают
      гораздо быстрее, и имеют гораздо большую емкость.  Когда как дискеты
      обычно имеют емкость в 1.44 мегабайта, диски ZIP могут быть двух
      разновидностей, объемами 100 и 250 мегабайт.  Диски ZIP не нужно
      путать с супер-дискетами объемом в 120 мегабайт, привод для которых может
      также работать и с обычными дискетами объемом 1.44 мегабайта.</para>

    <para>IOMEGA продает также более емкое и производительное устройство,
      которое называется &jaz;/JAZZ.  Существуют устройства Jaz емкостью 1 и 2
      гигабайта.</para>

    <para>Устройства ZIP продаются как во внешнем, так и во внутреннем
      исполнении, и используют один из трех интерфейсов:</para>
    
    <orderedlist>
      <listitem>
	<para>Интерфейс SCSI (Small Computer Standard Interface) является самым
          быстрым, сложным, расширяемым и самым дорогим.  Интерфейс SCSI
          применяется во всех типах компьютеров от PC до рабочих станций RISC и
          миникомпьютеров, для подключения разнообразной периферии, такой, как
          дисковые и ленточные накопители, сканеры и так далее.  Устройства ZIP
          с интерфейсом SCSI могут быть во внутреннем и внешнем исполнении, и
          предполагается, что ваш адаптер имеет внешний разъем.</para>

	<note>
	  <para>Если вы используете внешнее устройство SCSI, ни в коем случае
            нельзя подключать или отключать его от шины SCSI при работающем
            компьютере.  В противном случае это может привести к порче файловой
            системы на дисках, которые были подключены.</para>
	</note>
	
	<para>Если вы хотите добиться максимальной производительности и
          простоты установки, то лучше всего использовать интерфейс SCSI.  Это
          может потребовать добавления SCSI-адаптера, так как большинство PC
          (за исключением высокопроизводительных серверов) не имеют встроенной
          поддержки SCSI.  Каждый SCSI-адаптер, в зависимости от модели, может
          поддерживать 7 или 15 устройств SCSI.</para>
	
	<para>Каждое SCSI-устройство имеет собственный контроллер, и эти
          контроллеры весьма сложны и хорошо стандартизованы (вторая буква
          `S' в слове SCSI означает Standard), так что с точки зрения
          операционной системы все диски SCSI выглядят примерно одинаково, то
          же самое касается стримеров SCSI и так далее.  Для поддержки
          устройств SCSI операционной системе нужен драйвер только для
          конкретного адаптера и универсальный драйвер для каждого типа
          устройств, другими словами, драйвер SCSI-диска, драйвер SCSI-стримера
          и так далее.  Если некоторые устройства SCSI, с которыми лучше
          использовать специализированными драйверами (к примеру, стримеры
          DAT), но они будут работать и с универсальным драйвером.  Просто
          универсальный драйвер может не поддерживать некоторых возможностей
          конкретного устройства.</para>
	
	<para>Использование SCSI-устройства ZIP сводится к определению того,
          какой файл устройства в каталоге <filename>/dev</filename>
          соответствует устройству ZIP.  Это может быть выяснено по сообщениям,
          выдающимся при загрузке FreeBSD (после загрузки их можно найти в
          файле <filename>/var/log/messages</filename>), среди которых вы
          увидите такие строчки:</para>
	
	<programlisting>
da1: &lt;IOMEGA ZIP 100 D.13&gt; Removable Direct Access SCSI-2 Device
        </programlisting>

	<para>Это означает, что устройству ZIP соответствует
	  <filename>/dev/da1</filename>.</para>
      </listitem>

      <listitem>
        <para>Интерфейс IDE (Integrated Drive Electronics) является дешевым
          интерфейсом, используемым дисками на многих настольных ПК.
          Большинство IDE-устройств являются только внутренними.</para>

	<para>Производительность устройств ZIP с интерфейсом IDE сравнима со
          SCSI-устройствами ZIP.  (Интерфейс IDE не так быстр, как SCSI, но
          производительность устройств ZIP ограничена в основном механикой
          устройства, а не интерфейсом шины.)</para>
	
	<para>Минусом при использовании интерфейса IDE является его
          ограниченность.  Большинство адаптеров IDE может поддерживать только
          два устройства, и интерфейс IDE не был рассчитан на широкое
          применение.  Например, оригинальный интерфейс IDE не поддерживает
          винчестеры с количеством дорожек, превышающим 1024, что заставляет
          многих необдуманно обновлять аппаратуру.  Если у вас есть планы по
          расширению возможностей вашего ПК добавлением дополнительного диска,
          стримера или сканера, вам стоит задуматься о приобретении
          SCSI-адаптера и устройства ZIP с интерфейсом SCSI во избежание
          проблем в будущем.</para>

	<para>IDE устройства во FreeBSD предваряются буквой
          <literal>a</literal>.  Например, жесткий диск IDE может называться
	  <filename>/dev/ad0</filename>, IDE (ATAPI) привод компакт-дисков
          может называться <filename>/dev/acd1</filename>, и так далее.</para>
      </listitem>

      <listitem>
	<para>Интерфейс параллельного порта популярен для переносимых внешних
          устройств, таких, как внешние устройства ZIP и сканеры, потому что
          практически любой компьютер имеет стандартный параллельный порт
          (обычно используемый для подключения принтера).  Это упрощает жизнь
          тем, кто переносит данные между несколькими компьютерами посредством
          своего ZIP-устройства.</para>

	<para>Как правило, производительность здесь ниже, чем в случае
          ZIP-устройств с интерфейсами SCSI или IDE, так как она ограничена
          скоростью параллельного порта.  Пропускная способность параллельного
          порта значительно различается между разными компьютерами, и зачастую
          может настраиваться в BIOS компьютера.  Некоторым машинам также может
          понадобиться настроить BIOS на работу параллельного порта в
          двунаправленном режиме.  (Параллельные порты изначально были
          предназначены только для вывода на принтеры)</para>
      </listitem>
    </orderedlist>
  </sect1>

  <sect1>
    <title>Устройство ZIP для параллельного порта: Драйвер устройства
      <devicename>vpo</devicename></title>

    <para>Для использования ZIP-устройства с интерфейсом параллельного порта
      во FreeBSD в ядре должно быть присутствовать устройство.  Устройства ZIP
      для параллельного порта имеют встроенный контроллер SCSI.  Драйвер vpo
      позволяет ядру FreeBSD работать со SCSI-контроллером ZIP-устройства через
      параллельный порт.</para>

    <para>Так как драйвер vpo не входит в стандартное ядро (начиная с FreeBSD 
      3.2), то для использования устройства вам необходимо перестроить ядро.
      Процесс построения ядра подробно описан в <ulink url="&url.books.handbook;/kernelconfig.html">Руководстве
      &os;</ulink>.  Ниже приведена краткая последовательность шагов для включения драйвера vpo:</para>

    <orderedlist>
      <listitem>
	<para>Запустите <command>/stand/sysinstall</command> и установите в
          вашей системе исходный код ядра.</para>
      </listitem>

      <listitem>
        <para>Соберите конфигурационный файл ядра с поддержкой драйвера
          для устройства vpo:</para>

	<screen>
&prompt.root; <userinput>cd /sys/i386/conf</userinput>
&prompt.root; <userinput>cp GENERIC MYKERNEL</userinput>
        </screen>

	<para>Отредактируйте файл <filename>MYKERNEL</filename>, изменив строку
	  <literal>ident</literal> на <literal>MYKERNEL</literal> и
          раскомментируйте строчку, описывающую драйвер vpo.</para>
	
	<para>Если у вас имеется второй параллельный порт, вам может
          потребоваться скопировать раздел для <literal>ppc0</literal>, чтобы
          создать устройство <literal>ppc1</literal>.  Второй параллельный
          порт, как правило, использует IRQ 5 и адрес 378.  В конфигурационном
          файле требуется указать только IRQ.</para>

	<para>Если диск с корневой файловой системой является диском с
          интерфейсом SCSI, то вы можете столкнуться с проблемой в
          последовательности обнаружения устройств, что может привести к
          попытке использования ZIP-устройства в качестве диска с корневой
          файловой системой.  Это будет приводить к ошибке загрузки, пока вы не
          поместите корневую файловую систему FreeBSD на ваш ZIP-диск!  Для
          этого вам нужно <quote>зафиксировать</quote> корневой диск, а именно
          заставить ядро ассоциировать выбранное устройство с устройством
          <filename>/dev/da0</filename>, то есть с корневым SCSI-диском.  Затем
          ZIP-диск будет связан со следующим доступным SCSI-диском, например, с
	  <literal>/dev/da1</literal>.  Для того, чтобы привязать ваш SCSI-диск
	  к устройству <literal>da0</literal>, измените строчку

	  <programlisting>device  da0</programlisting>

	  на

	  <programlisting>disk da0 at scbus0 target 0 unit 0</programlisting>
        </para>

	<para>Вам может потребоваться сменить номер устройства (target) выше на
          SCSI ID вашего диска.  Также вам нужно привязать scbus0 к вашему
          контроллеру.  Например, если у вас установлен контроллер &adaptec;
          15xx, вам нужно сменить
	  
	  <programlisting>controller scbus0</programlisting>

	  на

	  <programlisting>controller scbus0 at aha0</programlisting>
        </para>

	<para>И наконец, раз вы редактируете конфигурационный файл ядра, вы
          можете заодно удалить все ненужные драйверы.  Это нужно делать с
          большой осторожностью, и только если вы уверены во вносимых
          изменениях.  Удаление ненужных драйверов уменьшит размер ядра, что
          даст больше памяти для ваших приложений.  Для определения того,
          какие драйверы не нужны, перейдите в конец файла
          <filename>/var/log/messages</filename>, и поищите строчки с
          диагностикой "not found".  Затем закомментируйте эти устройства в
          конфигурационном файле вашего ядра.  Вы можете также изменить другие
          параметры для уменьшения размера и ускорения работы вашего ядра.
          Прочтите раздел о перекомпиляции вашего ядра для получения более
          полной информации.</para>
      </listitem>

      <listitem>
	<para>Теперь пришло время компиляции ядра:</para>

	<screen>
&prompt.root; <userinput>/usr/sbin/config MYKERNEL</userinput>
&prompt.root; <userinput>cd ../../compile/MYKERNEL</userinput>	  
&prompt.root; <userinput>make clean depend && make all install</userinput>
        </screen>
      </listitem>
    </orderedlist>
    
    <para>После того, как ядро будет перестроено, вам нужно выполнить
      перезагрузку.  Перед тем, как это сделать, удостоверьтесь, что
      ZIP-устройство подключено к параллельному порту.  Вы должны увидеть
      ZIP-устройство среди сообщений, выдаваемых при загрузке, как устройство
      vpo0 или vpo1, в зависимости от того, к какому параллельному порту
      оно подключено.  Кроме того, будет указано, к какому файлу устройства
      был привязан ZIP-диск.  Это будет <filename>/dev/da0</filename>, если
      в системе нет других SCSI-дисков, или <filename>/dev/da1</filename> в
      случае, если ваш SCSI-диск зафиксирован в качестве корневого
      устройства.</para>
  </sect1>

  <sect1>
    <title>Монтирование дисков ZIP</title>

    <para>Для работы с ZIP-диском вы должны его смонтировать, точно так же, как
      и любое другое дисковое устройство.  Файловая система на устройстве
      представлена как слайс 4, поэтому для устройств с параллельным или
      SCSI-интерфейсом вам нужно сделать следующее:</para>
    
    <screen>
&prompt.root; <userinput>mount_msdos /dev/da1s4 /mnt</userinput>
    </screen>

    <para>Для устройств ZIP с интерфейсом IDE используйте вот что:</para>
    
    <screen>
&prompt.root; <userinput>mount_msdos /dev/ad1s4 /mnt</userinput>
    </screen>

    <para>Для облегчения монтирования будет полезно также обновить файл
      <filename>/etc/fstab</filename>.  Добавьте строку, соответствующую
      вашей системе, наподобие следующей:
    
      <programlisting>/dev/da1s4  /zip msdos rw,noauto  0 0</programlisting>
    
      и создайте каталог <filename>/zip</filename>.
    </para>
    
    <para>Теперь вы можете монтировать диск просто по команде

      <screen>&prompt.root; <userinput>mount /zip</userinput></screen>

      и выполнять размонтирование по команде

      <screen>&prompt.root; <userinput>umount /zip</userinput></screen>
    </para>

    <para>Более подробная информация о формате файла
      <filename>/etc/fstab</filename> находится в &man.fstab.5;.</para>
    
    <para>Вы можете также создать файловую систему FreeBSD на ZIP-диске при
      помощи &man.newfs.8;.  Однако диск можно будет использовать только в
      системе FreeBSD и, может быть, с еще несколькими клонами &unix;, которые
      распознают файловые системы FreeBSD.  (Определенно этого не могут делать ни
      &ms-dos; ни &windows;.)</para>
  </sect1>
</article>

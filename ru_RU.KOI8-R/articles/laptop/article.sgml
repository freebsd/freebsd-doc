<!--
     The FreeBSD Russian Documentation Project

     $FreeBSDru: frdp/doc/ru_RU.KOI8-R/articles/laptop/article.sgml,v 1.15 2007/05/15 07:58:44 gad Exp $

     Original revision: r29400
-->

<!DOCTYPE article PUBLIC "-//FreeBSD//DTD DocBook V4.1-Based Extension//EN" [
<!ENTITY % articles.ent PUBLIC "-//FreeBSD//ENTITIES DocBook FreeBSD Articles Entity Set//EN">
%articles.ent;
]>

<article lang="ru">
  <articleinfo>
    <title>FreeBSD на лэптопах</title>

    <pubdate>$FreeBSD$</pubdate>
   
    <abstract>
      <para><literal>Перевод на русский язык Виталий Богданов</literal></para>
      <para>FreeBSD, за некоторым исключением, прекрасно работает на
        большинстве лэптопов.  Далее обсуждаются вопросы, специфичные для
        работы FreeBSD на лэптопах, которые касаются аппаратных требований,
        отличающихся от настольных компьютеров.</para>
    </abstract>

    <legalnotice id="trademarks" role="trademarks">
      &tm-attrib.freebsd;
      &tm-attrib.linux;
      &tm-attrib.microsoft;
      &tm-attrib.general;
    </legalnotice>
  </articleinfo>

    <para>FreeBSD часто воспринимается как операционная система для серверов, но
      она прекрасно работает и на настольных компьютерах, а если вы захотите
      использовать ее на вашем лэптопе, то вы получите все обычные преимущества:
      строгое распределение дискового пространства, простота администрирования и
      обновления, система портов/пакаджей для установки программного обеспечения
      и так далее.  (Ее остальные преимущества, такие, как стабильность, высокая
      производительность сетевых операций и производительность при большой
      нагрузке, конечно, могут быть необычными для лэптопа.)  Однако при ее
      установке на лэптопы часто возникают проблемы, которых нет на настольных
      машинах и редко обсуждаются (лэптопы, гораздо чаще, чем настольные машины,
      тонко настроены под &microsoft.windows;).  Эта статья предназначена для
      обсуждения этих проблем.  Есть люди, которые задокументировали свой опыт
      работы с &os; на отдельных моделях лэптопов на web страничках, не являющихся
      частью &os; документации.  Вы наверняка найдете некоторую информацию, если
      воспользуйтесь вашим любимым поисковиком, введя в нём модель лэптопа и слово
      <quote>&os;</quote>.  Дополнительно существует специфичная для &os; база
      данных, цель которой давать информацию по аппаратным вопросам, связанным
      с лэптопами, <ulink url="http://laptop.bsdgroup.de/freebsd/">Список
      лэптопов, совместимых с &os;</ulink>.</para>

    <para>Если вы хотите пообщаться с другими пользователями &os; на лэптопах,
      используйте список рассылки &a.mobile.name;.  Вы также можете получить
      дополнительную информацию о использовании лэптопов во &os; по адресу
      <ulink url="http://tuxmobil.org/mobile_bsd.html"></ulink>.</para>

  <sect1 id="xorg">    
    <title>&xorg;</title>
      
    <para>Последние версии <application>&xorg;</application> работают с большинством графических
      адаптеров, применяемых в лэптопах в настоящее время.  Ускорители могут не
      поддерживаться, но обычная конфигурация для SVGA будет работать.</para>

    <para>Обратитесь к документации по вашему лэптопу для выяснения того, какой
      адаптер используется и к документации по <application>&xorg;</application> для
      определения, поддерживается ли этот адаптер.  Если он не
      поддерживается, используйте стандартное устройство (не пытайтесь
      использовать название, которое просто выглядит похожим).  Вы можете попытать счастья с командой
      <userinput>Xorg -configure</userinput>, которая автоматически
      распознает много конфигураций.</para>

    <para>Часто проблема заключается в настройке монитора.  Доступные источники
      информации по <application>&xorg;</application> посвящены CRT-мониторам, подбор подходящего режима
      работы для LCD-монитора может оказаться не простым занятием.  Вам может
      повезти и вам не придется указывать режим, или будет достаточно указать
      подходящие параметры <literal>HorizSync</literal> и <literal>VertRefresh</literal>.  Если это не сработает,
      лучше всего обратиться к ресурсам Интернет, посвященным настройке X на
      лэптопах (часто это сайты, ориентированны на Linux, но это не имеет
      значения, так как в обеих системах используется <application>&xorg;</application>) и скопировать
      режим, опубликованный кем-то с похожим оборудованием.</para>

    <para>Большинство лэптопов поставляются с двумя кнопками на позиционирующем
      устройстве, что достаточно проблематично в X (так как средняя кнопка
      часто используется для вставки текста); вы можете поставить в
      соответствие одновременное нажатие на левую и правую кнопки в вашей
      конфигурации X нажатию на среднюю кнопку строчкой</para>

      <programlisting>
	Option "Emulate3Buttons"
      </programlisting>

      <para>в файле <filename>xorg.conf</filename> в разделе
	<literal>InputDevice</literal>.</para>
  </sect1> 

  <sect1 id="modems"> 
    <title>Модемы</title>

    <para>Лэптопы обычно поставляются со встроенными (интегрированными на
      плате) модемами.  К сожалению, это практически всегда означает, что это
      <quote>winmodem</quote>ы, функциональность которых реализована программно, и для них
      обычно имеются драйверы только для &windows; (хотя начали появляться
      некоторые драйверы и для других операционных систем; например, если у вашего
      модема Lucent LT чипсет, то он будет поддерживаться портом
      <filename role="package">comms/ltmdm</filename>).  Если это ваш случай вам нужно
      приобрести внешний модем; самым компактным решением, наверное, является
      модем стандарта PC Card (PCMCIA), что обсуждается ниже, но модемы с
      последовательным интерфейсом или интерфейсом USB могут оказаться дешевле.
      В общем, обычные (не-winmodem) модемы должны работать нормально.</para>
  </sect1> 

  <sect1 id="pcmcia"> 
    <title>Устройства PCMCIA (PC Card)</title>

    <para>Большинство лэптопов поставляются с разъемами PCMCIA (также
      называемые PC Card); они прекрасно поддерживаются во FreeBSD.
      Просмотрите (при помощи &man.dmesg.8;) сообщения, выдаваемые при загрузке, и
      определите, были ли они правильно распознаны (слоты должны распознаваться
      как <devicename>pccard0</devicename>, <devicename>pccard1</devicename> и
      так далее на устройствах типа <devicename>pcic0</devicename>).</para>

    <para>&os;&nbsp;4.X поддерживает 16-разрядные карты PCMCIA, а &os;&nbsp;5.X
      поддерживает как 16-разрядные, так и 32-разрядные (<quote>CardBus</quote>).
      База данных поддерживаемых карт находится в файле <filename>/etc/defaults/pccard.conf</filename>.
      Просмотрите его, и при покупке старайтесь выбрать карты, перечисленные
      здесь.  Карты, не указанные здесь, могут также работать как <quote>стандартные</quote>
      устройства: в частности, большинство модемов (16-битных) должны работать
      нормально, при условии, что это не win-модем (они существуют и в варианте
      PC-карт(PC Cards), так что будьте внимательны).  Если ваша карта распознается как
      обычный модем, заметьте, что по умолчанию в файле <filename>pccard.conf</filename> задана
      пауза в 10 секунд (во избежание зависания некоторых модемов); это может
      оказаться излишним для вашего модема, так что вы можете изменить это
      значение, уменьшим его или убрав совсем.</para>

    <para>Некоторые разделы <filename>pccard.conf</filename> могут потребовать редактирования.
      Проверьте строчку с irq и обязательно удалите любые значения, которые
      уже используются: в частности, если у вас есть встроенный звуковой
      адаптер, уберите irq 5 (в противном случае вы получите сбой при попытке
      вставить карту).  Проверьте также наличие доступных слотов для памяти;
      если ваша карта не распознана, попробуйте изменить значение на одно из
      других разрешенных (они перечислены на справочной странице
      &man.pccardc.8;).</para>

    <para>Запустите даемон &man.pccardd.8;, если он еще не запущен.  Для запуска его
      при загрузке добавьте в файл <filename>/etc/rc.conf</filename> строчку
      <programlisting>pccard_enable="YES"</programlisting>  Теперь ваши карты
      должны обнаруживаться, когда вы их вставляете и вытаскиваете, и вы должны
      получать диагностические сообщения о появлении новых устройств.</para>

    <para>Перед релизом &os;&nbsp;4.4 в коде pccard произошли большие изменения
      (включая перенаправление прерываний ISA для тех машин, с PCI BIOS которых
      &os; работать не может).  Если у вас возникли проблемы, попробуйте
      обновить вашу систему.</para>
  </sect1> 

  <sect1 id="power-management"> 
    <title>Управление электропитанием</title>

    <para>К сожалению, оно не очень надежно поддерживается во FreeBSD.  Если
      вам повезло, то некоторые функции могут работать нормально; либо они не
      будут работать вовсе.</para>

    <para>Чтобы сделать вещи немножко сложнее, существует два стандарта по
      управлению электропитанием: APM и ACPI, последний заменяет собой первый
      и включает больше возможностей, но также вносит больше проблем.</para>

    <para>Некоторые лэптопы поддерживают и APM и ACPI (в разной степени),
      другие поддерживают только один из них, поэтому возможно вам придётся
      поэкспериментировать с обоими для получения надёжного управления
      питанием на вашем лэптопе.</para>

    <note>
      <para>Вы не можете иметь одновременно включенными APM и ACPI, даже
	если если ваш лэптоп поддерживает и тот и другой стандарты.</para>
    </note>

    <sect2>
      <title>APM</title>

      <para>The APM (Advanced Power Management) BIOS предоставляет
	поддержку различных возможностей по управлению электропитанием,
	таких как ожидание (standby), приостановление (suspend),
	режим пониженного электропотребления (hibernation), замедление
	тактовых импульсов CPU (CPU clock) и так далее, и доступен во
	&os;&nbsp;4.X и &os;&nbsp;5.X.</para>

      <para>Чтобы включить поддержку APM, вы можете скомпилировать
	ядро с поддержкой управления электропитанием
	(<literal>device apm0</literal> во &os;&nbsp;4.X и
	<literal>device apm</literal> во &os;&nbsp;5.X).
	Во &os;&nbsp;5.X имеется модуль ядра для APM.  Чтобы
	загрузить модуль ядра поддержки APM во время загрузки
	добавьте строчку <literal>apm_load="YES"</literal> в
	<filename>/boot/loader.conf</filename>.</para>

      <para>Во &os;&nbsp;5.X, вам также нужно установить
       <literal>hint.apm.0.disabled="0"</literal> в
       <filename>/boot/device.hints</filename>.</para>

      <para>Вы можете запустить APM во время загрузки посредством
	добавления <literal>apm_enable="YES"</literal> в файл
	<filename>/etc/rc.conf</filename>.  Вы возможно также
	захотите запустить даемон &man.apmd.8;, добавив
	<literal>apmd_enable="YES"</literal> в <filename>/etc/rc.conf</filename>,
	который позаботится о различных событиях APM, посылаемых к
	BIOS, так чтобы вы могли иметь на вашем лэптопе
	приостановление/продолжение работы с помощью нажатия некой
	функциональной клавиши на клавиатуре или с помощью
	закрытия/открытия крышки.</para>

      <para>Команды APM перечислены в справочной странице &man.apm.8;.
	К примеру, <command>apm -b</command> выдаёт статус батарей
	(или 255, если не поддерживается), <command>apm -Z</command>
	переводит лэптоп в режим ожидания, <command>apm -z</command> (или
	<command>zzz</command>) приостановит его.  Для выключения и
	отключения машины от питания, воспользуйтесь командой
	<command>shutdown -p</command>.  И снова, некоторые или все эти
	функции могут не работать нормально или не работать вовсе.</para>

      <para>Вы можете обнаружить, что переключение режимов suspension/standby
	лэптопа работает в режиме консоли, но не работает в режиме X
	(то есть экран не восстанавливается); если вы используйте
	&os;&nbsp;5.X, то возможным решением может быть добавление
	<literal>options SC_NO_SUSPEND_VTYSWITCH</literal> в ваш конфигурационный
	файл ядра и перекомпилирование ядра.  Другое решение - это
	переключение на виртуальную консоль (при помощи
        <keycombo
	action="simul"><keycap>Ctrl</keycap><keycap>Alt</keycap><keycap>F1</keycap></keycombo>
	или другой функциональной клавиши) и запуск &man.apm.8;.
	Если вы используйте &man.apmd.8;, вы можете автоматизировать это
	с помощью &man.vidcontrol.1;.  Просто отредактируйте
       <filename>/etc/apmd.conf</filename> и измените его на:</para>

      <programlisting>apm_event SUSPENDREQ {
 exec "vidcontrol -s 1 &lt; /dev/console";
 exec "/etc/rc.suspend";
}

apm_event USERSUSPENDREQ {
 exec "vidcontrol -s 1 &lt; /dev/console";
 exec "sync && sync && sync";
 exec "sleep 1";
 exec "apm -z";
}

apm_event NORMRESUME, STANDBYRESUME {
 exec "/etc/rc.resume";
 exec "vidcontrol -s 9 &lt; /dev/console";
}</programlisting>
    </sect2>

    <sect2>
      <title>ACPI</title>

      <para>ACPI (Advanced Configuration and Power Management
	Interface) предлагает не только управление электропитанием, но и
	платформенное обнаружение оборудования (platform hardware
	discovery) (вытесняющее PnP и PCI BIOS).  ACPI доступен только
	в &os;&nbsp;5.X и включён по умолчанию,
	поэтому вам не нужно ничего специально делать чтобы включить
	его.  Вы можете контролировать поведение ACPI с помощью
	&man.acpiconf.8;.</para>

      <para>К сожалению, поставщики часто поставляют лэптопы
	с некорректной реализацией ACPI, и поэтому наличие включённого
	ACPI иногда вызывает больше проблем, чем приносит пользы,
	вплоть до того, что вы не можете даже загрузить &os; на некоторых
	машинах со включённым ACPI.</para>

      <para>Если ACPI вызывает проблемы, проверьте, не выпустил ли
	поставщик вашего лэптопа новую версию BIOS, устраняющую некоторые
	ошибки.  Так как реализация ACPI в &os; до сих пор быстро
	развивающийся код, вы также можете обновить вашу систему, поэтому
	есть шансы, что ваши проблемы исправлены.</para>

      <para>Если вы хотите отключить ACPI, добавьте
	<literal>hint.acpi.0.disabled="1"</literal> в файл
	<filename>/boot/device.hints</filename>.  Вы можете временно
 	отключить ACPI на стадии загрузчика, набрав команду
	<literal>unset acpi_load</literal>, если у вас имеются проблемы с
	загрузкой машины со включённым ACPI.  &os;&nbsp;5.1-RELEASE и
	последующие релизы содержат загрузочное меню, с помощью которого
	можно контролировать загрузку &os;.  Одна из предлагаемых опций -
	это отключение ACPI.  Итак, чтобы выключить ACPI, просто выберите
	пункт <guimenuitem>2. Boot &os; with ACPI disabled</guimenuitem>
	в меню.</para>
    </sect2>

    <sect2>
      <title>Управление электропитанием дисплея</title>

    <para>X window system (<application>&xorg;</application>) также включает в себя систему управления
      электропитанием дисплея (обратитесь к справочной странице по &man.xset.1;
      и поищите там ключевое слово <quote>dpms</quote>).  Вы можете захотеть
      поэкспериментировать с этой функцией.  Однако это также на лэптопах
      работает нестабильно; часто дисплей выключается не полностью.</para>
  </sect1>
</article>

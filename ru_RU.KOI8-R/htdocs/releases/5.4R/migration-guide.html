<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org" />
<title>Руководство по миграции на FreeBSD 5.4-RELEASE</title>
<meta name="GENERATOR" content="Modular DocBook HTML Stylesheet Version 1.79" />
<link rel="STYLESHEET" type="text/css" href="docbook.css" />
<meta http-equiv="Content-Type" content="text/html; charset=koi8-r" />
</head>
<body class="ARTICLE" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#840084"
alink="#0000FF">
<div class="ARTICLE">
<div class="TITLEPAGE">
<h1 class="TITLE"><a id="AEN2" name="AEN2">Руководство по миграции на FreeBSD
5.4-RELEASE</a></h1>

<div class="AUTHORGROUP"><a id="AEN4" name="AEN4"></a>
<h3 class="CORPAUTHOR">Группа подготовки релизов FreeBSD</h3>
</div>

<p class="COPYRIGHT">Copyright &copy; 2002, 2003, 2004, 2005 Группа подготовки релизов
FreeBSD</p>

<p class="PUBDATE">$FreeBSD: src/release/doc/ru_RU.KOI8-R/early-adopter/article.sgml,v
1.5.2.4 2005/04/01 13:11:04 den Exp $<br />
</p>

<div class="LEGALNOTICE"><a id="TRADEMARKS" name="TRADEMARKS"></a>
<p>FreeBSD это зарегистрированная торговая марка FreeBSD Foundation.</p>

<p>Apple, FireWire, Mac, Macintosh, Mac OS, Quicktime и TrueType это торговые марки Apple
Computer, Inc., зарегистрированные в Соединенных Штатах и других странах.</p>

<p>IBM, AIX, EtherJet, Netfinity, OS/2, PowerPC, PS/2, S/390 и ThinkPad это торговые
марки International Business Machines Corporation в Соединенных Штатах, других странах,
или по всему миру.</p>

<p>IEEE, POSIX и 802 это зарегистрированные торговые марки Institute of Electrical and
Electronics Engineers, Inc. в Соединенных Штатах.</p>

<p>Intel, Celeron, EtherExpress, i386, i486, Itanium, Pentium и Xeon это торговые марки
или зарегистрированные торговые марки Intel Corporation или ее дочерних компаний в
Соединенных Штатах и других странах.</p>

<p>Microsoft, FrontPage, IntelliMouse, MS-DOS, Outlook, Windows, Windows Media и Windows
NT это или зарегистрированные торговые марки или торговые марки Microsoft Corporation в
Соединенных Штатах и/или других странах.</p>

<p>Sparc, Sparc64, SPARCEngine, и UltraSPARC это торговые марки SPARC International, Inc
в Соединенных Штатах и других странах. Продукты с торговой маркой SPARC основаны на
архитектуре, разработанной Sun Microsystems, Inc.</p>

<p>Многие из обозначений, используемые производителями и продавцами для обозначения своих
продуктов, заявляются в качестве торговых марок. Когда такие обозначения появляются в
этом документе, и Проекту FreeBSD известно о торговой марке, к обозначению добавляется
знак ``&trade;'' или ``&reg;''.</p>
</div>

<div>
<div class="ABSTRACT"><a id="AEN24" name="AEN24"></a>
<p>Эта статья описывает основные отличия между FreeBSD 4.<tt
class="REPLACEABLE"><i>X</i></tt> и FreeBSD 5.4-RELEASE с точки зрения пользователей или
администраторов, обновляющих существующую систему. В ней дан краткий обзор процесса
подготовки релизов FreeBSD. Кроме того, описаны некоторые новые возможности FreeBSD 5.<tt
class="REPLACEABLE"><i>X</i></tt>, а также некоторые изменения, которые могут быть
интересны пользователям, привыкшим работать с серией релизов 4.<tt
class="REPLACEABLE"><i>X</i></tt>. Эта статья описывает также процедуры обновления
существующих систем, как бинарного, так и из исходных текстов. Более ранние версии этой
статьи публиковались в предыдущих релизах FreeBSD 5.<tt
class="REPLACEABLE"><i>X</i></tt>. До FreeBSD 5.3-RELEASE эта статья называлась
``Руководство для новых пользователей FreeBSD''.</p>
</div>
</div>

<hr />
</div>

<div class="SECT1">
<h2 class="SECT1"><a id="INTRO" name="INTRO">1. Введение</a></h2>

<p>FreeBSD 5.4-RELEASE это самая свежая версия ``FreeBSD-STABLE''. Этот и последующие
релизы серии 5.<tt class="REPLACEABLE"><i>X</i></tt> предназначены для применения в
реальных задачах практически так же, как и предыдущая серия релизов 4.<tt
class="REPLACEABLE"><i>X</i></tt>.</p>

<p>Эта статья затрагивает многие темы и вопросы, связанные с обновлением 4.<tt
class="REPLACEABLE"><i>X</i></tt> до 5.4-RELEASE. Она начинается с краткого обзора
существующей практики подготовки релизов, а затем описывает некоторые из новых
возможностей, доступных в серии FreeBSD 5.<tt class="REPLACEABLE"><i>X</i></tt>. В
возможно наиболее важном разделе приводятся основные изменения, видимые пользователю, или
изменения во внешних интерфейсах программ. Наконец, приводятся заметки по обновлению
установленной системы FreeBSD 4.<tt class="REPLACEABLE"><i>X</i></tt> до FreeBSD
5.4-RELEASE, бинарному или из исходных текстов.</p>
</div>

<div class="SECT1">
<hr />
<h2 class="SECT1"><a id="RELEASE-OVERVIEW" name="RELEASE-OVERVIEW">2. Обзор процесса
выпуска релизов FreeBSD</a></h2>

<p>FreeBSD использует модель разработки, основанную на наличии множества ветвей в
репозитории исходных текстов. Основная ветвь называется ``CURRENT'', и в репозитории CVS
она означает тег <tt class="LITERAL">HEAD</tt>. Новые возможности сначала вносятся в эту
ветвь; хотя CURRENT первой получает новую функциональность, это также означает, что она
периодически страдает от нарушений работоспособности при добавлении и отладке новых
возможностей.</p>

<p>Большинство релизов FreeBSD выпускаются из одной или нескольких ветвей ``STABLE''. В
эти ветви возможности добавляются только после некоторого тестирования в CURRENT.
Последние два года только одна ветвь STABLE, известная как ``4-STABLE'', находилась в
активной разработке, и все релизы FreeBSD 4.<tt class="REPLACEABLE"><i>X</i></tt> были
выпущены из нее. В репозитории CVS тег этой ветви <tt class="LITERAL">RELENG_4</tt>.</p>

<p>Последние две стабильные ветви (3-STABLE and 4-STABLE) были созданы на самых ранних
стадиях цикла разработки (при выпуске 3.1 и 4.0 соответственно). Эта практика не дает
достаточно времени для стабилизации CURRENT перед созданием новых ветвей. Это приводит к
потере времени на усилия по портированию исправлений между ветвями, а также на внесение
некоторые архитектурных изменений, которые вообще не могут быть портированы между
ветвями.</p>

<p>С релизами 5.<tt class="REPLACEABLE"><i>X</i></tt> произошло несколько иначе. FreeBSD
5.0, 5.1, и 5.2 были основаны на ветви CURRENT. Первый из этих релизов был выпущен после
двух лет разработки (до него последним релизом из HEAD была FreeBSD 4.0 в марте 2000
года).</p>

<p>В отличие от предыдущих ветвей ``STABLE'', ветвь ``5-STABLE'' (с тегом ветви <tt
class="LITERAL">RELENG_5</tt>) была создана в CVS более чем через год после первого
релиза 5.<tt class="REPLACEABLE"><i>X</i></tt> (а именно, в процессе подготовки релиза
5.3). Эта задержка дала команде разработчиков время для завершения необходимых
архитектурных изменений, стабилизацию системы, завершения работы над различными
интерфейсами, и создания хорошей основы для последующих релизов 5.<tt
class="REPLACEABLE"><i>X</i></tt>.</p>

<p>Помимо общих улучшений и исправлений ошибок, основной приоритет для разработки ветви
5-STABLE это сохранение совместимости Application Binary Interface (ABI) и Application
Program Interface (API). Любые изменения, которые могут нарушить обратную совместимость
(включая интерфейсы ядра или библиотек), не приветствуются и не принимаются, за
исключением случаев, когда они необходимы для решения критической проблемы.</p>

<p>Следующим релизом из CURRENT скорее всего станет 6.0-RELEASE, созданный из CVS <tt
class="LITERAL">HEAD</tt>. Еще не существует определенной даты для 6.0, но на момент
написания этого текста ожидаемая дата находится в третьем квартале 2005 года. В
дальнейшем планируется начинать выпуск релизов из основной ветви каждые восемнадцать
месяцев, при этом выпуская обычные релизы каждые четыре месяца.</p>

<p>Последним запланированным релизом из ветви разработки 4-STABLE стал 4.11-RELEASE,
анонс которого состоялся в январе 2005 года. На данный момент больше не планируется
выпуск релизов из ветви 4-STABLE, и вся дальнейшая работа будет ограничена исправлением
ошибок и проблем с безопасностью. Для особо консервативных пользователей возможно имеет
смысл продолжить использование релизов 4.<tt class="REPLACEABLE"><i>X</i></tt> еще
некоторое время. Группа Офицеров Безопасности <code class="EMAIL">&#60;<a
href="mailto:security-officer@FreeBSD.org">security-officer@FreeBSD.org</a>&#62;</code>
продолжит поддержку релизов, выпущенных из ветви 4-STABLE в соответствии с
опубликованными политиками, которые можно найти на <a
href="http://www.FreeBSD.org/ru/security/index.html" target="_top">странице
безопасности</a> веб сайта FreeBSD.</p>

<p>Дополнительную информацию по процессу создания релизов FreeBSD можно найти на <a
href="http://www.FreeBSD.org/releng/index.html" target="_top">веб страницы выпуска
релизов</a> и в статье <a
href="http://www.FreeBSD.org/doc/ru_RU.KOI8-R/articles/releng/index.html"
target="_top">``Выпуск релизов FreeBSD''</a>.</p>
</div>

<div class="SECT1">
<hr />
<h2 class="SECT1"><a id="NEW" name="NEW">3. Новые возможности</a></h2>

<p>FreeBSD 5.<tt class="REPLACEABLE"><i>X</i></tt> привлекает большим количеством новых
возможностей, которые обычно вызывают серьезные архитектурные изменения, которые не могут
быть портированы обратно в ветвь разработки FreeBSD 4-STABLE (напротив, множество
автономных расширений, таких как новые драйвера устройств или обновления утилит
пользователя, уже были портированы). Краткий, но не исчерпывающий список включает:</p>

<ul>
<li>
<p>SMPng: ``Новое поколение'' поддержки Symmetric MultiProcessor (SMP) компьютеров.
Продолжается работа над ``fine-grained locking'' различных подсистем ядра для увеличения
количества потоков выполнения, которые могут работать в ядре. Особое внимание было
уделено производительности сетевого стека и устройств хранения. Дополнительную информацию
можно найти на странице <a href="http://www.FreeBSD.org/smp/index.html"
target="_top">FreeBSD SMP проекта</a>.</p>
</li>

<li>
<p>KSE: Kernel Scheduled Entities позволяют одному процессу иметь несколько потоков
уровня ядра, подобно Scheduler Activations. Библиотеки потоков <tt
class="FILENAME">libpthread</tt> и <tt class="FILENAME">libthr</tt> делают эти
возможности доступными многопоточным программам пользователя через API <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=pthread&sektion=3&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">pthread</span>(3)</span></a>. <tt
class="FILENAME">libpthread</tt> теперь является библиотекой потоков по умолчанию.</p>
</li>

<li>
<p>Новые архитектуры: Поддержка архитектур amd64, ia64, pc98 и sparc64 в дополнение к
i386 и alpha. Другие платформы, включая powerpc (которая работает на многих <span
class="TRADEMARK">PowerPC</span>&reg; <span class="TRADEMARK">Macintosh</span>&reg;) и
arm, находятся в разработке.</p>
</li>

<li>
<p>GCC: Набор инструментов компилятора теперь основан на 3.4.<tt
class="REPLACEABLE"><i>X</i></tt>, вместо GCC 2.95.<tt
class="REPLACEABLE"><i>X</i></tt>.</p>
</li>

<li>
<p>MAC: Поддержка расширяемых, загружаемых политик Mandatory Access Control
(принудительный контроль доступа).</p>
</li>

<li>
<p>GEOM: Гибкая, модульная подсистема трансформации запросов ввода/вывода на диск. Эта
система поддерживает множество возможностей, относящихся к дискам и томам, таких как:
Определение дисковых разделов, шифрование посредством <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&sektion=4&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">gbde</span>(4)</span></a>,
различные уровни RAID, сетевой экспорт дисковых устройств (с <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=ggated&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">ggated</span>(8)</span></a>
относящимися к нему утилитами), а также прозрачное разжатие дисков. Система geom_vinum
добавила совместимость с GEOM к менеджеру томов VINUM.</p>
</li>

<li>
<p>FFS: Файловая система FFS теперь поддерживает фоновые операции <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=fsck&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">fsck</span>(8)</span></a> (для
более быстрого восстановления после сбоев) и снэпшоты файловой системы.</p>
</li>

<li>
<p>UFS2: Был добавлен новый дисковый формат UFS2, поддерживающий расширенные файловые
атрибуты и большие размеры файлов. UFS2 теперь формат по умолчанию для <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">newfs</span>(8)</span></a>. На
всех платформах, за исключением pc98, файловые системы, созданные из <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">sysinstall</span>(8)</span></a>,
используют UFS2 по умолчанию.</p>
</li>

<li>
<p>Новые сетевые возможности: Множество новых сетевых возможностей впервые появились в
релизах 5.<tt class="REPLACEABLE"><i>X</i></tt>, включая поддержку TCP SACK (selective
acknowledgements), пакетный фильтр <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=pf&sektion=4&manpath=FreeBSD+5.4-RELEASE"><span
 class="CITEREFENTRY"><span class="REFENTRYTITLE">pf</span>(4)</span></a> из OpenBSD, и
систему управления пакетами ALTQ.</p>
</li>

<li>
<p>Поддержка нового оборудования: Поддержка новых аппаратных устройств, таких как
Cardbus, Bluetooth и сетевых интерфейсов IEEE 802.11a/b/g, основанных на чипсетах
Atheros. Кроме того, для архитектуры i386, некоторые сетевые устройства, не
поддерживаемые явно драйверами FreeBSD, могут поддерживаться с использованием драйверов
для <span class="TRADEMARK">Microsoft</span>&reg; <span
class="TRADEMARK">Windows</span>&reg; и уровня совместимости <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=ndis&sektion=4&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">ndis</span>(4)</span></a> от
поставщика оборудования.</p>
</li>
</ul>

<p>Более полный список новых возможностей можно найти в информации о различных релизах
FreeBSD 5.<tt class="REPLACEABLE"><i>X</i></tt>.</p>
</div>

<div class="SECT1">
<hr />
<h2 class="SECT1"><a id="DRAWBACKS" name="DRAWBACKS">4. Наиболее заметные
изменения</a></h2>

<p>Некоторые из различий между FreeBSD 4.<tt class="REPLACEABLE"><i>X</i></tt> и 5.<tt
class="REPLACEABLE"><i>X</i></tt> заслуживают особого упоминания, поскольку они включают
серьезные архитектурные изменения, или нарушение обратной совместимости. Хотя эти
изменения скорее всего не приведут к потере данных, они могут стать проблемой для тех,
кто к ним не готов. Некоторые примеры:</p>

<ul>
<li>
<p>Некоторые части функциональности базовой системы FreeBSD были перенесены в коллекцию
портов FreeBSD, обычно вследствие того, что их проще поддерживать в этой форме, или
поскольку они на самом деле не являются необходимой частью базовой системы. Наиболее
заметный пример такого переноса это <b class="APPLICATION">Perl</b> (доступный из
коллекции портов FreeBSD через порт <a
href="http://www.FreeBSD.org/cgi/url.cgi?ports/lang/perl5.8/pkg-descr"><tt
class="FILENAME">lang/perl5.8</tt></a>), наличие которого в базовой системе делало
обновление проблематичным. Утилиты базовой системы, написанные на <b
class="APPLICATION">Perl</b>, были или переписаны или удалены (если они более не
нужны).</p>

<p>Другие примеры включают <b class="APPLICATION">UUCP</b> (доступный из коллекции портов
как <a href="http://www.FreeBSD.org/cgi/url.cgi?ports/net/freebsd-uucp/pkg-descr"><tt
class="FILENAME">net/freebsd-uucp</tt></a>), утилиту <tt class="COMMAND">doscmd</tt> (<a
href="http://www.FreeBSD.org/cgi/url.cgi?ports/emulators/doscmd/pkg-descr"><tt
class="FILENAME">emulators/doscmd</tt></a>), и многие из традиционных игр (<a
href="http://www.FreeBSD.org/cgi/url.cgi?ports/games/freebsd-games/pkg-descr"><tt
class="FILENAME">games/freebsd-games</tt></a>).</p>
</li>

<li>
<p>Изменения в структурах данных ядра и ABI/API означает необходимость модификации
множества бинарных драйверов устройств сторонних поставщиков для корректной работы в
FreeBSD 5.<tt class="REPLACEABLE"><i>X</i></tt>. В некоторых (редких) случаях изменены
видимые пользователю структуры данных, что требует перекомпиляции приложений или
переустановки портов/пакетов. Как и с серией релизов 4.<tt
class="REPLACEABLE"><i>X</i></tt>, целью команды разработки FreeBSD является недопущение
внесения несовместимых изменений в будущие релизы ветви 5.<tt
class="REPLACEABLE"><i>X</i></tt>.</p>
</li>

<li>
<p>Недостаток интереса со стороны пользователей и отсутствие поддержки некоторых частей
базовой системы FreeBSD привело к утере их работоспособности. Эти части были удалены.
Например, так случилось с исполняемыми файлами <tt class="FILENAME">a.out</tt>, <a
id="AEN160" name="AEN160" href="#FTN.AEN160"><span class="footnote">[1]</span></a>
поддержкой сетей XNS и драйвером X-10. Многие другие драйверы для старых ISA устройств
стали неработоспособны и были удалены. Дополнительные подробности находятся в информации
о релизе.</p>
</li>

<li>
<p>В FreeBSD/i386 4.<tt class="REPLACEABLE"><i>X</i></tt> настройка ISA устройств
вносилась в конфигурацию ядра. Ее можно было изменить во время загрузки через
интерактивную утилиту <b class="APPLICATION">UserConfig</b>. В FreeBSD 5.<tt
class="REPLACEABLE"><i>X</i></tt> оба этих механизма были заменены механизмом <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=device.hints&sektion=5&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">device.hints</span>(5)</span></a>,
который делает ненужным жесткое задание параметров настройки ISA в ядре. Настройка ISA
устройств во время загрузки более не управляется через меню, вместо этого вводятся
параметры в приглашение командной строки загрузчика.</p>
</li>

<li>
<p><tt class="FILENAME">MAKEDEV</tt> более не существует и не требуется. FreeBSD 5.<tt
class="REPLACEABLE"><i>X</i></tt> использует файловую систему устройств, которая
автоматически создает файлы устройств по мере необходимости. Настройка файловой системы
устройств может быть выполнена посредством утилиты <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">devfs</span>(8)</span></a> или
через механизм <tt class="FILENAME">/etc/devfs.conf</tt>. Дополнительная информация
находится на странице справочной системы <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&sektion=5&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">devfs</span>(5)</span></a>.</p>
</li>

<li>
<p>UFS2 стал дисковым форматом по умолчанию для файловых систем, созданных с
использованием <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">newfs</span>(8)</span></a>. Для
всех платформ за исключением pc98 это также формат по умолчанию файловых систем,
созданных с использованием экрана разметки в <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">sysinstall</span>(8)</span></a>.
Поскольку FreeBSD 4.<tt class="REPLACEABLE"><i>X</i></tt> распознает только UFS1 (и не
распознает UFS2), дисковые разделы, к которым необходимо получать доступ и из 5.<tt
class="REPLACEABLE"><i>X</i></tt> и из 4.<tt class="REPLACEABLE"><i>X</i></tt>, должны
быть созданы с UFS1. Этот формат может быть выбран параметром <code
class="OPTION">-O1</code> для <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">newfs</span>(8)</span></a>, или
через экран разметки диска в <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">sysinstall</span>(8)</span></a>.
Эта ситуация обычно возникает на компьютере, где одновременно присутствуют FreeBSD 4.<tt
class="REPLACEABLE"><i>X</i></tt> FreeBSD 5.<tt class="REPLACEABLE"><i>X</i></tt>.
Обратите внимание, что не существует способа преобразования файловых системы между этими
двумя форматами (кроме резервного копирования, пересоздания файловой системы и
восстановления с резервной копии).</p>
</li>

<li>
<p>Вследствие обновления компилятора <b class="APPLICATION">GCC</b>, программы на C++ как
правило требуют перекомпиляции и переустановки. Это требование возникло вследствие
изменений в C++ ABI.</p>
</li>

<li>
<p>Запуск приложений, скомпилированных для FreeBSD 4.<tt
class="REPLACEABLE"><i>X</i></tt>, может быть возможен посредством дистрибутива <tt
class="FILENAME">compat4x</tt> (или эквивалентного порта/пакета <a
href="http://www.FreeBSD.org/cgi/url.cgi?ports/misc/compat4x/pkg-descr"><tt
class="FILENAME">misc/compat4x</tt></a>). Однако, если какой-либо порт или пакет в
системе требует обновления, рекомендуется пересборка и переустановка <span
class="emphasis"><i class="EMPHASIS">всех</i></span> установленных в системе портов. Это
предотвратит проблемы, которые могут появиться с программами, использующими некоторую
комбинацию старых и новых библиотек. Утилита <a
href="http://www.FreeBSD.org/cgi/url.cgi?ports/sysutils/portupgrade/pkg-descr"><tt
class="FILENAME">sysutils/portupgrade</tt></a> может помочь при переустановке портов.</p>

<p>Обратите внимание, что в любом случае существует несколько примеров обратной
несовместимости. Например, порты <a
href="http://www.FreeBSD.org/cgi/url.cgi?ports/devel/gnomevfs2/pkg-descr"><tt
class="FILENAME">devel/gnomevfs2</tt></a>, <a
href="http://www.FreeBSD.org/cgi/url.cgi?ports/mail/postfix/pkg-descr"><tt
class="FILENAME">mail/postfix</tt></a>, и <a
href="http://www.FreeBSD.org/cgi/url.cgi?ports/security/cfs/pkg-descr"><tt
class="FILENAME">security/cfs</tt></a> необходимо перекомпилировать вследствие изменений
в структуре <tt class="LITERAL">statfs</tt>.</p>
</li>

<li>
<p>Файл настройки разрешения имен <tt class="FILENAME">host.conf</tt> был замещен на
(гораздо более общий) механизм настройки сервисов имен <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=nsswitch.conf&sektion=5&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span
class="REFENTRYTITLE">nsswitch.conf</span>(5)</span></a>.</p>
</li>

<li>
<p><b class="APPLICATION">BIND</b> был обновлен с версии 8 до версии 9. Между BIND 8 и 9
существует множество различий. Пользователям, для которых наличие <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=named&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">named</span>(8)</span></a>
необходимо, рекомендуется прочесть документацию по мигрированию в <tt
class="FILENAME">/usr/share/doc/bind9/misc/migration</tt>. Доступно также новое
руководство в <tt class="FILENAME">/usr/share/doc/bind9/arm</tt>. На системах, где
работает <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=named&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">named</span>(8)</span></a>, теперь
он по умолчанию запускается в среде <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=chroot&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">chroot</span>(8)</span></a> в <tt
class="FILENAME">/var/named</tt>. Пользователям, у которых конфигурация <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=named&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">named</span>(8)</span></a> уже
расположена <tt class="FILENAME">/var/named</tt>, рекомендуется сделать резервную копию
этого каталога перед обновлением, чтобы избежать ее перезаписи стартовым скриптом <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=named&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">named</span>(8)</span></a>.</p>
</li>

<li>
<p>Реализация X Window System от <b class="APPLICATION">Xorg</b> устанавливается для
FreeBSD 5.<tt class="REPLACEABLE"><i>X</i></tt> по умолчанию начиная с 5.3-RELEASE. На
момент написания данного текста, <b class="APPLICATION"><span
class="TRADEMARK">XFree86</span>&#8482;</b> остается по умолчанию в FreeBSD 4.<tt
class="REPLACEABLE"><i>X</i></tt>. Дополнительную информацию по различию между версиями,
а также информацию по обновлению существующих систем можно найти в главе <a
href="http://www.FreeBSD.org/doc/ru_RU.KOI8-R/books/handbook/x11.html" target="_top">X
Window System</a> Руководства FreeBSD.</p>
</li>

<li>
<p>Документация (такая как <a
href="http://www.FreeBSD.org/doc/ru_RU.KOI8-R/books/handbook/index.html"
target="_top">Руководство</a> FreeBSD и <a
href="http://www.FreeBSD.org/doc/ru_RU.KOI8-R/books/faq/index.html"
target="_top">FAQ</a>) все еще находится в процессе обновления, чтобы соответствовать
изменениям, недавно внесенным в FreeBSD 5.<tt class="REPLACEABLE"><i>X</i></tt>.</p>
</li>
</ul>

<p>Дополнительная информация находится в документации на релиз к различным релизам
FreeBSD 5.<tt class="REPLACEABLE"><i>X</i></tt>, а также в файле <tt
class="FILENAME">src/UPDATING</tt> из дерева исходных текстов FreeBSD. Значительные
изменения в коллекции портов FreeBSD приводятся в файлах <tt
class="FILENAME">ports/UPDATING</tt> и <tt class="FILENAME">ports/CHANGES</tt> из дерева
портов.</p>
</div>

<div class="SECT1">
<hr />
<h2 class="SECT1"><a id="UPGRADE" name="UPGRADE">5. Заметки по обновлению с FreeBSD 4.<tt
class="REPLACEABLE"><i>X</i></tt></a></h2>

<p>Для пользователей системы FreeBSD этот раздел предоставляет несколько заметок по
обновлению FreeBSD 4.<tt class="REPLACEABLE"><i>X</i></tt> до 5.<tt
class="REPLACEABLE"><i>X</i></tt>. Как и при любом обновлении FreeBSD, необходимо
прочесть информацию о релизе и список исправлений к новому релизу, а также <tt
class="FILENAME">src/UPDATING</tt> при обновлении из исходных текстов.</p>

<div class="SECT2">
<hr />
<h3 class="SECT2"><a id="AEN273" name="AEN273">5.1. Бинарные обновления</a></h3>

<p>Возможно наиболее прямой способ это ``сохранить все, переформатировать,
переустановить, и восстановить данные пользователя''. Это исключает проблемы с
несовместимыми или отсутствующими в новой версии исполняемыми файлами и файлами
настройки, захламляющими новую систему. Это позволяет создать новые файловые системы с
новой функциональностью (наиболее значимая -- UFS2 по умолчанию).</p>

<p>На момент написания этого текста, опция бинарного обновления в меню <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">sysinstall</span>(8)</span></a> не
была достаточно протестирована для обновлений между основными ветвями. Использование этой
возможности не рекомендуется.</p>

<p>Некоторые изменения могут быть интересны пользователям, которые знакомы с загрузочными
дискетами FreeBSD 4.<tt class="REPLACEABLE"><i>X</i></tt>. Загрузочные дискеты (на
платформах, которые их поддерживают, например на i386), организованы несколько
по-другому, чем в предыдущих релизах. В релизах 4.<tt class="REPLACEABLE"><i>X</i></tt>
набор дискет включал урезанное ядро, достаточное лишь для того, чтобы установить систему.
Это позволяло ядру уместиться на одну дискету, но не позволяло поместить в него драйверы,
необходимые для определенных аппаратных конфигураций. Начиная с 5.3-RELEASE, на
установочных дискетах находится стандартное ядро <tt class="LITERAL">GENERIC</tt>,
распределенное на несколько дискет, с гораздо большим набором драйверов и возможностей.
Загрузчик просит вставить дополнительные диски по мере необходимости. Пользователям,
загружающим образы дискет (возможно для установки по сети), необходимо обратить внимание
на то, что набор теперь включает три дискеты: <tt class="FILENAME">boot.flp</tt>, <tt
class="FILENAME">kern1.flp</tt>, и <tt class="FILENAME">kern2.flp</tt>.</p>

<p>Установочные CDROM для архитектуры <span class="TRADEMARK">i386</span>&#8482; теперь
используют ``не-эмулирующий'' загрузчик. Это позволяет, помимо прочего, использовать <tt
class="LITERAL">GENERIC</tt> ядро вместо урезанного ядра на дискетах предыдущих версий.
Как правило, любая система, способная загрузиться с установочных компакт дисков <span
class="TRADEMARK">Microsoft</span> <span
class="TRADEMARK">Windows&nbsp;NT</span>&reg;&nbsp;4, <span
class="TRADEMARK">Windows</span>&nbsp;2000, или <span
class="TRADEMARK">Windows</span>&nbsp;XP должна быть способна загрузиться с компакт
дисков 5.<tt class="REPLACEABLE"><i>X</i></tt>.</p>

<p>Расположение файлов дистрибутива на CDROM было изменено по сравнению с серией релизов
4.<tt class="REPLACEABLE"><i>X</i></tt>. Начиная с 5.4-RELEASE, установочный образ и
``live filesystem'' теперь находятся на первом диске для всех архитектур, за исключением
ia64 (в релизах ia64 используются отдельные диски для установки и для live filesystem,
поскольку они не помещаются на один диск). Широко используемые пакеты размещаются на
втором и последующих дисках релиза.</p>
</div>

<div class="SECT2">
<hr />
<h3 class="SECT2"><a id="AEN300" name="AEN300">5.2. Обновление из исходных
текстов</a></h3>

<div class="NOTE">
<blockquote class="NOTE">
<p><b>Замечание:</b> Многие и пользователи обнаружили, что проще всего сделать резервное
копирование данных и файлов настройки (благоразумное предостережение для любого случая),
выполнить обычную установку и восстановить данные. В отличие от обновления из исходных
текстов, в этом случае не требуется заботиться об оставшихся на диске файлах и
программах, и позволяет воспользоваться преимуществами новой файловой системы UFS2.</p>

<p>Пользователи, не знакомые с процедурами <tt class="LITERAL">buildworld</tt>/<tt
class="LITERAL">installworld</tt> обновления FreeBSD из исходных текстов, <span
class="emphasis"><i class="EMPHASIS">не</i></span> должны пытаться выполнить такое
обновление, вместо этого рекомендуется выполнить обычную установку после резервного
копирования всех данных.</p>
</blockquote>
</div>

<p>При обновлении из исходных текстов на локальной машине собираются и устанавливаются
бинарные файлы. Это обновление основано на процедуре <tt
class="LITERAL">buildworld</tt>/<tt class="LITERAL">installworld</tt>, часто используемой
опытными пользователями FreeBSD для отслеживания изменений в ветви разработки (такой как
FreeBSD-STABLE или FreeBSD-CURRENT). Как правило, это более сложная процедура, чем
бинарное обновление, но она может быть полезна если файлы настройки системы сложны или
серьезно модифицированы под имеющуюся установку. Обновление из исходных текстов также
может быть полезно, когда у администратора есть удаленный доступ к консоли, но нет
физического доступа (и следовательно нет возможности вставить установочный диск).</p>

<p>Прочтение <tt class="FILENAME">src/UPDATING</tt> абсолютно необходимо. Раздел,
озаглавленный ``To upgrade in-place from 4.x-stable to current'' содержит пошаговую
процедуру обновления, которая должна быть в точности выполнена, без ``сокращений'',
которые зачастую применяют некоторые пользователи. Сокращенный список этих шагов приведен
ниже:</p>

<ol type="1">
<li>
<p>Сделайте резервные копии.</p>

<p>Важность этого шага невозможно переоценить. Необходимо сделать резервные копии всех
данных пользователя и файлов настройки. Прекрасно подходит для этого <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">dump</span>(8)</span></a> нулевого
уровня, хотя конечно существует множество работоспособных альтернатив.</p>
</li>

<li>
<p>Убедитесь, что в файловой системе <tt class="FILENAME">/</tt> присутствует около 30MB
свободного места.</p>

<p>FreeBSD 5.<tt class="REPLACEABLE"><i>X</i></tt> требуется больше места, чем FreeBSD
4.<tt class="REPLACEABLE"><i>X</i></tt>. Если каталог <tt class="FILENAME">/tmp</tt>
расположен в файловой системе <tt class="FILENAME">/</tt> (а зачастую это так), удаление
всего содержимого этого каталога может помочь высвободить место.</p>
</li>

<li>
<p>Подправьте <tt class="FILENAME">/etc/fstab</tt> если необходимо.</p>

<p>Этот пункт возможно относится только к старым системам FreeBSD/i386. В системах, где
используются дисковые слайсы в MBR стиле, FreeBSD поддерживает ``слайсы совместимости'',
где имена дисковых разделов могут принимать форму <tt class="FILENAME">/dev/ad0a</tt>
(без явного указания имени слайса). Это более не поддерживается, дисковые разделы должны
быть именованы в форме <tt class="FILENAME">/dev/ad0s1a</tt>. Другими словами, дисковые
разделы теперь должны указываться полностью: дисковое устройство, номер слайса и буква
раздела.</p>

<p>Обратите внимание, что ``слайсы совместимости'' обычно не используются по умолчанию
начиная с FreeBSD 2.2.6-RELEASE. Этот пункт не относится к FreeBSD/alpha вообще, как и к
системам, использующим режим ``dangerously dediated''.</p>
</li>

<li>
<p>Используя <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=cvs&sektion=1&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">cvs</span>(1)</span></a> или
другие способы, получите копию исходных текстов базовой системы FreeBSD (модуль <tt
class="FILENAME">src/</tt>). Для извлечения 5.4-RELEASE из CVS репозитория FreeBSD,
используйте тег <tt class="LITERAL">RELENG_5_4_0_RELEASE</tt>. Для ветви 5.4 с
исправлениями, используйте тег <tt class="LITERAL">RELENG_5_4</tt>. Для отслеживания
ветви разработки FreeBSD 5-STABLE, используйте тег ветви <tt
class="LITERAL">RELENG_5</tt>. При использовании CVS для извлечения исходных текстов,
важно установить для CVS флаг <code class="OPTION">-P</code>, чтобы пустые каталоги
удалялись.</p>
</li>

<li>
<p>FreeBSD 5.<tt class="REPLACEABLE"><i>X</i></tt> требуются некоторые новые записи в
системных файлах паролей и групп, соответствующие различным системным сервисам. Они
должны быть добавлены командой:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">mergemaster -p</kbd>
</pre>

<p>Этот шаг необходимо выполнить, чтобы установить пользователя и группу на некоторые
новые файлы.</p>

<p>Обратите внимание, что в FreeBSD 5.<tt class="REPLACEABLE"><i>X</i></tt> файл утилиты
<a
href="http://www.FreeBSD.org/cgi/man.cgi?query=nologin&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">nologin</span>(8)</span></a>
переместился из <tt class="FILENAME">/sbin/nologin</tt> в <tt
class="FILENAME">/usr/sbin/nologin</tt>. Поскольку у многих псевдо-пользователей <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=nologin&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">nologin</span>(8)</span></a>
указана в качестве оболочки, это изменение создаст дополнительные различия в <tt
class="FILENAME">/etc/passwd</tt>.</p>
</li>

<li>
<p>Соберите новую систему с помощью:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">cd /usr/src</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">make buildworld</kbd>
</pre>

<p>Если переменная <code class="VARNAME">CPUTYPE</code> определена в <tt
class="FILENAME">/etc/make.conf</tt>, она должна быть задана оператором <tt
class="LITERAL">?=</tt>, чтобы процесс <tt class="LITERAL">buildworld</tt> мог переписать
ее при необходимости.</p>

<p>Обратите внимание, что <code class="VARNAME">MAKEOBJDIRPREFIX</code> <span
class="emphasis"><i class="EMPHASIS">нельзя</i></span> определять в <tt
class="FILENAME">/etc/make.conf</tt>.</p>

<p>Как правило, большая часть ``установок'', определенных в <tt
class="FILENAME">/etc/make.conf</tt>, должна быть закомментирована или удалена. Это
особенно важно для тех переменных, которые непосредственно влияют на сборку или основные
операции FreeBSD, такие как <code class="VARNAME">NO_TOOLCHAIN</code>.</p>
</li>

<li>
<p>Соберите и установите новое ядро командой:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">make buildkernel</kbd>
</pre>

<p>Обратите внимание, что необходимо использовать <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=make&sektion=1&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">make</span>(1)</span></a> <tt
class="LITERAL">buildkernel</tt>, чтобы убедиться, что ядро будет собрано компилятором,
собранным в предыдущем действии. Использование <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=config&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">config</span>(8)</span></a>
вручную и последующая сборка ядра не будут работать.</p>

<p>Хотя сборка (и последующая установка) собственного ядра в данный момент возможна,
обновление с использованием ядра <tt class="LITERAL">GENERIC</tt> и установка
собственного ядра позже предпочтительнее, поскольку вероятность ошибок ниже. При сборке
собственного ядра в первый раз настоятельно рекомендуется в качестве основы использовать
ядро <tt class="LITERAL">GENERIC</tt> из FreeBSD 5.<tt class="REPLACEABLE"><i>X</i></tt>,
поскольку многие устройства и параметры были добавлены или изменены по сравнению с 4.<tt
class="REPLACEABLE"><i>X</i></tt>. В любом случае, включение параметра конфигурации <tt
class="LITERAL">COMPAT_FREEBSD4</tt> необходимо для успешного обновления.</p>
</li>

<li>
<p>Настройте хинты устройств для устройств ISA с помощью одного из варианта
нижеприведенной команды. Подставьте соответствующее имя архитектуры (например <tt
class="LITERAL">i386</tt>) вместо <tt class="REPLACEABLE"><i>MACHINE</i></tt>.</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">cp sys/<tt
class="REPLACEABLE"><i>MACHINE</i></tt>/conf/GENERIC.hints /boot/device.hints</kbd>
</pre>

<p>Хотя пустой файл хинтов может быть достаточен для современного оборудования, хинты ISA
необходимы для систем с ISA не-PNP картами (где хинты должны быть настроены), для
не-PNPBIOS систем, или для флоппи дисков, чтобы корректно работать на PNPBIOS
системах.</p>
</li>

<li>
<p>Установите новое ядро командой:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">make installkernel</kbd>
</pre>

<p>Обратите внимание, что в FreeBSD 4.<tt class="REPLACEABLE"><i>X</i></tt> ядро по
умолчанию устанавливается в <tt class="FILENAME">/kernel</tt>, а в FreeBSD 5.<tt
class="REPLACEABLE"><i>X</i></tt> ядро устанавливается в <tt
class="FILENAME">/boot/kernel/kernel</tt>. Модули ядра в 4.<tt
class="REPLACEABLE"><i>X</i></tt> обычно устанавливаются в каталог <tt
class="FILENAME">/modules</tt>, а в 5.<tt class="REPLACEABLE"><i>X</i></tt> они
устанавливаются в <tt class="FILENAME">/boot/kernel</tt>.</p>
</li>

<li>
<p>Установите загрузчик FreeBSD 5.<tt class="REPLACEABLE"><i>X</i></tt> командой:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">cd /usr/src/sys/boot</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">make STRIP="" install</kbd>
</pre>

<p>Хотя этот шаг опционален, он настоятельно рекомендуется.</p>
</li>

<li>
<p>Отключите модули сторонних разработчиков (такие как VMware) для предотвращения
падений, вызванных изменениями в ABI ядра или другими несовместимостями.</p>
</li>

<li>
<p>Перезагрузитесь в однопользовательский режим. Перезагрузка абсолютно необходима,
поскольку для установки новой системы должно быть запущено новое ядро.
Однопользовательский режим практически устранит различные случайности, которые могут
возникнуть во время обновления, так как другие программы не будут запущены.</p>
</li>

<li>
<p>Смонтируйте необходимые файловые системы:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">fsck -p</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">mount -uw /</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">mount -at ufs</kbd>
</pre>

<p>Обратите внимание, что вызов <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=fsck&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">fsck</span>(8)</span></a>
необходим для обновления определенный полей в суперблоке файловой системы для FreeBSD
5.<tt class="REPLACEABLE"><i>X</i></tt>. Если системные часы работают в локальном
времени, а не в UTC, выполните также:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">adjkerntz -i</kbd>
</pre>

<p>Во время этого шага на консоли может появиться следующее сообщение (множество
раз).</p>

<pre class="SCREEN">
WARNING: userland calling deprecated sysctl, please rebuild world
</pre>

<p>Оно может быть спокойно проигнорировано.</p>
</li>

<li>
<p>Удалите заголовки файлов C++:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">rm -rf /usr/include/g++</kbd>
</pre>

<p>Этот шаг предотвратит использование старых файлов заголовков, оставшихся от
компилятора <b class="APPLICATION">GCC</b> 2.95 C++, при дальнейших компиляциях.</p>
</li>

<li>
<p>Установите новую систему:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">cd /usr/src</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">make installworld</kbd>
</pre>
</li>

<li>
<p>На системах, где установлен <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=named&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">named</span>(8)</span></a>, его
файлы настройки должны быть перемещены в <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=chroot&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">chroot</span>(8)</span></a>, в
каталог <tt class="FILENAME">/var/named</tt>. Если какие-либо файлы уже находятся в <tt
class="FILENAME">/var/named</tt>, необходимо предварительно сделать их резервную
копию.</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">cd /etc</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">mv named named.bak</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">mkdir -p /var/named/etc/namedb</kbd>
<samp class="PROMPT">#</samp> <kbd
class="USERINPUT">cp -Rp named.bak/* /var/named/etc/namedb</kbd>
</pre>

<p>Если в конфигурации использованы автоматически созданные файлы <tt
class="FILENAME">localhost</tt>, для их автоматической пересборки потребуется
следующее:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">cd /var/named/etc/namedb</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">/bin/sh make-localhost</kbd>
<samp class="PROMPT">#</samp> <kbd
class="USERINPUT">rm -f localhost-v6.rev localhost.rev</kbd>
</pre>

<p>Наконец, нужно удалить два устаревших бинарных файла от предыдущих версий <b
class="APPLICATION">BIND</b>:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">rm /usr/sbin/nslookup</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">rm /usr/sbin/nsupdate</kbd>
</pre>
</li>

<li>
<p>Обновите конфигурацию системы, запустив:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">mergemaster -i</kbd>
</pre>

<p>Этот шаг не опционален. Он необходим для приведения стартовых файлов и файлов
настройки из <tt class="FILENAME">/etc</tt> в соответствие новому ядру и системе.</p>

<p>После вызова <a
href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&sektion=8&manpath=FreeBSD+5.4-RELEASE">
<span class="CITEREFENTRY"><span class="REFENTRYTITLE">mergemaster</span>(8)</span></a>,
неплохо будет проверить (и возможно изменить) <tt class="FILENAME">/etc/rc.conf</tt>.
Значения по умолчанию многих переменных, определяемых в этом файле, изменились; в
частности, некоторые сервисы, которые были включены по умолчанию в 4.<tt
class="REPLACEABLE"><i>X</i></tt>, теперь отключены по умолчанию в 5.<tt
class="REPLACEABLE"><i>X</i></tt>.</p>
</li>

<li>
<p>Удалите оставшиеся файлы <b class="APPLICATION">BIND 8</b>:</p>

<pre class="SCREEN">
<samp class="PROMPT">#</samp> <kbd
class="USERINPUT">rm /usr/bin/dnskeygen /usr/bin/dnsquery</kbd>
<samp class="PROMPT">#</samp> <kbd class="USERINPUT">rm /usr/libexec/named-xfer</kbd>
<samp class="PROMPT">#</samp> <kbd
class="USERINPUT">rm /usr/sbin/named.restart /usr/sbin/ndc</kbd>
</pre>
</li>

<li>
<p>Перезагрузитесь.</p>
</li>
</ol>

<p>После обновления базовой системы, обычно требуется обновление некоторых компонент, не
входящих в базовую систему, для восстановления нормальной функциональности. <b
class="APPLICATION">Perl</b> более не является частью базовой системы и должен быть
установлен из коллекции портов (а именно, из порта <a
href="http://www.FreeBSD.org/cgi/url.cgi?ports/lang/perl5.8/pkg-descr"><tt
class="FILENAME">lang/perl5.8</tt></a>) или из пакета. После этой установки все порты
и/или пакеты, зависящие от <b class="APPLICATION">Perl</b>, нуждаются в
переустановке.</p>

<p>Для запуска бинарных файлов FreeBSD 4.<tt class="REPLACEABLE"><i>X</i></tt> требуется
набор библиотек, поддерживающих совместимость. Он доступен после установки пакета/порта
<a href="http://www.FreeBSD.org/cgi/url.cgi?ports/misc/compat4x/pkg-descr"><tt
class="FILENAME">misc/compat4x</tt></a>.</p>

<p>Как было упомянуто в предыдущем разделе, <b class="APPLICATION">Xorg</b> это
реализация X Window System по умолчанию. Коллекция портов (а также пакеты) соответствуют
этому изменению, чтобы учесть зависимости. Для замены установленной графической системы с
<b class="APPLICATION"><span class="TRADEMARK">XFree86</span></b> на <b
class="APPLICATION">Xorg</b>, обратитесь к разделу <a
href="http://www.FreeBSD.org/doc/ru_RU.KOI8-R/books/handbook/x-install.html"
target="_top">Установка X11</a> Руководства FreeBSD.</p>
</div>
</div>

<div class="SECT1">
<hr />
<h2 class="SECT1"><a id="SUMMARY" name="SUMMARY">6. Итоги</a></h2>

<p>В этой статье представлены некоторые из наиболее заметных новых возможностей FreeBSD
5.<tt class="REPLACEABLE"><i>X</i></tt>, и список отдельных вопросов, требующих особого
внимания тех пользователей, кто обновляет существующую систему FreeBSD 4.<tt
class="REPLACEABLE"><i>X</i></tt>. Здесь также представлены два набора инструкций по
обновлению, одна с использованием обычной установки, другая основана на перекомпиляции
системы из исходных текстов.</p>
</div>
</div>

<h3 class="FOOTNOTES">Примечания</h3>

<table border="0" class="FOOTNOTES" width="100%">
<tr>
<td align="LEFT" valign="TOP" width="5%"><a id="FTN.AEN160" name="FTN.AEN160"
href="#AEN160"><span class="footnote">[1]</span></a></td>
<td align="LEFT" valign="TOP" width="95%">
<p>Обратите внимание, что выполнение файлов <tt class="FILENAME">a.out</tt> все еще
поддерживается на i386 и pc98 с параметром ядра <tt class="LITERAL">COMPAT_AOUT</tt>.
Некоторые из компиляторов коллекции портов (например, <a
href="http://www.FreeBSD.org/cgi/url.cgi?ports/lang/gcc28/pkg-descr"><tt
class="FILENAME">lang/gcc28</tt></a>) все еще поддерживают создание исполняемых файлов
стандарта <tt class="FILENAME">a.out</tt>.</p>
</td>
</tr>
</table>

<hr />
<p align="center"><small>Этот файл и другие документы, относящиеся к данной версии
FreeBSD, могут быть найдены по адресу <a
href="ftp://ftp.FreeBSD.org/">ftp://ftp.FreeBSD.org/</a>.</small></p>

<p align="center"><small>Если у вас возник вопрос, касающийся FreeBSD, прочтите <a
href="http://www.FreeBSD.org/ru/docs.html">документацию,</a> прежде чем написать письмо в
&#60;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&#62;.</small></p>

<p align="center"><small>Всем пользователям FreeBSD 5-STABLE рекомендуется подписаться на
список рассылки &#60;<a
href="mailto:stable@FreeBSD.org">stable@FreeBSD.org</a>&#62;.</small></p>

<p align="center"><small>Вопросы, касающиеся этого документа, вы можете направить по
адресу &#60;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&#62;.</small></p>
</body>
</html>


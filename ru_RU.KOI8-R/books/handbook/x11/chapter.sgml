<!--
     The FreeBSD Russian Documentation Project

     $FreeBSD$
     $FreeBSDru: frdp/doc/ru_RU.KOI8-R/books/handbook/x11/chapter.sgml,v 1.43 2004/01/04 18:33:28 andy Exp $

     Original revision: 1.132
-->

<chapter id="x11">
  <title>X Window System</title>

  <sect1 id="x11-synopsis">
    <title>Обзор</title>

    <para>FreeBSD использует <application>&xfree86;</application> для того,
      чтобы дать пользователям мощный графический интерфейс.
      <application>&xfree86;</application> является открытой реализацией
      X Window System.  Эта глава посвящена установке и настройке
      <application>&xfree86;</application> в системе FreeBSD.  Чтобы получить
      более полную информацию о <application>&xfree86;</application> и
      поддерживаемом в ней графическом оборудовании, посетите
      сайт <ulink url="http://www.XFree86.org/">&xfree86;</ulink>.</para>

    <para>После чтения этой главы вы будете знать:</para>

    <itemizedlist>
      <listitem>
        <para>Как установить и настроить
          <application>&xfree86;</application>.</para>
      </listitem>

      <listitem>
        <para>Различные компоненты X Window System и их
          взаимодействие.</para>
      </listitem>

      <listitem>
        <para>Как установить и использовать различные оконные менеджеры.</para>
      </listitem>

      <listitem>
        <para>Как использовать шрифты &truetype; в
          <application>&xfree86;</application>.</para>
      </listitem>

      <listitem>
        <para>Как настроить вашу систему на графический интерфейс входа
          (<application>XDM</application>).</para>
      </listitem>
    </itemizedlist>

    <para>Перед чтением этой главы вы должны:</para>

    <itemizedlist>
      <listitem>
        <para>Знать, как устанавливать дополнительное программное обеспечение
          сторонних разработчиков (<xref linkend="ports">).</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 id="x-understanding">
    <title>Основы X</title>

    <para>Первое знакомство с X может оказаться чем-то вроде шока для тех, кто
      работал с другими графическими системами, такими, как &microsoft.windows;
      или &macos;.</para>

    <para>Нет необходимости вникать во все детали различных компонентов X и
      их взаимодействия; однако некоторые базовые знания делают возможным
      использование сильных сторон X.</para>

    <sect2>
      <title>Почему именно X?</title>

      <para>X не является первой оконной системой для &unix;, но она является
        самой популярной.  До работы над X команда ее разработчиков трудилась
        над другой оконной системой.  Та система называлась <quote>W</quote>
        (от <quote>Window</quote>).  X является просто следующей
        буквой в романском алфавите.</para>

      <para>X можно называть <quote>X</quote>, <quote>X Window System</quote>,
        <quote>X11</quote> и другими терминами.  Факт использования названия
        <quote>X Windows</quote> для X11 может задеть интересы некоторых
        людей; дополнительную информацию по этому поводу можно найти на
        странице справочной системы &man.X.7;.</para>
    </sect2>

    <sect2>
      <title>Модель клиент/сервер в X</title>

      <para>X изначально разрабатывалась, чтобы быть системой, ориентированной
        на работу в сети с использованием модели <quote>клиент-сервер</quote>.
        В модели работы X <quote>X-сервер</quote> работает на компьютере с
        клавиатурой, монитором и мышью.  Сервер отвечает за управление
        дисплеем, обработку ввода с клавиатуры и мыши и так далее.  Каждое
        X-приложение (например, <application>XTerm</application> или
	<application>&netscape;</application>) является
        <quote>клиентом</quote>.  Клиент посылает сообщения серверу, такие,
        как <quote>Пожалуйста, нарисуй окно со следующими координатами</quote>,
        а сервер посылает в ответ сообщения типа <quote>Пользователь только что
        щёлкнул мышью на кнопке OK</quote>.</para>

      <para>Если в этом участвует только один компьютер, например, в случае
        использования дома или в офисе, сервер и клиенты X будут работать на
        том же самом компьютере.  Однако реально возможно запускать X-сервер
        на менее мощном настольном компьютере, а приложения X (клиенты) на,
        скажем, мощной и дорогой машине, обслуживающей целый офис.  В этом
        сценарии X-клиент и сервер общаются через сеть.</para>

      <para>Некоторых это вводит в заблуждение, потому что терминология X
        в точности обратна тому, что они ожидают.  Они полагают, что
        <quote>X-сервер</quote> будет большой мощной машиной, стоящей на полу,
        а <quote>X-клиентом</quote> является машина, стоящая на их
        столах.</para>

      <para>Запомните, что X-сервером является машина с монитором и
        клавиатурой, а X-клиенты являются программами, выводящими окна.</para>

      <para>В протоколе нет ничего, что заставляет машины клиента и сервера
        работать под управлением одной и той же операционной системы, или
        даже быть одним и тем же типом компьютера.  Определённо возможно
        запускать X-сервер в &microsoft.windows; или &macos; от Apple, и есть
        множество свободно распространяемых и коммерческих приложений, которые
        это реализуют.</para>

      <para>X-сервер, поставляемый с FreeBSD, называется
        <application>&xfree86;</application>, и он распространяется свободно
        под лицензией, очень похожей на условия рапространения FreeBSD.
        Имеются и коммерческие X-серверы для FreeBSD.</para>
    </sect2>

    <sect2>
      <title>Оконный менеджер</title>

      <para>Философия построения X очень похожа на философию построения &unix;,
	<quote>инструменты, не политика</quote>.  Это значит, что X не пытаются
        диктовать то, как должна быть выполнена работа.  Вместо этого
        пользователю предоставляются инструменты, а за пользователем остается
        принятие решения о том, как использовать эти инструменты.</para>

      <para>Этот подход расширен в X тем, что не задается, как окна должны
        выглядеть на экране, как их двигать мышью, какие комбинации клавиш
        должны использоваться для переключения между окнами (то есть
	<keycombo action="simul">
	  <keycap>Alt</keycap>
	  <keycap>Tab</keycap>
	</keycombo>, в случае использования &microsoft.windows;), как должны
        выглядеть зоголовки окон, должны ли в них быть кнопки для закрытия, и
        прочее.</para>

      <para>Вместо этого X делегирует ответственность за это приложению,
        которое называется <quote>Window Manager</quote> (Менеджер Окон).  Есть
        десятки оконных менеджеров для X: <application>AfterStep</application>,
        <application>Blackbox</application>, <application>ctwm</application>,
	<application>Enlightenment</application>,
        <application>fvwm</application>, <application>Sawfish</application>,
        <application>twm</application>,
	<application>WindowMaker</application> и другие.  Каждый из этих
        оконных менеджеров предоставляет различные внешние виды и удобства;
        некоторые из них поддерживают <quote>виртуальные рабочие столы</quote>;
        некоторые из них позволяют изменять назначения комбинаций
        клавиш, используемых для управления рабочим столом; в некоторых есть
        кнопка <quote>Start</quote> или нечто подобное; некоторые поддерживают
	<quote>темы</quote>, позволяя изменять внешний вид, поменяв тему.
        Эти оконные менеджеры, а также множество
        других, находятся в категории <filename>x11-wm</filename> коллекции
        Портов.</para>

      <para>Кроме того, оболочки <application>KDE</application> и
        <application>GNOME</application> обе имеют собственные оконные
        менеджеры, которые интегрированы с оболочкой.</para>

      <para>Каждый оконный менеджер также имеет собственный механизм настройки;
        некоторые предполагают наличие вручную созданного конфигурационного
        файла; некоторые предоставляют графические инструменты для выполнения
        большинства работ по настройке; по крайней мере один
	(<application>sawfish</application>) имеет конфигурационный файл,
        написанный на диалекте языка Lisp.</para>

      <note>
	<title>Политика фокусирования</title>

	<para>Другой особенностью, за которую отвечает оконный менеджер,
          является <quote>политика фокусирования</quote> мыши.  Каждая оконная
          система должна иметь некоторый способ выбора окна для активации
          получения нажатий клавиш, а также визуальную индикацию того, какое
          окно активно.</para>

	<para>Широкоизвестная политика фокусировки называется
          <quote>click-to-focus</quote>.  Эта модель используется в
          &microsoft.windows;, когда окно становится активным после получения
          щелчка мыши.</para>

	<para>X не поддерживает никакой конкретной политики фокусирования.
          Вместо этого менеджер окон управляет тем, какое окно владеет фокусом
          в каждый конкретный момент времени.  Различные оконные менеджеры
          подерживают разные методы фокусирования.  Все они поддерживают метод
          щелчка для фокусирования, и большинство из них поддерживают некоторые
          другие методы.</para>

	<para>Самыми популярными политики фокусирования являются:</para>

	<variablelist>
	  <varlistentry>
	    <term>focus-follows-mouse (фокус следует за мышью)</term>

	    <listitem>
	      <para>Фокусом владеет то окно, что находится под
                указателем мыши.  Это не обязательно будет окно, которое
                находится поверх всех остальных.  Фокус меняется при
                указании на другое окно, при этом также нет нужды щёлкать на
                нём.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>sloppy-focus (нечеткий фокус)</term>

	    <listitem>
	      <para>С политикой focus-follows-mouse если мышь помещается
                поверх корневого окна (или заднего фона), то никакое окно
                фокус не получает, а нажатия клавиш просто пропадают.
	        При использовании политики нечёткого фокуса он меняется
                только когда курсор попадает на новое окно, но не когда
                уходит с текущего окна.</para>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
            <term>щелчок для выбора фокуса</term>

	    <listitem>
              <para>Активное окно выбирается щелчком мыши.  Затем окно
                может быть <quote>поднято</quote> и появиться поверх всех
                других окон.  Все нажатия клавиш теперь будут направляться
                в это окно, даже если курсор переместится к другому.</para>
	    </listitem>
          </varlistentry>
	</variablelist>

	<para>Многие оконный менеджер поддерживают и другие политики, а также
          вариации перечисленных.  Обязательно обращайтесь к документации по
          оконному менеджеру.</para>
      </note>
    </sect2>

    <sect2>
      <title>Виджеты</title>

      <para>Подход X, заключающийся в предоставлении инструментов, а не
        политики, распространяется и на виджеты, которые располагаются на
        экране в каждом приложении.</para>

      <para><quote>Виджет</quote> (widget) является термином для всего в
        пользовательском интерфейсе, на чём можно
        щёлкать или каким-то образом управлять; кнопки, зависимые (radio
        buttons) и независимые (check boxes) кнопки, иконки, списки и так
        далее.  В &microsoft.windows; это называется <quote>элементами
        управления</quote> (<quote>controls</quote>).</para>

      <para>&microsoft.windows; и &macos; от Apple обе имеют очень жёсткую
        политику относительно виджетов.  Предполагается, что разрабатываемые
        приложения обязательно должны иметь похожий внешний вид.  Что касается
        X, то было решено, что не нужно требовать обязательного использования
        какого-то определённого графического стиля или набора виджетов.</para>

      <para>В результате не стоит ожидать от X-приложений
        похожести во внешнем виде.  Существует несколько популярных наборов
        виджетов и их разновидностей, включая оригинальный набор виджетов
        Athena от MIT, <application>&motif;</application> (по
        образу которого был разработан набор виджетов в &microsoft.windows;,
        все эти скошенные углы и три разновидности серого цвета),
        <application>OpenLook</application> и другие.</para>

      <para>В большинстве появляющихся в настоящее время приложений для X будет
        использоваться современно выглядящий набор виджетов, либо Qt,
        используемый в <application>KDE</application>, либо
        <application>GTK</application>, используемый проектом
        <application>GNOME</application>.  В этом отношении наблюдается
        унификация внешнего вида рабочего стола в &unix;, что определённо
        облегчает жизнь начинающему пользователю.</para>
    </sect2>
  </sect1>

  <sect1 id="x-install">
    <title>Установка &xfree86;</title>

    <para>Перед тем, как устанавливать <application>&xfree86;</application>,
      определитесь, с какой версией работать.  <application>&xfree86;
      3.X</application> является веткой разработки
      <application>&xfree86;</application>, находящейся в режиме только
      поддержки.  Она весьма стабильна и поддерживает огромное количество
      графичеких адаптеров.  Однако новых разработок в этом программном
      обеспечении не ведётся.  В <application>&xfree86; 4.X</application>
      архитектура системы была полностью пересмотрена, в ней появились новые
      возможности, такие, как улучшенная поддержка шрифтов и антиалиасинга.  К
      сожалению, эта новая архитектура требует переписывания драйверов видео, и
      некоторые из старых адаптеров, поддерживаемых в 3.X, пока не
      поддерживаются в 4.X.  Так как новые разработки и поддержка новых
      графических адаптеров выполняются в этой ветке, <application>&xfree86;
      4.X</application> теперь является стандартно используемой во FreeBSD
      версией X Window System.</para>

    <para>Программа установки FreeBSD предоставляет пользователям возможность
      установить и настроить <application>&xfree86; 4.X</application> во время
      установки (описано в <xref linkend="x-server">).  Для установки и запуска
      <application>&xfree86; 3.X</application> сначала нужно выполнить
      установку базовой системы FreeBSD, а затем установить
      <application>&xfree86;</application>.  К примеру, чтобы
      построить и установить <application>&xfree86; 3.X</application> из
      Коллекции Портов:</para>

    <screen>&prompt.root; <userinput>cd /usr/ports/x11/XFree86</userinput>
&prompt.root; <userinput>make all install clean</userinput></screen>

    <para>Как вариант, любая версия <application>&xfree86;</application> может
      быть установлена непосредственно из бинарных файлов для FreeBSD, которые
      размещены на <ulink
      url="http://www.XFree86.org/">веб-сайте &xfree86;</ulink>.  Для
      установки посредством утилиты &man.pkg.add.1; имеется также бинарный
      пакадж для <application>&xfree86; 4.X</application>.  При использовании
      возможности сгрузки по сети, предусмотренной в утилите &man.pkg.add.1;,
      номер версии пакаджа должен быть опущен.  &man.pkg.add.1; автоматически
      сгрузит самую последнюю версию приложения.  Таким образом, для сгрузки
      и установки пакаджа для <application>&xfree86; 4.X</application>, просто
      наберите:</para>

    <screen>&prompt.root; <userinput>pkg_add -r XFree86</userinput></screen>

    <para>Для установки <application>&xfree86; 4.X</application> вы можете
      также воспользоваться Коллекцией Портов, для чего вам нужно просто
      набрать следующие команды:</para>

    <screen>&prompt.root; <userinput>cd /usr/ports/x11/XFree86-4</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

    <note>
      <para>В примерах выше будет установлен полный дистрибутив
        <application>&xfree86;</application>, включая серверы, клиенты, шрифты
        и так далее.  Также доступны и отдельные пакаджи и порты для
        различных частей <application>&xfree86; 4.X</application>.</para>
    </note>

    <para>В оставшейся части главы будет рассказано о том, как сконфигурировать
      <application>&xfree86;</application> и настроить рабочее окружение.</para>

    <!-- Самым простым способом для XFree86 4.X является установка из
         sysinstall -->
  </sect1>

  <sect1 id="x-config">
    <sect1info>
      <authorgroup>
        <author>
          <firstname>Christopher</firstname>
          <surname>Shumway</surname>
          <contrib>Текст предоставил</contrib>
          <!-- Июль 2001 -->
        </author>
      </authorgroup>
    </sect1info>

    <title>Конфигурация &xfree86;</title>

    <indexterm><primary>XFree86 4.X</primary></indexterm>
    <indexterm><primary>XFree86</primary></indexterm>

    <sect2>
      <title>Перед тем, как начать</title>

      <para>Перед настройкой <application>&xfree86; 4.X</application>
        необходима следующая информация о конфигурируемой системе:</para>

      <itemizedlist>
	<listitem>
          <para>Характеристики монитора</para>
        </listitem>

	<listitem>
          <para>Набор микросхем, используемый в видеоадаптере</para>
        </listitem>

	<listitem>
          <para>Объём видеопамяти</para>
        </listitem>
      </itemizedlist>

      <indexterm>
        <primary>частота горизонтальной развертки</primary>
      </indexterm>

      <indexterm><primary>частота вертикальной развертки</primary></indexterm>

      <para>Характеристики монитора используются в
        <application>&xfree86;</application> для определения рабочего
        разрешения и частоты.  Эти характеристики обычно могут быть получены из
        документации, которая прилагается к монитору или с сайта производителя.
        Тут нужны два диапазона значений, для частоты горизонтальной развёртки
        и для частоты вертикальной синхронизации.</para>

      <para>Набор микросхем графического адаптера определяет, модуль какого
        драйвера использует <application>&xfree86;</application> для работы с
        графическим оборудованием.
        Для большинства типов микросхем это может быть определено
        автоматически, но все же его полезно знать на тот случай, когда
        автоматическое определение не работает правильно.</para>

      <para>Объём видеопамяти графического адаптера определяет разрешение и
        глубину цвета, с которым может работать система.  Это важно, чтобы
        пользователь знал ограничения системы.</para>
    </sect2>

    <sect2>
      <title>Конфигурирование &xfree86; 4.X</title>

      <para>Процесс настройки <application>&xfree86; 4.X</application> является
        многошаговым.  Первый шаг заключается в построении начального
        конфигурационного файла посредством запуска
        <application>&xfree86;</application> с параметром
        <option>-configure</option>.  Работая с правами суперпользователя,
        просто запустите:</para>

      <screen>&prompt.root; <userinput>XFree86 -configure</userinput></screen>

      <para>При этом в каталоге <filename>/root</filename> будет создан скелет
        конфигурационного файла <application>&xfree86;</application> под именем
        <filename>XF86Config.new</filename> (на самом деле в качестве каталога
        используется тот, что задан в переменной окружения
        <envar>$HOME</envar>, а она зависит от способа получения прав
        суперпользователя).  Программа <application>&xfree86;</application>
        сделает попытку распознать графическое оборудование системы и
        запишет конфигурационный файл, загружающий правильные драйверы для
        обнаруженного оборудования в системе.</para>

      <para>Следующим шагом является тестирование существующей конфигурации для
        проверки того, что <application>&xfree86;</application> может работать
        с графическим оборудованием в настраиваемой системе.  Для выполнения
        этой задачи пользователю нужно выполнить:</para>

      <screen>&prompt.root; <userinput>XFree86 -xf86config XF86Config.new</userinput></screen>

      <para>Если появилась чёрно-белая сетка и курсор мыши в виде
        X, то настройка была выполнена успешно.  Для завершения тестирования
        просто нажмите одновременно
        <keycombo action="simul">
          <keycap>Ctrl</keycap>
          <keycap>Alt</keycap>
          <keycap>Backspace</keycap>
        </keycombo>.</para>

      <note>
        <para>Если мышь не работает, удостоверьтесь, что соответствующее
          устройство было отконфигурировано.  Обратитесь к <xref
          linkend="mouse"> в главе об установке &os;.</para>
      </note>

      <indexterm><primary>Тонкая настройка XFree86 4</primary></indexterm>

      <para>Теперь выполните тонкую настройку в файле
	<filename>XF86Config.new</filename> по своему вкусу.
        Откройте файл в текстовом редакторе, таком, как	&man.emacs.1; или
        &man.ee.1;.  Сначала задайте частоты для
        монитора.  Они обычно обозначаются как частоты горизонатльной и
        вертикальной синхронизации.  Эти значения добавляются в файл
	<filename>XF86Config.new</filename> в
        раздел <literal>"Monitor"</literal>:</para>

      <programlisting>Section "Monitor"
        Identifier   "Monitor0"
        VendorName   "Monitor Vendor"
        ModelName    "Monitor Model"
        HorizSync    30-107
        VertRefresh  48-120
EndSection</programlisting>

      <para>Ключевых слов <varname>HorizSync</varname> и
        <varname>VertRefresh</varname> может и не оказаться в
        файле конфигурации.  Если их нет, то они должны быть добавлены, с
        указанием корректных значений горизонтальной частоты синхронизации
        после ключевого слова <varname>Horizsync</varname> и вертикальной
        частоты синхронизации после ключевого слова
        <varname>VertRefresh</varname>.  В примере выше были введены частоты
        монитора настраиваемой системы.</para>

      <para>X позволяет использовать возможности технологии DPMS (Energy Star)
        с поддерживающими её мониторами.  Программа &man.xset.1; управляет
        временными задержками и может явно задавать режимы ожидания, останова
        и выключения.  Если вы хотите включить использование возможностей
        DPMS вашего монитора, вы должны добавить следующую строку в раздел,
        описывающий монитор:</para>

      <programlisting>Option       "DPMS"</programlisting>

      <indexterm>
        <primary><command>XF86Config</command></primary>
      </indexterm>

      <para>Пока файл конфигурации <filename>XF86Config.new</filename> открыт
        в редакторе, выберите желаемые разрешение и глубину цвета, которые
        будут использоваться по умолчанию.  Они задаются в секции
        <literal>"Screen"</literal>:</para>

      <programlisting>Section "Screen"
        Identifier "Screen0"
        Device     "Card0"
        Monitor    "Monitor0"
        DefaultDepth 24
        SubSection "Display"
                Depth     24
                Modes     "1024x768"
        EndSubSection
EndSection</programlisting>

      <para>Ключевое слово <varname>DefaultDepth</varname> описывает
        глубину цвета, с которой будет работа по умолчанию.  Это значение
        может быть переопределено при помощи параметра командной строки
        <command>-bpp</command> для &man.XFree86.1;.  Ключевое слово
        <varname>Modes</varname> описывает разрешение, с которым нужно
        работать при данной глубине цвета.  Заметьте, что поддерживаются
        только те стандарные режимы VESA, что определены графическим
        оборудованием настраиваемой системы.  В примере выше глубина цвета по
        умолчанию равна двадцати четырём битам на пиксел.  При такой глубине
        цвета принимается разрешение в одну тысячу двадцать четыре на семьсот
        шестьдесят восемь точек.</para>

      <para>Наконец, запишите конфигурационный файл и
        протестируйте его при помощи тестового режима, описанного выше.  Если
        все в порядке, то конфигурационный файл нужно установить в
        общедоступное место, где его сможет найти &man.XFree86.1;.
	Обычно это <filename>/etc/X11/XF86Config</filename> или
	<filename>/usr/X11R6/etc/X11/XF86Config</filename>.</para>

      <screen>&prompt.root; <userinput>cp XF86Config.new /etc/X11/XF86Config</userinput></screen>

      <para>После того, как конфигурационный файл будет помешён в общедоступное
        место, настройка завершена.  Для запуска
        <application>&xfree86;</application> посредством &man.startx.1;
        установите порт <filename role="package">x11/wrapper</filename>.
        <application>&xfree86; 4.X</application> можно также запустить через
        &man.xdm.1;.</para>

      <note>
        <para>Имеется также графический инструмент для настройки,
          &man.xf86cfg.1;, который включён в дистрибутив
          <application>&xfree86; 4.X</application>.  Он позволяет выполнить
          настройку в интерактивном режиме посредством выбора соответствующих
          драйверов и настроек.  Эту программу можно использовать и в
          консольном режиме, просто нужно запустить её как <command>xf86cfg
          -textmode</command>.  Для получения более полной информации
          обратитесь к странице справочной системы &man.xf86cfg.1;.</para>
      </note>
    </sect2>

    <sect2>
      <title>Тонкие вопросы настройки</title>
      
      <sect3>
	<title>Конфигурирование при работе с графическими чипсетами &intel;
          i810</title>

        <indexterm><primary>графический чипсет Intel i810</primary></indexterm>

	<para>Конфигурирование при работе с интегрированными наборами микросхем
          &intel; i810 требует наличия <devicename>agpgart</devicename>,
          программного интерфейса AGP, посредством которого
          <application>&xfree86;</application> будет управлять адаптером.
          Драйвер &man.agp.4; присутствует в ядре <filename>GENERIC</filename>
          с момента выпуска 4.8-RELEASE и 5.0-RELEASE.  Для предшествующих
          релизов вам нужно добавлять такую строку:</para>

        <programlisting>device agp</programlisting>

        <para>в конфигурационный файл вашего ядра и перестраивать новое ядро.
          Однако вместо этого вы можете подгружать модуль ядра
          <filename>agp.ko</filename> автоматически во время загрузки системы
          при помощи &man.loader.8;.  Для этого просто добавьте следующую
          строку в файл <filename>/boot/loader.conf</filename>:</para>

	<programlisting>agp_load="YES"</programlisting>

	<para>Затем, в сдучае использования FreeBSD&nbsp;4.X или более ранних
          её версий, для программного интерфейса должен быть создан файл
          устройств.  Для создания файла устройств для AGP запустите
	  &man.MAKEDEV.8; в каталоге <filename>/dev</filename>:</para>

        <screen>&prompt.root; <userinput>cd /dev</userinput>
&prompt.root; <userinput>sh MAKEDEV agpgart</userinput></screen>

        <note>
          <para>Во FreeBSD&nbsp;5.X и более поздних версиях будет
            использоваться &man.devfs.5; для выделения файлов устройств в
            прозрачном режиме, поэтому шаг с &man.MAKEDEV.8; не нужен.</para>
        </note>

	<para>Это позволит конфигурировать графическое оборудование точно так
          же, как и любой другой графический адаптер.  Заметьте, что для
          систем, у которых драйвер &man.agp.4; в ядро не вкомпилирован,
          попытка погрузить модуль с помощью &man.kldload.8; окончится
          неудачно.  Этот драйвер должен оказаться в ядре во время загрузки,
          либо вкомпилированным, либо подгруженным посредством 
          <filename>/boot/loader.conf</filename>.</para>

        <para>Если вы используете <application>&xfree86; 4.1.0</application>
          (или более позднюю версию), и выдаются сообщения о неразрешённых
          ссылках типа <literal>fbPictureInit</literal>, попробуйте добавить
          такую строчку после <literal>Driver "i810"</literal> в
          конфигурационном файле <application>&xfree86;</application>:</para>

        <programlisting>Option "NoDDC"</programlisting>
      </sect3>
    </sect2>
  </sect1>

  <sect1 id="x-fonts">
    <sect1info>
      <authorgroup>
        <author>
          <firstname>Murray</firstname>
          <surname>Stokely</surname>
          <contrib>Текст предоставил</contrib>
        </author>
      </authorgroup>
    </sect1info>

    <title>Использование шрифтов в &xfree86;</title>

    <sect2 id="type1">
      <title>Шрифты Type1</title>

      <para>Шрифты, используемые по умолчанию и распространяемые вместе с
        <application>&xfree86;</application>, вряд ли можно назвать идеально
        подходящими для применения в обычных издательских приложениях.  Большие
        презентационные шрифты выглядят рвано и непрофессионально, а мелкие
        шрифты в <application>&netscape;</application> вообще невозможно
        разобрать.  Однако есть некоторое количество свободно распространяемых
        высококачественных шрифтов Type1 (&postscript;), которые можно без
        изменений использовать с <application>&xfree86;</application> как
        версии 3.X, так и 4.X.  К примеру, в наборе шрифтов URW
        (<filename role="package">x11-fonts/urwfonts</filename>) имеются
        высококачественные версии стандартных шрифтов type1 (<trademark
        class="registered">Times Roman</trademark>, <trademark
        class="registered">Helvetica</trademark>, <trademark
        class="registered">Palatino</trademark> и другие).  В набор Freefonts
        (<filename role="package">x11-fonts/freefonts</filename>) включено ещё
        больше шрифтов, однако большинство из них предназначено для
        использования в программном обеспечении для работы с графикой,
        например, <application>Gimp</application>, и они не вполне пригодны
        для использования в качестве
        экранных шрифтов.  Кроме того, <application>&xfree86;</application> с
        минимальными усилиями может быть настроена на использование шрифтов
        &truetype;: посмотрите <link linkend="truetype">раздел о шрифтах
        &truetype;</link> ниже.</para>

      <para>Для установки вышеупомянутых коллекций шрифтов Type1 из коллекции
        портов выполните следующие команды:</para>

      <screen>&prompt.root; <userinput>cd /usr/ports/x11-fonts/urwfonts</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

      <para>То же самое нужно будет сделать для коллекции freefont и других.
        Для указания X-серверу на
        существование этих шрифтов добавьте соответствующую строку в
        файл <filename>XF86Config</filename> (из каталога
        <filename>/etc/</filename> для <application>&xfree86;</application> для
        версии 3 или из каталога <filename>/etc/X11/</filename> для версии 4),
        которая должна выглядеть так:</para>

      <programlisting>FontPath "/usr/X11R6/lib/X11/fonts/URW/"</programlisting>

      <para>Либо из командной строки при работе с X выполните:</para>

      <screen>&prompt.user; <userinput>xset fp+ /usr/X11R6/lib/X11/fonts/URW</userinput>
&prompt.user; <userinput>xset fp rehash</userinput></screen>

      <para>Это сработает, но будет потеряно, когда сеанс работы с X будет
        закрыт, если эта команда не будет добавлена в начальный файл
        (<filename>~/.xinitrc</filename> в случае обычного сеанса через
        <command>startx</command>
        или <filename>~/.xsession</filename> при входе через графический
        менеджер типа <application>XDM</application>).  Третий способ
        заключается в использовании нового файла
        <filename>XftConfig</filename>: посмотрите раздел
        об <link linkend="antialias">антиалиасинге</link>.</para>
    </sect2>

    <sect2 id="truetype">
      <title>Шрифты &truetype;</title>

      <indexterm><primary>Шрифты TrueType</primary></indexterm>
      <indexterm>
        <primary>шрифты</primary>
        <secondary>TrueType</secondary>
      </indexterm>

      <para>В <application>&xfree86; 4.X</application> имеется встроенная
        поддержка шрифтов &truetype;.  Имеются два модуля, которые могут
        обеспечить эту функциональность.  В нашем примере используется модуль
        freetype, потому что он в большей степени похож на другие механизмы
        для работы с шрифтами.  Для включения модуля freetype достаточно в
        раздел <literal>"Module"</literal> файла
        <filename>/etc/X11/XF86Config</filename> добавить следующую
        строчку.</para>

      <programlisting>Load  "freetype"</programlisting>

      <para>В случае <application>&xfree86; 3.3.X</application> требуется
        отдельный сервер шрифтов &truetype;.  Для этого обычно
        используется <application>Xfstt</application>.  Для установки
        <application>Xfstt</application> просто установите порт
        <filename role="package">x11-servers/Xfstt</filename>.</para>

      <para>Теперь создайте каталог для шрифтов &truetype;
        (к примеру, <filename>/usr/X11R6/lib/X11/fonts/TrueType</filename>) и
        скопируйте все шрифты &truetype; в этот каталог.  Имейте в виду,
        что напрямую использовать шрифты &truetype; с &macintosh; нельзя;
        для использования с <application>&xfree86;</application> они должны
        быть в формате &unix;/DOS/&windows;.  После того, как файлы будут
        скопированы в этот каталог, воспользуйтесь утилитой
        <application>ttmkfdir</application> для создания файла
        <filename>fonts.dir</filename>, который укажет подсистеме вывода
        шрифтов X на местоположение этих новых файлов.
        <command>ttmkfdir</command> имеется в Коллекции Портов FreeBSD
        как <filename role="package">x11-fonts/ttmkfdir</filename>.</para>

      <screen>&prompt.root; <userinput>cd /usr/X11R6/lib/X11/fonts/TrueType</userinput>
&prompt.root; <userinput>ttmkfdir > fonts.dir</userinput></screen>

      <para>После этого добавьте каталог со шрифтами &truetype;
        к маршруту поиска шрифтов.  Это делается точно также, как описано выше
        для шрифтов <link linkend="type1">Type1</link>, то есть
        выполните</para>

      <screen>&prompt.user; <userinput>xset fp+ /usr/X11R6/lib/X11/fonts/TrueType</userinput>
&prompt.user; <userinput>xset fp rehash</userinput></screen>

      <para>или добавьте строку <option>FontPath</option> в файл
        <filename>XF86Config</filename>.</para>

      <para>Это всё.  Теперь <application>&netscape;</application>,
        <application>Gimp</application>,
        <application>&staroffice;</application> и все остальные X-приложения
        должны увидеть установленные шрифты &truetype;.  Очень маленькие (как
        текст веб-страницы на дисплее с высоким разрешением) и очень большие (в
        <application>&staroffice;</application>) шрифты будут теперь выглядеть
        гораздо лучше.</para>
    </sect2>

    <sect2 id="antialias">
      <sect2info>
        <authorgroup>
          <author>
            <firstname>Joe Marcus</firstname>

            <surname>Clarke</surname>

            <contrib>Обновление для &xfree86; 4.3 выполнил </contrib>
            <!-- Май 2003 -->
          </author>
        </authorgroup>
      </sect2info>

      <title>Антиалиасинг шрифтов</title>

      <indexterm>
        <primary>шрифты с антиалиасингом</primary>
      </indexterm>

      <indexterm>
        <primary>шрифты</primary>

        <secondary>антиалиасинг</secondary>
      </indexterm>

      <para>Анлиалиасинг присутствует в <application>&xfree86;</application>,
        начиная с версии 4.0.2.  Однако настройка шрифтов была довольно
        громоздка вплоть до появления <application>&xfree86;</application>
        4.3.0.  Начиная с версии 4.3.0, все шрифты, расположенные в каталогах
        <filename>/usr/X11R6/lib/X11/fonts/</filename> и
        <filename>~/.fonts/</filename>, автоматически становятся доступными для
        применения антиалиасинга в приложениях, использующих Xft.  Ещё не все
        приложения могут использовать Xft, но во многих его поддержка
        присутствует.  Примерами приложений, использующих Xft, является Qt
        версий 2.3 и более поздних (это инструментальный пакет для оболочки
        <application>KDE</application>), Gtk+ версий 2.0 и более поздних (это
        инструментальный пакет для оболочки <application>GNOME</application>),
        а также <application>Mozilla</application> версий 1.2 и более
        поздних.</para>

      <para>Для управления тем, к каким шрифтам применять антиалиасинг, а также
        для настройки параметров антиалиасинга, создайте (или отредактируйте,
        если он уже существует) файл
        <filename>/usr/X11R6/etc/fonts/local.conf</filename>.  Некоторые мощные
        возможности системы шрифтов Xft могут быть настроены при помощи этого
        файла; в этом разделе описаны лишь некоторые простые возможности.  Для
        выяснения всех деталей, пожалуйста, обратитесь к 
        &man.fonts-conf.5;.</para>

      <indexterm><primary>XML</primary></indexterm>

      <para>Этот файл должен быть сформирован в формате XML.  Обратите особое
        внимание на регистр символов, и удостоверьтесь, что все тэги корректно
        закрыты.  Файл начинается обычным заголовком XML, за которым следуют
        задание DOCTYPE, а потом
        тэг <literal>&lt;fontconfig&gt;</literal>:</para>

      <programlisting>
        &lt;?xml version="1.0"?&gt;
        &lt;!DOCTYPE fontconfig SYSTEM "fonts.dtd"&gt;
        &lt;fontconfig&gt;
      </programlisting>

      <para>Как и говорилось ранее, все шрифты из каталога
        <filename>/usr/X11R6/lib/X11/fonts/</filename>, а также
        <filename>~/.fonts/</filename> уже доступны для приложений,
        использующих Xft.  Если вы хотите добавить каталог, отличный от этих
        двух, добавьте строчку, подобную следующей, в файл
        <filename>/usr/X11R6/etc/fonts/local.conf</filename>:</para>

      <programlisting>&lt;dir&gt;/path/to/my/fonts&lt;/dir&gt;</programlisting>

      <para>После добавления новых шрифтов, и особенно новых каталогов со
        шрифтами, вы должны выполнить следующую команду для перестроения
        кэшей шрифтов:</para>

      <screen>&prompt.root; <userinput>fc-cache -f</userinput></screen>

      <para>Антиалиасинг делает границы несколько размытыми, что делает очень
        мелкий текст более читабельным и удаляет <quote>лесенки</quote> из
        текста большого размера, но может вызвать нечёткость при применении к
        тексту обычного размера.  Для исключения размеров, меньших 14, от
        антиалиасинга, добавьте такие строки:</para>

      <programlisting>        &lt;match target="font"&gt;
            &lt;test name="size" compare="less"&gt;
                &lt;double&gt;14&lt;/double&gt;
            &lt;/test&gt;
            &lt;edit name="antialias" mode="assign"&gt;
                &lt;bool&gt;false&lt;/bool&gt;
            &lt;/edit&gt;
        &lt;/match&gt;</programlisting>

      <indexterm>
        <primary>шрифты</primary>

        <secondary>межсимвольное расстояние</secondary>
      </indexterm>

      <para>Для некоторых моноширинных шрифтов антиалиасинг может также
        оказаться неприменимым при определении межсимвольного интервала.  В
        частности, эта проблема возникает с <application>KDE</application>.
        Одним из возможных решений для этого
        является жеское задание межсимвольного интервала в 100.  Добавьте
        следующие строки:</para>

      <programlisting>       &lt;match target="pattern" name="family"&gt;
           &lt;test qual="any" name="family"&gt;
               &lt;string&gt;fixed&lt;/string&gt;
           &lt;/test&gt;
           &lt;edit name="family" mode="assign"&gt;
               &lt;string&gt;mono&lt;/string&gt;
           &lt;/edit&gt;
        &lt;/match&gt;
        &lt;match target="pattern" name="family"&gt;
            &lt;test qual="any" name="family"&gt;
                &lt;string&gt;console&lt;/string&gt;
            &lt;/test&gt;
            &lt;edit name="family" mode="assign"&gt;
                &lt;string&gt;mono&lt;/string&gt;
            &lt;/edit&gt;
        &lt;/match&gt;</programlisting>

      <para>(это создаст алиасы для других общеупотребительных имён для
        шрифтов фиксированного размера как <literal>"mono"</literal>), а затем
        добавьте:</para>

      <programlisting>         &lt;match target="pattern" name="family"&gt;
             &lt;test qual="any" name="family"&gt;
                 &lt;string&gt;mono&lt;/string&gt;
             &lt;/test&gt;
             &lt;edit name="spacing" mode="assign"&gt;
                 &lt;int&gt;100&lt;/int&gt;
             &lt;/edit&gt;
         &lt;/match&gt;      </programlisting>

      <para>С некоторыми шрифтами, такими, как Helvetica, могут получиться
        проблемы при антиалиасинге.  Обычно это проявляется в виде шрифта,
        который наполовину вертикально обрезан.  Хуже того, это может
        привести к сбоям таких приложений, как
        <application>Mozilla</application>.  Во избежание этого следует
        добавить следующее в файл <filename>local.conf</filename>:</para>

      <programlisting>         &lt;match target="pattern" name="family"&gt;
             &lt;test qual="any" name="family"&gt;
                 &lt;string&gt;Helvetica&lt;/string&gt;
             &lt;/test&gt;
             &lt;edit name="family" mode="assign"&gt;
                 &lt;string&gt;sans-serif&lt;/string&gt;
             &lt;/edit&gt;
         &lt;/match&gt;        </programlisting>

      <para>После того, как вы закончите редактирование
        <filename>local.conf</filename>, удостоверьтесь, что вы завершили файл
        тэгом <literal>&lt;/fontconfig&gt;</literal>.  Если этого не сделать,
        то ваши изменения будут проигнорированы.</para>

      <para>Набор шрифтов по умолчанию, поставляемый с
        <application>&xfree86;</application>, не очень желателен, если
        включается антиалиасинг.  Гораздо лучший набор шрифтов, используемых
        по умолчанию, можно найти в порте
        <filename role="package">x11-fonts/bitstream-vera</filename>.  Этот
        порт установит файл
        <filename>/usr/X11R6/etc/fonts/local.conf</filename>, если такого ещё
        не существует.  Если файл существует, то порт создаст файл
        <filename>/usr/X11R6/etc/fonts/local.conf-vera</filename>.  Перенесите
        содержимое этого файла в
        <filename>/usr/X11R6/etc/fonts/local.conf</filename>, и шрифты
        Bitstream автоматически заменят используемые по умолчанию в
        <application>&xfree86;</application> шрифты Serif, Sans Serif и
        Monospaced.</para>

      <para>Наконец, пользователи могут добавлять собственные наборы
        посредством персональных файлов <filename>.fonts.conf</filename>.
        Для этого каждый пользователь должен просто создать файл
        <filename>~/.fonts.conf</filename>.  Этот файл также должен быть в
        формате XML.</para>

      <indexterm><primary>LCD-дисплей</primary></indexterm>

      <indexterm>
        <primary>Шрифты</primary>

        <secondary>LCD-дисплей</secondary>
      </indexterm>

      <para>И последнее замечание: при использовании дисплея LCD может
        понадобиться включение разбиения точек.  При этом компоненты красного,
        зелёного и голубого цветов (разделяемые по горизонтали),
        рассматриваются как отдельные точки для улучшения разрешения экрана
        по горизонтали; результат может оказаться потрясающим.  Для включения
        этого механизма добавьте такую строчку где-нибудь в файл
        <filename>local.conf</filename>:</para>

      <programlisting>
        &lt;match target="font"&gt;
            &lt;test qual="all" name="rgba"&gt;
                &lt;const&gt;unknown&lt;/const&gt;
            &lt;/test&gt;
            &lt;edit name="rgba" mode="assign"&gt;
                &lt;const&gt;rgb&lt;/const&gt;
            &lt;/edit&gt;
        &lt;/match&gt;
      </programlisting>

      <note>
        <para>В зависимости от типа дисплея, <literal>rgb</literal> может
          потребоваться заменить на <literal>bgr</literal>,
          <literal>vrgb</literal> или <literal>vbgr</literal>: пробуйте и
          смотрите, что работает лучше.</para>
      </note>

      <indexterm><primary>Mozilla</primary></indexterm>

      <indexterm>
        <primary>веб-браузеры</primary>

        <secondary>Mozilla</secondary>

        <see>Mozilla</see>
      </indexterm>

      <para>Антиалиасинг должен быть включен при следующем запуске X-сервера.
        Однако программы должны знать, как использовать его преимущества.
        В настоящее время инструментальный пакет Qt умеет ими пользоваться,
        так что вся оболочка <application>KDE</application> может
        использовать шрифты с антиалиасингом (обратитесь к <xref
        linkend="x11-wm-kde-antialias"> о <application>KDE</application> для
        выяснения всех подробностей).  Gtk+ и <application>GNOME</application>
        также можно заставить использовать антиалиасинг посредством капплета
        <quote>Font</quote> (обратитесь к <xref
        linkend="x11-wm-gnome-antialias"> для выяснения всех подробностей).
        По умолчанию <application>Mozilla</application> версий 1.2 и выше
        будет автоматически использовать антиалиасинг.  Для отмены этого
        перестройте <application>Mozilla</application> с флагом
        <makevar>-DWITHOUT_XFT</makevar>.</para>
    </sect2>
  </sect1>

  <sect1 id="x-xdm">
    <sect1info>
      <authorgroup>
        <author>
          <firstname>Seth</firstname>
          <surname>Kingsley</surname>
          <contrib>Текст предоставил</contrib>
        </author>
      </authorgroup>
    </sect1info>

    <title>Менеджеры Экранов (Display Managers) X</title>

    <sect2>
      <title>Вступление</title>

      <indexterm>
        <primary>X Display Manager</primary>
      </indexterm>

      <para>Менеджер Экранов X (<application>XDM</application>) это
        необязательный компонент
	Системы Окон X, который используется для управления login сессиями.
	Это полезно в ряде ситуаций, например минимальные
	<quote>X Терминалы</quote>,
	декстопы, большие сетевые сервера Экранов. Так как Система Окон X
	не зависит от сетей и протоколов, то существует множество различных
	конфигураций для X клиентов и серверов запущенных на различных
	компьютерах подключенных к сети.  <application>XDM</application>
        предоставляет графический
	интерфейс для выбора сервера к которому Вы желаете подключится и
	введения информации авторизующей пользователя, например комбинацию
	логина и пароля.</para>

      <para>Представляйте себе, что <application>XDM</application>
        предоставляет такие же
        возможности для пользователей, как и программа &man.getty.8;
	(смотрите <xref linkend="term-config"> для подробной информации).
	И это именно так, <application>XDM</application> производит вход в
        систему для подключенного
	пользователя и запускает управляющую сессию для пользователя (обычно
        это менеджер окон X). После этого <application>XDM</application>
        ожидает завершения
	приложения, означающее завершение пользователем работы и
	отключает управляющую сессию.  После этого
        <application>XDM</application> может снова вывести
	приглашение к входу в систему и ожидать входа другого пользователя.
      </para>
    </sect2>

    <sect2>
      <title>Использование XDM</title>

      <para>Программой даемона <application>XDM</application> является
        <filename>/usr/X11R6/bin/xdm</filename>.  Эта программа может быть
        запущена от пользователя <username>root</username> в любой момент, и
        она начнёт управлять дисплеем X на локальной машине.
        Если <application>XDM</application> нужно запускать
	в фоновом режиме каждый раз при запуске компьютера, то наиболее
	правильный способ это добавить новую запись в
	<filename>/etc/ttys</filename>. Для более подробной информации о
	формате и использовании этого файла смотрите секцию <xref
	linkend="term-etcttys">. Это строка, которую необходимо добавить
	в файл <filename>/etc/ttys</filename> для того чтобы запустить
	даемон <application>XDM</application> на виртуальном терминале:</para>

      <screen>ttyv8	"/usr/X11R6/bin/xdm -nodaemon"	xterm	off secure</screen>

      <para>По умолчанию эта запись отключена; для её включения
	нужно заменить пятое поле с <literal>off</literal> на
	<literal>on</literal> и перезапустить &man.init.8;, используя метод,
	описанный в <xref linkend="term-hup">.  Первое поле это название
	терминала, которым будет управлять программа, <literal>ttyv8</literal>.
	Это означает, что <application>XDM</application> будет запущен на 9ом
        виртуальном терминале.</para>    </sect2>

    <sect2>
      <title>Конфигурирование XDM</title>

      <para>Конфигурационные файлы <application>XDM</application> находятся в
        каталоге
	<filename>/usr/X11R6/lib/X11/xdm</filename>.  В нём размещаются
	насколько файлов, которые используются для изменения
	поведения и внешнего вида <application>XDM</application>.
        Обычно это следующие файлы:</para> 

        <informaltable frame="none">
	  <tgroup cols="2">
	    <thead>
	      <row>
		<entry>Файл</entry>
		<entry>Описание</entry>
	      </row>
	    </thead>

	    <tbody>
	      <row>
		<entry><filename>Xaccess</filename></entry>
		<entry>Правила авторизации клиентов.</entry>
	      </row>

	      <row>
		<entry><filename>Xresources</filename></entry>
		<entry>Значения ресурсов X по умолчанию.</entry>
	      </row>

	      <row>
		<entry><filename>Xservers</filename></entry>
		<entry>Список локальных и удаленных экранов.</entry>
	      </row>

	      <row>
		<entry><filename>Xsession</filename></entry>
		<entry>Сценарий сессии по умолчанию.</entry>
	      </row>

	      <row>
		<entry><filename>Xsetup_</filename>*</entry>

                <entry>Скрипт для запуска приложений до появления приглашения
                  к входу в систему.</entry>
	      </row>

	      <row>
		<entry><filename>xdm-config</filename></entry>
		<entry>Глобальный конфигурационный файл для всех экранов
		  запущенных на локальной машине</entry>
	      </row>

	      <row>
		<entry><filename>xdm-errors</filename></entry>
		<entry>Ошибки сгенерированные серверной программой.</entry>
	      </row>

	      <row>
		<entry><filename>xdm-pid</filename></entry>
		<entry>ID процесса запущенного XDM.</entry>
	      </row>
	    </tbody>
	  </tgroup>
	</informaltable>

      <para>В этом каталоге также находятся несколько командных сценариев
	и програм используемых для настройки рабочего стола (desktop),
	когда запускается <application>XDM</application>.  Назначение
        каждого из этих файлов будет вкратце описано.  Точный синтаксис и
        информацию по их использованию описаны в &man.xdm.1;.</para>

      <para>В конфигурации по умолчанию это просто прямоугольное окно
        приглашения ко входу в систему с именем компьютера большим шрифтом
	написанным сверху и строками ввода <quote>Login:</quote> и
	<quote>Password:</quote> внизу. Это хорошая отправная точка
	для изменения внешнего вида экранов
        <application>XDM</application>.</para>

      <sect3>
	<title>Xaccess</title>

	<para>Протокол, по которому происходит подключение дисплеев,
	  управляемых <application>XDM</application>, называется X Display
          Manager Connection
	  Protocol (XDMCP).  Этот файл представляет собой
	  набор правил для управления XDMCP соединениями с
	  удалёнными машинами.  По умолчанию он позволяет подключаться
	  любым клиентам, но это не имеет значения, пока
	  стандартный файл <filename>xdm-config</filename> не содержит
	  указаний по обслуживанию удалённых соединений.</para>
      </sect3>

      <sect3>
	<title>Xresources</title>

	<para>Это файл содержащий установки по умолчанию для
	  приложений запущенных в экране выбора серверов и экране
	  приглашения к входу в систему. Именно здесь может быть
	  изменён вид программы входа в систему. Формат этого файла
	  идентичен файлу <filename>app-defaults</filename> описанному
	  в документации к <application>&xfree86;</application>.</para>
      </sect3>

      <sect3>
	<title>Xservers</title>

	<para>Это список удаленных экранов, которые XDM должен предоставить
	  как варианты для входа в систему.</para>
      </sect3>

      <sect3>
	<title>Xsession</title>
	<para>Этот файл представляет себя командный сценарий по умолчанию
	  для пользователей вошедших в систему с использованием
          <application>XDM</application>.
	  Обычно каждый пользователь имеет собственный сценарий входа в файле
	  <filename>~/.xsession</filename>, который используется
	  вместо этого сценария.</para>
      </sect3>

      <sect3>
	<title>Xsetup_*</title>
	<para>Они запускаются автоматически перед тем, как показывается экран
	  выбора сервера или экран входа в систему. Для каждого экрана
	  (display) есть свой сценарий с именем <filename>Xsetup_</filename>,
          за которым следует локальный номер экрана (например,
          <filename>Xsetup_0</filename>).
	  Обычно эти сценарии запускают одну или две программы в
	  фоновом режиме, например <command>xconsole</command>.</para>
      </sect3>

      <sect3>
	<title>xdm-config</title>

	<para>Здесь содержатся настройки в формате app-defaults,
	  которые применимы ко всем экранам данного компьютера.</para>
      </sect3>

      <sect3>
	<title>xdm-errors</title>

	<para>Здесь находится выдача X серверов, которые
	  <application>XDM</application> пытается запустить.  Если экран,
          который <application>XDM</application> пытается
	  открыть отключается по некоторым причинам, то это хорошее
	  место для поиска сообщений об ошибках. Эти сообщения также
	  записываются в пользовательский файл
	  <filename>~/.xsession-errors</filename> для каждого сеанса.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Использование сетевого сервера дисплеев</title>

      <para>Для того, чтобы позволить другим клиентам подключаться к серверу
        дисплеев, отредактируйте правила
	контроля доступа и включите обслуживание сетевых соединений.
	По умолчанию они выключены, что является хорошим решением
	с точки зрения обеспечения безопасности.  Для того, чтобы
	позволить <application>XDM</application> принимать сетевые соединения,
        в первую очередь
	закомментируйте строку в файле <filename>xdm-config</filename>:</para>

      <screen>! SECURITY: do not listen for XDMCP or Chooser requests
! Comment out this line if you want to manage X terminals with xdm
DisplayManager.requestPort:     0</screen>

      <para>и потом перезапустите <application>XDM</application>.  Помните,
        что комментарии в файлах app-defaults начинаются с символа
        <quote>!</quote>, а не как обычно, <quote>#</quote>.  Может
        потребоваться более жёсткий контроль доступа.  Взгляните на примеры из
        <filename>Xaccess</filename> и почитайте Справочник о
        &man.xdm.1;.</para>
    </sect2>

    <sect2>
      <title>Замены для XDM</title>

      <para>Существует несколько программ, заменяющих
        <application>XDM</application>.  Одна из них,
        <application>KDM</application> (поставляемая вместе с
        <application>KDE</application>), описана далее в этой главе.  В
        <application>KDM</application> имеется много визуальных и
        косметических улучшений, а также функциональность, позволяющая
        пользователям выбирать собственные оконные менеджеры во время
        входа в систему.</para>
    </sect2>
  </sect1>

  <sect1 id="x11-wm">
    <sect1info>
      <authorgroup>
        <author>
          <firstname>Valentino</firstname>
          <surname>Vaschetto</surname>
          <contrib>Текст предоставил</contrib>
        </author>
        <!-- Июнь 2001 -->
      </authorgroup>
    </sect1info>

    <title>Графические оболочки</title>

    <para>В этом разделе описываются различные графические оболочки, доступные
      в X для FreeBSD.  Термин <quote>графическая оболочка</quote> может
      использоваться для чего угодно, от простого менеджера окон до
      полнофункционального набора приложений для рабочего стола типа
      <application>KDE</application> или
      <application>GNOME</application>.</para>

    <sect2 id="x11-wm-gnome">
      <title>GNOME</title>

      <sect3 id="x11-wm-gnome-about">
        <title>О GNOME</title>

        <indexterm><primary>GNOME</primary></indexterm>

        <para><application>GNOME</application> является дружественной к
          пользователю графической
          оболочкой, позволяющей пользователям легко использовать и настраивать
          свои компьютеры.  В <application>GNOME</application> имеется панель
          (для запуска приложений и
          отображения их состояния), рабочий стол (где могут быть размещены
          данные и приложения), набор стандартных инструментов и приложений для
          рабочего стола, а также набор соглашений, облегчающих совместную
          работу и согласованность приложений.  Пользователи других
          операционных систем или оболочек при использовании такой мощной
          графической оболочки, какую обеспечивает
          <application>GNOME</application>, должны чувствовать
          себя в родной среде.  Дополнительную информацию относительно
          <application>GNOME</application> во FreeBSD можно найти на сайте
          <ulink url="http://www.FreeBSD.org/gnome">FreeBSD GNOME
          Project</ulink>.</para>
      </sect3>

      <sect3 id="x11-wm-gnome-install">
        <title>Установка GNOME</title>

        <para>Легче всего установить <application>GNOME</application> через
          меню <quote>Desktop Configuration</quote> в ходе процесса установки
          FreeBSD, как описано в разделе <xref linkend="default-desktop">
          Главы&nbsp;2.  Её также легко установить из пакаджа или Коллекции
          Портов:</para>

        <para>Для установки пакаджа <application>GNOME</application> из сети,
          просто наберите:</para>

        <screen>&prompt.root; <userinput>pkg_add -r gnome2</userinput></screen>

        <para>Для построения <application>GNOME</application> из
          исходных текстов используйте дерево портов:</para>

        <screen>&prompt.root; <userinput>cd /usr/ports/x11/gnome2</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

        <para>После установки <application>GNOME</application> нужно указать
          X-серверу на запуск <application>GNOME</application> вместо
          стандартного оконного менеджера.  Если файл
          <filename>.xinitrc</filename> уже откорректирован, то просто
          замените строку, в которой запускается используемый менеджер окон,
          на ту, что вызовет
          <application>/usr/X11R6/bin/gnome-session</application>.
          Если в конфигурационном файле нет ничего особенного, то будет
          достаточно просто набрать:</para>

        <screen>&prompt.user; <userinput>echo "/usr/X11R6/bin/gnome-session" &gt; ~/.xinitrc</userinput></screen>

        <para>Теперь наберите <command>startx</command>, и будет запущена
          графическая оболочка <application>GNOME</application>.</para>

        <note>
          <para>Если используется менеджер дисплеев типа
            <application>XDM</application>, то это не сработает.  Вместо этого
            создайте выполнимый файл <filename>.xsession</filename> с той
            же самой командой в нём.  Для этого отредактируйте файл,
            заменив существующую команду запуска оконного
            менеджера на
            <application>/usr/X11R6/bin/gnome-session</application>:</para>
        </note>

        <screen>&prompt.user; <userinput>echo "#!/bin/sh" > ~/.xsession</userinput>
&prompt.user; <userinput>echo "/usr/X11R6/bin/gnome-session" >> ~/.xsession</userinput>
&prompt.user; <userinput>chmod +x ~/.xsession</userinput></screen>

        <para>Ещё одним вариантом является настройка менеджера дисплеев таким
          образом, чтобы он позволял выбирать оконный менеджер во время входа в
          систему; в разделе о <link linkend="x11-wm-kde-details">KDE2 в
          подробностях</link> описывается, как сделать это для
          <application>kdm</application>, менеджера дисплеев из
          <application>KDE</application>.</para>
      </sect3>

      <sect3 id="x11-wm-gnome-antialias">
        <title>Шрифты с антиалиасингом и GNOME</title>

        <indexterm>
          <primary>GNOME</primary>

          <secondary>антиалиасинг шрифтов</secondary>
        </indexterm>

        <para>Начиная с версии 4.0.2, <application>&xfree86;</application>
          поддерживает антиалиасинг посредством своего расширения
          <quote>RENDER</quote>.  Gtk+ 2.0 и более поздние версии (это
          инструментальный пакет, используемый
          <application>GNOME</application>) могут использовать такую
          функциональность.  настройка антиалиасинга описана в
          <xref linkend="antialias">.  Таким образом, при наличии современного
          <application>GNOME</application>.  Просто перейдите в
          <menuchoice>
            <guimenu>Applications</guimenu>
            <guisubmenu>Desktop Preferences</guisubmenu>
            <guimenuitem>Font</guimenuitem></menuchoice>
          и выберите либо
          <guibutton>Best shapes</guibutton>,
          <guibutton>Best contrast</guibutton>, либо
          <guibutton>Subpixel smoothing (LCDs)</guibutton>.  Для приложений
          Gtk+, которые не являются частью оболочки
          <application>GNOME</application>, задайте в качестве значения
          переменной окружения <varname>GDK_USE_XFT</varname>
          <literal>1</literal> перед запуском программы.</para>
      </sect3>
    </sect2>

    <sect2 id="x11-wm-kde">
      <title>KDE</title>

      <indexterm><primary>KDE</primary></indexterm>

      <sect3 id="x11-wm-kde-about">
        <title>О KDE</title>

        <para><application>KDE</application> является простой в использовании
          современной графической оболочкой.  Вот лишь некоторое из того, что
          даёт пользователю <application>KDE</application>:</para>

        <itemizedlist>
          <listitem>
            <para>Прекрасный современный рабочий стол</para>
          </listitem>

          <listitem>
            <para>Рабочий стол, полностью прозрачный для работы в сети</para>
          </listitem>

          <listitem>
            <para>Интегрированная система помощи, обеспечивающая удобный и
              согласованный доступ к системе помощи по использованию рабочего
              стола <application>KDE</application> и его приложений</para>
          </listitem>

          <listitem>
            <para>Единообразный внешний вид и управление во всех приложениях
              <application>KDE</application></para>
          </listitem>

          <listitem>
            <para>Стандартизированные меню и панели инструментов, комбинации
              клавиш, цветовые схемы и так далее.</para>
          </listitem>

          <listitem>
            <para>Интернационализация: в <application>KDE</application>
              поддерживается более 40 языков</para>
          </listitem>

          <listitem>
            <para>Централизованное единообразное конфигурирование рабочего
              стола в диалоговом режиме</para>
          </listitem>

          <listitem>
            <para>Большое количество полезных приложений для
              <application>KDE</application></para>
          </listitem>
        </itemizedlist>

        <para>Для <application>KDE</application> существует пакет офисных
          приложений, который выполнен по технологии <quote>KParts</quote> из
          <application>KDE</application>, состоящий из программы для работы с
          электронными таблицами, презентационной программы, органайзера,
          клиента для чтения телеконференций и других программ.  С
          <application>KDE</application> также поставляется веб-браузер под
          названием <application>Konqueror</application>, который
          является серьезным соперником другим браузерам для &unix;-систем.
          Дополнительную информацию о <application>KDE</application> можно
          найти на <ulink url="http://www.kde.org/">веб-сайте
          KDE</ulink>.  Для получения информации и информационных ресурсов,
          специфичных для <application>KDE</application> во FreeBSD, обратитесь
          к сайту команды <ulink url="http://freebsd.kde.org/">FreeBSD-KDE
          team</ulink>.</para>
      </sect3>

      <sect3 id="x11-wm-kde-install">
        <title>Установка KDE</title>

        <para>Как и в случае с <application>GNOME</application> или любой
          другой графической оболочкой, легче всего установить
          <application>KDE</application> через меню <quote>Desktop
          Configuration</quote> во время установки FreeBSD, как это описано в
          разделе <xref linkend="default-desktop"> Главы 2.  Повторимся ещё
          раз, что программное обеспечение можно легко установить из пакаджа
          или из Коллекции Портов:</para>

        <para>Для установки пакаджа <application>KDE</application> из сети,
          просто наберите:</para>

        <screen>&prompt.root; <userinput>pkg_add -r kde</userinput></screen>

        <para>&man.pkg.add.1; автоматически сгрузит самую последнюю версию
          приложения.</para>

        <para>Для построения <application>KDE</application> из исходных
          текстов воспользуйтесь деревом портов:</para>

        <screen>&prompt.root; <userinput>cd /usr/ports/x11/kde3</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

        <para>После установки <application>KDE</application> нужно
          указать X-серверу на запуск этого приложения вместо оконного
          менеджера, используемого по умолчанию.  Это достигается
          редактированием файла <filename>.xinitrc</filename>:</para>

        <screen>&prompt.user; <userinput>echo "exec startkde" &gt; ~/.xinitrc</userinput></screen>

        <para>Теперь при вызове X Window System по команде
          <command>startx</command> в качестве оболочки будет использоваться
          <application>KDE</application>.</para>

        <para>При использовании менеджера дисплеев типа
          <application>xdm</application> настройка несколько отличается.
          Вместо этого нужно отредактировать файл
          <filename>.xsession</filename>.  Указания для
          <application>kdm</application> описаны далее в этой главе.</para>
      </sect3>
    </sect2>

    <sect2 id="x11-wm-kde-details">
      <title>Более подробно о KDE</title>

      <para>Теперь, когда <application>KDE</application> установлена в
        системе, можно узнать много нового из её справочных страниц или просто
        указанием и щелканием по различным меню.  Пользователи &windows; или
        &mac; будут чувствовать себя как дома.</para>

      <para>Лучшим справочником по <application>KDE</application> является
        онлайновая документация.  <application>KDE</application>
        поставляется с собственным веб-браузером, который называется
        <application>Konqueror</application>,
        десятками полезных приложений и подробной документацией.  В оставшейся
        части этого раздела обсуждаются технические вопросы, трудные для
        понимания при случайном исследовании.</para>

      <sect3 id="x11-wm-kde-kdm">
        <title>Менеджер дисплеев KDE</title>

        <indexterm>
          <primary>KDE</primary>

          <secondary>менеджер дисплеев</secondary>
        </indexterm>

        <para>Администратору многопользовательской системы может
          потребоваться графический экран входа в систему для
          приглашения пользователей.  Вы можете использовать <link
          linkend="x-xdm"><filename>xdm</filename></link>, как это описано
          ранее.  Однако в <application>KDE</application> имеется
          альтернативный менеджер <application>kdm</application>, который был
          разработан для того, чтобы выглядеть более привлекательно и иметь
          большее количество настраиваемых опций для входа в систему.  В
          частности, пользователи могут легко выбирать (посредством меню),
          какую оболочку (<application>KDE</application>,
          <application>GNOME</application> или что-то ещё) запускать после
          входа в систему.</para>

        <para>Чтобы начать, запустите панель управления
          <application>KDE</application>, <command>kcontrol</command>, из-под
          пользователя <username>root</username>.  Вообще говоря, считается
          небезопасным работать в X пользвателем
          <username>root</username>.  Вместо этого запустите менеджер окон
          как обычный пользователь, откройте окно терминала (такого, как
          <filename>xterm</filename> или <filename>konsole</filename>) из
          <application>KDE</application>, станьте пользователем
          <username>root</username> по команде <userinput>su</userinput> (для
          этого нужно быть членом группы <groupname>wheel</groupname> из
          <filename>/etc/group</filename>), а затем наберите
          <userinput>kcontrol</userinput>.</para>

        <para>Щёлкните на иконке слева с надписью
          <guibutton>System</guibutton>, затем на <guibutton>Login
          manager</guibutton>.  Справа имеется много
          различных параметров настройки, которые более детально описаны в
          руководстве по <application>KDE</application>.  Щёлкните на
          <guibutton>sessions</guibutton> справа.  Щёлкните на кнопку
          <guibutton>New type</guibutton> для того, чтобы добавить
          различные оконные менеджеры и графические оболочки.  Это просто
          названия, так что они могут именоваться
          <application>KDE</application> или <application>GNOME</application>,
          а не <application>startkde</application> или
          <application>gnome-session</application>.)
          Включите название <literal>failsafe</literal>.</para>

        <para>Поэкспериментируйте также и с другими меню, они в
          основном носят косметический характер и самоописательны.  Когда
          закончите, щёлкните на <guibutton>Apply</guibutton> внизу и завершите
          работу панели управления.</para>

        <para>Чтобы <application>kdm</application> понимал, что значат эти
          названия (<application>KDE</application>,
          <application>GNOME</application> и так далее), отредактируйте файлы,
          которые использует <link linkend="x-xdm">xdm</link>.

          <note>
            <para>В <application>KDE 2.2</application> это изменилось: в
              <application>kdm</application> теперь используются собственные
              конфигурационные файлы.  Пожалуйста, обратитесь к документации
              по <application>KDE 2.2</application> для получения подробной
              информации.</para>
          </note>

        <para>В окне терминала, работая как пользователь
          <username>root</username>, отредактируйте файл
          <filename>/usr/X11R6/lib/X11/xdm/Xsession</filename>.  В середине
          есть раздел, выглядящий вот так:</para>

        <screen>case $# in
1)
        case $1 in
	failsafe)
                exec xterm -geometry 80x24-0-0
                ;;
        esac
esac</screen>

        <para>Нужно добавить к этому разделу несколько строк.  Полагая, что
          ранее использовались названия <quote>KDE</quote> и
          <quote>GNOME</quote>, сделаем следующее:</para>

        <screen>case $# in
1)
        case $1 in
        kde)
                exec /usr/local/bin/startkde
                ;;
        GNOME)
                exec /usr/X11R6/bin/gnome-session
                ;;
        failsafe)
                exec xterm -geometry 80x24-0-0
                ;;
esac
esac</screen>

        <para>Чтобы выбор <application>KDE</application> в качестве оболочки
          на момент входа в систему был принят, нужно добавить такую строку в
          <filename>/usr/X11R6/lib/X11/xdm/Xsetup_0</filename>:</para>

        <screen>/usr/local/bin/kdmdesktop</screen>

        <para>Теперь проверьте, что
          <application>kdm</application> перечислена в файле
          <filename>/etc/ttys</filename> для запуска при следующей загрузке.
          Для этого просто следуйте инструкциям из предыдущего раздела
          о <link linkend="x-xdm">xdm</link>, заменив отсылки к программе
          <command>/usr/X11R6/bin/xdm</command> на
          <command>/usr/local/bin/kdm</command>.</para>
      </sect3>

      <sect3 id="x11-wm-kde-antialias">
        <title>Шрифты с антиалиасингом</title>

        <indexterm>
          <primary>KDE</primary>

          <secondary>антиалиасинг шрифтов</secondary>
        </indexterm>

        <para>Начиная с версии 4.0.2, <application>&xfree86;</application>
          поддерживает антиалиасинг через своё расширение
          <quote>RENDER</quote>, а начиная с версии 2.3, Qt (инструментарий,
          используемый в <application>KDE</application>) поддерживает это
          расширение.  Настройка этого описана в <xref linkend="antialias"> по
          антиалиасингу с шрифтами X11.  Таким образом, при работе с
          современным программным обеспечением в оболочке
          <application>KDE</application> возможно использование
          антиалиасинга.  Просто перейдите в меню KDE, затем к
          <menuchoice>
            <guimenu>Preferences</guimenu>
            <guisubmenu>Look and Feel</guisubmenu>
            <guimenuitem>Fonts</guimenuitem></menuchoice>
          и поставьте галочку рядом с
          <guibutton>Use Anti-Aliasing for Fonts and Icons</guibutton>.  Для
          работы с приложением Qt, которое не является частью
          <application>KDE</application>, перед его запуском нужно
          устанавливать переменную окружения <varname>QT_XFT</varname> в
          значение <literal>true</literal>.</para>
      </sect3>
    </sect2>

    <sect2 id="x11-wm-xfce">
      <title>XFce</title>

      <sect3 id="x11-wm-xfce-about">
        <title>О XFce</title>

        <para><application>XFce</application> является графической оболочкой,
          построенной на основе инструментального пакета GTK, используемого в
          <application>GNOME</application>, но гораздо легче и предназначен
          для тех, кому нужен простой, эффективно работающий рабочий стол,
          который легко использовать и настраивать.  Визуально он выглядит
          очень похоже на <application>CDE</application>, который есть в
          коммерческих &unix;-системах.  Вот некоторые из достоинств
          <application>XFce</application>:</para>

        <itemizedlist>
          <listitem>
            <para>Простой, лёгкий в обращении рабочий стол</para>
          </listitem>

          <listitem>
            <para>Полностью настраиваемый при помощи мыши, с
              интерфесом drag and drop и так далее</para>
          </listitem>

          <listitem>
            <para>Главная панель похожа на <application>CDE</application>, с
              меню, апплетами и возможностями по быстрому запуску
              приложений</para>
          </listitem>

          <listitem>
            <para>Интегрированный оконный менеджер, менеджер файлов,
              управление звуком, модуль совместимости с
              <application>GNOME</application> и прочее</para>
          </listitem>

          <listitem>
            <para>Возможность использования тем (так как использует
              GTK)</para>
          </listitem>

          <listitem>
            <para>Быстрый, легкий и эффективный: идеален для
              устаревших/слабых машин или для машин с ограниченной
              памятью</para>
          </listitem>
        </itemizedlist>

        <para>Дополнительную информацию о <application>XFce</application>
          можно найти на <ulink url="http://www.xfce.org/">сайте
          XFce</ulink>.</para>
      </sect3>

      <sect3 id="x11-wm-xfce-install">
        <title>Установка XFce</title>

        <para>Для <application>XFce</application> имеется (на момент написания
          этого текста) бинарный пакадж.  Для его установки просто
          наберите:</para>

        <screen>&prompt.root; <userinput>pkg_add -r xfce4</userinput></screen>

        <para>Либо в случае построения из исходных текстов используйте
          Коллекцию Портов: </para>

        <screen>&prompt.root; <userinput>cd /usr/ports/x11-wm/xfce4</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

        <para>Теперь укажите X-серверу на запуск
          <application>XFce</application> при следующем
          запуске X.  Просто наберите вот что:</para>

        <screen>&prompt.user; <userinput>echo "/usr/X11R6/bin/startxfce" &gt; ~/.xinitrc</userinput></screen>

        <para>При следующем запуске X в качестве рабочего стола
          будет использоваться <application>XFce</application>.
          Как это сказано выше, если используется
          менеджер дисплеев, такой, как <filename>xdm</filename>, создайте
          файл <filename>.xsession</filename> так, как это
          описано в разделе о <link linkend="x11-wm-gnome">GNOME</link>, но
          с командой <filename>/usr/X11R6/bin/startxfce</filename>, либо
          настройте менеджер дисплеев так, чтобы он разрешил выбор рабочего
          стола во время входа в систему, как это описано в разделе о <link
          linkend="x11-wm-kde-kdm">kdm</link>.</para>
      </sect3>
    </sect2>
  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->

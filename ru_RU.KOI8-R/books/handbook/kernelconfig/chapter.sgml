<!--
     The FreeBSD Russian Documentation Project

     $FreeBSD$
     $FreeBSDru: frdp/doc/ru_RU.KOI8-R/books/handbook/kernelconfig/chapter.sgml,v 1.35 2007/06/26 11:42:42 den Exp $

     Original revision: r37856
-->

<chapter id="kernelconfig">
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Jim</firstname>
	<surname>Mock</surname>
	<contrib>Обновил и реструктуризовал </contrib>
	<!-- Mar 2000 -->
      </author>
    </authorgroup>
    <authorgroup>
      <author>
	<firstname>Jake</firstname>
	<surname>Hamby</surname>
	<contrib>Предоставил </contrib>
	<!-- 6 Oct 1995 -->
      </author>
    </authorgroup>
    <authorgroup>
      <author>
	<firstname>Александром</firstname>
	<surname>Коваленко</surname>
	<contrib>Переведено </contrib>
      </author>
    </authorgroup>
  </chapterinfo>

  <title>Настройка ядра FreeBSD</title>

  <sect1 id="kernelconfig-synopsis">
    <title>Краткий обзор</title>

    <indexterm>
      <primary>kernel</primary>
      <secondary>сборка собственного ядра</secondary>
    </indexterm>

    <para>Ядро &mdash; это основная часть операционной системы &os;.  Оно
      ответственно за управление памятью, параметры безопасности, работу с
      сетью, доступ к дискам и многое другое.  Несмотря на то, что &os;
      становится всё более динамически конфигурируемой, иногда приходится
      собирать собственное ядро.</para>

    <para>После прочтения этой главы вы узнаете:</para>

    <itemizedlist>
      <listitem>
	<para>Почему вам может понадобиться сборка собственного ядра.</para>
      </listitem>

      <listitem>
	<para>Как написать файл конфигурации ядра или изменить
	  существующий.</para>
      </listitem>

      <listitem>
	<para>Как использовать файл конфигурации ядра для того, чтобы создать и
	  собрать новое ядро.</para>
      </listitem>

      <listitem>
	<para>Как установить новое ядро.</para>
      </listitem>

      <listitem>
	<para>Что делать, если что-то не работает или работает не так, как
	  должно.</para>
      </listitem>
    </itemizedlist>

    <para>Все команды, приводимые в этой главе в качестве примера,
      должны выполняться от пользователя <username>root</username>.</para>
  </sect1>

  <sect1 id="kernelconfig-custom-kernel">
    <title>Зачем собирать собственное ядро?</title>

    <para>Традиционно в &os; использовалось так называемое
      <quote>монолитное</quote> ядро.  Это означает, что ядро &mdash; это одна
      большая программа, которая поддерживает фиксированный набор устройств и в
      случае, если необходимо изменить его поведение, требуется сборка нового
      ядра и перезагрузка компьютера уже с новым ядром.</para>

    <para>На сегодняшний день &os; быстро продвигается к модели, в которой
      большая часть функциональности содержится в модулях, которые могут быть
      при необходимости динамически загружены и выгружены из ядра.  Это
      позволяет ядру использовать устройства, которые <quote>внезапно</quote>
      появились в системе (например, устройства PCMCIA в лэптопе) или добавлять
      новую функциональность в ядро, которая не была необходима в момент
      первоначальной сборки ядра.  Такой подход известен как модульность
      ядра.</para>

    <para>Несмотря на это, всё ещё иногда бывает необходимо, чтобы некоторая
      функциональность была вкомпилирована в ядро статически.  В некоторых
      случаях это продиктовано тем, что эта функциональность настолько сильно
      привязана к ядру, что не может быть динамически загружаемой.  В других
      случаях это может быть просто потому, что никто не уделил время
      написанию динамически загружаемого модуля для этой
      функциональности.</para>

    <para>Сборка собственного ядра &mdash; один из наиболее важных ритуалов,
      совершаемых опытными пользователями BSD.  Несмотря на
      длительность этого процесса, ваша &os; останется только в выигрыше.  В
      отличие от ядра <filename>GENERIC</filename>, которое должно поддерживать
      широкий спектр аппаратного обеспечения, собственное ядро содержит поддержку
      аппаратного обеспечения только <emphasis>вашего</emphasis> компьютера.
      Это может давать следующие преимущества:</para>

    <itemizedlist>
      <listitem>
	<para>Меньшее время загрузки.  Поскольку ядро будет пытаться определить
	  только то аппаратное обеспечение, которое установлено в вашем
	  компьютере, время, которое потребуется системе для загрузки,
	  может значительно уменьшиться.</para>
      </listitem>

      <listitem>
	<para>Уменьшение использования памяти.
	  Собственное ядро часто использует меньше памяти, чем ядро
	  <filename>GENERIC</filename>, так как из него исключены
	  лишние драйвера и неиспользуемые функциональные возможности.
	  Это важно тем, что часть оперативной памяти постоянно занята
	  кодом ядра и поэтому не может быть выделена приложениям.
	  Именно по этой
	  причине собственное ядро особенно полезно при использовании систем с малым
	  объемом оперативной памяти.</para>
      </listitem>

      <listitem>
	<para>Поддержка дополнительного аппаратного обеспечения.  Собственное ядро
	  позволяет вам добавить поддержку устройств,
	  отсутствующих в ядре <filename>GENERIC</filename>.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 id="kernelconfig-devices">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Tom</firstname>
	  <surname>Rhodes</surname>
	  <contrib>Написал </contrib>
	</author>
      </authorgroup>
    </sect1info>
    <title>Определение аппаратного обеспечения</title>

    <para>Перед тем, как углубиться в конфигурирование ядра, было бы разумно
      составить перечень установленного в компьютер аппаратного обеспечения.
      Если &os; не является основной операционной системой, то перечень
      оборудования может быть легко составлен на основании анализа конфигурации
      текущей операционной системы.  Например, <application>Диспетчер устройств
	(Device Manager)</application> от &microsoft; обычно содержит
      необходимую информацию об установленных устройствах.
      <application>Диспетчер устройств</application> находится на панели
      управления (control panel).</para>

    <note>
      <para>У некоторых версий &microsoft.windows; есть значок
	<application>Система (System)</application>, вызов которого
	отобразит экран, содержащий среди прочих и <application>Диспетчер
	  устройств</application>.</para>
    </note>

    <para>Если других операционных систем на машине не установлено, системному
      администратору придется искать эту информацию самостоятельно.
      Один из методов подразумевает использование утилиты &man.dmesg.8;
      и команды &man.man.1;.  У большинства драйверов во &os; есть страницы
      справочника, содержащие список поддерживаемого оборудования,
      а найденные во время начальной загрузки устройства будут перечислены
      в &man.dmesg.8;.  К примеру, следующие строки информируют о том,
      что драйвер <devicename>psm</devicename> обнаружил мышь: </para>

    <programlisting>psm0: &lt;PS/2 Mouse&gt; irq 12 on atkbdc0
psm0: [GIANT-LOCKED]
psm0: [ITHREAD]
psm0: model Generic PS/2 mouse, device ID 0</programlisting>

    <para>Этот драйвер необходимо будет включить в конфигурацию собственного
      ядра или загрузить посредством &man.loader.conf.5;.</para>

    <para>В некоторых случаях <command>dmesg</command> отображает
      только системные сообщения вместо сообщений начальной загрузки.
      В таких случаях необходимо обращаться к файлу
      <filename>/var/run/dmesg.boot</filename>.</para>

    <para>Еще один метод нахождения аппаратного обеспечения подразумевает
      использование достаточно информативной утилиты &man.pciconf.8;.
      Например:</para>

    <programlisting>ath0@pci0:3:0:0:        class=0x020000 card=0x058a1014 chip=0x1014168c rev=0x01 hdr=0x00
    vendor     = 'Atheros Communications Inc.'
    device     = 'AR5212 Atheros AR5212 802.11abg wireless'
    class      = network
    subclass   = ethernet</programlisting>

    <para>Эта часть вывода, полученная в результате запуска команды
      <command>pciconf <option>-lv</option></command>, показывает, что драйвер
      <devicename>ath</devicename> обнаружил беспроводное Ethernet устройство.
      Набрав <command>man <replaceable>ath</replaceable></command>, вы
      получите страницу справочника &man.ath.4;.</para>

    <para>Также, для извлечения необходимой информации, можно воспользоваться
      ключом <option>-k</option> к команде &man.man.1;.  В вышеприведенном
      случае можно набрать:</para>

    <screen>&prompt.root; man -k <replaceable>Atheros</replaceable></screen>

    <para>чтобы получить страницы справочника, содержащие определенное
      слово:</para>

    <programlisting>ath(4)                   - Atheros IEEE 802.11 wireless network driver
ath_hal(4)               - Atheros Hardware Access Layer (HAL)</programlisting>

    <para>Теперь, имея в распоряжении перечень аппаратного оборудования,
      можно безбоязненно приступить к сборке специализированного ядра.</para>
  </sect1>

  <sect1 id="kernelconfig-modules">
    <title>Драйвера, подсистемы и модули ядра</title>

    <indexterm>
      <primary>kernel</primary>
      <secondary>drivers / modules / subsystems</secondary>
    </indexterm>

    <para>Перед построением специализированного ядра, обдумайте причины,
      побудившие вас к этому.  Если требуется поддержка специального
      оборудования, то она наверняка уже реализована в виде модуля.</para>

    <para>Модули ядра находятся в каталоге
      <filename class="directory">/boot/kernel</filename>, и они могут
      быть динамически включены в работающее ядро при помощи &man.kldload.8;.
      Если не все, то большинство драйверов существуют в виде модулей,
      и у них есть соответствующая страница справочника.  К примеру,
      в предыдущем разделе упоминался драйвер <devicename>ath</devicename>
      беспроводного Ethernet устройства.  Соответствующая ему страница
      справочника гласит:</para>

    <programlisting>Alternatively, to load the driver as a module at boot time, place the
following line in &man.loader.conf.5;:

    if_ath_load="YES"</programlisting>

    <para>Как уже выше сказано, добавление строки
      <literal>if_ath_load="YES"</literal> в файл
      <filename>/boot/loader.conf</filename> позволит динамически
      загружать этот модуль во время загрузки системы.</para>

    <para>В некоторых случаях, однако, интересующего вас модуля
      не существует.  Чаще всего это справедливо для определенных подсистем
      и очень важных драйверов.  Например, поддержка файловой системы &os;
      (<acronym>FFS</acronym>) является обязательной опцией в ядре.
      Как и поддержка сети (INET).  К сожалению, единственный способ
      определить является ли драйвер обязательным &mdash; это проверить
      наличие соответствующего модуля.</para>

    <warning>
      <para>Довольно легко удалить встроенную поддержку устройства или
	опцию, получив тем самым неработоспособное ядро.  Например, если
	драйвер &man.ata.4; изъят из конфигурации ядра, то система,
	использующая диски <acronym>ATA</acronym>, может не загрузиться
	без записи, добавленной в <filename>loader.conf</filename>.
	Если есть сомнения, проверьте модуль, и только потом оставьте
	поддержку в ядре.</para>
    </warning>
  </sect1>

  <sect1 id="kernelconfig-building">
    <title>Сборка и установка собственного ядра</title>
    <indexterm>
      <primary>kernel</primary>
      <secondary>сборка / установка</secondary>
    </indexterm>

    <note>
      <para>Для сборки ядра необходимо наличие всех исходных файлов
	&os;.</para>
    </note>

    <para>Во-первых, давайте сделаем краткий обзор каталога, в котором будет
      происходить сборка ядра.  Все каталоги, которые будут упоминаться, будут
      относительными по отношению к основному каталогу
      <filename>/usr/src/sys</filename>, который также доступен как каталог
      <filename>/sys</filename>.  Этот каталог содержит множество подкаталогов,
      представляющих собой различные части ядра, но наиболее важным для нас
      будет каталог <filename><replaceable>arch</replaceable>/conf</filename>,
      в котором вы будете редактировать конфигурационный файл ядра и в котором
      находится каталог <filename>compile</filename>, где будет
      собираться ваше ядро.  <replaceable>arch</replaceable> может быть
      <filename>i386</filename>,
      <filename>amd64</filename>, <filename>ia64</filename>,
      <filename>powerpc</filename>, <filename>sparc64</filename> или
      <filename>pc98</filename> (альтернативная ветвь аппаратного обеспечения,
      популярная в Японии).  Все, что находится внутри каталога определенной
      архитектуры, относится только к этой архитектуре; остальной код является
      машинно независимым и общим для всех платформ, на которые &os; может
      быть потенциально
      портирована.  Обратите внимание на логическую структуру каталогов, в
      которой каждое поддерживаемое устройство, каждая файловая система и
      каждая опция размещается в своём собственном каталоге.</para>

    <para>В примерах этой главы подразумевается, что вы используете
      архитектуру i386.  Если архитектура вашей системы отличается от
      используемой в примерах, то вам необходимо будет соответственно
      изменить имена каталогов.</para>

    <note>
      <para>Если каталог <filename>/usr/src/sys</filename> отсутствует в вашей
	системе (или этот каталог пуст), то это значит, что исходные тексты
	не были установлены.  Наиболее простой способ установить их
	&mdash; запустить <command>sysinstall</command>
	как пользователь <username>root</username>, выбрать
	<guimenuitem>Configure</guimenuitem>, потом
	<guimenuitem>Distributions</guimenuitem>, потом
	<guimenuitem>src</guimenuitem>,
	и после всего &mdash; <guimenuitem>All</guimenuitem>.  Далее,
	проверьте наличие символической ссылки <filename>/sys/</filename>,
	и, если потребуется, создайте её:</para>

      <screen>&prompt.root; <userinput>ln -s /usr/src/sys /sys</userinput></screen>
    </note>

    <para>Затем, перейдите в каталог
      <filename><replaceable>arch</replaceable>/conf</filename>
      и скопируйте файл конфигурации <filename>GENERIC</filename>
      в файл с выбранным вами именем. Например:</para>

    <screen>&prompt.root; <userinput>cd /usr/src/sys/<replaceable>i386</replaceable>/conf</userinput>
&prompt.root; <userinput>cp GENERIC <replaceable>MYKERNEL</replaceable></userinput></screen>

    <para>По традиции имя состоит из букв в верхнем регистре, и если
      вы поддерживаете несколько компьютеров &os; на различном оборудовании,
      хорошая идея добавлять это имя к имени хоста.  Мы назвали ядро
      <filename><replaceable>MYKERNEL</replaceable></filename> в этом примере.</para>

    <tip>
      <para>Помещение файла конфигурации ядра в <filename>/usr/src</filename>
	может быть плохой идеей.  Если вы испытываете проблемы,
	их можно решить удалив <filename>/usr/src</filename> и начав
	все с начала.  После этого обычно требуется несколько секунд, чтобы
	понять, что вы удалили собственный файл настройки ядра.  Не
	редактируйте непосредственно <filename>GENERIC</filename>, он может
	быть также перезаписан и при следующем <link
	linkend="cutting-edge">обновлении дерева исходных текстов</link>,
	и изменения ядра будут потеряны.</para>

      <para>Вы можете сохранить файл конфигурации ядра в другом месте,
	а затем создать символическую ссылку на этот файл в каталоге
	<filename><replaceable>i386</replaceable></filename>.</para>

      <para>Например:</para>

      <screen>&prompt.root; <userinput>cd /usr/src/sys/<replaceable>i386</replaceable>/conf</userinput>
&prompt.root; <userinput>mkdir /root/kernels</userinput>
&prompt.root; <userinput>cp GENERIC /root/kernels/<replaceable>MYKERNEL</replaceable></userinput>
&prompt.root; <userinput>ln -s /root/kernels/<replaceable>MYKERNEL</replaceable></userinput></screen>
    </tip>

    <para>Теперь отредактируйте файл <filename><replaceable>MYKERNEL</replaceable></filename> в своём
      любимом текстовом редакторе.  Если вы только начинаете, единственным
      доступным редактором скорее всего будет <application>vi</application>,
      который слишком сложен для того, чтобы описать его здесь,
      но в <link linkend="bibliography">библиографии</link> перечислено
      множество книг, в которых его использование хорошо освещено.  Однако &os;
      предоставляет более простой редактор <application>ee</application>,
      который, если вы &mdash; новичок, подойдёт вам больше всего.  Не стесняйтесь
      изменять строки комментариев в начале файла, с тем, чтобы отобразить вашу
      конфигурацию или изменения, которые вы сделали по сравнению с
      <filename>GENERIC</filename>.</para>
    <indexterm><primary>SunOS</primary></indexterm>

    <para>Если вам приходилось собирать ядро для &sunos; или какой-либо другой
      операционной системы типа BSD, многое из того, что содержится в этом
      файле будет очень знакомо вам.  Если же вы, напротив, использовали другую
      операционную систему, такую как DOS, файл конфигурации
      <filename>GENERIC</filename> может показаться вам крайне сложным, поэтому
      следуйте инструкциям в разделе <link
      linkend="kernelconfig-config">Конфигурационный файл</link> медленно и
      внимательно.</para>

    <note>
      <para>Если вы <link
	linkend="cutting-edge">синхронизируете дерево исходных текстов</link>
	с деревом проекта &os;, не забудьте свериться с файлом
	<filename>/usr/src/UPDATING</filename> перед обновлением. В этом
	файле описаны все важные вопросы и области исходного кода, требующие
	особого внимания.
	<filename>/usr/src/UPDATING</filename> всегда соответствует версии
	ваших исходных текстов &os;, поэтому является более актуальным
	источником информации, чем это руководство.</para>
    </note>

    <para>Теперь вы должны скомпилировать ядро.</para>

    <procedure>
      <title>Сборка ядра</title>

      <note>
	<para>Для сборки ядра необходимо наличие всех исходных файлов
	  &os;.</para>
      </note>

      <step>
	<para>Перейдите в каталог <filename
	  class="directory">/usr/src</filename>:</para>

    <screen>&prompt.root; <userinput>cd /usr/src</userinput></screen>
      </step>

      <step>
	<para>Соберите ядро:</para>

    <screen>&prompt.root; <userinput>make buildkernel KERNCONF=<replaceable>MYKERNEL</replaceable></userinput></screen>
      </step>

      <step>
	<para>Установите новое ядро:</para>

    <screen>&prompt.root; <userinput>make installkernel KERNCONF=<replaceable>MYKERNEL</replaceable></userinput></screen>
      </step>
    </procedure>

    <tip>
      <para>По умолчанию, при построении ядра, <emphasis>все</emphasis>
	модули ядра так же будут пересобраны.  Если вы хотите обновить
	ядро быстрее или построить только определённые модули, то вам
	нужно отредактировать файл <filename>/etc/make.conf</filename>
	перед началом процесса сборки ядра:</para>

      <programlisting>MODULES_OVERRIDE = linux acpi sound/sound sound/driver/ds1 ntfs</programlisting>

      <para>Эта переменная устанавливает список модулей, которые нужно построить
	вместо построения всех модулей.</para>

      <programlisting>WITHOUT_MODULES = linux acpi sound ntfs</programlisting>

      <para>В этой переменной перечисляются основные модули, которые
	необходимо исключить из процесса сборки.
	За другими переменными, которые вы можете
	посчитать полезными в процессе сборки ядра, обращайтесь к странице
	справочника &man.make.conf.5;.</para>
    </tip>

    <indexterm>
      <primary><filename class="directory">/boot/kernel.old</filename></primary>
    </indexterm>

    <para>Новое ядро будет скопировано в каталог <filename
      class="directory">/boot/kernel</filename> как
      <filename>/boot/kernel/kernel</filename>, а старое ядро будет перемещено в
      <filename>/boot/kernel.old/kernel</filename>.
      Теперь перезагрузите систему для того,
      чтобы использовать новое ядро.  Если что-то пойдёт не так, вы
      можете обратиться к разделу <link
      linkend="kernelconfig-trouble">Решение проблем</link> в конце
      этой главы, который может оказаться
      полезен.  Не забудьте прочитать
      раздел, который объясняет как исправить ситуацию, когда ядро <link
      linkend="kernelconfig-noboot">не загружается</link>.</para>

    <note>
      <para>Другие файлы, относящиеся к
	процессу загрузки, такие как загрузчик (&man.loader.8;) и его
	конфигурационные файлы, размещаются в <filename>/boot</filename>.
	Модули сторонних производителей могут быть помещены в
	<filename class="directory">/boot/kernel</filename>, хотя пользователи
	должны знать, что
	очень важно, чтобы модули были синхронизированы с собранным ядром.
	Модули, не рассчитанные на работу с собранным ядром, могут вызвать
	нестабильность и некорректность работы.</para>
    </note>
  </sect1>

  <sect1 id="kernelconfig-config">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Joel</firstname>
	  <surname>Dahl</surname>
	  <contrib>Обновил </contrib>
	</author>
      </authorgroup>
    </sect1info>

    <title>Конфигурационный файл</title>
    <indexterm>
      <primary>ядро</primary>
      <secondary>NOTES</secondary>
    </indexterm>
    <indexterm><primary>NOTES</primary></indexterm>
    <indexterm>
      <primary>ядро</primary>
      <secondary>конфигурационный файл</secondary>
    </indexterm>

    <para>Формат конфигурационного файла достаточно прост.  Каждая строка
      представляет собой ключевое слово и один или более аргументов.  Для
      простоты большинство строк содержат только один аргумент.  Всё, что
      следует за символом <literal>#</literal> является комментарием и
      игнорируется.  Следующие разделы описывают каждый параметр, в
      порядке, в котором они появляются в <filename>GENERIC</filename>.
      <anchor id="kernelconfig-options"> За полным списком архитектурно-зависимых
      параметров и устройств обратитесь к файлу <filename>NOTES</filename>
      в том же каталоге, что и <filename>GENERIC</filename>.  Архитектурно
      независимые параметры находятся в
      <filename>/usr/src/sys/conf/NOTES</filename>.</para>

    <para>Директива <literal>include</literal> стала доступной
      для использования в конфигурационных файлах.  Она позволяет включать
      в текущий конфигурационный файл содержимое другого файла, тем самым
      упрощая процесс внесения небольших изменений в существующий файл.
      Например, если вам необходимо добавить всего несколько дополнительных
      опций или драйверов в ядро <filename>GENERIC</filename>, то вам придется
      поддерживать только разницу к файлу GENERIC:</para>

    <programlisting>include GENERIC
ident MYKERNEL

options         IPFIREWALL
options         DUMMYNET
options         IPFIREWALL_DEFAULT_TO_ACCEPT
options         IPDIVERT
</programlisting>

    <para>Большинство администраторов оценят значительные преимущества
      перед старым способом &mdash; написанием конфигурационного файла
      <quote>с нуля</quote>: ваш конфигурационный файл будет отображать
      только изменения относительно <filename>GENERIC</filename>.  А после
      обновлений исходного кода, новые функциональные возможности, появившиеся
      в GENERIC, будут добавлены и в вашу конфигурацию, если только
      не препятствовать этому директивами <literal>nooptions</literal>
      или <literal>nodevice</literal>.  Далее в этом разделе описывается
      типовой конфигурационный файл, его опции и устройства, а также
      их роли.</para>

    <note>
      <para>Для сборки ядра со всеми возможными опциями (обычно используется
	для тестирования), выполните от имени суперпользователя
	(<username>root</username>) следующую команду:</para>

      <screen>&prompt.root; <userinput>cd /usr/src/sys/<replaceable>i386</replaceable>/conf &gt;&gt; make LINT</userinput></screen>
    </note>

    <indexterm>
      <primary>kernel</primary>
      <secondary>конфигурационный файл</secondary>
    </indexterm>

    <para>Это пример конфигурационного файла ядра
      <filename>GENERIC</filename> с различными дополнительными комментариями,
      которые могут понадобиться для ясности.  Этот пример должен совпадать с вашей
      копией в
      <filename>/usr/src/sys/<replaceable>i386</replaceable>/conf/GENERIC</filename>
      практически полностью.</para>

    <indexterm>
      <primary>параметры ядра</primary>
      <secondary>machine</secondary>
    </indexterm>

    <programlisting>machine        i386</programlisting>

    <para>Это архитектура машины.  Она должна быть одной из
      следующих:
      <literal>amd64</literal>,
      <literal>i386</literal>, <literal>ia64</literal>,
      <literal>pc98</literal>, <literal>powerpc</literal>, или
      <literal>sparc64</literal>.</para>

    <indexterm>
      <primary>параметры ядра</primary>
      <secondary>cpu</secondary>
    </indexterm>
    <programlisting>cpu          I486_CPU
cpu          I586_CPU
cpu          I686_CPU</programlisting>

    <para>Эта опция указывает тип процессора, который используется в вашей
      системе.  В конфигурационном файле может быть несколько вхождений этой
      опции (например, если вы не уверены, какой из типов процессора необходимо
      использовать &mdash; <literal>I586_CPU</literal> или
      <literal>I686_CPU</literal>), но для собственного ядра лучше указывать
      только тот тип процессора, который установлен в вашей системе.  Если вы
      не уверены, какой тип необходимо использовать вам, вы можете
      воспользоваться файлом <filename>/var/run/dmesg.boot</filename>, чтобы
      увидеть протокол загрузки системы.</para>

    <indexterm>
      <primary>параметры ядра</primary>
      <secondary>ident</secondary>
    </indexterm>

    <programlisting>ident          GENERIC</programlisting>

    <para>Этот параметр определяет <quote>метку</quote> ядра.  Необходимо,
      чтобы она соответствовала названию файла конфигурации ядра, например
      <literal><replaceable>MYKERNEL</replaceable></literal>, если вы следовали инструкциям в предыдущих
      примерах.  Значение, которое вы присвоите параметру
      <literal>ident</literal> будет выводиться в процессе загрузки, поэтому
      полезно давать новым ядрам другие имена для того, чтобы отличать их от
      обычного ядра (например, если вы хотите собрать экспериментальное
      ядро).</para>

    <programlisting>#To statically compile in device wiring instead of /boot/device.hints
#hints          "GENERIC.hints"         # Default places to look for devices.</programlisting>

    <para>&man.device.hints.5; используются для
      настройки параметров драйверов устройств.  Путь по умолчанию, который
      &man.loader.8; будет проверять при загрузке -
      <filename>/boot/device.hints</filename>.  Используя опцию
      <literal>hints</literal> вы можете вкомпилировать эти параметры
      статически в ваше ядро.  В этом случае не требуется создавать файл
      <filename>device.hints</filename> в каталоге
      <filename>/boot</filename>.</para>

    <!-- XXX: Add a comment here that explains when compiling hints into
      the kernel is a good idea and why. -->

    <programlisting>makeoptions     DEBUG=-g          # Build kernel with gdb(1) debug symbols</programlisting>

    <para>При обычном построении ядра в сборку включается отладочная
      информация: опция <option>-g</option> передается компилятору
      &man.gcc.1;.</para>

    <programlisting>options          SCHED_ULE         # ULE scheduler</programlisting>

    <para>Планировщик по умолчанию во &os;.  Оставьте эту опцию.</para>

    <programlisting>options          PREEMPTION         # Enable kernel thread preemption</programlisting>

    <para>Позволяет высокоприоритетным нитям ядра вытеснять конкурентов,
      находящихся в режиме выполнения.  Эта опция может помочь повысить
      реактивность системы по отношению к внешним воздействиям, например,
      за счет снижения латентности нитей, обрабатывающих прерывания.</para>

    <programlisting>options          INET              # InterNETworking</programlisting>

    <para>Поддержка сетевых возможностей.  Оставьте эту опцию включенной, даже
      если вы не планируете подключаться к сети.  Большинство программ требуют,
      чтобы работал хотя бы интерфейс обратной связи (loopback) (т.е.
      создание сетевых соединений внутри вашего ПК), так что эта опция в
      принципе является обязательной.</para>

    <programlisting>options          INET6             # IPv6 communications protocols</programlisting>

    <para>Включает поддержку коммуникационных протоколов IPv6.</para>

    <programlisting>options          FFS               # Berkeley Fast Filesystem</programlisting>

    <para>Включает поддержку основной файловой системы.  Не удаляйте эту опцию,
      если вы планируете загружаться с жесткого диска.</para>

    <programlisting>options          SOFTUPDATES       # Enable FFS Soft Updates support</programlisting>

    <para>Этот параметр включает в ядре технологию Soft Updates, которая
      повышает скорость записи на диски.  Несмотря на то, что эта технология
      включена в ядре, она должна быть включена для отдельных дисков.
      Просмотрите вывод команды &man.mount.8; чтобы определить, включены ли
      Soft Updates для дисков вашей системы.  Если вы не увидите параметр
      <literal>soft-updates</literal>, вам будет необходимо активировать его
      при помощи команды &man.tunefs.8; (для существующих файловых систем) или
      команды &man.newfs.8; (для новых файловых систем).</para>

    <programlisting>options          UFS_ACL           # Support for access control lists</programlisting>

    <para>Этот параметр включает в ядре
      поддержку списков управления доступом (ACL).  Основывается на
      использовании расширенных атрибутов и <acronym>UFS2</acronym>, детальное
      описание вы сможете найти в <xref linkend="fs-acl">.
      <acronym>ACL</acronym> включены по умолчанию и не должны выключаться в
      случае, если они ранее использовались на файловой системе, так как это
      удалит списки управления доступом и изменит то, как защищены файлы,
      непредсказуемым образом.</para>

    <programlisting>options          UFS_DIRHASH       # Improve performance on big directories</programlisting>

    <para>Эта опция включает функциональность, которая повышает скорость
      дисковых операций на больших каталогах в обмен на использование
      дополнительной памяти.  Для большого сервера или рабочей станции
      рекомендуется оставить ее включенной, и выключить для системы, для
      которой более приоритетна память, чем скорость доступа к дискам,
      например для брандмауэра.</para>

    <programlisting>options          MD_ROOT           # MD is a potential root device</programlisting>

    <para>Этот параметр включает поддержку использования дисков
      в памяти для корневой файловой системы.</para>

    <indexterm>
      <primary>параметры ядра</primary>
      <secondary>NFS</secondary>
    </indexterm>
    <indexterm>
      <primary>параметры ядра</primary>
      <secondary>NFS_ROOT</secondary>
    </indexterm>

    <programlisting>options          NFSCLIENT         # Network Filesystem Client
options          NFSSERVER         # Network Filesystem Server
options          NFS_ROOT          # NFS usable as /, requires NFSCLIENT</programlisting>

    <para>Сетевая файловая система.  Если вы не планируете монтировать разделы
      с файлового сервера &unix; через TCP/IP, вы можете исключить этот
      параметр из конфигурационного файла ядра.</para>

    <indexterm>
      <primary>параметры ядра</primary>
      <secondary>MSDOSFS</secondary>
    </indexterm>

    <programlisting>options          MSDOSFS           # MSDOS Filesystem</programlisting>

    <para>Файловая система &ms-dos;.  Если вы не собираетесь монтировать
      форматированный в DOS раздел жесткого диска в момент загрузки, вы можете
      безопасно закомментировать этот параметр.  Необходимый модуль будет
      автоматически загружен, когда вы в первый раз смонтируете раздел DOS, так,
      как это описано ниже.  Кроме того, замечательный пакет
      <filename role="package">emulators/mtools</filename> позволяет получить
      доступ к DOS дискетам без необходимости монтировать и размонтировать их
      (и не требует наличия <literal>MSDOSFS</literal>).</para>

    <programlisting>options          CD9660            # ISO 9660 Filesystem</programlisting>

    <para>Файловая система ISO 9660 для компакт-дисков.  Если у вас нет привода
      CDROM или вы будете лишь изредка монтировать компакт-диски с данными,
      закомментируйте эту строку, так как необходимый модуль будет загружен
      автоматически при первом монтировании компакт-диска с данными.  Для
      использования звуковых компакт-дисков эта файловая система не
      потребуется.</para>

    <programlisting>options          PROCFS            # Process filesystem (requires PSEUDOFS)</programlisting>

    <para>Файловая система процессов.  Это <quote>виртуальная</quote> файловая
      система монтируемая в <filename>/proc</filename>, которая позволяет таким
      приложениям, как &man.ps.1; выдавать вам больше информации о запущенных
      процессах.  Использование <literal>PROCFS</literal> не
      требуется, так как большинство мониторинговых и отладочных инструментов
      было адаптировано для работы без <literal>PROCFS</literal>:
      система по умолчанию не монтирует файловую
      систему процессов.</para>

    <programlisting>options          PSEUDOFS          # Pseudo-filesystem framework</programlisting>

    <para>Ядра, которые используют <literal>PROCFS</literal>, должны
      также включать поддержку <literal>PSEUDOFS</literal>,</para>

    <programlisting>options          GEOM_PART_GPT     # GUID Partition Tables.</programlisting>

    <para>Этот параметр делает возможным наличие большого количества
      разделов на одном диске.</para>

    <programlisting>options          COMPAT_43         # Compatible with BSD 4.3 [KEEP THIS!]</programlisting>

    <para>Совместимость с 4.3BSD.  Не выключайте эту опцию; некоторые
      приложения будут вести себя странно, если этой опции не будет в
      ядре.</para>

    <programlisting>options          COMPAT_FREEBSD4   # Compatible with &os;4</programlisting>

    <para>Эта опция требуется для
      поддержки приложений, собранных на более старых версиях &os;, которые
      используют старые интерфейсы вызовов.  Рекомендуется использовать данную
      опцию на всех системах на платформах &i386;, на которых могут
      запускаться старые приложения; платформы, поддержка которых появилась
      только в &os;&nbsp;5.X, например ia64 и &sparc64;, не требуют этой
      опции.</para>

    <programlisting>options          COMPAT_FREEBSD5   # Compatible with &os;5</programlisting>

    <para>Эта опция необходима для поддержки
      приложений, скомпилированных на &os;&nbsp;5.X и использующих интерфейс
      системных вызовов &os;&nbsp;5.X.</para>

    <programlisting>options          COMPAT_FREEBSD6   # Compatible with &os;6</programlisting>

    <para>Эта опция требуется для поддержки приложений, собранных на &os;
      версий 6.X, которые используют интерфейсы системных вызовов
      &os;&nbsp;6.X.</para>

    <programlisting>options          COMPAT_FREEBSD7   # Compatible with &os;7</programlisting>

    <para>Эта опция требуется на системах &os; версий 8 и более поздних
      для поддержки приложений, собранных для &os;&nbsp;7.X и использующих
      интерфейсы системных вызовов &os;&nbsp;7.X.</para>

    <programlisting>options          SCSI_DELAY=5000  # Delay (in ms) before probing SCSI</programlisting>

    <para>Этот параметр заставляет ядро приостановиться на 5 секунд перед тем,
      как идентифицировать каждое устройство SCSI в вашей системе.  Если у вас
      установлены только жесткие диски IDE, вы можете игнорировать эту опцию, в
      противном случае, возможно, вы захотите уменьшить это число,
      для того чтобы ускорить загрузку.  Естественно, если вы
      сделаете это, а у &os; появятся проблемы с распознанием ваших устройств
      SCSI, необходимо будет увеличить этот параметр.</para>

    <programlisting>options          KTRACE            # ktrace(1) support</programlisting>

    <para>Включает поддержку трассировки процессов, что удобно при
      отладке.</para>

    <programlisting>options          SYSVSHM           # SYSV-style shared memory</programlisting>

    <para>Этот параметр предоставляет поддержку разделяемой памяти System&nbsp;V.
      Наиболее распространенное применение этого &mdash; расширение XSHM в X, которое
      многие приложения, интенсивно работающие с графикой, будут автоматически
      использовать для повышения скорости работы.  Если вы используете X,
      эта опция будет необходима.</para>

    <programlisting>options          SYSVMSG           # SYSV-style message queues</programlisting>

    <para>Поддержка сообщений System&nbsp;V.  Этот параметр
      добавляет в ядро всего лишь несколько сотен байт.</para>

    <programlisting>options          SYSVSEM           # SYSV-style semaphores</programlisting>

    <para>Поддержка семафоров System&nbsp;V.  Не настолько часто используемая
      возможность, но в ядро добавляет всего несколько сотен байт.</para>

    <note>
      <para>Команда &man.ipcs.1; с параметром <option>-p</option> покажет
	все процессы, которые используют любую из этих возможностей
	System&nbsp;V.</para>
    </note>

    <programlisting>options 	     _KPOSIX_PRIORITY_SCHEDULING # POSIX P1003_1B real-time extensions</programlisting>

    <para>Расширения реального времени, добавленные 1993 &posix;.  Определенные
      приложения из коллекции используют их, например
      <application>&staroffice;</application>.</para>

    <programlisting>options          KBD_INSTALL_CDEV  # install a CDEV entry in /dev</programlisting>

    <para>Этот параметр разрешает формирование файлов устройств в
      <filename>/dev</filename> для клавиатур.</para>

    <programlisting>options          ADAPTIVE_GIANT    # Giant mutex is adaptive.</programlisting>

    <para>Giant&nbsp;&mdash; имя механизма защиты (<quote>спящего</quote>
      мьютекса) для крупных наборов ресурсов ядра.  На нынешний момент
      Giant представляется фактически непригодным для использования в связи
      с серьезными потерями в производительности, и активно заменяется
      на механизмы, защищающие отдельные ресурсы ядра.  Параметр
      <literal>ADAPTIVE_GIANT</literal> включает Giant в число адаптивных
      мьютексов: в случае, когда нить ядра нуждается в Giant, а он уже
      захвачен нитью, выполняющейся на другом процессоре, первая нить
      будет продолжать выполнение и ждать освобождения Giant.  В норме
      нить должна была бы уснуть, пока не настанет очередной момент ее
      выполнения.  Если вы не уверены, оставьте этот параметр в покое.</para>

    <note>
      <para>Для &os; 8.0-RELEASE и более поздних версий, все мьютексы
	являются адаптивными по умолчанию, если обратное не указано специально
	опцией <literal>NO_ADAPTIVE_MUTEXES</literal>.  Следовательно,
	Giant также адаптивен по умолчанию, и поэтому опция
	<literal>ADAPTIVE_GIANT</literal> была удалена из файла
	конфигурации ядра.</para>
    </note>

    <indexterm>
      <primary>kernel options</primary>
      <secondary>SMP</secondary>
    </indexterm>

    <programlisting>device          apic               # I/O APIC</programlisting>

    <para>Устройство apic разрешает использование набора I/O APIC для
      распределения прерываний.  Оно может быть использовано как с
      однопроцессорными, так и с многопроцессорными ядрами (для последних
      наличие apic является обязательным).  Для поддержки многопроцессорности
      добавьте строку <literal>options SMP</literal>.</para>

    <note>
      <para>Устройство apic существует только на архитектурах i386.
	На других архитектурах этот конфигурационный параметр использовать
	не следует.</para>
    </note>


    <programlisting>device          eisa</programlisting>

    <para>Включите эту опцию если у вас материнская плата EISA.  Это включает
      автоопределение и конфигурирование поддержки всех устройств на шине
      EISA.</para>

    <programlisting>device          pci</programlisting>

    <para>Включите этот параметр, если у вас материнская плата с поддержкой
      PCI.  Это включит автоопределение карт PCI и проксирование из шины PCI в
      шину ISA.</para>



    <programlisting># Floppy drives
device          fdc</programlisting>

    <para>Контроллер флоппи-диска.</para>

    <programlisting># ATA and ATAPI devices
device          ata</programlisting>

    <para>Этот драйвер поддерживает все устройства ATA и ATAPI.  Вам необходима
      только одна строка <literal>device ata</literal> в ядре для того, чтобы
      обнаружить все PCI устройства ATA/ATAPI в современных машинах.</para>

    <programlisting>device          atadisk                 # ATA disk drives</programlisting>

    <para>Эта строка необходима вместе с <literal>device ata</literal> для
      поддержки дисков ATA.</para>

    <programlisting>device          ataraid                 # ATA RAID drives</programlisting>

    <para>Эта строка необходима вместе с <literal>device ata</literal>
      для поддержки дисков ATA RAID.</para>

    <programlisting><anchor id="kernelconfig-atapi">
device          atapicd                 # ATAPI CDROM drives</programlisting>

    <para>Поддержка приводов ATAPI CDROM.  Используется вместе с
      <literal>device ata</literal>.</para>

    <programlisting>device          atapifd                 # ATAPI floppy drives</programlisting>

    <para>Поддержка флоппи-приводов ATAPI.  Используется вместе с
      <literal>device ata</literal>.</para>

    <programlisting>device          atapist                 # ATAPI tape drives</programlisting>

    <para>Поддержка ленточных приводов ATAPI (стримеров).  Используется вместе с
      <literal>device ata</literal>.</para>

    <programlisting>options         ATA_STATIC_ID           # Static device numbering</programlisting>

    <para>Заставляет драйвер нумеровать устройства статически;
      в противном случае происходит динамическая нумерация.</para>

    <programlisting># SCSI Controllers
device          ahb        # EISA AHA1742 family
device          ahc        # AHA2940 and onboard AIC7xxx devices
options         AHC_REG_PRETTY_PRINT    # Print register bitfields in debug
                                        # output.  Adds ~128k to driver.
device          ahd        # AHA39320/29320 and onboard AIC79xx devices
options         AHD_REG_PRETTY_PRINT    # Print register bitfields in debug
                                        # output.  Adds ~215k to driver.
device          amd        # AMD 53C974 (Teckram DC-390(T))
device          isp        # Qlogic family
#device         ispfw      # Firmware for QLogic HBAs- normally a module
device          mpt        # LSI-Logic MPT-Fusion
#device         ncr        # NCR/Symbios Logic
device          sym        # NCR/Symbios Logic (newer chipsets + those of `ncr')
device          trm        # Tekram DC395U/UW/F DC315U adapters

device          adv        # Advansys SCSI adapters
device          adw        # Advansys wide SCSI adapters
device          aha        # Adaptec 154x SCSI adapters
device          aic        # Adaptec 15[012]x SCSI adapters, AIC-6[23]60.
device          bt         # Buslogic/Mylex MultiMaster SCSI adapters

device          ncv        # NCR 53C500
device          nsp        # Workbit Ninja SCSI-3
device          stg        # TMC 18C30/18C50</programlisting>

    <para>Контроллеры SCSI.  Закомментируйте те, которых у вас в системе нет.
      Если у вас в системе исключительно IDE устройства, вы можете удалить все
      эти строки.  Строки вида <literal>*_REG_PRETTY_PRINT</literal> включают
      режим отладки для соответствующих драйверов.</para>

    <programlisting># SCSI peripherals
device          scbus      # SCSI bus (required for SCSI)
device          ch         # SCSI media changers
device          da         # Direct Access (disks)
device          sa         # Sequential Access (tape etc)
device          cd         # CD
device          pass       # Passthrough device (direct SCSI access)
device          ses        # SCSI Environmental Services (and SAF-TE)</programlisting>

    <para>Периферийные устройства SCSI.  Опять-таки, закомментируйте те,
      которых у вас в системе нет, или, если у вас в наличии исключительно IDE,
      можете удалить все.</para>

    <note>
      <para>USB &man.umass.4; драйвер (и некоторые другие драйверы) используют
	подсистему SCSI, хотя и не являются настоящими SCSI устройствами.
	Следовательно, вам необходимо сохранить поддержку SCSI, если
	какой-либо из этих драйверов включен в конфигурацию ядра.</para>
    </note>

    <programlisting># RAID controllers interfaced to the SCSI subsystem
device          amr        # AMI MegaRAID
device		arcmsr	   # Areca SATA II RAID
device          asr        # DPT SmartRAID V, VI and Adaptec SCSI RAID
device          ciss       # Compaq Smart RAID 5*
device          dpt        # DPT Smartcache III, IV - See NOTES for options
device          hptmv      # Highpoint RocketRAID 182x
device          hptrr      # Highpoint RocketRAID 17xx, 22xx, 23xx, 25xx
device          iir        # Intel Integrated RAID
device          ips        # IBM (Adaptec) ServeRAID
device          mly        # Mylex AcceleRAID/eXtremeRAID
device          twa        # 3ware 9000 series PATA/SATA RAID

# RAID controllers
device          aac        # Adaptec FSA RAID
device          aacp       # SCSI passthrough for aac (requires CAM)
device          ida        # Compaq Smart RAID
device          mfi        # LSI MegaRAID SAS
device          mlx        # Mylex DAC960 family
device          pst        # Promise Supertrak SX6000
device          twe        # 3ware ATA RAID</programlisting>

    <para>Поддерживаемые RAID-контроллеры.  Если у вас нет таковых, можете их
      закомментировать или удалить эти строки.</para>

    <programlisting># atkbdc0 controls both the keyboard and the PS/2 mouse
device          atkbdc     # AT keyboard controller</programlisting>

    <para>Контроллер клавиатуры (<literal>atkbdc</literal>) предоставляет
      средства ввода/вывода для клавиатуры AT и PS/2 устройств.  Этот
      контроллер необходим драйверу клавиатуры (<literal>atkbd</literal>) и
      PS/2 устройств (<literal>psm</literal>).</para>

    <programlisting>device          atkbd      # AT keyboard</programlisting>

    <para>Драйвер <literal>atkbd</literal> вместе с контроллером
      <literal>atkbdc</literal> предоставляет доступ к клавиатуре AT 84 или
      улучшенной клавиатуре AT, которая подключена к контроллеру AT
      клавиатуры.</para>

    <programlisting>device          psm        # PS/2 mouse</programlisting>

    <para>Используйте это устройство, если ваша мышь включается в порт
      PS/2.</para>

    <programlisting>device          kbdmux        # keyboard multiplexer</programlisting>

    <para>Поддержка мультиплексора клавиатур.  Если использование двух и более
      клавиатур не планируется, можете смело исключать этот параметр.</para>

    <programlisting>device          vga        # VGA video card driver</programlisting>

    <para>Драйвер видеокарты.</para>

    <programlisting>
device          splash     # Splash screen and screen saver support</programlisting>

    <para>Заставка при загрузке.  Хранители экрана также требуют этого
      устройства.</para>

    <programlisting># syscons is the default console driver, resembling an SCO console
device          sc</programlisting>

    <para><literal>sc</literal> &mdash; это драйвер консоли по умолчанию, который
      имитирует консоль SCO.  Так как большая часть консольных полноэкранных
      приложений обращаются к консоли через терминальную библиотеку
      <filename>termcap</filename>, вас не должно волновать, будете ли вы
      использовать этот драйвер, либо драйвер <literal>vt</literal>, который
      является <literal>VT220</literal>-совместимым драйвером консоли.  Если у
      вас возникнут какие-либо проблемы с приложениями, работающими с этим
      драйвером консоли, установите переменную окружения <envar>TERM</envar> в
      значение <literal>scoansi</literal>.</para>

    <programlisting># Enable this for the pcvt (VT220 compatible) console driver
#device          vt
#options         XSERVER          # support for X server on a vt console
#options         FAT_CURSOR       # start with block cursor</programlisting>

    <para>VT220-совместимый драйвер консоли, обратно совместимый с VT100/102.
      Он работает лучше на некоторых лэптопах, у которых возникают проблемы
      несовместимости с <literal>sc</literal>.  Также, установите переменную
      окружения <envar>TERM</envar> в значение <literal>vt100</literal> или
      <literal>vt220</literal>.  Этот драйвер также может быть полезен в
      случаях подключения к большому количеству различных машин через сеть, на
      которых параметры для устройства <literal>sc</literal> для
      <filename>termcap</filename> или <filename>terminfo</filename> могут
      отсутствовать &mdash; <literal>vt100</literal> присутствует практически
      на любой платформе.</para>

    <programlisting>device          agp</programlisting>

    <para>Включите эту опцию, если у вас есть AGP карта в системе.  Это включит
      поддержку AGP и AGP GART для тех карт, которые поддерживают эту
      возможность.</para>

    <indexterm>
      <primary>APM</primary>
    </indexterm>

    <programlisting># Power management support (see NOTES for more options)
#device          apm</programlisting>

    <para>Поддержка Advanced Power Management.  Чаще всего используется в
      лэптопах, хотя и отключена по умолчанию.</para>

    <programlisting># Add suspend/resume support for the i8254.
device           pmtimer</programlisting>

    <para>Устройство таймера для управления энергопотреблением, APM и
      ACPI.</para>

    <programlisting># PCCARD (PCMCIA) support
# PCMCIA and cardbus bridge support
device          cbb               # cardbus (yenta) bridge
device          pccard            # PC Card (16-bit) bus
device          cardbus           # CardBus (32-bit) bus</programlisting>

    <para>Поддержка PCMCIA.  Включите ее, если вы используете лэптоп.</para>

    <programlisting># Serial (COM) ports
device          sio               # 8250, 16[45]50 based serial ports</programlisting>

    <para>Четыре последовательных порта, которые известны как
      <devicename>COM</devicename> порты
      в мире &ms-dos;/&windows;</para>

    <note>
      <para>Если у вас есть внутренний модем на <devicename>COM4</devicename> и последовательный порт
	<devicename>COM2</devicename>, вам понадобится поменять IRQ модема на 2 (по непонятным
	техническим причинам IRQ2 = IRQ9) для того, чтобы получить к нему
	доступ из &os;.  Если у вас есть многопортовая карта с
	последовательными портами, ознакомьтесь с &man.sio.4; чтобы узнать
	корректные значения для добавления в
	<filename>/boot/device.hints</filename>.  Некоторые видеокарты (в частности
	те, что используют чипы S3) используют адреса ввода/вывода в форме
	<literal>0x*2e8</literal> и, так как многие дешевые последовательные
	карты не полностью раскодируют шестнадцатибитное пространство адресов
	ввода/вывода, они конфликтуют с этими картами, в итоге <devicename>COM4</devicename> оказывается
	практически недоступным.</para>

	<para>Каждый последовательный порт требует уникального IRQ (кроме тех
	  случаев, когда вы используете мультипортовую карту, которая
	  поддерживает совместное использование прерываний), поэтому значения
	  IRQ по умолчанию для <devicename>COM3</devicename> и
	  <devicename>COM4</devicename> не могут быть использованы.</para>
    </note>

    <programlisting># Parallel port
device          ppc</programlisting>

    <para>Интерфейс параллельного порта на шине ISA.</para>

    <programlisting>device          ppbus      # Parallel port bus (required)</programlisting>

    <para>Поддержка шины параллельного порта.</para>

    <programlisting>device          lpt        # Printer</programlisting>

    <para>Поддержка принтеров на параллельном порту.</para>

    <note>
      <para>Все три последних устройства необходимы для поддержка принтеров на
	параллельном порту.</para>
    </note>

    <programlisting>device          plip       # TCP/IP over parallel</programlisting>

    <para>Драйвер TCP/IP через параллельный порт.</para>

    <programlisting>device          ppi        # Parallel port interface device</programlisting>

    <para>Поддержка ввода/вывода общего назначения (<quote>geek port</quote>) +
      IEEE1284 ввода/вывода.</para>

    <programlisting>#device         vpo        # Requires scbus and da</programlisting>

    <indexterm><primary>zip drive</primary></indexterm>
    <para>Драйвер привода Iomega Zip.  Требует наличия <literal>scbus</literal>
      и <literal>da</literal>.  Наилучшая производительность достигается с
      портами в режиме EPP 1.9.</para>

    <programlisting>#device         puc</programlisting>

    <para>Раскомментируйте это устройство, если у вас есть
      <quote>простая</quote> последовательная или параллельная
      PCI карта, поддерживаемая драйвером &man.puc.4;.</para>

    <programlisting># PCI Ethernet NICs.
device          de         # DEC/Intel DC21x4x (<quote>Tulip</quote>)
device          em         # Intel PRO/1000 adapter Gigabit Ethernet Card
device          ixgb       # Intel PRO/10GbE Ethernet Card
device          txp        # 3Com 3cR990 (<quote>Typhoon</quote>)
device          vx         # 3Com 3c590, 3c595 (<quote>Vortex</quote>)</programlisting>

    <para>Драйвера сетевых карт PCI.  Закомментируйте или удалите драйвера тех
      карт, которые отсутствуют в вашей системе.</para>

    <programlisting># PCI Ethernet NICs that use the common MII bus controller code.
# NOTE: Be sure to keep the 'device miibus' line in order to use these NICs!
device          miibus     # MII bus support</programlisting>

    <para>Поддержка шины MII требуется для некоторых PCI 10/100 Ethernet карт,
      которые используют MII-совместимые передатчики или реализуют
      интерфейс управления передатчиком, который имитирует MII.  Добавление
      <literal>device miibus</literal> в конфигурационный файл ядра включает
      поддержку стандартного API miibus и всех драйверов PHY, включая стандартный
      для тех PHY, которые не обрабатываются специфическим образом конкретным
      драйвером.</para>

    <programlisting>device          bfe        # Broadcom BCM440x 10/100 Ethernet
device          bge        # Broadcom BCM570xx Gigabit Ethernet
device          dc         # DEC/Intel 21143 and various workalikes
device          fxp        # Intel EtherExpress PRO/100B (82557, 82558)
device		lge	   # Level 1 LXT1001 gigabit ethernet
device          msk        # Marvell/SysKonnect Yukon II Gigabit Ethernet
device		nge	   # NatSemi DP83820 gigabit ethernet
device          pcn        # AMD Am79C97x PCI 10/100 (precedence over 'lnc')
device          re         # RealTek 8139C+/8169/8169S/8110S
device          rl         # RealTek 8129/8139
device          sf         # Adaptec AIC-6915 (<quote>Starfire</quote>)
device          sis        # Silicon Integrated Systems SiS 900/SiS 7016
device          sk         # SysKonnect SK-984x &gt; SK-982x gigabit Ethernet
device          ste        # Sundance ST201 (D-Link DFE-550TX)
device          stge       # Sundance/Tamarack TC9021 gigabit Ethernet
device          ti         # Alteon Networks Tigon I/II gigabit Ethernet
device          tl         # Texas Instruments ThunderLAN
device          tx         # SMC EtherPower II (83c170 <quote>EPIC</quote>)
device		vge	   # VIA VT612x gigabit ethernet
device          vr         # VIA Rhine, Rhine II
device          wb         # Winbond W89C840F
device          xl         # 3Com 3c90x (<quote>Boomerang</quote>, <quote>Cyclone</quote>)</programlisting>

    <para>Драйвера, которые используют контроллер шины MII.</para>

    <programlisting># ISA Ethernet NICs.  pccard NICs included.
device          cs         # Crystal Semiconductor CS89x0 NIC
# 'device ed' requires 'device miibus'
device          ed         # NE[12]000, SMC Ultra, 3c503, DS8390 cards
device          ex         # Intel EtherExpress Pro/10 and Pro/10+
device          ep         # Etherlink III based cards
device          fe         # Fujitsu MB8696x based cards
device          ie         # EtherExpress 8/16, 3C507, StarLAN 10 etc.
device          lnc        # NE2100, NE32-VL Lance Ethernet cards
device          sn         # SMC's 9000 series of Ethernet chips
device          xe         # Xircom pccard Ethernet

# ISA devices that use the old ISA shims
#device         le</programlisting>

    <para>Драйвера сетевых карт ISA.  Ознакомьтесь с файлом
      <filename>/usr/src/sys/<replaceable>i386</replaceable>/conf/NOTES</filename>,
      чтобы узнать, какие
      сетевые карты каким драйвером поддерживаются.</para>

    <programlisting># Wireless NIC cards
device          wlan            # 802.11 support</programlisting>

    <para>Generic 802.11 support.  This line is required for wireless
      networking.</para>

    <programlisting>device          wlan_wep        # 802.11 WEP support
device          wlan_ccmp       # 802.11 CCMP support
device          wlan_tkip       # 802.11 TKIP support</programlisting>

    <para>Crypto support for 802.11 devices.  These lines are needed
      if you intend to use encryption and 802.11i security
      protocols.</para>

    <programlisting>device          an         # Aironet 4500/4800 802.11 wireless NICs.
device          ath             # Atheros pci/cardbus NIC's
device          ath_hal         # Atheros HAL (Hardware Access Layer)
device          ath_rate_sample # SampleRate tx rate control for ath
device          awi        # BayStack 660 and others
device          wi         # WaveLAN/Intersil/Symbol 802.11 wireless NICs.
#device         wl         # Older non 802.11 Wavelan wireless NIC.</programlisting>

    <para>Поддержка различных беспроводных карт.</para>

    <programlisting># Pseudo devices
device   loop          # Network loopback</programlisting>

    <para>Стандартное устройство обратной связи для TCP/IP.  Если вы запускаете
      telnet или FTP по отношению <hostid>localhost</hostid> (он же <hostid
      role="ipaddr">127.0.0.1</hostid>), то соединение пройдёт через это
      устройство.  Этот параметр <emphasis>обязателен</emphasis>.</para>

    <programlisting>device   random        # Entropy device</programlisting>

    <para>Генератор случайных чисел для криптографической защиты.</para>

    <programlisting>device   ether         # Ethernet support</programlisting>

    <para><literal>ether</literal> необходим лишь в случае, если у вас есть
      сетевая карта.  Он включает поддержку стандартного кода протокола
      Ethernet.</para>

    <programlisting>device   sl            # Kernel SLIP</programlisting>

    <para><literal>sl</literal> &mdash; это поддержка SLIP.  SLIP был практически
      вытеснен PPP, который легче настраивается, лучше подходит для соединений
      модем-модем и имеет больше возможностей.</para>

    <programlisting>device   ppp           # Kernel PPP</programlisting>

    <para>Поддержка PPP в ядре для соединений dial-up.  Также существует версия
      PPP, реализованного как приложение, использующее <literal>tun</literal>, и
      предлагающее большую гибкость и большее количество возможностей, как,
      например, соединение при необходимости (наличии обращения к сети).</para>

    <programlisting>device   tun           # Packet tunnel.</programlisting>

    <para>Используется пользовательским программным обеспечением PPP.
      Обратитесь к
      разделу <link linkend="userppp">PPP</link> этой книги за дальнейшей
      информацией.</para>

    <programlisting><anchor id="kernelconfig-ptys">
device   pty           # Pseudo-ttys (telnet etc)</programlisting>

    <para><quote>псевдо-терминал</quote> или имитированный порт для входа.
      Используется входящими <command>telnet</command> и
      <command>rlogin</command>-сессиями, приложением
      <application>xterm</application> и некоторыми другими приложениями,
      такими как <application>Emacs</application>.</para>

    <programlisting>device   md            # Memory <quote>disks</quote></programlisting>

    <para>Псевдо-устройства дисков в памяти.</para>

    <programlisting>device   gif           # IPv6 and IPv4 tunneling</programlisting>

    <para>Поддержка туннелирования IPv6 через IPv4, IPv4 через IPv6, IPv4 через
      IPv4 и IPv6 через IPv6.  Устройство
      <literal>gif</literal> является <quote>автоклонируемым</quote>, и будет
      срздавать файлы устройств по мере необходимости.</para>

    <programlisting>device   faith         # IPv6-to-IPv4 relaying (translation)</programlisting>

    <para>Это псевдо-устройство захватывает пакеты, которые были посланы ему и
      перенаправляет их даемону трансляции IPv4/IPv6.</para>

    <programlisting># The `bpf' device enables the Berkeley Packet Filter.
# Be aware of the administrative consequences of enabling this!
# Note that 'bpf' is required for DHCP.
device   bpf           # Berkeley packet filter</programlisting>

    <para>Фильтр пакетов Berkeley.  Это псевдо-устройство позволяет переводить
      сетевые интерфейсы в <quote>неразборчивый</quote> (promiscuous) режим, в
      котором перехватывается любой пакет в широковещательной сети (например
      ethernet).  Эти пакеты могут быть сохранены на диск и/или исследованы при
      помощи &man.tcpdump.1;.</para>

    <note>
      <para>Устройство &man.bpf.4; также используется программой
	&man.dhclient.8; для того, чтобы получить адрес шлюза по умолчанию и
	т.п.  Если вы используете DCHP, не удаляйте эту опцию.</para>
    </note>

    <programlisting># USB support
device          uhci          # UHCI PCI-&gt;USB interface
device          ohci          # OHCI PCI-&gt;USB interface
device		ehci	      # EHCI PCI-&gt;USB interface (USB 2.0)
device          usb           # USB Bus (required)
#device         udbp          # USB Double Bulk Pipe devices
device          ugen          # Generic
device          uhid          # <quote>Human Interface Devices</quote>
device          ukbd          # Keyboard
device          ulpt          # Printer
device          umass         # Disks/Mass storage - Requires scbus and da
device          ums           # Mouse
device          ural          # Ralink Technology RT2500USB wireless NICs
device          urio          # Diamond Rio 500 MP3 player
device          uscanner      # Scanners
# USB Ethernet, requires mii
device          aue           # ADMtek USB Ethernet
device          axe           # ASIX Electronics USB Ethernet
device		cdce	      # Generic USB over Ethernet
device          cue           # CATC USB Ethernet
device          kue           # Kawasaki LSI USB Ethernet
device          rue           # RealTek RTL8150 USB Ethernet</programlisting>

    <para>Поддержка различных USB устройств.</para>

    <programlisting># FireWire support
device          firewire      # FireWire bus code
device          sbp           # SCSI over FireWire (Requires scbus and da)
device          fwe           # Ethernet over FireWire (non-standard!)</programlisting>

    <para>Поддержка различных устройств Firewire.</para>

    <para>За дальнейшей информацией о дополнительных устройствах,
      поддерживаемых &os;, обратитесь к файлу
      <filename>/usr/src/sys/<replaceable>i386</replaceable>/conf/NOTES</filename>.</para>

      <sect2>
	<title>Конфигурации с большим количеством оперативной памяти
	  (<acronym>PAE</acronym>)</title>
	<indexterm>
	  <primary>
	    Расширения физического адресного пространства (Physical Address
	    Extensions (<acronym>PAE</acronym>))
	  </primary>
	  <secondary>
	    Конфигурации с большим количеством оперативной памяти
	  </secondary>
	</indexterm>

	<para>Машины с большим количеством оперативной памяти, в которых требуется
	  более 4 гигабайт в пользовательском адресном пространстве и адресном
	  пространстве ядра (User+Kernel Virtual Address, <acronym>KVA</acronym>)
	  в обычном случае не смогут использовать более 4
	  гигабайт.  Для решения этой проблемы Intel добавили поддержку 36-битной
	  адресации в &pentium; Pro и более поздних моделях процессоров.</para>

	<para>Расширение физического адресного пространства
	  (<acronym>PAE</acronym>) в процессорах &intel; &pentium; Pro и более
	  поздних позволяет использовать до 64 гигабайт оперативной памяти.  &os;
	  имеет поддержку этой возможности посредством опции ядра
	  <option>PAE</option>, доступной во всех текущих версиях &os;.
	  В связи с ограничениями архитектуры Intel, не делается
	  никакого различия между памятью ниже или выше 4 гигабайт.  Память,
	  размещенная выше 4 гигабайт, просто добавляется к доступной памяти.</para>

	<para>Для того, чтобы включить <acronym>PAE</acronym> в ядре, просто
	  добавьте приведенную строку в конфигурационный файл ядра:</para>

	<programlisting>options            PAE</programlisting>

	<note>
	  <para>Поддержка <acronym>PAE</acronym> в &os; существует только для
	    процессоров &intel; IA-32.  Также следует заметить, что
	    <acronym>PAE</acronym> в &os; не было полностью протестировано и должно
	    считаться находящимся в состоянии бета-тестирования по сравнению с
	    другими, стабильными возможностями &os;.</para>
	</note>

	<para>Поддержка <acronym>PAE</acronym> в &os; имеет следующие
	  ограничения:</para>

	<itemizedlist>
	  <listitem>
	    <para>Процесс не может получить доступ к более, чем 4 гигабайтам
	      пространства VM.</para>
	  </listitem>

	  <listitem>
	    <para>Драйверы устройств, которые не используют интерфейс
	      &man.bus.dma.9;, приведут к повреждению информации в ядре с включенным
	      <acronym>PAE</acronym>.  Не рекомендуется использовать такие драйверы.
	      По этой причине в &os; включен конфигурационный файл ядра
	      <filename>PAE</filename>, из которого удалены все драйверы, о которых
	      известно, что они не работают при включенной поддержке
	      <acronym>PAE</acronym>.</para>
	  </listitem>

	  <listitem>
	    <para>Некоторые системные переменные определяют использование ресурсов
	      памяти по количеству доступной физической памяти.  Такие переменные
	      могут привести к ненужному чрезмерному выделению памяти из-за
	      особенностей работы системы <acronym>PAE</acronym>.  Один из таких
	      примеров &mdash; переменная <option>kern.maxvnodes</option>, которая
	      управляет максимальным количеством vnode, разрешенных в ядре.
	      Рекомендуется установить эту и подобные ей переменные вручную в
	      адекватные значения.</para>
	  </listitem>

	  <listitem>
	    <para>Возможно, понадобится увеличить пространство виртуальных адресов
	    ядра (<acronym>KVA</acronym>) или уменьшить какую-либо переменную (см.
	    выше), значение которой было неоправданно велико и могло привести к
	    исчерпанию <acronym>KVA</acronym>.  Для этого может быть использована
	    опция ядра <option>KVA_PAGES</option>.</para>
	  </listitem>
	</itemizedlist>

	<para>В случае сомнений относительно производительности и стабильности
	  рекомендуется обратиться к странице руководства &man.tuning.7;.  Страница
	  руководства &man.pae.4; содержит свежую информацию о поддержке
	  <acronym>PAE</acronym> в &os;.</para>
      </sect2>
  </sect1>

  <sect1 id="kernelconfig-trouble">
    <title>Решение проблем</title>

    <para>Существует четыре категории проблем, которые могут возникнуть при
      сборке собственного ядра.  Вот они:</para>

    <variablelist>
      <varlistentry>
	<term>Не удаётся отработать команде <command>config</command>:</term>

	<listitem>
	  <para>Если команда &man.config.8; не может отработать, то, скорее всего,
	    вы допустили где-нибудь маленькую ошибку.  К счастью, &man.config.8;
	    выведет номер проблемной строки, поэтому вы можете быстро найти
	    строку, содержащую ошибку.  Например, если вы видите:</para>

	  <screen>config: line 17: syntax error</screen>

	  <para>Убедитесь, что опция введена верно путём сравнения с файлом
	    <filename>GENERIC</filename> или другим источником.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Не удаётся отработать команде <command>make</command>:</term>

	<listitem>
	  <para>Если не удаётся отработать команде <command>make</command>, обычно
	    это означает ошибку в описании конфигурации ядра, которая не достаточно
	    тривиальна для того, чтобы &man.config.8; мог обнаружить её.
	    Опять-таки, просмотрите файл конфигурации, и, если вы все еще не можете
	    решить проблему, напишите письмо в &a.questions;, включив в письмо файл
	    конфигурации ядра.  Скорее всего проблема будет решена быстро.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Ядро не загружается:<anchor
	  id="kernelconfig-noboot"></term>

	<listitem>
	  <para>Если ваше новое ядро не загружается или ему не удаётся обнаружить
	    ваши устройства  &mdash; не паникуйте!  К счастью, в &os; существует отличный
	    механизм для восстановления после установки несовместимого ядра.
	    Просто выберите ядро, которое хотите загрузить, в загрузчике &os;.
	    Доступ к нему вы можете получить, когда система находится в стартовом меню.
	    Выберите шестой пункт (<quote>Escape to a loader prompt</quote>),
	    введите команду
	    <command>boot <replaceable>kernel.old</replaceable></command>,
	    или используйте любое
	    другое ядро, которое загрузится без проблем.  Во время
	    переконфигурирования ядра всегда полезно оставлять копию ядра, о
	    котором известно, что оно рабочее.</para>

	  <para>После загрузки с рабочим ядром вы можете проверить ваш файл
	  конфигурации и попробовать собрать ядро опять.  Очень полезным в данном
	  случае окажется файл <filename>/var/log/messages</filename>, в котором,
	  среди других записей, имеются сообщения ядра от каждой успешной загрузки.
	  Также, команда &man.dmesg.8; выведет сообщения ядра от текущей
	  загрузки.</para>

	  <note>
	    <para>Если у вас возникли проблемы со сборкой ядра, убедитесь, что вы
	      сохранили ядро <filename>GENERIC</filename> или другое рабочее ядро
	      под другим именем, чтобы оно не было удалено при следующей сборке.  Вы
	      не можете использовать <filename>kernel.old</filename>, потому что
	      при установке нового ядра <filename>kernel.old</filename>
	      перезаписывается последним установленным ядром, которое может
	      оказаться нерабочим.  Также, как можно скорее переместите рабочее
	      ядро в <filename class="directory">/boot/kernel</filename>,
	      так как некоторые команды, такие как &man.ps.1; будут работать
	      некорректно.  Для этого просто переместите каталог, содержащий
	      работоспособное ядро:</para>

	    <screen>&prompt.root; <userinput>mv /boot/kernel <replaceable>/boot/kernel.bad</replaceable></userinput>
&prompt.root; <userinput>mv /boot/<replaceable>kernel.good</replaceable> /boot/kernel</userinput></screen>
	   </note>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Ядро работает, но &man.ps.1; больше не работает:</term>

	<listitem>
	  <para>Если вы установили версию ядра отличную от той, с которой были
	    собраны ваши системные утилиты, например, ядро от -CURRENT на системе -RELEASE,
	    большая часть системных команд, таких как &man.ps.1; и &man.vmstat.8;
	    не будут больше работать.  Вам потребуется <link
	    linkend="makeworld">перекомпилировать и установить систему</link>
	    той же версии исходных текстов, что и ядро.  Это одна из причин,
	    по которой не следует использовать версию ядра, отличную от версии всей
	    остальной системы.</para>
	</listitem>
      </varlistentry>
    </variablelist>
  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->

<!--
     The FreeBSD Russian Documentation Project

     $FreeBSD$
     $FreeBSDru: frdp/doc/ru_RU.KOI8-R/books/fdp-primer/the-website/chapter.sgml,v 1.5 2005/06/02 15:18:17 andy Exp $

     Original revision: r24690
-->

<!-- Copyright (c) 1998, 1999 Nik Clayton, All rights reserved.

     Redistribution and use in source (SGML DocBook) and 'compiled' forms
     (SGML HTML, PDF, PostScript, RTF and so forth) with or without
     modification, are permitted provided that the following conditions
     are met:

      1. Redistributions of source code (SGML DocBook) must retain the above
	 copyright notice, this list of conditions and the following
	 disclaimer as the first lines of this file unmodified.

      2. Redistributions in compiled form (transformed to other DTDs,
	 converted to PDF, PostScript, RTF and other formats) must reproduce
	 the above copyright notice, this list of conditions and the
	 following disclaimer in the documentation and/or other materials
	 provided with the distribution.

     THIS DOCUMENTATION IS PROVIDED BY NIK CLAYTON "AS IS" AND ANY EXPRESS OR
     IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
     OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
     DISCLAIMED. IN NO EVENT SHALL NIK CLAYTON BE LIABLE FOR ANY DIRECT,
     INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
     (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
     SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
     HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
     STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
     ANY WAY OUT OF THE USE OF THIS DOCUMENTATION, EVEN IF ADVISED OF THE
     POSSIBILITY OF SUCH DAMAGE.
-->

<chapter id="the-website">
  <title>Web-сервер</title>

  <sect1 id="the-website-prep">
    <title>Подготовка</title>

    <para>Найдите 200 Мбайт свободного дискового пространства.  Вам потребуется
      место для инструментов SGML, части дерева CVS, временное пространство для
      построения и пространство для установки Web-страниц.  Если  у вас уже
      установлены инструменты SGML и дерево CVS, то вам нужно только около
      100 Мбайт свободного дискового пространства.</para>

    <note>
      <para>Удостоверьтесь, что ваши порты, относящиеся к документации,
	являются самыми последними.  Если сомневаетесь, то удалите старые порты
	командой &man.pkg.delete.1; перед тем, как устанавливать порт.  К
	примеру, на данный момент мы завязаны на jade-1.2, а если у вас
	установлен пакет jade-1.1, то, пожалуйста, выполните</para>

      <screen>&prompt.root; <userinput>pkg_delete jade-1.1</userinput></screen>
    </note>

    <para>Настройте хранилище CVS.  В дереве CVS вам нужны каталоги www, doc и
      ports (плюс, конечно же, CVSROOT).  Пожалуйста, прочтите введение в
      CVSup по адресу <ulink url="&url.books.handbook;/synching.html#CVSUP">
      Введение в CVSup</ulink> о том, как
      получать зеркальную копию дерева CVS или его частей.</para>

    <para>Достаточно иметь следующие наборы cvsup: <literal>www</literal>,
      <literal>doc-all</literal>, <literal>cvs-base</literal> и
      <literal>ports-base</literal>.</para>

    <para>Эти наборы требуют около 105 Мбайт свободного дискового
      пространства.</para>

    <para>Полное дерево CVS, включая <literal>src</literal>,
      <literal>doc</literal>, <literal>www</literal> и
      <literal>ports</literal> в настоящее время занимает около 940
      Мбайт.</para>
  </sect1>

  <sect1 id="the-website-build">
    <title>Построение Web-страниц с нуля</title>

    <procedure>
      <step>
	<para>Создайте каталог для построения с объёмом свободного пространства
          не менее 60 Мбайт и перейдите в него.</para>

	<screen>&prompt.root; <userinput>mkdir /var/tmp/webbuild</userinput>
&prompt.root; <userinput>cd /var/tmp/webbuild</userinput></screen>
      </step>

      <step>
	<para>Извлеките файлы SGML из дерева CVS.</para>

	<screen>&prompt.root; <userinput>cvs -R co www doc</userinput></screen>
      </step>

      <step>
	<para>Перейдите в каталог <filename role="directory">www/en</filename>
          и запустите команду &man.make.1; <maketarget>all</maketarget> для
          создания Web-страниц.</para>

	<screen>&prompt.root; <userinput>cd en</userinput>
&prompt.root; <userinput>make all</userinput></screen>
      </step>
    </procedure>
  </sect1>

  <sect1 id="the-website-install">
    <title>Установка Web-страниц в ваш Web-сервер</title>

    <procedure>
      <step>
	<para>Если вы вышли из каталога <filename>en</filename>, то вернитесь в
	  него.</para>

	  <screen>&prompt.root; <userinput>cd <replaceable>path</replaceable>/www/en</userinput></screen>
      </step>

      <step>
	<para>Запустите команду &man.make.1; <maketarget>install</maketarget>,
	  установив переменную <makevar>DESTDIR</makevar> в имя каталога, в
	  который вы хотите установить файлы.</para>

	<screen>&prompt.root; <userinput>make DESTDIR=<replaceable>/usr/local/www</replaceable> install</userinput></screen>
      </step>

      <step>
	<para>Если ранее вы устанавливали Web-страницы в тот же самый каталог,
	  то в процессе установки не будут удалены ни одна из старых или
	  устаревших страниц.  К примеры, если вы перестраиваете и
	  устанавливаете новую копию сайта каждый день, то эта команда найдет и
	  удалит все файлы, которые не были обновлены в течение трех
	  дней.</para>

	<screen>&prompt.root; <userinput>find <replaceable>/usr/local/www</replaceable> -ctime 3 -print0 | xargs -0 rm</userinput></screen>
      </step>
    </procedure>
  </sect1>

  <sect1 id="the-website-env">
    <title>Переменные окружения</title>

    <variablelist>
      <varlistentry>
	<term><envar>CVSROOT</envar></term>

	<listitem>
	  <para>Расположение дерева CVS.  Нужна.</para>

	  <screen><userinput>&prompt.root; CVSROOT=/home/ncvs; export CVSROOT</userinput></screen>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><makevar>ENGLISH_ONLY</makevar></term>
	
	<listitem>
	  <para>Если она установлена и не пуста, то при выполнении make-файлов
	    будут строиться и устанавливаться документы только на английском
	    языке.  Все переводы будут проигнорированы.  Например:</para>

	  <screen>&prompt.root; <userinput>make ENGLISH_ONLY=YES all install</userinput></screen>

	  <para>Если вы хотите снять установку значений переменной
	    <makevar>ENGLISH_ONLY</makevar> и построить все страницы, включая
	    переводы, то задайте переменной <makevar>ENGLISH_ONLY</makevar>
	    пустое значение</para>

	  <screen>&prompt.root; <userinput>make ENGLISH_ONLY="" all install clean</userinput></screen>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><makevar>WEB_ONLY</makevar></term>
	
	<listitem>
	  <para>Если задана и не пуста, то при выполнении make-файлов будут
	    построены и установлены страницы HTML только из каталога www.  Все
	    документы из каталога doc (Руководство, FAQ, Учебники) будут
	    проигнорированы.  К примеру:</para>

	  <screen>&prompt.root; <userinput>make WEB_ONLY=YES all install</userinput></screen>
	</listitem>
      </varlistentry>
	
      <varlistentry>
	<term><makevar>NOPORTSCVS</makevar></term>
	
	<listitem>
	  <para>Если задана, то при выполнении make-файлов файлы портов из
	    хранилища cvs извлекаться не будут.  Вместо этого будут скопированы
	    файлы из <filename>/usr/ports</filename> (или из каталога, на
	    который указывает переменная <envar>PORTSBASE</envar>).</para>
	</listitem>
      </varlistentry>
    </variablelist>

    <para><envar>CVSROOT</envar> является переменной окружения.  Вы должны
      задать её в командной строке или в ваших настроечных файлах (например,
      ~/.profile).</para>

    <para><makevar>WEB_ONLY</makevar>, <makevar>ENGLISH_ONLY</makevar> и
      <makevar>NOPORTSCVS</makevar> являются переменными make-файлов.  Вы
      можете задать их в файлах <filename>/etc/make.conf</filename> и
      <filename>Makefile.inc</filename>, работать с ними как с переменными
      окружения в командной строке или файлах командного процессора.</para>
  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->

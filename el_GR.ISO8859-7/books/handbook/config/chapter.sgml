<!--

  Το Εγχειρίδιο του FreeBSD: Ρύθμιση και Βελτιστοποίηση

  The FreeBSD Greek Documentation Project

  $FreeBSD$

  %SOURCE%	en_US.ISO8859-1/books/handbook/config/chapter.sgml
  %SRCID%	1.229

-->

<chapter id="config-tuning">
  <chapterinfo>
    <authorgroup>
      <author>
        <firstname>Chern</firstname>
	<surname>Lee</surname>
	<contrib>Γράφτηκε από τον </contrib>
      </author>
    </authorgroup>
    <authorgroup>
      <author>
        <firstname>Mike</firstname>
	<surname>Smith</surname>
	<contrib>Βασίστηκε σε tutorial γραμμένο από τον </contrib>
      </author>
    </authorgroup>
    <authorgroup>
      <author>
        <firstname>Matt</firstname>
	<surname>Dillon</surname>
	<contrib>Βασισμένο επίσης στο tuning(7) που γράφηκε από τον </contrib>
      </author>
    </authorgroup>
  </chapterinfo>

  <title>Ρύθμιση και Βελτιστοποίηση</title>

  <sect1 id="config-synopsis">
    <title>Σύνοψη</title>

    <indexterm><primary>ρύθμιση συστήματος</primary></indexterm>
    <indexterm><primary>βελτιστοποίηση συστήματος</primary></indexterm>

    <para>Ένα από τα σημαντικά χαρακτηριστικά του &os; είναι η δυνατότητα
      ρύθμισης του συστήματος.  Με τις σωστές ρυθμίσεις συστήματος είναι
      εύκολο να αποφευχθούν πολλά προβλήματα κατά τη διάρκεια μελλοντικών
      αναβαθμίσεων.  Το κεφάλαιο αυτό θα εξηγήσει μεγάλο μέρος της διαδικασίας
      ρύθμισης του &os;, συμπεριλαμβανομένων και κάποιων παραμέτρων που
      μπορούν να ρυθμιστούν για την βελτιστοποίηση της απόδοσης του
      συστήματος.</para>

    <para>Αφού διαβάσετε αυτό το κεφάλαιο, θα ξέρετε:</para>

    <itemizedlist>
      <listitem>
	<para>Πως να δουλέψετε αποδοτικά με συστήματα αρχείων και κατατμήσεις
	  swap.</para>
      </listitem>
      <listitem>
	<para>Τα βασικά των συστημάτων ρύθμισης και εκκίνησης
	  <filename>rc.conf</filename> και
	  <filename class="directory">/usr/local/etc/rc.d</filename>.</para>
      </listitem>
      <listitem>
	<para>Πως να ρυθμίσετε και να δοκιμάσετε μια κάρτα δικτύου.</para>
      </listitem>
      <listitem>
	<para>Πως να ρυθμίσετε virtual hosts στις δικτυακές σας συσκευές.</para>
      </listitem>
      <listitem>
	<para>Πως να χρησιμοποιήσετε τα διάφορα αρχεία ρυθμίσεων στον κατάλογο
	  <filename class="directory">/etc</filename>.</para>
      </listitem>
      <listitem>
	<para>Πως να βελτιστοποιήσετε το &os; χρησιμοποιώντας μεταβλητές
	  <command>sysctl</command>.</para>
      </listitem>
      <listitem>
	<para>Πως να βελτιστοποιήσετε την απόδοση του δίσκου και να αλλάξετε τους
	  περιορισμούς του πυρήνα.</para>
      </listitem>
    </itemizedlist>

    <para>Πριν διαβάσετε αυτό το κεφάλαιο, θα πρέπει:</para>

    <itemizedlist>
      <listitem>
	<para>Να κατανοείτε βασικές έννοιες του &unix; και του &os; (<xref
	    linkend="basics">).</para>
      </listitem>

      <listitem>
	<para>Να είστε εξοικειωμένοι με τα βασικά της ρύθμισης και της
	  μεταγλώττισης του πυρήνα (<xref linkend="kernelconfig">).</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 id="configtuning-initial">
    <title>Αρχική Ρύθμιση</title>

    <sect2>
      <title>Διάταξη Κατατμήσεων</title>

      <indexterm><primary>partition layout</primary></indexterm>
      <indexterm>
        <primary><filename class="directory">/etc</filename></primary>
      </indexterm>
      <indexterm>
        <primary><filename class="directory">/var</filename></primary>
      </indexterm>
      <indexterm>
        <primary><filename class="directory">/usr</filename></primary>
      </indexterm>

      <sect3>
	<title>Βασικές Κατατμήσεις</title>

	<para>Όταν δημιουργείτε συστήματα αρχείων με το &man.bsdlabel.8; ή το
	  &man.sysinstall.8;, θυμηθείτε ότι οι σκληροί δίσκοι μεταφέρουν
	  δεδομένα γρηγορότερα απο τα εξωτερικά μέροι τους στα εσωτερικά.
	  Έτσι μικρότερα και περισσότερο προσβάσιμα συστήματα αρχείων πρέπει
	  να είναι πλησιέστερα στο εξωτερικό του δίσκου, ενώ μεγαλύτερες
	  κατατμήσεις όπως το <filename class="directory">/usr</filename> πρέπει να
	  τοποθετούνται πιο κοντά στο εσωτερικό του δίσκου.  Είναι καλή ιδέα
	  να δημιουργείτε κατατμήσεις με παρόμοια σειρά με αυτήν: root,
	  swap, <filename class="directory">/var</filename>, <filename class="directory">/usr</filename>.</para>

	<para>Το μέγεθος του <filename class="directory">/var</filename> αντανακλά την
	  επιδιωκούμενη χρήση του μηχανήματος.  Το <filename class="directory">/var</filename>
	  χρησιμοποιείτε για την αποθήκευση των γραμματοκιβωτίων, των αρχείων
	  καταγραφής και του spooler του εκτυπωτή.  Τα γραμματοκιβώτια και τα
	  αρχεία καταγραφής μπορούν να μεγαλώσουν σε απροσδόκητα μεγέθη
	  ανάλογα με τον αριθμό των χρηστών του συστήματος και το χρονικό
	  διάστημα που κρατούνται τα αρχεία καταγραφής.  Σπάνια χρειάζεται
	  το <filename class="directory">/var/tmp</filename> να έχει πάνω από ένα gigabyte χώρο,
	  αλλά καλό είναι να έχετε κατά νου ότι πρέπει να είναι αρκετά μεγάλο
	  για να κρατάει τα πακέτα που θέλετε να εγκαταστήσετε.</para>

	<para>Η κατάτμηση <filename class="directory">/usr</filename> περιέχει τα περισσότερα
	  αρχεία που απαιτούνται για την υποστήριξη του συστήματος, τη συλλογή
	  των &man.ports.7; (προτείνεται) και τον πηγαίο κώδικα (προαιρετικό).
	  Και τα δύο αυτά είναι προαιρετικά κατα την εγκατάσταση.  Τουλάχιστον
	  2 gigabytes προτείνονται για αυτή την κατάτμηση.</para>

	<para>Όταν επιλέγετε μέγεθος για τις κατατμήσεις, να έχετε υπόψιν σας
	  τις απαιτήσεις σε χώρο.  Μπορεί να είναι λίγο πρόβλημα το να μείνετε
	  χωρίς χώρο σε μια κατάτμηση ενώ χρησιμοποιείτε ελάχιστα μια
	  άλλη.</para>

	<note>
	  <para>Μερικές φορές η επιλογή <literal>Auto-defaults</literal> του
	    κατατμητή του &man.sysinstall.8; μπορεί να επιλέξει πολύ μικρό
	    μέγεθος για τις κατατμήσεις <filename class="directory">/var</filename>
	    και <filename class="directory">/</filename>.  Προσπαθείστε να επιλέξετε έξυπνα και
	    γενναιόδωρα μεγέθη για τις κατατμήσεις σας.</para></note>
      </sect3>

      <sect3 id="swap-design">
	<title>Swap Κατάτμηση</title>

	<indexterm><primary>swap sizing</primary></indexterm>
	<indexterm><primary>swap partition</primary></indexterm>

	<para>Ένας εμπειρικός κανόνας για να επιλέξετε μέγεθος για την
	  κατάτμηση swap είναι: πρέπει να είναι περίπου διπλή απο το μέγεθος
	  της μνήμης (RAM) του συστήματος.  Για παράδειγμα, αν το μηχάνημα
	  έχει 128&nbsp;megabytes μνήμης, η κατάτμηση swap πρέπει να είναι
	  256&nbsp;megabytes.  Συστήματα με λιγότερη μνήμη μπορούν να
	  αποδίδουν καλύτερα με περισσότερο swap.  Λιγότερο απο
	  256&nbsp;megabytes swap δεν προτείνεται και πρέπει να εξεταστεί η
	  επέκταση της μνήμης.  Οι αλγόριθμοι VM paging του πυρήνα είναι έτσι
	  φτιαγμένοι ώστε να αποδίδουν καλύτερα όταν η κατάτμηση swap είναι
	  τουλάχιστον δύο φορές το μέγεθος της κεντρικής μνήμης.  Αν ρυθμίσετε
	  πολύ μικρό swap, μπορεί να έχουν μειωμένη απόδοση οι αλγόριθμοι
	  σάρωσης σελίδων του υποσυστήματος VM και μπορεί αργότερα να
	  δημιουργηθούν προβλήματα αν προστεθεί περισσότερη φυσική
	  μνήμη.</para>

	<para>Σε μεγαλύτερα συστήματα με πολλαπλούς SCSI δίσκους (ή πολλαπλούς
	  IDE δίσκους σε διαφορετικούς ελεγκτές), είναι προτιμότερο το swap να
	  είναι ρυθμισμένο σε κάθε δίσκο (μέχρι τέσσερις δίσκους).  Οι
	  ξεχωριστές κατατμήσεις swap καλό είναι να έχουν περίπου το ίδιο
	  μέγεθος.  Ο πυρήνας μπορεί να χειριστεί αυθαίρετα μεγέθη swap, αλλά
	  οι εσωτερικές δομές δεδομένων ρυθμίζονται με βάση το μέγεθος της
	  μεγαλύτερης κατάτμησης swap.  Κρατώντας την κατάτμηση swap σχεδόν
	  στο ίδιο μέγεθος θα επιτρέψει στον πυρήνα να βελτιστοποιήσει την
	  χρήση του swap, μοιράζοντας πιο καλά το φόρτο σε κάθε δίσκο.  Δεν
	  πειράζει να έχετε μεγάλο μέγεθος swap, ακόμα και αν δε
	  χρησιμοποιείται αρκετά.  Μπορεί να είναι ευκολότερη η ανάκαμψη απο
	  ένα εκτός ελέγχου πρόγραμμα προτού χρειαστεί να επανεκκινήσετε το
	  σύστημα.</para>
      </sect3>

      <sect3>
	<title>Γιατί να φτιάξετε κατατμήσεις;</title>

	<para>Αρκετοί χρήστες νομίζουν ότι μία μεγάλη κατάτμηση θα είναι
	  εντάξει, αλλά υπάρχουν αρκετοί λόγοι γιατί αυτό είναι κακή ιδέα.
	  Καταρχήν, κάθε κατάτμηση έχει διαφορετικά λειτουργικά
	  χαρακτηριστικά, οπότε ξεχωρίζοντας τις κατατμήσεις επιτρέπουμε στο
	  σύστημα αρχείων να εναρμονίζεται ανάλογα.  Για παράδειγμα, οι root
	  και <filename class="directory">/usr</filename> κατατμήσεις είναι κυρίως για ανάγνωση,
	  χωρίς πολλές εγγραφές.  Αντίθετα, γίνονται πολλές αναγνώσεις και
	  εγγραφές στις <filename class="directory">/var</filename> και
	  <filename class="directory">/var/tmp</filename>.</para>

	<para>Κάνοντας σωστή κατάτμηση σε ένα σύστημα, ο κατακερματισμός που
	  συμβαίνει σε μικρότερες και περισσότερο εγγράψιμες κατατμήσεις δεν
	  θα διαρρεύσει στις κατατμήσεις που διαβάζονται πιο συχνά από ότι
	  γράφονται.  Κρατώντας τις περισσότερο εγγράψιμες κατατμήσεις πιο
	  κοντά στην άκρη του δίσκου, θα αυξηθεί η I/O απόδοση στις
	  κατατμήσεις όπου και χρειάζεται πιο συχνά.  Τώρα ενώ η απόδοση I/O
	  χρειάζεται στις μεγαλύτερες κατατμήσεις, αλλάζοντας αυτές πιο κοντά
	  στην άκρη του δίσκου δεν θα οδηγήσει σε σημαντική αύξηση της
	  απόδοσης όσο το να μετακινήσετε την <filename class="directory">/var</filename> στην
	  άκρη.  Τέλος, υπάρχει και θέμα ασφάλειας.  Μία μικρή, προσεγμένη
	  root κατάτμηση η οποία είναι διαβάζεται πιο συχνά από ότι γράφεται
	  έχει μεγαλύτερη πιθανότητα να επιζήσει ενός άσχημου
	  χτυπήματος.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 id="configtuning-core-configuration">
    <title>Κύρια Ρύθμιση</title>

    <indexterm>
      <primary>rc files</primary>
      <secondary><filename>rc.conf</filename></secondary>
    </indexterm>

    <para>Η κύρια τοποθεσία των πληροφοριών για την ρύθμιση του συστήματος
      βρίσκεται μέσα στο <filename>/etc/rc.conf</filename>.  Αυτό το αρχείο
      περιέχει ένα ευρύ φάσμα ρυθμίσεων, κυρίως χρησιμοποιούμενες στην
      εκκίνηση του συστήματος για την ρύθμιση του συστήματος.  Το όνομα του
      απευθείας συνεπάγεται αυτό; είναι ρυθμίσεις για τα
      αρχεία <filename>rc*</filename>.</para>

    <para>Ένας διαχειριστής πρέπει να δημιουργήσει εγγραφές μέσα στο
      αρχείο <filename>rc.conf</filename> ώστε να αντικαταστήσει τις
      προεπιλεγμένες ρυθμίσεις απο το
      αρχείο <filename>/etc/defaults/rc.conf</filename>.  Το αρχείο
      προεπιλογών δεν πρέπει να αντιγραφεί αυτολεξεί
      στο <filename class="directory">/etc</filename> - αυτό περιέχει προεπιλεγμένες τιμές, όχι
      παραδείγματα.  Όλες οι αλλαγές που αφορούν το σύστημα πρέπει να γίνουν
      στο αρχείο <filename>rc.conf</filename> αποκλειστικά.</para>

    <para>Ένας αριθμός στρατηγικών μπορεί να εφαρμοστεί σε ένα σύνολο
      εφαρμογών για να ξεχωρίσουμε ρυθμίσεις του ευρύ συνόλου απο τις
      ρυθμίσεις επικεντρωμένες για ένα σύστημα για να κρατήσουμε τον φόρτο
      διαχείρισης χαμηλά.  Η προτεινόμενη προσέγγιση είναι να τοποθετούμε τις
      ρυθμίσεις ευρύ συνόλου σε ένα διαφορετικό αρχείο, όπως
      το <filename>/etc/rc.conf.site</filename>, και τότε να συμπεριλάβουμε το
      αρχείο αυτό στο <filename>/etc/rc.conf</filename>, το οποίο θα περιέχει
      πληροφορίες επικεντρωμένες για ένα σύστημα.</para>

    <para>Μιάς και το <filename>rc.conf</filename> διαβάζεται απο το
      &man.sh.1; είναι εύκολο να το επιτύχουμε αυτό.  Για παράδειγμα:</para>

    <itemizedlist>
      <listitem><para>rc.conf:</para>
<programlisting>	. /etc/rc.conf.site
	hostname="node15.example.com"
	network_interfaces="fxp0 lo0"
	ifconfig_fxp0="inet 10.1.1.1"</programlisting></listitem>
      <listitem><para>rc.conf.site:</para>
<programlisting>	defaultrouter="10.1.1.254"
	saver="daemon"
	blanktime="100"</programlisting></listitem>
    </itemizedlist>

    <para>Το αρχείο <filename>rc.conf.site</filename> μπορεί έπειτα να
      διανεμηθεί σε κάθε σύστημα χρησιμοποιώντας το <command>rsync</command> ή
      κάποιο παρόμοιο πρόγραμμα, ενώ το αρχείο <filename>rc.conf</filename>
      παραμένει μοναδικό.</para>

    <para>Αναβαθμίζοντας το σύστημα χρησιμοποιώντας &man.sysinstall.8;
      ή <command>make world</command> δεν θα αντικαταστήσει το
      αρχείο <filename>rc.conf</filename>, έτσι οι ρυθμίσεις δεν θα
      χαθούν.</para>

  </sect1>

  <sect1 id="configtuning-appconfig">
    <title>Ρύθμιση Εφαρμογών</title>

    <para>Τυπικά, οι εγκατεστημένες εφαρμογές έχουν τα δικά τους αρχεία
      ρυθμίσεων, με το δικό τους τρόπο σύνταξης, κτλπ.  Είναι σημαντικό αυτά
      τα αρχεία να κρατούνται ξεχωριστά απο το βασικό σύστημα, έτσι ώστε να
      είναι εύκολα εντοπίσιμα και διαχειρίσιμα απο τα εργαλεία διαχείρισης
      πακέτων.</para>

    <indexterm><primary>/usr/local/etc</primary></indexterm>

    <para>Τυπικά, αυτά τα αρχεία είναι εγκατεστημένα στο
      <filename class="directory">/usr/local/etc</filename>.  Σε αυτή την περίπτωση όταν μία
      εφαρμογή έχει μεγάλο αριθμό αρχείων ρυθμίσεων, ένας υποκατάλογος
      δημιουργείται για να τα αποθηκεύσει.</para>

    <para>Κανονικά, όταν ένα port ή ένα package εγκαθιστάτε, παραδείγματα
      αρχείων ρυθμίσεων εγκαθιστάνται επίσης.  Αυτά είναι συνήθως αναγνωρίσιμα
      απο την <filename>.default</filename> κατάληξη τους.  Αν δεν υπάρχουν
      αρχεία ρυθμίσεων για την εφαρμογή, τότε θα δημιουργηθούν κάνοντας
      αντιγραφή τα <filename>.default</filename> αρχεία.</para>

    <para>Για παράδειγμα, έχετε υπόψη σας τα περιεχόμενα του
      καταλόγου <filename class="directory">/usr/local/etc/apache</filename>:</para>

<literallayout class="monospaced">-rw-r--r--  1 root  wheel   2184 May 20  1998 access.conf
-rw-r--r--  1 root  wheel   2184 May 20  1998 access.conf.default
-rw-r--r--  1 root  wheel   9555 May 20  1998 httpd.conf
-rw-r--r--  1 root  wheel   9555 May 20  1998 httpd.conf.default
-rw-r--r--  1 root  wheel  12205 May 20  1998 magic
-rw-r--r--  1 root  wheel  12205 May 20  1998 magic.default
-rw-r--r--  1 root  wheel   2700 May 20  1998 mime.types
-rw-r--r--  1 root  wheel   2700 May 20  1998 mime.types.default
-rw-r--r--  1 root  wheel   7980 May 20  1998 srm.conf
-rw-r--r--  1 root  wheel   7933 May 20  1998 srm.conf.default</literallayout>

    <para>Τα μεγέθοι των αρχείων δείχνουν ότι μόνο το
      αρχείο <filename>srm.conf</filename> έχει αλλάξει.  Μία μετέπειτα
      αναβάθμιση του port της εφαρμογής <application>Apache</application> δεν
      θα αντικαταστήσει το αλλαγμένο αρχείο.</para>

  </sect1>

  <sect1 id="configtuning-starting-services">
    <sect1info>
      <authorgroup>
        <author>
	<firstname>Tom</firstname>
	<surname>Rhodes</surname>
	<contrib>Contributed by </contrib>
	</author>
      </authorgroup>
    </sect1info>

    <title>Eκκινώντας Υπηρεσίες</title>

    <indexterm><primary>services</primary></indexterm>

    <para>Πολλοί χρήστες επιλέγουν να εγκαταστήσουν λογισμικό απο τρίτους
      κατασκευαστές στο &os; απο την συλλογή των Ports.  Σε πολλές απο αυτές
      τις περιπτώσεις μπορεί να είναι απαραίτητο να ρυθμίσουν το λογισμικό με
      τέτοιο τρόπο ώστε να μπορεί να επιτραπεί η εκκίνηση του κατα την
      εκκίνηση του συστήματος.  Υπηρεσίες, όπως
      το <filename role="package">mail/postfix</filename> ή
      το <filename role="package">www/apache13</filename> είναι μόνο δύο απο
      τα πολλά πακέτα λογισμικού που μπορεί να χρειάζονται να εκκινηθούν κατά
      την εκκίνηση του συστήματος.  Το μέρος αυτό θα εξηγήσει τις διαθέσιμες
      διαδικασίες για την εκκίνηση λογισμικού προερχόμενο απο τρίτους
      κατασκευαστές.</para>

    <para>Στο &os;, οι περισσότερες περιεχόμενες υπηρεσίες, όπως το
      &man.cron.8;, είναι εκκινήσιμες μέσα από τα σενάρια εκκίνησης του
      συστήματος.  Τα σενάρια αυτά μπορεί να διαφέρουν ανάλογα το &os; ή την
      έκδοση του κατασκευαστή; ωστόσο, η πιο σημαντική πτυχή που πρέπει να
      εξεταστεί είναι ότι οι ρυθμίσεις εκκίνησης τους μπορούν να χειριστούν
      μέσα απο ένα απλό σενάριο εκκίνησης.</para>

    <para>Πριν την έλευση του <filename>rc.d</filename>, οι εφαρμογές
      μπορούσαν να τοποθετήσουν ένα απλό σενάριο εκκίνησης μέσα στον
      κατάλογο <filename class="directory">/usr/local/etc/rc.d</filename> ο
      οποίος μπορούσε να διαβαστεί απο τα σενάρια εκκίνησης του συστήματος.
      Αυτά τα σενάρια μπορούσαν να εκτελεστούν κατα τα μετέπειτα στάδια
      εκκίνησης του συστήματος.</para>

    <para>Ενώ πολλοί ιδιώτες ξόδευαν χρόνο προσπαθώντας να συνχωνεύσουν το
      παλιό στυλ ρυθμίσεων με το νέο στυλ, παραμένει γεγονός ότι μερικά
      προγράμματα ακόμα απαιτούν ένα σενάριο να τοποθετηθεί μέσα στον
      προαναφερθέντα κατάλογο.  Οι λεπτές διαφορές ανάμεσα στα σενάρια
      εξαρτώνται από το αν ή όχι ο <filename>rc.d</filename> χρησιμοποιείτε.
      Προγενέστερα του &os;&nbsp;5.1 το παλιό στυλ ρυθμίσεων χρησιμοποιούνταν
      και σχεδόν σε όλες τις περιπτώσεις ένα νέου στυλ σενάριο θα είναι
      συμβατό.</para>

    <para>Ενώ κάθε σενάριο πρέπει να τηρεί ορισμένες ελάχιστες απαιτήσεις, τις
      περισσότερες φορές αυτές οι απαιτήσεις είναι ανεξάρτητες της έκδοσης του &os;.
      Κάθε σενάριο πρέπει να έχει μια <filename>.sh</filename>
      επέκταση προσαρτημένη στο τέλος του και κάθε σενάριο πρέπει να είναι
      εκτελέσιμο απο το σύστημα.  Το δεύτερο μπορεί να επιτευχθεί χρησιμοποιώντας
      την <command>chmod</command> εντολή και ρυθμίζοντας την άδεια
      <literal>755</literal>.  Εκεί πρέπει να υπάρχει, τουλάχιστον,
      μια επιλογή <literal>start</literal> και μία επιλογή
      <literal>stop</literal> για την εφαρμογή.</para>

    <para>Το πιο απλό σενάριο εκκίνησης πιθανότατα να
      μοιάζει με το παρακάτω:</para>

    <programlisting>#!/bin/sh
echo -n ' utility'

case "$1" in
start)
        /usr/local/bin/utility
        ;;
stop)
        kill -9 `cat /var/run/utility.pid`
        ;;
*)
        echo "Usage: `basename $0` {start|stop}" &gt;&2
        exit 64
        ;;
esac

exit 0</programlisting>

    <para>Το σενάριο αυτό παρέχει μια <literal>stop</literal> και μια
      <literal>start</literal> επιλογή για
      την εφαρμογή όπου στο παράδειγμα εδώ αναφέρεται σαν
      <literal>utility</literal>.</para>

    <para>Μπορεί να εκκινηθεί χειρωνακτικά κάνοντας:</para>

    <screen>&prompt.root; <userinput><filename>/usr/local/etc/rc.d/utility.sh</filename> start</userinput></screen>

    <para>Παρόλο που δεν απαιτούν όλες οι εφαρμογές να προστεθεί μία εγγραφή στο
      <filename>rc.conf</filename>, σχεδόν καθημερινά και ένα νέο port θα
      τροποποιήτε για να δέχεται αυτή την ρύθμιση.  Ελέγξετε την τελική έξοδο
      της εγκατάστασης για περισσότερες πληροφορίες πάνω στην συγκεκριμένη
      εφαρμογή.  Μερικές εφαρμογές απο τρίτους κατασκευαστές παρέχουν σενάρια
      εκκίνησης τα οποία επιτρέπουν στην εφαρμογή να χρησιμοποιηθεί με
      το <filename>rc.d</filename>, παρόλα αυτα, αυτό θα συζητηθεί στο επόμενο
      μέρος.</para>

    <sect2>
      <title>Εκτεταμένη Ρύθμιση Εφαρμογών</title>

      <para>Πλέον το &os; περιέχει το <filename>rc.d</filename>, η ρύθμιση της
	εκκίνησης των εφαρμογών έχει γίνει ευκολότερη, και πιο πλούσια σε
	χαρακτηρικά.  Χρησιμοποιώντας λέξεις κλειδία μέσα στον
	κατάλογο <link linkend="configtuning-rcd">rc.d</link>, οι εφαρμογές
	μπορούν πλέον να εκκινούν έπειτα απο συγκεκριμένες υπηρεσίες για
	παράδειγμα την <acronym>DNS</acronym>, μπορεί να επιτραπεί η εισαγωγή
	επιπλέον παραμέτρων μέσα απο το <filename>rc.conf</filename> στην θέση
	των ήδη υπάρχoντον παραμέτρων απο τα σενάρια εκκινήσης, κτλπ.  Ένα
	βασικό σενάριο μπορεί να μοιάζει με το ακόλουθο:</para>

      <programlisting>#!/bin/sh
#
# PROVIDE: utility
# REQUIRE: DAEMON
# KEYWORD: shutdown

. /etc/rc.subr

name=utility
rcvar=utility_enable

command="/usr/local/sbin/utility"

load_rc_config $name

#
# DO NOT CHANGE THESE DEFAULT VALUES HERE
# SET THEM IN THE /etc/rc.conf FILE
#
utility_enable=${utility_enable-"NO"}
pidfile=${utility_pidfile-"/var/run/utility.pid"}

run_rc_command "$1"</programlisting>

      <para>Το σενάριο αυτό θα εξασφαλίσει ότι το
	πρόγραμμα <application>utility</application> θα εκκινηθεί μετά απο
	την <literal>daemon</literal> υπηρεσία.  Θα εξασφαλίσει επιπλέον έναν
	τρόπο για την ρύθμιση και τον εντοπισμό του <acronym>PID</acronym>, ή
	του αρχείου του <acronym>ID</acronym> της διεργασίας.</para>

      <para>Η εφαρμογή μπορεί πλέον να έχει την παρακάτω γραμμή τοποθετημένη
	στο <filename>/etc/rc.conf</filename>:</para>

      <programlisting>utility_enable="YES"</programlisting>

      <para>Ο νέος αυτός τρόπος επιτρέπει επιπλέον τον ευκολότερο χειρισμό των
	παραμέτρων της γραμμής εντολών, σε συνδυασμό με τις προυπάρχουσες
	λειτουργίες παρεχόμενες απο το <filename>/etc/rc.subr</filename>, τη
	συμβατότητα με το βοηθητικό πρόγραμμα &man.rcorder.8; και επιπλέον την
	ευκολότερη ρύθμιση μέσω του <filename>rc.conf</filename>
	αρχείου.</para>
    </sect2>

    <sect2>
      <title>Χρησιμοποιώντας Υπηρεσίες Για Την Εκκίνηση Υπηρεσιών</title>

      <para>Άλλες υπηρεσίες, όπως ο δαίμονας του
	εξυπηρετή <acronym>POP</acronym>3, <acronym>IMAP</acronym>,
	κτλπ. μπορούν να εκκινηθούν χρησιμοποιώντας το &man.inetd.8;.  Αυτό
	απαιτεί την εγκατάσταση του βοηθητικού προγράμματος υπηρεσιών απο την
	Ports συλλογή και μια γραμμή ρυθμίσεων προσαρτημένη στο
	αρχείο <filename>/etc/inetd.conf</filename>, ή αποχαρακτηρίζοντας μια
	απο τις ήδη υπάρχουσες γραμμές ρυθμίσεων.  Δουλεύοντας με
	το <application>inetd</application> και τις ρυθμίσεις του περιγράφεται
	αναλυτικά στο μέρος <link linkend="network-inetd">inetd</link>.</para>

      <para>Σε πολλές περιπτώσεις, είναι εύλογο να χρησιμοποιείτε ο δαίμονας
	&man.cron.8; για την εκκίνηση των υπηρεσιών του συστήματος.  Η
	προσέγγιση αυτή έχει έναν αριθμό πλεονεκτημάτων γιατί
	το <command>cron</command> τρέχει τις διεργασίες σαν ιδιοκτήτης
	του <filename>crontab</filename> αρχείου.  Αυτό επιτρέπει στους
	κανονικούς χρήστες να εκκινούν και να διαχειρίζονται μερικές
	εφαρμογές.</para>

      <para>Το βοηθητικό πρόγραμμα <command>cron</command> παρέχει ένα
	μοναδικό χαρακτηριστικό, το <literal>@reboot</literal>, το οποίο
	μπορεί να χρησιμοποιηθεί στην θέση του χρονικού ορισμού.  Αυτό θα
	κάνει την εργασία να τρέξει όταν το &man.cron.8; εκκινηθεί, συνήθως
	κατά την εκκίνηση του συστήματος.</para>
    </sect2>
  </sect1>

  <sect1 id="configtuning-cron">
    <sect1info>
      <authorgroup>
        <author>
	<firstname>Tom</firstname>
	<surname>Rhodes</surname>
	<contrib>Contributed by </contrib>
	<!-- 20 May 2003 -->
	</author>
      </authorgroup>
    </sect1info>
    <title>Ρυθμίζοντας Το Πρόγραμμα <command>cron</command></title>

    <indexterm><primary>cron</primary>
      <secondary>configuration</secondary></indexterm>

    <para>Ένα απο τα πιο χρήσιμα βοηθητικά προγράμματα στο &os; είναι το
      &man.cron.8;.  Το πρόγραμμα <command>cron</command> τρέχει στο
      παρασκήνιο και συνεχώς ελέγχει το
      αρχείο <filename>/etc/crontab</filename>.  Το <command>cron</command>
      ελέγχει επίσης τον κατάλογο <filename class="directory">/var/cron/tabs</filename>,
      αναζητώντας καινούργια αρχεία <filename>crontab</filename>.  Τα
      αρχεία <filename>crontab</filename> έχουν αποθηκευμένες πληροφορίες για
      συγκεκριμένες διαδικασίες τις οποίες το <command>cron</command> πρέπει
      να εκτελέσει σε συγκεκριμένο χρόνο.</para>

    <para>Το <command>cron</command> χρησιμοποιεί δύο διαφορετικούς τύπους
      αρχείων ρυθμίσεων, το crontab του συστήματος και το crontab των χρηστών.
      Η μόνη διαφορά ανάμεσα στους δύο αυτούς τύπους είναι το έκτο πεδίο.  Στο
      crontab του συστήματος, το έκτο πεδίο είναι το όνομα του χρήστη με του
      οποίου θα εκτελεστεί η εντολή. Αυτό δίνει την δυνατότητα στο crontab του
      συστήματος να εκτελεί εντολές σαν οποιοδήποτε χρήστης. Στο crontab των
      χρηστών, το έκτο πεδίο είναι η εντολή που πρέπει να εκτελεστεί, και όλες
      οι εντολές εκτελούνται στο όνομα του χρήστη που δημιούργησε το crontab;
      αυτό είναι ένα σημαντικό χαρακτηριστικό ασφαλείας.</para>

    <note>
      <para>Τα crontabs των χρηστών επιτρέπουν σε μεμονωμένους χρήστες να
        προγραμματίσουν εργρασίες χωρίς την ανάγκη <username>root</username>
        δικαιωμάτον. Οι εντολές μέσα στο crontab ενός χρήστη τρέχουν με τα
        δικαιώματα του χρήστη του οποίου ανήκει το crontab.</para>

      <para>Ο χρήστης <username>root</username> μπορεί να έχει ένα crontab
        χρήστη ακριβώς όπως κάθε χρήστης. Αυτό είναι διαφορετικό απο
        το <filename>/etc/crontab</filename> (το crontab του συστήματος). Λόγο
        του crontab του συστήματος, δεν υπάρχει συνήθως καμία ανάγκη για την
        δημιουργία ενός ξεχωριστού crontab για τον
        χρήστη <username>root</username>.</para>
    </note>

    <para>Ας ρίξουμε μια ματία στο αρχείο <filename>/etc/crontab</filename>
      (το crontab του συστήματος):</para>


    <programlisting># /etc/crontab - root's crontab for &os;
#
# &dollar;&os;: src/etc/crontab,v 1.32 2002/11/22 16:13:39 tom Exp &dollar;
# <co id="co-comments">
#
SHELL=/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin <co id="co-env">
HOME=/var/log
#
#
#minute	hour	mday	month	wday	who	command <co id="co-field-descr">
#
#
*/5	*	*	*	*	root	/usr/libexec/atrun <co id="co-main">
</programlisting>

    <calloutlist>
      <callout arearefs="co-comments">
	<para>Όπως στα περισσότερα αρχεία ρυθμίσεων στο &os;, ο
	  χαρακτήρας <literal>#</literal> παριστάνει ένα σχόλιο.  Ένα σχόλιο
	  μπορεί να τοποθετηθεί μέσα στο αρχείο σαν υπενθύμιση για το τι
	  πραγματοποιεί και γιατί μία ενέργεια.  Τα σχόλια δεν μπορούν να
	  είναι στην ίδια γραμμή με μία εντολή γιατί αλλιώς θα ερμηνευτούν σαν
	  κομμάτι της εντολής; πρέπει να είναι σε μία νέα γραμμή.  Οι κενές
	  γραμμές αγνοούνται.</para>
      </callout>

      <callout arearefs="co-env">
	<para>Καταρχήν, πρέπει να καθοριστεί το περιβάλλον.  Ο χαρακτήρας ίσον
	  (<literal>=</literal>) χρησιμοποιείτε για να καθορίσει τις ρυθμίσεις
	  του περιβάλλοντος, όπως σε αυτό το παράδειγμα που χρησιμοποιούνται
	  οι μεταβλητές <envar>SHELL</envar>, <envar>PATH</envar>,
	  και <envar>HOME</envar>.  Αν η γραμμή του κέλυφους παραμεληθεί,
	  το <command>cron</command> θα χρησιμοποιήσει την προεπιλεγμένη, οι
	  οποία είναι η <command>sh</command>.  Αν η
	  μεταβλητή <envar>PATH</envar> παραμεληθεί, δεν θα χρησιμοποιηθεί
	  προεπιλεγμένη και η τοποθεσίες των αρχείων θα πρέπει να καθοριστούν
	  με ακρίβεια.  Αν η <envar>HOME</envar> παραμεληθεί,
	  το <command>cron</command> θα χρησιμοποιήσει τον κεντρικό κατάλογο
	  των εκάστοτε χρηστών.</para>
      </callout>

      <callout arearefs="co-field-descr">
	<para>Η γραμμή αυτή καθορίζει συνολικά επτά πεδία.  Τα πεδία αυτά
	  είναι τα <literal>minute</literal>, <literal>hour</literal>,
 	  <literal>mday</literal>, <literal>month</literal>,
	  <literal>wday</literal>, <literal>who</literal>,
	  και <literal>command</literal>.  Αυτά είναι απο μόνα τους
	  επεξηγηματικά.  Το πεδίο <literal>minute</literal> είναι ο χρόνος σε
	  λεπτά τον οποίον η εντολή θα εκτελεστεί.  Το
	  πεδίο <literal>hour</literal> είναι παρόμοιο με το πεδίο
	  <literal>minute</literal>, απλά είναι σε ώρες.  Το
	  πεδίο <literal>mday</literal> καθορίζει την ημέρα του μήνα.  Το
	  πεδίο <literal>month</literal> είναι παρόμοιο με το
	  πεδίο <literal>hour</literal> και το
	  πεδίο <literal>minute</literal>, υποδεικνύοντας τον μήνα.  Το
	  πεδίο <literal>wday</literal> καθορίζει την ημέρα της εβδομάδας.
	  Όλα αυτά τα πεδία πρέπει να έχουν αριθμητικές τιμές, και να
	  ακολουθούν το είκοσι-τετράωρο ρολόι.  Το
	  πεδίο <literal>who</literal> είναι ιδιαίτερο, και υπάρχει μόνο μέσα
	  στο αρχείο <filename>/etc/crontab</filename>.  Το πεδίο αυτό
	  καθορίζει σαν ποιός χρήστης θα τρέξει την εντολή.  Όταν ένας χρήστης
	  εγκαθιστά το <filename>crontab</filename> αρχείο του, δεν θα έχει το
	  πεδίο αυτό διαθέσιμο.  Τέλος, θα ακολουθήσει η
	  επιλογή <literal>command</literal>.  Αυτό είναι το τελευταίο πεδίο,
	  έτσι και λογικά υποδεικνύει την εντολή που θα εκτελεστεί.</para>
      </callout>

      <callout arearefs="co-main">
	<para>Η τελευταία αυτή γραμμή θα καθορίσει τα μεγέθοι που συζητήθηκαν
	  παραπάνω.  Προσέξτε εδώ ότι έχουμε έναν
	  ορισμό <literal>*/5</literal>, ακολουθούμενο απο αρκετούς
	  χαρακτήρες <literal>*</literal>.  Οι χαρακτήρες <literal>*</literal>
	  σημαίνουν <quote>πρώτο-τελευταίο</quote>, και μπορούν να ερμηνευθούν
	  σαν <emphasis>κάθε</emphasis> φορά.  Έτσι, κρίνοντας απο αυτή την
	  γραμμή, είναι προφανές ότι η εντολή <command>atrun</command>
	  επικαλείται απο τον χρήστη <username>root</username> κάθε πέντε
	  λεπτά ανεξάρτητα απο την ημέρα και τον μήνα.  Για περισσότερες
	  πληροφορίες σχετικά με την εντολή <command>atrun</command>, κοιτάξτε
	  την σελίδα βοηθείας &man.atrun.8;.</para>

	<para>Οι εντολές μπορούν να έχουν απεριόριστο αριθμό παραμέτρων,
	  ωστόσο, οι εντολές με εκτεταμένο αριθμό γραμμών πρέπει να
	  διασπαστούν με τον χαρακτήρα συνέχειας αντίθετης
	  καθέτου <quote>\</quote>.</para>
      </callout>
    </calloutlist>

    <para>Αυτές είναι οι βασικές ρυθμίσεις για κάθε
      αρχείο <filename>crontab</filename>, ωστόσο υπάρχει και κάτι
      διαφορετικό.  Το πεδίο έξι, όπου και καθορίζουμε το όνομα χρήστη,
      υπάρχει μόνο στο αρχείο του
      συστήματος <filename>/etc/crontab</filename>.  Το πεδίο αυτό πρέπει να
      παραλειφθεί για κάθε <filename>crontab</filename> αρχείο χρήστη.</para>


    <sect2 id="configtuning-installcrontab">
      <title>Εγκαθιστώντας Ένα Crontab</title>

      <important>
      <para>Δεν θα πρέπει να χρησιμοποιήσετε την διαδικασία που περιγράφεται
        εδώ για την διόρθωση/εγκατάσταση του crontab του συστήματος.  Απλά
        χρησιμοποιήστε τον αγαπημένο σας κειμενογράφο:
        το <command>cron</command> θα εντοπίσει ότι το αρχείο έχει
        τροποποιηθεί και θα αρχίσει άμεσα να χρησιμοποιεί την ανανεωμένη
        έκδοση του.
        Δείτε <ulink url="&url.books.faq;/admin.html#ROOT-NOT-FOUND-CRON-ERRORS">αυτή
          την εγγραφή του FAQ </ulink> για περισσότερες πληροφορίες.</para>
      </important>

      <para>Για να εγκαταστήσετε ένα νέο <filename>crontab</filename> χρήστη,
	πρώτα χρησιμοποιήστε τον αγαπημένο σας κειμενογράφο για να
	δημιουργήσετε ένα αρχείο με το απαιτούμενο τύπο, και τότε
	χρησιμοποιήστε το <command>crontab</command>.  Η πιο κοινή χρήση του
	είναι:</para>

      <screen>&prompt.user; <userinput>crontab crontab-file</userinput></screen>

      <para>Στο παράδειγμα αυτό, το αρχείο <filename>crontab-file</filename>
	είναι το όνομα του αρχείου <filename>crontab</filename> που είχε
	δημιουργηθεί προηγουμένως.</para>

      <para>Υπάρχει επίσης μία επιλογή για να απαριθμήσετε τα εγκατεστημένα
	αρχεία <filename>crontab</filename>: απλά εισάγετε την
	επιλογή <option>-l</option> στην εντολή <command>crontab</command> και
	ελέγξτε το αποτέλεσμα.</para>

      <para>Για τους χρήστες που θέλουν να αρχίσουν το crontab αρχείο τους απο
	την αρχή, χωρίς την χρήση προτύπου, μπορούν να χρησιμοποιήσουν την
	εντολή <command>crontab -e</command>.  Αυτή η εντολή θα ξεκινήσει τον
	κειμενογράφο με ένα κενό αρχείο.  Όταν το αρχείο αποθηκευθεί, θα
	εγκατασταθεί αυτόματα απο την
	εντολή <command>crontab</command>.</para>

      <para>Αν αργότερα θέλετε να διαγράψετε το <filename>crontab</filename>
	αρχείο χρήστη τελείως, χρησιμοποιήστε την
	εντολή <command>crontab</command> μαζί με την
	επιλογή <option>-r</option>.
      </para>
    </sect2>
  </sect1>

  <sect1 id="configtuning-rcd">
    <sect1info>
      <authorgroup>
        <author>
	 <firstname>Tom</firstname>
	 <surname>Rhodes</surname>
	 <contrib>Contributed by </contrib>
	 <!-- 16 May 2003 -->
        </author>
      </authorgroup>
    </sect1info>

    <title>Χρησιμοποιώντας Το Σύστημα rc Στο &os;</title>

    <para>Το 2002 το &os; ενσωμάτωσε το σύστημα <filename>rc.d</filename> του
      NetBSD για την εκκίνηση του συστήματος.  Οι χρήστες θα πρέπει να έχουν
      αντιληφθεί τα αρχεία που βρίσκονται στον
      κατάλογο <filename class="directory">/etc/rc.d</filename>.  Πολλά απο αυτά τα αρχεία είναι
      για τις βασικές υπηρεσίες και μπορούν να ελεγθούν με τις
      επιλογές <option>start</option>, <option>stop</option>,
      και <option>restart</option>.  Για παράδειγμα, το &man.sshd.8; μπορεί να
      ελεγθεί χρησιμοποιώντας την εξής εντολή:</para>

    <screen>&prompt.root; <userinput>/etc/rc.d/sshd restart</userinput></screen>

    <para>Η διαδικασία αυτή είναι παρόμοια και για τις υπόλοιπες υπηρεσίες.
      Φυσικά, οι υπηρεσίες αυτές είναι συνήθως αυτόματα εκκινήσιμες κατα την
      εκκίνηση του συστήματος όπως και καθορίζεται στο &man.rc.conf.5;.  Για
      παράδειγμα, ενεργοποιώντας τον δαίμονα Network Address Translation στην
      εκκίνηση είναι τόσο απλό όσο κάνοντας προσθήκη της ακόλουθης γραμμής
      στο <filename>/etc/rc.conf</filename>:</para>

    <programlisting>natd_enable="YES"</programlisting>

    <para>Αν η επιλογή <option>natd_enable="NO"</option> είναι ήδη παρούσα,
       τότε απλά αλλάζετε την επιλογή <option>NO</option>
       σε <option>YES</option>.  Τα σενάρια rc θα φορτώσουν αυτόματα
       οποιαδήποτε εξαρτώμενη υπηρεσία κατά την διάρκεια της επόμενης
       εκκίνησης, όπως και περιγράφεται παρακάτω.</para>

    <para>Μιας και το σύστημα <filename>rc.d</filename> είναι κυρίως για την
      εκκίνηση και τον τερματισμό υπηρεσιών κατα την εκκίνηση και τον
      τερματισμό του συστήματος αντίστοιχα, οι προκαθορισμένες
      επιλογές <option>start</option>, <option>stop</option>
      και <option>restart</option> θα πραγματοποιήσουν τις αντίστοιχες
      ενέργειες αν η κατάλληλες μεταβλητές είναι καθορισμένες
      στο <filename>/etc/rc.conf</filename>.  Για παράδειγμα η παραπάνω
      εντολή <command>sshd restart</command> θα δουλέψει μόνο αν η
      μεταβλητή <varname>sshd_enable</varname> έχει τεθεί σε
      <option>YES</option> μέσα στο <filename>/etc/rc.conf</filename>.  Για να
      εκτελέσετε τις επιλογές <option>start</option>, <option>stop</option>
      ή <option>restart</option> μιας υπηρεσίας ανεξάρτητα απο τις ρυθμίσεις
      της στο <filename>/etc/rc.conf</filename>, η εντολή πρέπει να έχει
      χαρακτηριστεί με <quote>one</quote>.  Για παράδειγμα για την
      επανεκκίνηση του <command>sshd</command> ανεξάρτητα απο τις τρέχουσες
      ρυθμίσεις στο <filename>/etc/rc.conf</filename>, εκτελείτε την ακόλουθη
      εντολή:</para>

    <screen>&prompt.root; <userinput>/etc/rc.d/sshd onerestart</userinput></screen>

    <para>Είναι εύκολο να ελέγξετε αν η υπηρεσία είναι ενεργοποιημένη
      στο <filename>/etc/rc.conf</filename> τρέχοντας το κατάλληλο
      σενάριο <filename>rc.d</filename> με την
      παράμετρο <option>rcvar</option>.  Κατά συνέπεια, ένας διαχειριστής
      μπορεί να ελέγξει αν το <command>sshd</command> είναι όντως
      ενεργοποιημένο στο <filename>/etc/rc.conf</filename> εκτελώντας:</para>

    <screen>&prompt.root; <userinput>/etc/rc.d/sshd rcvar</userinput>
# sshd
$sshd_enable=YES</screen>

    <note>
      <para>Η δεύτερη γραμμή (<literal># sshd</literal>) είναι η έξοδος της
        εντολής <command>sshd</command>, και όχι η κονσολά του
        χρήστη <username>root</username>.</para>
    </note>

    <para>Για να ελέγξετε αν μια υπηρεσία τρέχει, η
      επιλογή <option>status</option> είναι διαθέσιμη.  Για παράδειγμα για να
      επιβεβαιώστε ότι η υπηρεσία <command>sshd</command> τρέχει:</para>

    <screen>&prompt.root; <userinput>/etc/rc.d/sshd status</userinput> sshd is
      running as pid 433.</screen>

    <para>Σε πολλές περιπτώσεις είναι δυνατόν το <option>reload</option> μίας
      υπηρεσίας.  Αυτό θα στείλει ένα σήμα στην υπηρεσία, επιβάλλοντας της να
      ξαναφορτώσει τα αρχεία ρυθμίσεων της.  Στην πραγματικότητα αυτό σημαίνει
      ότι θα στείλει ένα σήμα <literal>SIGHUP</literal> στην υπηρεσία.  Η
      υποστήριξη για αυτό το χαρακτηριστικό δεν παρέχεται σε κάθε
      υπηρεσία.</para>

    <para>Το σύστημα <filename>rc.d</filename> δεν χρησιμοποιείτε μόνο για τις
      υπηρεσίες δικτύου, αλλά επίσης συμβάλει και κατα την εκκίνηση του
      συστήματος.  Για παράδειγμα, σκεφτείτε το
      αρχείο <filename>bgfsck</filename>.  Όταν ένα σενάριο εκτελείτε, θα
      εκτυπώνει το ακόλουθο μήνυμα:</para>

    <screen>Starting background file system checks in 60 seconds.</screen>

    <para>Επομένος το αρχείο αυτό χρησιμοποιείτε στο παρασκήνιο για τον έλεγχο
      του συστήματος αρχείων, ο οποίος και συμβαίνει κατα στην εκκίνηση του
      συστήματος.</para>

    <para>Πολλές υπηρεσίες εξαρτώνται από άλλες υπηρεσίες για να τα καταφέρουν
      να λειτουργήσουν σωστά.  Για παράδειγμα, η υπηρεσία NIS και άλλες
      βασισμένες στο RPC υπηρεσίες θα αποτύχουν να εκκινηθούν αν η
      υπηρεσία <command>rpcbind</command> (portmapper) δεν έχει ήδη εκκινηθεί.
      Για να λύθει το πρόβλημα αυτό, υπάρχουν πληροφορίες για τις εξαρτήσεις
      και άλλα μετα-δεδομένα μέσα στα σχόλια στην αρχή κάθε σεναρίου.  Το
      πρόγραμμα &man.rcorder.8; χρησιμοποιείτε για την ανάλυση των σχολίων
      αυτών κατά την εκκίνηση του συστήματος για να καθορίστει με ποιά σειρά
      θα πρέπει να εκκινηθούν οι υπηρεσίες ώστε να εκπληρωθούν οι εξαρτήσεις.
      Οι επόμενες προτάσεις μπορούν να περιληφθούν μέσα σε κάθε αρχείο
      εκκίνησης:</para>

    <itemizedlist>
      <listitem>
	<para><literal>PROVIDE</literal>: Καθόριζει την υπηρεσία που παρέχει
	  το αρχείο αυτό.</para>
      </listitem>

      <listitem>
	<para><literal>REQUIRE</literal>: Απαριθμεί τις υπηρεσίες που
	  απαιτούνται για την την υπηρεσία αυτή.  Το αρχείο αυτό θα
	  εκτελεστεί <emphasis>μετά</emphasis> απο την καθορισμένη
	  υπηρεσία.</para>
      </listitem>

      <listitem>
	<para><literal>BEFORE</literal>: Απαριθμεί τις υπηρεσίες οι οποίες
	  εξαρτώνται απο την υπηρεσία αυτή.  Το αρχείο αυτό θα
	  εκτελεστεί <emphasis>πρίν</emphasis> τις καθορισμένες
	  υπηρεσίες.</para>
      </listitem>
    </itemizedlist>

    <para>Χρησιμοποιώντας την μέθοδο αυτή, οι διαχειριστές μπορούν εύκολα να
      ελέγξουν τις υπηρεσίες του συστήματος χωρίς τα
      δυσνόητα <quote>runlevels</quote> όπως σε μερικά άλλα λειτουργικά
      συστήματα &unix;.</para>

    <para>Επιπλέον πληροφορίες για το σύστημα <filename>rc.d</filename>
      μπορούν να βρεθούν στις σελίδες βοηθείας &man.rc.8; και &man.rc.subr.8;.
      Αν ενδιαφέρεστε για την εγγραφή δικών σας
      σεναρίων <filename>rc.d</filename> ή για την βελτίωση των ήδη
      υπάρχοντων, θα βρείτε <ulink url="&url.articles.rc-scripting">τον
      σύνδεσμο αυτόν</ulink> αρκετά χρήσιμο.</para>
  </sect1>

  <sect1 id="config-network-setup">
    <sect1info>
      <authorgroup>
        <author>
	 <firstname>Marc</firstname>
	 <surname>Fonvieille</surname>
	 <contrib>Contributed by </contrib>
	 <!-- 6 October 2002 -->
        </author>
      </authorgroup>
    </sect1info>

    <title>Ρυθμίζοντας Τις Κάρτες Δικτύου</title>

    <indexterm>
      <primary>network cards</primary>
      <secondary>configuration</secondary>
    </indexterm>

    <para>Την σήμερον εποχή δεν μπορούμε να σκεφτούμε έναν υπολογιστή χωρίς να
      σκεφτούμε και μία σύνδεση δικτύου.  Προσθέτοντας και ρυθμίζοντας μια
      κάρτα δικτύου είναι μία συνηθισμένη εργασία για έναν οποιοδήποτε
      διαχειριστή του &os;.</para>

    <sect2>
      <title>Εντοπίζοντας Τον Σωστό Οδηγό</title>

      <indexterm>
	<primary>network cards</primary>
	<secondary>driver</secondary>
      </indexterm>

      <para>Πριν αρχίσετε, θα πρέπει να γνωρίζετε το μοντέλο της κάρτας που
	έχετε, ποιό chip χρησιμοποιεί, και αν είναι PCI ή ISA κάρτα.  Το &os;
	υποστηρίζει ένα μεγάλο εύρος καρτών PCI και ISA.  Ελέγξτε την Λίστα
	Συμβατότητας Υλικού για την έκδοση σας για να δείτε αν η κάρτα σας
	υποστηρίζεται.</para>

      <para>Εφόσον είστε πλέον σίγουρος ότι η κάρτα σας υποστηρίζεται, θα
	χρειαστεί να καθορίσετε τον κατάλληλο οδηγό για την κάρτα σας.  Το
	αρχείο <filename>/usr/src/sys/conf/NOTES</filename> και το
	αρχείο <filename>/usr/src/sys/<replaceable>arch</replaceable>/conf/NOTES</filename>
	θα σας δώσουν μια λίστα με κάρτες δικτύου και μερικές πληροφορίες για
	τα υποστηριζόμενα chipsets και τις υποστηριζόμενες κάρτες.  Αν έχετε
	αμφιβολίες για το ποιός οδηγός είναι ο σωστός, διαβάστε την σελίδα
	βοηθείας του οδηγού.  Η σελίδα βοηθείας θα σας δώσει περισσότερες
	πληροφορίες σχετικά με το υποστηριζόμενο υλικό και ακόμα και για τα
	πιθανά προβλήματα που μπορεί να προκύψουν.</para>

      <para>Αν έχετε μια συνηθισμένη κάρτα, κατα πάσα πιθανότητα δεν θα
	χρειαστεί να ψάξετε πολύ για τον οδηγό.  Οι οδηγοί για τις
	συνηθισμένες κάρτες δικτύου υπάρχουν στον
	πυρήνα <filename>GENERIC</filename>, έτσι ώστε και θα εμφανιστεί κατα
	την διάρκεια της εκκίνησης, για παράδειγμα:</para>

<screen>dc0: &lt;82c169 PNIC 10/100BaseTX&gt; port 0xa000-0xa0ff mem 0xd3800000-0xd38
000ff irq 15 at device 11.0 on pci0
dc0: Ethernet address: 00:a0:cc:da:da:da
miibus0: &lt;MII bus&gt; on dc0
ukphy0: &lt;Generic IEEE 802.3u media interface&gt; on miibus0
ukphy0:  10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto
dc1: &lt;82c169 PNIC 10/100BaseTX&gt; port 0x9800-0x98ff mem 0xd3000000-0xd30
000ff irq 11 at device 12.0 on pci0
dc1: Ethernet address: 00:a0:cc:da:da:db
miibus1: &lt;MII bus&gt; on dc1
ukphy1: &lt;Generic IEEE 802.3u media interface&gt; on miibus1
ukphy1:  10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto</screen>

      <para>Στο παράδειγμα αυτό, βλέπουμε ότι δύο κάρτες που χρησιμοποιούν τον
	οδηγό &man.dc.4; έχουν εντοπιστεί στο σύστημα.</para>

      <para>Αν ο οδηγός της NIC σας δεν είναι παρόν
	στον <filename>GENERIC</filename>, θα πρέπει να φορτώσετε τον
	κατάλληλο οδηγό για να χρησιμοποιήσετε την NIC σας.  Αυτό μπορεί να
	επιτευχθεί με έναν απο τους δύο αυτούς τρόπους:</para>

      <itemizedlist>
        <listitem>
	  <para>Ο ποιό εύκολο τρόπος είναι απλά να φορτώσετε ένα άρθρωμα του
	    πυρήνα για την κάρτα δικτύου σας με το &man.kldload.8;, ή αυτόματα
	    κατα την εκκίνηση προσθέτοντας την κατάλληλη γραμμή στο
	    αρχείο <filename>/boot/loader.conf</filename>.  Δεν είναι όλοι οι
	    οδηγοί NIC διαθέσιμοι σαν αρθρώματα, χαρακτηριστικά παραδείγματα
	    είναι τα αρθρώματα για συσκευές ISA.</para>
	</listitem>

	<listitem>
	  <para>Εναλλακτικά, μπορείτε να μεταγλώττισετε στατικά την υποστήριξη
	    για την κάρτα σας στον πυρήνα.  Ελέγξετε το
	    αρχείο <filename>/usr/src/sys/conf/NOTES</filename>,
	    το <filename>/usr/src/sys/<replaceable>arch</replaceable>/conf/NOTES</filename>
	    και την σελίδα βοηθείας του οδηγού για να μάθετε τι πρέπει να
	    προσθέσετε στο αρχείο ρυθμίσεων του πυρήνα.  Για περισσότερες
	    πληροφορίες για το πως να μεταγλωττίσετε τον πυρήνα, παρακαλώ
	    διαβάστε το <xref linkend="kernelconfig">.  Αν η κάρτα σας
	    εντοπιστεί κατα την εκκίνηση απο τον πυρήνα
	    (<filename>GENERIC</filename>) δεν χρειάζετε να μεταγλώττισετε
	    έναν νέο πυρήνα.</para>
	</listitem>
      </itemizedlist>

      <sect3 id="config-network-ndis">
	<title>Χρησιμοποιώντας Οδηγούς &windows; Με Το NDIS</title>

	<indexterm><primary>NDIS</primary></indexterm>
	<indexterm><primary>NDISulator</primary></indexterm>
	<indexterm><primary>&windows; drivers</primary></indexterm>
	<indexterm><primary>Microsoft Windows</primary></indexterm>
	<indexterm><primary>Microsoft Windows</primary>
	    <secondary>device drivers</secondary></indexterm>
	<indexterm><primary>KLD (kernel loadable
	  object)</primary></indexterm>
<!-- We should probably omit the expanded name, and add a <see> entry
for it.  Whatever is done must also be done to the same indexterm in
linuxemu/chapter.sgml -->

	<para>Δυστυχώς, υπάρχουν ακόμα πολλοί κατασκευαστές που δεν παρέχουν
	  τεχνικές προδιαγραφές για τους οδηγούς τους στην κοινότητα του
	  ανοικτού λογισμικού γιατί αντιμετωπίζουν τέτοιες πληροφορίες σαν
	  μυστικά του εμπορίου.  Συνεπώς, οι υπεύθυνοι για την ανάπτυξη του
	  &os; και άλλων λειτουργικών συστημάτων μένουν με δύο επιλογές: να
	  αναπτύξουν οδηγούς με την μακρά και επίπονη διαδικασία της
	  αντίστροφης μηχανικής ή να χρησιμοποιήσουν ήδη υπάρχοντες οδηγούς σε
	  δυαδική μορφή διαθέσιμους για την πλατφόρμα &microsoft.windows;.  Οι
	  περισσότεροι υπεύθυνοι για την ανάπτυξη, μεταξύ τους και αυτοί που
	  εμπλέκονται με το &os;, έχουν επιλέξει την δεύτερη
	  προσέγγιση.</para>

	<para>Χάρη την προσφορά του Bill Paul (wpaul), μιάς και απο το
	  &os;&nbsp;5.3-RELEASE υπάρχει <quote>γηγενής</quote> υποστήριξη για
	  το Network Driver Interface Specification (NDIS).  Το έργο &os;
	  NDISulator (διαφορετικά γνωστό σας Project Evil) παίρνει έναν οδηγό
	  &windows; σε δυαδική μορφή και στην ουσία τον εξαπατά ώστε να
	  νομίζει ότι τρέχει σε &windows;.  Λόγο του ότι ο οδηγός &man.ndis.4;
	  χρησιμοποιεί μία &windows; δυαδική μορφή, μπορεί να χρησιμοποιηθεί
	  μόνο σε &i386; και amd64 συστήματα.</para>

	<note>
	  <para>Ο οδηγός &man.ndis.4; είναι σχεδιασμένος ώστε να υποστηρίζει
	    κυρίως συσκευές PCI, CardBus και PCMCIA, οι συσκευές USB δεν
	    υποστηρίζονται ακόμα.</para>
	</note>

	<para>Για να χρησιμοποιήσετε τον NDISulator, θα χρειαστείτε τρία
	  πράγματα:</para>

	<orderedlist>
	 <listitem>
	  <para>Τον πηγαίο κώδικα του πυρήνα</para>
	 </listitem>
	 <listitem>
	  <para>Την &windowsxp; δυαδική μορφή του οδηγού
	    (<filename>.SYS</filename> επέκταση)</para>
	 </listitem>
	 <listitem>
	  <para>Το &windowsxp; αρχείο ρυθμίσεων του οδηγού
	    (<filename>.INF</filename> επέκταση)</para>
	 </listitem>
	</orderedlist>

	<para>Εντοπίστε τα αρχεία αυτά για την κάρτα σας.  Γενικά, αυτά
	  μπορούν να βρεθούν στα παρεχόμενα CDs ή στους ιστότοπους των
	  κατασκευαστών.  Στα ακόλουθα παραδείγματα, θα χρησιμοποιήσουμε τα
	  αρχεία <filename>W32DRIVER.SYS</filename>
	  και <filename>W32DRIVER.INF</filename>.</para>

	<note>
	  <para>Δεν μπορείτε να χρησιμοποιήσετε οδηγούς &windows;/i386 σε
	    συστήματα &os;/amd64, θα πρέπει να βρείτε οδηγούς &windows;/amd64
	    για να δουλέψουν σωστά.</para>
	</note>

	<para>Το επόμενο βήμα είναι να μεταγλωττίσετε τον δυαδικό οδηγό μέσα
	  σε ένα φορτώσιμο άρθρωμα του πυρήνα.  Για να το επιτύχετε αυτό, θα
	  πρέπει σαν <username>root</username>, να χρησιμοποιήσετε το
	  &man.ndisgen.8;:</para>

	<screen>&prompt.root; <userinput>ndisgen <replaceable>/path/to/W32DRIVER.INF</replaceable> <replaceable>/path/to/W32DRIVER.SYS</replaceable></userinput></screen>

	<para>Το βοηθητικό πρόγραμμα &man.ndisgen.8; είναι διαδραστικό και θα
	  σας ενημερώσει για οποιαδήποτε επιπλέον πληροφορία μπορεί να
	  χρειαστεί; θα παράγει ένα άρθρωμα του πυρήνα στον τρέχωντα κατάλογο
	  και μπορεί να φορτωθεί ως εξής:</para>

	<screen>&prompt.root; <userinput>kldload <replaceable>./W32DRIVER.ko</replaceable></userinput></screen>

	<para>Επιπλέον του παραχθέντος αρθρώματος, θα πρέπει να φορτώσετε τα
	  αρθρώματα <filename>ndis.ko</filename>
	  και <filename>if_ndis.ko</filename>.  Αυτό θα πρέπει να γίνει
	  αυτόματα όταν φορτώνετε οποιαδήποτε εξαρτάται απο το &man.ndis.4;.
	  Αν θέλετε να το κάνετε χειρωνακτικά, θα πρέπει να χρησιμοποιήσετε
	  τις ακόλουθες εντολές:</para>

	<screen>&prompt.root; <userinput>kldload ndis</userinput>
&prompt.root; <userinput>kldload if_ndis</userinput></screen>

	<para>Η πρώτη εντολή φορτώνει τον οδηγό NDIS miniport wrapper, ενώ η
	  δεύτερη φορτώνει την πραγματική κάρτα δικτύου.</para>

	<para>Τώρα, ελέγξτε το &man.dmesg.8; για να δείτε αν υπάρχουν σφάλματα
	  κατα την φόρτωση.  Αν όλα πήγαν καλά, θα πρέπει να δείτε μια
	  παρόμοια έξοδο με την επόμενη:</para>

	<screen>ndis0: &lt;Wireless-G PCI Adapter&gt; mem 0xf4100000-0xf4101fff irq 3 at device 8.0 on pci1
ndis0: NDIS API version: 5.0
ndis0: Ethernet address: 0a:b1:2c:d3:4e:f5
ndis0: 11b rates: 1Mbps 2Mbps 5.5Mbps 11Mbps
ndis0: 11g rates: 6Mbps 9Mbps 12Mbps 18Mbps 36Mbps 48Mbps 54Mbps</screen>

	<para>Απο εδώ και πέρα μπορείτε να χειριστείτε την
	  συσκευή <devicename>ndis0</devicename> σαν μια οποιαδήποτε κάρτα
	  δικτύου (π.χ., <devicename>dc0</devicename>).</para>

	<para>Μπορείτε να ρυθμίσετε το σύστημα να φορτώνει τα NDIS αρθρώματα
	  κατα την εκκίνηση με τον ίδιο τρόπο με τα όπως με οποιαδήποτε άλλα
	  αρθρώματα.  Πρώτα, αντιγράψτε το παραχθείσα
	  άρθρωμα, <filename>W32DRIVER.ko</filename>, στον
	  κατάλογο <filename class="directory">/boot/modules</filename>.
	  Τότε, προσθέστε την ακόλουθη γραμμή στο
	  <filename>/boot/loader.conf</filename>:</para>

	<programlisting>W32DRIVER_load="YES"</programlisting>
      </sect3>
    </sect2>

    <sect2>
      <title>Ρυθμίζοντας Την Κάρτα Δικτύου</title>

      <indexterm>
	<primary>network cards</primary>
	<secondary>configuration</secondary>
      </indexterm>

      <para>Μόλις ο κατάλληλος οδηγός φορτωθεί για την κάρτα δικτύου,
	χρειάζεται να ρυθμιστεί.  Όπως πολλά άλλα πράγματα, η κάρτα δικτύου
	είχε ρυθμιστεί κατα την στιγμή της εγκατάστασης με
	το <application>sysinstall</application>.</para>

      <para>Για να εμφανίσετε τις κάρτες δικτύου που έχετε στο σύστημα σας,
	πληκτρολογήστε την ακόλουθη εντολή:</para>

<screen>&prompt.user; <userinput>ifconfig</userinput>
dc0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        inet 192.168.1.3 netmask 0xffffff00 broadcast 192.168.1.255
        ether 00:a0:cc:da:da:da
        media: Ethernet autoselect (100baseTX &lt;full-duplex&gt;)
        status: active
dc1: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        inet 10.0.0.1 netmask 0xffffff00 broadcast 10.0.0.255
        ether 00:a0:cc:da:da:db
        media: Ethernet 10baseT/UTP
        status: no carrier
lp0: flags=8810&lt;POINTOPOINT,SIMPLEX,MULTICAST&gt; mtu 1500
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 16384
        inet 127.0.0.1 netmask 0xff000000
tun0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500</screen>

      <note>
	<para>Παλαιότερες εκδόσεις του &os; μπορεί να χρειάζονται την
	  παράμετρο <option>-a</option> ακολουθούμενη στην &man.ifconfig.8;,
	  για περισσότερες λεπτομέρειες σχετικά με την σωστή σύνταξη του
	  &man.ifconfig.8;, παρακαλώ ανατρέξτε στην σελίδα βοηθείας.
	  Σημειώστε επίσης ότι οι εγγραφές που αφορούν το IPv6
	  (<literal>inet6</literal> κτλπ.) έχουν παραμεληθεί σε αυτό το
	  παράδειγμα.</para>
      </note>

      <para>Σε αυτό το παράδειγμα, οι ακόλουθες συσκευές έχουν
	εμφανιστεί:</para>

      <itemizedlist>
	<listitem>
	  <para><devicename>dc0</devicename>: Η πρώτη Ethernet κάρτα
	    δικτύου</para>
	</listitem>

	<listitem>
	  <para><devicename>dc1</devicename>: Η δεύτερη Ethernet κάρτα
	    δικτύου</para>
	</listitem>

	<listitem>
	  <para><devicename>lp0</devicename>: Η παράλληλη πόρτα
	    </para>
	</listitem>

	<listitem>
	  <para><devicename>lo0</devicename>: Η συσκευή loopback</para>
	</listitem>

	<listitem>
	  <para><devicename>tun0</devicename>: Η συσκευή tunnel χρησιμοποιούμενη
	    απο το πρόγραμμα <application>ppp</application></para>
	</listitem>
      </itemizedlist>

      <para>Το &os; χρησιμοποιεί τα ονόματα των οδηγών με την σειρά κατα την
	οποία εντοπίστηκαν οι αντίστοιχες κάρτες κατα την εκκίνηση.  Για
	παράδειγμα η συσκευή <devicename>sis2</devicename> θα είναι η τρίτη
	κάρτα δικτύου που χρησιμοποιεί τον οδηγό &man.sis.4;.</para>

      <para>Στο παράδειγμα αυτό, η συσκευή <devicename>dc0</devicename> είναι
	πάνω και τρέχει.  Οι λέξεις κλειδία είναι:</para>

      <orderedlist>
	<listitem>
	  <para><literal>UP</literal> σημαίνει ότι η κάρτα είναι ρυθμισμένη
	    και έτοιμη.</para>
	</listitem>

	<listitem>
	  <para>Η κάρτα έχει μία Internet διεύθυνση (<literal>inet</literal>)
	    ρυθμισμένη (σε αυτή την
	    περίπτωση <hostid role="ipaddr">192.168.1.3</hostid>).</para>
	</listitem>

	<listitem>
	  <para>Έχει μία έγκυρη μάσκα υποδικτύου
	    (<literal>netmask</literal>; <hostid role="netmask">0xffffff00</hostid>
	    είναι το ίδιο με
	    το <hostid role="netmask">255.255.255.0</hostid>).</para>
	</listitem>

	<listitem>
	  <para>Έχει μία έγκυρη broadcast διεύθυνση (σε αυτή την
	    περίπτωση, <hostid role="ipaddr">192.168.1.255</hostid>).</para>
	</listitem>

	<listitem>
	  <para>Η διεύθυνση MAC της κάρτας (<literal>ether</literal>)
	    είναι <hostid role="mac">00:a0:cc:da:da:da</hostid></para>
	</listitem>

	<listitem>
	  <para>Η επιλογή του φυσικού μέσου είναι σε κατάσταση autoselection
	    (<literal>media: Ethernet autoselect (100baseTX
	    &lt;full-duplex&gt;)</literal>).  Παρατηρούμε ότι
	    η <devicename>dc1</devicename> έχει ρυθμιστεί να τρέχει
	    σαν <literal>10baseT/UTP</literal> μέσο.  Για περισσότερες
	    πληροφορίες για τους τύπους των μέσων ενός οδηγού, παρακαλώ
	    ανατρέξτε στην σελίδα βοηθείας.</para>
	</listitem>

	<listitem>
	  <para>Η κατάσταση της σύνδεσης (<literal>status</literal>)
	    είναι <literal>active</literal>, δηλ. έχει εντοπιστεί σήμα
	    μεταφοράς.  Στην <devicename>dc1</devicename>,
	    παρατηρούμε <literal>status: no carrier</literal>.  Αυτό είναι
	    λογικό αφού το καλώδιο Ethernet δεν έχει συνδεθεί με την
	    κάρτα.</para>
	</listitem>
      </orderedlist>

      <para>Αν το &man.ifconfig.8; εμφανίζει κάτι παρόμοιο με
	αυτό:</para>

<screen>dc0: flags=8843&lt;BROADCAST,SIMPLEX,MULTICAST&gt; mtu 1500
	        ether 00:a0:cc:da:da:da</screen>

      <para>σημαίνει ότι η κάρτα δεν έχει ρυθμιστεί.</para>

      <para>Για να ρυθμίσετε την κάρτα σας, θα χρειαστείτε
	προνόμια <username>root</username>.  Η ρύθμιση της κάρτας δικτύου
	μπορεί να γίνει απο την γραμμή εντολών με το &man.ifconfig.8; αλλά θα
	πρέπει να το επαναλάβετε σε κάθε επανεκκίνηση του συστήματος.  Το
	αρχείο <filename>/etc/rc.conf</filename> είναι εκεί όπου πρέπει να
	προσθέσετε τις ρύθμισεις της κάρτας δικτύου.</para>

      <para>Ανοίξτε το αρχείο <filename>/etc/rc.conf</filename> με τον
	αγαπημένο σας κειμενογράφο.  Θα χρειαστεί να προσθέσετε μία γραμμή για
	κάθε κάρτα δικτύου που υπάρχει στο σύστημα σας, για παράδειγμα στην
	περίπτωση μας, θα πρέπει να προσθέσετε τι εξής γραμμές:</para>

<programlisting>ifconfig_dc0="inet 192.168.1.3 netmask 255.255.255.0"
ifconfig_dc1="inet 10.0.0.1 netmask 255.255.255.0 media 10baseT/UTP"</programlisting>

      <para>Θα πρέπει να αντικαταστήσετε
	το <devicename>dc0</devicename>, <devicename>dc1</devicename>, και
	ούτω κάθε εξής, με τις σωστές συσκευές των καρτών σας, και τις σωστές
	διευθύνσεις.  Θα πρέπει να διαβάσετε την σελίδα βοηθείας του οδηγού
	και του &man.ifconfig.8; για περισσότερες λεπτομέριες σχετικά με τις
	επιτρεπόμενες παραμέτρους και επίσης την σελίδα βοηθείας του
	&man.rc.conf.5; για περισσότερες λεπτομέριες σχετικά με την σύνταξη
	του <filename>/etc/rc.conf</filename>.</para>

      <para>Αν ρυθμίσατε το δίκτυο σας κατα την εγκατάσταση, μερικές γραμμές
	σχετικές με την/τις κάρτα/κάρτες δικτύου θα υπάρχουν ήδη.  Ελέγξτε
	διπλά το <filename>/etc/rc.conf</filename> προτού προσθέστε επιπλέον
	γραμμές.</para>

      <para>Θα πρέπει επίσης να διορθώσετε το
	αρχείο <filename>/etc/hosts</filename> ώστε να προσθέσετε τα ονόματα
	και τις IP διεύθυνσεις απο τα διάφορα μηχανήματα στο LAN σας, αν δεν
	είναι ήδη ρυθμισμένα.  Για περισσότερες πληροφορίες ανατρέξτε στην
	σελίδα βοηθείας του &man.hosts.5; και
	του <filename>/usr/share/examples/etc/hosts</filename>.</para>
    </sect2>

    <sect2>
      <title>Δοκιμές Και Επίλυση Προβλημάτων</title>

      <para>Μόλις κάνετε τις βασικές αλλαγές
	στο <filename>/etc/rc.conf</filename>, θα πρέπει να επανεκκινήσετε το
	σύστημα σας.  Αυτό θα επιτρέψει σε πιθανές αλλαγές στις κάρτες να
	εφαρμοστούν, και να επιβεβαιώσετε ότι το σύστημα επανεκκινεί χωρίς
	κανένα λάθος στις ρυθμίσεις.</para>

      <para>Μόλις το σύστημα επανεκκινηθεί, θα πρέπει να δοκιμάσετε τις κάρτες
	δικτύου.</para>

      <sect3>
	<title>Δοκιμάζοντας Μια Ethernet Κάρτα</title>

	<indexterm>
	  <primary>network cards</primary>
	  <secondary>testing</secondary>
	</indexterm>

	<para>Για να επιβεβαιώσετε ότι η Ethernet κάρτα λειτουργεί σωστά, θα
	  πρέπει να κάνετε δύο πράγματα.  Πρώτα, κάντε ping την κάρτα την
	  ίδια, και μετά κάντε ping ένα άλλο μηχάνημα στο LAN.</para>

	<para>Πρώτα δοκιμάστε στην τοπική κάρτα:</para>

<screen>&prompt.user; <userinput>ping -c5 192.168.1.3</userinput>
PING 192.168.1.3 (192.168.1.3): 56 data bytes
64 bytes from 192.168.1.3: icmp_seq=0 ttl=64 time=0.082 ms
64 bytes from 192.168.1.3: icmp_seq=1 ttl=64 time=0.074 ms
64 bytes from 192.168.1.3: icmp_seq=2 ttl=64 time=0.076 ms
64 bytes from 192.168.1.3: icmp_seq=3 ttl=64 time=0.108 ms
64 bytes from 192.168.1.3: icmp_seq=4 ttl=64 time=0.076 ms

--- 192.168.1.3 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 0.074/0.083/0.108/0.013 ms</screen>

	<para>Τώρα δοκιμάστε σε ένα άλλο μηχάνημα στο LAN:</para>

<screen>&prompt.user; <userinput>ping -c5 192.168.1.2</userinput>
PING 192.168.1.2 (192.168.1.2): 56 data bytes
64 bytes from 192.168.1.2: icmp_seq=0 ttl=64 time=0.726 ms
64 bytes from 192.168.1.2: icmp_seq=1 ttl=64 time=0.766 ms
64 bytes from 192.168.1.2: icmp_seq=2 ttl=64 time=0.700 ms
64 bytes from 192.168.1.2: icmp_seq=3 ttl=64 time=0.747 ms
64 bytes from 192.168.1.2: icmp_seq=4 ttl=64 time=0.704 ms

--- 192.168.1.2 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 0.700/0.729/0.766/0.025 ms</screen>

	<para>Μπορείτε να χρησιμοποιήσετε και το όνομα το μηχανήματος αντί της
	  διεύθυνσης <hostid role="ipaddr">192.168.1.2</hostid> αν έχετε
	  ρυθμίσει το αρχείο <filename>/etc/hosts</filename>.</para>
      </sect3>

      <sect3>
	<title>Επίλυση Προβλημάτων</title>

      <indexterm>
	<primary>network cards</primary>
	<secondary>troubleshooting</secondary>
      </indexterm>

      <para>Η επίλυση προβλημάτων υλικού και λογισμικού είναι πάντοτε επίπονη,
	ένας πόνος ο οποιός μπορεί να ανακουφιστεί ελέγχοντας μερικά απλά
	πράγματα πρώτα.  Είναι το καλώδιο του δικτύου συνδεδεμένο; Έχετε
	ρυθμίσει σωστά τις υπηρεσίες δικτύου; Έχετε ρυθμίσει σωστά το πύρινο
	τείχος; Έχει πράγματι το &os; υποστήριξη για αυτή την κάρτα δικτύου;
	Πρέπει πάντα να ελέγχετε τις σημειώσεις του υλικού πριν στείλε μία
	αναφορά για ένα πρόβλημα.  Αναβαθμίστε την έκδοση του &os; στην
	τελευταία ΣΤΑΘΕΡΗ έκδοση.  Ελέγξτε τα αρχεία των λιστών μηνυμάτων, ή
	ψάξτε στο Internet.</para>

      <para>Αν η κάρτα δουλεύει, αλλά με χαμηλή απόδοση, θα άξιζε να διαβάσετε
	την σελίδα βοηθείας &man.tuning.7;.  Μπορείτε επίσης να ελέγξετε οι αν
	λανθασμένες ρυθμίσεις του δικτύου προκαλούν τις αργές
	συνδέσεις.</para>

      <para>Μερικοί χρήστες αντιμετωπίζουν ένα ή δύο
	μηνύματα <errorname>device timeout</errorname>, τα οποία είναι
	φυσιολογικά για μερικές κάρτες.  Αν συνεχιστούν, ή γίνουν ενοχλητικά,
	θα πρέπει να ελέγξετε μήπως και κάποιες συσκευές παρεμποδίζουν η μία
	την άλλη.  Ελέγξτε διπλά τις συνδέσεις των καλωδίων.  Ίσως θα πρέπει
	να αποκτήσετε μία άλλη κάρτα.</para>

      <para>Μερικές φορές, οι χρήστες παρατηρούν μερικά μηνύματα
	λάθους <errorname>watchdog timeout</errorname>.  Το πρώτο πράγμα που
	πρέπει να κάνετε είναι να ελέγξετε το καλώδιο του δικτύου. Αρκέτες
	κάρτες χρειάζονται μία θέση PCI που να υποστηρίζει Bus Mastering. Σε
	μερικές παλιές μητρικές κάρτες. μόνο μία θέση PCI το υποστήριζε
	(συνήθως η θέση 0). Ελέγξτε την κάρτα δικτύου και την τεκμηρίωση της
	μητρικής κάρτας για να διαπιστώσετε αν εκεί είναι το πρόβλημα.</para>

      <para>Το μήνυμα <errorname>No route to host</errorname> εμφανίζεται αν
	το σύστημα αδυνατεί να δρομολογήσει τα πακέτα στον προορισμό τους.
	Αυτό συμβαίνει αν δεν έχει καθοριστεί προεπιλεγμένη διεύθυνση
	δρομολόγησης, ή αν ένα καλώδιο έχει ξεσυνδεθεί.  Ελέγξτε την έξοδο τις
	εντολής <command>netstat -rn</command> και σιγουρευτείτε ότι η
	διεύθυνση δρομολόγησης είναι έγκυρη.  Αν δεν έχει καθοριστεί, διαβάστε
	το <xref linkend="advanced-networking"> για περισσότερες
	πληροφορίες.</para>

      <para>Το μήνυμα λάθους <errorname>ping: sendto: Permission
	  denied</errorname> συμβαίνει κυρίως λόγο κάποιας λάθος ρύθμισης στο
	πύρινο τείχος.  Αν το <command>ipfw</command> είναι ενεργοποιημένο
	στον πυρήνα αλλά δεν έχουν καθοριστεί κανόνες, τότε η προεπιλεγμένη
	πολιτική είναι η απαγόρευση όλης της κίνησης, ακόμα και των αιτημάτων
	ping!  Διαβάστε το <xref linkend="firewalls"> για περισσότερες
	  πληροφορίες.</para>

      <para>Μερικές φορές η απόδοση της κάρτας μπορεί να είναι φτωχή, ή κάτω
	του μέσου όρου.  Σε αυτές τις περιπτώσεις το καλύτερο είναι να
	ρυθμίσετε την κατάσταση του μέσου απο <literal>autoselect</literal>
	στην κατάλληλη κατάσταση.  Ενώ συνήθως αυτό φαίνετε να δουλεύει στα
	περισσότερα υλικά, μπορεί να μην λύσει το πρόβλημα στον καθέναν.  Και
	πάλι, ελέγξτε όλες τις ρυθμίσεις του δικτύου, και ξαναδιαβάστε πάλι
	την σελίδα βοηθείας &man.tuning.7;.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 id="configtuning-virtual-hosts">
    <title>Εικονικά Hosts</title>

    <indexterm><primary>virtual hosts</primary></indexterm>
    <indexterm><primary>IP aliases</primary></indexterm>

    <para>Μία αρκετά συνηθισμένη χρήση του &os; είναι η εικονική φιλοξενία
      ιστοχώρων, όπου και ένας εξυπηρετητής εμφανίζεται στο δίκτυο σαν
      περισσότερο απο ένας.  Αυτό επιτυγχάνεται αναθέτοντας πολλαπλές
      δικτυακές διευθύνσεις σε μία και μόνο συσκευή.</para>

    <para>Μία κάρτα δικτύου έχει μία <quote>πραγματική</quote> διεύθυνση, και
      απεριόριστο αριθμό <quote>εικονικών</quote> διευθύνσεων.  Οι εικονικές
      αυτές διεύθυνσεις προσθέτονται με την μορφή εγγραφών στο
      αρχείο <filename>/etc/rc.conf</filename>.</para>

    <para>Μία εγγραφή εικονικής διεύθυνσης για την κάρτα
      δικτύου <devicename>fxp0</devicename> μοιάζει ως εξής:</para>

<programlisting>ifconfig_fxp0_alias0="inet xxx.xxx.xxx.xxx netmask xxx.xxx.xxx.xxx"</programlisting>

    <para>Σημειώστε ότι οι εγγραφές αυτές πρέπει να ξεκινούν
      με <literal>alias0</literal> και να συνεχίζουν πρός τα πάνω σε σειρά,
      (για παράδειγμα, <literal>_alias1</literal>, <literal>_alias2</literal>,
      και ούτω κάθε εξής).  Η διαδικασία ρύθμισης θα σταματήσει στον πρώτο
      αριθμό που λείπει.</para>

    <para>Ο υπολογισμός της μάσκας δικτύου είναι σημαντικός, αλλά ευτυχώς και
      εύκολος.  Για κάθε κάρτα, πρέπει να υπάρχει μία διεύθυνση η οποία
      αντιπροσωπεύει σωστά την μάσκα του δικτύου.  Οποιαδήποτε άλλη διεύθυνση
      που συμπίπτει στο ίδιο δίκτυο πρέπει να έχει μάσκα
      δικτύου <literal>1</literal>s (εκφρασμένη είτε
      σαν <hostid role="netmask">255.255.255.255</hostid> είτε
      σαν <hostid role="netmask">0xffffffff</hostid>).</para>

    <para>Για παράδειγμα, εξετάστε την περίπτωση όπου η κάρτα
      δικτύου <devicename>fxp0</devicename> είναι συνδεδεμένη σε δύο δίκτυα,
      το δίκτυο <hostid role="ipaddr">10.1.1.0</hostid> με μάσκα
      δικτύου <hostid role="netmask">255.255.255.0</hostid> και το
      δίκτυο <hostid role="ipaddr">202.0.75.16</hostid> με μάσκα
      δικτύου <hostid role="netmask">255.255.255.240</hostid>.  Θέλουμε το
      σύστημα να πάρει τις διευθύνσεις
      από <hostid role="ipaddr">10.1.1.1</hostid>
      μέχρι <hostid role="ipaddr">10.1.1.5</hostid> και
      τις <hostid role="ipaddr">202.0.75.17</hostid>
      μέχρι <hostid role="ipaddr">202.0.75.20</hostid>.  Όπως σημειώθηκε
      παραπάνω, μόνο η πρώτες διευθύνσεις (στην περίπτωση αυτή,
      η <hostid role="ipaddr">10.0.1.1</hostid> και
      η <hostid role="ipaddr">202.0.75.17</hostid>) πρέπει να έχουν
      πραγματικές μάσκες δικτύου. Όλες οι υπόλοιπες, από
      (<hostid role="ipaddr">10.1.1.2</hostid>
      μέχρι <hostid role="ipaddr">10.1.1.5</hostid>
      και <hostid role="ipaddr">202.0.75.18</hostid>
      μέχρι <hostid role="ipaddr">202.0.75.20</hostid>) πρέπει να ρυθμιστούν
      με μάσκα δικτύου <hostid role="netmask">255.255.255.255</hostid>.</para>

    <para>Η ακόλουθες εγγραφές στο αρχείο <filename>/etc/rc.conf</filename> θα
      ρυθμίσουν την κάρτα όπως πρέπει για το παράδειγμα:</para>

    <programlisting>ifconfig_fxp0="inet 10.1.1.1 netmask 255.255.255.0"
ifconfig_fxp0_alias0="inet 10.1.1.2 netmask 255.255.255.255"
ifconfig_fxp0_alias1="inet 10.1.1.3 netmask 255.255.255.255"
ifconfig_fxp0_alias2="inet 10.1.1.4 netmask 255.255.255.255"
ifconfig_fxp0_alias3="inet 10.1.1.5 netmask 255.255.255.255"
ifconfig_fxp0_alias4="inet 202.0.75.17 netmask 255.255.255.240"
ifconfig_fxp0_alias5="inet 202.0.75.18 netmask 255.255.255.255"
ifconfig_fxp0_alias6="inet 202.0.75.19 netmask 255.255.255.255"
ifconfig_fxp0_alias7="inet 202.0.75.20 netmask 255.255.255.255"</programlisting>

  </sect1>

  <sect1 id="configtuning-configfiles">
    <title>Αρχεία Ρυθμίσεων</title>

    <sect2>
      <title>Ο κατάλογος <filename class="directory">/etc</filename></title>

      <para>Τα αρχεία ρυθμίσεων αποθηκεύονται σε καταλόγους.  Μερικοί απο
	αυτούς είναι:</para>

      <informaltable frame="none" pgwide="1">
	<tgroup cols="2">
	  <colspec colwidth="1*">
	  <colspec colwidth="2*">

	  <tbody>
	    <row>
	      <entry><filename class="directory">/etc</filename></entry>
	      <entry>Γενικές ρυθμίσεις του συστήματος, data here is
		system-specific.</entry>
	    </row>
	    <row>
	      <entry><filename class="directory">/etc/defaults</filename></entry>
	      <entry>Default versions of system configuration files.</entry>
	    </row>
	    <row>
	      <entry><filename class="directory">/etc/mail</filename></entry>
	      <entry>Extra &man.sendmail.8; configuration, other
		MTA configuration files.
	      </entry>
	    </row>
	    <row>
	      <entry><filename class="directory">/etc/ppp</filename></entry>
	      <entry>Configuration for both user- and kernel-ppp programs.
	      </entry>
	    </row>
	    <row>
	      <entry><filename class="directory">/etc/namedb</filename></entry>
	      <entry>Default location for &man.named.8; data.  Normally
		<filename>named.conf</filename> and zone files are stored
                here.</entry>
	    </row>
	    <row>
	      <entry><filename class="directory">/usr/local/etc</filename></entry>
	      <entry>Configuration files for installed applications.
		May contain per-application subdirectories.</entry>
	    </row>
	    <row>
	      <entry><filename class="directory">/usr/local/etc/rc.d</filename></entry>
	      <entry>Start/stop scripts for installed applications.</entry>
	    </row>
	    <row>
	      <entry><filename class="directory">/var/db</filename></entry>
	      <entry>Automatically generated system-specific database files,
                 such as the package database, the locate database, and so
                 on</entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>
    </sect2>

    <sect2>
      <title>Hostnames</title>

      <indexterm><primary>hostname</primary></indexterm>
      <indexterm><primary>DNS</primary></indexterm>

      <sect3>
	<title><filename>/etc/resolv.conf</filename></title>

	<indexterm>
	  <primary><filename>resolv.conf</filename></primary>
	</indexterm>

	<para><filename>/etc/resolv.conf</filename> dictates how &os;'s
	  resolver accesses the Internet Domain Name System (DNS).</para>

	<para>The most common entries to <filename>resolv.conf</filename> are:
	</para>

	<informaltable frame="none" pgwide="1">
	  <tgroup cols="2">
	  <colspec colwidth="1*">
	  <colspec colwidth="2*">

	    <tbody>
	      <row>
		<entry><literal>nameserver</literal></entry>
		<entry>The IP address of a name server the resolver
		  should query.  The servers are queried in the order
		  listed with a maximum of three.</entry>
	      </row>
	      <row>
		<entry><literal>search</literal></entry>
		<entry>Search list for hostname lookup.  This is normally
		  determined by the domain of the local hostname.</entry>
	      </row>
	      <row>
		<entry><literal>domain</literal></entry>
		<entry>The local domain name.</entry>
	      </row>
	    </tbody>
	  </tgroup>
	</informaltable>

	<para>A typical <filename>resolv.conf</filename>:</para>

	<programlisting>search example.com
nameserver 147.11.1.11
nameserver 147.11.100.30</programlisting>

	<note><para>Only one of the <literal>search</literal> and
	  <literal>domain</literal> options should be used.</para></note>

	<para>If you are using DHCP, &man.dhclient.8; usually rewrites
	  <filename>resolv.conf</filename> with information received from the
	  DHCP server.</para>
      </sect3>

      <sect3>
	<title><filename>/etc/hosts</filename></title>

	<indexterm><primary>hosts</primary></indexterm>

	<para><filename>/etc/hosts</filename> is a simple text
	  database reminiscent of the old Internet.  It works in
	  conjunction with DNS and NIS providing name to IP address
	  mappings.  Local computers connected via a LAN can be placed
	  in here for simplistic naming purposes instead of setting up
	  a &man.named.8; server.  Additionally,
	  <filename>/etc/hosts</filename> can be used to provide a
	  local record of Internet names, reducing the need to query
	  externally for commonly accessed names.</para>

	<programlisting># &dollar;&os;&dollar;
#
# Host Database
# This file should contain the addresses and aliases
# for local hosts that share this file.
# In the presence of the domain name service or NIS, this file may
# not be consulted at all; see /etc/nsswitch.conf for the resolution order.
#
#
::1                     localhost localhost.my.domain myname.my.domain
127.0.0.1               localhost localhost.my.domain myname.my.domain

#
# Imaginary network.
#10.0.0.2               myname.my.domain myname
#10.0.0.3               myfriend.my.domain myfriend
#
# According to RFC 1918, you can use the following IP networks for
# private nets which will never be connected to the Internet:
#
#       10.0.0.0        -   10.255.255.255
#       172.16.0.0      -   172.31.255.255
#       192.168.0.0     -   192.168.255.255
#
# In case you want to be able to connect to the Internet, you need
# real official assigned numbers.  PLEASE PLEASE PLEASE do not try
# to invent your own network numbers but instead get one from your
# network provider (if any) or from the Internet Registry (ftp to
# rs.internic.net, directory `/templates').
#</programlisting>

	<para><filename>/etc/hosts</filename> takes on the simple format
	  of:</para>

	<programlisting>[Internet address] [official hostname] [alias1] [alias2] ...</programlisting>

	<para>For example:</para>

	<programlisting>10.0.0.1 myRealHostname.example.com myRealHostname foobar1 foobar2</programlisting>

	<para>Consult &man.hosts.5; for more information.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Log File Configuration</title>

      <indexterm><primary>log files</primary></indexterm>

      <sect3>
	<title><filename>syslog.conf</filename></title>

	<indexterm><primary>syslog.conf</primary></indexterm>

	<para><filename>syslog.conf</filename> is the configuration file
	  for the &man.syslogd.8; program.  It indicates which types
	  of <command>syslog</command> messages are logged to particular
	  log files.</para>

	<programlisting># &dollar;&os;&dollar;
#
#       Spaces ARE valid field separators in this file. However,
#       other *nix-like systems still insist on using tabs as field
#       separators. If you are sharing this file between systems, you
#       may want to use only tabs as field separators here.
#       Consult the syslog.conf(5) manual page.
*.err;kern.debug;auth.notice;mail.crit          /dev/console
*.notice;kern.debug;lpr.info;mail.crit;news.err /var/log/messages
security.*                                      /var/log/security
mail.info                                       /var/log/maillog
lpr.info                                        /var/log/lpd-errs
cron.*                                          /var/log/cron
*.err                                           root
*.notice;news.err                               root
*.alert                                         root
*.emerg                                         *
# uncomment this to log all writes to /dev/console to /var/log/console.log
#console.info                                   /var/log/console.log
# uncomment this to enable logging of all log messages to /var/log/all.log
#*.*                                            /var/log/all.log
# uncomment this to enable logging to a remote log host named loghost
#*.*                                            @loghost
# uncomment these if you're running inn
# news.crit                                     /var/log/news/news.crit
# news.err                                      /var/log/news/news.err
# news.notice                                   /var/log/news/news.notice
!startslip
*.*                                             /var/log/slip.log
!ppp
*.*                                             /var/log/ppp.log</programlisting>

	<para>Consult the &man.syslog.conf.5; manual page for more
	  information.</para>
      </sect3>

      <sect3>
	<title><filename>newsyslog.conf</filename></title>

	<indexterm><primary>newsyslog.conf</primary></indexterm>

	<para><filename>newsyslog.conf</filename> is the configuration
	  file for &man.newsyslog.8;, a program that is normally scheduled
	  to run by &man.cron.8;.  &man.newsyslog.8; determines when log
	  files require archiving or rearranging.
	  <filename>logfile</filename> is moved to
	  <filename>logfile.0</filename>, <filename>logfile.0</filename>
	  is moved to <filename>logfile.1</filename>, and so on.
	  Alternatively, the log files may be archived in &man.gzip.1; format
	  causing them to be named: <filename>logfile.0.gz</filename>,
	  <filename>logfile.1.gz</filename>, and so on.</para>

	<para><filename>newsyslog.conf</filename> indicates which log
	  files are to be managed, how many are to be kept, and when
	  they are to be touched.  Log files can be rearranged and/or
	  archived when they have either reached a certain size, or at a
	  certain periodic time/date.</para>

	<programlisting># configuration file for newsyslog
# &dollar;&os;&dollar;
#
# filename          [owner:group]    mode count size when [ZB] [/pid_file] [sig_num]
/var/log/cron                           600  3     100  *     Z
/var/log/amd.log                        644  7     100  *     Z
/var/log/kerberos.log                   644  7     100  *     Z
/var/log/lpd-errs                       644  7     100  *     Z
/var/log/maillog                        644  7     *    @T00  Z
/var/log/sendmail.st                    644  10    *    168   B
/var/log/messages                       644  5     100  *     Z
/var/log/all.log                        600  7     *    @T00  Z
/var/log/slip.log                       600  3     100  *     Z
/var/log/ppp.log                        600  3     100  *     Z
/var/log/security                       600  10    100  *     Z
/var/log/wtmp                           644  3     *    @01T05 B
/var/log/daily.log                      640  7     *    @T00  Z
/var/log/weekly.log                     640  5     1    $W6D0 Z
/var/log/monthly.log                    640  12    *    $M1D0 Z
/var/log/console.log                    640  5     100  *     Z</programlisting>

	<para>Consult the &man.newsyslog.8; manual page for more
	  information.</para>
      </sect3>
    </sect2>

    <sect2 id="configtuning-sysctlconf">
      <title><filename>sysctl.conf</filename></title>

      <indexterm><primary>sysctl.conf</primary></indexterm>
      <indexterm><primary>sysctl</primary></indexterm>

      <para><filename>sysctl.conf</filename> looks much like
	<filename>rc.conf</filename>.  Values are set in a
	<literal>variable=value</literal>
	form.  The specified values are set after the system goes into
	multi-user mode.  Not all variables are settable in this mode.</para>

      <para>To turn off logging of fatal signal exits and prevent users from
	seeing processes started from other users, the following tunables can
	be set in <filename>sysctl.conf</filename>:</para>

      <programlisting># Do not log fatal signal exits (e.g. sig 11)
kern.logsigexit=0

# Prevent users from seeing information about processes that
# are being run under another UID.
security.bsd.see_other_uids=0</programlisting>
    </sect2>
  </sect1>

  <sect1 id="configtuning-sysctl">
    <title>Tuning with sysctl</title>

    <indexterm><primary>sysctl</primary></indexterm>
    <indexterm>
      <primary>tuning</primary>
      <secondary>with sysctl</secondary>
    </indexterm>

    <para>&man.sysctl.8; is an interface that allows you to make changes
      to a running &os; system.  This includes many advanced
      options of the TCP/IP stack and virtual memory system that can
      dramatically improve performance for an experienced system
      administrator.  Over five hundred system variables can be read
      and set using &man.sysctl.8;.</para>

    <para>At its core, &man.sysctl.8; serves two functions: to read and
      to modify system settings.</para>

    <para>To view all readable variables:</para>

    <screen>&prompt.user; <userinput>sysctl -a</userinput></screen>

    <para>To read a particular variable, for example,
      <varname>kern.maxproc</varname>:</para>

    <screen>&prompt.user; <userinput>sysctl kern.maxproc</userinput>
kern.maxproc: 1044</screen>

    <para>To set a particular variable, use the intuitive
      <replaceable>variable</replaceable>=<replaceable>value</replaceable>
      syntax:</para>

    <screen>&prompt.root; <userinput>sysctl kern.maxfiles=5000</userinput>
kern.maxfiles: 2088 -&gt; 5000</screen>

    <para>Settings of sysctl variables are usually either strings,
      numbers, or booleans (a  boolean being <literal>1</literal> for yes
      or a <literal>0</literal> for no).</para>

    <para>If you want to set automatically some variables each time
      the machine boots, add them to the
      <filename>/etc/sysctl.conf</filename> file.  For more information
      see the &man.sysctl.conf.5; manual page and the
      <xref linkend="configtuning-sysctlconf">.</para>

  <sect2 id="sysctl-readonly">
    <sect2info>
      <authorgroup>
        <author>
	 <firstname>Tom</firstname>
	 <surname>Rhodes</surname>
	 <contrib>Contributed by </contrib>
	 <!-- 31 January 2003 -->
        </author>
      </authorgroup>
    </sect2info>
    <title>&man.sysctl.8; Read-only</title>

    <para>In some cases it may be desirable to modify read-only &man.sysctl.8;
      values.  While this is sometimes unavoidable, it can only be done
      on (re)boot.</para>

    <para>For instance on some laptop models the &man.cardbus.4; device will
      not probe memory ranges, and fail with errors which look similar to:</para>

    <screen>cbb0: Could not map register memory
device_probe_and_attach: cbb0 attach returned 12</screen>

    <para>Cases like the one above usually require the modification of some
      default &man.sysctl.8; settings which are set read only.  To overcome
      these situations a user can put &man.sysctl.8; <quote>OIDs</quote>
      in their local <filename>/boot/loader.conf</filename>.  Default
      settings are located in the <filename>/boot/defaults/loader.conf</filename>
      file.</para>

    <para>Fixing the problem mentioned above would require a user to set
      <option>hw.pci.allow_unsupported_io_range=1</option> in the aforementioned
      file.  Now &man.cardbus.4; will work properly.</para>

    </sect2>
  </sect1>

  <sect1 id="configtuning-disk">
    <title>Tuning Disks</title>

    <sect2>
      <title>Sysctl Variables</title>

      <sect3>
	<title><varname>vfs.vmiodirenable</varname></title>

	<indexterm>
	  <primary><varname>vfs.vmiodirenable</varname></primary>
	</indexterm>

	<para>The <varname>vfs.vmiodirenable</varname> sysctl variable
	  may be set to either 0 (off) or 1 (on); it is 1 by default.
	  This variable controls how directories are cached by the
	  system.  Most directories are small, using just a single
	  fragment (typically 1&nbsp;K) in the file system and less
	  (typically 512&nbsp;bytes) in the buffer cache.
	  With this variable turned off (to 0), the buffer
	  cache will only cache a fixed number of directories even if
	  you have a huge amount of memory.  When turned on (to 1), this sysctl
	  allows the buffer cache to use the VM Page Cache to cache the
	  directories, making all the memory available for caching
	  directories.  However,
	  the minimum in-core memory used to cache a directory is the
	  physical page size (typically 4&nbsp;K) rather than 512&nbsp;
	  bytes.  We recommend keeping this option on if you are running
	  any services which manipulate large numbers of files.  Such
	  services can include web caches, large mail systems, and news
	  systems.  Keeping this option on will generally not reduce
	  performance even with the wasted memory but you should
	  experiment to find out.</para>
      </sect3>

     <sect3>
 	<title><varname>vfs.write_behind</varname></title>

 	<indexterm>
 	  <primary><varname>vfs.write_behind</varname></primary>
 	</indexterm>

 	<para>The <varname>vfs.write_behind</varname> sysctl variable
 	  defaults to <literal>1</literal> (on).  This tells the file system
 	  to issue media writes as full clusters are collected, which
 	  typically occurs when writing large sequential files.  The idea
 	  is to avoid saturating the buffer cache with dirty buffers when
 	  it would not benefit I/O performance.  However, this may stall
 	  processes and under certain circumstances you may wish to turn it
 	  off.</para>
       </sect3>

       <sect3>
 	<title><varname>vfs.hirunningspace</varname></title>

 	<indexterm>
 	  <primary><varname>vfs.hirunningspace</varname></primary>
 	</indexterm>

 	<para>The <varname>vfs.hirunningspace</varname> sysctl variable
 	  determines how much outstanding write I/O may be queued to disk
 	  controllers system-wide at any given instance.  The default is
 	  usually sufficient but on machines with lots of disks you may
 	  want to bump it up to four or five <emphasis>megabytes</emphasis>.
 	  Note that setting too high a value (exceeding the buffer cache's
 	  write threshold) can lead to extremely bad clustering
 	  performance.  Do not set this value arbitrarily high!  Higher
 	  write values may add latency to reads occurring at the same time.
 	</para>

 	<para>There are various other buffer-cache and VM page cache
 	  related sysctls.  We do not recommend modifying these values,
	  the VM system does an extremely good job of
 	  automatically tuning itself.</para>
       </sect3>

       <sect3>
 	<title><varname>vm.swap_idle_enabled</varname></title>

 	<indexterm>
 	  <primary><varname>vm.swap_idle_enabled</varname></primary>
 	</indexterm>

 	<para>The <varname>vm.swap_idle_enabled</varname> sysctl variable
 	  is useful in large multi-user systems where you have lots of
 	  users entering and leaving the system and lots of idle processes.
 	  Such systems tend to generate a great deal of continuous pressure
 	  on free memory reserves.  Turning this feature on and tweaking
 	  the swapout hysteresis (in idle seconds) via
 	  <varname>vm.swap_idle_threshold1</varname> and
 	  <varname>vm.swap_idle_threshold2</varname> allows you to depress
 	  the priority of memory pages associated with idle processes more
 	  quickly then the normal pageout algorithm.  This gives a helping
 	  hand to the pageout daemon.  Do not turn this option on unless
 	  you need it, because the tradeoff you are making is essentially
 	  pre-page memory sooner rather than later; thus eating more swap
 	  and disk bandwidth.  In a small system this option will have a
 	  determinable effect but in a large system that is already doing
 	  moderate paging this option allows the VM system to stage whole
 	  processes into and out of memory easily.</para>
       </sect3>

      <sect3>
	<title><varname>hw.ata.wc</varname></title>

	<indexterm>
	  <primary><varname>hw.ata.wc</varname></primary>
	</indexterm>

	<para>&os;&nbsp;4.3 flirted with turning off IDE write caching.
	  This reduced write bandwidth to IDE disks but was considered
	  necessary due to serious data consistency issues introduced
	  by hard drive vendors.  The problem is that IDE
	  drives lie about when a write completes.  With IDE write
	  caching turned on, IDE hard drives not only write data
	  to disk out of order, but will sometimes delay writing some
	  blocks indefinitely when under heavy disk loads.  A crash or
	  power failure may cause serious file system corruption.
	  &os;'s default was changed to be safe.  Unfortunately, the
	  result was such a huge performance loss that we changed
	  write caching back to on by default after the release.  You
	  should check the default on your system by observing the
	  <varname>hw.ata.wc</varname> sysctl variable.  If IDE write
	  caching is turned off, you can turn it back on by setting
	  the kernel variable back to 1.  This must be done from the
	  boot loader at boot time.  Attempting to do it after the
	  kernel boots will have no effect.</para>

	<para>For more information, please see &man.ata.4;.</para>
      </sect3>

      <sect3>
	<title><literal>SCSI_DELAY</literal>
	(<varname>kern.cam.scsi_delay</varname>)</title>

	<indexterm>
	  <primary><varname>kern.cam.scsi_delay</varname></primary>
	</indexterm>

	<indexterm>
	  <primary>kernel options</primary>
	  <secondary><literal>SCSI_DELAY</literal></secondary>
	</indexterm>

	<para>The <literal>SCSI_DELAY</literal> kernel config may be used to
	  reduce system boot times.  The defaults are fairly high and can be
	  responsible for <literal>15</literal> seconds of delay in the
	  boot process.  Reducing it to <literal>5</literal> seconds usually
	  works (especially with modern drives).  Newer versions of &os;
	  (5.0 and higher) should use the <varname>kern.cam.scsi_delay</varname>
	  boot time tunable.  The tunable, and kernel config option accept
	  values in terms of <emphasis>milliseconds</emphasis> and
	  <emphasis>not</emphasis> <emphasis>seconds</emphasis>.</para>
      </sect3>
    </sect2>

    <sect2 id="soft-updates">
      <title>Soft Updates</title>

      <indexterm><primary>Soft Updates</primary></indexterm>
      <indexterm><primary>tunefs</primary></indexterm>

      <para>The &man.tunefs.8; program can be used to fine-tune a
	file system.  This program has many different options, but for
	now we are only concerned with toggling Soft Updates on and
	off, which is done by:</para>

      <screen>&prompt.root; <userinput>tunefs -n enable /filesystem</userinput>
&prompt.root; <userinput>tunefs -n disable /filesystem</userinput></screen>

      <para>A filesystem cannot be modified with &man.tunefs.8; while
	it is mounted.  A good time to enable Soft Updates is before any
	partitions have been mounted, in single-user mode.</para>

      <para>Soft Updates drastically improves meta-data performance, mainly
        file creation and deletion, through the use of a memory cache.  We
        recommend to use Soft Updates on all of your file systems.  There
        are two downsides to Soft Updates that you should be aware of:  First,
        Soft Updates guarantees filesystem consistency in the case of a crash
        but could very easily be several seconds (even a minute!) behind
        updating the physical disk.  If your system crashes you may lose more
        work than otherwise.  Secondly, Soft Updates delays the freeing of
        filesystem blocks.  If you have a filesystem (such as the root
	filesystem) which is almost full, performing a major update, such as
        <command>make installworld</command>, can cause the filesystem to run
	out of space and the update to fail.</para>

      <sect3>
	<title>More Details about Soft Updates</title>

	<indexterm>
	  <primary>Soft Updates</primary>
	  <secondary>details</secondary>
	</indexterm>

	<para>There are two traditional approaches to writing a file
	  systems meta-data back to disk.  (Meta-data updates are
	  updates to non-content data like inodes or
	  directories.)</para>

	<para>Historically, the default behavior was to write out
	  meta-data updates synchronously.  If a directory had been
	  changed, the system waited until the change was actually
	  written to disk.  The file data buffers (file contents) were
	  passed through the buffer cache and backed up
	  to disk later on asynchronously.  The advantage of this
	  implementation is that it operates safely.  If there is
	  a failure during an update, the meta-data are always in a
	  consistent state.  A file is either created completely
	  or not at all.  If the data blocks of a file did not find
	  their way out of the buffer cache onto the disk by the time
	  of the crash, &man.fsck.8; is able to recognize this and
	  repair the filesystem by setting the file length to
	  0.  Additionally, the implementation is clear and simple.
	  The disadvantage is that meta-data changes are slow.  An
	  <command>rm -r</command>, for instance, touches all the files
	  in a directory sequentially, but each directory
	  change (deletion of a file) will be written synchronously
	  to the disk.  This includes updates to the directory itself,
	  to the inode table, and possibly to indirect blocks
	  allocated by the file.  Similar considerations apply for
	  unrolling large hierarchies (<command>tar -x</command>).</para>

	<para>The second case is asynchronous meta-data updates.  This
  	  is the default for Linux/ext2fs and
  	  <command>mount -o async</command> for *BSD ufs.  All
  	  meta-data updates are simply being passed through the buffer
  	  cache too, that is, they will be intermixed with the updates
  	  of the file content data.  The advantage of this
  	  implementation is there is no need to wait until each
  	  meta-data update has been written to disk, so all operations
  	  which cause huge amounts of meta-data updates work much
  	  faster than in the synchronous case.  Also, the
  	  implementation is still clear and simple, so there is a low
  	  risk for bugs creeping into the code.  The disadvantage is
  	  that there is no guarantee at all for a consistent state of
  	  the filesystem.  If there is a failure during an operation
  	  that updated large amounts of meta-data (like a power
  	  failure, or someone pressing the reset button),
	  the filesystem
  	  will be left in an unpredictable state.  There is no opportunity
  	  to examine the state of the filesystem when the system
  	  comes up again; the data blocks of a file could already have
  	  been written to the disk while the updates of the inode
  	  table or the associated directory were not.  It is actually
  	  impossible to implement a <command>fsck</command> which is
  	  able to clean up the resulting chaos (because the necessary
  	  information is not available on the disk).  If the
	  filesystem has been damaged beyond repair, the only choice
	  is to use &man.newfs.8; on it and restore it from backup.
	  </para>

	<para>The usual solution for this problem was to implement
	  <emphasis>dirty region logging</emphasis>, which is also
	  referred to as <emphasis>journaling</emphasis>, although that
	  term is not used consistently and is occasionally applied
	  to other forms of transaction logging as well.  Meta-data
	  updates are still written synchronously, but only into a
	  small region of the disk.  Later on they will be moved
	  to their proper location.  Because the logging
	  area is a small, contiguous region on the disk, there
	  are no long distances for the disk heads to move, even
	  during heavy operations, so these operations are quicker
	  than synchronous updates.
	  Additionally the complexity of the implementation is fairly
	  limited, so the risk of bugs being present is low.  A disadvantage
	  is that all meta-data are written twice (once into the
	  logging region and once to the proper location) so for
	  normal work, a performance <quote>pessimization</quote>
	  might result.  On the other hand, in case of a crash, all
	  pending meta-data operations can be quickly either rolled-back
	  or completed from the logging area after the system comes
	  up again, resulting in a fast filesystem startup.</para>

	<para>Kirk McKusick, the developer of Berkeley FFS,
	   solved this problem with Soft Updates: all pending
	   meta-data updates are kept in memory and written out to disk
	   in a sorted sequence (<quote>ordered meta-data
	   updates</quote>).  This has the effect that, in case of
	   heavy meta-data operations, later updates to an item
	   <quote>catch</quote> the earlier ones if the earlier ones are still in
	   memory and have not already been written to disk.  So all
	   operations on, say, a directory are generally performed in
	   memory before the update is written to disk (the data
	   blocks are sorted according to their position so
	   that they will not be on the disk ahead of their meta-data).
	   If the system crashes, this causes an implicit <quote>log
	   rewind</quote>: all operations which did not find their way
	   to the disk appear as if they had never happened.  A
	   consistent filesystem state is maintained that appears to
	   be the one of 30 to 60 seconds earlier.  The
	   algorithm used guarantees that all resources in use
	   are marked as such in their appropriate bitmaps: blocks and inodes.
	   After a crash, the only resource allocation error
	   that occurs is that resources are
	   marked as <quote>used</quote> which are actually <quote>free</quote>.
	   &man.fsck.8; recognizes this situation,
	   and frees the resources that are no longer used.  It is safe to
	   ignore the dirty state of the filesystem after a crash by
	   forcibly mounting it with <command>mount -f</command>.  In
	   order to free resources that may be unused, &man.fsck.8;
	   needs to be run at a later time.  This is the idea behind
	   the <emphasis>background fsck</emphasis>: at system startup
	   time, only a <emphasis>snapshot</emphasis> of the
	   filesystem is recorded.  The <command>fsck</command> can be
	   run later on.  All file systems can then be mounted
	   <quote>dirty</quote>, so the system startup proceeds in
	   multiuser mode.  Then, background <command>fsck</command>s
	   will be scheduled for all file systems where this is required, to free
	   resources that may be unused.  (File systems that do not use
	   Soft Updates still need the usual foreground
	   <command>fsck</command> though.)</para>

	 <para>The advantage is that meta-data operations are nearly as
	   fast as asynchronous updates (i.e. faster than with
	   <emphasis>logging</emphasis>, which has to write the
	   meta-data twice).  The disadvantages are the complexity of
	   the code (implying a higher risk for bugs in an area that
	   is highly sensitive regarding loss of user data), and a
	   higher memory consumption.  Additionally there are some
	   idiosyncrasies one has to get used to.
	   After a crash, the state of the filesystem appears to be
	   somewhat <quote>older</quote>.  In situations where
	   the standard synchronous approach would have caused some
	   zero-length files to remain after the
	   <command>fsck</command>, these files do not exist at all
	   with a Soft Updates filesystem because neither the meta-data
	   nor the file contents have ever been written to disk.
	   Disk space is not released until the updates have been
	   written to disk, which may take place some time after
	   running <command>rm</command>.  This may cause problems
	   when installing large amounts of data on a filesystem
	   that does not have enough free space to hold all the files
	   twice.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 id="configtuning-kernel-limits">
    <title>Tuning Kernel Limits</title>

    <indexterm>
      <primary>tuning</primary>
      <secondary>kernel limits</secondary>
    </indexterm>

    <sect2 id="file-process-limits">
      <title>File/Process Limits</title>

      <sect3 id="kern-maxfiles">
	<title><varname>kern.maxfiles</varname></title>

	<indexterm>
	  <primary><varname>kern.maxfiles</varname></primary>
	</indexterm>

	<para><varname>kern.maxfiles</varname> can be raised or
	  lowered based upon your system requirements.  This variable
	  indicates the maximum number of file descriptors on your
	  system.  When the file descriptor table is full,
	  <errorname>file: table is full</errorname> will show up repeatedly
	  in the system message buffer, which can be viewed with the
	  <command>dmesg</command> command.</para>

	<para>Each open file, socket, or fifo uses one file
	  descriptor.  A large-scale production server may easily
	  require many thousands of file descriptors, depending on the
	  kind and number of services running concurrently.</para>

        <para>In older FreeBSD releases, the default value of <varname>kern.maxfiles</varname>
          is derived from the <option>maxusers</option> option in your
          kernel configuration file.  <varname>kern.maxfiles</varname> grows
          proportionally to the value of <option>maxusers</option>.  When
          compiling a custom kernel, it is a good idea to set this kernel
          configuration option according to the uses of your system.  From
          this number, the kernel is given most of its pre-defined limits.
          Even though a production machine may not actually have 256 users
          connected at once, the resources needed may be similar to a
          high-scale web server.</para>

        <para>As of FreeBSD 4.5, <varname>kern.maxusers</varname> is
          automatically sized at boot based on the amount of memory available
          in the system, and may be determined at run-time by inspecting the
          value of the read-only <varname>kern.maxusers</varname> sysctl.
          Some sites will require larger or smaller values of
          <varname>kern.maxusers</varname> and may set it as a loader tunable;
          values of 64, 128, and 256 are not uncommon.  We do not recommend
          going above 256 unless you need a huge number of file descriptors;
          many of the tunable values set to their defaults by
          <varname>kern.maxusers</varname> may be individually overridden at
          boot-time or run-time in <filename>/boot/loader.conf</filename> (see
          the &man.loader.conf.5; man page or the
          <filename>/boot/defaults/loader.conf</filename> file for some hints)
          or as described elsewhere in this document.  Systems older than
          FreeBSD&nbsp;4.4 must set this value via the kernel &man.config.8;
          option <option>maxusers</option> instead.</para>

	<para>In older releases, the system will auto-tune
	  <literal>maxusers</literal> for you if you explicitly set it to
	  <literal>0</literal><footnote>
	    <para>The auto-tuning algorithm sets
	      <literal>maxusers</literal> equal to the amount of memory in the
	      system, with a minimum of 32, and a maximum of 384.</para>
	  </footnote>.  When setting this option, you will want to set
	  <literal>maxusers</literal> to at least 4, especially if you are
	  using the X Window System or compiling software.  The reason is that
	  the most important table set by <literal>maxusers</literal> is the
	  maximum number of processes,  which is set to <literal>20 + 16 *
	  maxusers</literal>, so if you set <literal>maxusers</literal> to 1,
	  then you can only have 36 simultaneous processes, including the 18
	  or so that the system starts up at boot time and the 15 or so you
	  will probably create when you start the X Window System.  Even a
	  simple task like reading a manual page will start up nine
	  processes to filter, decompress, and view it.  Setting
	  <literal>maxusers</literal> to 64 will allow you to have up to 1044
	  simultaneous processes, which should be enough for nearly all uses.
	  If, however, you see the dreaded <errortype>proc table
	  full</errortype> error when trying to start another program, or are
	  running a server with a large number of simultaneous users (like
	  <hostid role="fqdn">ftp.FreeBSD.org</hostid>), you can always
	  increase the number and rebuild.</para>

	<note>
	  <para><literal>maxusers</literal> does <emphasis>not</emphasis>
	    limit the number of users which can log into your machine.  It
	    simply sets various table sizes to reasonable values considering
	    the maximum number of users you will likely have on your system
	    and how many processes each of them will be running.  One keyword
	    which <emphasis>does</emphasis> limit the number of simultaneous
	    remote logins and X terminal windows is <link
	    linkend="kernelconfig-ptys"><literal>pseudo-device pty
	    16</literal></link>.  With &os;&nbsp;5.X, you do not have to
	    worry about this number since the &man.pty.4; driver is
	    <quote>auto-cloning</quote>; you simply use the line
	    <literal>device pty</literal> in your configuration file.</para>
	</note>

      </sect3>

      <sect3>
	<title><varname>kern.ipc.somaxconn</varname></title>

	<indexterm>
	  <primary><varname>kern.ipc.somaxconn</varname></primary>
	</indexterm>

	<para>The <varname>kern.ipc.somaxconn</varname> sysctl variable
	  limits the size of the listen queue for accepting new TCP
	  connections.  The default value of <literal>128</literal> is
	  typically too low for robust handling of new connections in a
	  heavily loaded web server environment.  For such environments, it
	  is recommended to increase this value to <literal>1024</literal> or
	  higher.  The service daemon may itself limit the listen queue size
	  (e.g. &man.sendmail.8;, or <application>Apache</application>) but
	  will often have a directive in its configuration file to adjust
	  the queue size.  Large listen queues also do a better job of
	  avoiding Denial of Service (<abbrev>DoS</abbrev>) attacks.</para>
      </sect3>

    </sect2>
    <sect2 id="nmbclusters">
      <title>Network Limits</title>

      <para>The <literal>NMBCLUSTERS</literal> kernel configuration
	option dictates the amount of network Mbufs available to the
	system.  A heavily-trafficked server with a low number of Mbufs
	will hinder &os;'s ability.  Each cluster represents
	approximately 2&nbsp;K of memory, so a value of 1024 represents 2
	megabytes of kernel memory reserved for network buffers.  A
	simple calculation can be done to figure out how many are
	needed.  If you have a web server which maxes out at 1000
	simultaneous connections, and each connection eats a 16&nbsp;K receive
	and 16&nbsp;K send buffer, you need approximately 32&nbsp;MB worth of
	network buffers to cover the web server.  A good rule of thumb is
	to multiply by 2, so 2x32&nbsp;MB&nbsp;/&nbsp;2&nbsp;KB&nbsp;=
	64&nbsp;MB&nbsp;/&nbsp;2&nbsp;kB&nbsp;= 32768.  We recommend
	values between 4096 and 32768 for machines with greater amounts
	of memory.  Under no circumstances should you specify an
	arbitrarily high value for this parameter as it could lead to a
	boot time crash.  The <option>-m</option> option to
	&man.netstat.1; may be used to observe network cluster
	use.</para>

      <para><varname>kern.ipc.nmbclusters</varname> loader tunable should
        be used to tune this at boot time.  Only older versions of &os;
        will require you to use the <literal>NMBCLUSTERS</literal> kernel
        &man.config.8; option.</para>

      <para>For busy servers that make extensive use of the
	&man.sendfile.2; system call, it may be necessary to increase
	the number of &man.sendfile.2; buffers via the
	<literal>NSFBUFS</literal> kernel configuration option or by
	setting its value in <filename>/boot/loader.conf</filename>
	(see &man.loader.8; for details).  A common indicator that
	this parameter needs to be adjusted is when processes are seen
	in the <literal>sfbufa</literal> state.  The sysctl
	variable <varname>kern.ipc.nsfbufs</varname> is a read-only
	glimpse at the kernel configured variable.  This parameter
	nominally scales with <varname>kern.maxusers</varname>,
	however it may be necessary to tune accordingly.</para>

      <important>
	<para>Even though a socket has been marked as non-blocking,
	  calling &man.sendfile.2; on the non-blocking socket may
	  result in the &man.sendfile.2; call blocking until enough
	  <literal>struct sf_buf</literal>'s are made
	  available.</para>
      </important>

      <sect3>
	<title><varname>net.inet.ip.portrange.*</varname></title>

	<indexterm>
	  <primary>net.inet.ip.portrange.*</primary>
	</indexterm>

	<para>The <varname>net.inet.ip.portrange.*</varname> sysctl
	  variables control the port number ranges automatically bound to TCP
	  and UDP sockets.  There are three ranges: a low range, a default
	  range, and a high range.  Most network programs use the default
	  range which is controlled by the
	  <varname>net.inet.ip.portrange.first</varname> and
	  <varname>net.inet.ip.portrange.last</varname>, which default to
	  1024 and 5000, respectively.  Bound port ranges are used  for
	  outgoing connections, and it is possible to run the system out of
	  ports under certain circumstances.  This most commonly occurs
	  when you are running a heavily loaded web proxy.  The port range
	  is not an issue when running servers which handle mainly incoming
	  connections, such as a normal web server, or has a limited number
	  of outgoing connections, such as a mail relay.  For situations
	  where you may run yourself out of ports, it is recommended to
	  increase <varname>net.inet.ip.portrange.last</varname> modestly.
	  A value of <literal>10000</literal>, <literal>20000</literal> or
	  <literal>30000</literal> may be reasonable.  You should also
	  consider firewall effects when changing the port range.  Some
	  firewalls may block large ranges of ports (usually low-numbered
	  ports) and expect systems to use higher ranges of ports for
	  outgoing connections &mdash; for this reason it is not recommended that
	  <varname>net.inet.ip.portrange.first</varname> be lowered.</para>
      </sect3>

      <sect3>
	<title>TCP Bandwidth Delay Product</title>

	<indexterm>
	  <primary>TCP Bandwidth Delay Product Limiting</primary>
	  <secondary><varname>net.inet.tcp.inflight.enable</varname></secondary>
	</indexterm>

	<para>The TCP Bandwidth Delay Product Limiting is similar to
	  TCP/Vegas in NetBSD.  It can be
	  enabled by setting <varname>net.inet.tcp.inflight.enable</varname>
	  sysctl variable to <literal>1</literal>.  The system will attempt
	  to calculate the bandwidth delay product for each connection and
	  limit the amount of data queued to the network to just the amount
	  required to maintain optimum throughput.</para>

	<para>This feature is useful if you are serving data over modems,
	  Gigabit Ethernet, or even high speed WAN links (or any other link
	  with a high bandwidth delay product), especially if you are also
	  using window scaling or have configured a large send window.  If
	  you enable this option, you should also be sure to set
	  <varname>net.inet.tcp.inflight.debug</varname> to
	  <literal>0</literal> (disable debugging), and for production use
	  setting <varname>net.inet.tcp.inflight.min</varname> to at least
	  <literal>6144</literal> may be beneficial.  However, note that
	  setting high minimums may effectively disable bandwidth limiting
	  depending on the link.  The limiting feature reduces the amount of
	  data built up in intermediate route and switch packet queues as
	  well as reduces the amount of data built up in the local host's
	  interface queue.  With fewer packets queued up, interactive
	  connections, especially over slow modems, will also be able to
	  operate with lower <emphasis>Round Trip Times</emphasis>.  However,
	  note that this feature only effects data transmission (uploading
	  / server side).  It has no effect on data reception (downloading).
	</para>

	<para>Adjusting <varname>net.inet.tcp.inflight.stab</varname> is
	  <emphasis>not</emphasis> recommended.  This parameter defaults to
	  20, representing 2 maximal packets added to the bandwidth delay
	  product window calculation.  The additional window is required to
	  stabilize the algorithm and improve responsiveness to changing
	  conditions, but it can also result in higher ping times over slow
	  links (though still much lower than you would get without the
	  inflight algorithm).  In such cases, you may wish to try reducing
	  this parameter to 15, 10, or 5; and may also have to reduce
	  <varname>net.inet.tcp.inflight.min</varname> (for example, to
	  3500) to get the desired effect.  Reducing these parameters
	  should be done as a last resort only.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Virtual Memory</title>

      <sect3>
        <title><varname>kern.maxvnodes</varname></title>

        <para>A vnode is the internal representation of a file or
          directory.  So increasing the number of vnodes available to
          the operating system cuts down on disk I/O.  Normally this
          is handled by the operating system and does not need to be
          changed.  In some cases where disk I/O is a bottleneck and
          the system is running out of vnodes, this setting will need
          to be increased.  The amount of inactive and free RAM will
          need to be taken into account.</para>

        <para>To see the current number of vnodes in use:</para>

        <programlisting>&prompt.root; sysctl vfs.numvnodes
vfs.numvnodes: 91349</programlisting>

        <para>To see the maximum vnodes:</para>

        <programlisting>&prompt.root; sysctl kern.maxvnodes
kern.maxvnodes: 100000</programlisting>

        <para>If the current vnode usage is near the maximum, increasing
          <varname>kern.maxvnodes</varname> by a value of 1,000 is
          probably a good idea.  Keep an eye on the number of
          <varname>vfs.numvnodes</varname>.  If it climbs up to the
          maximum again, <varname>kern.maxvnodes</varname> will need to
          be increased further.  A shift in your memory usage as
          reported by &man.top.1; should be visible.  More memory should
          be active.</para>
      </sect3>
    </sect2>
  </sect1>

  <sect1 id="adding-swap-space">
    <title>Adding Swap Space</title>

    <para>No matter how well you plan, sometimes a system does not run
      as you expect.  If you find you need more swap space, it is
      simple enough to add.  You have three ways to increase swap
      space: adding a new hard drive, enabling swap over NFS, and
      creating a swap file on an existing partition.</para>

    <para>For information on how to encrypt swap space, what options
      for this task exist and why it should be done, please refer to
      <xref linkend="swap-encrypting"> of the Handbook.</para>

    <sect2 id="new-drive-swap">
      <title>Swap on a New Hard Drive</title>

      <para>The best way to add swap, of course, is to use this as an
	excuse to add another hard drive.  You can always use another
	hard drive, after all.  If you can do this, go reread the
	discussion of swap space
	in <xref linkend="configtuning-initial">
	of the Handbook for some suggestions on how to best
	arrange your swap.</para>
    </sect2>

    <sect2 id="nfs-swap">
      <title>Swapping over NFS</title>

      <para>Swapping over NFS is only recommended if you do not have a
	local hard disk to swap to; NFS swapping will be limited
	by the available network bandwidth and puts an additional
	burden on the NFS server.</para>
    </sect2>

    <sect2 id="create-swapfile">
      <title>Swapfiles</title>

      <para>You can create a file of a specified size to use as a swap
	file.  In our example here we will use a 64MB file called
	<filename>/usr/swap0</filename>.  You can use any name you
	want, of course.</para>

      <example>
	<title>Creating a Swapfile on &os;</title>

      <orderedlist>
	<listitem>
	  <para>Be certain that your kernel configuration includes
	    the memory disk driver (&man.md.4;).  It is default in
	    <filename>GENERIC</filename> kernel.</para>

	  <programlisting>device   md   # Memory "disks"</programlisting>
	</listitem>

	<listitem>
	  <para>Create a swapfile (<filename>/usr/swap0</filename>):</para>

	  <screen>&prompt.root; <userinput>dd if=/dev/zero of=/usr/swap0 bs=1024k count=64</userinput></screen>
	</listitem>

	<listitem>
	  <para>Set proper permissions on (<filename>/usr/swap0</filename>):</para>

	  <screen>&prompt.root; <userinput>chmod 0600 /usr/swap0</userinput></screen>
	</listitem>

	<listitem>
	  <para>Enable the swap file in <filename>/etc/rc.conf</filename>:</para>

	  <programlisting>swapfile="/usr/swap0"   # Set to name of swapfile if aux swapfile desired.</programlisting>
	</listitem>

	<listitem>

	  <para>Reboot the machine or to enable the swap file immediately,
            type:</para>

	  <screen>&prompt.root; <userinput>mdconfig -a -t vnode -f /usr/swap0 -u 0 &amp;&amp; swapon /dev/md0</userinput></screen>
        </listitem>
      </orderedlist>

      </example>
    </sect2>
  </sect1>

  <sect1 id="acpi-overview">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Hiten</firstname>
	  <surname>Pandya</surname>
	  <contrib>Written by </contrib>
	</author>
	<author>
	  <firstname>Tom</firstname>
	  <surname>Rhodes</surname>
	</author>
      </authorgroup>
    </sect1info>

    <title>Power and Resource Management</title>

    <para>It is important to utilize hardware resources in an
      efficient manner.  Before <acronym>ACPI</acronym> was introduced,
      it was difficult and inflexible for operating systems to manage
      the power usage and thermal properties of a system.  The hardware was
      managed by the <acronym>BIOS</acronym> and thus the user had less
      control and visibility into the power management settings.
      Some limited configurability was available via
      <emphasis>Advanced Power Management (APM)</emphasis>.
      Power and resource management is one of the key components of a modern
      operating system.  For example, you may want an operating system to
      monitor system limits (and possibly alert you) in case your system
      temperature increased unexpectedly.</para>

    <para>In this section of the &os; Handbook, we will provide
      comprehensive information about <acronym>ACPI</acronym>.  References
      will be provided for further reading at the end.</para>

    <sect2 id="acpi-intro">
      <title>What Is ACPI?</title>

      <indexterm>
	<primary>ACPI</primary>
      </indexterm>

      <indexterm>
	<primary>APM</primary>
      </indexterm>

      <para>Advanced Configuration and Power Interface
	(<acronym>ACPI</acronym>) is a standard written by
	an alliance of vendors to provide a standard interface for
	hardware resources and power management (hence the name).
	It is a key element in <emphasis>Operating System-directed
	configuration and Power Management</emphasis>, i.e.: it provides
	more control and flexibility to the operating system
	(<acronym>OS</acronym>).
	Modern systems <quote>stretched</quote> the limits of the
	current Plug and Play interfaces prior to the introduction of
	<acronym>ACPI</acronym>.  <acronym>ACPI</acronym> is the direct
	successor to <acronym>APM</acronym>
	(Advanced Power Management).</para>
    </sect2>

    <sect2 id="acpi-old-spec">
      <title>Shortcomings of Advanced Power Management (APM)</title>

      <para>The <emphasis>Advanced Power Management (APM)</emphasis>
      facility controls the power usage of a system based on its
      activity.  The APM BIOS is supplied by the (system) vendor and
      it is specific to the hardware platform.  An APM driver in the
      OS mediates access to the <emphasis>APM Software Interface</emphasis>,
      which allows management of power levels.  APM should still be used for
      systems manufactured at or before the year 2000.</para>

      <para>There are four major problems in APM.  Firstly, power
      management is done by the (vendor-specific) BIOS, and the OS
      does not have any knowledge of it.  One example of this, is when
      the user sets idle-time values for a hard drive in the APM BIOS,
      that when exceeded, it (BIOS) would spin down the hard drive,
      without the consent of the OS.  Secondly, the APM logic is
      embedded in the BIOS, and it operates outside the scope of the
      OS.  This means users can only fix problems in their APM BIOS by
      flashing a new one into the ROM; which is a very dangerous
      procedure with the potential to leave the system in an
      unrecoverable state if it fails. Thirdly, APM is a vendor-specific
      technology, which means that there is a lot of parity
      (duplication of efforts) and bugs found in one vendor's BIOS,
      may not be solved in others.  Last but not the least, the APM
      BIOS did not have enough room to implement a sophisticated power
      policy, or one that can adapt very well to the purpose of the
      machine.</para>

      <para><emphasis>Plug and Play BIOS (PNPBIOS)</emphasis> was
      unreliable in many situations.  PNPBIOS is 16-bit technology,
      so the OS has to use 16-bit emulation in order to
      <quote>interface</quote> with PNPBIOS methods.</para>

      <para>The &os; <acronym>APM</acronym> driver is documented in
      the &man.apm.4; manual page.</para>
    </sect2>

    <sect2 id="acpi-config">
      <title>Configuring <acronym>ACPI</acronym></title>

      <para>The <filename>acpi.ko</filename> driver is loaded by default
      at start up by the &man.loader.8; and should <emphasis>not</emphasis>
      be compiled into the kernel.  The reasoning behind this is that modules
      are easier to work with, say if switching to another
      <filename>acpi.ko</filename> without doing a kernel rebuild.
      This has the advantage of making testing easier.
      Another reason is that starting <acronym>ACPI</acronym> after a
      system has been brought up often doesn't work well.
      If you are experiencing problems, you can disable <acronym>ACPI</acronym>
      altogether. This driver should not and can not be unloaded because the
      system bus uses it for various hardware interactions.
      <acronym>ACPI</acronym> can be disabled by setting
      <literal>hint.acpi.0.disabled="1"</literal> in
      <filename>/boot/loader.conf</filename> or at the &man.loader.8; prompt.
      </para>

      <note><para><acronym>ACPI</acronym> and <acronym>APM</acronym> cannot
      coexist and should be used separately.  The last one to load will
      terminate if the driver notices the other running.</para></note>

      <para><acronym>ACPI</acronym> can be used to put the
      system into a sleep mode with &man.acpiconf.8;, the <option>-s</option>
      flag, and a <literal>1-5</literal> option.  Most users will only need
      <literal>1</literal> or <literal>3</literal> (suspend to RAM).
      Option <literal>5</literal> will do a soft-off which is the same
      action as:</para>

      <screen>&prompt.root; <userinput>halt -p</userinput></screen>

      <para>Other options are available via &man.sysctl.8;.  Check out the
      &man.acpi.4; and &man.acpiconf.8; manual pages for more information.
      </para>
    </sect2>
  </sect1>

  <sect1 id="ACPI-debug">
    <sect1info>
      <authorgroup>
        <author>
          <firstname>Nate</firstname>
          <surname>Lawson</surname>
          <contrib>Written by </contrib>
        </author>
      </authorgroup>
      <authorgroup>
        <author>
          <firstname>Peter</firstname>
          <surname>Schultz</surname>
          <contrib>With contributions from </contrib>
        </author>
        <author>
          <firstname>Tom</firstname>
          <surname>Rhodes</surname>
        </author>
      </authorgroup>
    </sect1info>

    <title>Using and Debugging &os; <acronym>ACPI</acronym></title>

    <indexterm>
      <primary>ACPI</primary>
      <secondary>problems</secondary>
    </indexterm>

    <para><acronym>ACPI</acronym> is a fundamentally new way of
      discovering devices, managing power usage, and providing
      standardized access to various hardware previously managed
      by the <acronym>BIOS</acronym>.  Progress is being made toward
      <acronym>ACPI</acronym> working on all systems, but bugs in some
      motherboards' <firstterm><acronym>ACPI</acronym> Machine
      Language</firstterm> (<acronym>AML</acronym>) bytecode,
      incompleteness in &os;'s kernel subsystems, and bugs in the &intel;
      <acronym>ACPI-CA</acronym> interpreter continue to appear.</para>

    <para>This document is intended to help you assist the &os;
      <acronym>ACPI</acronym> maintainers in identifying the root cause
      of problems you observe and debugging and developing a solution.
      Thanks for reading this and we hope we can solve your system's
      problems.</para>

    <sect2 id="ACPI-submitdebug">
      <title>Submitting Debugging Information</title>

      <note>
	<para>Before submitting a problem, be sure you are running the latest
	  <acronym>BIOS</acronym> version and, if available, embedded
	  controller firmware version.</para>
      </note>

      <para>For those of you that want to submit a problem right away,
	please send the following information to
	<ulink url="mailto:freebsd-acpi@FreeBSD.org">
	freebsd-acpi@FreeBSD.org</ulink>:</para>

      <itemizedlist>
	<listitem>
	  <para>Description of the buggy behavior, including system type
	    and model and anything that causes the bug to appear.  Also,
	    please note as accurately as possible when the bug began
	    occurring if it is new for you.</para>
	</listitem>

	<listitem>
	  <para>The &man.dmesg.8; output after <command>boot
	    -v</command>, including any error messages
	    generated by you exercising the bug.</para>
	</listitem>

	<listitem>
	  <para>The &man.dmesg.8; output from <command>boot
	    -v</command> with <acronym>ACPI</acronym>
	    disabled, if disabling it helps fix the problem.</para>
	</listitem>

	<listitem>
	  <para>Output from <command>sysctl hw.acpi</command>.  This is also
	    a good way of figuring out what features your system
	    offers.</para>
	</listitem>

	<listitem>
	  <para><acronym>URL</acronym> where your
	    <firstterm><acronym>ACPI</acronym> Source Language</firstterm>
	    (<acronym>ASL</acronym>)
	    can be found.  Do <emphasis>not</emphasis> send the
	    <acronym>ASL</acronym> directly to the list as it can be
	    very large.  Generate a copy of your <acronym>ASL</acronym>
	    by running this command:</para>

	  <screen>&prompt.root; <userinput>acpidump -dt &gt; <replaceable>name</replaceable>-<replaceable>system</replaceable>.asl</userinput></screen>

	  <para>(Substitute your login name for
	    <replaceable>name</replaceable> and manufacturer/model for
	    <replaceable>system</replaceable>.  Example:
	    <filename>njl-FooCo6000.asl</filename>)</para>
	</listitem>
      </itemizedlist>

      <para>Most of the developers watch the &a.current;
        but please submit problems to &a.acpi.name; to be sure it is
	seen.  Please be patient, all of us have full-time jobs
	elsewhere.  If your bug is not immediately apparent, we will
	probably ask you to submit a <acronym>PR</acronym> via
	&man.send-pr.1;.  When entering a <acronym>PR</acronym>, please
	include the same information as requested above.  This will help
	us track the problem and resolve it.  Do not send a
	<acronym>PR</acronym> without emailing &a.acpi.name; first as we use
	<acronym>PR</acronym>s as reminders of existing problems, not a
	reporting mechanism.  It is likely that your problem has been
	reported by someone before.</para>
    </sect2>

    <sect2 id="ACPI-background">
      <title>Background</title>

      <indexterm>
	<primary>ACPI</primary>
      </indexterm>

      <para><acronym>ACPI</acronym> is present in all modern computers
	that conform to the ia32 (x86), ia64 (Itanium), and amd64 (AMD)
	architectures.  The full standard has many features including
	<acronym>CPU</acronym> performance management, power planes
	control, thermal zones, various battery systems, embedded
	controllers, and bus enumeration.  Most systems implement less
	than the full standard.  For instance, a desktop system usually
	only implements the bus enumeration parts while a laptop might
	have cooling and battery management support as well.  Laptops
	also have suspend and resume, with their own associated
	complexity.</para>

      <para>An <acronym>ACPI</acronym>-compliant system has various
	components.  The <acronym>BIOS</acronym> and chipset vendors
	provide various fixed tables (e.g., <acronym>FADT</acronym>)
	in memory that specify things like the <acronym>APIC</acronym>
	map (used for <acronym>SMP</acronym>), config registers, and
	simple configuration values.  Additionally, a table of bytecode
	(the <firstterm>Differentiated System Description Table</firstterm>
	<acronym>DSDT</acronym>) is provided that specifies a
	tree-like name space of devices and methods.</para>

      <para>The <acronym>ACPI</acronym> driver must parse the fixed
	tables, implement an interpreter for the bytecode, and modify
	device drivers and the kernel to accept information from the
	<acronym>ACPI</acronym> subsystem.  For &os;, &intel; has
	provided an interpreter (<acronym>ACPI-CA</acronym>) that is
	shared with Linux and NetBSD.  The path to the
	<acronym>ACPI-CA</acronym> source code is
	<filename class="directory">src/sys/contrib/dev/acpica</filename>.
	The glue code that allows <acronym>ACPI-CA</acronym> to work on
	&os; is in
	<filename>src/sys/dev/acpica/Osd</filename>.  Finally, drivers
	that implement various <acronym>ACPI</acronym> devices are found
	in
	<filename class="directory">src/sys/dev/acpica</filename>.</para>
    </sect2>

    <sect2 id="ACPI-comprob">
      <title>Common Problems</title>

      <indexterm>
	<primary>ACPI</primary>
	<secondary>problems</secondary>
      </indexterm>

      <para>For <acronym>ACPI</acronym> to work correctly, all the parts
	have to work correctly.  Here are some common problems, in order
	of frequency of appearance, and some possible workarounds or
	fixes.</para>

      <sect3>
	<title>Mouse Issues</title>

	<para>In some cases, resuming from a suspend operation will
	  cause the mouse to fail.  A known work around is to add
	  <literal>hint.psm.0.flags="0x3000"</literal> to the
	  <filename>/boot/loader.conf</filename> file.  If this
	  does not work then please consider sending a bug report
	  as described above.</para>
      </sect3>

      <sect3>
	<title>Suspend/Resume</title>

	<para><acronym>ACPI</acronym> has three suspend to
	  <acronym>RAM</acronym> (<acronym>STR</acronym>) states,
	  <literal>S1</literal>-<literal>S3</literal>, and one suspend
	  to disk state (<literal>STD</literal>), called
	  <literal>S4</literal>.  <literal>S5</literal> is
	  <quote>soft off</quote> and is the normal state your system
	  is in when plugged in but not powered up.
	  <literal>S4</literal> can actually be implemented two separate
	  ways.  <literal>S4</literal><acronym>BIOS</acronym> is a
	  <acronym>BIOS</acronym>-assisted suspend to disk.
	  <literal>S4</literal><acronym>OS</acronym> is implemented
	  entirely by the operating system.</para>

	<para>Start by checking <command>sysctl hw.acpi</command>
	  for the suspend-related items.  Here
	  are the results for a Thinkpad:</para>

	<screen>hw.acpi.supported_sleep_state: S3 S4 S5
hw.acpi.s4bios: 0</screen>

	<para>This means that we can use <command>acpiconf -s</command>
	  to test <literal>S3</literal>,
	  <literal>S4</literal><acronym>OS</acronym>, and
	  <literal>S5</literal>.  If <option>s4bios</option> was one
	  (<literal>1</literal>), we would have
	  <literal>S4</literal><acronym>BIOS</acronym>
	  support instead of <literal>S4</literal>
	  <acronym>OS</acronym>.</para>

	<para>When testing suspend/resume, start with
	  <literal>S1</literal>, if supported.  This state is most
	  likely to work since it does not require much driver support.
	  No one has implemented <literal>S2</literal> but if you have
	  it, it is similar to <literal>S1</literal>.  The next thing
	  to try is <literal>S3</literal>.  This is the deepest
	  <acronym>STR</acronym> state and requires a lot of driver
	  support to properly reinitialize your hardware.  If you have
	  problems resuming, feel free to email the &a.acpi.name; list but
	  do not expect the problem to be resolved since there are a lot
	  of drivers/hardware that need more testing and work.</para>

	<para>To help isolate the problem, remove as many drivers from
	  your kernel as possible.  If it works, you can narrow down
	  which driver is the problem by loading drivers until it fails
	  again.  Typically binary drivers like
	  <filename>nvidia.ko</filename>, X11
	  display drivers, and <acronym>USB</acronym> will have the most
	  problems while Ethernet interfaces usually work fine.  If you
	  can properly load/unload the drivers, you can automate this by
	  putting the appropriate commands in
	  <filename>/etc/rc.suspend</filename> and
	  <filename>/etc/rc.resume</filename>.  There is a
	  commented-out example for unloading and loading a driver.  Try
	  setting <option>hw.acpi.reset_video</option> to zero
	  (<literal>0</literal>) if
	  your display is messed up after resume.  Try setting longer or
	  shorter values for <option>hw.acpi.sleep_delay</option> to see
	  if that helps.</para>

	<para>Another thing to try is load a recent Linux distribution
	  with <acronym>ACPI</acronym> support and test their
	  suspend/resume support on the same hardware.  If it works
	  on Linux, it is likely a &os; driver problem and narrowing down
	  which driver causes the problems will help us fix the problem.
	  Note that the <acronym>ACPI</acronym> maintainers do not
	  usually maintain other drivers (e.g sound,
	  <acronym>ATA</acronym>, etc.) so any work done on tracking
	  down a driver problem should probably eventually be posted
	  to the &a.current.name; list and mailed to the driver
	  maintainer.  If you are feeling adventurous, go ahead and
	  start putting some debugging &man.printf.3;s in a problematic
	  driver to track down where in its resume function it
	  hangs.</para>

	<para>Finally, try disabling <acronym>ACPI</acronym> and
	  enabling <acronym>APM</acronym> instead.  If suspend/resume
	  works with <acronym>APM</acronym>, you may be better off
	  sticking with <acronym>APM</acronym>, especially on older
	  hardware (pre-2000).  It took vendors a while to get
	  <acronym>ACPI</acronym> support correct and older hardware is
	  more likely to have <acronym>BIOS</acronym> problems with
	  <acronym>ACPI</acronym>.</para>
      </sect3>

      <sect3>
	<title>System Hangs (temporary or permanent)</title>

	<para>Most system hangs are a result of lost interrupts or an
	  interrupt storm.  Chipsets have a lot of problems based on how
	  the <acronym>BIOS</acronym> configures interrupts before boot,
	  correctness of the <acronym>APIC</acronym>
	  (<acronym>MADT</acronym>) table, and routing of the
	  <firstterm>System Control Interrupt</firstterm>
	  (<acronym>SCI</acronym>).</para>

	<indexterm>
	  <primary>interrupt storms</primary>
	</indexterm>

	<para>Interrupt storms can be distinguished from lost interrupts
	  by checking the output of <command>vmstat -i</command>
	  and looking at the line that has
	  <literal>acpi0</literal>.  If the counter is increasing at more
	  than a couple per second, you have an interrupt storm.  If the
	  system appears hung, try breaking to <acronym>DDB</acronym>
	  (<keycombo action="simul"><keycap>CTRL</keycap>
	  <keycap>ALT</keycap><keycap>ESC</keycap></keycombo> on
	  console) and type <literal>show interrupts</literal>.</para>

	<indexterm>
	  <primary>APIC</primary>
	  <secondary>disabling</secondary>
	</indexterm>

	<para>Your best hope when dealing with interrupt problems is to
	  try disabling <acronym>APIC</acronym> support with
	  <literal>hint.apic.0.disabled="1"</literal> in
	  <filename>loader.conf</filename>.</para>
      </sect3>

      <sect3>
	<title>Panics</title>

	<para>Panics are relatively rare for <acronym>ACPI</acronym> and
	  are the top priority to be fixed.  The first step is to
	  isolate the steps to reproduce the panic (if possible)
	  and get a backtrace.  Follow the advice for enabling
	  <literal>options DDB</literal> and setting up a serial console
	  (see <xref linkend="serialconsole-ddb">)
	  or setting up a &man.dump.8; partition.  You can get a
	  backtrace in <acronym>DDB</acronym> with
	  <literal>tr</literal>.  If you have to handwrite the
	  backtrace, be sure to at least get the lowest five (5) and top
	  five (5) lines in the trace.</para>

	<para>Then, try to isolate the problem by booting with
	  <acronym>ACPI</acronym> disabled.  If that works, you can
	  isolate the <acronym>ACPI</acronym> subsystem by using various
	  values of <option>debug.acpi.disable</option>.  See the
	  &man.acpi.4; manual page for some examples.</para>
      </sect3>

      <sect3>
	<title>System Powers Up After Suspend or Shutdown</title>
	<para>First, try setting
	  <literal>hw.acpi.disable_on_poweroff="0"</literal>
	  in &man.loader.conf.5;.  This keeps <acronym>ACPI</acronym>
	  from disabling various events during the shutdown process.
	  Some systems need this value set to <literal>1</literal> (the
	  default) for the same reason.  This usually fixes
	  the problem of a system powering up spontaneously after a
	  suspend or poweroff.</para>
      </sect3>

      <sect3>
	<title>Other Problems</title>

	<para>If you have other problems with <acronym>ACPI</acronym>
	  (working with a docking station, devices not detected, etc.),
	  please email a description to the mailing list as well;
	  however, some of these issues may be related to unfinished
	  parts of the <acronym>ACPI</acronym> subsystem so they might
	  take a while to be implemented.  Please be patient and
	  prepared to test patches we may send you.</para>
      </sect3>
    </sect2>

    <sect2 id="ACPI-aslanddump">
      <title><acronym>ASL</acronym>, <command>acpidump</command>, and
        <acronym>IASL</acronym></title>

      <indexterm>
	<primary>ACPI</primary>
	<secondary>ASL</secondary>
      </indexterm>

      <para>The most common problem is the <acronym>BIOS</acronym>
	vendors providing incorrect (or outright buggy!) bytecode.  This
	is usually manifested by kernel console messages like
	this:</para>

      <screen>ACPI-1287: *** Error: Method execution failed [\\_SB_.PCI0.LPC0.FIGD._STA] \\
(Node 0xc3f6d160), AE_NOT_FOUND</screen>

      <para>Often, you can resolve these problems by updating your
	<acronym>BIOS</acronym> to the latest revision.  Most console
	messages are harmless but if you have other problems like
	battery status not working, they are a good place to start
	looking for problems in the <acronym>AML</acronym>.  The
	bytecode, known as <acronym>AML</acronym>, is compiled from a
	source language called <acronym>ASL</acronym>.  The
	<acronym>AML</acronym> is found in the table known as the
	<acronym>DSDT</acronym>.  To get a copy of your
	<acronym>ASL</acronym>, use &man.acpidump.8;.  You should use
	both the <option>-t</option> (show contents of the fixed tables)
	and <option>-d</option> (disassemble <acronym>AML</acronym> to
	<acronym>ASL</acronym>) options.  See the
	<link linkend="ACPI-submitdebug">Submitting Debugging
	Information</link> section for an example syntax.</para>

      <para>The simplest first check you can do is to recompile your
	<acronym>ASL</acronym> to check for errors.  Warnings can
	usually be ignored but errors are bugs that will usually prevent
	<acronym>ACPI</acronym> from working correctly.  To recompile
	your <acronym>ASL</acronym>, issue the following command:</para>

      <screen>&prompt.root; <userinput>iasl your.asl</userinput></screen>
    </sect2>

    <sect2 id="ACPI-fixasl">
      <title>Fixing Your <acronym>ASL</acronym></title>

      <indexterm>
	<primary>ACPI</primary>
	<secondary>ASL</secondary>
      </indexterm>

      <para>In the long run, our goal is for almost everyone to have
	<acronym>ACPI</acronym> work without any user intervention.  At
	this point, however, we are still developing workarounds for
	common mistakes made by the <acronym>BIOS</acronym> vendors.
	The &microsoft; interpreter (<filename>acpi.sys</filename> and
	<filename>acpiec.sys</filename>) does not strictly check for
	adherence to the standard, and thus many <acronym>BIOS</acronym>
	vendors who only test <acronym>ACPI</acronym> under &windows;
	never fix their <acronym>ASL</acronym>.  We hope to continue to
	identify and document exactly what non-standard behavior is
	allowed by &microsoft;'s interpreter and replicate it so &os; can
	work without forcing users to fix the <acronym>ASL</acronym>.
	As a workaround and to help us identify behavior, you can fix
	the <acronym>ASL</acronym> manually.  If this works for you,
	please send a &man.diff.1; of the old and new
	<acronym>ASL</acronym> so we can possibly work around the buggy
	behavior in <acronym>ACPI-CA</acronym> and thus make your fix
	unnecessary.</para>

      <indexterm>
	<primary>ACPI</primary>
	<secondary>error messages</secondary>
      </indexterm>

      <para>Here is a list of common error messages, their cause, and
	how to fix them:</para>

      <sect3>
	<title>_OS dependencies</title>

	<para>Some <acronym>AML</acronym> assumes the world consists of
	  various &windows; versions.  You can tell &os; to claim it is
	  any <acronym>OS</acronym> to see if this fixes problems you
	  may have.  An easy way to override this is to set
	  <literal>hw.acpi.osname="Windows 2001"</literal>
	  in <filename>/boot/loader.conf</filename> or other similar
	  strings you find in the <acronym>ASL</acronym>.</para>
      </sect3>

      <sect3>
	<title>Missing Return statements</title>

	<para>Some methods do not explicitly return a value as the
	  standard requires.  While <acronym>ACPI-CA</acronym>
	  does not handle this, &os; has a workaround that allows it to
	  return the value implicitly.  You can also add explicit
	  Return statements where required if you know what value should
	  be returned.  To force <command>iasl</command> to compile the
	  <acronym>ASL</acronym>, use the <option>-f</option>
	  flag.</para>
      </sect3>

      <sect3>
	<title>Overriding the Default <acronym>AML</acronym></title>

	<para>After you customize <filename>your.asl</filename>, you
	  will want to compile it, run:</para>

	<screen>&prompt.root; <userinput>iasl your.asl</userinput></screen>

	<para>You can add the <option>-f</option> flag to force creation
	  of the <acronym>AML</acronym>, even if there are errors during
	  compilation.  Remember that some errors (e.g., missing Return
	  statements) are automatically worked around by the
	  interpreter.</para>

	<para><filename>DSDT.aml</filename> is the default output
	  filename for <command>iasl</command>.  You can load this
	  instead of your <acronym>BIOS</acronym>'s buggy copy (which
	  is still present in flash memory) by editing
	  <filename>/boot/loader.conf</filename> as
	  follows:</para>

	<programlisting>acpi_dsdt_load="YES"
acpi_dsdt_name="/boot/DSDT.aml"</programlisting>

	<para>Be sure to copy your <filename>DSDT.aml</filename> to the
	  <filename class="directory">/boot</filename> directory.</para>
      </sect3>
    </sect2>

    <sect2 id="ACPI-debugoutput">
      <title>Getting Debugging Output From
	<acronym>ACPI</acronym></title>

      <indexterm>
	<primary>ACPI</primary>
	<secondary>problems</secondary>
      </indexterm>

      <indexterm>
	<primary>ACPI</primary>
	<secondary>debugging</secondary>
      </indexterm>

      <para>The <acronym>ACPI</acronym> driver has a very flexible
	debugging facility.  It allows you to specify a set of subsystems
	as well as the level of verbosity.  The subsystems you wish to
	debug are specified as <quote>layers</quote> and are broken down
	into <acronym>ACPI-CA</acronym> components (ACPI_ALL_COMPONENTS)
	and <acronym>ACPI</acronym> hardware support (ACPI_ALL_DRIVERS).
	The verbosity of debugging output is specified as the
	<quote>level</quote> and ranges from ACPI_LV_ERROR (just report
	errors) to ACPI_LV_VERBOSE (everything).  The
	<quote>level</quote> is a bitmask so multiple options can be set
	at once, separated by spaces.  In practice, you will want to use
	a serial console to log the output if it is so long
	it flushes the console message buffer.  A full list of the
	individual layers and levels is found in the &man.acpi.4; manual
	page.</para>

      <para>Debugging output is not enabled by default.  To enable it,
	add <literal>options ACPI_DEBUG</literal> to your kernel configuration file
	if <acronym>ACPI</acronym> is compiled into the kernel.  You can
	add <literal>ACPI_DEBUG=1</literal> to your
	<filename>/etc/make.conf</filename> to enable it globally.  If
	it is a module, you can recompile just your
	<filename>acpi.ko</filename> module as follows:</para>

      <screen>&prompt.root; <userinput>cd /sys/modules/acpi/acpi
&amp;&amp; make clean &amp;&amp;
make ACPI_DEBUG=1</userinput></screen>

      <para>Install <filename>acpi.ko</filename> in
	<filename class="directory">/boot/kernel</filename> and add your
	desired level and layer to <filename>loader.conf</filename>.
	This example enables debug messages for all
	<acronym>ACPI-CA</acronym> components and all
	<acronym>ACPI</acronym> hardware drivers
	(<acronym>CPU</acronym>, <acronym>LID</acronym>, etc.).  It will
	only output error messages, the least verbose level.</para>

      <programlisting>debug.acpi.layer="ACPI_ALL_COMPONENTS ACPI_ALL_DRIVERS"
debug.acpi.level="ACPI_LV_ERROR"</programlisting>

      <para>If the information you want is triggered by a specific event
	(say, a suspend and then resume), you can leave out changes to
	<filename>loader.conf</filename> and instead use
	<command>sysctl</command> to specify the layer and level after
	booting and preparing your system for the specific event.  The
	<command>sysctl</command>s are named the same as the tunables
	in <filename>loader.conf</filename>.</para>
    </sect2>

    <sect2 id="ACPI-References">
      <title>References</title>

      <para>More information about <acronym>ACPI</acronym> may be found
	in the following locations:</para>

      <itemizedlist>
	<listitem>
	  <para>The &a.acpi;</para>
	</listitem>

	<listitem>
	  <para>The <acronym>ACPI</acronym> Mailing List Archives
	    <ulink url="http://lists.freebsd.org/pipermail/freebsd-acpi/"></ulink></para>
	</listitem>

        <listitem>
          <para>The old <acronym>ACPI</acronym> Mailing List Archives
            <ulink url="http://home.jp.FreeBSD.org/mail-list/acpi-jp/"></ulink></para>
        </listitem>

	<listitem>
	  <para>The <acronym>ACPI</acronym> 2.0 Specification
	    <ulink url="http://acpi.info/spec.htm"></ulink></para>
	</listitem>

	<listitem>
	  <para>&os; Manual pages: &man.acpi.4;,
	    &man.acpi.thermal.4;, &man.acpidump.8;, &man.iasl.8;,
	    &man.acpidb.8;</para>
	</listitem>

	<listitem>
	  <para><ulink
	    url="http://www.cpqlinux.com/acpi-howto.html#fix_broken_dsdt">
	    <acronym>DSDT</acronym> debugging resource</ulink>.
	    (Uses Compaq as an example but generally useful.)</para>
	</listitem>
      </itemizedlist>
    </sect2>
  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->
